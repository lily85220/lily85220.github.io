import{jO as Re,jP as xe,ds as Ce,n as g,cz as Oe,bY as Z,bZ as u,bn as j,bt as ye,jQ as N,jE as F,b_ as A,b$ as M,r as x,v as V,c0 as Ee,bb as te,c1 as G,c2 as L,c4 as we,jR as X,jS as ie,jT as Se,j9 as Ae,jU as Ge,jV as Pe,jW as $e,c9 as H,jX as Q,jY as C,bC as je,a3 as Me,bD as ze,bv as Te,by as We,jZ as re,N as be,bP as B,bu as Ie,bR as T,bp as ee,bT as ve,bW as Fe,jj as se,ck as $,j_ as ne,j$ as ae,k0 as oe,bf as m,e7 as p,bE as Ve,k1 as k,k2 as Y,k3 as Le,k4 as He,cm as Ue,bU as Ne,de as Be,k5 as J,ca as le,k6 as ke,cd as Ye,k as qe,cC as he,d3 as Ze}from"./index-cb639cc1.js";import{t as De,S as Xe}from"./RightAngleQuadVisualElement-97d8d566.js";import{d as Qe,S as ce}from"./PointVisualElement-436a9da2.js";import{r as Je}from"./SnappingContext-4110407b.js";import{y as Ke,p as et}from"./colorUtils-7641d345.js";import{n as tt}from"./LineVisualElement-78cd90ab.js";import{v as de}from"./manipulatorUtils-628928f4.js";class it extends De{constructor(e){super(e),this._ray=Ce(),this._isWorldDown=!1,this._start=g(),this._end=Oe(1,0,0),this._width=1,this._color=Z(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Z(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=O.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=u.OccludeAndTransparent,this._fadedExtensions=_e,this._laserline=new Qe({view:this.view}),this.applyProps(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,i)=>this._recreateObject3DGeometry(t,i),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,j(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),ye(this._end,e,this._end),N(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,F(this._start,e)||(j(this._start,e),N(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,F(this._end,e)||(j(this._end,e),N(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){A(e,this._color)||(M(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){A(e,this._innerColor)||(M(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=x(e)!==x(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(V(e)||V(this._stippleOffColor)||!A(e,this._stippleOffColor))&&(this._stippleOffColor=x(e)?Ee(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&x(this._laserlineStyle)&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,x(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===u.OccludeAndTransparentStencil?u.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=te(e,_e),this.recreateGeometry()}_updateMaterial(){var t,i;const{materialParameters:e}=this;(t=G(this.object3dResources.resources))==null||t.material.setParameters(e),(i=G(this.drapedResources.resources))==null||i.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new L(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:r=>{r(t),i.forEach(r)}}}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new L(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);this._updateVerticesDraped(t);const i=new we(t,{boundingInfo:t.boundingInfo});return i.computeBoundingSphere(i.transformation,i.boundingSphere),i}_createGeometry(e){const t=this.extensionType===O.FADED,i=t?[g(),g(),g(),g()]:[g(),g()];return X(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=G(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===O.FADED?this._updateLineSegmentFinite(ue):this._updateLineSegmentInfinite(this._extensionType,ue)}_updateLineSegmentFinite(e){return ie(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Se(this._ray,b),e){case O.LINE:b.c0=-Number.MAX_VALUE;break;case O.RAY:case O.GROUND_RAY:{const n=this._ray.origin,h=te(this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),l=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&l<h&&Ae(b.ray.direction,b.ray.direction),this._extensionType===O.GROUND_RAY&&h!=null&&(b.c1=Math.abs(l-h));break}}if(!Ge(i.frustum,b))return this._updateLineSegmentFinite(t);const r=Pe(b,D),s=$e(b,rt);return ie(r,s,t)}_updateVertexAttributesObject3D(e,t){var s;const i=(s=e.geometries[0].getMutableAttribute(H.POSITION))==null?void 0:s.data;if(!i)return;let r=0;for(const n of this._lineVertices(t))i[r++]=n[0],i[r++]=n[1],i[r++]=n[2];e.geometryVertexAttrsUpdated(e.geometries[0])}_updateVertexAttributesDraped(e,t){var s;const i=(s=e.getMutableAttribute(H.POSITION))==null?void 0:s.data;if(!i)return;let r=0;for(const n of this._lineVertices(t))i[r++]=n[0],i[r++]=n[1],i[r++]=Q;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===O.FADED?(yield C(e,-this.fadedExtensions.start,D),yield C(e,0,D),yield C(e,1,D),yield C(e,1+this.fadedExtensions.end,D)):(yield C(e,0,D),yield C(e,1,D))}}const b=Re(),D=g(),rt=g(),ue=xe();var O;(function(a){a[a.LINE=0]="LINE",a[a.RAY=1]="RAY",a[a.GROUND_RAY=2]="GROUND_RAY",a[a.FADED=3]="FADED"})(O||(O={}));const pe=1/3,_e={start:pe,end:pe};let st=class extends De{constructor(e){super(e),this._location=g(),this._direction=Oe(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Z(1,0,1,1),this._renderOccluded=u.OccludeAndTransparent,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),recreateGeometry:(t,i)=>this._recreateObject3DGeometry(t,i),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){F(this._location,e)||(j(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){F(this._direction,e)||(j(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){je(this._direction,ye(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){A(e,this._color)||(M(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new L(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:r=>{r(t),i.forEach(r)}}}_destroyObject3DResources(e){e.geometries.length=0,e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,s]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(s),i.push(r),i.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new L(this.materialParameters),t=Me(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);this._updateVerticesDraped(t);const i=t.map(r=>new we(r,{boundingInfo:r.boundingInfo}));for(const r of i)r.computeBoundingSphere(r.transformation,r.boundingSphere);return i}_createGeometries(e){return[X(e,[g(),g()]),X(e,[g(),g()])]}_updateMaterial(){var t,i;const{materialParameters:e}=this;(t=G(this.object3dResources.resources))==null||t.material.setParameters(e),(i=G(this.drapedResources.resources))==null||i.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=G(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,I),ze(w,this.location,this.direction),t.projectToScreen(w,E),Te(E,We(E,E,I)),this._updateVertexAttributesObject3D(t,e,0,I,E,1),this._updateVertexAttributesObject3D(t,e,1,I,E,-1)}_updateVertexAttributesObject3D(e,t,i,r,s,n){var _;const h=t.geometries[i],l=(_=h.getMutableAttribute(H.POSITION))==null?void 0:_.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(s,r,n,this.offset,this.width,this.length);e.unprojectFromScreen(re(c),w),l[0]=w[0],l[1]=w[1],l[2]=w[2],e.unprojectFromScreen(re(d),w),l[3]=w[0],l[4]=w[1],l[5]=w[2],t.geometryVertexAttrsUpdated(h)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:s,length:n,offset:h}=this,l=nt;l.spatialReference=be(t.renderer.spatialReference),l.x=r[0],l.y=r[1];const c=t.overlayPixelSizeInMapUnits(l)*i,d=s*c,_=n*c,f=h*c;this._updateVertexAttributesDraped(e[0],d,_,f,-1),this._updateVertexAttributesDraped(e[1],d,_,f,1)}_updateVertexAttributesDraped(e,t,i,r,s){var _;const n=(_=e.getMutableAttribute(H.POSITION))==null?void 0:_.data;if(!n)return;const{location:h,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,h,s,r,t,i);n[0]=c[0],n[1]=c[1],n[2]=Q,n[3]=d[0],n[4]=d[1],n[5]=Q,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,r,s,n){const h=B(fe,Ie(fe,e[1]*i,e[0]*-i),r+s/2),l=T(W,T(W,T(W,t,B(W,e,n/2)),h),h);return{start:l,end:T(ge,l,B(ge,e,-n))}}};const w=g(),fe=ee(),W=ee(),ge=ee(),I=ve(),E=ve(),nt=Fe(0,0,void 0,null);class Ct extends Je{sortUniqueHints(e){return e.sort((t,i)=>(i instanceof se?i.length:0)-(t instanceof se?t.length:0))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:r}=t;return $(new ce({view:r,primitive:"circle",geometry:ne(e.intersectionPoint,i),elevationInfo:e.isDraped?ae:oe,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:m.toUnitRGBA(p.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:i,spatialReference:r}=t,s=this._alignPoint(e.point,e.domain,t);return $(new ce({view:i,primitive:"circle",geometry:ne(s,r),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:m.toUnitRGBA(p.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,s=this._alignPoint(e.lineStart,e.domain,t),n=this._alignPoint(e.lineEnd,e.domain,t);return $(this._createLineSegmentHint(e.type,s,n,r,this._hintElevationInfo(e,t),i,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:r}=t,{isDraped:s}=e,n=this._hintElevationInfo(e,t),h=this._alignPoint(e.lineStart,e.domain,t),l=this._alignPoint(e.lineEnd,e.domain,t),c=R(h,r,n,i,s),d=R(l,r,n,i,s),_=Ve(d,c,d,.5),f=new st({view:i,attached:!1,offset:p.parallelLineHintOffset,length:p.parallelLineHintLength,width:p.parallelLineHintWidth,color:m.toUnitRGBA(p.orange),location:_,renderOccluded:s?u.OccludeAndTransparent:u.Opaque,isDraped:s,renderGroup:k.SnappingHint});return f.setDirectionFromPoints(c,_),f.attached=!0,$(f)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:r}=t,s=this._hintElevationInfo(e,t),{isDraped:n}=e,h=this._alignPoint(e.previousVertex,e.domain,t),l=this._alignPoint(e.centerVertex,e.domain,t),c=this._alignPoint(e.nextVertex,e.domain,t),d=R(h,r,s,i,n),_=R(l,r,s,i,n),f=R(c,r,s,i,n);return $(new Xe({view:i,attached:!0,color:n?m.toUnitRGBA(p.orangeTransparent):m.toUnitRGBA(p.orange),renderOccluded:n?u.OccludeAndTransparent:u.Transparent,outlineRenderOccluded:n?u.OccludeAndTransparent:u.Opaque,outlineColor:m.toUnitRGBA(p.orange),outlineSize:p.rightAngleHintOutlineSize,size:p.rightAngleHintSize,isDraped:n,geometry:{previous:d,center:_,next:f},renderGroup:k.SnappingHint}))}_createLineSegmentHint(e,t,i,r,s,n,h=!1,l=!0,c=!0){const d=R(t,r,s,n,h),_=R(i,r,s,n,h),f=new it({view:n,extensionType:O.FADED,start:d,end:_,isDraped:h,color:m.toUnitRGBA(p.orange),renderOccluded:h?u.OccludeAndTransparent:u.Opaque,renderGroup:k.SnappingHint});switch(e){case Y.TARGET:f.width=p.lineHintWidthTarget,f.fadedExtensions={start:0,end:p.lineHintFadedExtensions};break;case Y.REFERENCE_EXTENSION:f.width=p.lineHintWidthReference,f.fadedExtensions={start:0,end:0};break;case Y.REFERENCE:f.width=p.lineHintWidthReference,f.fadedExtensions={start:l?p.lineHintFadedExtensions:0,end:c?p.lineHintFadedExtensions:0}}return f.attached=!0,f}_alignPoint(e,t,i){const r=this._getSelfSnappingZ(t,i);return V(r)?e:Le(e[0],e[1],r)}_hintElevationInfo(e,t){return x(this._getSelfSnappingZ(e.domain,t))?be(t.selfSnappingZ).elevationInfo:e.isDraped?ae:oe}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===He.SELF&&x(t)?t.value:null}}function R(a,e,t,i,r,s=g()){if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;Ue(a,e,s,n)}else Ne(a,e,t,i,s);return s}const o={main:new m([255,127,0]),selected:new m([255,255,255]),staged:new m([12,207,255]),outline:new m([0,0,0,.5]),selectedOutline:new m([255,255,255])},P=.3;function z(a,e){const t=a.clone();return t.a*=e,t}function at(a,e){const t=a.clone(),i=Ke(t);i.s*=e;const r=et(i);return t.r=r.r,t.g=r.g,t.b=r.b,t}function y(a,e){if(e)for(const t in e)a[t]=e[t]}class ot{constructor(e){this.color=o.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=u.Opaque,y(this,e)}}let q=class{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=o.main,this.outlineColor=o.outline,this.renderOccluded=u.Opaque,this.hoverOutlineColor=o.selectedOutline,y(this,e)}apply(e,t){const i=this[e];t.setParameters({color:v(i),transparent:e!=="color"||i.a<1,renderOccluded:this.renderOccluded})}};class lt{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=z(o.main,.5),this.hoverColor=o.main,this.renderOccluded=u.Transparent,this.minSquaredEdgeLength=900,y(this,e)}apply(e,t){const i=this[e];t.setParameters({color:v(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class ht{constructor(e){this.vertex=new q({color:o.main,outlineColor:o.outline}),this.edge=new q({color:at(z(o.main,2/3),.5),outlineColor:z(o.outline,.5),size:8,collisionPadding:8}),this.selected=new q({color:o.selected,outlineColor:o.outline}),this.edgeOffset=new lt,y(this,e)}}class K{constructor(e){this.color=o.selected,this.width=1.5,this.stipplePattern=J(5),this.stippleOffColor=o.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=o.selected,this.renderOccluded=u.OccludeAndTransparent,y(this,e)}apply(e){e.color=v(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=v(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=v(this.innerColor),e.renderOccluded=this.renderOccluded}}class ct{constructor(e){this.color=o.selected,this.size=4,this.outlineSize=1,this.outlineColor=o.outline,this.shape="square",y(this,e)}apply(e){e.color=v(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=v(this.outlineColor),e.primitive=this.shape}}let U=class{constructor(e){this.innerColor=o.selected,this.innerWidth=1,this.glowColor=o.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=P,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=o.main,y(this,e)}apply(e,t=1){const i={glowColor:m.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:m.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}};class dt{constructor(e){this.outline=new K({color:o.outline,renderOccluded:u.OccludeAndTransparentStencil,stippleOffColor:o.selected,stipplePattern:J(5),width:1.5,innerWidth:0}),this.staged=new K({color:o.selected,renderOccluded:u.OccludeAndTransparentStencil,innerColor:o.staged,stippleOffColor:o.outline,stipplePattern:J(5),width:1.5}),this.shadowStyle=new U({globalAlpha:P,glowColor:o.main,glowFalloff:8,glowWidth:8,innerColor:o.selected,innerWidth:1}),y(this,e)}}class ut{constructor(e){this.outline=new ct({color:o.selected,outlineColor:o.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new U({globalAlpha:P,glowColor:o.main,glowFalloff:1.5,glowWidth:6,innerColor:o.selected,innerWidth:1,radius:2}),y(this,e)}}class pt extends K{constructor(e){super(),this.extensionType=O.GROUND_RAY,y(this,e)}}class _t{constructor(e){this.lineGraphics=new dt,this.pointGraphics=new ut,this.heightPlane=new U({globalAlpha:P,glowColor:o.main,glowFalloff:8,glowWidth:8,innerColor:o.selected,innerWidth:1}),this.heightBox=new U({globalAlpha:P,glowColor:o.main,glowFalloff:8,glowWidth:8,innerColor:o.selected,innerWidth:0,heightFillColor:o.main}),this.zVerticalLine=new pt({color:z(o.main,5*P/3),falloff:2,innerColor:z(o.selected,0),renderOccluded:u.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:O.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,y(this,e)}}class ft{constructor(e){this.visualElements=new _t,this.reshapeManipulators=new ht,this.zManipulator=new ot,y(this,e)}colorToVec4(e){return v(e)}}function v(a){return Be(m.toUnitRGBA(a))}const S=new ft;function gt(a,e,t,i,r){const s=le(3*a.length),n=le(s.length);a.forEach((c,d)=>{s[3*d+0]=c[0],s[3*d+1]=c[1],s[3*d+2]=c.length>2?c[2]:0});const h=ke(s,e,0,n,0,s,0,s.length/3,t,i,r),l=h!=null;return{numVertices:a.length,position:s,mapPositions:n,projectionSuccess:l,sampledElevation:h}}class At extends tt{constructor(e){super(e),this.view=null,this._renderOccluded=u.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=S.colorToVec4(S.reshapeManipulators.vertex.color),this._size=S.reshapeManipulators.vertex.size,this._outlineColor=S.colorToVec4(S.reshapeManipulators.vertex.outlineColor),this._outlineSize=S.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){A(e,this._color)||(M(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){A(e,this._outlineColor)||(M(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(V(e)||e.length===0)return[];const t=.5,i=.5,r=gt(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ye.fromElevationInfo(this.elevationInfo)),s=[],n=r.numVertices,h=r.position;for(let l=0;l<n;++l){const c=qe(mt,h[3*l+0],h[3*l+1],h[3*l+2]),d=me(this._vertexMaterial,t,c),_=me(this._vertexOutlineMaterial,i,c);s.push({vertexGeometry:d,vertexOutlineGeometry:_})}return s}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:r}of t)e.addGeometry(i),e.addGeometry(r)}createExternalResources(){this._vertexMaterial=new de({...this._vertexMaterialParameters,writeDepth:!0,cullFace:he.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new de({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:he.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const mt=g();function me(a,e,t){return Ze(a,e,16,16,{offset:t})}export{At as _,o as r,it as v,Ct as x,S as y};
