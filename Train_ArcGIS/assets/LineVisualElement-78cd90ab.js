import{ln as v,v as p,r as n,bb as b,ki as w,a3 as P,cD as C,k9 as R,ir as O,dW as E,kj as G,c2 as j,j5 as x,bZ as $,k as u,cs as f,dQ as M,kd as k,n as h,lQ as _,lR as F,c5 as H,N as y}from"./index-cb639cc1.js";function A(l,e,t,s=!1){const r=v(l,e);return p(r)?null:(r.hasZ&&!s||!n(t)||(r.z=b(w(t,r),0)),r)}function V(l,e,t){t.warnOnce(`Failed to project analysis geometry (id: '${l.id}'), projection from spatial reference (wkid: '${e.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}let D=class{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=P(()=>this.view.ready,t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const s in e)s in this?s==="attached"?t=e[s]:this[s]=e[s]:console.error("Cannot set unknown property",s);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}};class S extends D{constructor(e){super(e.view),this._resources=null,this._transform=C()}get object(){return n(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){R(this._transform,e),n(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(p(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new O({pickable:!1,updatePolicy:E.SYNC});e.add(t);const s=new G({castShadow:!1});s.transformation=this._transform,this.createExternalResources(),this.createGeometries(s),e.addMany(s.geometries),this.forEachExternalMaterial(r=>e.add(r)),e.add(s),t.add(s),s.visible=this.visible,this._resources={layer:t,object:s}}destroyResources(){const e=this.view._stage;!p(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){p(this._resources)||(this._resources.object.visible=e)}}class N extends S{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=n(t),this._material=n(t)?t:new j({width:1,color:x(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:$.OccludeAndTransparent,writeDepth:!0}),this.applyProps(e)}setGeometryFromRenderSpacePoint(e,t=1e3){this.geometry=[[[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]],[[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]],[[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,s=h(),r=h(),a=100,i=[];u(s,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),u(s,e[2],e[1],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),u(s,e[2],e[3],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),u(s,e[0],e[3],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),u(s,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),u(s,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(s,t,r),i.push([r[0],r[1],r[2]]),this.geometry=[i]}setGeometryFromFrustum(e){const t=[];e.lines.forEach(s=>{t.push([s.origin[0],s.origin[1],s.origin[2]]),t.push([s.endpoint[0],s.endpoint[1],s.endpoint[2]])}),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],s=e.origin,r=e.basis1,a=e.basis2,i=.5,o=h(),c=h(),d=h(),m=h();o[0]=s[0]-r[0]*i-a[0]*i,o[1]=s[1]-r[1]*i-a[1]*i,o[2]=s[2]-r[2]*i-a[2]*i,c[0]=s[0]-r[0]*i+a[0]*i,c[1]=s[1]-r[1]*i+a[1]*i,c[2]=s[2]-r[2]*i+a[2]*i,d[0]=s[0]+r[0]*i+a[0]*i,d[1]=s[1]+r[1]*i+a[1]*i,d[2]=s[2]+r[2]*i+a[2]*i,m[0]=s[0]+r[0]*i-a[0]*i,m[1]=s[1]+r[1]*i-a[1]*i,m[2]=s[2]+r[2]*i-a[2]*i,t.push([o[0],o[1],o[2]]),t.push([c[0],c[1],c[2]]),t.push([d[0],d[1],d[2]]),t.push([m[0],m[1],m[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=f(g,t);const{points:s}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[s]}setGeometryFromSegments(e,t=M){this.transform=f(g,t),this.geometry=e.map(s=>s.createRenderGeometry(t,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return p(this._geometry)?null:this._geometry.map(e=>e.map(t=>k(h(),t,this.transform)))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){this._material.setParameters({color:_(e)})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:n(e)?_(e):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){n(this._material)&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:n(e)?_(e):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get writeDepthEnabled(){return this._material.parameters.writeDepth}set writeDepthEnabled(e){this._material.setParameters({writeDepth:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of F(this.geometry)){const s=H(y(this._material),t);e.addGeometry(s)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(y(this._material))}}const g=C();export{A as a,V as b,N as g,S as n,D as t};
