import{l3 as Kt,dN as ts,ac as M,ad as j,l4 as It,bc as ss,l5 as Ct,l6 as At,af as es,eQ as is,Q as rs,de as Y,cz as I,j5 as x,bm as nt,ks as ns,kw as as,c9 as vt,kr as Rt,kx as Nt,kq as os,kE as cs,ai as ds,kG as ls,kH as us,l7 as gs,kI as hs,l8 as ps,R as tt,I as bs,kO as fs,l9 as $s,la as _s,lb as ms,lc as Os,ld as Ts,al as ws,am as Es,kS as Is,N as Cs,bZ as _,b$ as Pt,r as B,le as As,d7 as ut,ds as vs,ct as c,bn as N,cV as Gt,bw as P,k as at,bD as b,bB as h,cw as Ot,cu as Z,cM as Ft,cx as X,cL as zt,bt as O,k_ as Bt,jR as q,cv as A,n as ot,bC as L,lf as Rs,cB as st,cC as et,c2 as Ns,kn as Lt,cK as St,cD as pt,lg as kt,dB as yt,lh as Mt,cH as Vt,dh as Ps,li as qt,bx as D,cJ as v,lj as Ls,dv as Ss,lk as ft,ll as ks,lm as ys,df as Ms,c_ as Vs,v as V,ln as xs,as as Xt,bl as Us,bo as Yt,lo as $t,dA as xt,lp as Ws,dV as Hs,ak as js}from"./index-cb639cc1.js";import{g as z}from"./persistable-f9157ed8.js";import{n as Ds,g as Gs,a as Fs}from"./LineVisualElement-78cd90ab.js";import{V as zs,i as Zt,e as E,x as Bs,U as qs}from"./manipulatorUtils-628928f4.js";let T=class extends Kt(is){constructor(s){super(s),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(s){return this.heading===s.heading&&this.tilt===s.tilt&&ts(this.position,s.position)&&this.width===s.width&&this.height===s.height}};M([j({readOnly:!0,json:{read:!1,write:!0}})],T.prototype,"type",void 0),M([j({type:ss}),z()],T.prototype,"position",void 0),M([j({type:Number,nonNullable:!0,range:{min:0,max:360}}),z(),It(t=>Ct.normalize(At(t),0,!0))],T.prototype,"heading",void 0),M([j({type:Number,nonNullable:!0,range:{min:0,max:360}}),z(),It(t=>Ct.normalize(At(t),0,!0))],T.prototype,"tilt",void 0),M([j({type:Number,nonNullable:!0}),z()],T.prototype,"width",void 0),M([j({type:Number,nonNullable:!0}),z()],T.prototype,"height",void 0),T=M([es("esri.analysis.SlicePlane")],T);const Xs=T,xe=rs("mac")?"Meta":"Control",Ue="Shift",Ys=2,Zs=1.15,Js=1.15,We=2500,He=.02,Qs=Math.cos(nt(45)),Ut=Math.cos(nt(5)),je=.95,De=.3,Ks=.7,J=I(1,.5,0),Ge=2,te=1,se=Y([...J,Ks]),ee=[0,0,0,.04],ie=Y([...J,.5]),re=x(1,1,1,1),ne=x(1,.8,.6,1),ae=x(1,.93,.86,1),oe=Y([...J,1]),ce=Y([...J,1]),de=3,Jt=11,_t=22.5,rt=40,Wt=48,le=2.25,ue=Y([...J,1]),ge=4,Ht=1,he=.3,pe=6,be=4,jt=1600,fe=.4;function $e(t){const s=new ns;s.extensions.add("GL_OES_standard_derivatives");const{vertex:e,fragment:r,attributes:n,varyings:a}=s;return as(e,t),n.add(vt.POSITION,"vec3"),n.add(vt.UV0,"vec2"),a.add("vUV","vec2"),e.code.add(Rt`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),r.uniforms.add([new Nt("backgroundColor",i=>i.backgroundColor),new Nt("gridColor",i=>i.gridColor),new os("gridWidth",i=>i.gridWidth)]),r.code.add(Rt`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),s}const _e=Object.freeze(Object.defineProperty({__proto__:null,build:$e},Symbol.toStringTag,{value:"Module"}));let me=class extends $s{constructor(){super(...arguments),this.backgroundColor=x(1,0,0,.5),this.gridColor=x(0,1,0,.5),this.gridWidth=4}};class gt extends ls{initializeProgram(s){return new us(s.rctx,gt.shader.get().build(this.configuration),gs)}initializePipeline(){return hs({blending:ps(tt.ONE,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:bs.LESS},colorWrite:fs})}}gt.shader=new cs(_e,()=>ds(()=>import("./SlicePlaneMaterial.glsl-58facc92.js"),["assets/SlicePlaneMaterial.glsl-58facc92.js","assets/index-cb639cc1.js","assets/index-ec7d25bd.css","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/LineVisualElement-78cd90ab.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js"]));class Oe extends _s{constructor(s){super(s,new we),this._configuration=new ms}createBufferWriter(){return new Os(Ts)}requiresSlot(s,e){return e===ws.Color&&s===Es.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(s){return new Te(s)}getConfiguration(){return this._configuration}}class Te extends Is{constructor(s){super(s),this.ensureTechnique(gt,null)}beginSlot(){return Cs(this.technique)}}class we extends me{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class Ee extends Ds{constructor(s){super(s),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=x(1,0,0,1),this._backgroundColor=x(1,0,0,1),this.applyProps(s)}get renderOccluded(){return this._renderOccluded}set renderOccluded(s){s!==this._renderOccluded&&(this._renderOccluded=s,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(s){this._gridWidth!==s&&(this._gridWidth=s,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(s){Pt(this._gridColor,s),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(s){Pt(this._backgroundColor,s),this._updateMaterial()}createExternalResources(){this._material=new Oe(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(s){B(this._material)&&s(this._material)}createGeometries(s){if(B(this._material)){const e=As(this._material);s.addGeometry(e)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){B(this._material)&&this._material.setParameters(this._materialParameters)}}function ze(t,s,e,r,n,a,i,o){return Ie(s,i.worldUpAtPosition(t,c.get()),n,a,o.basis1,o.basis2),h(o.basis1,o.basis1,e),h(o.basis2,o.basis2,r),N(o.origin,t),qt(o.basis2,o.basis1,o.origin,o.plane),o}function Ie(t,s,e,r,n,a){const i=D(t,s),o=c.get(),d=c.get();switch(r===R.HORIZONTAL_OR_VERTICAL?Math.abs(i)>Qs?R.HORIZONTAL:R.VERTICAL:r){case R.VERTICAL:{const l=Math.abs(i)<=Ut?t:e.viewUp;v(o,l,s),N(d,s);break}case R.HORIZONTAL:v(o,e.viewUp,s),v(d,s,o);break;case R.TILTED:{const l=Math.abs(i)<=Ut?s:e.viewUp;v(o,l,t),v(d,t,o);break}}const g=v(c.get(),o,d);D(g,e.viewForward)>0&&h(d,d,-1),L(n,o),L(a,d)}function Ce(t,s,e){const r=s.worldUpAtPosition(t.origin,c.get()),n=t.basis1,a=Et(t,r),i=Math.round(a/G)*G;return $t(t,i-a,n,e)}function Be(t,s,e,r,n,a){const i=N(c.get(),n.origin);b(i,i,h(c.get(),n.basis1,t.direction[0]<0?1:-1)),b(i,i,h(c.get(),n.basis2,t.direction[1]<0?1:-1));const o=P(n.basis1),d=P(n.basis2),g=O(c.get(),e,i),l=O(c.get(),s,i);let u=0,p=0;if(wt(t)){const Q=mt(n),k=mt(a);u=o-.5*t.direction[0]*D(n.basis1,l)/o,p=d-.5*t.direction[1]*D(n.basis2,l)/d;const W=k/Q;u*=W,p*=W}const m=u+.5*t.direction[0]*D(n.basis1,g)/o,$=p+.5*t.direction[1]*D(n.basis2,g)/d,U=h(c.get(),n.basis1,m/o),S=h(c.get(),n.basis2,$/d);(m<=0||Dt(a.origin,U,r)<=jt)&&N(U,a.basis1),($<=0||Dt(a.origin,S,r)<=jt)&&N(S,a.basis2);const f=N(c.get(),i);return b(f,f,h(c.get(),U,t.direction[0]<0?-1:1)),b(f,f,h(c.get(),S,t.direction[1]<0?-1:1)),Ls(f,U,S,a)}function qe(t,s){return fe*Math.min(s.width,s.height)*s.computeRenderPixelSizeAt(t)}function Xe(t,s,e,r){const n=v(c.get(),s,e);return v(n,n,s),Gt(t,n,r)}function Ye(t,s){return zs(t.basis1,t.basis2,t.origin,s)}function Ze(t,s,e,r){const n=s.worldUpAtPosition(t.origin,c.get()),a=c.get();switch(e){case ct.HEADING:N(a,n);break;case ct.TILT:N(a,t.basis1)}return Gt(t.origin,a,r)}function Je(t,s,e,r){const n=Tt(e,C.NEGATIVE_X),a=Z.get();Ss(a,s,n.edge*Math.PI/2);const i=L(c.get(),n.basis);let o=h(c.get(),i,n.direction*r.computeScreenPixelSizeAt(n.position)*rt);b(o,o,n.position);const d=r.projectToRenderScreen(o,ft(c.get())),g=Ae(r,d);ks(r,d,it),L(it.direction,it.direction);const l=c.get();!g&&ys(e,it,l)&&(o=l),a[12]=0,a[13]=0,a[14]=0,t.modelTransform=a,t.renderLocation=Ms(o),g?t.state|=dt:t.state&=~dt}function Ae(t,s){const[e,r,n,a]=t.viewport,i=Math.min(n,a)/16;let o=!0;return s[0]<e+i?(s[0]=e+i,o=!1):s[0]>e+n-i&&(s[0]=e+n-i,o=!1),s[1]<r+i?(s[1]=r+i,o=!1):s[1]>r+a-i&&(s[1]=r+a-i,o=!1),o}function Qe(t,s,e,r){const n=P(r.basis1),a=P(r.basis2),i=Qt(r),o=mt(r),d=at(c.get(),0,0,0);b(d,h(c.get(),r.basis1,s.direction[0]),h(c.get(),r.basis2,s.direction[1])),b(d,r.origin,d);let g=0,l=1;if(wt(s))s.direction[0]===1&&s.direction[1]===-1?g=G:s.direction[0]===1&&s.direction[1]===1?g=Math.PI:s.direction[0]===-1&&s.direction[1]===1&&(g=3*Math.PI/2),l=o;else{const p=s.direction[0]!==0?1:2;g=p===1?G:0,l=(p===1?a:n)-i}const u=Ot(Z.get(),g);Ft(u,u,at(c.get(),l,l,l)),X(u,e,u),u[12]=0,u[13]=0,u[14]=0,t.modelTransform=u,t.renderLocation=d}function Ke(t,s,e,r){const n=r.worldUpAtPosition(e.origin,c.get()),a=Tt(e,C.POSITIVE_X),i=Ot(Z.get(),a.edge*Math.PI/2);zt(i,i,-Et(e,n)),X(i,s,i),i[12]=0,i[13]=0,i[14]=0,t.modelTransform=i,t.renderLocation=a.position}function ti(t,s,e){const r=Tt(e,C.POSITIVE_Y),n=Ot(Z.get(),r.edge*Math.PI/2);zt(n,n,G),X(n,s,n),n[12]=0,n[13]=0,n[14]=0,t.modelTransform=n,t.renderLocation=r.position}var C;function Tt(t,s){switch(s){case C.POSITIVE_X:return{basis:t.basis1,direction:1,position:b(c.get(),t.origin,t.basis1),edge:s};case C.POSITIVE_Y:return{basis:t.basis2,direction:1,position:b(c.get(),t.origin,t.basis2),edge:s};case C.NEGATIVE_X:return{basis:t.basis1,direction:-1,position:O(c.get(),t.origin,t.basis1),edge:s};case C.NEGATIVE_Y:return{basis:t.basis2,direction:-1,position:O(c.get(),t.origin,t.basis2),edge:s}}}function Dt(t,s,e){const r=e.projectToRenderScreen(b(c.get(),t,s),ft(c.get())),n=e.projectToRenderScreen(O(c.get(),t,s),ft(c.get()));return Vs(O(r,r,n))}function Qt(t){const s=P(t.basis1),e=P(t.basis2);return he*Math.min(s,e)}function mt(t){return Qt(t)}function wt(t){return t.direction[0]!==0&&t.direction[1]!==0}function si(t,s=lt.CENTER_ON_ARROW){const e=s===lt.CENTER_ON_CALLOUT?rt:0,r=[I(e,0,-Wt/2),I(e,0,Wt/2)],n=Ne(r,!0),a=(u,p)=>ve(r,u,p),i=a(0,!1),o=a(le,!0),d=new Bt({color:oe,renderOccluded:_.OccludeAndTransparent}),g=q(d,[[e,0,0],[e-rt,0,0]]),l=q(d,[[e,0,0],[e-rt,0,0]]);return new Zt({view:t,renderObjects:[...i.normal.map(u=>new E(u,A.Unfocused|w)),...o.normal.map(u=>new E(u,A.Unfocused|w)),new E(g,A.Unfocused|w|dt),...i.focused.map(u=>new E(u,A.Focused|w)),...o.focused.map(u=>new E(u,A.Focused|w)),new E(l,A.Focused|w|dt)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Jt,state:w})}function ei(t,s){const e=qs(t,{customStateMask:w,texture:s});return e.state=w,e}function ii(t){const s=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Gs({view:t,attached:!1,color:se,width:te,writeDepthEnabled:!1,renderOccluded:_.OccludeAndTransparent,geometry:[s]})}function ri(t){return new Ee({view:t,attached:!1,backgroundColor:[...ee],gridColor:ie,gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function ni(t,s){const e=wt(s),r=e?[I(1,0,0),I(0,0,0),I(0,1,0)]:[I(1,0,0),I(-1,0,0)],n=ue,a=m=>new Ns({color:n,width:m,renderOccluded:_.OccludeAndTransparent}),i=()=>new Bt({color:n,renderOccluded:_.OccludeAndTransparent}),o=e?ge:Ht,d=o*Ys,g=Ht,l=m=>m>1?a(m):i(),u=[new E(q(l(o),r),A.Unfocused|bt),new E(q(l(d),r),A.Focused|bt),new E(q(l(g),r),Le)],p=new Zt({view:t,renderObjects:u,collisionType:{type:"line",paths:[r]},radius:e?pe:be,...Bs});return p.state=bt,p}function ve(t,s,e){const r=new st({color:re,cullFace:et.Back,renderOccluded:_.Opaque}),n=new st({color:ne,cullFace:et.Back,renderOccluded:_.Opaque}),a=new st({color:ae,cullFace:et.Back,renderOccluded:_.Opaque}),i=new st({color:ce,transparent:!0,writeDepth:!1,cullFace:et.Front,renderOccluded:_.Transparent}),o=d=>{t=t.slice(0);const g=O(c.get(),t[0],t[1]);L(g,g);const l=O(c.get(),t[t.length-1],t[t.length-2]);if(L(l,l),s>0){const F=h(ot(),l,-s);t[t.length-1]=b(F,F,t[t.length-1]);const H=h(ot(),g,-s);t[0]=b(H,H,t[0])}const u=d?Js:1,p=_t*u,m=Jt*u,$=Lt(Z.get());if(s>0){const F=p/4,H=at(c.get(),0,F,0),K=1+s/F;St($,$,H),Ft($,$,at(c.get(),K,K,K)),St($,$,h(H,H,-1/K))}const U=Lt(pt()),S=I(0,1,0),f=kt(pt(),yt(Mt.get(),S,l));f[12]=t[t.length-1][0],f[13]=t[t.length-1][1],f[14]=t[t.length-1][2],X(f,f,$);const Q=Re(de*(d?Zs:1)+s,t,e?i:a);Q.transformation=U;const k=[Q],W=Vt(e?i:r,p,m,24,!1,!1,!0);W.transformation=f,k.push(W);const ht=Vt(e?i:n,p,m,24,!1,!0,!1);ht.transformation=f,k.push(ht);const y=kt(pt(),yt(Mt.get(),S,g));return y[12]=t[0][0],y[13]=t[0][1],y[14]=t[0][2],X(y,y,$),k.push(W.instantiate({transformation:y})),k.push(ht.instantiate({transformation:y})),k};return{normal:o(!1),focused:o(!0)}}function Re(t,s,e){const r=[];for(let a=0;a<12;a++){const i=a/12*2*Math.PI;r.push([Math.cos(i)*t,Math.sin(i)*t])}return Ps(e,r,s,[],[],!1)}function Ne(t,s){const e=O(ot(),t[t.length-1],t[t.length-2]);if(L(e,e),h(e,e,_t),b(e,e,t[t.length-1]),s){const r=O(ot(),t[0],t[1]);return L(r,r),h(r,r,_t),b(r,r,t[0]),[r,...t,e]}return[...t,e]}function ai(t,s,e,r=new Xs){if(V(t))return null;const{renderCoordsHelper:n}=s,a=n.fromRenderCoords(t.origin,s.spatialReference);if(V(a))return null;const i=xs(a,e);if(V(i))return null;r.position=i;const o=2*P(t.basis1),d=2*P(t.basis2),g=Xt.renderUnitScaleFactor(s.spatialReference,e);r.width=o*g,r.height=d*g;const l=n.worldUpAtPosition(t.origin,c.get());return r.tilt=Us(Et(t,l)),r.heading=n.headingAtPosition(t.origin,t.basis1)-90,r}function Et(t,s){return Rs(s,t.basis2,t.basis1)+G}function Pe(t,s,e,r,n,a,i=Yt()){return a.toRenderCoords(t,i.origin)?(a.worldBasisAtPosition(i.origin,xt.X,i.basis1),a.worldBasisAtPosition(i.origin,xt.Y,i.basis2),qt(i.basis2,i.basis1,i.origin,i.plane),$t(i,-nt(s),Ws(i),i),$t(i,nt(e),i.basis1,i),h(i.basis1,i.basis1,r/2),h(i.basis2,i.basis2,n/2),Hs(i),i):(js.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${t.spatialReference.wkid} is not supported`),null)}function oi(t,s){if(V(t)||V(t.position))return null;const e=Fs(t.position,s.spatialReference,s.elevationProvider);if(V(e))return null;const r=Xt.renderUnitScaleFactor(t.position.spatialReference,s.spatialReference),n=t.width*r,a=t.height*r;return{position:e,heading:t.heading,tilt:t.tilt,renderWidth:n,renderHeight:a}}function ci(t,s,e,r=Yt()){if(V(t))return null;const n=Pe(t.position,t.heading,t.tilt,t.renderWidth,t.renderHeight,s.renderCoordsHelper,r);return!e.tiltEnabled&&B(n)&&Ce(n,s.renderCoordsHelper,n),n}(function(t){t[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y"})(C||(C={}));const w=ut.Custom1;var ct,R;(function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"})(ct||(ct={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(R||(R={}));const dt=ut.Custom2,it=vs(),G=Math.PI/2,bt=ut.Custom1,Le=ut.Custom2;var lt;function di(t){const s=t.type==="building-scene-3d"?t:null;return B(s)}(function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(lt||(lt={}));export{Ye as B,Le as C,w as E,ze as G,ct as I,Qe as J,Ke as K,De as M,lt as N,ci as O,di as P,ti as Q,R,oi as T,Xe as W,Be as Y,qe as Z,bt as _,ei as a,Ge as b,ii as c,xe as d,We as e,se as f,ai as g,Xs as h,He as i,dt as j,ie as k,ri as l,Ue as m,je as n,mt as o,Ze as q,wt as r,si as s,$e as t,ni as u,te as v,ee as x,Je as z};
