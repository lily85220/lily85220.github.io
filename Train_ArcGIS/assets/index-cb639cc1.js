(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function Bke(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var M2=1,A2=2,UM=3,Gke=4,oq=5,uae=6378137,jke=6356752314e-3,hae=.0066943799901413165,mI=484813681109536e-20,Ke=Math.PI/2,Hke=.16666666666666666,qke=.04722222222222222,Wke=.022156084656084655,bt=1e-10,Ml=.017453292519943295,Qg=57.29577951308232,Ms=Math.PI/4,d$=Math.PI*2,No=3.14159265359,mh={};mh.greenwich=0;mh.lisbon=-9.131906111111;mh.paris=2.337229166667;mh.bogota=-74.080916666667;mh.madrid=-3.687938888889;mh.rome=12.452333333333;mh.bern=7.439583333333;mh.jakarta=106.807719444444;mh.ferro=-17.666666666667;mh.brussels=4.367975;mh.stockholm=18.058277777778;mh.athens=23.7163375;mh.oslo=10.722916666667;const Yke={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var dae=/[\s_\-\/\(\)]/g;function kb(t,e){if(t[e])return t[e];for(var i=Object.keys(t),r=e.toLowerCase().replace(dae,""),s=-1,n,o;++s<i.length;)if(n=i[s],o=n.toLowerCase().replace(dae,""),o===r)return t[n]}function aq(t){var e={},i=t.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var c=l.split("=");return c.push(!0),a[c[0].toLowerCase()]=c[1],a},{}),r,s,n,o={proj:"projName",datum:"datumCode",rf:function(a){e.rf=parseFloat(a)},lat_0:function(a){e.lat0=a*Ml},lat_1:function(a){e.lat1=a*Ml},lat_2:function(a){e.lat2=a*Ml},lat_ts:function(a){e.lat_ts=a*Ml},lon_0:function(a){e.long0=a*Ml},lon_1:function(a){e.long1=a*Ml},lon_2:function(a){e.long2=a*Ml},alpha:function(a){e.alpha=parseFloat(a)*Ml},gamma:function(a){e.rectified_grid_angle=parseFloat(a)},lonc:function(a){e.longc=a*Ml},x_0:function(a){e.x0=parseFloat(a)},y_0:function(a){e.y0=parseFloat(a)},k_0:function(a){e.k0=parseFloat(a)},k:function(a){e.k0=parseFloat(a)},a:function(a){e.a=parseFloat(a)},b:function(a){e.b=parseFloat(a)},r_a:function(){e.R_A=!0},zone:function(a){e.zone=parseInt(a,10)},south:function(){e.utmSouth=!0},towgs84:function(a){e.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){e.to_meter=parseFloat(a)},units:function(a){e.units=a;var l=kb(Yke,a);l&&(e.to_meter=l.to_meter)},from_greenwich:function(a){e.from_greenwich=a*Ml},pm:function(a){var l=kb(mh,a);e.from_greenwich=(l||parseFloat(a))*Ml},nadgrids:function(a){a==="@null"?e.datumCode="none":e.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(e.axis=a)},approx:function(){e.approx=!0}};for(r in i)s=i[r],r in o?(n=o[r],typeof n=="function"?n(s):e[n]=s):e[r]=s;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var p$=1,o1e=2,a1e=3,U8=4,l1e=5,JQ=-1,Xke=/\s/,Zke=/[A-Za-z]/,Jke=/[A-Za-z84_]/,Tk=/[,\]]/,c1e=/[\d\.E\-\+]/;function J_(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=p$}J_.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==U8)for(;Xke.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case p$:return this.neutral(t);case o1e:return this.keyword(t);case U8:return this.quoted(t);case l1e:return this.afterquote(t);case a1e:return this.number(t);case JQ:return}};J_.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=U8;return}if(Tk.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};J_.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=p$;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=p$,this.currentObject=this.stack.pop(),this.currentObject||(this.state=JQ);return}};J_.prototype.number=function(t){if(c1e.test(t)){this.word+=t;return}if(Tk.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};J_.prototype.quoted=function(t){if(t==='"'){this.state=l1e;return}this.word+=t};J_.prototype.keyword=function(t){if(Jke.test(t)){this.word+=t;return}if(t==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=p$;return}if(Tk.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};J_.prototype.neutral=function(t){if(Zke.test(t)){this.word=t,this.state=o1e;return}if(t==='"'){this.word="",this.state=U8;return}if(c1e.test(t)){this.word=t,this.state=a1e;return}if(Tk.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};J_.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===JQ)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Kke(t){var e=new J_(t);return e.output()}function pae(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var r=e?{}:t,s=i.reduce(function(n,o){return cM(o,n),n},r);e&&(t[e]=s)}function cM(t,e){if(!Array.isArray(t)){e[t]=!0;return}var i=t.shift();if(i==="PARAMETER"&&(i=t.shift()),t.length===1){if(Array.isArray(t[0])){e[i]={},cM(t[0],e[i]);return}e[i]=t[0];return}if(!t.length){e[i]=!0;return}if(i==="TOWGS84"){e[i]=t;return}if(i==="AXIS"){i in e||(e[i]=[]),e[i].push(t);return}Array.isArray(i)||(e[i]={});var r;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[i]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&cM(t[2],e[i]);return;case"SPHEROID":case"ELLIPSOID":e[i]={name:t[0],a:t[1],rf:t[2]},t.length===4&&cM(t[3],e[i]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],pae(e,i,t);return;default:for(r=-1;++r<t.length;)if(!Array.isArray(t[r]))return cM(t,e[i]);return pae(e,i,t)}}var Qke=.017453292519943295;function eVe(t,e){var i=e[0],r=e[1];!(i in t)&&r in t&&(t[i]=t[r],e.length===3&&(t[i]=e[2](t[i])))}function Xy(t){return t*Qke}function tVe(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,r=t.AXIS.length;i<r;++i){var s=[t.AXIS[i][0].toLowerCase(),t.AXIS[i][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var n=t.GEOGCS;t.type==="GEOGCS"&&(n=t),n&&(n.DATUM?t.datumCode=n.DATUM.name.toLowerCase():t.datumCode=n.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(t.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=n.DATUM.SPHEROID.a,t.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(t.datum_params=n.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function o(c){var h=t.to_meter||1;return c*h}var a=function(c){return eVe(t,c)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Xy],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Xy],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Xy],["lat0","latitude_of_origin",Xy],["lat0","standard_parallel_1",Xy],["lat1","standard_parallel_1",Xy],["lat2","standard_parallel_2",Xy],["azimuth","Azimuth"],["alpha","azimuth",Xy],["srsCode","name"]];l.forEach(a),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")&&(t.lat0=Xy(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function u1e(t){var e=Kke(t),i=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",i]);var s={};return cM(e,s),tVe(s),s}function Jc(t){var e=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?Jc[t]=aq(arguments[1]):Jc[t]=u1e(arguments[1]):Jc[t]=i}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(r){Array.isArray(r)?Jc.apply(e,r):Jc(r)});if(typeof t=="string"){if(t in Jc)return Jc[t]}else"EPSG"in t?Jc["EPSG:"+t.EPSG]=t:"ESRI"in t?Jc["ESRI:"+t.ESRI]=t:"IAU2000"in t?Jc["IAU2000:"+t.IAU2000]=t:console.log(t);return}}Bke(Jc);function iVe(t){return typeof t=="string"}function rVe(t){return t in Jc}var sVe=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function nVe(t){return sVe.some(function(e){return t.indexOf(e)>-1})}var oVe=["3857","900913","3785","102113"];function aVe(t){var e=kb(t,"authority");if(e){var i=kb(e,"epsg");return i&&oVe.indexOf(i)>-1}}function lVe(t){var e=kb(t,"extension");if(e)return kb(e,"proj4")}function cVe(t){return t[0]==="+"}function uVe(t){if(iVe(t)){if(rVe(t))return Jc[t];if(nVe(t)){var e=u1e(t);if(aVe(e))return Jc["EPSG:3857"];var i=lVe(e);return i?aq(i):e}if(cVe(t))return aq(t)}else return t}function fae(t,e){t=t||{};var i,r;if(!e)return t;for(r in e)i=e[r],i!==void 0&&(t[r]=i);return t}function by(t,e,i){var r=t*e;return i/Math.sqrt(1-r*r)}function RL(t){return t<0?-1:1}function Pt(t){return Math.abs(t)<=No?t:t-RL(t)*d$}function pm(t,e,i){var r=t*i,s=.5*t;return r=Math.pow((1-r)/(1+r),s),Math.tan(.5*(Ke-e))/r}function f$(t,e){for(var i=.5*t,r,s,n=Ke-2*Math.atan(e),o=0;o<=15;o++)if(r=t*Math.sin(n),s=Ke-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-n,n+=s,Math.abs(s)<=1e-10)return n;return-9999}function hVe(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=by(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function dVe(t){var e=t.x,i=t.y;if(i*Qg>90&&i*Qg<-90&&e*Qg>180&&e*Qg<-180)return null;var r,s;if(Math.abs(Math.abs(i)-Ke)<=bt)return null;if(this.sphere)r=this.x0+this.a*this.k0*Pt(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(Ms+.5*i));else{var n=Math.sin(i),o=pm(this.e,i,n);r=this.x0+this.a*this.k0*Pt(e-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return t.x=r,t.y=s,t}function pVe(t){var e=t.x-this.x0,i=t.y-this.y0,r,s;if(this.sphere)s=Ke-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var n=Math.exp(-i/(this.a*this.k0));if(s=f$(this.e,n),s===-9999)return null}return r=Pt(this.long0+e/(this.a*this.k0)),t.x=r,t.y=s,t}var fVe=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const mVe={init:hVe,forward:dVe,inverse:pVe,names:fVe};function gVe(){}function mae(t){return t}var yVe=["longlat","identity"];const _Ve={init:gVe,forward:mae,inverse:mae,names:yVe};var vVe=[mVe,_Ve],w5={},k8=[];function h1e(t,e){var i=k8.length;return t.names?(k8[i]=t,t.names.forEach(function(r){w5[r.toLowerCase()]=i}),this):(console.log(e),!0)}function bVe(t){if(!t)return!1;var e=t.toLowerCase();if(typeof w5[e]<"u"&&k8[w5[e]])return k8[w5[e]]}function wVe(){vVe.forEach(h1e)}const xVe={start:wVe,add:h1e,get:bVe};var Bi={};Bi.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};Bi.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};Bi.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};Bi.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};Bi.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};Bi.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};Bi.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};Bi.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};Bi.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};Bi.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};Bi.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};Bi.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};Bi.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};Bi.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};Bi.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};Bi.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};Bi.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};Bi.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};Bi.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};Bi.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};Bi.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};Bi.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};Bi.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};Bi.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};Bi.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};Bi.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};Bi.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};Bi.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};Bi.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};Bi.hough={a:6378270,rf:297,ellipseName:"Hough"};Bi.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};Bi.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};Bi.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};Bi.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};Bi.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};Bi.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};Bi.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};Bi.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};Bi.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};Bi.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};Bi.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};Bi.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var TVe=Bi.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Bi.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function SVe(t,e,i,r){var s=t*t,n=e*e,o=(s-n)/s,a=0;r?(t*=1-o*(Hke+o*(qke+o*Wke)),s=t*t,o=0):a=Math.sqrt(o);var l=(s-n)/n;return{es:o,e:a,ep2:l}}function EVe(t,e,i,r,s){if(!t){var n=kb(Bi,r);n||(n=TVe),t=n.a,e=n.b,i=n.rf}return i&&!e&&(e=(1-1/i)*t),(i===0||Math.abs(t-e)<bt)&&(s=!0,e=t),{a:t,b:e,rf:i,sphere:s}}var cl={};cl.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};cl.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};cl.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};cl.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};cl.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};cl.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};cl.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};cl.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};cl.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};cl.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};cl.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};cl.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};cl.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};cl.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};cl.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};cl.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};cl.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function CVe(t,e,i,r,s,n,o){var a={};return t===void 0||t==="none"?a.datum_type=oq:a.datum_type=Gke,e&&(a.datum_params=e.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=M2),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=A2,a.datum_params[3]*=mI,a.datum_params[4]*=mI,a.datum_params[5]*=mI,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=UM,a.grids=o),a.a=i,a.b=r,a.es=s,a.ep2=n,a}var d1e={};function MVe(t,e){var i=new DataView(e),r=RVe(i),s=PVe(i,r);s.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var n=IVe(i,s,r),o={header:s,subgrids:n};return d1e[t]=o,o}function AVe(t){if(t===void 0)return null;var e=t.split(",");return e.map(OVe)}function OVe(t){if(t.length===0)return null;var e=t[0]==="@";return e&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:d1e[t]||null,isNull:!1}}function uM(t){return t/3600*Math.PI/180}function RVe(t){var e=t.getInt32(8,!1);return e===11?!1:(e=t.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function PVe(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:lq(t,56,56+8).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}function lq(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,i)))}function IVe(t,e,i){for(var r=176,s=[],n=0;n<e.nSubgrids;n++){var o=LVe(t,r,i),a=DVe(t,r,o,i),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),c=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[uM(o.lowerLongitude),uM(o.lowerLatitude)],del:[uM(o.longitudeInterval),uM(o.latitudeInterval)],lim:[l,c],count:o.gridNodeCount,cvs:$Ve(a)})}return s}function $Ve(t){return t.map(function(e){return[uM(e.longitudeShift),uM(e.latitudeShift)]})}function LVe(t,e,i){return{name:lq(t,e+8,e+16).trim(),parent:lq(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,i),upperLatitude:t.getFloat64(e+88,i),lowerLongitude:t.getFloat64(e+104,i),upperLongitude:t.getFloat64(e+120,i),latitudeInterval:t.getFloat64(e+136,i),longitudeInterval:t.getFloat64(e+152,i),gridNodeCount:t.getInt32(e+168,i)}}function DVe(t,e,i,r){for(var s=e+176,n=16,o=[],a=0;a<i.gridNodeCount;a++){var l={latitudeShift:t.getFloat32(s+a*n,r),longitudeShift:t.getFloat32(s+a*n+4,r),latitudeAccuracy:t.getFloat32(s+a*n+8,r),longitudeAccuracy:t.getFloat32(s+a*n+12,r)};o.push(l)}return o}function ay(t,e){if(!(this instanceof ay))return new ay(t);e=e||function(c){if(c)throw c};var i=uVe(t);if(typeof i!="object"){e(t);return}var r=ay.projections.get(i.projName);if(!r){e(t);return}if(i.datumCode&&i.datumCode!=="none"){var s=kb(cl,i.datumCode);s&&(i.datum_params=i.datum_params||(s.towgs84?s.towgs84.split(","):null),i.ellps=s.ellipse,i.datumName=s.datumName?s.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var n=EVe(i.a,i.b,i.rf,i.ellps,i.sphere),o=SVe(n.a,n.b,n.rf,i.R_A),a=AVe(i.nadgrids),l=i.datum||CVe(i.datumCode,i.datum_params,n.a,n.b,o.es,o.ep2,a);fae(this,i),fae(this,r),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),e(null,this)}ay.projections=xVe;ay.projections.start();function NVe(t,e){return t.datum_type!==e.datum_type||t.a!==e.a||Math.abs(t.es-e.es)>5e-11?!1:t.datum_type===M2?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type===A2?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]:!0}function p1e(t,e,i){var r=t.x,s=t.y,n=t.z?t.z:0,o,a,l,c;if(s<-Ke&&s>-1.001*Ke)s=-Ke;else if(s>Ke&&s<1.001*Ke)s=Ke;else{if(s<-Ke)return{x:-1/0,y:-1/0,z:t.z};if(s>Ke)return{x:1/0,y:1/0,z:t.z}}return r>Math.PI&&(r-=2*Math.PI),a=Math.sin(s),c=Math.cos(s),l=a*a,o=i/Math.sqrt(1-e*l),{x:(o+n)*c*Math.cos(r),y:(o+n)*c*Math.sin(r),z:(o*(1-e)+n)*a}}function f1e(t,e,i,r){var s=1e-12,n=s*s,o=30,a,l,c,h,d,f,m,g,y,v,x,S,E,C=t.x,R=t.y,O=t.z?t.z:0,U,L,B;if(a=Math.sqrt(C*C+R*R),l=Math.sqrt(C*C+R*R+O*O),a/i<s){if(U=0,l/i<s)return L=Ke,B=-r,{x:t.x,y:t.y,z:t.z}}else U=Math.atan2(R,C);c=O/l,h=a/l,d=1/Math.sqrt(1-e*(2-e)*h*h),g=h*(1-e)*d,y=c*d,E=0;do E++,m=i/Math.sqrt(1-e*y*y),B=a*g+O*y-m*(1-e*y*y),f=e*m/(m+B),d=1/Math.sqrt(1-f*(2-f)*h*h),v=h*(1-f)*d,x=c*d,S=x*g-v*y,g=v,y=x;while(S*S>n&&E<o);return L=Math.atan(x/Math.abs(v)),{x:U,y:L,z:B}}function FVe(t,e,i){if(e===M2)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===A2){var r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],c=i[6];return{x:c*(t.x-l*t.y+a*t.z)+r,y:c*(l*t.x+t.y-o*t.z)+s,z:c*(-a*t.x+o*t.y+t.z)+n}}}function UVe(t,e,i){if(e===M2)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===A2){var r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=(t.x-r)/c,d=(t.y-s)/c,f=(t.z-n)/c;return{x:h+l*d-a*f,y:-l*h+d+o*f,z:a*h-o*d+f}}}function aN(t){return t===M2||t===A2}function kVe(t,e,i){if(NVe(t,e)||t.datum_type===oq||e.datum_type===oq)return i;var r=t.a,s=t.es;if(t.datum_type===UM){var n=gae(t,!1,i);if(n!==0)return;r=uae,s=hae}var o=e.a,a=e.b,l=e.es;if(e.datum_type===UM&&(o=uae,a=jke,l=hae),s===l&&r===o&&!aN(t.datum_type)&&!aN(e.datum_type))return i;if(i=p1e(i,s,r),aN(t.datum_type)&&(i=FVe(i,t.datum_type,t.datum_params)),aN(e.datum_type)&&(i=UVe(i,e.datum_type,e.datum_params)),i=f1e(i,l,o,a),e.datum_type===UM){var c=gae(e,!0,i);if(c!==0)return}return i}function gae(t,e,i){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var r={x:-i.x,y:i.y},s={x:Number.NaN,y:Number.NaN},n=[],o=0;o<t.grids.length;o++){var a=t.grids[o];if(n.push(a.name),a.isNull){s=r;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}var l=a.grid.subgrids[0],c=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,h=l.ll[0]-c,d=l.ll[1]-c,f=l.ll[0]+(l.lim[0]-1)*l.del[0]+c,m=l.ll[1]+(l.lim[1]-1)*l.del[1]+c;if(!(d>r.y||h>r.x||m<r.y||f<r.x)&&(s=VVe(r,e,l),!isNaN(s.x)))break}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*Qg+" "+r.y*Qg+" tried: '"+n+"'"),-1):(i.x=-s.x,i.y=s.y,0)}function VVe(t,e,i){var r={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return r;var s={x:t.x,y:t.y};s.x-=i.ll[0],s.y-=i.ll[1],s.x=Pt(s.x-Math.PI)+Math.PI;var n=yae(s,i);if(e){if(isNaN(n.x))return r;n.x=s.x-n.x,n.y=s.y-n.y;var o=9,a=1e-12,l,c;do{if(c=yae(n,i),isNaN(c.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(c.x+n.x),y:s.y-(c.y+n.y)},n.x+=l.x,n.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=Pt(n.x+i.ll[0]),r.y=n.y+i.ll[1]}else isNaN(n.x)||(r.x=t.x+n.x,r.y=t.y+n.y);return r}function yae(t,e){var i={x:t.x/e.del[0],y:t.y/e.del[1]},r={x:Math.floor(i.x),y:Math.floor(i.y)},s={x:i.x-1*r.x,y:i.y-1*r.y},n={x:Number.NaN,y:Number.NaN},o;if(r.x<0||r.x>=e.lim[0]||r.y<0||r.y>=e.lim[1])return n;o=r.y*e.lim[0]+r.x;var a={x:e.cvs[o][0],y:e.cvs[o][1]};o++;var l={x:e.cvs[o][0],y:e.cvs[o][1]};o+=e.lim[0];var c={x:e.cvs[o][0],y:e.cvs[o][1]};o--;var h={x:e.cvs[o][0],y:e.cvs[o][1]},d=s.x*s.y,f=s.x*(1-s.y),m=(1-s.x)*(1-s.y),g=(1-s.x)*s.y;return n.x=m*a.x+f*l.x+g*h.x+d*c.x,n.y=m*a.y+f*l.y+g*h.y+d*c.y,n}function _ae(t,e,i){var r=i.x,s=i.y,n=i.z||0,o,a,l,c={};for(l=0;l<3;l++)if(!(e&&l===2&&i.z===void 0))switch(l===0?(o=r,"ew".indexOf(t.axis[l])!==-1?a="x":a="y"):l===1?(o=s,"ns".indexOf(t.axis[l])!==-1?a="y":a="x"):(o=n,a="z"),t.axis[l]){case"e":c[a]=o;break;case"w":c[a]=-o;break;case"n":c[a]=o;break;case"s":c[a]=-o;break;case"u":i[a]!==void 0&&(c.z=o);break;case"d":i[a]!==void 0&&(c.z=-o);break;default:return null}return c}function m1e(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function zVe(t){vae(t.x),vae(t.y)}function vae(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function BVe(t,e){return(t.datum.datum_type===M2||t.datum.datum_type===A2||t.datum.datum_type===UM)&&e.datumCode!=="WGS84"||(e.datum.datum_type===M2||e.datum.datum_type===A2||e.datum.datum_type===UM)&&t.datumCode!=="WGS84"}function V8(t,e,i,r){var s;Array.isArray(i)?i=m1e(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var n=i.z!==void 0;if(zVe(i),t.datum&&e.datum&&BVe(t,e)&&(s=new ay("WGS84"),i=V8(t,s,i,r),t=s),r&&t.axis!=="enu"&&(i=_ae(t,!1,i)),t.projName==="longlat")i={x:i.x*Ml,y:i.y*Ml,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),i=t.inverse(i),!i)return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=kVe(t.datum,e.datum,i),!!i)return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),e.projName==="longlat"?i={x:i.x*Qg,y:i.y*Qg,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),r&&e.axis!=="enu"?_ae(e,!0,i):(n||delete i.z,i)}var bae=ay("WGS84");function CB(t,e,i,r){var s,n,o;return Array.isArray(i)?(s=V8(t,e,i,r)||{x:NaN,y:NaN},i.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(i.splice(3)):[s.x,s.y,i[2]].concat(i.splice(3)):[s.x,s.y].concat(i.splice(2)):[s.x,s.y]):(n=V8(t,e,i,r),o=Object.keys(i),o.length===2||o.forEach(function(a){if(typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;n[a]=i[a]}),n)}function wae(t){return t instanceof ay?t:t.oProj?t.oProj:ay(t)}function ch(t,e,i){t=wae(t);var r=!1,s;return typeof e>"u"?(e=t,t=bae,r=!0):(typeof e.x<"u"||Array.isArray(e))&&(i=e,e=t,t=bae,r=!0),e=wae(e),i?CB(t,e,i):(s={forward:function(n,o){return CB(t,e,n,o)},inverse:function(n,o){return CB(e,t,n,o)}},r&&(s.oProj=e),s)}var xae=6,g1e="AJSAJS",y1e="AFAFAF",hM=65,Fu=73,rp=79,DR=86,NR=90;const GVe={forward:_1e,inverse:jVe,toPoint:v1e};function _1e(t,e){return e=e||5,WVe(HVe({lat:t[1],lon:t[0]}),e)}function jVe(t){var e=KQ(w1e(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function v1e(t){var e=KQ(w1e(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function MB(t){return t*(Math.PI/180)}function Tae(t){return 180*(t/Math.PI)}function HVe(t){var e=t.lat,i=t.lon,r=6378137,s=.00669438,n=.9996,o,a,l,c,h,d,f,m=MB(e),g=MB(i),y,v;v=Math.floor((i+180)/6)+1,i===180&&(v=60),e>=56&&e<64&&i>=3&&i<12&&(v=32),e>=72&&e<84&&(i>=0&&i<9?v=31:i>=9&&i<21?v=33:i>=21&&i<33?v=35:i>=33&&i<42&&(v=37)),o=(v-1)*6-180+3,y=MB(o),a=s/(1-s),l=r/Math.sqrt(1-s*Math.sin(m)*Math.sin(m)),c=Math.tan(m)*Math.tan(m),h=a*Math.cos(m)*Math.cos(m),d=Math.cos(m)*(g-y),f=r*((1-s/4-3*s*s/64-5*s*s*s/256)*m-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*m)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*m)-35*s*s*s/3072*Math.sin(6*m));var x=n*l*(d+(1-c+h)*d*d*d/6+(5-18*c+c*c+72*h-58*a)*d*d*d*d*d/120)+5e5,S=n*(f+l*Math.tan(m)*(d*d/2+(5-c+9*h+4*h*h)*d*d*d*d/24+(61-58*c+c*c+600*h-330*a)*d*d*d*d*d*d/720));return e<0&&(S+=1e7),{northing:Math.round(S),easting:Math.round(x),zoneNumber:v,zoneLetter:qVe(e)}}function KQ(t){var e=t.northing,i=t.easting,r=t.zoneLetter,s=t.zoneNumber;if(s<0||s>60)return null;var n=.9996,o=6378137,a=.00669438,l,c=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),h,d,f,m,g,y,v,x,S,E=i-5e5,C=e;r<"N"&&(C-=1e7),v=(s-1)*6-180+3,l=a/(1-a),y=C/n,x=y/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),S=x+(3*c/2-27*c*c*c/32)*Math.sin(2*x)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*x)+151*c*c*c/96*Math.sin(6*x),h=o/Math.sqrt(1-a*Math.sin(S)*Math.sin(S)),d=Math.tan(S)*Math.tan(S),f=l*Math.cos(S)*Math.cos(S),m=o*(1-a)/Math.pow(1-a*Math.sin(S)*Math.sin(S),1.5),g=E/(h*n);var R=S-h*Math.tan(S)/m*(g*g/2-(5+3*d+10*f-4*f*f-9*l)*g*g*g*g/24+(61+90*d+298*f+45*d*d-252*l-3*f*f)*g*g*g*g*g*g/720);R=Tae(R);var O=(g-(1+2*d+f)*g*g*g/6+(5-2*f+28*d-3*f*f+8*l+24*d*d)*g*g*g*g*g/120)/Math.cos(S);O=v+Tae(O);var U;if(t.accuracy){var L=KQ({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});U={top:L.lat,right:L.lon,bottom:R,left:O}}else U={lat:R,lon:O};return U}function qVe(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function WVe(t,e){var i="00000"+t.easting,r="00000"+t.northing;return t.zoneNumber+t.zoneLetter+YVe(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+r.substr(r.length-5,e)}function YVe(t,e,i){var r=b1e(i),s=Math.floor(t/1e5),n=Math.floor(e/1e5)%20;return XVe(s,n,r)}function b1e(t){var e=t%xae;return e===0&&(e=xae),e}function XVe(t,e,i){var r=i-1,s=g1e.charCodeAt(r),n=y1e.charCodeAt(r),o=s+t-1,a=n+e,l=!1;o>NR&&(o=o-NR+hM-1,l=!0),(o===Fu||s<Fu&&o>Fu||(o>Fu||s<Fu)&&l)&&o++,(o===rp||s<rp&&o>rp||(o>rp||s<rp)&&l)&&(o++,o===Fu&&o++),o>NR&&(o=o-NR+hM-1),a>DR?(a=a-DR+hM-1,l=!0):l=!1,(a===Fu||n<Fu&&a>Fu||(a>Fu||n<Fu)&&l)&&a++,(a===rp||n<rp&&a>rp||(a>rp||n<rp)&&l)&&(a++,a===Fu&&a++),a>DR&&(a=a-DR+hM-1);var c=String.fromCharCode(o)+String.fromCharCode(a);return c}function w1e(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var e=t.length,i=null,r="",s,n=0;!/[A-Z]/.test(s=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;r+=s,n++}var o=parseInt(r,10);if(n===0||n+3>e)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(n++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+t;i=t.substring(n,n+=2);for(var l=b1e(o),c=ZVe(i.charAt(0),l),h=JVe(i.charAt(1),l);h<KVe(a);)h+=2e6;var d=e-n;if(d%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var f=d/2,m=0,g=0,y,v,x,S,E;return f>0&&(y=1e5/Math.pow(10,f),v=t.substring(n,n+f),m=parseFloat(v)*y,x=t.substring(n+f),g=parseFloat(x)*y),S=m+c,E=g+h,{easting:S,northing:E,zoneLetter:a,zoneNumber:o,accuracy:y}}function ZVe(t,e){for(var i=g1e.charCodeAt(e-1),r=1e5,s=!1;i!==t.charCodeAt(0);){if(i++,i===Fu&&i++,i===rp&&i++,i>NR){if(s)throw"Bad character: "+t;i=hM,s=!0}r+=1e5}return r}function JVe(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=y1e.charCodeAt(e-1),r=0,s=!1;i!==t.charCodeAt(0);){if(i++,i===Fu&&i++,i===rp&&i++,i>DR){if(s)throw"Bad character: "+t;i=hM,s=!0}r+=1e5}return r}function KVe(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function _A(t,e,i){if(!(this instanceof _A))return new _A(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof e>"u"){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}_A.fromMGRS=function(t){return new _A(v1e(t))};_A.prototype.toMGRS=function(t){return _1e([this.x,this.y],t)};var QVe=1,eze=.25,Sae=.046875,Eae=.01953125,Cae=.01068115234375,tze=.75,ize=.46875,rze=.013020833333333334,sze=.007120768229166667,nze=.3645833333333333,oze=.005696614583333333,aze=.3076171875;function x1e(t){var e=[];e[0]=QVe-t*(eze+t*(Sae+t*(Eae+t*Cae))),e[1]=t*(tze-t*(Sae+t*(Eae+t*Cae)));var i=t*t;return e[2]=i*(ize-t*(rze+t*sze)),i*=t,e[3]=i*(nze-t*oze),e[4]=i*t*aze,e}function Sk(t,e,i,r){return i*=e,e*=e,r[0]*t-i*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var lze=20;function T1e(t,e,i){for(var r=1/(1-e),s=t,n=lze;n;--n){var o=Math.sin(s),a=1-e*o*o;if(a=(Sk(s,o,Math.cos(s),i)-t)*(a*Math.sqrt(a))*r,s-=a,Math.abs(a)<bt)return s}return s}function cze(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=x1e(this.es),this.ml0=Sk(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function uze(t){var e=t.x,i=t.y,r=Pt(e-this.long0),s,n,o,a=Math.sin(i),l=Math.cos(i);if(this.es){var h=l*r,d=Math.pow(h,2),f=this.ep2*Math.pow(l,2),m=Math.pow(f,2),g=Math.abs(l)>bt?Math.tan(i):0,y=Math.pow(g,2),v=Math.pow(y,2);s=1-this.es*Math.pow(a,2),h=h/Math.sqrt(s);var x=Sk(i,a,l,this.en);n=this.a*(this.k0*h*(1+d/6*(1-y+f+d/20*(5-18*y+v+14*f-58*y*f+d/42*(61+179*v-v*y-479*y)))))+this.x0,o=this.a*(this.k0*(x-this.ml0+a*r*h/2*(1+d/12*(5-y+9*f+4*m+d/30*(61+v-58*y+270*f-330*y*f+d/56*(1385+543*v-v*y-3111*y))))))+this.y0}else{var c=l*Math.sin(r);if(Math.abs(Math.abs(c)-1)<bt)return 93;if(n=.5*this.a*this.k0*Math.log((1+c)/(1-c))+this.x0,o=l*Math.cos(r)/Math.sqrt(1-Math.pow(c,2)),c=Math.abs(o),c>=1){if(c-1>bt)return 93;o=0}else o=Math.acos(o);i<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return t.x=n,t.y=o,t}function hze(t){var e,i,r,s,n=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+o/this.k0,i=T1e(e,this.es,this.en),Math.abs(i)<Ke){var d=Math.sin(i),f=Math.cos(i),m=Math.abs(f)>bt?Math.tan(i):0,g=this.ep2*Math.pow(f,2),y=Math.pow(g,2),v=Math.pow(m,2),x=Math.pow(v,2);e=1-this.es*Math.pow(d,2);var S=n*Math.sqrt(e)/this.k0,E=Math.pow(S,2);e=e*m,r=i-e*E/(1-this.es)*.5*(1-E/12*(5+3*v-9*g*v+g-4*y-E/30*(61+90*v-252*g*v+45*x+46*g-E/56*(1385+3633*v+4095*x+1574*x*v)))),s=Pt(this.long0+S*(1-E/6*(1+2*v+g-E/20*(5+28*v+24*x+8*g*v+6*g-E/42*(61+662*v+1320*x+720*x*v))))/f)}else r=Ke*RL(o),s=0;else{var a=Math.exp(n/this.k0),l=.5*(a-1/a),c=this.lat0+o/this.k0,h=Math.cos(c);e=Math.sqrt((1-Math.pow(h,2))/(1+Math.pow(l,2))),r=Math.asin(e),o<0&&(r=-r),l===0&&h===0?s=0:s=Pt(Math.atan2(l,h)+this.long0)}return t.x=s,t.y=r,t}var dze=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const x5={init:cze,forward:uze,inverse:hze,names:dze};function S1e(t){var e=Math.exp(t);return e=(e-1/e)/2,e}function em(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),r=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(r,2))}function pze(t){var e=1+t,i=e-1;return i===0?t:t*Math.log(e)/i}function fze(t){var e=Math.abs(t);return e=pze(e*(1+e/(em(1,e)+1))),t<0?-e:e}function QQ(t,e){for(var i=2*Math.cos(2*e),r=t.length-1,s=t[r],n=0,o;--r>=0;)o=-n+i*s+t[r],n=s,s=o;return e+o*Math.sin(2*e)}function mze(t,e){for(var i=2*Math.cos(e),r=t.length-1,s=t[r],n=0,o;--r>=0;)o=-n+i*s+t[r],n=s,s=o;return Math.sin(e)*o}function gze(t){var e=Math.exp(t);return e=(e+1/e)/2,e}function E1e(t,e,i){for(var r=Math.sin(e),s=Math.cos(e),n=S1e(i),o=gze(i),a=2*s*o,l=-2*r*n,c=t.length-1,h=t[c],d=0,f=0,m=0,g,y;--c>=0;)g=f,y=d,f=h,d=m,h=-g+a*f-l*d+t[c],m=-y+l*f+a*d;return a=r*o,l=s*n,[a*h-l*m,a*m+l*h]}function yze(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(x5.init.apply(this),this.forward=x5.forward,this.inverse=x5.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),i=i*e,this.cgb[1]=i*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i=i*e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),i=i*e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(-12/5+e*(-24832/14175))),i=i*e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i=i*e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),i=i*e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i=i*e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i=i*e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i=i*e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var r=QQ(this.cbg,this.lat0);this.Zb=-this.Qn*(r+mze(this.gtu,2*r))}function _ze(t){var e=Pt(t.x-this.long0),i=t.y;i=QQ(this.cbg,i);var r=Math.sin(i),s=Math.cos(i),n=Math.sin(e),o=Math.cos(e);i=Math.atan2(r,o*s),e=Math.atan2(n*s,em(r,s*o)),e=fze(Math.tan(e));var a=E1e(this.gtu,2*i,2*e);i=i+a[0],e=e+a[1];var l,c;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,c=this.a*(this.Qn*i+this.Zb)+this.y0):(l=1/0,c=1/0),t.x=l,t.y=c,t}function vze(t){var e=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,e=e/this.Qn;var r,s;if(Math.abs(e)<=2.623395162778){var n=E1e(this.utg,2*i,2*e);i=i+n[0],e=e+n[1],e=Math.atan(S1e(e));var o=Math.sin(i),a=Math.cos(i),l=Math.sin(e),c=Math.cos(e);i=Math.atan2(o*c,em(l,c*a)),e=Math.atan2(l,c*a),r=Pt(e+this.long0),s=QQ(this.cgb,i)}else r=1/0,s=1/0;return t.x=r,t.y=s,t}var bze=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const T5={init:yze,forward:_ze,inverse:vze,names:bze};function wze(t,e){if(t===void 0){if(t=Math.floor((Pt(e)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var xze="etmerc";function Tze(){var t=wze(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Ml,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,T5.init.apply(this),this.forward=T5.forward,this.inverse=T5.inverse}var Sze=["Universal Transverse Mercator System","utm"];const Eze={init:Tze,names:Sze,dependsOn:xze};function eee(t,e){return Math.pow((1-t)/(1+t),e)}var Cze=20;function Mze(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ms)/(Math.pow(Math.tan(.5*this.lat0+Ms),this.C)*eee(this.e*t,this.ratexp))}function Aze(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Ms),this.C)*eee(this.e*Math.sin(i),this.ratexp))-Ke,t.x=this.C*e,t}function Oze(t){for(var e=1e-14,i=t.x/this.C,r=t.y,s=Math.pow(Math.tan(.5*r+Ms)/this.K,1/this.C),n=Cze;n>0&&(r=2*Math.atan(s*eee(this.e*Math.sin(t.y),-.5*this.e))-Ke,!(Math.abs(r-t.y)<e));--n)t.y=r;return n?(t.x=i,t.y=r,t):null}var Rze=["gauss"];const tee={init:Mze,forward:Aze,inverse:Oze,names:Rze};function Pze(){tee.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function Ize(t){var e,i,r,s;return t.x=Pt(t.x-this.long0),tee.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),r=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*r),t.x=s*i*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*i*r),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function $ze(t){var e,i,r,s,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(n,this.R2);e=Math.sin(o),i=Math.cos(o),s=Math.asin(i*this.sinc0+t.y*e*this.cosc0/n),r=Math.atan2(t.x*e,n*this.cosc0*i-t.y*this.sinc0*e)}else s=this.phic0,r=0;return t.x=r,t.y=s,tee.inverse.apply(this,[t]),t.x=Pt(t.x+this.long0),t}var Lze=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const Dze={init:Pze,forward:Ize,inverse:$ze,names:Lze};function Nze(t,e,i){return e*=i,Math.tan(.5*(Ke+t))*Math.pow((1-e)/(1+e),.5*i)}function Fze(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=bt&&(this.k0=.5*(1+RL(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=bt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=bt&&(this.k0=.5*this.cons*by(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/pm(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=by(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Ke,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function Uze(t){var e=t.x,i=t.y,r=Math.sin(i),s=Math.cos(i),n,o,a,l,c,h,d=Pt(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=bt&&Math.abs(i+this.lat0)<=bt?(t.x=NaN,t.y=NaN,t):this.sphere?(n=2*this.k0/(1+this.sinlat0*r+this.coslat0*s*Math.cos(d)),t.x=this.a*n*s*Math.sin(d)+this.x0,t.y=this.a*n*(this.coslat0*r-this.sinlat0*s*Math.cos(d))+this.y0,t):(o=2*Math.atan(this.ssfn_(i,r,this.e))-Ke,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=bt?(c=pm(this.e,i*this.con,this.con*r),h=2*this.a*this.k0*c/this.cons,t.x=this.x0+h*Math.sin(e-this.long0),t.y=this.y0-this.con*h*Math.cos(e-this.long0),t):(Math.abs(this.sinlat0)<bt?(n=2*this.a*this.k0/(1+l*Math.cos(d)),t.y=n*a):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(d))),t.y=n*(this.cosX0*a-this.sinX0*l*Math.cos(d))+this.y0),t.x=n*l*Math.sin(d)+this.x0,t))}function kze(t){t.x-=this.x0,t.y-=this.y0;var e,i,r,s,n,o=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,i=this.lat0,o<=bt?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(a)*this.sinlat0+t.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<bt?this.lat0>0?e=Pt(this.long0+Math.atan2(t.x,-1*t.y)):e=Pt(this.long0+Math.atan2(t.x,t.y)):e=Pt(this.long0+Math.atan2(t.x*Math.sin(a),o*this.coslat0*Math.cos(a)-t.y*this.sinlat0*Math.sin(a))),t.x=e,t.y=i,t)}else if(Math.abs(this.coslat0)<=bt){if(o<=bt)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,r=o*this.cons/(2*this.a*this.k0),i=this.con*f$(this.e,r),e=this.con*Pt(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=bt?n=this.X0:(n=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/o),e=Pt(this.long0+Math.atan2(t.x*Math.sin(s),o*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),i=-1*f$(this.e,Math.tan(.5*(Ke+n)));return t.x=e,t.y=i,t}var Vze=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];const zze={init:Fze,forward:Uze,inverse:kze,names:Vze,ssfn_:Nze};function Bze(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,r=this.rf,s=1/r,n=2*s-Math.pow(s,2),o=this.e=Math.sqrt(n);this.R=this.k0*i*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+t/2)),c=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*l+this.alpha*o/2*c}function Gze(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+i)+this.K,s=2*(Math.atan(Math.exp(r))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(n))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*o+this.x0,t}function jze(t){for(var e=t.x-this.x0,i=t.y-this.y0,r=e/this.R,s=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(r)),o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,l=0,c=n,h=-1e3,d=0;Math.abs(c-h)>1e-7;){if(++d>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=a,t.y=c,t}var Hze=["somerc"];const qze={init:Bze,forward:Gze,inverse:jze,names:Hze};var oC=1e-7;function Wze(t){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||e.indexOf(i)!==-1}function Yze(){var t,e,i,r,s,n,o,a,l,c,h=0,d,f=0,m=0,g=0,y=0,v=0,x=0;this.no_off=Wze(this),this.no_rot="no_rot"in this;var S=!1;"alpha"in this&&(S=!0);var E=!1;if("rectified_grid_angle"in this&&(E=!0),S&&(x=this.alpha),E&&(h=this.rectified_grid_angle*Ml),S||E)f=this.longc;else if(m=this.long1,y=this.lat1,g=this.long2,v=this.lat2,Math.abs(y-v)<=oC||(t=Math.abs(y))<=oC||Math.abs(t-Ke)<=oC||Math.abs(Math.abs(this.lat0)-Ke)<=oC||Math.abs(Math.abs(v)-Ke)<=oC)throw new Error;var C=1-this.es;e=Math.sqrt(C),Math.abs(this.lat0)>bt?(a=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*a*a,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/C),this.A=this.B*this.k0*e/t,r=this.B*e/(i*Math.sqrt(t)),s=r*r-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=r,this.E*=Math.pow(pm(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=s=1),S||E?(S?(d=Math.asin(Math.sin(x)/r),E||(h=x)):(d=h,x=Math.asin(r*Math.sin(d))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(d))/this.B):(n=Math.pow(pm(this.e,y,Math.sin(y)),this.B),o=Math.pow(pm(this.e,v,Math.sin(v)),this.B),s=this.E/n,l=(o-n)/(o+n),c=this.E*this.E,c=(c-o*n)/(c+o*n),t=m-g,t<-Math.pi?g-=d$:t>Math.pi&&(g+=d$),this.lam0=Pt(.5*(m+g)-Math.atan(c*Math.tan(.5*this.B*(m-g))/l)/this.B),d=Math.atan(2*Math.sin(this.B*Pt(m-this.lam0))/(s-1/s)),h=x=Math.asin(r*Math.sin(d))),this.singam=Math.sin(d),this.cosgam=Math.cos(d),this.sinrot=Math.sin(h),this.cosrot=Math.cos(h),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(x))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*d,this.v_pole_n=this.ArB*Math.log(Math.tan(Ms-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ms+s))}function Xze(t){var e={},i,r,s,n,o,a,l,c;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Ke)>bt){if(o=this.E/Math.pow(pm(this.e,t.y,Math.sin(t.y)),this.B),a=1/o,i=.5*(o-a),r=.5*(o+a),n=Math.sin(this.B*t.x),s=(i*this.singam-n*this.cosgam)/r,Math.abs(Math.abs(s)-1)<bt)throw new Error;c=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*t.x),Math.abs(a)<oC?l=this.A*t.x:l=this.ArB*Math.atan2(i*this.cosgam+n*this.singam,a)}else c=t.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*t.y;return this.no_rot?(e.x=l,e.y=c):(l-=this.u_0,e.x=c*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-c*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function Zze(t){var e,i,r,s,n,o,a,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,e=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*i),s=.5*(r-1/r),n=.5*(r+1/r),o=Math.sin(this.BrA*e),a=(o*this.cosgam+s*this.singam)/n,Math.abs(Math.abs(a)-1)<bt)l.x=0,l.y=a<0?-Ke:Ke;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=f$(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var Jze=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Kze={init:Yze,forward:Xze,inverse:Zze,names:Jze};function Qze(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<bt)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),r=by(this.e,e,i),s=pm(this.e,this.lat1,e),n=Math.sin(this.lat2),o=Math.cos(this.lat2),a=by(this.e,n,o),l=pm(this.e,this.lat2,n),c=pm(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>bt?this.ns=Math.log(r/a)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function eBe(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=bt&&(i=RL(i)*(Ke-2*bt));var r=Math.abs(Math.abs(i)-Ke),s,n;if(r>bt)s=pm(this.e,i,Math.sin(i)),n=this.a*this.f0*Math.pow(s,this.ns);else{if(r=i*this.ns,r<=0)return null;n=0}var o=this.ns*Pt(e-this.long0);return t.x=this.k0*(n*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-n*Math.cos(o))+this.y0,t}function tBe(t){var e,i,r,s,n,o=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+a*a),i=1):(e=-Math.sqrt(o*o+a*a),i=-1);var l=0;if(e!==0&&(l=Math.atan2(i*o,i*a)),e!==0||this.ns>0){if(i=1/this.ns,r=Math.pow(e/(this.a*this.f0),i),s=f$(this.e,r),s===-9999)return null}else s=-Ke;return n=Pt(l/this.ns+this.long0),t.x=n,t.y=s,t}var iBe=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const rBe={init:Qze,forward:eBe,inverse:tBe,names:iBe};function sBe(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function nBe(t){var e,i,r,s,n,o,a,l=t.x,c=t.y,h=Pt(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-h*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),n=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(s)),o=this.n*n,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),t.y=a*Math.cos(o)/1,t.x=a*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t}function oBe(t){var e,i,r,s,n,o,a,l,c=t.x;t.x=t.y,t.y=c,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x),s=n/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),i=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(e)),t.x=this.long0-i/this.alfa,a=e,l=0;var h=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(l=1),a=t.y,h+=1;while(l===0&&h<15);return h>=15?null:t}var aBe=["Krovak","krovak"];const lBe={init:sBe,forward:nBe,inverse:oBe,names:aBe};function nu(t,e,i,r,s){return t*s-e*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)}function PL(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function IL(t){return .375*t*(1+.25*t*(1+.46875*t))}function $L(t){return .05859375*t*t*(1+.75*t)}function LL(t){return t*t*t*(35/3072)}function vA(t,e,i){var r=e*i;return t/Math.sqrt(1-r*r)}function y3(t){return Math.abs(t)<Ke?t:t-RL(t)*Math.PI}function z8(t,e,i,r,s){var n,o;n=t/e;for(var a=0;a<15;a++)if(o=(t-(e*n-i*Math.sin(2*n)+r*Math.sin(4*n)-s*Math.sin(6*n)))/(e-2*i*Math.cos(2*n)+4*r*Math.cos(4*n)-6*s*Math.cos(6*n)),n+=o,Math.abs(o)<=1e-10)return n;return NaN}function cBe(){this.sphere||(this.e0=PL(this.es),this.e1=IL(this.es),this.e2=$L(this.es),this.e3=LL(this.es),this.ml0=this.a*nu(this.e0,this.e1,this.e2,this.e3,this.lat0))}function uBe(t){var e,i,r=t.x,s=t.y;if(r=Pt(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(r)),i=this.a*(Math.atan2(Math.tan(s),Math.cos(r))-this.lat0);else{var n=Math.sin(s),o=Math.cos(s),a=vA(this.a,this.e,n),l=Math.tan(s)*Math.tan(s),c=r*Math.cos(s),h=c*c,d=this.es*o*o/(1-this.es),f=this.a*nu(this.e0,this.e1,this.e2,this.e3,s);e=a*c*(1-h*l*(1/6-(8-l+8*d)*h/120)),i=f-this.ml0+a*n/o*h*(.5+(5-l+6*d)*h/24)}return t.x=e+this.x0,t.y=i+this.y0,t}function hBe(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,i=t.y/this.a,r,s;if(this.sphere){var n=i+this.lat0;r=Math.asin(Math.sin(n)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(n))}else{var o=this.ml0/this.a+i,a=z8(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-Ke)<=bt)return t.x=this.long0,t.y=Ke,i<0&&(t.y*=-1),t;var l=vA(this.a,this.e,Math.sin(a)),c=l*l*l/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(a),2),d=e*this.a/l,f=d*d;r=a-l*Math.tan(a)/c*d*d*(.5-(1+3*h)*d*d/24),s=d*(1-f*(h/3+(1+3*h)*h*f/15))/Math.cos(a)}return t.x=Pt(s+this.long0),t.y=y3(r),t}var dBe=["Cassini","Cassini_Soldner","cass"];const pBe={init:cBe,forward:uBe,inverse:hBe,names:dBe};function Cb(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}var fBe=1,mBe=2,gBe=3,yBe=4;function _Be(){var t=Math.abs(this.lat0);if(Math.abs(t-Ke)<bt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<bt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=Cb(this.e,1),this.mmf=.5/(1-this.es),this.apa=MBe(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Cb(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function vBe(t){var e,i,r,s,n,o,a,l,c,h,d=t.x,f=t.y;if(d=Pt(d-this.long0),this.sphere){if(n=Math.sin(f),h=Math.cos(f),r=Math.cos(d),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+h*r:1+this.sinph0*n+this.cosph0*h*r,i<=bt)return null;i=Math.sqrt(2/i),e=i*h*Math.sin(d),i*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*h*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(f+this.lat0)<bt)return null;i=Ms-f*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(d),i*=r}}else{switch(a=0,l=0,c=0,r=Math.cos(d),s=Math.sin(d),n=Math.sin(f),o=Cb(this.e,n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:c=1+this.sinb1*a+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=Ke+f,o=this.qp-o;break;case this.S_POLE:c=f-Ke,o=this.qp+o;break}if(Math.abs(c)<bt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),this.mode===this.OBLIQ?i=this.ymf*c*(this.cosb1*a-this.sinb1*l*r):i=(c=Math.sqrt(2/(1+l*r)))*a*this.ymf,e=this.xmf*c*l*s;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(c=Math.sqrt(o))*s,i=r*(this.mode===this.S_POLE?c:-c)):e=i=0;break}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t}function bBe(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,i=t.y/this.a,r,s,n,o,a,l,c;if(this.sphere){var h=0,d,f=0;if(d=Math.sqrt(e*e+i*i),s=d*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(s),h=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(d)<=bt?0:Math.asin(i*f/d),e*=f,i=h*d;break;case this.OBLIQ:s=Math.abs(d)<=bt?this.lat0:Math.asin(h*this.sinph0+i*f*this.cosph0/d),e*=f*this.cosph0,i=(h-Math.sin(s)*this.sinph0)*d;break;case this.N_POLE:i=-i,s=Ke-s;break;case this.S_POLE:s-=Ke;break}r=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,i)}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,i*=this.dd,l=Math.sqrt(e*e+i*i),l<bt)return t.x=this.long0,t.y=this.lat0,t;o=2*Math.asin(.5*l/this.rq),n=Math.cos(o),e*=o=Math.sin(o),this.mode===this.OBLIQ?(c=n*this.sinb1+i*o*this.cosb1/l,a=this.qp*c,i=l*this.cosb1*n-i*this.sinb1*o):(c=i*o/l,a=this.qp*c,i=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),a=e*e+i*i,!a)return t.x=this.long0,t.y=this.lat0,t;c=1-a/this.qp,this.mode===this.S_POLE&&(c=-c)}r=Math.atan2(e,i),s=ABe(Math.asin(c),this.apa)}return t.x=Pt(this.long0+r),t.y=s,t}var wBe=.3333333333333333,xBe=.17222222222222222,TBe=.10257936507936508,SBe=.06388888888888888,EBe=.0664021164021164,CBe=.016415012942191543;function MBe(t){var e,i=[];return i[0]=t*wBe,e=t*t,i[0]+=e*xBe,i[1]=e*SBe,e*=t,i[0]+=e*TBe,i[1]+=e*EBe,i[2]=e*CBe,i}function ABe(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)}var OBe=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const RBe={init:_Be,forward:vBe,inverse:bBe,names:OBe,S_POLE:fBe,N_POLE:mBe,EQUIT:gBe,OBLIQ:yBe};function Vb(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function PBe(){Math.abs(this.lat1+this.lat2)<bt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=by(this.e3,this.sin_po,this.cos_po),this.qs1=Cb(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=by(this.e3,this.sin_po,this.cos_po),this.qs2=Cb(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Cb(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>bt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function IBe(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=Cb(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,n=this.ns0*Pt(e-this.long0),o=s*Math.sin(n)+this.x0,a=this.rh-s*Math.cos(n)+this.y0;return t.x=o,t.y=a,t}function $Be(t){var e,i,r,s,n,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),s=0,e!==0&&(s=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,o=this.phi1z(this.e3,i)),n=Pt(s/this.ns0+this.long0),t.x=n,t.y=o,t}function LBe(t,e){var i,r,s,n,o,a=Vb(.5*e);if(t<bt)return a;for(var l=t*t,c=1;c<=25;c++)if(i=Math.sin(a),r=Math.cos(a),s=t*i,n=1-s*s,o=.5*n*n/r*(e/(1-l)-i/n+.5/t*Math.log((1-s)/(1+s))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var DBe=["Albers_Conic_Equal_Area","Albers","aea"];const NBe={init:PBe,forward:IBe,inverse:$Be,names:DBe,phi1z:LBe};function FBe(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function UBe(t){var e,i,r,s,n,o,a,l,c=t.x,h=t.y;return r=Pt(c-this.long0),e=Math.sin(h),i=Math.cos(h),s=Math.cos(r),o=this.sin_p14*e+this.cos_p14*i*s,n=1,o>0||Math.abs(o)<=bt?(a=this.x0+this.a*n*i*Math.sin(r)/o,l=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*i*s)/o):(a=this.x0+this.infinity_dist*i*Math.sin(r),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*s)),t.x=a,t.y=l,t}function kBe(t){var e,i,r,s,n,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),r=Math.cos(s),o=Vb(r*this.sin_p14+t.y*i*this.cos_p14/e),n=Math.atan2(t.x*i,e*this.cos_p14*r-t.y*this.sin_p14*i),n=Pt(this.long0+n)):(o=this.phic0,n=0),t.x=n,t.y=o,t}var VBe=["gnom"];const zBe={init:FBe,forward:UBe,inverse:kBe,names:VBe};function BBe(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*Ke:Ke;for(var r=Math.asin(.5*e),s,n,o,a,l=0;l<30;l++)if(n=Math.sin(r),o=Math.cos(r),a=t*n,s=Math.pow(1-a*a,2)/(2*o)*(e/(1-t*t)-n/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),r+=s,Math.abs(s)<=1e-10)return r;return NaN}function GBe(){this.sphere||(this.k0=by(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function jBe(t){var e=t.x,i=t.y,r,s,n=Pt(e-this.long0);if(this.sphere)r=this.x0+this.a*n*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var o=Cb(this.e,Math.sin(i));r=this.x0+this.a*this.k0*n,s=this.y0+this.a*o*.5/this.k0}return t.x=r,t.y=s,t}function HBe(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=Pt(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=BBe(this.e,2*t.y*this.k0/this.a),e=Pt(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t}var qBe=["cea"];const WBe={init:GBe,forward:jBe,inverse:HBe,names:qBe};function YBe(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function XBe(t){var e=t.x,i=t.y,r=Pt(e-this.long0),s=y3(i-this.lat0);return t.x=this.x0+this.a*r*this.rc,t.y=this.y0+this.a*s,t}function ZBe(t){var e=t.x,i=t.y;return t.x=Pt(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=y3(this.lat0+(i-this.y0)/this.a),t}var JBe=["Equirectangular","Equidistant_Cylindrical","eqc"];const KBe={init:YBe,forward:XBe,inverse:ZBe,names:JBe};var Mae=20;function QBe(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=PL(this.es),this.e1=IL(this.es),this.e2=$L(this.es),this.e3=LL(this.es),this.ml0=this.a*nu(this.e0,this.e1,this.e2,this.e3,this.lat0)}function e7e(t){var e=t.x,i=t.y,r,s,n,o=Pt(e-this.long0);if(n=o*Math.sin(i),this.sphere)Math.abs(i)<=bt?(r=this.a*o,s=-1*this.a*this.lat0):(r=this.a*Math.sin(n)/Math.tan(i),s=this.a*(y3(i-this.lat0)+(1-Math.cos(n))/Math.tan(i)));else if(Math.abs(i)<=bt)r=this.a*o,s=-1*this.ml0;else{var a=vA(this.a,this.e,Math.sin(i))/Math.tan(i);r=a*Math.sin(n),s=this.a*nu(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+a*(1-Math.cos(n))}return t.x=r+this.x0,t.y=s+this.y0,t}function t7e(t){var e,i,r,s,n,o,a,l,c;if(r=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=bt)e=Pt(r/this.a+this.long0),i=0;else{o=this.lat0+s/this.a,a=r*r/this.a/this.a+o*o,l=o;var h;for(n=Mae;n;--n)if(h=Math.tan(l),c=-1*(o*(l*h+1)-l-.5*(l*l+a)*h)/((l-o)/h-1),l+=c,Math.abs(c)<=bt){i=l;break}e=Pt(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(i))}else if(Math.abs(s+this.ml0)<=bt)i=0,e=Pt(this.long0+r/this.a);else{o=(this.ml0+s)/this.a,a=r*r/this.a/this.a+o*o,l=o;var d,f,m,g,y;for(n=Mae;n;--n)if(y=this.e*Math.sin(l),d=Math.sqrt(1-y*y)*Math.tan(l),f=this.a*nu(this.e0,this.e1,this.e2,this.e3,l),m=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=f/this.a,c=(o*(d*g+1)-g-.5*d*(g*g+a))/(this.es*Math.sin(2*l)*(g*g+a-2*o*g)/(4*d)+(o-g)*(d*m-2/Math.sin(2*l))-m),l-=c,Math.abs(c)<=bt){i=l;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=Pt(this.long0+Math.asin(r*d/this.a)/Math.sin(i))}return t.x=e,t.y=i,t}var i7e=["Polyconic","poly"];const r7e={init:QBe,forward:e7e,inverse:t7e,names:i7e};function s7e(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function n7e(t){var e,i=t.x,r=t.y,s=r-this.lat0,n=i-this.long0,o=s/mI*1e-5,a=n,l=1,c=0;for(e=1;e<=10;e++)l=l*o,c=c+this.A[e]*l;var h=c,d=a,f=1,m=0,g,y,v=0,x=0;for(e=1;e<=6;e++)g=f*h-m*d,y=m*h+f*d,f=g,m=y,v=v+this.B_re[e]*f-this.B_im[e]*m,x=x+this.B_im[e]*f+this.B_re[e]*m;return t.x=x*this.a+this.x0,t.y=v*this.a+this.y0,t}function o7e(t){var e,i=t.x,r=t.y,s=i-this.x0,n=r-this.y0,o=n/this.a,a=s/this.a,l=1,c=0,h,d,f=0,m=0;for(e=1;e<=6;e++)h=l*o-c*a,d=c*o+l*a,l=h,c=d,f=f+this.C_re[e]*l-this.C_im[e]*c,m=m+this.C_im[e]*l+this.C_re[e]*c;for(var g=0;g<this.iterations;g++){var y=f,v=m,x,S,E=o,C=a;for(e=2;e<=6;e++)x=y*f-v*m,S=v*f+y*m,y=x,v=S,E=E+(e-1)*(this.B_re[e]*y-this.B_im[e]*v),C=C+(e-1)*(this.B_im[e]*y+this.B_re[e]*v);y=1,v=0;var R=this.B_re[1],O=this.B_im[1];for(e=2;e<=6;e++)x=y*f-v*m,S=v*f+y*m,y=x,v=S,R=R+e*(this.B_re[e]*y-this.B_im[e]*v),O=O+e*(this.B_im[e]*y+this.B_re[e]*v);var U=R*R+O*O;f=(E*R+C*O)/U,m=(C*R-E*O)/U}var L=f,B=m,G=1,j=0;for(e=1;e<=9;e++)G=G*L,j=j+this.D[e]*G;var q=this.lat0+j*mI*1e5,ie=this.long0+B;return t.x=ie,t.y=q,t}var a7e=["New_Zealand_Map_Grid","nzmg"];const l7e={init:s7e,forward:n7e,inverse:o7e,names:a7e};function c7e(){}function u7e(t){var e=t.x,i=t.y,r=Pt(e-this.long0),s=this.x0+this.a*r,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=s,t.y=n,t}function h7e(t){t.x-=this.x0,t.y-=this.y0;var e=Pt(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t}var d7e=["Miller_Cylindrical","mill"];const p7e={init:c7e,forward:u7e,inverse:h7e,names:d7e};var f7e=20;function m7e(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=x1e(this.es)}function g7e(t){var e,i,r=t.x,s=t.y;if(r=Pt(r-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var n=this.n*Math.sin(s),o=f7e;o;--o){var a=(this.m*s+Math.sin(s)-n)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<bt)break}e=this.a*this.C_x*r*(this.m+Math.cos(s)),i=this.a*this.C_y*s}else{var l=Math.sin(s),c=Math.cos(s);i=this.a*Sk(s,l,c,this.en),e=this.a*r*c/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=i,t}function y7e(t){var e,i,r,s;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(e))),this.m?e=Vb((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Vb(Math.sin(e)/this.n)),r=Pt(r+this.long0),e=y3(e)):(e=T1e(t.y/this.a,this.es,this.en),s=Math.abs(e),s<Ke?(s=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),r=Pt(i)):s-bt<Ke&&(r=this.long0)),t.x=r,t.y=e,t}var _7e=["Sinusoidal","sinu"];const v7e={init:m7e,forward:g7e,inverse:y7e,names:_7e};function b7e(){}function w7e(t){for(var e=t.x,i=t.y,r=Pt(e-this.long0),s=i,n=Math.PI*Math.sin(i);;){var o=-(s+Math.sin(s)-n)/(1+Math.cos(s));if(s+=o,Math.abs(o)<bt)break}s/=2,Math.PI/2-Math.abs(i)<bt&&(r=0);var a=.900316316158*this.a*r*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=a,t.y=l,t}function x7e(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var r=Pt(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var s=Math.asin(i);return t.x=r,t.y=s,t}var T7e=["Mollweide","moll"];const S7e={init:b7e,forward:w7e,inverse:x7e,names:T7e};function E7e(){Math.abs(this.lat1+this.lat2)<bt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=PL(this.es),this.e1=IL(this.es),this.e2=$L(this.es),this.e3=LL(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=by(this.e,this.sinphi,this.cosphi),this.ml1=nu(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<bt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=by(this.e,this.sinphi,this.cosphi),this.ml2=nu(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=nu(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function C7e(t){var e=t.x,i=t.y,r;if(this.sphere)r=this.a*(this.g-i);else{var s=nu(this.e0,this.e1,this.e2,this.e3,i);r=this.a*(this.g-s)}var n=this.ns*Pt(e-this.long0),o=this.x0+r*Math.sin(n),a=this.y0+this.rh-r*Math.cos(n);return t.x=o,t.y=a,t}function M7e(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,r,s;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;if(i!==0&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere)return s=Pt(this.long0+n/this.ns),r=y3(this.g-i/this.a),t.x=s,t.y=r,t;var o=this.g-i/this.a;return r=z8(o,this.e0,this.e1,this.e2,this.e3),s=Pt(this.long0+n/this.ns),t.x=s,t.y=r,t}var A7e=["Equidistant_Conic","eqdc"];const O7e={init:E7e,forward:C7e,inverse:M7e,names:A7e};function R7e(){this.R=this.a}function P7e(t){var e=t.x,i=t.y,r=Pt(e-this.long0),s,n;Math.abs(i)<=bt&&(s=this.x0+this.R*r,n=this.y0);var o=Vb(2*Math.abs(i/Math.PI));(Math.abs(r)<=bt||Math.abs(Math.abs(i)-Ke)<=bt)&&(s=this.x0,i>=0?n=this.y0+Math.PI*this.R*Math.tan(.5*o):n=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/r-r/Math.PI),l=a*a,c=Math.sin(o),h=Math.cos(o),d=h/(c+h-1),f=d*d,m=d*(2/c-1),g=m*m,y=Math.PI*this.R*(a*(d-g)+Math.sqrt(l*(d-g)*(d-g)-(g+l)*(f-g)))/(g+l);r<0&&(y=-y),s=this.x0+y;var v=l+d;return y=Math.PI*this.R*(m*v-a*Math.sqrt((g+l)*(l+1)-v*v))/(g+l),i>=0?n=this.y0+y:n=this.y0-y,t.x=s,t.y=n,t}function I7e(t){var e,i,r,s,n,o,a,l,c,h,d,f,m;return t.x-=this.x0,t.y-=this.y0,d=Math.PI*this.R,r=t.x/d,s=t.y/d,n=r*r+s*s,o=-Math.abs(s)*(1+n),a=o-2*s*s+r*r,l=-2*o+1+2*s*s+n*n,m=s*s/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,c=(o-a*a/3/l)/l,h=2*Math.sqrt(-c/3),d=3*m/c/h,Math.abs(d)>1&&(d>=0?d=1:d=-1),f=Math.acos(d)/3,t.y>=0?i=(-h*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI:i=-(-h*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI,Math.abs(r)<bt?e=this.long0:e=Pt(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(r*r-s*s)+n*n))/2/r),t.x=e,t.y=i,t}var $7e=["Van_der_Grinten_I","VanDerGrinten","vandg"];const L7e={init:R7e,forward:P7e,inverse:I7e,names:$7e};function D7e(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function N7e(t){var e=t.x,i=t.y,r=Math.sin(t.y),s=Math.cos(t.y),n=Pt(e-this.long0),o,a,l,c,h,d,f,m,g,y,v,x,S,E,C,R,O,U,L,B,G,j,q;return this.sphere?Math.abs(this.sin_p12-1)<=bt?(t.x=this.x0+this.a*(Ke-i)*Math.sin(n),t.y=this.y0-this.a*(Ke-i)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=bt?(t.x=this.x0+this.a*(Ke+i)*Math.sin(n),t.y=this.y0+this.a*(Ke+i)*Math.cos(n),t):(U=this.sin_p12*r+this.cos_p12*s*Math.cos(n),R=Math.acos(U),O=R?R/Math.sin(R):1,t.x=this.x0+this.a*O*s*Math.sin(n),t.y=this.y0+this.a*O*(this.cos_p12*r-this.sin_p12*s*Math.cos(n)),t):(o=PL(this.es),a=IL(this.es),l=$L(this.es),c=LL(this.es),Math.abs(this.sin_p12-1)<=bt?(h=this.a*nu(o,a,l,c,Ke),d=this.a*nu(o,a,l,c,i),t.x=this.x0+(h-d)*Math.sin(n),t.y=this.y0-(h-d)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=bt?(h=this.a*nu(o,a,l,c,Ke),d=this.a*nu(o,a,l,c,i),t.x=this.x0+(h+d)*Math.sin(n),t.y=this.y0+(h+d)*Math.cos(n),t):(f=r/s,m=vA(this.a,this.e,this.sin_p12),g=vA(this.a,this.e,r),y=Math.atan((1-this.es)*f+this.es*m*this.sin_p12/(g*s)),v=Math.atan2(Math.sin(n),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(n)),v===0?L=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(v)-Math.PI)<=bt?L=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):L=Math.asin(Math.sin(n)*Math.cos(y)/Math.sin(v)),x=this.e*this.sin_p12/Math.sqrt(1-this.es),S=this.e*this.cos_p12*Math.cos(v)/Math.sqrt(1-this.es),E=x*S,C=S*S,B=L*L,G=B*L,j=G*L,q=j*L,R=m*L*(1-B*C*(1-C)/6+G/8*E*(1-2*C)+j/120*(C*(4-7*C)-3*x*x*(1-7*C))-q/48*E),t.x=this.x0+R*Math.sin(v),t.y=this.y0+R*Math.cos(v),t))}function F7e(t){t.x-=this.x0,t.y-=this.y0;var e,i,r,s,n,o,a,l,c,h,d,f,m,g,y,v,x,S,E,C,R,O,U,L;return this.sphere?(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*Ke*this.a?void 0:(i=e/this.a,r=Math.sin(i),s=Math.cos(i),n=this.long0,Math.abs(e)<=bt?o=this.lat0:(o=Vb(s*this.sin_p12+t.y*r*this.cos_p12/e),a=Math.abs(this.lat0)-Ke,Math.abs(a)<=bt?this.lat0>=0?n=Pt(this.long0+Math.atan2(t.x,-t.y)):n=Pt(this.long0-Math.atan2(-t.x,t.y)):n=Pt(this.long0+Math.atan2(t.x*r,e*this.cos_p12*s-t.y*this.sin_p12*r))),t.x=n,t.y=o,t)):(l=PL(this.es),c=IL(this.es),h=$L(this.es),d=LL(this.es),Math.abs(this.sin_p12-1)<=bt?(f=this.a*nu(l,c,h,d,Ke),e=Math.sqrt(t.x*t.x+t.y*t.y),m=f-e,o=z8(m/this.a,l,c,h,d),n=Pt(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=o,t):Math.abs(this.sin_p12+1)<=bt?(f=this.a*nu(l,c,h,d,Ke),e=Math.sqrt(t.x*t.x+t.y*t.y),m=e-f,o=z8(m/this.a,l,c,h,d),n=Pt(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),v=Math.atan2(t.x,t.y),g=vA(this.a,this.e,this.sin_p12),x=Math.cos(v),S=this.e*this.cos_p12*x,E=-S*S/(1-this.es),C=3*this.es*(1-E)*this.sin_p12*this.cos_p12*x/(1-this.es),R=e/g,O=R-E*(1+E)*Math.pow(R,3)/6-C*(1+3*E)*Math.pow(R,4)/24,U=1-E*O*O/2-R*O*O*O/6,y=Math.asin(this.sin_p12*Math.cos(O)+this.cos_p12*Math.sin(O)*x),n=Pt(this.long0+Math.asin(Math.sin(v)*Math.sin(O)/Math.cos(y))),L=Math.sin(y),o=Math.atan2((L-this.es*U*this.sin_p12)*Math.tan(y),L*(1-this.es)),t.x=n,t.y=o,t))}var U7e=["Azimuthal_Equidistant","aeqd"];const k7e={init:D7e,forward:N7e,inverse:F7e,names:U7e};function V7e(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function z7e(t){var e,i,r,s,n,o,a,l,c=t.x,h=t.y;return r=Pt(c-this.long0),e=Math.sin(h),i=Math.cos(h),s=Math.cos(r),o=this.sin_p14*e+this.cos_p14*i*s,n=1,(o>0||Math.abs(o)<=bt)&&(a=this.a*n*i*Math.sin(r),l=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*i*s)),t.x=a,t.y=l,t}function B7e(t){var e,i,r,s,n,o,a;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),i=Vb(e/this.a),r=Math.sin(i),s=Math.cos(i),o=this.long0,Math.abs(e)<=bt?(a=this.lat0,t.x=o,t.y=a,t):(a=Vb(s*this.sin_p14+t.y*r*this.cos_p14/e),n=Math.abs(this.lat0)-Ke,Math.abs(n)<=bt?(this.lat0>=0?o=Pt(this.long0+Math.atan2(t.x,-t.y)):o=Pt(this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=a,t):(o=Pt(this.long0+Math.atan2(t.x*r,e*this.cos_p14*s-t.y*this.sin_p14*r)),t.x=o,t.y=a,t))}var G7e=["ortho"];const j7e={init:V7e,forward:z7e,inverse:B7e,names:G7e};var eo={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},As={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function H7e(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Ke-Ms/2?this.face=eo.TOP:this.lat0<=-(Ke-Ms/2)?this.face=eo.BOTTOM:Math.abs(this.long0)<=Ms?this.face=eo.FRONT:Math.abs(this.long0)<=Ke+Ms?this.face=this.long0>0?eo.RIGHT:eo.LEFT:this.face=eo.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function q7e(t){var e={x:0,y:0},i,r,s,n,o,a,l={value:0};if(t.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):i=t.y,r=t.x,this.face===eo.TOP)n=Ke-i,r>=Ms&&r<=Ke+Ms?(l.value=As.AREA_0,s=r-Ke):r>Ke+Ms||r<=-(Ke+Ms)?(l.value=As.AREA_1,s=r>0?r-No:r+No):r>-(Ke+Ms)&&r<=-Ms?(l.value=As.AREA_2,s=r+Ke):(l.value=As.AREA_3,s=r);else if(this.face===eo.BOTTOM)n=Ke+i,r>=Ms&&r<=Ke+Ms?(l.value=As.AREA_0,s=-r+Ke):r<Ms&&r>=-Ms?(l.value=As.AREA_1,s=-r):r<-Ms&&r>=-(Ke+Ms)?(l.value=As.AREA_2,s=-r-Ke):(l.value=As.AREA_3,s=r>0?-r+No:-r-No);else{var c,h,d,f,m,g,y;this.face===eo.RIGHT?r=kM(r,+Ke):this.face===eo.BACK?r=kM(r,+No):this.face===eo.LEFT&&(r=kM(r,-Ke)),f=Math.sin(i),m=Math.cos(i),g=Math.sin(r),y=Math.cos(r),c=m*y,h=m*g,d=f,this.face===eo.FRONT?(n=Math.acos(c),s=lN(n,d,h,l)):this.face===eo.RIGHT?(n=Math.acos(h),s=lN(n,d,-c,l)):this.face===eo.BACK?(n=Math.acos(-c),s=lN(n,d,-h,l)):this.face===eo.LEFT?(n=Math.acos(-h),s=lN(n,d,c,l)):(n=s=0,l.value=As.AREA_0)}return a=Math.atan(12/No*(s+Math.acos(Math.sin(s)*Math.cos(Ms))-Ke)),o=Math.sqrt((1-Math.cos(n))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===As.AREA_1?a+=Ke:l.value===As.AREA_2?a+=No:l.value===As.AREA_3&&(a+=1.5*No),e.x=o*Math.cos(a),e.y=o*Math.sin(a),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,t.x=e.x,t.y=e.y,t}function W7e(t){var e={lam:0,phi:0},i,r,s,n,o,a,l,c,h,d={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),i=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?d.value=As.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(d.value=As.AREA_1,i-=Ke):t.x<0&&-t.x>=Math.abs(t.y)?(d.value=As.AREA_2,i=i<0?i+No:i-No):(d.value=As.AREA_3,i+=Ke),h=No/12*Math.tan(i),o=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(o),s=Math.cos(i),n=Math.tan(r),l=1-s*s*n*n*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===eo.TOP)c=Math.acos(l),e.phi=Ke-c,d.value===As.AREA_0?e.lam=a+Ke:d.value===As.AREA_1?e.lam=a<0?a+No:a-No:d.value===As.AREA_2?e.lam=a-Ke:e.lam=a;else if(this.face===eo.BOTTOM)c=Math.acos(l),e.phi=c-Ke,d.value===As.AREA_0?e.lam=-a+Ke:d.value===As.AREA_1?e.lam=-a:d.value===As.AREA_2?e.lam=-a-Ke:e.lam=a<0?-a-No:-a+No;else{var f,m,g;f=l,h=f*f,h>=1?g=0:g=Math.sqrt(1-h)*Math.sin(a),h+=g*g,h>=1?m=0:m=Math.sqrt(1-h),d.value===As.AREA_1?(h=m,m=-g,g=h):d.value===As.AREA_2?(m=-m,g=-g):d.value===As.AREA_3&&(h=m,m=g,g=-h),this.face===eo.RIGHT?(h=f,f=-m,m=h):this.face===eo.BACK?(f=-f,m=-m):this.face===eo.LEFT&&(h=f,f=m,m=-h),e.phi=Math.acos(-g)-Ke,e.lam=Math.atan2(m,f),this.face===eo.RIGHT?e.lam=kM(e.lam,-Ke):this.face===eo.BACK?e.lam=kM(e.lam,-No):this.face===eo.LEFT&&(e.lam=kM(e.lam,+Ke))}if(this.es!==0){var y,v,x;y=e.phi<0?1:0,v=Math.tan(e.phi),x=this.b/Math.sqrt(v*v+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-x*x)/(this.one_minus_f*x)),y&&(e.phi=-e.phi)}return e.lam+=this.long0,t.x=e.lam,t.y=e.phi,t}function lN(t,e,i,r){var s;return t<bt?(r.value=As.AREA_0,s=0):(s=Math.atan2(e,i),Math.abs(s)<=Ms?r.value=As.AREA_0:s>Ms&&s<=Ke+Ms?(r.value=As.AREA_1,s-=Ke):s>Ke+Ms||s<=-(Ke+Ms)?(r.value=As.AREA_2,s=s>=0?s-No:s+No):(r.value=As.AREA_3,s+=Ke)),s}function kM(t,e){var i=t+e;return i<-No?i+=d$:i>+No&&(i-=d$),i}var Y7e=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const X7e={init:H7e,forward:q7e,inverse:W7e,names:Y7e};var cq=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],FR=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],C1e=.8487,M1e=1.3523,A1e=Qg/5,Z7e=1/A1e,dM=18,B8=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},J7e=function(t,e){return t[1]+e*(2*t[2]+e*3*t[3])};function K7e(t,e,i,r){for(var s=e;r;--r){var n=t(s);if(s-=n,Math.abs(n)<i)break}return s}function Q7e(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function eGe(t){var e=Pt(t.x-this.long0),i=Math.abs(t.y),r=Math.floor(i*A1e);r<0?r=0:r>=dM&&(r=dM-1),i=Qg*(i-Z7e*r);var s={x:B8(cq[r],i)*e,y:B8(FR[r],i)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*C1e+this.x0,s.y=s.y*this.a*M1e+this.y0,s}function tGe(t){var e={x:(t.x-this.x0)/(this.a*C1e),y:Math.abs(t.y-this.y0)/(this.a*M1e)};if(e.y>=1)e.x/=cq[dM][0],e.y=t.y<0?-Ke:Ke;else{var i=Math.floor(e.y*dM);for(i<0?i=0:i>=dM&&(i=dM-1);;)if(FR[i][0]>e.y)--i;else if(FR[i+1][0]<=e.y)++i;else break;var r=FR[i],s=5*(e.y-r[0])/(FR[i+1][0]-r[0]);s=K7e(function(n){return(B8(r,n)-e.y)/J7e(r,n)},s,bt,100),e.x/=B8(cq[i],s),e.y=(5*i+s)*Ml,t.y<0&&(e.y=-e.y)}return e.x=Pt(e.x+this.long0),e}var iGe=["Robinson","robin"];const rGe={init:Q7e,forward:eGe,inverse:tGe,names:iGe};function sGe(){this.name="geocent"}function nGe(t){var e=p1e(t,this.es,this.a);return e}function oGe(t){var e=f1e(t,this.es,this.a,this.b);return e}var aGe=["Geocentric","geocentric","geocent","Geocent"];const lGe={init:sGe,forward:nGe,inverse:oGe,names:aGe};var dc={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},yO={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function cGe(){if(Object.keys(yO).forEach(function(i){if(typeof this[i]>"u")this[i]=yO[i].def;else{if(yO[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);yO[i].num&&(this[i]=parseFloat(this[i]))}yO[i].degrees&&(this[i]=this[i]*Ml)}.bind(this)),Math.abs(Math.abs(this.lat0)-Ke)<bt?this.mode=this.lat0<0?dc.S_POLE:dc.N_POLE:Math.abs(this.lat0)<bt?this.mode=dc.EQUIT:(this.mode=dc.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)}function uGe(t){t.x-=this.long0;var e=Math.sin(t.y),i=Math.cos(t.y),r=Math.cos(t.x),s,n;switch(this.mode){case dc.OBLIQ:n=this.sinph0*e+this.cosph0*i*r;break;case dc.EQUIT:n=i*r;break;case dc.S_POLE:n=-e;break;case dc.N_POLE:n=e;break}switch(n=this.pn1/(this.p-n),s=n*i*Math.sin(t.x),this.mode){case dc.OBLIQ:n*=this.cosph0*e-this.sinph0*i*r;break;case dc.EQUIT:n*=e;break;case dc.N_POLE:n*=-(i*r);break;case dc.S_POLE:n*=i*r;break}var o,a;return o=n*this.cg+s*this.sg,a=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-n*this.sg)*this.cw*a,n=o*a,t.x=s*this.a,t.y=n*this.a,t}function hGe(t){t.x/=this.a,t.y/=this.a;var e={x:t.x,y:t.y},i,r,s;s=1/(this.pn1-t.y*this.sw),i=this.pn1*t.x*s,r=this.pn1*t.y*this.cw*s,t.x=i*this.cg+r*this.sg,t.y=r*this.cg-i*this.sg;var n=em(t.x,t.y);if(Math.abs(n)<bt)e.x=0,e.y=t.y;else{var o,a;switch(a=1-n*n*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/n+n/this.pn1),o=Math.sqrt(1-a*a),this.mode){case dc.OBLIQ:e.y=Math.asin(o*this.sinph0+t.y*a*this.cosph0/n),t.y=(o-this.sinph0*Math.sin(e.y))*n,t.x*=a*this.cosph0;break;case dc.EQUIT:e.y=Math.asin(t.y*a/n),t.y=o*n,t.x*=a;break;case dc.N_POLE:e.y=Math.asin(o),t.y=-t.y;break;case dc.S_POLE:e.y=-Math.asin(o);break}e.x=Math.atan2(t.x,t.y)}return t.x=e.x+this.long0,t.y=e.y,t}var dGe=["Tilted_Perspective","tpers"];const pGe={init:cGe,forward:uGe,inverse:hGe,names:dGe};function fGe(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function mGe(t){var e=t.x,i=t.y,r,s,n,o;if(e=e-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var a=this.radius_p/em(this.radius_p*Math.cos(i),Math.sin(i));if(s=a*Math.cos(e)*Math.cos(i),n=a*Math.sin(e)*Math.cos(i),o=a*Math.sin(i),(this.radius_g-s)*s-n*n-o*o*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;r=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/em(o,r)),t.y=this.radius_g_1*Math.atan(o/r)):(t.x=this.radius_g_1*Math.atan(n/r),t.y=this.radius_g_1*Math.atan(o/em(n,r)))}else this.shape==="sphere"&&(r=Math.cos(i),s=Math.cos(e)*r,n=Math.sin(e)*r,o=Math.sin(i),r=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/em(o,r)),t.y=this.radius_g_1*Math.atan(o/r)):(t.x=this.radius_g_1*Math.atan(n/r),t.y=this.radius_g_1*Math.atan(o/em(n,r))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function gGe(t){var e=-1,i=0,r=0,s,n,o,a;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(t.y/this.radius_g_1),i=Math.tan(t.x/this.radius_g_1)*em(1,r)):(i=Math.tan(t.x/this.radius_g_1),r=Math.tan(t.y/this.radius_g_1)*em(1,i));var l=r/this.radius_p;if(s=i*i+l*l+e*e,n=2*this.radius_g*e,o=n*n-4*s*this.C,o<0)return t.x=Number.NaN,t.y=Number.NaN,t;a=(-n-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,i*=a,r*=a,t.x=Math.atan2(i,e),t.y=Math.atan(r*Math.cos(t.x)/e),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(t.y/this.radius_g_1),i=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+r*r)):(i=Math.tan(t.x/this.radius_g_1),r=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+i*i)),s=i*i+r*r+e*e,n=2*this.radius_g*e,o=n*n-4*s*this.C,o<0)return t.x=Number.NaN,t.y=Number.NaN,t;a=(-n-Math.sqrt(o))/(2*s),e=this.radius_g+a*e,i*=a,r*=a,t.x=Math.atan2(i,e),t.y=Math.atan(r*Math.cos(t.x)/e)}return t.x=t.x+this.long0,t}var yGe=["Geostationary Satellite View","Geostationary_Satellite","geos"];const _Ge={init:fGe,forward:mGe,inverse:gGe,names:yGe};function vGe(t){t.Proj.projections.add(x5),t.Proj.projections.add(T5),t.Proj.projections.add(Eze),t.Proj.projections.add(Dze),t.Proj.projections.add(zze),t.Proj.projections.add(qze),t.Proj.projections.add(Kze),t.Proj.projections.add(rBe),t.Proj.projections.add(lBe),t.Proj.projections.add(pBe),t.Proj.projections.add(RBe),t.Proj.projections.add(NBe),t.Proj.projections.add(zBe),t.Proj.projections.add(WBe),t.Proj.projections.add(KBe),t.Proj.projections.add(r7e),t.Proj.projections.add(l7e),t.Proj.projections.add(p7e),t.Proj.projections.add(v7e),t.Proj.projections.add(S7e),t.Proj.projections.add(O7e),t.Proj.projections.add(L7e),t.Proj.projections.add(k7e),t.Proj.projections.add(j7e),t.Proj.projections.add(X7e),t.Proj.projections.add(rGe),t.Proj.projections.add(lGe),t.Proj.projections.add(pGe),t.Proj.projections.add(_Ge)}ch.defaultDatum="WGS84";ch.Proj=ay;ch.WGS84=new ch.Proj("WGS84");ch.Point=_A;ch.toPoint=m1e;ch.defs=Jc;ch.nadgrid=MVe;ch.transform=V8;ch.mgrs=GVe;ch.version="__VERSION__";vGe(ch);function u(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}const bGe="modulepreload",wGe=function(t){return"/"+t},Aae={},se=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=wGe(n),n in Aae)return;Aae[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const d=s[h];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":bGe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function xGe(t){return t&&t.release&&typeof t.release=="function"}function TGe(t){return t&&t.acquire&&typeof t.acquire=="function"}let pa=class uq{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(uq.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):TGe(i)&&i.acquire(...e),i}release(e){e&&!uq.test.disabled&&(this._releaseFunction?this._releaseFunction(e):xGe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};pa.test={disabled:!1};function SGe(t){t.length=0}let ru=class{constructor(e=50,i=50){this._pool=new pa(Array,void 0,SGe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return AB.acquire()}static release(e){return AB.release(e)}static prune(){AB.prune()}};const AB=new ru(100);function lBt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function EGe(t,e){for(const i of t)if(i!=null&&e(i))return i}function m$(t){return t!=null&&typeof t[Symbol.iterator]=="function"}const vx=null;function b(t){return t!=null}function A(t){return t==null}function fa(t,e){return b(t)?e(t):vx}function cBt(t){return t}function uBt(t){return t}function Ol(t,e){return DL(t,e),t}function DL(t,e){if(A(t))throw new Error(e??"value is None")}function vt(t,e){return b(t)?t:typeof e=="function"?e():e}function Oae(t,e){return b(t)?t:e}function He(t){return b(t)&&t.destroy(),null}function dt(t){return b(t)&&t.dispose(),null}function is(t){return b(t)&&t.remove(),null}function lu(t){return b(t)&&t.abort(),null}function Os(t){return b(t)&&t.release(),null}function CGe(t,e,i){return b(t)&&b(e)?b(i)?i(t,e):t.equals(e):t===e}function O2(t){return null}function hBt(t,e){const i=new Array;return t.forEach(r=>{const s=e(r);b(s)&&i.push(s)}),i}function dBt(t,e){const i=new Array;for(const r of t)i.push(id(r,null,e));return i}function pBt(t,e){for(const i of t)fa(i,e)}function id(t,e,i){return b(t)?i(t):e}function fBt(t){return t.filter(e=>b(e))}function Hn(t,...e){let i=t;for(let r=0;r<e.length&&i;++r)i=i[e[r]];return i}function mBt(t){return t}let ir=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(m$(e)){const r=this._getOrCreateGroup(i);for(const s of e)this._isHandle(s)&&r.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&m$(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(i=>i.remove())}};const O1e=Symbol("Accessor-beforeDestroy");function bA(t){return Dp(()=>t.forEach(e=>b(e)&&e.remove()))}function Dp(t){return{remove:()=>{t&&(t(),t=void 0)}}}function yBt(t){return Dp(()=>{const e=t();b(e)&&e.remove()})}function _Bt(t){return Dp(b(t)?()=>t.destroy():void 0)}let gI=class bx{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*bx._m}getInt(){return this._seed=(bx._a*this._seed+bx._c)%bx._m,this._seed}getFloat(){return this.getInt()/(bx._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/bx._m*r}};gI._m=2147483647,gI._a=48271,gI._c=0;function NL(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):t.filter((i,r,s)=>s.indexOf(i)===r)}function L_(t,e,i){if(A(t)&&A(e))return!0;if(A(t)||A(e)||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function iee(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function MGe(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function AGe(t){return t&&typeof t.length=="number"}function vBt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}const OGe=!!Array.prototype.fill;function bBt(t,e){if(OGe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function RGe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function PGe(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let R1e=class{constructor(){this.last=0}};const P1e=new R1e;function hq(t,e,i,r){r=r||P1e;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function g$(t,e,i,r){const s=i??t.length,n=hq(t,e,s,r);if(n!==-1)return t[n]=t[s-1],i==null&&t.pop(),e}const sf=new Set;function IGe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;sf.clear();for(let a=0;a<r;++a)sf.add(e[a]);s=s||P1e;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(sf.has(t[a])&&(n&&n.push(t[a]),sf.delete(t[a]),t[a]=t[i-1],--i,--a,sf.size===0||i===0))return sf.clear(),i;for(let a=0;a<o;++a)if(sf.has(t[a])&&(n&&n.push(t[a]),sf.delete(t[a]),t[a]=t[i-1],--i,--a,sf.size===0||i===0))return sf.clear(),i;return sf.clear(),i}function $Ge(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function LGe(t){return t?(Rae.seed=t,()=>Rae.getFloat()):Math.random}function xBt(t,e){const i=LGe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const Rae=new gI;function ree(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function TBt(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function _O(t){return t instanceof ArrayBuffer}function DGe(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function MT(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function NGe(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function FGe(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function see(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function UGe(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function nee(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function oee(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function aee(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function cN(t){return b(t)?128+t.buffer.byteLength+64:0}const wy=1024;function I1e(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&I1e(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ue(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=N1e(t);if(b(e))return e;if($1e(t))return t.clone();if(L1e(t))return t.map(ue);if(D1e(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ue(t[r]);return i}function dq(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=N1e(t);if(b(e))return e;if(L1e(t)){let i=!0;const r=t.map(s=>{const n=dq(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if($1e(t))return t.clone();if(!D1e(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=dq(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function $1e(t){return typeof t.clone=="function"}function L1e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function D1e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Pae(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function N1e(t){if(DGe(t)||MT(t)||NGe(t)||FGe(t)||see(t)||UGe(t)||nee(t)||oee(t)||aee(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ue(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ue(i));return e}return null}function lee(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function kGe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&L_(t,e):t instanceof Set?e instanceof Set&&zGe(t,e):t instanceof Map?e instanceof Map&&BGe(t,e):!!Pae(t)&&Pae(e)&&VGe(t,e))}function VGe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function zGe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function BGe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function ga(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function GGe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function S5(t,e,i){return i?G8(t,e,{policy:i,path:""}):G8(t,e,null)}function G8(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=ue(e[s]),r;let a=r[s],l=e[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=G8(a,l,i),i.path=c}else r[s]=G8(a,l,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=l);return r},t||{}):t}function F1e(t){return Array.isArray(t)?t:t.split(".")}function Iae(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function jGe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Iae(i));return e}return Iae(t)}function U1e(t,e,i,r){const s=jGe(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return bA(n)}return r(t,s[0],i)}function cee(t){let e=!1;return()=>{e||(e=!0,t())}}function k1e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.getItemAt(s)}const r=ga(e);return GGe(r,i)?r.get(i):e[i]}function V1e(t,e,i){if(t==null)return t;const r=k1e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:V1e(r,e,i+1)}function FL(t,e,i=0){return typeof e!="string"||e.includes(".")?V1e(t,F1e(e),i):k1e(e,t)}function j8(t,e){return FL(t,e)}function $ae(t,e){return FL(e,t)!==void 0}function UL(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ue(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function Ek(t,e){const i=UL(t);let r=i[e];return r||(r=i[e]={}),r}function HGe(t,e){return S5(t,e,WGe)}const qGe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function WGe(t){return qGe.test(t)?"replace":"merge"}let cb;function me(t){return typeof cb[t]=="function"?cb[t]=cb[t](globalThis):cb[t]}var Kve,Qve,e1e,t1e;cb=(Kve=globalThis.dojoConfig)!=null&&Kve.has||(Qve=globalThis.esriConfig)!=null&&Qve.has?{...(e1e=globalThis.dojoConfig)==null?void 0:e1e.has,...(t1e=globalThis.esriConfig)==null?void 0:t1e.has}:{},me.add=(t,e,i,r)=>((r||cb[t]===void 0)&&(cb[t]=e),i&&me(t)),me.cache=cb,me.add("esri-deprecation-warnings",!0),(()=>{var e;me.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(me.add("host-browser",t),me.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),me.add("dom",t),me("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(me.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),me.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),me.add("khtml",s.includes("Konqueror")?n:void 0),me.add("edge",parseFloat(r.split("Edge/")[1])||void 0),me.add("opr",parseFloat(r.split("OPR/")[1])||void 0),me.add("webkit",!me("wp")&&!me("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),me.add("chrome",!me("edge")&&!me("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),me.add("android",!me("wp")&&parseFloat(r.split("Android ")[1])||void 0),me.add("safari",!s.includes("Safari")||me("wp")||me("chrome")||me("android")||me("edge")||me("opr")?void 0:parseFloat(s.split("Version/")[1])),me.add("mac",s.includes("Macintosh")),!me("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));me.add(o,l),me.add("ios",l)}me("webkit")||(!r.includes("Gecko")||me("wp")||me("khtml")||me("edge")||me.add("mozilla",n),me("mozilla")&&me.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&me.add("esri-mobile",e),i&&me.add("esri-iPhone",i),me.add("esri-geolocation",!!navigator.geolocation)}me.add("esri-wasm","WebAssembly"in globalThis),me.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),me.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),me.add("esri-atomics","Atomics"in globalThis),me.add("esri-workers","Worker"in globalThis),me.add("web-feat:cache","caches"in globalThis),me.add("esri-workers-arraybuffer-transfer",!me("safari")||Number(me("safari"))>=12),me.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),me.add("featurelayer-simplify-payload-size-factors",[1,1,4]),me.add("featurelayer-snapshot-enabled",!0),me.add("featurelayer-snapshot-point-min-threshold",8e4),me.add("featurelayer-snapshot-point-max-threshold",4e5),me.add("featurelayer-snapshot-point-coverage",.1),me.add("featurelayer-advanced-symbols",!1),me.add("featurelayer-pbf",!0),me.add("featurelayer-pbf-statistics",!1),me.add("feature-layers-workers",!0),me.add("feature-polyline-generalization-factor",1),me.add("mapview-transitions-duration",200),me.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),me.add("mapserver-pbf-version-support",10.81),me.add("mapservice-popup-identify-max-tolerance",20),me.add("heatmap-allow-raster-fallback",!0),me.add("heatmap-force-raster",!1),me("host-webworker")||me("host-browser")&&(me.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),me.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{me.add("esri-image-decode",!0,!0,!0)}).catch(()=>{me.add("esri-image-decode",!1,!0,!0)})}return!1}),me.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function z1e(t,e,i=!1){return G1e(t,e,i)}function kL(t,e){if(e!=null)return e[t]||B1e(t.split("."),!1,e)}function Tc(t,e,i){const r=t.split("."),s=r.pop(),n=B1e(r,!0,i);n&&s&&(n[s]=e)}function B1e(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function G1e(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=ue(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=G1e(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}var i1e;const Mr={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(i1e=globalThis.location)==null?void 0:i1e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(z1e(Mr,globalThis.esriConfig,!0),delete Mr.has),!Mr.assetsPath){{const t="4.26.5";Mr.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}Mr.defaultAssetsPath=Mr.assetsPath}const YGe=/\{([^\}]+)\}/g;function Lae(t){return t??""}function wm(t,e){return t.replace(YGe,typeof e=="object"?(i,r)=>Lae(kL(r,e)):(i,r)=>Lae(e(r)))}function XGe(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function uee(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function SBt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const Dae={info:0,warn:1,error:2,none:3};let le=class tc{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,tc._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=tc.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const i=tc._loggers;return tc._loggers=e,i},set throttlingDisabled(e){tc._throttlingDisabled=e}}}static getLogger(e){let i=tc._loggers[e];return i||(i=new tc({module:e})),i}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!tc._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=tc._tickCounter)return;this._loggedMessages[e].set(s,tc._tickCounter),tc._scheduleTickCounterIncrement()}for(const s of Mr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;b(r);){const s=r[e];if(b(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=Mr.log.level?Mr.log.level:"warn";return Dae[this._parentWithMember("level",i)]<=Dae[e]}_argsToKey(...e){return uee(JSON.stringify(e,(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){tc._tickCounterScheduled||(tc._tickCounterScheduled=!0,Promise.resolve().then(()=>{tc._tickCounter++,tc._tickCounterScheduled=!1}))}};le._loggers={},le._tickCounter=0,le._tickCounterScheduled=!1,le._throttlingDisabled=!1;var o_;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(o_||(o_={}));let ZGe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){ree(this._observers,this._observer)}},j1e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return JGe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new ZGe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const JGe={remove:()=>{}};var ht;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(ht||(ht={}));const pq=ht.USER+1;function Qu(t){switch(t){case"defaults":return ht.DEFAULTS;case"service":return ht.SERVICE;case"portal-item":return ht.PORTAL_ITEM;case"web-scene":return ht.WEB_SCENE;case"web-map":return ht.WEB_MAP;case"user":return ht.USER;default:return null}}function y$(t){switch(t){case ht.DEFAULTS:return"defaults";case ht.SERVICE:return"service";case ht.PORTAL_ITEM:return"portal-item";case ht.WEB_SCENE:return"web-scene";case ht.WEB_MAP:return"web-map";case ht.USER:return"user"}return void 0}function KGe(t){return y$(t)}var gs;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(gs||(gs={}));const H8={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},UR=[];let yI=H8;function Vi(t){yI.onObservableAccessed(t)}let E5=!1,C5=!1;function D_(t,e,i){if(E5)return hee(t,e,i);H1e(t);const r=e.call(i);return q1e(),r}function QGe(t,e){return D_(H8,t,e)}function hee(t,e,i){const r=E5;E5=!0,H1e(t);let s=null;try{s=e.call(i)}catch(n){C5&&le.getLogger("esri.core.accessorSupport.tracking").error(n)}return q1e(),E5=r,s}function H1e(t){yI=t,UR.push(t)}function q1e(){const t=UR.length;if(t>1){const e=UR.pop();yI=UR[t-2],e.onTrackingEnd()}else if(t===1){const e=UR.pop();yI=H8,e.onTrackingEnd()}else yI=H8}function W1e(t,e){const i=e.observerObject;if(i.flags&gs.DepTrackingInitialized)return;const r=C5;C5=!1,i.flags&gs.AutoTracked?hee(e,e.metadata.get,t):Y1e(t,e),C5=r}const eje=[];function Y1e(t,e){const i=e.observerObject;i.flags&gs.ExplicitlyTracking||(i.flags|=gs.ExplicitlyTracking,hee(e,()=>{const r=e.metadata.dependsOn||eje;for(const s of r)if(typeof s!="string"||s.includes(".")){const n=F1e(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=Nae(a,n[o],o!==n.length-1)}else Nae(t,s,!1)}),i.flags&=~gs.ExplicitlyTracking)}function Nae(t,e,i){var n;const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const s=(n=ga(t))==null?void 0:n.properties.get(r);return s&&(Vi(s.observerObject),W1e(t,s)),i?t[r]:void 0}let Fae=class{constructor(e,i,r){this.properties=e,this.propertyName=i,this.metadata=r,this.observerObject=new tje,this._accessed=null,this._handles=null,this.observerObject.flags=gs.Dirty|(r.nonNullable?gs.NonNullable:0)|(r.hasOwnProperty("value")?gs.HasDefaultValue:0)|(r.get===void 0?gs.DepTrackingInitialized:0)|(r.dependsOn===void 0?gs.AutoTracked:0),Uae.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),Uae.unregister(this)}getComputed(){const e=this.observerObject;Vi(e);const i=this.properties.store,r=this.propertyName,s=e.flags,n=i.get(r);if(s&gs.Computing||~s&gs.Dirty&&i.has(r))return n;e.flags|=gs.Computing;const o=this.properties.host;let a;s&gs.AutoTracked?a=D_(this,this.metadata.get,o):(Y1e(o,this),a=this.metadata.get.call(o)),i.set(r,a,ht.COMPUTED);const l=i.get(r);return l===n?e.flags&=~gs.Dirty:QGe(this.commit,this),e.flags&=~gs.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=gs.DepTrackingInitialized;const i=this._accessed;if(i===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let s=0;s<i.length;++s)r.push(i[s].observe(e));i.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~gs.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}},tje=class extends j1e{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&gs.Overriden&&(this.flags|=gs.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}destroy(){this.flags&gs.Dirty&&this.onCommitted(),super.destroy()}};const Uae=new FinalizationRegistry(t=>{t.destroy()});let ije=class X1e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new X1e;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ue(r))}),i}get(e){return this._values.get(e)}originOf(){return ht.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function uN(t,e,i){return t!==void 0}function kae(t,e,i,r){return t!==void 0&&(!(i==null&&t.observerObject.flags&gs.NonNullable)||(r.lifecycle,o_.INITIALIZING,!1))}function rje(t){return t&&typeof t.destroy=="function"}le.getLogger("esri.core.accessorSupport.Properties");let sje=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=o_.INITIALIZING,this.store=new ije,this._origin=ht.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new Fae(this,r,i[r]);this.properties.set(r,s)}this.metadatas=i}initialize(){this.lifecycle=o_.CONSTRUCTING}constructed(){this.lifecycle=o_.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.properties){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&rje(r)&&(r.destroy(),~i.observerObject.flags&gs.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==o_.INITIALIZING}get(e){const i=this.properties.get(e);if(i.metadata.get)return i.getComputed();Vi(i.observerObject);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.properties.get(e);if(r!==void 0&&r.observerObject.flags&gs.HasDefaultValue)return"defaults"}return y$(i)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const i=this.properties.get(e);if(uN(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.properties.get(e);uN(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.properties.get(i);if(!uN(s))return"";const n=new Set,o=D_({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof Fae))continue;const c=l.properties.host,h=l.propertyName,d=ga(c);a+=d?d.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(e,i,r){const s=this.properties.get(e);if(uN(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.properties.get(e);return i!==void 0&&!!(i.observerObject.flags&gs.Overriden)}clearOverride(e){const i=this.properties.get(e),r=i==null?void 0:i.observerObject;r&&r.flags&gs.Overriden&&(r.flags&=~gs.Overriden,i.notifyChange())}override(e,i){const r=this.properties.get(e);if(!kae(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(OB.release(n),!o)return;i=a}r.observerObject.flags|=gs.Overriden,this._internalSet(r,i)}set(e,i){const r=this.properties.get(e);if(!kae(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(OB.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=Qu(e)}getDefaultOrigin(){return y$(this._origin)}notifyChange(e){const i=this.properties.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.properties.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.properties.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==o_.INITIALIZING?this._origin:ht.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&lee(i,s.get(n))&&~e.observerObject.flags&gs.Overriden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),W1e(this.host,e))}_cast(e,i){const r=OB.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},nje=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const OB=new pa(nje);function oje(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=kL(r,e),n=s??"";if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}let Z1e=class J1e{constructor(e,i,r){this.name=e,this.details=r,this instanceof J1e&&(this.message=(i&&oje(i,r))??"")}toString(){return"["+this.name+"]: "+this.message}},J=class M5 extends Z1e{constructor(e,i,r){if(super(e,i,r),!(this instanceof M5))return new M5(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ue(i)}catch{return"[object]"}}))}}catch(e){throw le.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new M5(e.name,e.message,e.details)}};J.prototype.type="error";function q8(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))q8(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void q8(j8(t,s),n,i)}const r=t.__accessor__;r!=null&&aje(e,r),t[e]=i}}function aje(t,e){if(me("esri-unknown-property-errors")&&!lje(t,e))throw new J("set:unknown-property",cje(t,e))}function lje(t,e){return e.metadatas[t]!=null}function cje(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let K1e=class extends pa{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=O2(this._set)}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const hN=[];function wA(t){hN.push(t),hN.length===1&&queueMicrotask(()=>{const e=hN.slice();hN.length=0;for(const i of e)i()})}let p_=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){b(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var fq;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=n[c-1];for(;h<=d;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l),yield}}t.sort=r,t.iterableSort=s})(fq||(fq={}));const Vae=fq,uje=1.5,hje=1.1;let vi=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new R1e,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>zae(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,zae(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=hq(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(hq(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=IGe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Vae.sort(this.data,0,this.length,e)}iterableSort(e){return Vae.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)e.call(i,s[n],n,s)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}};function zae(t){t.data.length>uje*t.length&&(t.data.length=Math.floor(t.length*hje))}function dje(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return{remove:()=>t.clearTimeout(r)}}}}const VL=dje(globalThis),Bae=new Set;function pje(t,e,i=!1){i&&Bae.has(e)||(i&&Bae.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function mq(t,e,i={}){if(me("esri-deprecation-warnings")){const{moduleName:r}=i;Q1e(t,`Property: ${(r?r+"::":"")+e}`,i)}}function Q1e(t,e,i={}){if(me("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),pje(t,a,o)}}function Ck(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function zL(t,e,i){if(!Ck(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const s of r)t.addEventListener(s,i);return{remove(){for(const s of r)t.removeEventListener(s,i)}}}return t.addEventListener(e,i),{remove(){t.removeEventListener(e,i)}}}function ebe(t,e,i){if(!Ck(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=zL(t,e,s=>{r.remove(),i.call(t,s)});return{remove(){r.remove()}}}const fje={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function AT({key:t}){return fje[t]||t}function er(t="Aborted"){return new J("AbortError",t)}function _i(t,e="Aborted"){if(yo(t))throw er(e)}function Mk(t){return b(t)?"aborted"in t?t:t.signal:t}function yo(t){const e=Mk(t);return b(e)&&e.aborted}function Pl(t){if(kn(t))throw t}function gq(t){if(!kn(t))throw t}function ol(t,e){const i=Mk(t);if(!A(i)){if(!i.aborted)return ebe(i,"abort",()=>e());e()}}function Ak(t,e){const i=Mk(t);if(!A(i))return _i(i),ebe(i,"abort",()=>e(er()))}function lp(t,e){const i=Mk(e);return A(i)?t:new Promise((r,s)=>{let n=ol(e,()=>s(er()));const o=()=>n=is(n);t.then(o,o),t.then(r,s)})}function kn(t){return(t==null?void 0:t.name)==="AbortError"}async function VM(t){try{return await t}catch(e){if(!kn(e))throw e;return}}async function LBt(t,e=le.getLogger("esri")){try{return await t}catch(i){kn(i)||e.error(i)}}function N_(){let t=null;const e=new Promise((i,r)=>{t={promise:void 0,resolve:i,reject:r}});return t.promise=e,t}async function hu(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await hu(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return new Promise(i=>{const r=[];let s=e.length;s===0&&i(r),e.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function W8(t){return(await hu(t)).filter(e=>!!e.value).map(e=>e.value)}function R2(t,e,i){const r=new AbortController;return ol(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);ol(r,()=>{o&&(clearTimeout(o),n(er()))})})}function gh(t){return t&&typeof t.then=="function"}function yq(t){return gh(t)?t:Promise.resolve(t)}function dee(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(er()),n=N_();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||N_(),n=null,e>0){const f=new AbortController;i=yq(t(...l,f.signal));const m=i;R2(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=yq(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,d=s;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function zb(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>VL.setTimeout(()=>r.reject(n),s),r.promise=i,r}function DBt(t,e){return t.then(e,e)}async function Gae(t){await Promise.resolve(),_i(t)}function NBt(t){return t}function tbe(t){return 1e3*t}function pee(t){return .001*t}let mje=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},gje=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},_q=0,vq=0;const vO={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},bq=["prepare","preRender","render","postRender","update","finish"],wq=[],P2=new vi;let yje=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const Y8={frameTasks:P2,willDispatch:!1,clearFrameTasks:_je,dispatch:sbe,executeFrameTasks:bje};function yS(t){const e=new gje(t);return wq.push(e),Y8.willDispatch||(Y8.willDispatch=!0,wA(sbe)),e}function F_(t){const e=new mje(t);return P2.push(e),X8==null&&(_q=performance.now(),X8=requestAnimationFrame(ibe)),new yje(e)}let X8=null;function _je(t=!1){P2.forAll(e=>{e.removed=!0}),t&&rbe()}function vje(t){vq=Math.max(0,t)}function ibe(){const t=performance.now();X8=null,X8=P2.length>0?requestAnimationFrame(ibe):null,Y8.executeFrameTasks(t)}function bje(t){const e=t-_q;_q=t;const i=vq>0?vq:1e3/60,r=Math.max(0,e-i);vO.time=t,vO.frameDuration=i-r;for(let s=0;s<bq.length;s++){const n=performance.now(),o=bq[s];P2.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(vO.elapsedFrameTime=performance.now()-t,vO.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,vO)))}),wje[s].record(performance.now()-n)}rbe(),xje.record(performance.now()-t)}const dN=new vi;function rbe(){P2.forAll(t=>{t.removed&&dN.push(t)}),P2.removeUnorderedMany(dN.data,dN.length),dN.clear()}function sbe(){for(;wq.length;){const t=wq.shift();t.isActive&&t.callback()}Y8.willDispatch=!1}function VBt(t=1,e){const i=zb(),r=()=>{yo(e)?i.reject(er()):t===0?i():(--t,wA(()=>r()))};return r(),i.promise}const wje=bq.map(t=>new p_(t)),xje=new p_("total");function A5(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}let Tje=0;const Sje=0;function nh(){return++Tje}let Ok=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new Eje(this._notify),jae.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),jae.unregister(this)}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let s=0;s<i.length;++s)e.push(i[s].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},Eje=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Cje}};const jae=new FinalizationRegistry(t=>{t.destroy()});function Cje(){}let zM=!1;const Z8=[];function nbe(t,e){let i=new Ok(n),r=null,s=!1;function n(){if(!i||s)return;if(zM)return void lbe(n);const a=r;i.clear(),zM=!0,s=!0,r=D_(i,t),s=!1,zM=!1,e(r,a),cbe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=D_(i,t),s=!1,{remove:o}}function obe(t,e){let i=new Ok(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=D_(i,t),r):null}return o(),{remove:n}}function abe(t){let e=new Ok(r),i=!1;function r(){e&&!i&&(zM?lbe(r):(e.clear(),zM=!0,i=!0,D_(e,t),i=!1,zM=!1,cbe()))}function s(){e&&(e.destroy(),e=null)}return i=!0,D_(e,t),i=!1,{remove:s}}function lbe(t){Z8.includes(t)||Z8.unshift(t)}function cbe(){for(;Z8.length;)Z8.pop()()}var _I;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(_I||(_I={}));let _$=class{constructor(){this.uid=nh(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(_I.Untracked,e,i,r,s,n,lee)}static acquireTracked(e,i,r,s){return this.pool.acquire(_I.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===_I.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i)}acquire(e,i,r,s,n,o,a){this.uid=nh(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=nh(),this.removed=!0}};_$.pool=new K1e(_$);const O5=new ru,y_=new Set;let J8;function K8(t){y_.delete(t),y_.add(t),J8||(J8=yS(Oje))}function Mje(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function Aje(t){for(const e of y_.values())e.target===t&&(e.removed=!0)}function Oje(){let t=10;for(;J8&&t--;){J8=null;const e=Rje(),i=O5.acquire();for(const r of e){const s=r.uid;Mje(r),s===r.uid&&r.removed&&i.push(r)}for(const r of y_)r.removed&&(i.push(r),y_.delete(r));for(const r of i)_$.pool.release(r);O5.release(i),O5.release(e),xq.forEach(r=>r())}}function Rje(){const t=O5.acquire();t.length=y_.size;let e=0;for(const i of y_)t[e]=i,++e;return y_.clear(),t}const xq=new Set;function ube(t){return xq.add(t),{remove(){xq.delete(t)}}}function Pje(t,e,i){let r=U1e(t,e,i,(s,n,o)=>{let a,l,c=obe(()=>FL(s,n),(h,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=_$.acquireUntracked(h,o,d,s,n),l=a.uid),K8(a))});return{remove:cee(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,K8(a)),a=null),r=c=null})}});return r}function Ije(t,e,i){const r=U1e(t,e,i,(s,n,o)=>{let a=!1;return nbe(()=>FL(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,lee(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function $je(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:r?Ije(t,e,i):Pje(t,e,i)}function Lje(t,e,i){let r,s,n=obe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=_$.acquireTracked(o,e,a,i),s=r.uid),K8(r))});return{remove:cee(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,K8(r)),r=null),n=null})}}function Dje(t,e,i){let r=!1;return nbe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function Nje(t,e,i=!1,r=kGe){return i?Dje(t,e,r):Lje(t,e,r)}function Hae(t){return A5(y_,e=>e.oldValue===t)}function ua(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function jBt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function fee(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}const BM=le.getLogger("esri.core.accessorSupport.ensureTypes");function Fje(t){return t==null?t:new Date(t)}function Uje(t){return t==null?t:!!t}function BL(t){return t==null?t:t.toString()}function mp(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Rk(t){return t==null?t:Math.round(parseFloat(t))}function hbe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function Q8(t,e){return e!=null&&t&&!(e instanceof t)}function dbe(t){return t&&"isCollection"in t}function qae(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function kje(t,e){if(!e||!e.constructor||!dbe(e.constructor))return Tq(t,e)?e:new t(e);const i=qae(t.prototype.itemType),r=qae(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(Tq(t,e),e):new t(e):e}function Tq(t,e){return!!hbe(e)&&(BM.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+Pk(t)+"'"),!0)}function U_(t,e){return e==null?e:dbe(t)?kje(t,e):Q8(t,e)?Tq(t,e)?e:new t(e):e}function Pk(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const Vje=new WeakMap;function zje(t){switch(t){case Number:return mp;case Fr:return Rk;case Boolean:return Uje;case String:return BL;case Date:return Fje;default:return fee(Vje,t,()=>U_.bind(null,t))}}function Vn(t,e){const i=zje(t);return arguments.length===1?i:i(e)}function v$(t,e,i){return arguments.length===1?v$.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function Bje(t,e){return arguments.length===1?v$(Vn.bind(null,t)):v$(Vn.bind(null,t),e)}function pbe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>pbe(t,e-1,r)):t(i)}function eU(t,e,i){if(arguments.length===2)return eU.bind(null,t,e);if(!i)return i;let r=e,s=i=pbe(t,e,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function Gje(t,e,i){return arguments.length===2?eU(Vn.bind(null,t),e):eU(Vn.bind(null,t),e,i)}function fbe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function Sq(t,e){if(arguments.length===2)return Sq(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!Q8(a,d))?a:(h&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),BM.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>Pk(d)).join(", ")),BM.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):BM.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function xm(t,e){if(arguments.length===2)return xm(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Vn(c),r.push(Pk(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!Q8(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return BM.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!Q8(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!hbe(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let Fr=class{};const qBt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function jje(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function mbe(t){switch(t.type){case"native":return Vn(t.value);case"array":return v$(mbe(t.value));case"one-of":return Hje(t);default:return null}}function Hje(t){let e=null;return(i,r)=>Cq(i,t)?i:(e==null&&(e=Eq(t)),BM.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function Eq(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Fr:return"integer";case Date:return"date";default:return Pk(t.value)}case"array":return`array of ${Eq(t.value)}`;case"one-of":{const e=t.values.map(i=>Eq(i));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function Cq(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Fr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!Cq(i,e.value));case"one-of":return e.values.some(i=>Cq(t,i))}}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=Ek(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&le.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let d=j8(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=j8(this,h);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){q8(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=qje(o):a&&(Array.isArray(a)?s.cast=v$(xm(a[0])):s.cast=xm(a))),HGe(s,t),t.range&&(s.cast=Wje(s.cast,t.range))}}function gbe(t,e,i){const r=Ek(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function qje(t){let e=0,i=t;if(jje(t))return mbe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(fbe(r))return e===0?Sq(r):eU(Sq(r),e);if(e===1)return Bje(r);if(e>1)return Gje(r,e);const s=t;return s.from?s.from:Vn(s)}function Wje(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function Yje(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let Np=class Mq extends Z1e{constructor(e,i,r){if(super(e,i,r),!(this instanceof Mq))return new Mq(e,i,r)}};Np.prototype.type="warning";function ybe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Aq=le.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Wae(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||Jje(t)&&Tc("read.reader",gw(t),e))}function gw(t){var i,r;const e=t.ndimArray??0;if(e>1)return Zje(t);if(e===1)return Yae(t);if("type"in t&&vbe(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=Yae(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return mee(t)}function mee(t){return"type"in t?Xje(t.type):Kje(t.types)}function Xje(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void Aq.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function _be(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>_be(t,s,i,r-1)):t(e,void 0,i)}function Zje(t){const e=mee(t),i=_be.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Yae(t){const e=mee(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function vbe(t){if(!ybe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?gee(e.Type):bbe(e.Type))}function Jje(t){return"types"in t?bbe(t.types):gee(t.type)}function gee(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||vbe(t))}function bbe(t){for(const e in t.typeMap)if(!gee(t.typeMap[e]))return!1;return!0}function Kje(t){let e=null;const i=t.errorContext??"type";return(r,s,n)=>{if(r==null)return r;const o=typeof r;if(o!=="object")return void Aq.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=Qje(t));const a=t.key;if(typeof a!="string")return;const l=r[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&r&&n.messages.push(new Np(`${i}:unsupported`,d,{definition:r,context:n})),void Aq.error(d)}const h=new c;return h.read(r,n),h}}function Qje(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=UL(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,d={};l.writer(s,d,h),d[h]&&(e[d[h]]=n)}return e}function eHe(t){if(t.json||(t.json={}),Zae(t.json),Jae(t.json),Xae(t.json),t.json.origins)for(const e in t.json.origins)Zae(t.json.origins[e]),Jae(t.json.origins[e]),Xae(t.json.origins[e]);return!0}function Xae(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Zae(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Jae(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Kae(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&ybe(t.type))?e.write.writer=rHe:i>1?e.write.writer=sHe(i):e.types?Array.isArray(e.types)?e.write.writer=iHe(e.types[0]):e.write.writer=tHe(e.types):e.write.writer=b$}function tHe(t){return(e,i,r,s)=>e?wbe(e,t,s)?b$(e,i,r,s):void 0:b$(e,i,r,s)}function wbe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new J(`${r}:unsupported`,s,{definition:t,context:i})),le.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function iHe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?b$(e,i,r,s):b$(e.filter(n=>wbe(n,t,s)),i,r,s)}function b$(t,e,i,r){Tc(i,tU(t,r),e)}function tU(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?iU(t):t}function iU(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function rHe(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>tU(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[tU(t,r)],Tc(i,s,e)}function xbe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>xbe(r,e,i-1)):tU(t,e)}function sHe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=xbe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Tc(r,n,i)}}function Oq(t,e){return yee(t,"read",e)}function Tbe(t,e){return yee(t,"write",e)}function yee(t,e,i){let r=t&&t.json;if(t&&t.json&&t.json.origins&&i){const s=i.origin&&t.json.origins[i.origin];s&&(e==="any"||e in s)&&(r=s)}return r}function nHe(t){const e=oHe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?aHe(r):e;Wae(s,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),Kae(s,r)}Wae(e,t.json,!0),Kae(e,t.json)}function oHe(t){return t.json.types?Rq(t.json):t.type?Sbe(t):Rq(t)}function aHe(t){return t.type?Sbe(t):Rq(t)}function Sbe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!fbe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function Rq(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function lHe(t){eHe(t)&&(Yje(t),nHe(t))}const RB=new Set,PB=new Set;function N(t){return e=>{e.prototype.declaredClass=t,uHe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!RB.has(s.initialize)&&(RB.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!PB.has(s.destroy)&&(PB.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);RB.clear(),PB.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[O1e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=UL(e.prototype),n.prototype.declaredClass=t,n}}function cHe(t,e){return e.get==null?function(){const i=this.__accessor__.properties.get(t);if(i===void 0)return;Vi(i.observerObject);const r=this.__accessor__.store;return r.has(t)?r.get(t):i.metadata.value}:function(){const i=this.__accessor__.properties.get(t);if(i!==void 0)return i.getComputed()}}function uHe(t){const e=t.prototype,i=UL(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];lHe(n),r[s]={enumerable:!0,configurable:!0,get:cHe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===o_.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}var Ebe,Cbe;function hHe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const wx=Symbol("Accessor-Handles"),Pq=Symbol("Accessor-Initialized");let Ee=class Mbe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}UL(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in i){const l=hHe(i[a]);p(l)(o.prototype,a)}return N(r)(o)}constructor(...e){if(this[Ebe]=null,this[Cbe]=!1,this.constructor===Mbe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new sje(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[Pq]=!0}initialize(){}[O1e](){this[wx]=He(this[wx])}destroy(){this.destroyed||(Aje(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[Pq]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return j8(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return q8(this,e,i),this}watch(e,i,r){return $je(this,e,i,r)}own(e){this.addHandles(e)}addHandles(e,i){let r=this[wx];A(r)&&(r=this[wx]=new ir),r.add(e,i)}removeHandles(e){const i=this[wx];A(i)||i.remove(e)}hasHandles(e){const i=this[wx];return!!b(i)&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};Ebe=wx,Cbe=Pq;let R5=class Abe{constructor(){this._emitter=new Abe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return bA(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([N("esri.core.Evented")],s),s};let i=class extends Ee{constructor(){super(...arguments),this._emitter=new R5.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([N("esri.core.Evented")],i),t.EventedAccessor=i})(R5||(R5={}));const ws=R5;var Hr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Hr||(Hr={}));function _ee(t){return(e,i)=>{e[i]=t}}let vee=class extends j1e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var e_;let dHe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Od=new pa(dHe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),pHe=()=>{};function IB(t){return t?t instanceof OT?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function $B(t){if(t&&t.length)return t[0]}function fHe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function Obe(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),Obe(t,i.call(r,s,n,o),i,r)})}const vv=new Set,bv=new Set,wv=new Set,LB=new Map;let mHe=0,OT=e_=class extends ws.EventedAccessor{static isCollection(t){return t!=null&&t instanceof e_}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new vee,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:mHe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof e_?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Vi(this._observable),this._items}set items(t){this._emitBeforeChanges(Hr.ADD)||(this._splice(0,this.length,IB(t)),this._emitAfterChanges(Hr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=pHe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(Vi(this._observable),this._emitBeforeChanges(Hr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Hr.ADD),this}addMany(t,e=this._items.length){if(Vi(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(Hr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,IB(t)),this._emitAfterChanges(Hr.ADD),this}at(t){if(Vi(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Vi(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(Hr.REMOVE),t}clone(){return Vi(this._observable),this._createNewInstance({items:this._items.map(ue)})}concat(...t){Vi(this._observable);const e=t.map(IB);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Vi(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Hr.REMOVE)}every(t,e){return Vi(this._observable),this._items.every(t,e)}filter(t,e){let i;return Vi(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Vi(this._observable),this._items.find(t,e)}findIndex(t,e){return Vi(this._observable),this._items.findIndex(t,e)}flatten(t,e){Vi(this._observable);const i=[];return Obe(i,this,t,e),new e_(i)}forEach(t,e){return Vi(this._observable),this._items.forEach(t,e)}getItemAt(t){return Vi(this._observable),this._items[t]}getNextIndex(t){Vi(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Vi(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Vi(this._observable),this._items.indexOf(t,e)}join(t=","){return Vi(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Vi(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Vi(this._observable);const i=this._items.map(t,e);return new e_({items:i})}reorder(t,e=this.length-1){Vi(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Hr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Hr.MOVE)}return t}}pop(){if(Vi(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const t=$B(this._splice(this.length-1,1));return this._emitAfterChanges(Hr.REMOVE),t}push(...t){return Vi(this._observable),this._emitBeforeChanges(Hr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Hr.ADD)),this.length}reduce(t,e){Vi(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Vi(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Vi(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Vi(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Hr.REMOVE))return;const e=$B(this._splice(t,1));return this._emitAfterChanges(Hr.REMOVE),e}removeMany(t){if(Vi(this._observable),!t||!t.length||this._emitBeforeChanges(Hr.REMOVE))return[];const e=t instanceof e_?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+fHe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Hr.REMOVE),r}reverse(){if(Vi(this._observable),this._emitBeforeChanges(Hr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Hr.MOVE),this}shift(){if(Vi(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const t=$B(this._splice(0,1));return this._emitAfterChanges(Hr.REMOVE),t}slice(t=0,e=this.length){return Vi(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Vi(this._observable),this._items.some(t,e)}sort(t){if(Vi(this._observable),!this.length||this._emitBeforeChanges(Hr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Hr.MOVE),this}splice(t,e,...i){Vi(this._observable);const r=(e?Hr.REMOVE:0)|(i.length?Hr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Vi(this._observable),this._items.slice()}toJSON(){return Vi(this._observable),this.toArray()}toLocaleString(){return Vi(this._observable),this._items.toLocaleString()}toString(){return Vi(this._observable),this._items.toString()}unshift(...t){return Vi(this._observable),!t.length||this._emitBeforeChanges(Hr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Hr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=yS(()=>this._dispatchChange())),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=Od.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);Od.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Od.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Od.release(a)}}if(i&&i.length){if(s){const h=[];for(const d of i){const f=s.ensureType(d);f==null&&d!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=Od.acquire();h.target=this,h.cancellable=!0;const d=Od.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));Od.release(d),Od.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=Od.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,Od.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Od.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Od.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;vv.clear(),bv.clear(),wv.clear();for(const{added:l,removed:c}of i){if(l)if(wv.size===0&&bv.size===0)for(const h of l)vv.add(h);else for(const h of l)bv.has(h)?(wv.add(h),bv.delete(h)):wv.has(h)||vv.add(h);if(c)if(wv.size===0&&vv.size===0)for(const h of c)bv.add(h);else for(const h of c)vv.has(h)?vv.delete(h):(wv.delete(h),bv.add(h))}const r=ru.acquire();vv.forEach(l=>{r.push(l)});const s=ru.acquire();bv.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=ru.acquire();if(wv.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}ru.release(r),ru.release(s),ru.release(a)}vv.clear(),bv.clear(),wv.clear()}};OT.ofType=t=>{if(!t)return e_;if(LB.has(t))return LB.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends e_{};return u([_ee({Type:t,ensureType:typeof t=="function"?Vn(t):xm(t)})],i.prototype,"itemType",void 0),i=u([N(`esri.core.Collection<${e}>`)],i),LB.set(t,i),i},u([p()],OT.prototype,"length",void 0),u([p()],OT.prototype,"items",null),OT=e_=u([N("esri.core.Collection")],OT);const xt=OT;function I2(t,e,i=xt){return e||(e=new i),e===t||(e.removeAll(),gHe(t)?e.addMany(t):t&&e.add(t)),e}function Rbe(t){return t}function gHe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let yHe=class Pbe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Pbe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ue(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??ht.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===ht.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(e,new _He(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===ht.DEFAULTS?e:ht.USER}},_He=class{constructor(e,i){this.value=e,this.origin=i}};function Ibe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),ht.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),ht.DEFAULTS)})}function vHe(t,e,i){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&$ae(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&$ae(s,i))return!0;return!1}function bHe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function wHe(t,e,i,r,s){let n=Oq(e[i],s);bHe(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=Oq(e[o],s),vHe(n,i,r)&&(t[o]=!0)}function xHe(t,e,i,r){const s=i.metadatas,n=yee(s[e],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const $be={origin:"service"};function Lbe(t,e,i=$be){if(!e||typeof e!="object")return;const r=ga(t),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))wHe(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=Oq(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?FL(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||xHe(t,o,r,i)}r.setDefaultOrigin("user")}function THe(t,e,i,r=$be){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function SHe(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function Dbe(t,e,i,r,s,n){if(!r||!r.write)return!1;const o=t.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new J("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&le.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(i)===ht.DEFAULTS)&&EHe(t,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<Qu(n.origin))}function EHe(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i);return L_(o,s)}return!1}return n===s}function Nbe(t,e,i,r){const s=ga(t),n=s.metadatas,o=Tbe(n[e],r);return!!o&&Dbe(t,s,e,o,i,r)}function Fbe(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return S5(e,t.toJSON(i));const r=ga(t),s=r.metadatas;for(const a in s){const l=Tbe(s[a],i);if(!Dbe(t,r,a,l,void 0,i))continue;const c=t.get(a),h=SHe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(e=S5(e,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>S5(e,h,()=>"replace-arrays"))),i&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:KGe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const GL=t=>{let e=class extends t{constructor(...i){super(...i);const r=ga(this),s=r.store,n=new yHe;r.store=n,Ibe(r,s,n)}read(i,r){Lbe(this,i,r)}write(i={},r){return Fbe(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return CHe.call(this,i,r)}};return e=u([N("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function CHe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let Ae=class extends GL(Ee){};Ae=u([N("esri.core.JSONSupport")],Ae);var G1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(G1||(G1={}));let MHe=class{constructor(e){this.instance=e,this._resolver=N_(),this._status=G1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=G1.RESOLVED,this._cleanUp()},()=>{this._status=G1.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===G1.RESOLVED}isRejected(){return this._status===G1.REJECTED}isFulfilled(){return this._status!==G1.PENDING}abort(){this._resolver.reject(er())}when(e,i){return this._resolver.promise.then(e,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=N_(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||kn(s)||this._resolver.reject(s)}),e.resolve()}};const Ik=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new MHe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([N("esri.core.Promise")],e),e};let rU=class extends Ik(Ee){};rU=u([N("esri.core.Promise")],rU);const AHe="not-loaded",OHe="loading",RHe="failed",Qae="loaded",Ube=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=Ak(n,l);this.destroyed&&l(new J("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===AHe){this._set("loadStatus",OHe);const a=this._loadController=new AbortController;s({signal:a.signal}),ol(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",Qae),this._loadController=null},r=>{this._set("loadStatus",RHe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===Qae}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new J("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[Np],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([N("esri.core.Loadable")],e),e};let kR=class extends Ube(rU){};kR=u([N("esri.core.Loadable")],kR),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=Ube,t.isLoadable=e}(kR||(kR={}));const Tm=kR;function $k(t,e,i){return hu(t.map((r,s)=>e.apply(i,[r,s])))}async function PHe(t,e,i){return(await hu(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function bee(t){return{ok:!0,value:t}}function wee(t){return{ok:!1,error:t}}function IHe(t){return b(t)&&t.ok===!0?t.value:null}function $He(t){return b(t)&&t.ok===!1?t.error:null}async function Sm(t){if(A(t))return{ok:!1,error:new Error("no promise provided")};try{return bee(await t)}catch(e){return wee(e)}}async function e7t(t){try{return bee(await t)}catch(e){return Pl(e),wee(e)}}function t7t(t){if(t.ok===!0)return t.value;throw t.error}function jL(t,e){return new l1(t,e)}let l1=class extends Ee{get value(){return IHe(this._result)}get error(){return $He(this._result)}get finished(){return b(this._result)}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=lu(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=bee(s),this._cleanup()},s=>{this._result=wee(s),this._cleanup()}),this._abortHandle=ol(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=is(this._abortHandle),this._abortController=null}};u([p()],l1.prototype,"value",null),u([p()],l1.prototype,"error",null),u([p()],l1.prototype,"finished",null),u([p()],l1.prototype,"promise",void 0),u([p()],l1.prototype,"_result",void 0),l1=u([N("esri.core.asyncUtils.ReactiveTask")],l1);async function xee(t,e){return await t.load(),LHe(t,e)}async function LHe(t,e){const i=[],r=(...n)=>{for(const o of n)A(o)||(Array.isArray(o)?r(...o):xt.isCollection(o)?o.forEach(a=>r(a)):Tm.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await PHe(i,async n=>{const o=await Sm(DHe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function DHe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const NHe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,FHe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function ele(t){const e=t==null?void 0:t.match(NHe);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=FHe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function UHe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const kHe=le.getLogger("esri.core.urlUtils"),_3=Mr.request,tle="esri/config: esriConfig.request.proxyUrl is not set.",kbe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Vbe=/^\s*http:/i,VHe=/^\s*https:/i,zHe=/^\s*file:/i,BHe=/:\d+$/,GHe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,jHe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),HHe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let ly=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(jHe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(HHe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const pN={},qHe=new ly(Mr.applicationUrl);let fc=qHe;const WHe=YHe();let Tee=WHe;const See=()=>fc,s7t=()=>Tee;function YHe(){const t=fc.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${fc.scheme}://${fc.host}${fc.port!=null?`:${fc.port}`:""}`}${e}`}function jo(t){if(!t)return null;const e={path:null,query:null},i=new ly(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=zbe(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function zbe(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function ile(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function xA(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e&&e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>ile(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):ile(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function XHe(t=!1){let e,i=_3.proxyUrl;if(typeof t=="string"){e=rqe(t);const r=Lk(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw kHe.warn(tle),new J("urlutils:proxy-not-set",tle);return e&&Iq()&&(i=Ree(i)),jo(i)}function ZHe(t){const e=Lk(t);let i,r;if(e){const s=Eee(e.proxyUrl);i=s.path,r=s.query?zbe(s.query):null}if(i){const s=jo(t);t=i+"?"+s.path;const n=xA({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const bO={path:"",query:""};function Eee(t){const e=t.indexOf("?");return e!==-1?(bO.path=t.slice(0,e),bO.query=t.slice(e+1)):(bO.path=t,bO.query=null),bO}function Bbe(t){return t=(t=nU(t=cqe(t=Eee(t).path),!0)).toLowerCase()}function JHe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Bbe(t.urlPrefix)},i=_3.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function Lk(t){const e=_3.proxyRules,i=Bbe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function KHe(t,e){if(!t||!e)return!1;t=sU(t),e=sU(e);const i=ele(t),r=ele(e);return b(i)&&b(r)?i.portalHostname===r.portalHostname:!b(i)&&!b(r)&&TA(t,e,!0)}function Gbe(t,e){return t=sU(t),e=sU(e),nU(t)===nU(e)}function sU(t){const e=(t=Op(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function jbe(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=_3.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function TA(t,e,i=!1){if(!t||!e)return!1;const r=Lq(t),s=Lq(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Cee(t){if(typeof t=="string"){if(!hd(t))return!0;t=Lq(t)}if(TA(t,fc))return!0;const e=_3.trustedServers||[];for(let i=0;i<e.length;i++){const r=QHe(e[i]);for(let s=0;s<r.length;s++)if(TA(t,r[s]))return!0}return!1}function QHe(t){return pN[t]||(Oee(t)||Em(t)?pN[t]=[new ly(nd(t))]:pN[t]=[new ly(`http://${t}`),new ly(`https://${t}`)]),pN[t]}function nd(t,e=Tee,i){return Em(t)?i&&i.preserveProtocolRelative?t:fc.scheme==="http"&&fc.authority===fm(t).slice(2)?`http:${t}`:`https:${t}`:Oee(t)?t:$2(t[0]==="/"?aqe(e):e,t)}function Mee(t,e=Tee,i){if(t==null||!hd(t))return t;const r=Op(t),s=r.toLowerCase(),n=Op(e).toLowerCase().replace(/\/+$/,""),o=i?Op(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function Op(t){return t=dqe(t=hqe(t=uqe(t=nd(t=t.trim()))))}function $2(...t){const e=t.filter(b);if(!e||!e.length)return;const i=[];if(hd(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),nqe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function fm(t,e=!1){if(t==null||SA(t)||$y(t))return null;let i=t.indexOf("://");if(i===-1&&Em(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=nU(t,!0)),t}function hd(t){return Em(t)||Oee(t)}function SA(t){return t!=null&&t.slice(0,5)==="blob:"}function $y(t){return t!=null&&t.slice(0,5)==="data:"}function Aee(t){const e=HL(t);if(!e||!e.isBase64)return null;const i=atob(e.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function n7t(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const eqe=/^data:(.*?)(;base64)?,(.*)$/;function HL(t){const e=t.match(eqe);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function Hbe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function o7t(t){const e=Aee(t);if(!e)return null;const i=HL(t);return new Blob([e],{type:i.mediaType})}function a7t(t,e){tqe(t,e)||iqe(t,e)}function tqe(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function iqe(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function Em(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Oee(t){return t!=null&&kbe.test(t)}function rqe(t){return t!=null&&VHe.test(t)||fc.scheme==="https"&&Em(t)}function sqe(t){return t!=null&&Vbe.test(t)||fc.scheme==="http"&&Em(t)}function nqe(t){return t!=null&&zHe.test(t)}function Ree(t){return Em(t)?`https:${t}`:t.replace(Vbe,"https:")}function oqe(){return fc.scheme==="http"}function Iq(){return fc.scheme==="https"}function nU(t,e=!1){return Em(t)?t.slice(2):(t=t.replace(kbe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function aqe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function lqe(t){let e=0;if(hd(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function l7t(t,e){if(!t)return"";const i=jo(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(s,"")}function cqe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function qbe(t){return t.replace(/\/+$/,"")}function uqe(t){if(/^https?:\/\//i.test(t)){const e=Eee(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function hqe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function dqe(t){const e=_3.httpsDomains;if(!sqe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),BHe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return oqe()&&r===fc.authority&&!GHe.test(t)||(Iq()&&r===fc.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||Iq()&&!Lk(t))&&(t=Ree(t)),t}function $q(t,e,i){if(!(e&&i&&t&&hd(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function Lq(t){return typeof t=="string"?new ly(nd(t)):(t.scheme||(t.scheme=fc.scheme),t)}function Wbe(t){return pqe.test(t)}function Ybe(t,e){const i=jo(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Xbe(t,e,i){const r=jo(t),s=r.query||{};return s[e]=String(i),`${r.path}?${xA(s)}`}function P5(t,e){const i=jo(t),r=i.query||{};for(const n in e)r[n]=e[n];const s=xA(r);return s?`${i.path}?${s}`:i.path}function c7t(t){if(A(t))return null;const e=t.match(Zbe);return e?e[2]:null}function rle(t){if(A(t))return null;const e=t.match(Zbe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const Zbe=/([^.]*)\.([^\/]*)$/,pqe=/(^data:image\/svg|\.svg$)/i;function Xe(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=gbe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let Hi=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Tc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function jl(){return function(t,e){return new Hi(t,{ignoreUnknown:!0,...e})}}let Pee=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const zi=new Pee(6378137,1/298.257223563,3e5,.006694379990137799),cy=new Pee(3396190,1/169.8944472236118,23e4),k_=new Pee(1737400,0,0);var xp;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(xp||(xp={}));let _;const z={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(_=2e3;_<=2045;_++)z[_]=0;for(_=2056;_<=2065;_++)z[_]=0;for(_=2067;_<=2135;_++)z[_]=0;for(_=2137;_<=2154;_++)z[_]=0;for(_=2161;_<=2170;_++)z[_]=0;for(_=2172;_<=2193;_++)z[_]=0;for(_=2195;_<=2198;_++)z[_]=0;for(_=2200;_<=2203;_++)z[_]=0;for(_=2205;_<=2217;_++)z[_]=0;for(_=2222;_<=2224;_++)z[_]=1;for(_=2225;_<=2250;_++)z[_]=2;for(_=2251;_<=2253;_++)z[_]=1;for(_=2257;_<=2264;_++)z[_]=2;for(_=2274;_<=2279;_++)z[_]=2;for(_=2280;_<=2282;_++)z[_]=1;for(_=2283;_<=2289;_++)z[_]=2;for(_=2290;_<=2292;_++)z[_]=0;for(_=2308;_<=2313;_++)z[_]=0;for(_=2315;_<=2491;_++)z[_]=0;for(_=2494;_<=2866;_++)z[_]=0;for(_=2867;_<=2869;_++)z[_]=1;for(_=2870;_<=2888;_++)z[_]=2;for(_=2891;_<=2895;_++)z[_]=2;for(_=2896;_<=2898;_++)z[_]=1;for(_=2902;_<=2908;_++)z[_]=2;for(_=2915;_<=2920;_++)z[_]=2;for(_=2921;_<=2923;_++)z[_]=1;for(_=2924;_<=2930;_++)z[_]=2;for(_=2931;_<=2962;_++)z[_]=0;for(_=2964;_<=2968;_++)z[_]=2;for(_=2969;_<=2973;_++)z[_]=0;for(_=2975;_<=2991;_++)z[_]=0;for(_=2995;_<=3051;_++)z[_]=0;for(_=3054;_<=3079;_++)z[_]=0;for(_=3081;_<=3088;_++)z[_]=0;for(_=3092;_<=3101;_++)z[_]=0;for(_=3106;_<=3138;_++)z[_]=0;for(_=3146;_<=3151;_++)z[_]=0;for(_=3153;_<=3166;_++)z[_]=0;for(_=3168;_<=3172;_++)z[_]=0;for(_=3174;_<=3203;_++)z[_]=0;for(_=3294;_<=3358;_++)z[_]=0;for(_=3367;_<=3403;_++)z[_]=0;for(_=3408;_<=3416;_++)z[_]=0;for(_=3417;_<=3438;_++)z[_]=2;for(_=3441;_<=3446;_++)z[_]=2;for(_=3447;_<=3450;_++)z[_]=0;for(_=3451;_<=3459;_++)z[_]=2;for(_=3460;_<=3478;_++)z[_]=0;for(_=3554;_<=3559;_++)z[_]=0;for(_=3560;_<=3570;_++)z[_]=2;for(_=3571;_<=3581;_++)z[_]=0;for(_=3594;_<=3597;_++)z[_]=0;for(_=3601;_<=3604;_++)z[_]=0;for(_=3637;_<=3639;_++)z[_]=0;for(_=3665;_<=3667;_++)z[_]=0;for(_=3693;_<=3695;_++)z[_]=0;for(_=3701;_<=3727;_++)z[_]=0;for(_=3728;_<=3739;_++)z[_]=2;for(_=3740;_<=3751;_++)z[_]=0;for(_=3753;_<=3760;_++)z[_]=2;for(_=3761;_<=3773;_++)z[_]=0;for(_=3775;_<=3777;_++)z[_]=0;for(_=3779;_<=3781;_++)z[_]=0;for(_=3783;_<=3785;_++)z[_]=0;for(_=3788;_<=3791;_++)z[_]=0;for(_=3797;_<=3802;_++)z[_]=0;for(_=3814;_<=3816;_++)z[_]=0;for(_=3825;_<=3829;_++)z[_]=0;for(_=3832;_<=3841;_++)z[_]=0;for(_=3844;_<=3852;_++)z[_]=0;for(_=3873;_<=3885;_++)z[_]=0;for(_=3890;_<=3893;_++)z[_]=0;for(_=3907;_<=3912;_++)z[_]=0;for(_=3942;_<=3950;_++)z[_]=0;for(_=3968;_<=3970;_++)z[_]=0;for(_=3973;_<=3976;_++)z[_]=0;for(_=3986;_<=3989;_++)z[_]=0;for(_=3994;_<=3997;_++)z[_]=0;for(_=4048;_<=4051;_++)z[_]=0;for(_=4056;_<=4063;_++)z[_]=0;for(_=4093;_<=4096;_++)z[_]=0;for(_=4390;_<=4398;_++)z[_]=0;for(_=4399;_<=4413;_++)z[_]=2;for(_=4418;_<=4433;_++)z[_]=2;for(_=4455;_<=4457;_++)z[_]=2;for(_=4484;_<=4489;_++)z[_]=0;for(_=4491;_<=4554;_++)z[_]=0;for(_=4568;_<=4589;_++)z[_]=0;for(_=4652;_<=4656;_++)z[_]=0;for(_=4766;_<=4800;_++)z[_]=0;for(_=5014;_<=5016;_++)z[_]=0;for(_=5069;_<=5072;_++)z[_]=0;for(_=5105;_<=5130;_++)z[_]=0;for(_=5173;_<=5188;_++)z[_]=0;for(_=5253;_<=5259;_++)z[_]=0;for(_=5269;_<=5275;_++)z[_]=0;for(_=5292;_<=5311;_++)z[_]=0;for(_=5329;_<=5331;_++)z[_]=0;for(_=5343;_<=5349;_++)z[_]=0;for(_=5355;_<=5357;_++)z[_]=0;for(_=5387;_<=5389;_++)z[_]=0;for(_=5459;_<=5463;_++)z[_]=0;for(_=5479;_<=5482;_++)z[_]=0;for(_=5518;_<=5520;_++)z[_]=0;for(_=5530;_<=5539;_++)z[_]=0;for(_=5550;_<=5552;_++)z[_]=0;for(_=5562;_<=5583;_++)z[_]=0;for(_=5623;_<=5625;_++)z[_]=2;for(_=5631;_<=5639;_++)z[_]=0;for(_=5649;_<=5653;_++)z[_]=0;for(_=5663;_<=5680;_++)z[_]=0;for(_=5682;_<=5685;_++)z[_]=0;for(_=5875;_<=5877;_++)z[_]=0;for(_=5896;_<=5899;_++)z[_]=0;for(_=5921;_<=5940;_++)z[_]=0;for(_=6050;_<=6125;_++)z[_]=0;for(_=6244;_<=6275;_++)z[_]=0;for(_=6328;_<=6348;_++)z[_]=0;for(_=6350;_<=6356;_++)z[_]=0;for(_=6366;_<=6372;_++)z[_]=0;for(_=6381;_<=6387;_++)z[_]=0;for(_=6393;_<=6404;_++)z[_]=0;for(_=6480;_<=6483;_++)z[_]=0;for(_=6511;_<=6514;_++)z[_]=0;for(_=6579;_<=6581;_++)z[_]=0;for(_=6619;_<=6624;_++)z[_]=0;for(_=6625;_<=6627;_++)z[_]=2;for(_=6628;_<=6632;_++)z[_]=0;for(_=6634;_<=6637;_++)z[_]=0;for(_=6669;_<=6692;_++)z[_]=0;for(_=6707;_<=6709;_++)z[_]=0;for(_=6720;_<=6723;_++)z[_]=0;for(_=6732;_<=6738;_++)z[_]=0;for(_=6931;_<=6933;_++)z[_]=0;for(_=6956;_<=6959;_++)z[_]=0;for(_=7005;_<=7007;_++)z[_]=0;for(_=7057;_<=7070;_++)z[_]=2;for(_=7074;_<=7082;_++)z[_]=0;for(_=7109;_<=7118;_++)z[_]=0;for(_=7119;_<=7127;_++)z[_]=1;for(_=7374;_<=7376;_++)z[_]=0;for(_=7528;_<=7586;_++)z[_]=0;for(_=7587;_<=7645;_++)z[_]=2;for(_=7692;_<=7696;_++)z[_]=0;for(_=7755;_<=7787;_++)z[_]=0;for(_=7791;_<=7795;_++)z[_]=0;for(_=7799;_<=7801;_++)z[_]=0;for(_=7803;_<=7805;_++)z[_]=0;for(_=7825;_<=7831;_++)z[_]=0;for(_=7845;_<=7859;_++)z[_]=0;for(_=8013;_<=8032;_++)z[_]=0;for(_=8065;_<=8068;_++)z[_]=1;for(_=8518;_<=8529;_++)z[_]=2;for(_=8533;_<=8536;_++)z[_]=2;for(_=8538;_<=8540;_++)z[_]=2;for(_=8677;_<=8679;_++)z[_]=0;for(_=8836;_<=8840;_++)z[_]=0;for(_=8857;_<=8859;_++)z[_]=0;for(_=8908;_<=8910;_++)z[_]=0;for(_=9154;_<=9159;_++)z[_]=0;for(_=9205;_<=9218;_++)z[_]=0;for(_=9271;_<=9273;_++)z[_]=0;for(_=9295;_<=9297;_++)z[_]=0;for(_=9356;_<=9360;_++)z[_]=0;for(_=9404;_<=9407;_++)z[_]=0;for(_=9476;_<=9482;_++)z[_]=0;for(_=9487;_<=9494;_++)z[_]=0;for(_=9697;_<=9699;_++)z[_]=0;for(_=9821;_<=9865;_++)z[_]=0;for(_=20002;_<=20032;_++)z[_]=0;for(_=20047;_<=20049;_++)z[_]=0;for(_=20062;_<=20092;_++)z[_]=0;for(_=20135;_<=20138;_++)z[_]=0;for(_=20248;_<=20258;_++)z[_]=0;for(_=20348;_<=20358;_++)z[_]=0;for(_=20436;_<=20440;_++)z[_]=0;for(_=20822;_<=20824;_++)z[_]=0;for(_=20904;_<=20932;_++)z[_]=0;for(_=20934;_<=20936;_++)z[_]=0;for(_=21004;_<=21032;_++)z[_]=0;for(_=21035;_<=21037;_++)z[_]=0;for(_=21095;_<=21097;_++)z[_]=0;for(_=21148;_<=21150;_++)z[_]=0;for(_=21207;_<=21264;_++)z[_]=0;for(_=21307;_<=21364;_++)z[_]=0;for(_=21413;_<=21423;_++)z[_]=0;for(_=21453;_<=21463;_++)z[_]=0;for(_=21473;_<=21483;_++)z[_]=0;for(_=21780;_<=21782;_++)z[_]=0;for(_=21891;_<=21894;_++)z[_]=0;for(_=21896;_<=21899;_++)z[_]=0;for(_=22171;_<=22177;_++)z[_]=0;for(_=22181;_<=22187;_++)z[_]=0;for(_=22191;_<=22197;_++)z[_]=0;for(_=22207;_<=22222;_++)z[_]=0;for(_=22234;_<=22236;_++)z[_]=0;for(_=22243;_<=22250;_++)z[_]=0;for(_=22262;_<=22265;_++)z[_]=0;for(_=22307;_<=22322;_++)z[_]=0;for(_=22348;_<=22357;_++)z[_]=0;for(_=22407;_<=22422;_++)z[_]=0;for(_=22462;_<=22465;_++)z[_]=0;for(_=22521;_<=22525;_++)z[_]=0;for(_=22607;_<=22622;_++)z[_]=0;for(_=22641;_<=22646;_++)z[_]=0;for(_=22648;_<=22657;_++)z[_]=0;for(_=22707;_<=22722;_++)z[_]=0;for(_=22762;_<=22765;_++)z[_]=0;for(_=22991;_<=22994;_++)z[_]=0;for(_=23028;_<=23038;_++)z[_]=0;for(_=23830;_<=23853;_++)z[_]=0;for(_=23866;_<=23872;_++)z[_]=0;for(_=23877;_<=23884;_++)z[_]=0;for(_=23886;_<=23894;_++)z[_]=0;for(_=23946;_<=23948;_++)z[_]=0;for(_=24311;_<=24313;_++)z[_]=0;for(_=24342;_<=24347;_++)z[_]=0;for(_=24370;_<=24374;_++)z[_]=10;for(_=24375;_<=24381;_++)z[_]=0;for(_=24718;_<=24721;_++)z[_]=0;for(_=24817;_<=24821;_++)z[_]=0;for(_=24877;_<=24882;_++)z[_]=0;for(_=24891;_<=24893;_++)z[_]=0;for(_=25391;_<=25395;_++)z[_]=0;for(_=25828;_<=25838;_++)z[_]=0;for(_=26191;_<=26195;_++)z[_]=0;for(_=26391;_<=26393;_++)z[_]=0;for(_=26701;_<=26722;_++)z[_]=0;for(_=26729;_<=26799;_++)z[_]=2;for(_=26801;_<=26803;_++)z[_]=2;for(_=26811;_<=26813;_++)z[_]=2;for(_=26847;_<=26870;_++)z[_]=2;for(_=26891;_<=26899;_++)z[_]=0;for(_=26901;_<=26923;_++)z[_]=0;for(_=26929;_<=26946;_++)z[_]=0;for(_=26948;_<=26998;_++)z[_]=0;for(_=27037;_<=27040;_++)z[_]=0;for(_=27205;_<=27232;_++)z[_]=0;for(_=27258;_<=27260;_++)z[_]=0;for(_=27391;_<=27398;_++)z[_]=0;for(_=27561;_<=27564;_++)z[_]=0;for(_=27571;_<=27574;_++)z[_]=0;for(_=27581;_<=27584;_++)z[_]=0;for(_=27591;_<=27594;_++)z[_]=0;for(_=28191;_<=28193;_++)z[_]=0;for(_=28348;_<=28358;_++)z[_]=0;for(_=28402;_<=28432;_++)z[_]=0;for(_=28462;_<=28492;_++)z[_]=0;for(_=29118;_<=29122;_++)z[_]=0;for(_=29168;_<=29172;_++)z[_]=0;for(_=29177;_<=29185;_++)z[_]=0;for(_=29187;_<=29195;_++)z[_]=0;for(_=29900;_<=29903;_++)z[_]=0;for(_=30161;_<=30179;_++)z[_]=0;for(_=30491;_<=30494;_++)z[_]=0;for(_=30729;_<=30732;_++)z[_]=0;for(_=31251;_<=31259;_++)z[_]=0;for(_=31265;_<=31268;_++)z[_]=0;for(_=31275;_<=31279;_++)z[_]=0;for(_=31281;_<=31297;_++)z[_]=0;for(_=31461;_<=31469;_++)z[_]=0;for(_=31491;_<=31495;_++)z[_]=0;for(_=31917;_<=31922;_++)z[_]=0;for(_=31965;_<=32e3;_++)z[_]=0;for(_=32001;_<=32003;_++)z[_]=2;for(_=32005;_<=32031;_++)z[_]=2;for(_=32033;_<=32060;_++)z[_]=2;for(_=32064;_<=32067;_++)z[_]=2;for(_=32074;_<=32077;_++)z[_]=2;for(_=32081;_<=32086;_++)z[_]=0;for(_=32107;_<=32130;_++)z[_]=0;for(_=32133;_<=32159;_++)z[_]=0;for(_=32164;_<=32167;_++)z[_]=2;for(_=32180;_<=32199;_++)z[_]=0;for(_=32201;_<=32260;_++)z[_]=0;for(_=32301;_<=32360;_++)z[_]=0;for(_=32601;_<=32662;_++)z[_]=0;for(_=32664;_<=32667;_++)z[_]=2;for(_=32701;_<=32761;_++)z[_]=0;for(_=53001;_<=53004;_++)z[_]=0;for(_=53008;_<=53019;_++)z[_]=0;for(_=53021;_<=53032;_++)z[_]=0;for(_=53034;_<=53037;_++)z[_]=0;for(_=53042;_<=53046;_++)z[_]=0;for(_=53074;_<=53080;_++)z[_]=0;for(_=54001;_<=54004;_++)z[_]=0;for(_=54008;_<=54019;_++)z[_]=0;for(_=54021;_<=54032;_++)z[_]=0;for(_=54034;_<=54037;_++)z[_]=0;for(_=54042;_<=54046;_++)z[_]=0;for(_=54048;_<=54053;_++)z[_]=0;for(_=54074;_<=54080;_++)z[_]=0;for(_=54098;_<=54101;_++)z[_]=0;for(_=102001;_<=102040;_++)z[_]=0;for(_=102042;_<=102063;_++)z[_]=0;for(_=102065;_<=102067;_++)z[_]=0;for(_=102070;_<=102117;_++)z[_]=0;for(_=102122;_<=102216;_++)z[_]=0;for(_=102221;_<=102377;_++)z[_]=0;for(_=102382;_<=102388;_++)z[_]=0;for(_=102389;_<=102398;_++)z[_]=2;for(_=102399;_<=102444;_++)z[_]=0;for(_=102445;_<=102447;_++)z[_]=2;for(_=102448;_<=102458;_++)z[_]=0;for(_=102459;_<=102468;_++)z[_]=2;for(_=102469;_<=102499;_++)z[_]=0;for(_=102500;_<=102519;_++)z[_]=1;for(_=102520;_<=102524;_++)z[_]=0;for(_=102525;_<=102529;_++)z[_]=2;for(_=102530;_<=102588;_++)z[_]=0;for(_=102590;_<=102598;_++)z[_]=0;for(_=102601;_<=102603;_++)z[_]=0;for(_=102605;_<=102628;_++)z[_]=0;for(_=102629;_<=102646;_++)z[_]=2;for(_=102648;_<=102700;_++)z[_]=2;for(_=102701;_<=102703;_++)z[_]=0;for(_=102707;_<=102730;_++)z[_]=2;for(_=102733;_<=102758;_++)z[_]=2;for(_=102767;_<=102900;_++)z[_]=0;for(_=102901;_<=102933;_++)z[_]=2;for(_=102934;_<=102950;_++)z[_]=13;for(_=102951;_<=102955;_++)z[_]=0;for(_=102961;_<=102963;_++)z[_]=0;for(_=102965;_<=102969;_++)z[_]=0;for(_=102971;_<=102973;_++)z[_]=0;for(_=102975;_<=102989;_++)z[_]=0;for(_=102990;_<=102992;_++)z[_]=1;for(_=102997;_<=103002;_++)z[_]=0;for(_=103003;_<=103008;_++)z[_]=2;for(_=103009;_<=103011;_++)z[_]=0;for(_=103012;_<=103014;_++)z[_]=2;for(_=103019;_<=103021;_++)z[_]=0;for(_=103022;_<=103024;_++)z[_]=2;for(_=103029;_<=103031;_++)z[_]=0;for(_=103032;_<=103034;_++)z[_]=2;for(_=103065;_<=103068;_++)z[_]=0;for(_=103074;_<=103076;_++)z[_]=0;for(_=103077;_<=103079;_++)z[_]=1;for(_=103080;_<=103082;_++)z[_]=0;for(_=103083;_<=103085;_++)z[_]=2;for(_=103090;_<=103093;_++)z[_]=0;for(_=103097;_<=103099;_++)z[_]=0;for(_=103100;_<=103102;_++)z[_]=2;for(_=103107;_<=103109;_++)z[_]=0;for(_=103110;_<=103112;_++)z[_]=2;for(_=103113;_<=103116;_++)z[_]=0;for(_=103117;_<=103120;_++)z[_]=2;for(_=103153;_<=103157;_++)z[_]=0;for(_=103158;_<=103162;_++)z[_]=2;for(_=103163;_<=103165;_++)z[_]=0;for(_=103166;_<=103168;_++)z[_]=1;for(_=103169;_<=103171;_++)z[_]=2;for(_=103186;_<=103188;_++)z[_]=0;for(_=103189;_<=103191;_++)z[_]=2;for(_=103192;_<=103195;_++)z[_]=0;for(_=103196;_<=103199;_++)z[_]=2;for(_=103200;_<=103224;_++)z[_]=0;for(_=103225;_<=103227;_++)z[_]=1;for(_=103232;_<=103237;_++)z[_]=0;for(_=103238;_<=103243;_++)z[_]=2;for(_=103244;_<=103246;_++)z[_]=0;for(_=103247;_<=103249;_++)z[_]=2;for(_=103254;_<=103256;_++)z[_]=0;for(_=103257;_<=103259;_++)z[_]=2;for(_=103264;_<=103266;_++)z[_]=0;for(_=103267;_<=103269;_++)z[_]=2;for(_=103300;_<=103375;_++)z[_]=0;for(_=103381;_<=103383;_++)z[_]=0;for(_=103384;_<=103386;_++)z[_]=1;for(_=103387;_<=103389;_++)z[_]=0;for(_=103390;_<=103392;_++)z[_]=2;for(_=103397;_<=103399;_++)z[_]=0;for(_=103400;_<=103471;_++)z[_]=2;for(_=103476;_<=103478;_++)z[_]=0;for(_=103479;_<=103481;_++)z[_]=2;for(_=103486;_<=103488;_++)z[_]=0;for(_=103489;_<=103491;_++)z[_]=2;for(_=103492;_<=103495;_++)z[_]=0;for(_=103496;_<=103499;_++)z[_]=2;for(_=103528;_<=103543;_++)z[_]=0;for(_=103544;_<=103548;_++)z[_]=2;for(_=103549;_<=103551;_++)z[_]=0;for(_=103552;_<=103554;_++)z[_]=1;for(_=103555;_<=103557;_++)z[_]=2;for(_=103558;_<=103560;_++)z[_]=0;for(_=103571;_<=103573;_++)z[_]=0;for(_=103574;_<=103576;_++)z[_]=2;for(_=103577;_<=103580;_++)z[_]=0;for(_=103581;_<=103583;_++)z[_]=2;for(_=103595;_<=103694;_++)z[_]=0;for(_=103696;_<=103699;_++)z[_]=0;for(_=103700;_<=103793;_++)z[_]=2;for(_=103794;_<=103890;_++)z[_]=0;for(_=103891;_<=103896;_++)z[_]=2;for(_=103900;_<=103971;_++)z[_]=2;for(_=103972;_<=103977;_++)z[_]=0;for(_=112e3;_<=112101;_++)z[_]=0;const fqe={102113:!0,102100:!0,3857:!0,3785:!0},mqe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},sle='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',fN=[-20037508342788905e-9,20037508342788905e-9],mN=[-20037508342787e-6,20037508342787e-6],Jbe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fN,origin:mN,dx:1e-5},102100:{wkTemplate:sle,valid:fN,origin:mN,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fN,origin:mN,dx:1e-5},3857:{wkTemplate:sle,valid:fN,origin:mN,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function us(t,e){return t===e||!A(t)&&!A(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||xy(t)&&xy(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function dd(t){return Vo(t)&&t.wkid&&Jbe[t.wkid]||null}function Dk(t){return!!Vo(t)&&(t.wkid?z[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function w$(t){return!(Ly(t)||Dy(t))}function x$(t){return Vo(t)&&t.wkid===4326}function Kbe(t){return Vo(t)&&t.wkid===xp.CGCS2000}function xy(t){return Vo(t)&&t.wkid!=null&&fqe[t.wkid]===!0}function Iee(t){return Vo(t)&&t.wkid===32662}function $ee(t){return t===xp.GCSMARS2000||t===xp.GCSMARS2000_SPHERE}function Ly(t){return Vo(t)&&t.wkid!=null&&$ee(t.wkid)}function Lee(t){return t===xp.GCSMOON2000}function Dy(t){return Vo(t)&&t.wkid!=null&&Lee(t.wkid)}function gqe(t){return Vo(t)&&t.wkid!=null&&mqe[t.wkid]===!0}function Vo(t){return b(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const Dq={wkid:4326,wkt:wm(Jbe[4326].wkTemplate,{Central_Meridian:"0.0"})},yqe={wkid:102100,latestWkid:3857},_qe={wkid:32662};function Dee(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Qbe=Dee(zi),Nee=Dee(cy),Fee=Dee(k_),ewe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${zi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function ur(t){return b(t)&&(Ly(t)||us(t,Nee))?cy:b(t)&&(Dy(t)||us(t,Fee))?k_:zi}function d7t(t){return $ee(t)?cy:Lee(t)?k_:zi}const Uee=39.37,vqe=zi.radius*Math.PI/200,twe=/UNIT\[([^\]]+)\]\]$/i,d2=z,iwe=/UNIT\[([^\]]+)\]/i,bqe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),wqe=jl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Ym=t=>t*t,xv=t=>t*t*t,T$={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Ym(.001)},"square-centimeters":{inBaseUnits:Ym(.01)},"square-decimeters":{inBaseUnits:Ym(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Ym(1e3)},"square-inches":{inBaseUnits:Ym(.0254)},"square-feet":{inBaseUnits:Ym(.3048)},"square-yards":{inBaseUnits:Ym(.9144)},"square-miles":{inBaseUnits:Ym(1609.344)},"square-us-feet":{inBaseUnits:Ym(1200/3937)},acres:{inBaseUnits:.0015625*Ym(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*xv(.001)},"cubic-centimeters":{inBaseUnits:1e3*xv(.01)},"cubic-decimeters":{inBaseUnits:1e3*xv(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*xv(1e3)},"cubic-inches":{inBaseUnits:1e3*xv(.0254)},"cubic-feet":{inBaseUnits:1e3*xv(.3048)},"cubic-yards":{inBaseUnits:1e3*xv(.9144)},"cubic-miles":{inBaseUnits:1e3*xv(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},xqe=(()=>{const t={};for(const e in T$)for(const i in T$[e].units)t[i]=e;return t})();function Tqe(t,e,i){return t*T$[i].units[e].inBaseUnits}function Sqe(t,e,i){return t/T$[i].units[e].inBaseUnits}const rwe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],Eqe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function Nq(t){const e=xqe[t];if(!e)throw new Error("unknown type");return e}function nle(t,e=null){return e=e||Nq(t),T$[e].baseUnit===t}function Zr(t,e,i){if(e===i)return t;const r=Nq(e);if(r!==Nq(i))throw new Error("incompatible units");const s=nle(e,r)?t:Tqe(t,e,r);return nle(i,r)?s:Sqe(s,i,r)}function p7t(t,e,i){switch(i){case"metric":return kee(t,e);case"imperial":return zee(t,e);default:return i}}function f7t(t,e,i){switch(i){case"metric":return Vee(t,e);case"imperial":return Bee(t,e);default:return i}}function kee(t,e){const i=Zr(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function Vee(t,e){const i=Zr(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function zee(t,e){const i=Zr(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function Bee(t,e){const i=Zr(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function Cqe(t,e){const i=Zr(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function Mqe(t,e){const i=Zr(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function swe(t,e,i){return Zr(t,e,"meters")/(i*Math.PI/180)}function nwe(t){return wqe.fromJSON(t.toLowerCase())||null}function L2(t){if(b(t)&&!w$(t))return 1;const e=Ec(t);return e>1e5?1:e}function owe(t){return Ec(t)>=ur(t).metersPerDegree?"meters":v3(t)}function Ec(t,e=zi.metersPerDegree){return vt(Aqe(t,!0),e)}function Aqe(t,e=!1){const i=b(t)?t.wkid:null,r=b(t)?t.wkt:null;let s=null;if(i){if($ee(i))return cy.metersPerDegree;if(Lee(i))return k_.metersPerDegree;s=d2.values[d2[i]],!s&&e&&bqe.has(i)&&(s=vqe)}else r&&(cwe(r)?s=ole(twe.exec(r),s):lwe(r)&&(s=ole(iwe.exec(r),s)));return s}function ole(t,e){return t&&t[1]?awe(t[1]):e}function awe(t){return parseFloat(t.split(",")[1])}function v3(t){const e=b(t)?t.wkid:null,i=b(t)?t.wkt:null;let r=null;if(e)r=d2.units[d2[e]];else if(i){const s=cwe(i)?twe:lwe(i)?iwe:null;if(s){const n=s.exec(i);n&&n[1]&&(r=Rqe(n[1]))}}return b(r)?nwe(r):null}function m7t(t){const e=v3(t);return A(e)||!rwe.includes(e)?null:e}function g7t(t){const e=owe(t);return A(e)||!rwe.includes(e)?null:e}function y7t(t){const e=v3(t);return A(e)?null:Eqe.get(e)}function lwe(t){return/^GEOCCS/i.test(t)}function cwe(t){return/^PROJCS/i.test(t)}const Oqe=1e-7;function Rqe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let i=e&&e[1];if(!i||!d2.units.includes(i)){const r=awe(t);i=null;const s=d2.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<Oqe){i=d2.units[n];break}}return i}function _7t(t){const e=v3(t);if(A(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const Pqe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Iqe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},$qe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Lqe=jl()(Pqe),Dqe=jl()(Iqe),v7t=jl()($qe);var pg;let ns=pg=class extends Ae{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return pg.WebMercator;if(t.wkid===4326)return pg.WGS84}const e=new pg;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return x$(this)}get isWebMercator(){return xy(this)}get isGeographic(){return Dk(this)}get isWrappable(){return gqe(this)}get metersPerUnit(){return Ec(this)}get unit(){return v3(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===pg.WGS84)return pg.WGS84;if(this===pg.WebMercator)return pg.WebMercator;const t=new pg;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ue(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return us(this,t)}toJSON(t){return this.write(void 0,t)}};ns.GCS_NAD_1927=null,ns.WGS84=null,ns.WebMercator=null,ns.PlateCarree=null,u([p({readOnly:!0})],ns.prototype,"isWGS84",null),u([p({readOnly:!0})],ns.prototype,"isWebMercator",null),u([p({readOnly:!0})],ns.prototype,"isGeographic",null),u([p({readOnly:!0})],ns.prototype,"isWrappable",null),u([p({type:Fr,json:{write:!0}})],ns.prototype,"latestWkid",void 0),u([p({readOnly:!0})],ns.prototype,"metersPerUnit",null),u([p({readOnly:!0})],ns.prototype,"unit",null),u([p({type:Fr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],ns.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],ns.prototype,"wkt",void 0),u([Xe("wkt"),Xe("web-scene","wkt")],ns.prototype,"writeWkt",null),u([p({type:Fr,json:{write:!0}})],ns.prototype,"vcsWkid",void 0),u([p({type:Fr,json:{write:!0}})],ns.prototype,"latestVcsWkid",void 0),u([p()],ns.prototype,"imageCoordinateSystem",void 0),ns=pg=u([N("esri.geometry.SpatialReference")],ns),ns.prototype.toJSON.isDefaultToJSON=!0,ns.GCS_NAD_1927=new ns({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),ns.WGS84=new ns(Dq),ns.WebMercator=new ns(yqe),ns.PlateCarree=new ns(_qe),Object.freeze&&(Object.freeze(ns.GCS_NAD_1927),Object.freeze(ns.WGS84),Object.freeze(ns.WebMercator));const Ye=ns,uwe="20230301",hwe="2657e728c1857e6d94c324181c0788310bb0958a",dwe="4.26",Nqe={async request(t,e){var a,l;const{default:i}=await se(()=>Promise.resolve().then(()=>Kqe),void 0),r=t.options,s=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=jbe(t.url))!=null&&a.after)?s:"array-buffer";const n=await i(t.url,r),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let es;function b7t(t){es=t}function w7t(t){const e=es&&es.findCredential(t);return e&&e.token?Xbe(t,"token",e.token):t}me("host-webworker");const Fqe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function pwe(t){const e=fm(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!Fqe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function fwe(t,e,i=!1,r){return new Promise((s,n)=>{if(yo(r))return void n(ale());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(ale())};const c=()=>{me("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,b(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};b(r)&&r.addEventListener("abort",l),me("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function ale(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function Uqe(t){Mr.request.crossOriginNoCorsDomains||(Mr.request.crossOriginNoCorsDomains={});const e=Mr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[fm(i)??""]=0:(e[fm("http://"+i)??""]=0,e[fm("https://"+i)??""]=0)}function kqe(t){const e=Mr.request.crossOriginNoCorsDomains;if(e){let i=fm(t);if(i)return i=i.toLowerCase(),!TA(i,See())&&e[i]<Date.now()-36e5}return!1}async function Vqe(t){var s;const e=Mr.request.crossOriginNoCorsDomains,i=fm(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=jo(t);t=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function tr(t,e){var c;const i=$y(t),r=SA(t);r||i||(t=Op(t));const s={url:t,requestOptions:{...e}};let n=jbe(t);if(n){const h=await Yqe(n,s);if(h!=null)return{data:h,getHeader:Gee,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"){if(me("host-webworker")||me("host-node"))throw tm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw tm("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),s);if(e.method==="head"){if(e.body)throw tm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw tm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await Hqe(),oU)return oU.execute(t,e);const o=new AbortController;ol(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Wf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await Zqe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let oU;const Wf=Mr.request,mwe="FormData"in globalThis,zqe=[499,498,403,401],Bqe=["COM_0056","COM_0057","SB_0008"],Gqe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Gee=()=>null,aU=Symbol();function jqe(t){const e=fm(t);e&&!tr._corsServers.includes(e)&&tr._corsServers.push(e)}function lle(t){const e=fm(t);return!e||e.endsWith(".arcgis.com")||tr._corsServers.includes(e)||Cee(e)}function tm(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:Gee,ssl:!1};if(e instanceof J)return e.details?(e.details=ue(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=aU in e?e[aU]:e}return kn(e)?er():new J(t,s,n)}async function Hqe(){me("host-webworker")?oU||(oU=await se(()=>import("./request-0fbef26d.js"),[])):tr._abortableFetch||(tr._abortableFetch=globalThis.fetch.bind(globalThis))}async function Fq(){es||await se(()=>import("./IdentityManager-778c05c5.js"),[])}async function qqe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(mwe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust&&!tr._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Wf.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&Mr.apiKey&&pwe(e)&&(i.query||(i.query={}),i.query.token=Mr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!gwe(e)&&!yo(r)){let l;i.authMode==="immediate"?(await Fq(),l=await es.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await Fq(),l=await es.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):es&&(l=es.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function gwe(t){return Gqe.some(e=>e.test(t))}async function Wqe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=SA(e)||$y(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Wf.timeout;let a=!1;if(!s){t.useSSL&&(e=Ree(e)),i.cacheBust&&r.cache==="default"&&(e=Xbe(e,"request.preventCache",Date.now()));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=xA(f);me("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=e.length+1+m.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>Wf.maxUrlLength;const v=i.useProxy||!!Lk(e);if(v){const x=XHe(e);y=x.path,!a&&y.length+1+g>Wf.maxUrlLength&&(a=!0),x.query&&(f={...x.query,...f})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>Wf.maxUrlLength?tm("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):tm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw tm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=P5(e,f):(r.body=xA(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=P5(e,f),v&&(t.useProxy=!0,e=`${y}?${e}`),f.token&&mwe&&r.body instanceof FormData&&!UHe(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!TA(e,See())){if(Cee(e))t.withCredentials=!0;else if(es){const x=es.findServerInfo(e);x&&x.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",kqe(e)&&await Vqe(a?P5(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||Xqe(i.headers)||!s&&!t.useProxy&&Wf.proxyUrl&&!lle(e)){if(l=await tr._abortableFetch(e,r),t.useProxy||jqe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=cle(c,"application/xml");break;case"document":c=cle(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await ule(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await ule(e,t)}catch(f){if(f.name==="AbortError")throw d?new Error("Timeout exceeded"):er("Request canceled");if(!(!l&&f instanceof TypeError&&Wf.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||lle(e))throw f;t.redoRequest=!0,JHe({proxyUrl:Wf.proxyUrl,urlPrefix:fm(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function Yqe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=tm("request:interceptor",s,e)}if((r instanceof Error||r instanceof J)&&(i=tm("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function Xqe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function cle(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function Zqe(t){var n;let e,i;await qqe(t);try{do[e,i]=await Wqe(t);while(!await Jqe(t,e,i))}catch(o){const a=tm("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((n=i.user)!=null&&n.username)&&!Cee(r)){const o=fm(r,!0);o&&Wf.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&Uqe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&es){const o=es.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=es.findCredential(a,s.userId);l&&es._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:e?o=>e==null?void 0:e.headers.get(o):Gee,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function Jqe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[aU]=i,s;i&&(i.error?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[aU]=i,s.details=i.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&zqe.includes(n)&&!gwe(t.params.url)&&(n!==403||o&&!Bqe.includes(o)&&(a==null||a===2&&t.credentialToken))){await Fq();try{const c=await es.getCredential(t.params.url,{error:tm("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function ule(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Wf.priority,s.src=t,fwe(s,t,i,r)}tr._abortableFetch=null,tr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const Kqe=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"}));function De(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=gbe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let fg=class extends Ae{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ye.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Ye)return e;if(e!=null){const r=new Ye;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([p()],fg.prototype,"type",void 0),u([p({readOnly:!0})],fg.prototype,"cache",null),u([p({readOnly:!0})],fg.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],fg.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],fg.prototype,"hasZ",void 0),u([p({type:Ye,json:{write:!0},value:Ye.WGS84})],fg.prototype,"spatialReference",void 0),u([De("spatialReference")],fg.prototype,"readSpatialReference",null),fg=u([N("esri.geometry.Geometry")],fg);const K_=fg,Qqe=Object.prototype.toString;function eWe(t){const e="__accessorMetadata__"in t?Vn(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return tWe.apply(this,i)}}function tWe(t,e,i,r){Ek(t,e).cast=r}function iWe(t){return(e,i)=>{Ek(e,t).cast=e[i]}}function pi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&Qqe.call(t[0])==="[object Function]"?eWe(t[0]):t.length===1&&typeof t[0]=="string"?iWe(t[0]):void 0}function rWe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}const sWe=57.29577951308232,nWe=.017453292519943;function hle(t){return t*sWe}function dle(t){return t*nWe}function ple(t){return t/zi.radius}function lU(t){return Math.PI/2-2*Math.atan(Math.exp(-t/zi.radius))}function Uq(t){return t.wkid!=null||t.wkt!=null}const DB=[0,0];function cU(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,DB,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,DB,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,DB,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function uy(t,e){const i=t&&(Uq(t)?t:t.spatialReference),r=e&&(Uq(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!us(r,i)||xy(r)&&x$(i)||xy(i)&&x$(r))}function _S(t,e){if(A(t))return null;const i=t.spatialReference,r=e&&(Uq(e)?e:e.spatialReference);return uy(i,r)?us(i,r)?ue(t):xy(r)?cU(t,QT,Ye.WebMercator,!1,ue(t)):x$(r)?cU(t,GM,Ye.WGS84,!1,ue(t)):null:null}function QT(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=dle(e);return i[0]=dle(t)*zi.radius,i[1]=zi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function GM(t,e,i=[0,0],r=!1){const s=hle(t/zi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=hle(Math.PI/2-2*Math.atan(Math.exp(-e/zi.radius))),i}function hy(t,e=!1,i=ue(t)){return cU(t,QT,Ye.WebMercator,e,i)}function ub(t,e=!1,i=ue(t)){return cU(t,GM,Ye.WGS84,e,i)}var I5;const wO=[0,0];function fle(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Fc=I5=class extends K_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ye(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)le.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)le.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=QT(n.longitude,n.latitude,wO);t=a[0],e=a[1]}}}else fle(i)?(s=i,i=null):fle(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?le.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&le.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return GM(e,i,wO)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",QT(i,t,wO)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return GM(t,e,wO)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",QT(t,e,wO)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new I5;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return I5.copy(t,this),this}equals(t){if(A(t))return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=QT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=GM(l,c),h=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=dd(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return rWe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Fc.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Fc.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Fc.prototype,"hasZ",null),u([p({type:Number})],Fc.prototype,"latitude",null),u([p({type:Number})],Fc.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),pi(t=>isNaN(t)?t:mp(t))],Fc.prototype,"x",void 0),u([Xe("x")],Fc.prototype,"writeX",null),u([De("x")],Fc.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],Fc.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fc.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fc.prototype,"m",void 0),Fc=I5=u([N("esri.geometry.Point")],Fc),Fc.prototype.toJSON.isDefaultToJSON=!0;const st=Fc,NB=[0,0];function Nk(t,e){return!!b(e)&&hc(t,e.x,e.y,e.z)}function T7t(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!EA(t,i))return!1;return!0}function oWe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?hc(t,i,r,s)&&hc(t,i,o,s)&&hc(t,n,o,s)&&hc(t,n,r,s)&&hc(t,i,r,a)&&hc(t,i,o,a)&&hc(t,n,o,a)&&hc(t,n,r,a):hc(t,i,r)&&hc(t,i,o)&&hc(t,n,o)&&hc(t,n,r)}function EA(t,e){return hc(t,e[0],e[1])}function aWe(t,e){return hc(t,e[0],e[1],e[2])}function hc(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function ywe(t,e){return NB[1]=e.y,NB[0]=e.x,lWe(t,NB)}function lWe(t,e){return _we(t.rings,e)}function _we(t,e){if(!t)return!1;if(cWe(t))return mle(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=mle(i,t[r],e);return i}function cWe(t){return!Array.isArray(t[0][0])}function mle(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(d-c)<r&&(n=!n)}return n}function uWe(t,e){return Nk(t,e)}function hWe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function dWe(t,e){const{points:i,hasZ:r}=e,s=r?aWe:EA;for(const n of i)if(s(t,n))return!0;return!1}const D2=[0,0],N2=[0,0],F2=[0,0],U2=[0,0],pWe=[D2,N2,F2,U2],vwe=[[F2,D2],[D2,N2],[N2,U2],[U2,F2]];function fWe(t,e){return mWe(t,e.rings)}function mWe(t,e){D2[0]=t.xmin,D2[1]=t.ymax,N2[0]=t.xmax,N2[1]=t.ymax,F2[0]=t.xmin,F2[1]=t.ymin,U2[0]=t.xmax,U2[1]=t.ymin;for(const i of pWe)if(_we(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(EA(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(EA(t,n)||bwe(r,n,vwe))return!0;r=n}}return!1}function gWe(t,e){D2[0]=t.xmin,D2[1]=t.ymax,N2[0]=t.xmax,N2[1]=t.ymax,F2[0]=t.xmin,F2[1]=t.ymin,U2[0]=t.xmax,U2[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(EA(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(EA(t,o)||bwe(s,o,vwe))return!0;s=o}}return!1}const Ha=[0,0];function yWe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(kq(n,o,c,h,Ha)&&!(Ha[0]===n[0]&&Ha[1]===n[1]||Ha[0]===c[0]&&Ha[1]===c[1]||Ha[0]===o[0]&&Ha[1]===o[1]||Ha[0]===h[0]&&Ha[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(kq(o,a,c,h,Ha)&&!(Ha[0]===o[0]&&Ha[1]===o[1]||Ha[0]===c[0]&&Ha[1]===c[1]||Ha[0]===a[0]&&Ha[1]===a[1]||Ha[0]===h[0]&&Ha[1]===h[1]))return!0}}}return!1}function bwe(t,e,i){for(let r=0;r<i.length;r++)if(kq(t,e,i[r][0],i[r][1]))return!0;return!1}function kq(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,h]=i,[d,f]=r,m=d-c,g=n-c,y=a-n,v=f-h,x=o-h,S=l-o,E=v*y-m*S;if(E===0)return!1;const C=(m*x-v*g)/E,R=(y*x-S*g)/E;return C>=0&&C<=1&&R>=0&&R<=1&&(s&&(s[0]=n+C*(a-n),s[1]=o+C*(l-o)),!0)}function _We(t){switch(t){case"esriGeometryEnvelope":case"extent":return hWe;case"esriGeometryMultipoint":case"multipoint":return dWe;case"esriGeometryPoint":case"point":return uWe;case"esriGeometryPolygon":case"polygon":return fWe;case"esriGeometryPolyline":case"polyline":return gWe}}var jd;function vWe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Tv(t,e,i){return e==null?i:i==null?e:t(e,i)}let Sa=jd=class extends K_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return vWe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ye.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Ye.WGS84}}static fromBounds(t,e){return new jd({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new jd({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new st({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new jd;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&uy(e,i)&&(t=e.isWebMercator?hy(t):ub(t,!0)),t.type==="point"?Nk(this,t):t.type==="extent"&&oWe(this,t)}equals(t){if(this===t)return!0;if(A(t))return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&uy(e,i)&&(t=e.isWebMercator?hy(t):ub(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(A(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!us(e,i)&&uy(e,i)&&(t=e.isWebMercator?hy(t):ub(t,!0)),_We(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Tv(Math.min,this.zmin,t.zmin),this.zmax=Tv(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Tv(Math.min,this.mmin,t.mmin),this.mmax=Tv(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:A(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Tv(Math.max,this.zmin,t.zmin),this.zmax=Tv(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Tv(Math.max,this.mmin,t.mmin),this.mmax=Tv(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=dd(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?ub(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new Ye(wm((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??dd(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||dd(o);const[d,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,t);const y=h.x,v=h.frameId,x=m===y&&a>0;if(a>2*f){const S=new jd(l<c?m:y,s,f,n,o),E=new jd(d,s,l<c?y:m,n,o),C=new jd(0,s,f,n,o),R=new jd(d,s,0,n,o),O=[],U=[];S.contains(C)&&O.push(g),S.contains(R)&&U.push(g),E.contains(C)&&O.push(v),E.contains(R)&&U.push(v);for(let L=g+1;L<v;L++)O.push(L),U.push(L);e.push({extent:S,frameIds:[g]},{extent:E,frameIds:[v]},{extent:C,frameIds:O},{extent:R,frameIds:U})}else m>y||x?e.push({extent:new jd(m,s,f,n,o),frameIds:[g]},{extent:new jd(d,s,y,n,o),frameIds:[v]}):e.push({extent:new jd(m,s,y,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([p({readOnly:!0})],Sa.prototype,"cache",null),u([p({readOnly:!0})],Sa.prototype,"center",null),u([p({readOnly:!0})],Sa.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Sa.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Sa.prototype,"hasZ",null),u([p({readOnly:!0})],Sa.prototype,"height",null),u([p({readOnly:!0})],Sa.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Sa.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],Sa.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Sa.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Sa.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],Sa.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],Sa.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Sa.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Sa.prototype,"zmax",void 0),Sa=jd=u([N("esri.geometry.Extent")],Sa),Sa.prototype.toJSON.isDefaultToJSON=!0;const ti=Sa;let vI;var r1e,s1e;const bWe=((r1e=globalThis.esriConfig)==null?void 0:r1e.locale)??((s1e=globalThis.dojoConfig)==null?void 0:s1e.locale);function wwe(){var t;return bWe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Rp(){return vI===void 0&&(vI=wwe()),vI}const bI=[];function xwe(t){return bI.push(t),{remove(){bI.splice(bI.indexOf(t),1)}}}const Vq=[];function jee(t){return Vq.push(t),{remove(){bI.splice(Vq.indexOf(t),1)}}}function wWe(){const t=wwe();vI!==t&&(vI=t,[...Vq].forEach(e=>{e.call(null,t)}),[...bI].forEach(e=>{e.call(null,t)}))}var n1e;(n1e=globalThis.addEventListener)==null||n1e.call(globalThis,"languagechange",wWe);var zq;const xWe=new Hi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Hd=zq=class extends Ee{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new zq({categories:this.categories?ue(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=_S(this.extent,Ye.WGS84);b(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>xWe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([p()],Hd.prototype,"categories",void 0),u([p()],Hd.prototype,"disableExtraQuery",void 0),u([p({type:ti})],Hd.prototype,"extent",void 0),u([p()],Hd.prototype,"filter",void 0),u([p()],Hd.prototype,"num",void 0),u([p()],Hd.prototype,"query",void 0),u([p()],Hd.prototype,"sortField",void 0),u([p()],Hd.prototype,"sortOrder",null),u([p()],Hd.prototype,"start",void 0),Hd=zq=u([N("esri.portal.PortalQueryParams")],Hd);const a_=Hd;let xx=class extends Ee{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],xx.prototype,"nextQueryParams",void 0),u([p()],xx.prototype,"queryParams",void 0),u([p()],xx.prototype,"results",void 0),u([p()],xx.prototype,"total",void 0),xx=u([N("esri.portal.PortalQueryResult")],xx);const TWe=xx;let v0=class extends Ae{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new J("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],v0.prototype,"created",void 0),u([p()],v0.prototype,"id",void 0),u([p()],v0.prototype,"portal",void 0),u([p()],v0.prototype,"title",void 0),u([p({readOnly:!0})],v0.prototype,"url",null),u([p()],v0.prototype,"username",void 0),v0=u([N("esri.portal.PortalFolder")],v0);const SWe=v0;let Ea=class extends Ae{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,i=this.thumbnail;return e&&i&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${i}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Ol(this.portal).request(this.url+"/categorySchema",e).then(i=>{const r=i.categorySchema||[];return r.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return Ol(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let i=this.thumbnailUrl;return i&&e&&(i+=`&w=${e}`),i}toJSON(){throw new J("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,i){let r=Vn(a_,e);const s=Ol(this.portal);return parseFloat(s.currentVersion)>5?(r=r||new a_,s.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",i)):(r=r?r.clone():new a_,r.query="group:"+this.id+(r.query?" "+r.query:""),s.queryItems(r,i))}_fetchCategorySchemaSet(e,i){const r=Ol(this.portal);return r.fetchSelf(r.authMode,!0,i).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new a_;return o.disableExtraQuery=!0,o.num=1,o.query=n,r.queryGroups(o,i)}throw new J("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new a_;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,i)}throw new J("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",i).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([p()],Ea.prototype,"access",void 0),u([p({type:Date})],Ea.prototype,"created",void 0),u([p()],Ea.prototype,"description",void 0),u([p()],Ea.prototype,"id",void 0),u([p()],Ea.prototype,"isInvitationOnly",void 0),u([p({type:Date})],Ea.prototype,"modified",void 0),u([p()],Ea.prototype,"owner",void 0),u([p()],Ea.prototype,"portal",void 0),u([p()],Ea.prototype,"snippet",void 0),u([p()],Ea.prototype,"sortField",void 0),u([p()],Ea.prototype,"sortOrder",void 0),u([p()],Ea.prototype,"tags",void 0),u([p()],Ea.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Ea.prototype,"thumbnailUrl",null),u([p()],Ea.prototype,"title",void 0),u([p({readOnly:!0})],Ea.prototype,"url",null),Ea=u([N("esri.portal.PortalGroup")],Ea);const Bq=Ea,EWe=Object.freeze(Object.defineProperty({__proto__:null,default:Bq},Symbol.toStringTag,{value:"Module"}));var Gq;let pn=Gq=class extends Ae{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t&&t.data,r=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=SWe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=Bq.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),se(()=>Promise.resolve().then(()=>Twe),void 0).then(({default:s})=>{i=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Bq({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new J("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new J("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new Gq;return e.sourceJSON=t,e.read(t),e}};u([p()],pn.prototype,"access",void 0),u([p({type:Date})],pn.prototype,"created",void 0),u([p()],pn.prototype,"culture",void 0),u([p()],pn.prototype,"description",void 0),u([p()],pn.prototype,"email",void 0),u([p()],pn.prototype,"favGroupId",void 0),u([p()],pn.prototype,"fullName",void 0),u([p({type:Date})],pn.prototype,"modified",void 0),u([p()],pn.prototype,"orgId",void 0),u([p()],pn.prototype,"portal",void 0),u([p()],pn.prototype,"preferredView",void 0),u([p()],pn.prototype,"privileges",void 0),u([p()],pn.prototype,"region",void 0),u([p()],pn.prototype,"role",void 0),u([p()],pn.prototype,"roleId",void 0),u([p()],pn.prototype,"sourceJSON",void 0),u([p()],pn.prototype,"thumbnail",void 0),u([p({readOnly:!0})],pn.prototype,"thumbnailUrl",null),u([p()],pn.prototype,"units",void 0),u([p({readOnly:!0})],pn.prototype,"userContentUrl",null),u([p({readOnly:!0})],pn.prototype,"url",null),u([p()],pn.prototype,"username",void 0),u([p()],pn.prototype,"userType",void 0),pn=Gq=u([N("esri.portal.PortalUser")],pn);const Hee=pn,CWe=Object.freeze(Object.defineProperty({__proto__:null,default:Hee},Symbol.toStringTag,{value:"Module"}));var Ph;let FB;const gle={PortalGroup:()=>se(()=>Promise.resolve().then(()=>EWe),void 0),PortalItem:()=>se(()=>Promise.resolve().then(()=>Twe),void 0),PortalUser:()=>se(()=>Promise.resolve().then(()=>CWe),void 0)};let rt=Ph=class extends GL(Tm){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Mr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=is(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Mr.request.trustedServers.includes(e)||Mr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Hee.fromJSON(t),e.portal=this),e}load(t){const e=se(()=>Promise.resolve().then(()=>XWe),void 0).then(({default:i})=>{_i(t),FB=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(es){const r=es;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Ph.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await se(()=>import("./ElevationLayer-43b970f0.js"),["assets/ElevationLayer-43b970f0.js","assets/ArcGISCachedService-1807d7a2.js","assets/TilemapCache-f203d1ee.js"])).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}fetchBasemaps(t,e){const i=new a_;return i.query=t||(Mr.apiKey&&pwe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,e).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,e)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new FB({portalItem:n})):[],s})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):yo(t)?Promise.reject(er()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new a_;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return yo(t)?Promise.reject(er()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Rp();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Rp();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return Ph._default&&!Ph._default.destroyed||(Ph._default=new Ph),Ph._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Rp().toLowerCase()},...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Vn(a_,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new TWe({nextQueryParams:l,queryParams:s,total:a.total,results:Ph._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Pl(l),a)));return i&&gle[i]?gle[i]().then(({default:o})=>(_i(r),n(o))):n()}signIn(){if(this.authMode===Ph.AUTH_MODE_ANONYMOUS)return Promise.reject(new J("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return es?es.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Ph._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Ph.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return tr(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new J("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Ph({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new J("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=FB.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s=[];if(i){const n=b(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};rt.AUTH_MODE_ANONYMOUS="anonymous",rt.AUTH_MODE_AUTO="auto",rt.AUTH_MODE_IMMEDIATE="immediate",u([p()],rt.prototype,"access",void 0),u([p()],rt.prototype,"allSSL",void 0),u([p()],rt.prototype,"authMode",void 0),u([p()],rt.prototype,"authorizedCrossOriginDomains",void 0),u([De("authorizedCrossOriginDomains")],rt.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],rt.prototype,"basemapGalleryGroupQuery",void 0),u([p()],rt.prototype,"bingKey",void 0),u([p()],rt.prototype,"canListApps",void 0),u([p()],rt.prototype,"canListData",void 0),u([p()],rt.prototype,"canListPreProvisionedItems",void 0),u([p()],rt.prototype,"canProvisionDirectPurchase",void 0),u([p()],rt.prototype,"canSearchPublic",void 0),u([p()],rt.prototype,"canShareBingPublic",void 0),u([p()],rt.prototype,"canSharePublic",void 0),u([p()],rt.prototype,"canSignInArcGIS",void 0),u([p()],rt.prototype,"canSignInIDP",void 0),u([p()],rt.prototype,"colorSetsGroupQuery",void 0),u([p()],rt.prototype,"commentsEnabled",void 0),u([p({type:Date})],rt.prototype,"created",void 0),u([p()],rt.prototype,"credential",void 0),u([p()],rt.prototype,"culture",void 0),u([p()],rt.prototype,"currentVersion",void 0),u([p()],rt.prototype,"customBaseUrl",void 0),u([p()],rt.prototype,"defaultBasemap",void 0),u([De("defaultBasemap")],rt.prototype,"readDefaultBasemap",null),u([p()],rt.prototype,"defaultDevBasemap",void 0),u([De("defaultDevBasemap")],rt.prototype,"readDefaultDevBasemap",null),u([p({type:ti})],rt.prototype,"defaultExtent",void 0),u([p()],rt.prototype,"defaultVectorBasemap",void 0),u([De("defaultVectorBasemap")],rt.prototype,"readDefaultVectorBasemap",null),u([p()],rt.prototype,"description",void 0),u([p()],rt.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],rt.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],rt.prototype,"extraQuery",null),u([p()],rt.prototype,"featuredGroups",void 0),u([p()],rt.prototype,"featuredItemsGroupQuery",void 0),u([p()],rt.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],rt.prototype,"livingAtlasGroupQuery",void 0),u([p()],rt.prototype,"hasCategorySchema",void 0),u([p()],rt.prototype,"helpBase",void 0),u([p()],rt.prototype,"helperServices",void 0),u([p()],rt.prototype,"helpMap",void 0),u([p()],rt.prototype,"homePageFeaturedContent",void 0),u([p()],rt.prototype,"homePageFeaturedContentCount",void 0),u([p()],rt.prototype,"httpPort",void 0),u([p()],rt.prototype,"httpsPort",void 0),u([p()],rt.prototype,"id",void 0),u([p()],rt.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],rt.prototype,"isOrganization",null),u([p()],rt.prototype,"isPortal",void 0),u([p()],rt.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],rt.prototype,"itemPageUrl",null),u([p()],rt.prototype,"layerTemplatesGroupQuery",void 0),u([p()],rt.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],rt.prototype,"modified",void 0),u([p()],rt.prototype,"name",void 0),u([p()],rt.prototype,"portalHostname",void 0),u([p()],rt.prototype,"portalMode",void 0),u([p()],rt.prototype,"portalProperties",void 0),u([p()],rt.prototype,"region",void 0),u([p({readOnly:!0})],rt.prototype,"restUrl",null),u([p()],rt.prototype,"rotatorPanels",void 0),u([p()],rt.prototype,"showHomePageDescription",void 0),u([p()],rt.prototype,"sourceJSON",void 0),u([p()],rt.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],rt.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],rt.prototype,"stylesGroupQuery3d",void 0),u([p()],rt.prototype,"supportsHostedServices",void 0),u([p()],rt.prototype,"symbolSetsGroupQuery",void 0),u([p()],rt.prototype,"templatesGroupQuery",void 0),u([p()],rt.prototype,"thumbnail",void 0),u([p({readOnly:!0})],rt.prototype,"thumbnailUrl",null),u([p()],rt.prototype,"units",void 0),u([p()],rt.prototype,"url",void 0),u([p()],rt.prototype,"urlKey",void 0),u([De("urlKey")],rt.prototype,"readUrlKey",null),u([p()],rt.prototype,"user",void 0),u([De("user")],rt.prototype,"readUser",null),u([p()],rt.prototype,"useStandardizedQuery",void 0),u([p()],rt.prototype,"useVectorBasemaps",void 0),u([p()],rt.prototype,"vectorBasemapGalleryGroupQuery",void 0),rt=Ph=u([N("esri.portal.Portal")],rt);const du=rt,MWe=le.getLogger("esri.assets");function AWe(t,e){return tr(Cr(t),e)}function Cr(t){if(!Mr.assetsPath)throw MWe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new J("assets:path-not-set","config.assetsPath is not set");return $2(Mr.assetsPath,t)}let c1=class extends Ee{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){b(e)&&hd(e)?le.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.url;if(A(r))throw new J("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:Hn(i,"signal")})}async update(e,i){return(await se(()=>import("./resourceUtils-b16438b0.js"),[])).addOrUpdateResource(this,"update",e,i)}hasPath(){return b(this.path)}_normalizePath(e,i){return A(e)?e:(e=e.replace(/^\/+/,""),b(i)&&hd(e)&&(e=Mee(e,i.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([p()],c1.prototype,"portalItem",void 0),u([p({type:String,value:null})],c1.prototype,"path",null),u([pi("path")],c1.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],c1.prototype,"url",null),u([p({type:String,readOnly:!0})],c1.prototype,"itemRelativeUrl",null),c1=u([N("esri.portal.PortalItemResource")],c1);const OWe=c1;let VR=class extends Ee{constructor(e){super(e),this.created=null,this.rating=null}};u([p()],VR.prototype,"created",void 0),u([p()],VR.prototype,"rating",void 0),VR=u([N("esri.portal.PortalRating")],VR);const UB=VR;var Tx;const RWe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),PWe=new Set(["KML","GeoJson","CSV"]);let Ui=Tx=class extends GL(Tm){static from(t){return U_(Tx,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"&&(i="Insights Report"),i}readExtent(t){return t&&t.length?new ti(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",s?Cr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&RWe.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=du.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:b(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof UB&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new UB({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ue(this.applicationProxies),avgRating:this.avgRating,categories:ue(this.categories),created:ue(this.created),culture:this.culture,description:this.description,extent:ue(this.extent),groupCategories:ue(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ue(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ue(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ue(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ue(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Tx({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]&&(t[i]=t[i].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Ol(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Ol(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Ol(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new UB(e)):null}fetchRelatedItems(t,e){return Ol(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Tx)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Ol(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Ol(this.portal).signIn()).then(()=>{const e=t&&t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new J("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new J("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await Ol(e).signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Tx({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")$y(e)?r.query={data:e}:r.query={url:nd(e)},b(i)&&(r.query.filename=i);else{const s=new FormData;b(i)?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new J("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await se(()=>import("./resourceUtils-b16438b0.js"),[])).fetchResources(this,t,e)}async addResource(t,e,i){const r=await se(()=>import("./resourceUtils-b16438b0.js"),[]);return t.portalItem=this,r.addOrUpdateResource(t,"add",e,i)}async removeResource(t,e){const i=await se(()=>import("./resourceUtils-b16438b0.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new J("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,t,e)}async removeAllResources(t){return(await se(()=>import("./resourceUtils-b16438b0.js"),[])).removeAllResources(this,t)}resourceFromPath(t){return new OWe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ue(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ue(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ue(this.typeKeywords),url:this.url};return I1e(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Tx({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],Ui.prototype,"access",void 0),u([p()],Ui.prototype,"accessInformation",void 0),u([p({type:String})],Ui.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],Ui.prototype,"applicationProxies",void 0),u([p()],Ui.prototype,"avgRating",void 0),u([p()],Ui.prototype,"categories",void 0),u([p({type:Date})],Ui.prototype,"created",void 0),u([p()],Ui.prototype,"culture",void 0),u([p()],Ui.prototype,"description",void 0),u([p({readOnly:!0})],Ui.prototype,"displayName",null),u([p({type:ti})],Ui.prototype,"extent",void 0),u([De("extent")],Ui.prototype,"readExtent",null),u([p()],Ui.prototype,"groupCategories",void 0),u([p({readOnly:!0})],Ui.prototype,"iconUrl",null),u([p()],Ui.prototype,"id",void 0),u([p({readOnly:!0})],Ui.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],Ui.prototype,"isOrgItem",void 0),u([p()],Ui.prototype,"itemControl",void 0),u([p({readOnly:!0})],Ui.prototype,"itemPageUrl",null),u([p({readOnly:!0})],Ui.prototype,"itemUrl",null),u([p()],Ui.prototype,"licenseInfo",void 0),u([p({type:Date})],Ui.prototype,"modified",void 0),u([p()],Ui.prototype,"name",void 0),u([p()],Ui.prototype,"numComments",void 0),u([p()],Ui.prototype,"numRatings",void 0),u([p()],Ui.prototype,"numViews",void 0),u([p()],Ui.prototype,"owner",void 0),u([p()],Ui.prototype,"ownerFolder",void 0),u([p({type:du})],Ui.prototype,"portal",void 0),u([p()],Ui.prototype,"screenshots",void 0),u([p()],Ui.prototype,"size",void 0),u([p()],Ui.prototype,"snippet",void 0),u([p()],Ui.prototype,"sourceJSON",void 0),u([p({type:String})],Ui.prototype,"sourceUrl",void 0),u([p({type:String})],Ui.prototype,"spatialReference",void 0),u([p()],Ui.prototype,"tags",void 0),u([p()],Ui.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Ui.prototype,"thumbnailUrl",null),u([p()],Ui.prototype,"title",void 0),u([p()],Ui.prototype,"type",void 0),u([p()],Ui.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){var i;if(PWe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],Ui.prototype,"url",void 0),u([p({readOnly:!0})],Ui.prototype,"userItemUrl",null),Ui=Tx=u([N("esri.portal.PortalItem")],Ui);const wI=Ui,Twe=Object.freeze(Object.defineProperty({__proto__:null,default:wI},Symbol.toStringTag,{value:"Module"})),yle=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,IWe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function _le(t){return IWe[t]??!1}const zR=[],jM=new Map;function vle(t){for(const e of jM.keys())Ewe(t.pattern,e)&&jM.delete(e)}function $We(t){return zR.includes(t)||(vle(t),zR.unshift(t)),{remove(){const e=zR.indexOf(t);e>-1&&(zR.splice(e,1),vle(t))}}}async function Swe(t){const e=Rp();jM.has(t)||jM.set(t,DWe(t,e));const i=jM.get(t);return i&&await NWe.add(i),i}function LWe(t){if(!yle.test(t))return null;const e=yle.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return _le(s)?s:_le(i)?i:null}async function DWe(t,e){const i=[];for(const r of zR)if(Ewe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new J("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new J("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Ewe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}jee(()=>{jM.clear()});const NWe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=N_())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function FWe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,i=await Swe("esri/t9n/basemaps");return i[t]||i[e]}const jq={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Cr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Cr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Cr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Cr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Cr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Cr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Cr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Cr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Cr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Cr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Cr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Cr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Cr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Cr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Cr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Cr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function xI(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function CA(t){return t!=null&&"type"in t&&t.type==="group"}const O7t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Cwe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ble(t){return(t==null?void 0:t.type)==="voxel"}function wle(t){return(t==null?void 0:t.type)==="imagery-tile"}function Mwe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function qee(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function R7t(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function UWe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function Awe(t,e){const i=es==null?void 0:es.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=b(e)?e.signal:null,{data:o}=await tr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function kWe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Owe(t){return kWe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function VWe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function zWe(t){return!!VWe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const BWe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),GWe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function jWe(t){return t.layerContainerType==="basemap"?BWe:t.layerContainerType==="operational-layers"?GWe:null}function HWe(t,e){if(e.restrictedWebMapWriting){const i=jWe(e);return!b(i)||i.has(t.type)&&!qee(t)}return!0}function qWe(t,e){if(e)if(qee(t)){const i=kL("featureCollection.layers",e),r=i&&i[0]&&i[0].layerDefinition;r&&kB(t,r)}else t.type==="stream"?kB(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&kB(t,e)}function kB(t,e){"maxScale"in t&&(e.maxScale=iU(t.maxScale)??void 0),"minScale"in t&&(e.minScale=iU(t.minScale)??void 0)}function WWe(t,e){if(qWe(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=iU(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(qee(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function xle(t,e,i){if(!("write"in t)||!t.write)return i&&i.messages&&i.messages.push(new J("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(HWe(t,i)){const r={};return t.write(r,i)?r:null}return b(e)&&WWe(t,e=ue(e)),e}var $5;let YWe=0;const Rwe="esri.Basemap";let qd=$5=class extends GL(Tm){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+YWe++,this.baseLayers=new xt,this.referenceLayers=new xt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&le.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{le.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",I2(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=xle(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);b(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=xle(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);b(n)&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",I2(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return xee(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new $5({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ue(i);return r.url&&Em(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Em(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i}=this;_i(t);const r=[];if(e){const s=e.context?e.context.url:null;if(r.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;r.push(FWe(n).then(o=>{o&&this.read({title:o},e.context)}))}}else i&&r.push(this._loadFromItem(i,t));await Promise.all(r)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await se(()=>import("./layersCreator-3deab367.js"),["assets/layersCreator-3deab367.js","assets/lazyLayerLoader-44ea2a55.js","assets/portalLayers-ad01c96a.js","assets/layersLoader-019e8cf4.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"]),a=[];if(_i(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await hu(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=jo(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||du.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||du.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=jq[t];if(e){if(e.deprecated){let i=null;t==="dark-gray"?i="dark-gray-vector":t==="gray"?i="gray-vector":t==="streets"?i="streets-vector":t==="topo"&&(i="topo-vector"),Q1e(le.getLogger(Rwe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return $5.fromJSON(e)}return null}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:xt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],qd.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],qd.prototype,"id",void 0),u([p({type:wI})],qd.prototype,"portalItem",void 0),u([p()],qd.prototype,"referenceLayers",null),u([p({readOnly:!0})],qd.prototype,"resourceInfo",void 0),u([p({type:Ye})],qd.prototype,"spatialReference",void 0),u([p()],qd.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],qd.prototype,"title",void 0),u([Xe("title")],qd.prototype,"writeTitle",null),qd=$5=u([N(Rwe)],qd);const uU=qd,XWe=Object.freeze(Object.defineProperty({__proto__:null,default:uU},Symbol.toStringTag,{value:"Module"})),hU={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Pwe(t){return hU[t]||hU[t.toLowerCase()]}function Wee(t){return hU[t]??hU[t.toLowerCase()]}function ZWe(t){return[...Wee(t)]}function VB(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Iwe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*VB(o,n,s+1/3)),Math.round(255*VB(o,n,s)),Math.round(255*VB(o,n,s-1/3)),r]}function JWe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function $(){return[0,0,0]}function zr(t){return[t[0],t[1],t[2]]}function Ve(t,e,i){return[t,e,i]}function Qc(t){const e=$(),i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Yee(t,e){return new Float64Array(t,e,3)}function $we(){return $()}function Lwe(){return Ve(1,1,1)}function Dwe(){return Ve(1,0,0)}function Nwe(){return Ve(0,1,0)}function Xee(){return Ve(0,0,1)}const Fl=$we(),ey=Lwe(),KWe=Dwe(),QWe=Nwe(),Fwe=Xee();Object.freeze(Object.defineProperty({__proto__:null,ONES:ey,UNIT_X:KWe,UNIT_Y:QWe,UNIT_Z:Fwe,ZEROS:Fl,clone:zr,create:$,createView:Yee,fromArray:Qc,fromValues:Ve,ones:Lwe,unitX:Dwe,unitY:Nwe,unitZ:Xee,zeros:$we},Symbol.toStringTag,{value:"Module"}));let Zee=1e-6;function ul(){return Zee}function eYe(t){Zee=t}const qL=Math.random,tYe=Math.PI/180,iYe=180/Math.PI;function Fk(t){return t*tYe}function rYe(t){return t*iYe}function sYe(t,e){return Math.abs(t-e)<=Zee*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:qL,equals:sYe,getEpsilon:ul,setEpsilon:eYe,toDegree:rYe,toRadian:Fk},Symbol.toStringTag,{value:"Module"}));function ze(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ge(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function fe(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function we(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function be(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Uk(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function dU(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function nYe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Uwe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Hq(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function kwe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function Vwe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function oYe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function aYe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function pe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function eh(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Wr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Eo(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Ll(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Ul(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function lYe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Re(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function xe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Et(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function En(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function cYe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*h,t}function uYe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*h+r[0]*d+s[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*d+s[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*d+s[2]*f,t}function hYe(t,e){e=e||1;const i=qL,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function at(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function th(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function mm(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,d=n*a-r*c,f=r*l-s*a,m=s*f-n*d,g=n*h-r*f,y=r*d-s*h;const v=2*o;return h*=v,d*=v,f*=v,m*=2,g*=2,y*=2,t[0]=a+h+m,t[1]=l+d+g,t[2]=c+f+y,t}function dYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function pYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function fYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function zwe(t,e){ge(gN,t),ge(yN,e),Re(gN,gN),Re(yN,yN);const i=xe(gN,yN);return i>1?0:i<-1?Math.PI:Math.acos(i)}const gN=$(),yN=$();function mYe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Ur(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Bb(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=ul();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Q_(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const as=be,gYe=Uk,yYe=dU,WL=Wr,Jee=Eo,Bu=ze,MA=Ll,Tle=Object.freeze(Object.defineProperty({__proto__:null,abs:Hq,add:we,angle:zwe,bezier:uYe,ceil:nYe,copy:ge,cross:Et,direction:Q_,dist:WL,distance:Wr,div:yYe,divide:dU,dot:xe,equals:Bb,exactEquals:Ur,floor:Uwe,hermite:cYe,inverse:lYe,len:Bu,length:ze,lerp:En,max:oYe,min:Vwe,mul:gYe,multiply:Uk,negate:Ul,normalize:Re,random:hYe,rotateX:dYe,rotateY:pYe,rotateZ:fYe,round:aYe,scale:pe,scaleAndAdd:eh,set:fe,sign:kwe,sqrDist:Jee,sqrLen:MA,squaredDistance:Eo,squaredLength:Ll,str:mYe,sub:as,subtract:be,transformMat3:th,transformMat4:at,transformQuat:mm},Symbol.toStringTag,{value:"Module"}));function im(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rr(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Kee(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Bwe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Gwe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function jwe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function _Ye(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function vYe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function bYe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function wYe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function xYe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function b3(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function TYe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function Hwe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function pU(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Qee(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function ete(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function SYe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function EYe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function qwe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function Wwe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function kk(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function CYe(t,e){const i=qL;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function ld(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function MYe(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,d=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function AYe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function HM(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function tte(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=ul();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const OYe=Bwe,RYe=Gwe,PYe=jwe,IYe=Hwe,$Ye=pU,LYe=Qee,DYe=ete,Ywe=Object.freeze(Object.defineProperty({__proto__:null,add:Kee,ceil:_Ye,copy:im,dist:IYe,distance:Hwe,div:PYe,divide:jwe,dot:Wwe,equals:tte,exactEquals:HM,floor:vYe,inverse:EYe,len:LYe,length:Qee,lerp:kk,max:wYe,min:bYe,mul:RYe,multiply:Gwe,negate:SYe,normalize:qwe,random:CYe,round:xYe,scale:b3,scaleAndAdd:TYe,set:Rr,sqrDist:$Ye,sqrLen:DYe,squaredDistance:pU,squaredLength:ete,str:AYe,sub:OYe,subtract:Bwe,transformMat4:ld,transformQuat:MYe},Symbol.toStringTag,{value:"Module"})),Sle=new Float32Array(1);function AA(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Se(t,e,i){return Math.min(Math.max(t,e),i)}function Cm(t){return(t&t-1)==0}function P7t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function I7t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function ei(t,e,i){return t+(e-t)*i}function ci(t){return t*Math.PI/180}function Sc(t){return 180*t/Math.PI}function zB(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Co(t){return Math.acos(Se(t,-1,1))}function Fp(t){return Math.asin(Se(t,-1,1))}function __(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const fU=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function NYe(t){return fU.setFloat64(0,t),fU.getBigInt64(0)}function FYe(t){return fU.setBigInt64(0,t),fU.getFloat64(0)}const BB=BigInt("1000000");UYe(1);function UYe(t){const e=NYe(t=Math.abs(t)),i=FYe(e<=BB?BB:e-BB);return Math.abs(t-i)}function kYe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function VYe(t){return Xwe(Math.max(-qq,Math.min(t,qq)))}function Xwe(t){return Sle[0]=t,Sle[0]}function OA(t,e,i){const r=Se((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Ele(t,e){const i=ze(t),r=Fp(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return fe(e,i,r,s),e}function $7t(t,e,i){return Rr(t,e[0],e[1],e[2],e[3]*i)}function L7t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(__(e,1)&&__(i,1)&&__(r,1))}const qq=Xwe(34028234663852886e22);function _N(t){return Se(Rk(t),0,255)}function vN(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}let L5=class Sl{static blendColors(e,i,r,s=new Sl){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Sl.fromArray(a,i)}return Sl.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Sl.fromArray(Iwe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new Sl){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const r=e.length===4?4:8,s=(1<<r)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(e,i=new Sl){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=Pwe(e)?Wee(e):null;return r&&Sl.fromArray(r,i)||Sl.fromRgb(e,i)||Sl.fromHex(e,i)}static fromJSON(e){return e&&new Sl([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return b(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return b(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Sl.fromString(e,this):Array.isArray(e)?Sl.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Sl||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${e.length<2?"0"+e:e}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Sl.AlphaMode.ALWAYS){const i=_N(this.r),r=_N(this.g),s=_N(this.b);return e===Sl.AlphaMode.ALWAYS||this.a!==1?[i,r,s,_N(255*this.a)]:[i,r,s]}clone(){return new Sl(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return b(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(vN(this.r,0,255)),this.g=Math.round(vN(this.g,0,255)),this.b=Math.round(vN(this.b,0,255)),this.a=vN(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};L5.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(L5||(L5={}));const et=L5;function D7t(t){}function zYe(t){return()=>t}function It(t,e={}){const i=t instanceof Hi?t:new Hi(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),p(r)}var Wq;let D5=Wq=class extends Ae{constructor(t){super(t),this.type="none"}clone(){return new Wq({type:this.type})}};u([It({none:"none",stayAbove:"stay-above"})],D5.prototype,"type",void 0),D5=Wq=u([N("esri.ground.NavigationConstraint")],D5);let fn=class extends Ee{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([p()],fn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],fn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],fn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],fn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],fn.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],fn.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],fn.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],fn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],fn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],fn.prototype,"SHOW_POI",void 0),u([p()],fn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],fn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],fn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],fn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],fn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],fn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],fn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],fn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],fn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],fn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],fn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],fn.prototype,"LINE_WIREFRAMES",void 0),u([p()],fn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),fn=u([N("esri.views.3d.support.DebugFlags")],fn);const _r=new fn;function Vk(t){const e=Rk(100*(1-t));return Math.max(0,Math.min(e,100))}function S$(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var Yq;let mg=Yq=class extends GL(Tm){constructor(t){super(t),this.opacity=1,this.shading=!_r.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new xt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&le.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{le.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",I2(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};zYe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new J("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return xee(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await se(()=>import("./ElevationQuery-87b27ad4.js"),[]);_i(e);const r=new i,s=this.layers.filter(Cle).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await se(()=>import("./ElevationQuery-87b27ad4.js"),[]);_i(e);const r=new i,s=this.layers.filter(Cle).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ue(this.surfaceColor),navigationConstraint:ue(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new Yq({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,i){const r=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return se(()=>import("./layersCreator-3deab367.js"),["assets/layersCreator-3deab367.js","assets/lazyLayerLoader-44ea2a55.js","assets/portalLayers-ad01c96a.js","assets/layersLoader-019e8cf4.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"]).then(({populateOperationalLayers:o})=>{_i(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return hu(a)}).then(()=>{})}};function BYe(t){return t&&"createElevationSampler"in t}function Cle(t){return t.type==="elevation"||BYe(t)}u([p({json:{read:!1}})],mg.prototype,"layers",null),u([Xe("layers")],mg.prototype,"writeLayers",null),u([p({readOnly:!0})],mg.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Fr,read:{reader:S$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Vk(t)},target:"transparency"}}})],mg.prototype,"opacity",void 0),u([p({type:Boolean,nonNullable:!0,json:{read:!1}})],mg.prototype,"shading",void 0),u([p({type:et,json:{type:[Fr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],mg.prototype,"surfaceColor",void 0),u([p({type:D5,json:{write:!0}})],mg.prototype,"navigationConstraint",void 0),mg=Yq=u([N("esri.Ground")],mg);const mU=mg;let aC=class extends xt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(abe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=b(this.getCollections)?this.getCollections():null;if(A(e))return void this.removeAll();let i=0;for(const r of e)b(r)&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new xt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction?this.itemFilterFunction:s=>!!s;for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([p()],aC.prototype,"getCollections",void 0),u([p()],aC.prototype,"getChildrenFunction",void 0),u([p()],aC.prototype,"itemFilterFunction",void 0),aC=u([N("esri.core.CollectionFlattener")],aC);const Gb=aC;function GYe(t){var e,i;return!(!(t!=null&&t.loaded)||!((i=(e=Owe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!zWe(t))}const Mle=le.getLogger("esri.support.basemapUtils");function jYe(){return{}}function HYe(t){for(const e in t){const i=t[e];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete t[e]}}function qYe(t,e){let i;if(typeof t=="string"){if(!(t in jq)){const r=Object.entries(jq).filter(([s,n])=>Mr.apiKey&&!n.classic||!Mr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Mle.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${r}`),null}e&&(i=e[t]),i||(i=uU.fromId(t),e&&(e[t]=i))}else i=Vn(uU,t);return i!=null&&i.destroyed&&(Mle.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function WYe(t){return new Gb({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}const Ale={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function YYe(t){let e=null;if(typeof t=="string")if(t in Ale){const i=Ale[t];e=new mU({resourceInfo:{data:{layers:[i]}}})}else le.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Vn(mU,t);return e}function RA(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var Xq;function Ole(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function XYe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let u1=Xq=class extends K_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):XYe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ti,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=Ole(Math.min),a=Ole(Math.max);let l,c,h,d,[f,m]=n,[g,y]=n;for(let v=0,x=t.length;v<x;v++){const S=t[v],[E,C]=S;if(f=o(f,E),m=o(m,C),g=a(g,E),y=a(y,C),i&&S.length>2){const R=S[2];l=o(l,R),h=a(h,R)}if(r&&S.length>s){const R=S[s];c=o(c,R),d=a(d,R)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ue(this.points)}addPoint(t){return RA(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ue(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new Xq(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new st(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new st(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(RA(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],u1.prototype,"cache",null),u([p()],u1.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],u1.prototype,"points",void 0),u([Xe("points")],u1.prototype,"writePoints",null),u1=Xq=u([N("esri.geometry.Multipoint")],u1),u1.prototype.toJSON.isDefaultToJSON=!0;const YL=u1;function Rle(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,i=t.hasM;if(t.type==="point")return i&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:i?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice(0);if(t.type==="polyline")return t.paths.slice(0);if(t.type==="multipoint")return t.points.slice(0);if(t.type==="extent"){const r=t.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(o=>{o.hasZ&&(s=!0),o.hasM&&(n=!0)}),r.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function ite(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Zwe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function ZYe(t,e,i,r){const[s,n]=e,[o,a]=i[r],[l,c]=i[r+1],h=l-o,d=c-a,f=h*h+d*d,m=(s-o)*h+(n-a)*d,g=Math.min(1,Math.max(0,m/f));return t[0]=o+h*g,t[1]=a+d*g,t}function U7t(t,e,i){const r=i.rings;let s,n,o=!1,a=1/0;for(let l=0;l<r.length;l++){const c=r[l];for(let h=0,d=c.length-1;h<c.length;d=h++)s=c[h],n=c[d],s[1]>e!=n[1]>e&&t<(n[0]-s[0])*(e-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,JYe(t,e,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function JYe(t,e,i,r){let s=i[0],n=i[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){const l=((t-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=t-s,a=e-n,o*o+a*a}function KYe(t,e){return Zwe(t,e,.5)}function Jwe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=ite(t[r],t[r+1]);return i}function Kwe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=ite(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return Zwe(t[s],t[s+1],o)}r+=n}return t[i-1]}function rte(t,e,i){const r=t.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=t[a],c=t[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function QYe(t){const e=t.length;return e>2&&L_(t[0],t[e-1])}function k7t(t){if("rings"in t&&(eXe(t),t.rings.length>0&&!rte(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function eXe(t){if("rings"in t)for(const e of t.rings)QYe(e)||e.push(e[0].slice())}function V7t(t){return t.type!=="polygon"&&t.type!=="polyline"||tXe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function tXe(t,e){const i=dd(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const h of o){const d=iXe(h[0],r,s);a=Math.min(a,d),l=Math.max(l,d),h[0]=d}const c=l-a;n-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function iXe(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function Qwe(t){if(!t||t.length<3)return 0;let e=0;const i=t.length-1;for(let r=0;r<i;r++)e+=(t[r][0]-t[r+1][0])*(t[r][1]+t[r+1][1]);return e+=(t[i][0]-t[0][0])*(t[i][1]+t[0][1]),-.5*e}function z7t(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function rXe(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function exe(t){return t?ste(t.rings,t.hasZ??!1):null}function ste(t,e){if(!t||!t.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=sXe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?nXe(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function sXe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[y,v,x]=m,S=y-l,E=v-c,[C,R,O]=g,U=C-l,L=R-c,B=S*L-U*E;if(o+=B,r+=(S+U)*B,s+=(E+L)*B,e&&m.length>2&&g.length>2){const G=x-h,j=O-h,q=S*j-U*G;n+=(G+j)*q,a+=q}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(x<i[4]&&(i[4]=x),x>i[5]&&(i[5]=x))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+h,d[4]=a)),d}function nXe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){i[0]=h[0],i[1]=h[1],r[0]=d[0],r[1]=d[1],e&&h.length>2&&d.length>2&&(i[2]=h[2],r[2]=d[2]);const f=ite(i,r);if(f){s+=f;const m=KYe(h,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}const oXe=1e-6;function B7t(t){if(!t||!t.rings)return null;const{rings:e}=t;let i=0;for(let n=0;n<e.length;n++)i+=Qwe(e[n]);if(i<oXe)return ste(e,!1);const r=[0,0],s=e[0][0];for(let n=0;n<e.length;n++)lXe(r,s,e[n]);return r[0]*=1/i,r[1]*=1/i,r[0]+=s[0],r[1]+=s[1],r}const aXe=1/3;function lXe(t,e,i){if(!t||!i||i.length<3)return null;const r=i[0],s=[0,0],n=[i[1][0]-r[0],i[1][1]-r[1]];let o;for(let c=2;c<i.length;c++)s[0]=i[c][0]-r[0],s[1]=i[c][1]-r[1],o=.5*aXe*(s[0]*n[1]-s[1]*n[0]),t[0]+=o*(n[0]+s[0]),t[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=Qwe(i),l=[r[0],r[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function txe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function ixe(t){return t.points!==void 0}function rxe(t){return t.x!==void 0&&t.y!==void 0}function sxe(t){return t.paths!==void 0}function nxe(t){return t.rings!==void 0}function oxe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const hb=oxe(Math.min),db=oxe(Math.max);function G7t(t,e){return sxe(e)?PA(t,e.paths,!1,!1):nxe(e)?PA(t,e.rings,!1,!1):ixe(e)?nte(t,e.points,!1,!1,!1,!1):txe(e)?axe(t,e):(rxe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function j7t(t,e){return sxe(e)?PA(t,e.paths,!0,!1):nxe(e)?PA(t,e.rings,!0,!1):ixe(e)?nte(t,e.points,!0,!1,!0,!1):txe(e)?axe(t,e,!0,!1,!0,!1):(rxe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function PA(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let y=0;y<g.length;y++){const v=g[y],[x,S]=v;if(c=hb(c,x),h=hb(h,S),d=db(d,x),f=db(f,S),i&&v.length>2){const E=v[2];n=hb(n,E),o=db(o,E)}if(r&&v.length>s){const E=v[s];a=hb(n,E),l=db(o,E)}}}return i?r?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function axe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function nte(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,g]=e[0],[y,v]=e[0];for(let x=0;x<e.length;x++){const S=e[x],[E,C]=S;if(m=hb(m,E),g=hb(g,C),y=db(y,E),v=db(v,C),l&&S.length>2){const R=S[2];c=hb(c,R),h=db(h,R)}if(a&&S.length>o){const R=S[o];d=hb(c,R),f=db(h,R)}}return s?(c=c||0,h=h||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=y,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=h,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=d,t[3]=y,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=y,t[3]=v,t)}function cXe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function uXe(t){return t.points!==void 0}function hXe(t){return t.x!==void 0&&t.y!==void 0}function dXe(t){return t.paths!==void 0}function pXe(t){return t.rings!==void 0}const ote=[];function lxe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function cxe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function uxe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function hxe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function ate(t,e=!1,i=!1){return e?i?hxe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):cxe(t[0],t[1],t[2],t[3],t[4],t[5]):i?uxe(t[0],t[1],t[2],t[3],t[4],t[5]):lxe(t[0],t[1],t[2],t[3])}function Zq(t){return t?cXe(t)?t:hXe(t)?mXe(t):pXe(t)?lte(t):dXe(t)?dxe(t):uXe(t)?fXe(t):null:null}function fXe(t){const{hasZ:e,hasM:i,points:r}=t;return ate(nte(ote,r,e??!1,i??!1),e,i)}function mXe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?hxe(e,i,r,s,e,i,r,s):cxe(e,i,r,e,i,r):n?uxe(e,i,s,e,i,s):lxe(e,i,e,i)}function lte(t){const{hasZ:e,hasM:i,rings:r}=t,s=PA(ote,r,e??!1,i??!1);return s?ate(s,e,i):null}function dxe(t){const{hasZ:e,hasM:i,paths:r}=t,s=PA(ote,r,e??!1,i??!1);return s?ate(s,e,i):null}var N5;function Ple(t){return!Array.isArray(t[0])}let gg=N5=class extends K_{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new N5(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ye.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=exe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new st;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=lte(this);if(!e)return null;const i=new ti(e);return i.spatialReference=t,i}get isSelfIntersecting(){return yWe(this.rings)}writeRings(t,e){e.rings=ue(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Ple(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new N5;return t.spatialReference=this.spatialReference,t.rings=ue(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(A(t))return!1;const e=this.spatialReference,i=t.spatialReference;if(b(e)!==b(i)||b(e)&&b(i)&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,h,d])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!L_(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=_S(t,this.spatialReference);return ywe(this,b(e)?e:t)}isClockwise(t){let e;return e=Ple(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,rte(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new st(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new st(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new st(i[0],i[1],i[2],i[3],this.spatialReference):new st(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(RA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new st(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new st(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(RA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],gg.prototype,"cache",null),u([p({readOnly:!0})],gg.prototype,"centroid",null),u([p({readOnly:!0})],gg.prototype,"extent",null),u([p({readOnly:!0})],gg.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],gg.prototype,"rings",void 0),u([Xe("rings")],gg.prototype,"writeRings",null),gg=N5=u([N("esri.geometry.Polygon")],gg),gg.prototype.toJSON.isDefaultToJSON=!0;const kl=gg;var Jq;function gXe(t){return!Array.isArray(t[0])}let h1=Jq=class extends K_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ye.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=dxe(this);if(!e)return null;const i=new ti(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ue(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(gXe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new Jq;return t.spatialReference=this.spatialReference,t.paths=ue(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new st(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new st(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new st(i[0],i[1],i[2],i[3],this.spatialReference):new st(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(RA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new st(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new st(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(RA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],h1.prototype,"cache",null),u([p({readOnly:!0})],h1.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],h1.prototype,"paths",void 0),u([Xe("paths")],h1.prototype,"writePaths",null),h1=Jq=u([N("esri.geometry.Polyline")],h1),h1.prototype.toJSON.isDefaultToJSON=!0;const cd=h1,k2=jl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Kq=jl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function XL(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function zk(t){return t.points!==void 0}function Bk(t){return t.x!==void 0&&t.y!==void 0}function ZL(t){return t.paths!==void 0}function v_(t){return t.rings!==void 0}function Mm(t){return A(t)?null:t instanceof K_?t:Bk(t)?st.fromJSON(t):ZL(t)?cd.fromJSON(t):v_(t)?kl.fromJSON(t):zk(t)?YL.fromJSON(t):XL(t)?ti.fromJSON(t):null}function vS(t){return t?Bk(t)?"esriGeometryPoint":ZL(t)?"esriGeometryPolyline":v_(t)?"esriGeometryPolygon":XL(t)?"esriGeometryEnvelope":zk(t)?"esriGeometryMultipoint":null:null}const yXe={esriGeometryPoint:st,esriGeometryPolyline:cd,esriGeometryPolygon:kl,esriGeometryEnvelope:ti,esriGeometryMultipoint:YL};function _Xe(t){return t&&yXe[t]||null}const yw={base:K_,key:"type",typeMap:{extent:ti,multipoint:YL,point:st,polyline:cd,polygon:kl}};xm(yw);let pxe=0;const bS=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+pxe++})}};return e=u([N("esri.core.Identifiable")],e),e},cte=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:pxe++})}};return e=u([N("esri.core.NumericIdentifiable")],e),e};let Ile=class extends bS(class{}){};Ile=u([N("esri.core.Identifiable")],Ile);async function vXe(t){const e="portalItem"in t?t:{portalItem:t},i=await se(()=>import("./portalLayers-ad01c96a.js"),["assets/portalLayers-ad01c96a.js","assets/lazyLayerLoader-44ea2a55.js","assets/layersLoader-019e8cf4.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"]);try{return await i.fromItem(e)}catch(r){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Mr.portalUrl;throw le.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let bXe=0,Ca=class extends ws.EventedMixin(bS(Tm)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ti(-180,-90,180,90,Ye.WGS84),this.id=Date.now().toString(16)+"-layer-"+bXe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ye.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await se(()=>import("./arcgisLayers-c56887b3.js"),["assets/arcgisLayers-c56887b3.js","assets/fetchService-dfe209c3.js","assets/lazyLayerLoader-44ea2a55.js"])).fromUrl(i)}static fromPortalItem(e){return vXe(e)}initialize(){this.when().catch(e=>{kn(e)||le.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,i=this.parent;"layers"in i&&i.layers.includes(e)?i.layers.remove(e):"tables"in i&&i.tables.includes(e)?i.tables.remove(e):"baseLayers"in i&&i.baseLayers.includes(e)?i.baseLayers.remove(e):"baseLayers"in i&&i.referenceLayers.includes(e)&&i.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return jo(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await tr(e,{query:{f:"json"},responseType:"json"})).data;throw new J("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],Ca.prototype,"attributionDataUrl",void 0),u([p({type:ti})],Ca.prototype,"fullExtent",void 0),u([p({readOnly:!0})],Ca.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],Ca.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],Ca.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],Ca.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],Ca.prototype,"opacity",void 0),u([p({clonable:!1})],Ca.prototype,"parent",void 0),u([p({readOnly:!0})],Ca.prototype,"parsedUrl",null),u([p({type:Boolean})],Ca.prototype,"popupEnabled",void 0),u([p({type:Boolean})],Ca.prototype,"attributionVisible",void 0),u([p({type:Ye})],Ca.prototype,"spatialReference",void 0),u([p({type:String})],Ca.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],Ca.prototype,"type",void 0),u([p()],Ca.prototype,"url",void 0),u([p({type:Boolean,nonNullable:!0})],Ca.prototype,"visible",void 0),Ca=u([N("esri.layers.Layer")],Ca);const V_=Ca;function Qq(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.getItemAt(n),r[e]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=Qq(r.layers,e,i),s))return s}}const wXe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new xt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||le.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",I2(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof V_){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else gh(i)?i.then(n=>{this.destroyed||this.add(n,r)}):le.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return Qq(this.layers,"id",i)}findLayerByUid(i){return Qq(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([p()],e.prototype,"layers",null),e=u([N("esri.support.LayersMixin")],e),e};function eW(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.getItemAt(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=eW(n.tables,e,i);if(o)return o}}}const xXe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new xt,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&le.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",I2(i,this._get("tables")))}findTableById(i){return eW(this.tables,"id",i)}findTableByUid(i){return eW(this.tables,"uid",i)}};return u([p()],e.prototype,"tables",null),e=u([N("esri.support.TablesMixin")],e),e};let yg=class extends xXe(wXe(ws.EventedMixin(Ee))){constructor(e){super(e),this.allLayers=new Gb({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=WYe(this),this.basemap=null,this.editableLayers=new Gb({getCollections:()=>[this.allLayers],itemFilterFunction:GYe}),this.ground=new mU,this._basemapCache=jYe()}destroy(){var e,i;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(i=this.basemap)==null||i.destroy(),HYe(this._basemapCache),this._basemapCache=null}castBasemap(e){return qYe(e,this._basemapCache)}castGround(e){const i=YYe(e);return A(i)?this._get("ground"):i}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([p({readOnly:!0,dependsOn:[]})],yg.prototype,"allLayers",void 0),u([p({readOnly:!0})],yg.prototype,"allTables",void 0),u([p({type:uU})],yg.prototype,"basemap",void 0),u([pi("basemap")],yg.prototype,"castBasemap",null),u([p({readOnly:!0})],yg.prototype,"editableLayers",void 0),u([p({type:mU,nonNullable:!0})],yg.prototype,"ground",void 0),u([pi("ground")],yg.prototype,"castGround",null),yg=u([N("esri.Map")],yg);const Gk=yg,hn=t=>{let e=class extends t{clone(){var l;const i=Ol(ga(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],d=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||d!==ht.USER&&d!==ht.DEFAULTS&&d!==ht.WEB_MAP&&d!==ht.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:dq(m),m!=null&&g==null||(d===ht.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ga(a))==null?void 0:l.store;if(c)for(const[h,d]of o)c.set(h,d,ht.DEFAULTS)}return a}};return e=u([N("esri.core.Clonable")],e),e};let $le=class extends hn(Ee){};$le=u([N("esri.core.Clonable")],$le);var IA;function TXe(t,e){switch(t.type){case"range":{const i="range"in t?t.range[0]:t.minValue,r="range"in t?t.range[1]:t.maxValue;if(i!=null&&+e<i||r!=null&&+e>r)return IA.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(i=>i==null||i.code!==e))return IA.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(IA||(IA={}));const SXe=le.getLogger("esri.support.arcadeOnDemand");let GB;function Am(){return GB||(GB=(async()=>{const t=await se(()=>import("./arcadeUtils-408e2c2f.js").then(e=>e.ax),["assets/arcadeUtils-408e2c2f.js","assets/arcadeTimeUtils-9099ffb4.js","assets/number-3acb8d45.js","assets/hash-0ddfbf4b.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),GB}const EXe=(t,e,i)=>ute.create(t,e,i,null,["$feature"]),CXe=(t,e,i)=>ute.create(t,e,i,null,["$feature","$view"]),MXe=(t,e,i,r)=>ute.create(t,e,i,r,["$feature","$view"]);let ute=class fxe{constructor(e,i,r,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Am(),h=Ye.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(L){return SXe.error(new J("arcade-bad-expression","Failed to parse arcade script",{script:e,error:L})),null}const f=n.reduce((L,B)=>({...L,[B]:null}),{});let m=null;b(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(d),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),x=a.scriptIsAsync(d),S=x&&a.enableAsyncSupport(),E={vars:f,spatialReference:h,useAsync:!!S};await Promise.all([y,v,S]);const C=new Set;await a.loadDependentModules(C,d,null,x,g);const R=new c;R.immutable=!1,R.setField("scale",0);const O=a.compileScript(d,E),U=L=>("$view"in L&&L.$view&&(R.setField("scale",typeof L.$view=="object"?L.$view.scale:void 0),L.$view=R),m&&(L.$config=m),O({vars:L,spatialReference:h}));return new fxe(e,a,d,U,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const AXe=/^([0-9])/,OXe=/[^a-z0-9_\u0080-\uffff]/gi,RXe=/_{2,}/g,PXe=/^_/,IXe=/_$/;function $Xe(t){return t==null?null:t.trim().replace(OXe,"_").replace(RXe,"_").replace(PXe,"").replace(IXe,"").replace(AXe,"F$1")||null}const LXe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],DXe=["field","normalizationField"];function gU(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Lle(LXe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Lle(DXe,r,e)}}function Lle(t,e,i){if(t)for(const r of t){const s=kL(r,e),n=s&&typeof s!="function"&&i.get(s);n&&Tc(r,n.name,e)}}function hte(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const jB=new Set;function mxe(t,e){return t&&e?(jB.clear(),E$(jB,t,e),Array.from(jB).sort()):[]}function E$(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)pd(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function pd(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function X7t(t,e){return A(e)||A(t)?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function pu(t,e,i){var n;if(!i)return;const{arcadeUtils:r}=await Am(),s=r.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)pd(t,e,o)}async function gxe(t,e,i){if(i&&i!=="1=1"){const r=(await se(()=>Promise.resolve().then(()=>ooe),void 0)).WhereClause.create(i,e);if(!r.isStandardized)throw new J("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});E$(t,e,r.fieldNames)}}function NXe({displayField:t,fields:e}){return t||(e&&e.length?HB(e,"name-or-title")||HB(e,"unique-identifier")||HB(e,"type-or-category")||FXe(e):null)}function FXe(t){for(const e of t){if(!e||!e.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function HB(t,e){for(const i of t)if(i&&i.valueType&&i.valueType===e)return i.name;return null}async function Z7t(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function UXe(t,e,i){i.onStatisticExpression?pu(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function J7t(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(kXe(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>UXe(t,e.fieldsIndex,n))),await Promise.all(r)}async function kXe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>pu(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(pu(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function K7t(t,e,i){e&&(e.timeInfo&&b(i)&&i.timeExtent&&E$(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&E$(t,e.fieldsIndex,[e.floorInfo.floorField]),b(i)&&b(i.where)&&await gxe(t,e.fieldsIndex,i.where))}async function Q7t(t,e,i){e&&i&&await Promise.all(i.map(r=>VXe(t,e,r)))}async function VXe(t,e,i){e&&i&&(i.valueExpression?await pu(t,e.fieldsIndex,i.valueExpression):i.field&&pd(t,e.fieldsIndex,i.field))}function eGt(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?mxe(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function tGt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i&&i.length&&await Promise.all(i.map(s=>zXe(t,r,s)))}async function zXe(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await pu(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{pd(t,e,o.slice(1,-1))})}await gxe(t,e,s)}function BXe(t){const e=t.defaultValue;return e!==void 0&&vxe(t,e)?e:t.nullable?null:void 0}function yxe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function GXe(t){return t===null||yxe(t)}const dte="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function jXe(t){return t===null||dte(t)}function _xe(t){return t!=null&&typeof t=="string"}function HXe(t){return t===null||_xe(t)}function qXe(){return!0}function vxe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=t.nullable?jXe:dte;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?GXe:yxe;break;case"string":case"esriFieldTypeString":i=t.nullable?HXe:_xe;break;default:i=qXe}return arguments.length===1?i:i(e)}const WXe=["integer","small-integer","single","double"],YXe=new Set([...WXe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function jk(t){return t!=null&&YXe.has(t.type)}function Dle(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var yU,_U;function iGt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function rGt(t,e){return t==null||t.nullable&&e===null?null:jk(t)&&!XXe(t.type,Number(e))?yU.OUT_OF_RANGE:vxe(t,e)?t.domain?TXe(t.domain,e):null:_U.INVALID_TYPE}function XXe(t,e){const i=typeof t=="string"?bxe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?dte(e)&&e>=r&&e<=s:e>=r&&e<=s}function bxe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return ZXe;case"esriFieldTypeInteger":case"integer":return JXe;case"esriFieldTypeSingle":case"single":return KXe;case"esriFieldTypeDouble":case"double":return QXe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(yU||(yU={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(_U||(_U={}));const ZXe={min:-32768,max:32767,isInteger:!0},JXe={min:-2147483648,max:2147483647,isInteger:!0},KXe={min:-34e37,max:12e37,isInteger:!1},QXe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function sGt(t,e,i){switch(t){case IA.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case IA.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case _U.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case yU.OUT_OF_RANGE:{const{min:r,max:s}=bxe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function eZe(t,e){return!tZe(t,e,null)}function tZe(t,e,i){if(!e||!e.attributes||!t){if(b(i))for(const n of t??[])i.add(n);return!0}const r=e.attributes;let s=!1;for(const n of t)if(!(n in r)){if(s=!0,!b(i))break;i.add(n)}return s}function wxe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let F5=class extends Ae{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],F5.prototype,"type",void 0),F5=u([N("esri.popup.content.Content")],F5);const _w=F5;var tW;let Sx=tW=class extends _w{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new tW({description:this.description,displayType:this.displayType,title:this.title})}};u([p({type:String,json:{write:!0}})],Sx.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],Sx.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],Sx.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Sx.prototype,"type",void 0),Sx=tW=u([N("esri.popup.content.AttachmentsContent")],Sx);const C$=Sx;var iW;let Ex=iW=class extends _w{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new iW({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ue(this.outFields):null})}};u([p()],Ex.prototype,"creator",void 0),u([p()],Ex.prototype,"destroyer",void 0),u([p()],Ex.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],Ex.prototype,"type",void 0),Ex=iW=u([N("esri.popup.content.CustomContent")],Ex);const iZe=Ex;var rW;let lC=rW=class extends Ae{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new rW({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],lC.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],lC.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],lC.prototype,"returnType",void 0),lC=rW=u([N("esri.popup.ElementExpressionInfo")],lC);const xxe=lC;var sW;let BR=sW=class extends _w{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new sW({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([p({type:xxe,json:{write:!0}})],BR.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],BR.prototype,"type",void 0),BR=sW=u([N("esri.popup.content.ExpressionContent")],BR);const pte=BR,M$=jl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});M$.toJSON.bind(M$);M$.fromJSON.bind(M$);const Xm={year:"numeric",month:"numeric",day:"numeric"},xO={year:"numeric",month:"long",day:"numeric"},TO={year:"numeric",month:"short",day:"numeric"},SO={year:"numeric",month:"long",weekday:"long",day:"numeric"},Wd={hour:"numeric",minute:"numeric"},nf={...Wd,second:"numeric"},fte={"short-date":Xm,"short-date-short-time":{...Xm,...Wd},"short-date-short-time-24":{...Xm,...Wd,hour12:!1},"short-date-long-time":{...Xm,...nf},"short-date-long-time-24":{...Xm,...nf,hour12:!1},"short-date-le":Xm,"short-date-le-short-time":{...Xm,...Wd},"short-date-le-short-time-24":{...Xm,...Wd,hour12:!1},"short-date-le-long-time":{...Xm,...nf},"short-date-le-long-time-24":{...Xm,...nf,hour12:!1},"long-month-day-year":xO,"long-month-day-year-short-time":{...xO,...Wd},"long-month-day-year-short-time-24":{...xO,...Wd,hour12:!1},"long-month-day-year-long-time":{...xO,...nf},"long-month-day-year-long-time-24":{...xO,...nf,hour12:!1},"day-short-month-year":TO,"day-short-month-year-short-time":{...TO,...Wd},"day-short-month-year-short-time-24":{...TO,...Wd,hour12:!1},"day-short-month-year-long-time":{...TO,...nf},"day-short-month-year-long-time-24":{...TO,...nf,hour12:!1},"long-date":SO,"long-date-short-time":{...SO,...Wd},"long-date-short-time-24":{...SO,...Wd,hour12:!1},"long-date-long-time":{...SO,...nf},"long-date-long-time-24":{...SO,...nf,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Wd,"long-time":nf},A$=jl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});A$.apiValues;A$.toJSON.bind(A$);A$.fromJSON.bind(A$);const rZe={ar:"ar-u-nu-latn-ca-gregory"};let nW=new WeakMap,Txe=fte["short-date-short-time"];function sZe(t){const e=t||Txe;let i=nW.get(e);if(!i){const r=Rp(),s=rZe[Rp()]||r;i=new Intl.DateTimeFormat(s,e),nW.set(e,i)}return i}function Hk(t){return t?fte[t]:null}function Ty(t,e){return sZe(e).format(t)}jee(()=>{nW=new WeakMap,Txe=fte["short-date-short-time"]});const nZe={ar:"ar-u-nu-latn"};let U5=new WeakMap,Sxe={};function oZe(t){const e=t||Sxe;if(!U5.has(e)){const i=Rp(),r=nZe[Rp()]||i;U5.set(e,new Intl.NumberFormat(r,t))}return U5.get(e)}function Exe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function _d(t,e){return t===-0&&(t=0),oZe(e).format(t)}jee(()=>{U5=new WeakMap,Sxe={}});var oW;let Cx=oW=class extends Ae{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new oW({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?Ty(t,{...Hk(this.dateFormat),...this.dateTimeFormatOptions}):_d(t,Exe(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,i;return t.trim().includes(",")?(e=",",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(";")?(e=";",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(" ")?(e=i=" ",this._formatDelimitedString(t,e,i,this)):this.format(Number(t))}_formatDelimitedString(t,e,i,r){return t&&e&&i&&r?t.trim().split(e).map(s=>this.format(Number(s))).join(i):t}};u([It(M$)],Cx.prototype,"dateFormat",void 0),u([p({type:Object,json:{read:!1}})],Cx.prototype,"dateTimeFormatOptions",void 0),u([p({type:Boolean,json:{write:!0}})],Cx.prototype,"digitSeparator",void 0),u([p({type:Fr,json:{write:!0}})],Cx.prototype,"places",void 0),Cx=oW=u([N("esri.popup.support.FieldInfoFormat")],Cx);const pM=Cx;var aW;let yf=aW=class extends Ae{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new aW({fieldName:this.fieldName,format:this.format?ue(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],yf.prototype,"fieldName",void 0),u([p({type:pM,json:{write:!0}})],yf.prototype,"format",void 0),u([p({type:Boolean,json:{write:!0,default:!1}})],yf.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],yf.prototype,"label",void 0),u([It(new Hi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],yf.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],yf.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],yf.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],yf.prototype,"visible",void 0),yf=aW=u([N("esri.popup.FieldInfo")],yf);const JL=yf;var lW;let b0=lW=class extends _w{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new lW(ue({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],b0.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],b0.prototype,"description",void 0),u([p({type:[JL]})],b0.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],b0.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],b0.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],b0.prototype,"type",void 0),b0=lW=u([N("esri.popup.content.FieldsContent")],b0);const $A=b0;let Mx=class extends Ae{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],Mx.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],Mx.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],Mx.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Mx.prototype,"type",void 0),Mx=u([N("esri.popup.content.mixins.MediaInfo")],Mx);const mte=Mx;var cW;let cC=cW=class extends Ee{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new cW({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],cC.prototype,"fieldName",void 0),u([p()],cC.prototype,"tooltip",void 0),u([p()],cC.prototype,"value",void 0),cC=cW=u([N("esri.popup.content.support.ChartMediaInfoValueSeries")],cC);const Cxe=cC;var uW;let Ax=uW=class extends Ae{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new uW({fields:ue(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([p({type:[String],json:{write:!0}})],Ax.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],Ax.prototype,"normalizeField",void 0),u([p({type:[Cxe],json:{read:!1}})],Ax.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],Ax.prototype,"tooltipField",void 0),Ax=uW=u([N("esri.popup.content.support.ChartMediaInfoValue")],Ax);const aZe=Ax;let GR=class extends mte{constructor(e){super(e),this.type=null,this.value=null}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],GR.prototype,"type",void 0),u([p({type:aZe,json:{write:!0}})],GR.prototype,"value",void 0),GR=u([N("esri.popup.content.mixins.ChartMediaInfo")],GR);const qk=GR,Wk=jl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var hW;let k5=hW=class extends qk{constructor(t){super(t),this.type="bar-chart"}clone(){return new hW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:Wk.write}})],k5.prototype,"type",void 0),k5=hW=u([N("esri.popup.content.BarChartMediaInfo")],k5);const Mxe=k5;var dW;let V5=dW=class extends qk{constructor(t){super(t),this.type="column-chart"}clone(){return new dW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:Wk.write}})],V5.prototype,"type",void 0),V5=dW=u([N("esri.popup.content.ColumnChartMediaInfo")],V5);const Axe=V5;var pW;let jR=pW=class extends Ae{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new pW({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],jR.prototype,"linkURL",void 0),u([p({type:String,json:{write:!0}})],jR.prototype,"sourceURL",void 0),jR=pW=u([N("esri.popup.content.support.ImageMediaInfoValue")],jR);const lZe=jR;var fW;let uC=fW=class extends mte{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new fW({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([p({type:Number,json:{write:!0}})],uC.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],uC.prototype,"type",void 0),u([p({type:lZe,json:{write:!0}})],uC.prototype,"value",void 0),uC=fW=u([N("esri.popup.content.ImageMediaInfo")],uC);const Oxe=uC;var mW;let z5=mW=class extends qk{constructor(t){super(t),this.type="line-chart"}clone(){return new mW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:Wk.write}})],z5.prototype,"type",void 0),z5=mW=u([N("esri.popup.content.LineChartMediaInfo")],z5);const Rxe=z5;var gW;let B5=gW=class extends qk{constructor(t){super(t),this.type="pie-chart"}clone(){return new gW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:Wk.write}})],B5.prototype,"type",void 0),B5=gW=u([N("esri.popup.content.PieChartMediaInfo")],B5);const Pxe=B5,Ixe={base:mte,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Mxe,"column-chart":Axe,"line-chart":Rxe,"pie-chart":Pxe,image:Oxe}};var yW;let _f=yW=class extends _w{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?Oxe.fromJSON(e):e.type==="barchart"?Mxe.fromJSON(e):e.type==="columnchart"?Axe.fromJSON(e):e.type==="linechart"?Rxe.fromJSON(e):e.type==="piechart"?Pxe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new yW(ue({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],_f.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],_f.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],_f.prototype,"description",void 0),u([p({types:[Ixe]})],_f.prototype,"mediaInfos",void 0),u([De("mediaInfos")],_f.prototype,"readMediaInfos",null),u([Xe("mediaInfos")],_f.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],_f.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],_f.prototype,"type",void 0),_f=yW=u([N("esri.popup.content.MediaContent")],_f);const O$=_f;var _W;let HR=_W=class extends Ae{constructor(t){super(t),this.field=null,this.order=null}clone(){return new _W({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],HR.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],HR.prototype,"order",void 0),HR=_W=u([N("esri.popup.support.RelatedRecordsInfoFieldOrder")],HR);const gte=HR;let _g=class extends hn(_w){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],_g.prototype,"description",void 0),u([p({type:Number,json:{type:Fr,write:!0}})],_g.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],_g.prototype,"displayType",void 0),u([p({type:[gte],json:{write:!0}})],_g.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:Fr,write:!0}})],_g.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],_g.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],_g.prototype,"type",void 0),_g=u([N("esri.popup.content.RelationshipContent")],_g);const vU=_g;var vW;let qR=vW=class extends _w{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new vW({text:this.text})}};u([p({type:String,json:{write:!0}})],qR.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],qR.prototype,"type",void 0),qR=vW=u([N("esri.popup.content.TextContent")],qR);const LA=qR,cZe={base:null,key:"type",typeMap:{attachment:C$,media:O$,text:LA,expression:pte,field:$A,relationship:vU}};var bW;let Ox=bW=class extends Ae{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new bW({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],Ox.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Ox.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],Ox.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],Ox.prototype,"returnType",void 0),Ox=bW=u([N("esri.popup.ExpressionInfo")],Ox);const $xe=Ox;var wW;let WR=wW=class extends Ae{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new wW({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],WR.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],WR.prototype,"showNoDataRecords",void 0),WR=wW=u([N("esri.popup.LayerOptions")],WR);const uZe=WR;var xW;let YR=xW=class extends Ae{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new xW({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ue(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],YR.prototype,"showRelatedRecords",void 0),u([p({type:[gte],json:{write:!0}})],YR.prototype,"orderByFields",void 0),YR=xW=u([N("esri.popup.RelatedRecordsInfo")],YR);const hZe=YR;var TW;let vf=TW=class extends bS(Ee){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new TW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],vf.prototype,"active",void 0),u([p()],vf.prototype,"className",void 0),u([p()],vf.prototype,"disabled",void 0),u([p()],vf.prototype,"id",void 0),u([p()],vf.prototype,"indicator",void 0),u([p()],vf.prototype,"title",void 0),u([p()],vf.prototype,"type",void 0),u([p()],vf.prototype,"visible",void 0),vf=TW=u([N("esri.support.actions.ActionBase")],vf);const Yk=vf;var SW;let G5=SW=class extends Yk{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new SW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],G5.prototype,"image",void 0),G5=SW=u([N("esri.support.Action.ActionButton")],G5);const w3=G5;var EW;let XR=EW=class extends Yk{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new EW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],XR.prototype,"image",void 0),u([p()],XR.prototype,"value",void 0),XR=EW=u([N("esri.support.Action.ActionToggle")],XR);const Lxe=XR,dZe="esri.PopupTemplate",pZe=le.getLogger(dZe),EO="relationships/",Nle="expression/",fZe=xt.ofType({key:"type",defaultKeyValue:"button",base:Yk,typeMap:{button:w3,toggle:Lxe}}),mZe={base:_w,key:"type",typeMap:{media:O$,custom:iZe,text:LA,attachments:C$,fields:$A,expression:pte,relationship:vU}},gZe=["attachments","fields","media","text","expression","relationship"];let Ma=class extends hn(Ae){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>xm(mZe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||gh(e)?e:(pZe.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>gZe.includes(n.type)).map(n=>n&&n.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),E$(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ue(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ue(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),O$.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),LA.fromJSON(n)):n.type==="attachments"?C$.fromJSON(n):n.type==="fields"?$A.fromJSON(n):n.type==="expression"?pte.fromJSON(n):n.type==="relationship"?vU.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(EO)))return null;const s=i.replace(EO,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?vU.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${EO}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new LA({text:e})):n.push(new $A),Array.isArray(i)&&i.length&&n.push(O$.fromJSON({mediaInfos:i})),r&&n.push(C$.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>pu(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(EO)&&!i.startsWith(Nle)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const s=/\{(\w+):.+\}/,n=r.filter(o=>!(o.indexOf(`{${EO}`)===0||o.indexOf(`{${Nle}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([p({type:fZe})],Ma.prototype,"actions",void 0),u([p()],Ma.prototype,"content",void 0),u([pi("content")],Ma.prototype,"castContent",null),u([De("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Ma.prototype,"readContent",null),u([Xe("content",{popupElements:{type:xt.ofType(cZe)},showAttachments:{type:Boolean},mediaInfos:{type:xt.ofType(Ixe)},description:{type:String},relatedRecordsInfo:{type:hZe}})],Ma.prototype,"writeContent",null),u([p({type:[$xe],json:{write:!0}})],Ma.prototype,"expressionInfos",void 0),u([p({type:[JL]})],Ma.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],Ma.prototype,"writeFieldInfos",null),u([p({type:uZe})],Ma.prototype,"layerOptions",void 0),u([Xe("layerOptions")],Ma.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Ma.prototype,"lastEditInfoEnabled",void 0),u([p()],Ma.prototype,"outFields",void 0),u([p()],Ma.prototype,"overwriteActions",void 0),u([p()],Ma.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],Ma.prototype,"title",void 0),u([Xe("title")],Ma.prototype,"writeTitle",null),Ma=u([N("esri.PopupTemplate")],Ma);const vw=Ma,Fle=new Hi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let yZe=0,hC=class extends Ae{constructor(e){super(e),this.id="sym"+yZe++,this.type=null,this.color=new et([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:Fle.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Fle.write}}})],hC.prototype,"type",void 0),u([p({type:et,json:{write:{allowNull:!0}}})],hC.prototype,"color",void 0),u([De("color")],hC.prototype,"readColor",null),hC=u([N("esri.symbols.Symbol")],hC);const yh=hC;var CW;let d1=CW=class extends yh{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const i in t)e[i]=t[i]}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return pu(t,e,o.expression)});await Promise.all(s)}}}clone(){return new CW({data:ue(this.data)})}hash(){return uee(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],d1.prototype,"color",void 0),u([p({json:{write:!0}})],d1.prototype,"data",void 0),u([De("data",["symbol"])],d1.prototype,"readData",null),u([Xe("data",{})],d1.prototype,"writeData",null),u([It({CIMSymbolReference:"cim"},{readOnly:!0})],d1.prototype,"type",void 0),d1=CW=u([N("esri.symbols.CIMSymbol")],d1);const x3=d1;let dC=class extends Ae{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,i,r){e||(i[r]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],dC.prototype,"enabled",void 0),u([Xe("enabled")],dC.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],dC.prototype,"type",void 0),dC=u([N("esri.symbols.Symbol3DLayer")],dC);const Ny=dC,_Ze=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,vZe="screenUtils.toPt: input not recognized!",Dxe=96;function ka(t){return t?t/72*Dxe:0}function Up(t){return t?72*t/Dxe:0}function kr(t){if(typeof t=="string"){const e=t.match(_Ze);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?Up(i):i;return s?-n:n}return console.warn(vZe),null}return t}function xo(t=0,e=0){return{x:t,y:e}}function zs(t=0,e=0){return[t,e]}function Nxe(t=0,e=0){return[t,e]}function ma(t=0,e=0,i=0){return[t,e,i]}function dGt(t){return t}function pGt(t){return t}function fGt(t){return t}function Yg(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function bZe(t,e){const i=e.transparency!=null?S$(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new et([r[0]||0,r[1]||0,r[2]||0,i]):null}function wZe(t,e){e.color=t.toJSON().slice(0,3);const i=Vk(t.a);i!==0&&(e.transparency=i)}const ev={type:et,json:{type:[Fr],default:null,read:{source:["color","transparency"],reader:bZe},write:{target:{color:{type:[Fr]},transparency:{type:Fr}},writer:wZe}}},Sy={type:Number,cast:kr,json:{write:!0}};let Rx=class extends Ae{constructor(e){super(e),this.color=new et([0,0,0,1]),this.extensionLength=0,this.size=Up(1)}clone(){}cloneProperties(){return{color:ue(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Rx.prototype,"type",void 0),u([p(ev)],Rx.prototype,"color",void 0),u([p({...Sy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Rx.prototype,"extensionLength",void 0),u([p(Sy)],Rx.prototype,"size",void 0),Rx=u([N("esri.symbols.edges.Edges3D")],Rx);const yte=Rx;var MW;let j5=MW=class extends yte{constructor(t){super(t),this.type="sketch"}clone(){return new MW(this.cloneProperties())}};u([It({sketch:"sketch"},{readOnly:!0})],j5.prototype,"type",void 0),j5=MW=u([N("esri.symbols.edges.SketchEdges3D")],j5);const xZe=j5;var AW;let H5=AW=class extends yte{constructor(t){super(t),this.type="solid"}clone(){return new AW(this.cloneProperties())}};u([It({solid:"solid"},{readOnly:!0})],H5.prototype,"type",void 0),H5=AW=u([N("esri.symbols.support.SolidEdges3D")],H5);const TZe=H5,Fxe={types:{key:"type",base:yte,typeMap:{solid:TZe,sketch:xZe}},json:{write:!0}};var OW;let fd=OW=class extends Ae{constructor(t){super(t),this.color=null}clone(){const t={color:b(this.color)?this.color.clone():null};return new OW(t)}};u([p(ev)],fd.prototype,"color",void 0),fd=OW=u([N("esri.symbols.support.Symbol3DMaterial")],fd);var RW;let p1=RW=class extends Ny{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new RW({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([It({Extrude:"extrude"},{readOnly:!0})],p1.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],p1.prototype,"size",void 0),u([p({type:fd,json:{write:!0}})],p1.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],p1.prototype,"castShadows",void 0),u([p(Fxe)],p1.prototype,"edges",void 0),p1=RW=u([N("esri.symbols.ExtrudeSymbol3DLayer")],p1);const Uxe=p1;let ZR=class extends yh{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([It({esriSLS:"simple-line"},{readOnly:!0})],ZR.prototype,"type",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],ZR.prototype,"width",void 0),ZR=u([N("esri.symbols.LineSymbol")],ZR);const SZe=ZR,EZe=["begin","end","begin-end"],kxe=["arrow","circle","square","diamond","cross","x"];var PW;let vg=PW=class extends Ae{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new PW({color:ue(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],vg.prototype,"placement",void 0),u([It({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],vg.prototype,"type",void 0),u([p({type:kxe})],vg.prototype,"style",void 0),u([Xe("style")],vg.prototype,"writeStyle",null),u([p({type:et,value:null,json:{write:{allowNull:!0}}})],vg.prototype,"color",null),u([De("color")],vg.prototype,"readColor",null),u([Xe("color")],vg.prototype,"writeColor",null),vg=PW=u([N("esri.symbols.LineSymbolMarker")],vg);const CZe=vg;var IW;const qB=new Hi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let w0=IW=class extends SZe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=kr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=kr(n)),o}clone(){var t;return new IW({color:ue(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([It({esriSLS:"simple-line"},{readOnly:!0})],w0.prototype,"type",void 0),u([p({type:qB.apiValues,json:{read:qB.read,write:qB.write}})],w0.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],w0.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],w0.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":CZe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],w0.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],w0.prototype,"miterLimit",void 0),w0=IW=u([N("esri.symbols.SimpleLineSymbol")],w0);const uh=w0;let JR=class extends yh{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":uh}},json:{default:null,write:!0}})],JR.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],JR.prototype,"type",void 0),JR=u([N("esri.symbols.FillSymbol")],JR);const Vxe=JR;let q5=class extends Ae{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],q5.prototype,"type",void 0),q5=u([N("esri.symbols.patterns.LinePattern3D")],q5);const zxe=q5,MZe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var $W;const AZe=jl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let KR=$W=class extends zxe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new $W(t)}};u([p({type:["style"]})],KR.prototype,"type",void 0),u([It(AZe),p({type:MZe})],KR.prototype,"style",void 0),KR=$W=u([N("esri.symbols.patterns.LineStylePattern3D")],KR);const _te=KR;let W5=class extends Ae{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W5.prototype,"type",void 0),W5=u([N("esri.symbols.patterns.Pattern3D")],W5);const Bxe=W5,OZe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var LW;let QR=LW=class extends Bxe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new LW(t)}};u([p({type:["style"]})],QR.prototype,"type",void 0),u([p({type:OZe,json:{read:!0,write:!0}})],QR.prototype,"style",void 0),QR=LW=u([N("esri.symbols.patterns.StylePattern3D")],QR);const Gxe=QR,RZe={types:{key:"type",base:Bxe,typeMap:{style:Gxe}},json:{write:!0}},jxe={types:{key:"type",base:zxe,typeMap:{style:_te}},json:{write:!0}},TI=new et("white");new et("black");const PZe=new et([255,255,255,0]);function IZe(t){return t.r===0&&t.g===0&&t.b===0}var DW;let SI=DW=class extends fd{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:b(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new DW(t)}};u([It({multiply:"multiply",replace:"replace",tint:"tint"})],SI.prototype,"colorMixMode",void 0),SI=DW=u([N("esri.symbols.support.Symbol3DFillMaterial")],SI);function bi(t=NZe){return[t[0],t[1],t[2],t[3]]}function bGt(t){return[t[0],t[1],t[2],t[3]]}function z_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function vte(t,e,i,r,s=bi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Hxe(t,e=bi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function Xk(t,e){return new ti({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function bte(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Mb(t,e,i){if(A(e))z_(i,t);else if("length"in e)kW(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}}function WB(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function NW(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function od(t){return A(t)||t[0]>=t[2]?0:t[2]-t[0]}function Om(t){return t[1]>=t[3]?0:t[3]-t[1]}function qxe(t){return od(t)*Om(t)}function wte(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Wxe(t,e){return Zk(t,e[0],e[1])}function Ule(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function wGt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,d=(v,x)=>(h-l)*v+(a-c)*x+(c*l-a*h)<0,f=d(r,o),m=d(n,o),g=d(n,s),y=d(r,s);return!(f===m&&m===g&&g===y&&y===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function xGt(t,e){return Zk(t,e.x,e.y)}function Zk(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function $Ze(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function Jk(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function FW(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function UW(t,e,i){if(A(e))return z_(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=Se(t[0],r,n),i[1]=Se(t[1],s,o),i[2]=Se(t[2],r,n),i[3]=Se(t[3],s,o),i}function LZe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-od(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Om(t)/2,0);return Math.sqrt(s*s+n*n)}function bU(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function kp(t){return t?z_(t,VW):bi(VW)}function kW(t){return t!=null&&t.length===4}function DZe(t){return!(od(t)!==0&&isFinite(t[0])||Om(t)!==0&&isFinite(t[1]))}function p2(t,e){return kW(t)&&kW(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const TGt=[-1/0,-1/0,1/0,1/0],VW=[1/0,1/0,-1/0,-1/0],NZe=[0,0,0,0];function Mo(t=Kxe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function V2(t,e,i,r,s,n,o=Mo()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function SGt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new ti(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function DA(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function FZe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Ey(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function ud(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)s=Math.min(s,e[i+3*h]),n=Math.min(n,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function YB(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function UZe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function wS(t){return t[0]>=t[3]?0:t[3]-t[0]}function xS(t){return t[1]>=t[4]?0:t[4]-t[1]}function bw(t){return t[2]>=t[5]?0:t[5]-t[2]}function Yxe(t){const e=wS(t),i=bw(t),r=xS(t);return Math.sqrt(e*e+i*i+r*r)}function rm(t,e=[0,0,0]){return e[0]=t[0]+wS(t)/2,e[1]=t[1]+xS(t)/2,e[2]=t[2]+bw(t)/2,e}function bN(t,e=[0,0,0]){return e[0]=wS(t),e[1]=xS(t),e[2]=bw(t),e}function xte(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function EGt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function kZe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function sm(t,e){return!!A(e)||kZe(t,e)}function Xxe(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function CGt(t,e,i=t){const r=t[0]+wS(t)/2,s=t[1]+xS(t)/2,n=t[2]+bw(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function MGt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zxe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function Jxe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function Kk(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ls(t){return t?Kk(t,kle):Mo(kle)}function Tte(t,e){return e||(e=bi()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function AGt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function VZe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function zW(t){return t.length===6}function Ste(t){return wS(t)===0&&xS(t)===0&&bw(t)===0}function OGt(t,e,i){if(A(t)||A(e))return t===e;if(!zW(t)||!zW(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function zZe(t,e,i,r,s,n){return V2(t,e,i,r,s,n,BZe)}const RGt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],kle=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Kxe=[0,0,0,0,0,0],BZe=Mo();function XB(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Ve(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const GZe=V2(-.5,-.5,-.5,.5,.5,.5),jZe=V2(-.5,-.5,0,.5,.5,1),HZe=V2(-.5,-.5,0,.5,.5,.5);function qZe(t){switch(t){case"sphere":case"cube":case"diamond":return GZe;case"cylinder":case"cone":case"inverted-cone":return jZe;case"tetrahedron":return HZe;default:return}}const Ete=["butt","square","round"],WZe=[...Ete,"none"],Qxe=["miter","bevel","round"];var BW;let Px=BW=class extends Ae{constructor(t){super(t),this.color=new et([0,0,0,1]),this.size=Up(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:b(this.color)?this.color.clone():null,size:this.size,pattern:b(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new BW(t)}};u([p(ev)],Px.prototype,"color",void 0),u([p(Sy)],Px.prototype,"size",void 0),u([p(jxe)],Px.prototype,"pattern",void 0),u([p({type:Ete,json:{default:"butt",write:{overridePolicy(){return{enabled:b(this.pattern)}}}}})],Px.prototype,"patternCap",void 0),Px=BW=u([N("esri.symbols.support.Symbol3DOutline")],Px);var Y5;let x0=Y5=class extends Ny{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:b(this.edges)?this.edges.clone():null,enabled:this.enabled,material:b(this.material)?this.material.clone():null,pattern:b(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:b(this.outline)?this.outline.clone():null};return new Y5(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new _te({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??TI).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new Y5({material:new SI({color:(t.color??PZe).clone()}),pattern:t.style&&t.style!=="solid"?new Gxe({style:t.style}):null,outline:i})}};u([It({Fill:"fill"},{readOnly:!0})],x0.prototype,"type",void 0),u([p({type:SI,json:{write:!0}})],x0.prototype,"material",void 0),u([p(RZe)],x0.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],x0.prototype,"castShadows",void 0),u([p({type:Px,json:{write:!0}})],x0.prototype,"outline",void 0),u([p(Fxe)],x0.prototype,"edges",void 0),x0=Y5=u([N("esri.symbols.FillSymbol3DLayer")],x0);const KL=x0,YZe=["none","underline","line-through"],XZe=["normal","italic","oblique"],ZZe=["normal","lighter","bold","bolder"],eTe={type:Number,cast:t=>{const e=mp(t);return e===0?1:Se(e,.1,4)},nonNullable:!0},JZe=["left","right","center"],KZe=["baseline","top","middle","bottom"],tTe={type:JZe,nonNullable:!0},iTe={type:KZe,nonNullable:!0};var GW;let T0=GW=class extends Ae{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return kr(t)}clone(){return new GW({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:YZe,json:{default:"none",write:!0}})],T0.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],T0.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],T0.prototype,"size",void 0),u([pi("size")],T0.prototype,"castSize",null),u([p({type:XZe,json:{default:"normal",write:!0}})],T0.prototype,"style",void 0),u([p({type:ZZe,json:{default:"normal",write:!0}})],T0.prototype,"weight",void 0),T0=GW=u([N("esri.symbols.Font")],T0);const Qk=T0;function T3(t,e){const i=e&&e.url&&e.url.path;if(t&&i&&(t=nd(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=Mee(t,e.portalItem.itemUrl);r!=null&&QZe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return jW(t,e&&e.portal)}function z2(t,e,i=R$.YES){if(t==null)return t;!hd(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=nd(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=jW(s,e.portal),o=jW(r,e.portal);r=Mee(o,n,n),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=sTe(r,e==null?void 0:e.portal),hd(r)&&(r=Op(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!hd(r)&&!$y(r)&&i===R$.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Cte(t,e,i){return T3(t,i)}function jb(t,e,i,r){const s=z2(t,r);s!==void 0&&(e[i]=s)}const rTe=/\/items\/([^\/]+)\/resources\/(.*)/,QZe=/^\.\/resources\//;function eJe(t){var e;return((e=(t==null?void 0:t.match(rTe))??null)==null?void 0:e[1])??null}function tJe(t){const e=(t==null?void 0:t.match(rTe))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=rle(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=rle(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function sTe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?$q(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function jW(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=See();return TA(r,`${r.scheme}://${i}`)?$q(t,e.portalHostname,i):$q(t,i,e.portalHostname)}var R$;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(R$||(R$={}));const PGt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return R$},ensureMainOnlineDomain:sTe,fromJSON:T3,itemIdFromResourceUrl:eJe,prefixAndFilenameFromResourceUrl:tJe,read:Cte,toJSON:z2,write:jb},Symbol.toStringTag,{value:"Module"}));var HW;const iJe=jl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Ix=HW=class extends Ae{constructor(t){super(t)}readHref(t,e,i){return t?T3(t,i):e.dataURI}writeHref(t,e,i,r){t&&($y(t)?e.dataURI=t:(e.href=z2(t,r),hd(e.href)&&(e.href=Op(e.href))))}clone(){return new HW({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Ix.prototype,"href",void 0),u([De("href")],Ix.prototype,"readHref",null),u([Xe("href",{href:{type:String},dataURI:{type:String}})],Ix.prototype,"writeHref",null),u([It(iJe)],Ix.prototype,"primitive",void 0),Ix=HW=u([N("esri.symbols.support.IconSymbol3DLayerResource")],Ix);const rJe="circle";var qW;let fM=qW=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new qW({x:this.x,y:this.y})}};u([p({type:Number})],fM.prototype,"x",void 0),u([p({type:Number})],fM.prototype,"y",void 0),fM=qW=u([N("esri.symbols.support.Symbol3DAnchorPosition2D")],fM);var WW;let eP=WW=class extends Ae{constructor(t){super(t),this.color=new et([0,0,0,1]),this.size=Up(1)}clone(){const t={color:b(this.color)?this.color.clone():null,size:this.size};return new WW(t)}};u([p(ev)],eP.prototype,"color",void 0),u([p(Sy)],eP.prototype,"size",void 0),eP=WW=u([N("esri.symbols.support.Symbol3DIconOutline")],eP);var pC;const nTe="esri.symbols.IconSymbol3DLayer";let bg=pC=class extends Ny{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new pC({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:b(this.material)?this.material.clone():null,outline:b(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||TI,i=Vle(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||TI).clone()}:null;return new pC({size:t.size,resource:{primitive:nJe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||IZe(t.color)?TI:t.color,i=Vle(t);return new pC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new pC({resource:{href:Hbe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Vle(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=zle(t.xoffset),s=zle(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function zle(t){return isFinite(t)?t:0}u([p({type:fd,json:{write:!0}})],bg.prototype,"material",void 0),u([p({type:Ix,json:{write:!0}})],bg.prototype,"resource",void 0),u([It({Icon:"icon"},{readOnly:!0})],bg.prototype,"type",void 0),u([p(Sy)],bg.prototype,"size",void 0),u([It({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],bg.prototype,"anchor",void 0),u([p({type:fM,json:{type:[Number],read:{reader:t=>new fM({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],bg.prototype,"anchorPosition",void 0),u([p({type:eP,json:{write:!0}})],bg.prototype,"outline",void 0),bg=pC=u([N(nTe)],bg);const sJe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function nJe(t){return sJe[t]||(le.getLogger(nTe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const pb=bg;let $x=class extends hn(Ae){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return b(e)&&e.placement===this.placement&&e.style===this.style&&(A(this.color)&&A(e.color)||b(this.color)&&b(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$x.prototype,"type",void 0),u([p({type:EZe,json:{default:"begin-end",write:!0}})],$x.prototype,"placement",void 0),u([p({type:kxe,json:{default:"arrow",write:!0}})],$x.prototype,"style",void 0),u([p({type:et,json:{type:[Fr],default:null,write:!0}})],$x.prototype,"color",void 0),$x=u([N("esri.symbols.LineStyleMarker3D")],$x);const YW=$x;var X5;let wg=X5=class extends Ny{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Up(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:b(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:b(this.pattern)?this.pattern.clone():null,marker:b(this.marker)?this.marker.clone():null};return new X5(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??Up(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new _te({style:t.style}):null,material:new fd({color:(t.color||TI).clone()}),marker:t.marker?new YW({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new X5(e)}};u([p({type:fd,json:{write:!0}})],wg.prototype,"material",void 0),u([It({Line:"line"},{readOnly:!0})],wg.prototype,"type",void 0),u([p({type:Qxe,json:{write:!0,default:"miter"}})],wg.prototype,"join",void 0),u([p({type:Ete,json:{write:!0,default:"butt"}})],wg.prototype,"cap",void 0),u([p(Sy)],wg.prototype,"size",void 0),u([p(jxe)],wg.prototype,"pattern",void 0),u([p({types:{key:"type",base:YW,typeMap:{style:YW}},json:{write:!0}})],wg.prototype,"marker",void 0),wg=X5=u([N("esri.symbols.LineSymbol3DLayer")],wg);const QL=wg;var XW;const oJe=jl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let tP=XW=class extends Ae{clone(){return new XW({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:Cte,write:jb}})],tP.prototype,"href",void 0),u([It(oJe)],tP.prototype,"primitive",void 0),tP=XW=u([N("esri.symbols.support.ObjectSymbol3DLayerResource")],tP);const oTe="sphere";var ZW;let RT=ZW=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new ZW({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],RT.prototype,"x",void 0),u([p({type:Number})],RT.prototype,"y",void 0),u([p({type:Number})],RT.prototype,"z",void 0),RT=ZW=u([N("esri.symbols.support.Symbol3DAnchorPosition3D")],RT);var JW;let ic=JW=class extends Ny{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new JW({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:fd,json:{write:!0}})],ic.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ic.prototype,"castShadows",void 0),u([p({type:tP,json:{write:!0}})],ic.prototype,"resource",void 0),u([It({Object:"object"},{readOnly:!0})],ic.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"depth",void 0),u([It({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],ic.prototype,"anchor",void 0),u([p({type:RT,json:{type:[Number],read:{reader:t=>new RT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ic.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],ic.prototype,"roll",void 0),u([p({readOnly:!0})],ic.prototype,"isPrimitive",null),ic=JW=u([N("esri.symbols.ObjectSymbol3DLayer")],ic);const Mte=ic;var KW;let Uc=KW=class extends Ny{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new KW({enabled:this.enabled,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:fd,json:{write:!0}})],Uc.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Uc.prototype,"castShadows",void 0),u([It({Path:"path"},{readOnly:!0})],Uc.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],Uc.prototype,"profile",void 0),u([p({type:Qxe,json:{write:!0,default:"miter"}})],Uc.prototype,"join",void 0),u([p({type:WZe,json:{write:!0,default:"butt"}})],Uc.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Uc.prototype,"width",void 0),u([De("width",["width","size","height"])],Uc.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],Uc.prototype,"height",void 0),u([De("height",["height","size","width"])],Uc.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Uc.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],Uc.prototype,"profileRotation",void 0),Uc=KW=u([N("esri.symbols.PathSymbol3DLayer")],Uc);const Ate=Uc;var QW;let mM=QW=class extends Ae{constructor(){super(...arguments),this.color=new et([0,0,0,1]),this.size=0}clone(){const t={color:ue(this.color),size:this.size};return new QW(t)}};u([p(ev)],mM.prototype,"color",void 0),u([p(Sy)],mM.prototype,"size",void 0),mM=QW=u([N("esri.symbols.support.Symbol3DHalo")],mM);let EI=class extends hn(Ae){constructor(e){super(e),this.color=null}};u([p(ev)],EI.prototype,"color",void 0),EI=u([N("esri.symbols.support.Symbol3DTextBackground")],EI);var Z5;let Cu=Z5=class extends Ny{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){b(t)&&b(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return b(this._userSize)?this._userSize:b(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,b(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new Z5({enabled:this.enabled,font:this.font&&ue(this.font),halo:this.halo&&ue(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:b(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ue(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new Z5({font:b(t.font)?t.font.clone():new Qk,halo:aJe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new fd({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new EI({color:t.backgroundColor.clone()}):null})}};function aJe(t,e){return t&&e!=null&&e>0?new mM({color:ue(t),size:e}):null}u([p({type:Qk,json:{write:!0}})],Cu.prototype,"font",null),u([Xe("font")],Cu.prototype,"writeFont",null),u([p({type:mM,json:{write:!0}})],Cu.prototype,"halo",void 0),u([p({...tTe,json:{default:"center",write:!0}})],Cu.prototype,"horizontalAlignment",void 0),u([p({...eTe,json:{default:1,write:!0}})],Cu.prototype,"lineHeight",void 0),u([p({type:fd,json:{write:!0}})],Cu.prototype,"material",void 0),u([p({type:EI,json:{write:!0}})],Cu.prototype,"background",void 0),u([p(Sy)],Cu.prototype,"size",null),u([p({type:String,json:{write:!0}})],Cu.prototype,"text",void 0),u([It({Text:"text"},{readOnly:!0})],Cu.prototype,"type",void 0),u([p({...iTe,json:{default:"baseline",write:!0}})],Cu.prototype,"verticalAlignment",void 0),Cu=Z5=u([N("esri.symbols.TextSymbol3DLayer")],Cu);const TS=Cu;var eY;let f1=eY=class extends Ny{constructor(t){super(t),this.color=tY.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new eY({color:ue(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:et,nonNullable:!0,json:{type:[Fr],write:(t,e,i)=>e[i]=t.toArray(et.AlphaMode.UNLESS_OPAQUE),default:()=>tY.clone(),defaultEquals:t=>t.toCss(!0)===tY.toCss(!0)}})],f1.prototype,"color",void 0),u([It({Water:"water"},{readOnly:!0})],f1.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],f1.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],f1.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],f1.prototype,"waveStrength",void 0),f1=eY=u([N("esri.symbols.WaterSymbol3DLayer")],f1);const tY=new et([0,119,190]),aTe=f1;var iY;let Lx=iY=class extends Ee{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new iY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],Lx.prototype,"name",void 0),u([p({type:String})],Lx.prototype,"styleUrl",void 0),u([p({type:String})],Lx.prototype,"styleName",void 0),u([p({type:du})],Lx.prototype,"portal",void 0),Lx=iY=u([N("esri.symbols.support.StyleOrigin")],Lx);const rY=Lx;var sY;let CI=sY=class extends Ee{constructor(){super(...arguments),this.url=""}clone(){return new sY({url:this.url})}};u([p({type:String})],CI.prototype,"url",void 0),CI=sY=u([N("esri.symbols.support.Thumbnail")],CI);const lTe={icon:pb,object:Mte,line:QL,path:Ate,fill:KL,extrude:Uxe,text:TS,water:aTe},lJe=xt.ofType({base:Ny,key:"type",typeMap:lTe,errorContext:"symbol-layer"});let xg=class extends yh{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i&&i.type||xt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&le.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){I2(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=T3(e.styleUrl,r);return new rY({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new rY({portal:r&&r.portal||du.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new Np("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=z2(e.styleUrl,s);hd(n)&&(n=Op(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!Gbe(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new Np("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Ny||e&&lTe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],xg.prototype,"color",null),u([p({type:lJe,nonNullable:!0,json:{write:!0}}),pi(Rbe)],xg.prototype,"symbolLayers",null),u([p({type:rY})],xg.prototype,"styleOrigin",void 0),u([De("styleOrigin")],xg.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],xg.prototype,"writeStyleOrigin",null),u([p({type:CI,json:{read:!1}})],xg.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],xg.prototype,"type",void 0),xg=u([N("esri.symbols.Symbol3D")],xg);const S3=xg;let iP=class extends Ae{constructor(e){super(e),this.visible=!0}clone(){}};u([p({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],iP.prototype,"type",void 0),u([p({readOnly:!0})],iP.prototype,"visible",void 0),iP=u([N("esri.symbols.callouts.Callout3D")],iP);const cTe=iP;var nY;let J5=nY=class extends Ae{constructor(){super(...arguments),this.color=new et("white")}clone(){return new nY({color:ue(this.color)})}};u([p(ev)],J5.prototype,"color",void 0),J5=nY=u([N("esri.symbols.callouts.LineCallout3DBorder")],J5);const uTe=J5;Object.freeze(Object.defineProperty({__proto__:null,default:uTe},Symbol.toStringTag,{value:"Module"}));var oY;let m1=oY=class extends cTe{constructor(t){super(t),this.type="line",this.color=new et([0,0,0,1]),this.size=Up(1),this.border=null}get visible(){return this.size>0&&b(this.color)&&this.color.a>0}clone(){return new oY({color:ue(this.color),size:this.size,border:ue(this.border)})}};u([It({line:"line"},{readOnly:!0})],m1.prototype,"type",void 0),u([p(ev)],m1.prototype,"color",void 0),u([p(Sy)],m1.prototype,"size",void 0),u([p({type:uTe,json:{write:!0}})],m1.prototype,"border",void 0),u([p({readOnly:!0})],m1.prototype,"visible",null),m1=oY=u([N("esri.symbols.callouts.LineCallout3D")],m1);const cJe=m1;function Ote(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||b(e.maxWorldLength)&&e.maxWorldLength<=0)}function hTe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Ote(t)}function Rte(t){return t.type==="point-3d"||t.type==="label-3d"}function dTe(t){return t.horizontalAlignment==="center"}const pTe={types:{key:"type",base:cTe,typeMap:{line:cJe}},json:{write:!0}};var aY;let fC=aY=class extends Ae{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new aY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p(Sy)],fC.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],fC.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],fC.prototype,"maxWorldLength",void 0),fC=aY=u([N("esri.symbols.support.Symbol3DVerticalOffset")],fC);const fTe=fC;var K5;const mTe=xt.ofType({base:null,key:"type",typeMap:{text:TS}});let g1=K5=class extends S3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new mTe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return hTe(this)}hasVisibleVerticalOffset(){return Ote(this)}clone(){return new K5({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail),callout:ue(this.callout),verticalOffset:ue(this.verticalOffset)})}static fromTextSymbol(t){return new K5({symbolLayers:[TS.fromTextSymbol(t)]})}};u([p({type:fTe,json:{write:!0}})],g1.prototype,"verticalOffset",void 0),u([p(pTe)],g1.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],g1.prototype,"styleOrigin",void 0),u([p({type:mTe})],g1.prototype,"symbolLayers",void 0),u([It({LabelSymbol3D:"label-3d"},{readOnly:!0})],g1.prototype,"type",void 0),g1=K5=u([N("esri.symbols.LabelSymbol3D")],g1);const eV=g1;var Q5;const gTe=xt.ofType({base:null,key:"type",typeMap:{line:QL,path:Ate}}),uJe=xt.ofType({base:null,key:"type",typeMap:{line:QL,path:Ate}});let rP=Q5=class extends S3{constructor(t){super(t),this.symbolLayers=new gTe,this.type="line-3d"}clone(){return new Q5({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromSimpleLineSymbol(t){return new Q5({symbolLayers:[QL.fromSimpleLineSymbol(t)]})}};u([p({type:gTe,json:{type:uJe}})],rP.prototype,"symbolLayers",void 0),u([It({LineSymbol3D:"line-3d"},{readOnly:!0})],rP.prototype,"type",void 0),rP=Q5=u([N("esri.symbols.LineSymbol3D")],rP);const tV=rP;let y1=class extends yh{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],y1.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],y1.prototype,"type",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],y1.prototype,"xoffset",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],y1.prototype,"yoffset",void 0),u([p({type:Number,cast:t=>t==="auto"?t:kr(t),json:{write:!0}})],y1.prototype,"size",void 0),y1=u([N("esri.symbols.MarkerSymbol")],y1);const yTe=y1;var e6;const _Te=xt.ofType({base:null,key:"type",typeMap:{fill:KL}});let sP=e6=class extends S3{constructor(t){super(t),this.symbolLayers=new _Te,this.type="mesh-3d"}clone(){return new e6({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromSimpleFillSymbol(t){return new e6({symbolLayers:[KL.fromSimpleFillSymbol(t)]})}};u([p({type:_Te})],sP.prototype,"symbolLayers",void 0),u([It({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],sP.prototype,"type",void 0),sP=e6=u([N("esri.symbols.MeshSymbol3D")],sP);const iV=sP;function hJe(t,e,i){return e.imageData?Hbe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):vTe(e.url,i)}function vTe(t,e){var i;return pJe(e)&&!hd(t)&&((i=e==null?void 0:e.layer)!=null&&i.parsedUrl)?$2(e.layer.parsedUrl.path,"images",t):T3(t,e)}function dJe(t,e,i,r){if($y(t)){const s=HL(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&jb(i.url,e,"url",r)}else jb(t,e,"url",r)}const bTe={json:{read:{source:["imageData","url"],reader:hJe},write:{writer(t,e,i,r){dJe(t,e,this.source,r)}}}},wTe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=vTe(e.url,i)),r}}}};function pJe(t){var e,i;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((i=t.layer)==null?void 0:i.type)!=="stream")}var lY;let Yd=lY=class extends Vxe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=kr(i)),r!=null&&(s.height=kr(r)),s}clone(){const t=new lY({color:ue(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ue(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([It({esriPFS:"picture-fill"},{readOnly:!0})],Yd.prototype,"type",void 0),u([p(bTe)],Yd.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],Yd.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],Yd.prototype,"yscale",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Yd.prototype,"width",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Yd.prototype,"height",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Yd.prototype,"xoffset",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Yd.prototype,"yoffset",void 0),u([p(wTe)],Yd.prototype,"source",void 0),Yd=lY=u([N("esri.symbols.PictureFillSymbol")],Yd);const xTe=Yd;var cY;let bf=cY=class extends yTe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=kr(e)),i!=null&&(r.height=kr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new cY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ue(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],bf.prototype,"color",void 0),u([It({esriPMS:"picture-marker"},{readOnly:!0})],bf.prototype,"type",void 0),u([p(bTe)],bf.prototype,"url",void 0),u([p(wTe)],bf.prototype,"source",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],bf.prototype,"height",void 0),u([De("height",["height","size"])],bf.prototype,"readHeight",null),u([p({type:Number,cast:kr,json:{write:!0}})],bf.prototype,"width",void 0),u([p({json:{write:!1}})],bf.prototype,"size",void 0),bf=cY=u([N("esri.symbols.PictureMarkerSymbol")],bf);const rV=bf;var Dx;const TTe=xt.ofType({base:null,key:"type",typeMap:{icon:pb,object:Mte,text:TS}});let Nx=Dx=class extends S3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new TTe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return hTe(this)}hasVisibleVerticalOffset(){return Ote(this)}clone(){return new Dx({verticalOffset:ue(this.verticalOffset),callout:ue(this.callout),styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Dx({symbolLayers:[pb.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Dx({symbolLayers:[pb.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Dx(i!=null&&i.callout?{symbolLayers:[pb.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[pb.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Dx({symbolLayers:[TS.fromTextSymbol(t)]})}};u([p({type:fTe,json:{write:!0}})],Nx.prototype,"verticalOffset",void 0),u([p(pTe)],Nx.prototype,"callout",void 0),u([p({type:TTe,json:{origins:{"web-scene":{write:!0}}}})],Nx.prototype,"symbolLayers",void 0),u([It({PointSymbol3D:"point-3d"},{readOnly:!0})],Nx.prototype,"type",void 0),Nx=Dx=u([N("esri.symbols.PointSymbol3D")],Nx);const fb=Nx;var nP;const STe=xt.ofType({base:null,key:"type",typeMap:{extrude:Uxe,fill:KL,icon:pb,line:QL,object:Mte,text:TS,water:aTe}});let oP=nP=class extends S3{constructor(t){super(t),this.symbolLayers=new STe,this.type="polygon-3d"}clone(){return new nP({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromJSON(t){const e=new nP;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const i=e.symbolLayers.getItemAt(0),r=e.symbolLayers.getItemAt(1);!r.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:b(r.material)?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new nP({symbolLayers:[KL.fromSimpleFillSymbol(t)]})}};u([p({type:STe,json:{write:!0}})],oP.prototype,"symbolLayers",void 0),u([It({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],oP.prototype,"type",void 0),oP=nP=u([N("esri.symbols.PolygonSymbol3D")],oP);const eD=oP;var uY;const ZB=new Hi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Fx=uY=class extends Vxe{constructor(...t){super(...t),this.color=new et([0,0,0,.25]),this.outline=new uh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new uY({color:ue(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],Fx.prototype,"color",void 0),u([p()],Fx.prototype,"outline",void 0),u([It({esriSFS:"simple-fill"},{readOnly:!0})],Fx.prototype,"type",void 0),u([p({type:ZB.apiValues,json:{read:ZB.read,write:ZB.write}})],Fx.prototype,"style",void 0),Fx=uY=u([N("esri.symbols.SimpleFillSymbol")],Fx);const Cy=Fx;var hY;const JB=new Hi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Tg=hY=class extends yTe{constructor(...t){super(...t),this.color=new et([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new uh}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=kr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new hY({angle:this.angle,color:ue(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([p()],Tg.prototype,"color",void 0),u([Xe("color")],Tg.prototype,"writeColor",null),u([It({esriSMS:"simple-marker"},{readOnly:!0})],Tg.prototype,"type",void 0),u([p()],Tg.prototype,"size",void 0),u([p({type:JB.apiValues,json:{read:JB.read,write:JB.write}})],Tg.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],Tg.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":uh}},json:{default:null,write:!0}})],Tg.prototype,"outline",void 0),Tg=hY=u([N("esri.symbols.SimpleMarkerSymbol")],Tg);const gm=Tg;var dY;let Mn=dY=class extends yh{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new Qk,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return kr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new dY({angle:this.angle,backgroundColor:ue(this.backgroundColor),borderLineColor:ue(this.borderLineColor),borderLineSize:this.borderLineSize,color:ue(this.color),font:this.font&&this.font.clone(),haloColor:ue(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:et,json:{write:!0}})],Mn.prototype,"backgroundColor",void 0),u([p({type:et,json:{write:!0}})],Mn.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:kr})],Mn.prototype,"borderLineSize",void 0),u([p({type:Qk,json:{write:!0}})],Mn.prototype,"font",void 0),u([p({...tTe,json:{write:!0}})],Mn.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],Mn.prototype,"kerning",void 0),u([p({type:et,json:{write:!0}})],Mn.prototype,"haloColor",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Mn.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],Mn.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],Mn.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],Mn.prototype,"text",void 0),u([It({esriTS:"text"},{readOnly:!0})],Mn.prototype,"type",void 0),u([p({...iTe,json:{write:!0}})],Mn.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Mn.prototype,"xoffset",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Mn.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Mn.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],Mn.prototype,"width",void 0),u([p({type:Number})],Mn.prototype,"lineWidth",void 0),u([Xe("lineWidth")],Mn.prototype,"writeLineWidth",null),u([pi("lineWidth")],Mn.prototype,"castLineWidth",null),u([p(eTe)],Mn.prototype,"lineHeight",void 0),u([Xe("lineHeight")],Mn.prototype,"writeLineHeight",null),Mn=dY=u([N("esri.symbols.TextSymbol")],Mn);const E3=Mn;var pY;let wf=pY=class extends yh{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=b(this.portal)?this.portal:du.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new pY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=b(e)?e.cache:null,r=i?this._fetchCacheKey:null;if(b(i)){const a=r&&i.get(r);if(a)return a.clone()}const s=await fJe();_i(e);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},t,e);n.catch(a=>{le.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(b(i)&&i.set(r,o.clone()),o):null}};function fJe(){return se(()=>import("./webStyleSymbolUtils-5c96af84.js"),[])}u([p({json:{write:!1}})],wf.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],wf.prototype,"styleName",void 0),u([p({type:du,json:{write:!1}})],wf.prototype,"portal",void 0),u([p({type:String,json:{read:Cte,write:jb}})],wf.prototype,"styleUrl",void 0),u([p({type:CI,json:{read:!1}})],wf.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],wf.prototype,"name",void 0),u([It({styleSymbolReference:"web-style"},{readOnly:!0})],wf.prototype,"type",void 0),u([p()],wf.prototype,"_fetchCacheKey",null),wf=pY=u([N("esri.symbols.WebStyleSymbol")],wf);const SS=wf;function sV(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function B2(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Hu={base:yh,key:"type",typeMap:{"simple-fill":Cy,"picture-fill":xTe,"picture-marker":rV,"simple-line":uh,"simple-marker":gm,text:E3,"label-3d":eV,"line-3d":tV,"mesh-3d":iV,"point-3d":fb,"polygon-3d":eD,"web-style":SS,cim:x3},errorContext:"symbol"},mJe={base:yh,key:"type",typeMap:{"picture-marker":rV,"simple-marker":gm,text:E3,"web-style":SS,cim:x3},errorContext:"symbol"},gJe=gw({types:Hu}),nV={base:yh,key:"type",typeMap:{"simple-fill":Cy,"picture-fill":xTe,"picture-marker":rV,"simple-line":uh,"simple-marker":gm,text:E3,"line-3d":tV,"mesh-3d":iV,"point-3d":fb,"polygon-3d":eD,"web-style":SS,cim:x3},errorContext:"symbol"},yJe={base:yh,key:"type",typeMap:{text:E3,"label-3d":eV},errorContext:"symbol"},Ble={base:yh,key:"type",typeMap:{"line-3d":tV,"mesh-3d":iV,"point-3d":fb,"polygon-3d":eD,"web-style":SS,cim:x3},errorContext:"symbol"},_Je={base:yh,key:"type",typeMap:{"label-3d":eV},errorContext:"symbol"},ETe=xm(Hu);function vJe(t){if(!t)return null;const e={};for(const i in t){const r=Mm(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function bJe(t){if(!b(t))return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Mu=class extends hn(Ae){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:nh(),configurable:!0})}normalizeCtorArgs(e,i,r,s){return e&&!e.declaredClass?e:{geometry:e,symbol:i,attributes:r,popupTemplate:s}}set aggregateGeometries(e){const i=this._get("aggregateGeometries");JSON.stringify(i)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const i=this._get("attributes");i!==e&&(this._set("attributes",e),this._notifyLayer("attributes",i,e))}set geometry(e){const i=this._get("geometry");i!==e&&(this._set("geometry",e),this._notifyLayer("geometry",i,e))}set symbol(e){const i=this._get("symbol");i!==e&&(this._set("symbol",e),this._notifyLayer("symbol",i,e))}set visible(e){const i=this._get("visible");i!==e&&(this._set("visible",e),this._notifyLayer("visible",i,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const i of[this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(e&&"defaultPopupTemplate"in i&&b(i.defaultPopupTemplate))return i.defaultPopupTemplate}return null}getAttribute(e){var i;return(i=this.attributes)==null?void 0:i[e]}setAttribute(e,i){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=i,this._notifyLayer("attributes",r,i,e)}else this.attributes={[e]:i},this._notifyLayer("attributes",void 0,i,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:bJe(this.aggregateGeometries),geometry:b(this.geometry)?this.geometry.toJSON():null,symbol:b(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){b(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,i,r,s){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:i,newValue:r};e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}};u([p({value:null,json:{read:vJe}})],Mu.prototype,"aggregateGeometries",null),u([p({value:null})],Mu.prototype,"attributes",null),u([p({value:null,types:yw,json:{read:Mm}})],Mu.prototype,"geometry",null),u([p({type:Boolean})],Mu.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],Mu.prototype,"layer",void 0),u([p({type:vw})],Mu.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],Mu.prototype,"sourceLayer",void 0),u([p({value:null,types:Hu})],Mu.prototype,"symbol",null),u([p({type:Boolean,value:!0})],Mu.prototype,"visible",null),Mu=u([N("esri.Graphic")],Mu),function(t){t.generateUID=nh}(Mu||(Mu={}));const Ho=Mu;let Hb=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,s=0,n=!1){return(r-=s)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=e),r+s}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return Se(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Pte(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const wJe=Pte(new Hb(0,2*Math.PI)),qb=Pte(new Hb(-Math.PI,Math.PI)),oV=Pte(new Hb(0,360));let S0=class extends hn(Ae){constructor(...e){super(...e),this.position=new st([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=mp(e.x||0),n.y=mp(e.y||0),n.z=e.hasZ?mp(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new st;return r.read(e,i),r.x=mp(r.x||0),r.y=mp(r.y||0),r.z=r.hasZ?mp(r.z||0):r.z,r}equals(e){return!A(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([p({type:st,json:{write:{isRequired:!0}}})],S0.prototype,"position",void 0),u([Xe("position")],S0.prototype,"writePosition",null),u([De("position")],S0.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),pi(t=>oV.normalize(mp(t)))],S0.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),pi(t=>Se(mp(t),-180,180))],S0.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],S0.prototype,"fov",void 0),S0=u([N("esri.Camera")],S0);const Vp=S0;var fY;let _1=fY=class extends Ae{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new fY({rotation:this.rotation,scale:this.scale,targetGeometry:b(this.targetGeometry)?this.targetGeometry.clone():null,camera:b(this.camera)?this.camera.clone():null})}};function KB(){return{enabled:!this.camera}}u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:KB}}}}})],_1.prototype,"rotation",void 0),u([pi("rotation")],_1.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:KB}}}}})],_1.prototype,"scale",void 0),u([p({types:yw,json:{read:Mm,write:!0,origins:{"web-scene":{read:Mm,write:{overridePolicy:KB}}}}})],_1.prototype,"targetGeometry",void 0),u([p({type:Vp,json:{write:!0}})],_1.prototype,"camera",void 0),_1=fY=u([N("esri.Viewpoint")],_1);const ya=_1;function ae(t,e,i={}){return Ite(t,e,i,CTe)}function wa(t,e,i={}){return Ite(t,e,i,MTe)}function Ite(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(is(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=Nje(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function Gs(t,e,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&is(o),i(h)}const c=ae(t,(h,d)=>{var f;a(),Ck(h)&&(s=h,n=zL(h,e,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Dp(()=>{c.remove(),a()}),o}function Wb(t,e){return xJe(t,MTe,e)}function xJe(t,e,i){if(yo(i))return Promise.reject(er());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=is(s)}return new Promise((o,a)=>{s=bA([ol(i,()=>{n(),a(er())}),Ite(t,l=>{n(),o(l)},{sync:!1,once:!0},e??CTe)])})}function CTe(t){return!0}function MTe(t){return!!t}function VGt(t,e,i={}){let r=!1;const s=ae(t,(n,o)=>{r||e(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const Mi={sync:!0},ii={initial:!0},Tr={sync:!0,initial:!0};let wU=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(i=>{e(i)||this._items.delete(i)}),this}};var el;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(el||(el={}));let TJe=0;function ATe(){return TJe++}function SJe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function P$(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function $te(t,e,i,r){if(e.type===el.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==el.INVOKE&&e.type!==el.RESPONSE)return void t.postMessage(e);let s;if(SJe(i)?(s=Gle(i.transferList),e.data=i.result):(s=Gle(r),e.data=i),s){if(me("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case el.INVOKE:throw o;case el.RESPONSE:return void $te(t,{type:el.RESPONSE,jobId:e.jobId,error:P$(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function I$(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Gle(t){if(!t||!t.length)return null;if(me("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!EJe(i));return e.length?e:null}function EJe(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const CJe={statsWorker:()=>se(()=>import("./statsWorker-29457bd8.js"),[]),geometryEngineWorker:()=>se(()=>import("./geometryEngineWorker-b0733993.js"),["assets/geometryEngineWorker-b0733993.js","assets/geometryEngineJSON-0cf11512.js","assets/geometryEngineBase-e1a33b0a.js"]),CSVSourceWorker:()=>se(()=>import("./CSVSourceWorker-5daf4705.js"),["assets/CSVSourceWorker-5daf4705.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/number-3acb8d45.js"]),EdgeProcessingWorker:()=>se(()=>import("./EdgeProcessingWorker-a16da055.js"),[]),ElevationSamplerWorker:()=>se(()=>import("./ElevationSamplerWorker-e620644b.js"),["assets/ElevationSamplerWorker-e620644b.js","assets/PooledRBush-66deaec2.js","assets/georeference-e4a7e853.js"]),FeatureServiceSnappingSourceWorker:()=>se(()=>import("./FeatureServiceSnappingSourceWorker-28517f1b.js"),["assets/FeatureServiceSnappingSourceWorker-28517f1b.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/symbologySnappingCandidates-3220e467.js"]),GeoJSONSourceWorker:()=>se(()=>import("./GeoJSONSourceWorker-25a69e95.js"),["assets/GeoJSONSourceWorker-25a69e95.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/geojson-ad67615f.js","assets/sourceUtils-afef6179.js"]),LercWorker:()=>se(()=>import("./LercWorker-e84613d9.js"),[]),MemorySourceWorker:()=>se(()=>import("./MemorySourceWorker-b3b5525b.js"),["assets/MemorySourceWorker-b3b5525b.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/sourceUtils-afef6179.js"]),PBFDecoderWorker:()=>se(()=>import("./PBFDecoderWorker-e18f42ca.js"),[]),Pipeline:()=>se(()=>import("./Pipeline-24d8e7aa.js"),["assets/Pipeline-24d8e7aa.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore2D-bd750ab7.js","assets/CircularArray-7b2394fa.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/definitions-19bfb61c.js","assets/visualVariablesUtils-e8f7cd46.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6a784d48.js","assets/ogcFeatureUtils-37c9dd16.js","assets/geojson-ad67615f.js","assets/StreamFeatureManager-38a173ae.js","assets/createConnection-8ff8a841.js"]),PointCloudWorker:()=>se(()=>import("./PointCloudWorker-62dc6581.js"),["assets/PointCloudWorker-62dc6581.js","assets/PointCloudWorkerUtil-81f54173.js","assets/PointCloudUniqueValueRenderer-d2a220ca.js","assets/I3SBinaryReader-90fedac1.js"]),RasterWorker:()=>se(()=>import("./RasterWorker-fe149682.js"),["assets/RasterWorker-fe149682.js","assets/dataUtils-8c20a88d.js","assets/RasterSymbolizer-cdc4335b.js","assets/colorUtils-7641d345.js","assets/utils-f2faa01f.js","assets/rasterProjectionHelper-00c1b486.js"]),SceneLayerSnappingSourceWorker:()=>se(()=>import("./SceneLayerSnappingSourceWorker-1e2089c9.js"),[]),SceneLayerWorker:()=>se(()=>import("./SceneLayerWorker-6944e21b.js").then(t=>t.S),["assets/SceneLayerWorker-6944e21b.js","assets/I3SNode-5e16d2d0.js"]),WFSSourceWorker:()=>se(()=>import("./WFSSourceWorker-13fe0c02.js"),["assets/WFSSourceWorker-13fe0c02.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/geojson-ad67615f.js","assets/sourceUtils-afef6179.js","assets/wfsUtils-d5a35f0f.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>se(()=>import("./WorkerTileHandler-6e50b9b2.js"),["assets/WorkerTileHandler-6e50b9b2.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/TurboLine-95dd8b1b.js","assets/definitions-19bfb61c.js","assets/StyleRepository-7fc711a8.js","assets/colorUtils-7641d345.js","assets/BidiEngine-836b7ef6.js"])},{CLOSE:jle,ABORT:Hle,INVOKE:qle,RESPONSE:CO,OPEN_PORT:Wle,ON:MJe}=el,AJe=2;let OJe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===el.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Yb=class mC{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new mC(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),mC.clients.set(s,r),i.port2}static loadWorker(e){const i=CJe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new OJe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:jle}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new J("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=ATe();return new Promise((a,l)=>{if(yo(s))return this._processWork(),void l(er());const c=ol(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),is(d.abortHandle),this._post({type:Hle,jobId:o}),l(er()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:qle,jobId:o,methodName:e,abortable:s!=null},i,n)})}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:el.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:el.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Wle,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=AJe)return;const e=this._getNextJob();if(!e)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=e;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{is(e.abortHandle),e.reject(er(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){b(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=I$(e);if(i)switch(i.type){case CO:this._onResponseMessage(i);break;case qle:this._invokeQueue.push(i);break;case Hle:this._onAbortMessage(i);break;case jle:this._onCloseMessage();break;case Wle:this._onOpenPortMessage(i);break;case MJe:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&mC.clients.get(this)===e&&e.destroy(),mC.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:CO,jobId:r,error:P$(d)})}gh(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:CO,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),kn(d)||this._post({type:CO,jobId:r,error:P$(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:CO,jobId:r},l)}_onOpenPortMessage(e){new mC(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=zL(e.port,"message",n=>{var o;((o=I$(n))==null?void 0:o.type)===el.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),is(o.abortHandle),r?o.reject(J.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return $te(this._port,e,i,r)}};Yb.kernelInfo={revision:hwe,version:dwe,buildDate:uwe},Yb.clients=new Map;let RJe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new wU}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{_i(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];gh(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Yb(c,i,()=>this._ongoingJobsQueue.pop()??null),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Yb(l,i,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(er(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,i,r){let s;Array.isArray(r)?(le.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=N_();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>bA(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const OTe=le.getLogger("esri.intl.substitute");function Ug(t,e,i={}){const{format:r={}}=i;return wm(t,s=>PJe(s,e,r))}function PJe(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=kL(r,e);if(o==null)return"";const a=(s?i==null?void 0:i[s]:null)??(i==null?void 0:i[r]);return a?IJe(o,a):s?$Je(o,s):Lte(o)}function IJe(t,e){switch(e.type){case"date":return Ty(t,e.intlOptions);case"number":return _d(t,e.intlOptions);default:return OTe.warn("missing format descriptor for key {key}"),Lte(t)}}function $Je(t,e){switch(e.toLowerCase()){case"dateformat":return Ty(t);case"numberformat":return _d(t);default:return OTe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?Ty(t):/^numberformat/i.test(e)?_d(t):Lte(t)}}function Lte(t){switch(typeof t){case"string":return t;case"number":return _d(t);case"boolean":return""+t;default:return t instanceof Date?Ty(t):""}}async function LJe(t,e,i,r){const s=e.exec(i);if(!s)throw new J("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=LWe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Yle(t(c))}catch(d){if(c===l)throw new J("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{h=await Yle(t(l))}catch(f){throw new J("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Yle(t){if(b(Xle.fetchBundleAsset))return Xle.fetchBundleAsset(t);const e=await tr(t,{responseType:"text"});return JSON.parse(e.data)}let DJe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return LJe(this.getAssetUrl,this.matcher,e,i)}};function NJe(t){return new DJe(t)}const Xle={};$We(NJe({pattern:"esri/",location:Cr}));const FJe={};function UJe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=FJe.baseUrl),e}let kJe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},t6=class{constructor(){this._dispatcher=new kJe,this._workerPostMessage({type:el.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){wA(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){wA(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=I$(e);if(i&&i.type===el.OPEN){const{modulePath:r,jobId:s}=i;let n=await Yb.loadWorker(r);n||(n=await se(()=>import(r),[]));const o=Yb.connect(n);this._workerPostMessage({type:el.OPENED,jobId:s,data:o})}}};const mY=le.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:VJe}=el,zJe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let wN,xN;const Zle="Failed to create Worker. Fallback to execute module in main thread";async function BJe(){if(!me("esri-workers")||(me("mozilla"),0))return Jle(new t6);if(!wN&&!xN)try{const e=zJe.split('"{CONFIGURATION}"').join(`'${GJe()}'`);wN=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){xN=e||{}}let t;if(wN)try{t=new Worker(wN,{name:"esri-worker-"+jJe++})}catch{mY.warn(Zle,xN),t=new t6}else mY.warn(Zle,xN),t=new t6;return Jle(t)}async function Jle(t){return new Promise(e=>{function i(s){const n=I$(s);n&&n.type===VJe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),mY.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new t6).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function GJe(){let t;if(Mr.default!=null){const s={...Mr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Mr));t.assetsPath=nd(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?nd(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Rp(),t.has={"esri-csp-restrictions":me("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":me("esri-2d-update-debug"),"featurelayer-pbf":me("featurelayer-pbf"),"featurelayer-simplify-thresholds":me("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":me("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":me("featurelayer-simplify-mobile-factor"),"esri-atomics":me("esri-atomics"),"esri-shared-array-buffer":me("esri-shared-array-buffer"),"esri-tiles-debug":me("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":me("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":me("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":me("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=nd(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=nd(t.workers.workerPath):t.workers.workerPath=nd(Cr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Mr.workers.loaderConfig,i=UJe({baseUrl:e==null?void 0:e.baseUrl,locale:Rp(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{version:dwe,buildDate:uwe,revision:hwe}})}let jJe=0;const{ABORT:Kle,INVOKE:HJe,OPEN:qJe,OPENED:WJe,RESPONSE:MO}=el;let YJe=class RTe{static async create(e){const i=await BJe();return new RTe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),le.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=ATe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:Ak(r,()=>{this._outJobs.delete(s),this._post({type:Kle,jobId:s})})};this._outJobs.set(s,a),this._post({type:qJe,jobId:s,modulePath:e})})}_onMessage(e){const i=I$(e);if(i)switch(i.type){case WJe:this._onOpenedMessage(i);break;case MO:this._onResponseMessage(i);break;case Kle:this._onAbortMessage(i);break;case HJe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=Nqe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:MO,jobId:r,error:P$(h)})}gh(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:MO,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),kn(h)||this._post({type:MO,jobId:r,error:P$(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:MO,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),is(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),is(n.abortHandle),r?n.reject(J.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return $te(this.worker,e,i,r)}},e2=me("esri-workers-debug")?1:me("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):me("host-browser")?navigator.hardwareConcurrency-1:0;e2||(e2=me("safari")&&me("mac")?7:2);let Qle=0;const i6=[];function PTe(){ITe()}async function TN(t,e){const i=new RJe;return await i.open(t,e),i}async function Dte(t,e={}){if(typeof t!="string")throw new J("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(me("host-webworker")&&!me("esri-workers")&&(i="local"),i==="local"){let r=await Yb.loadWorker(t);r||(r=await se(()=>import(t),[])),_i(e.signal);const s=e.client||r;return TN([Yb.connect(r)],{...e,client:s})}if(await ITe(),_i(e.signal),i==="dedicated"){const r=Qle++%e2;return TN([await i6[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,e2);if(r<e2){const s=new Array(r);for(let n=0;n<r;++n){const o=Qle++%e2;s[n]=i6[o].open(t,e)}return TN(s,e)}}return TN(i6.map(r=>r.open(t,e)),e)}let SN=null;async function ITe(){if(SN)return SN;new AbortController;const t=[];for(let e=0;e<e2;e++){const i=YJe.create(e).then(r=>(i6[e]=r,r));t.push(i)}return SN=Promise.all(t),SN}function Bo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Fy(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,y,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=g,t[14]=y,t[15]=v,t}function zp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hh(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function C3(t,e){return Va(t,e)||zp(t),t}function Va(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],x=e[15],S=i*a-r*o,E=i*l-s*o,C=i*c-n*o,R=r*l-s*a,O=r*c-n*a,U=s*c-n*l,L=h*y-d*g,B=h*v-f*g,G=h*x-m*g,j=d*v-f*y,q=d*x-m*y,ie=f*x-m*v;let ee=S*ie-E*q+C*j+R*G-O*B+U*L;return ee?(ee=1/ee,t[0]=(a*ie-l*q+c*j)*ee,t[1]=(s*q-r*ie-n*j)*ee,t[2]=(y*U-v*O+x*R)*ee,t[3]=(f*O-d*U-m*R)*ee,t[4]=(l*G-o*ie-c*B)*ee,t[5]=(i*ie-s*G+n*B)*ee,t[6]=(v*C-g*U-x*E)*ee,t[7]=(h*U-f*C+m*E)*ee,t[8]=(o*q-a*G+c*L)*ee,t[9]=(r*G-i*q-n*L)*ee,t[10]=(g*O-y*C+x*S)*ee,t[11]=(d*C-h*O-m*S)*ee,t[12]=(a*B-o*j-l*L)*ee,t[13]=(i*j-r*B+s*L)*ee,t[14]=(y*E-g*R-v*S)*ee,t[15]=(h*R-d*E+f*S)*ee,t):null}function XJe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],x=e[15];return t[0]=a*(f*x-m*v)-d*(l*x-c*v)+y*(l*m-c*f),t[1]=-(r*(f*x-m*v)-d*(s*x-n*v)+y*(s*m-n*f)),t[2]=r*(l*x-c*v)-a*(s*x-n*v)+y*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*x-m*v)-h*(l*x-c*v)+g*(l*m-c*f)),t[5]=i*(f*x-m*v)-h*(s*x-n*v)+g*(s*m-n*f),t[6]=-(i*(l*x-c*v)-o*(s*x-n*v)+g*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(d*x-m*y)-h*(a*x-c*y)+g*(a*m-c*d),t[9]=-(i*(d*x-m*y)-h*(r*x-n*y)+g*(r*m-n*d)),t[10]=i*(a*x-c*y)-o*(r*x-n*y)+g*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+h*(r*c-n*a)),t[12]=-(o*(d*v-f*y)-h*(a*v-l*y)+g*(a*f-l*d)),t[13]=i*(d*v-f*y)-h*(r*v-s*y)+g*(r*f-s*d),t[14]=-(i*(a*v-l*y)-o*(r*v-s*y)+g*(r*l-s*a)),t[15]=i*(a*f-l*d)-o*(r*f-s*d)+h*(r*l-s*a),t}function ZJe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15];return(e*o-i*n)*(d*v-f*y)-(e*a-r*n)*(h*v-f*g)+(e*l-s*n)*(h*y-d*g)+(i*a-r*o)*(c*v-f*m)-(i*l-s*o)*(c*y-d*m)+(r*l-s*a)*(c*g-h*m)}function ln(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],g=e[11],y=e[12],v=e[13],x=e[14],S=e[15];let E=i[0],C=i[1],R=i[2],O=i[3];return t[0]=E*r+C*a+R*d+O*y,t[1]=E*s+C*l+R*f+O*v,t[2]=E*n+C*c+R*m+O*x,t[3]=E*o+C*h+R*g+O*S,E=i[4],C=i[5],R=i[6],O=i[7],t[4]=E*r+C*a+R*d+O*y,t[5]=E*s+C*l+R*f+O*v,t[6]=E*n+C*c+R*m+O*x,t[7]=E*o+C*h+R*g+O*S,E=i[8],C=i[9],R=i[10],O=i[11],t[8]=E*r+C*a+R*d+O*y,t[9]=E*s+C*l+R*f+O*v,t[10]=E*n+C*c+R*m+O*x,t[11]=E*o+C*h+R*g+O*S,E=i[12],C=i[13],R=i[14],O=i[15],t[12]=E*r+C*a+R*d+O*y,t[13]=E*s+C*l+R*f+O*v,t[14]=E*n+C*c+R*m+O*x,t[15]=E*o+C*h+R*g+O*S,t}function fu(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],g=e[8],y=e[9],v=e[10],x=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=g,t[9]=y,t[10]=v,t[11]=x,t[12]=o*r+h*s+g*n+e[12],t[13]=a*r+d*s+y*n+e[13],t[14]=l*r+f*s+v*n+e[14],t[15]=c*r+m*s+x*n+e[15]}return t}function aV(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ih(t,e,i,r){let s,n,o,a,l,c,h,d,f,m,g,y,v,x,S,E,C,R,O,U,L,B,G,j,q=r[0],ie=r[1],ee=r[2],K=Math.sqrt(q*q+ie*ie+ee*ee);return K<ul()?null:(K=1/K,q*=K,ie*=K,ee*=K,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],d=e[4],f=e[5],m=e[6],g=e[7],y=e[8],v=e[9],x=e[10],S=e[11],E=q*q*o+n,C=ie*q*o+ee*s,R=ee*q*o-ie*s,O=q*ie*o-ee*s,U=ie*ie*o+n,L=ee*ie*o+q*s,B=q*ee*o+ie*s,G=ie*ee*o-q*s,j=ee*ee*o+n,t[0]=a*E+d*C+y*R,t[1]=l*E+f*C+v*R,t[2]=c*E+m*C+x*R,t[3]=h*E+g*C+S*R,t[4]=a*O+d*U+y*L,t[5]=l*O+f*U+v*L,t[6]=c*O+m*U+x*L,t[7]=h*O+g*U+S*L,t[8]=a*B+d*G+y*j,t[9]=l*B+f*G+v*j,t[10]=c*B+m*G+x*j,t[11]=h*B+g*G+S*j,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function NA(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+h*r,t[6]=a*s+d*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=h*s-o*r,t[10]=d*s-a*r,t[11]=f*s-l*r,t}function lV(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-h*r,t[2]=a*s-d*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+h*s,t[10]=a*r+d*s,t[11]=l*r+f*s,t}function FA(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+h*r,t[2]=a*s+d*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=h*s-o*r,t[6]=d*s-a*r,t[7]=f*s-l*r,t}function cV(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function JJe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vd(t,e,i){if(e===0)return zp(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<ul()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function $Te(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function KJe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function LTe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function DTe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,h=r*a,d=r*l,f=r*c,m=s*l,g=s*c,y=n*c,v=o*a,x=o*l,S=o*c;return t[0]=1-(m+y),t[1]=d+S,t[2]=f-x,t[3]=0,t[4]=d-S,t[5]=1-(h+y),t[6]=g+v,t[7]=0,t[8]=f+x,t[9]=g-v,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function QJe(t,e){const i=eKe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+h*r+l*n-c*s)/d,i[1]=2*(l*o+h*s+c*r-a*n)/d,i[2]=2*(c*o+h*n+a*s-l*r)/d):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),DTe(t,e,i),t}const eKe=$();function tKe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function NTe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function iKe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function rKe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,d=s*l,f=s*c,m=s*h,g=n*c,y=n*h,v=o*h,x=a*l,S=a*c,E=a*h,C=r[0],R=r[1],O=r[2];return t[0]=(1-(g+v))*C,t[1]=(f+E)*C,t[2]=(m-S)*C,t[3]=0,t[4]=(f-E)*R,t[5]=(1-(d+v))*R,t[6]=(y+x)*R,t[7]=0,t[8]=(m+S)*O,t[9]=(y-x)*O,t[10]=(1-(d+g))*O,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function sKe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,d=a+a,f=n*c,m=n*h,g=n*d,y=o*h,v=o*d,x=a*d,S=l*c,E=l*h,C=l*d,R=r[0],O=r[1],U=r[2],L=s[0],B=s[1],G=s[2],j=(1-(y+x))*R,q=(m+C)*R,ie=(g-E)*R,ee=(m-C)*O,K=(1-(f+x))*O,Y=(v+S)*O,D=(g+E)*U,V=(v-S)*U,k=(1-(f+y))*U;return t[0]=j,t[1]=q,t[2]=ie,t[3]=0,t[4]=ee,t[5]=K,t[6]=Y,t[7]=0,t[8]=D,t[9]=V,t[10]=k,t[11]=0,t[12]=i[0]+L-(j*L+ee*B+D*G),t[13]=i[1]+B-(q*L+K*B+V*G),t[14]=i[2]+G-(ie*L+Y*B+k*G),t[15]=1,t}function nKe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,x=n*l;return t[0]=1-d-g,t[1]=h+x,t[2]=f-v,t[3]=0,t[4]=h-x,t[5]=1-c-g,t[6]=m+y,t[7]=0,t[8]=f+v,t[9]=m-y,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function FTe(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function oKe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function aKe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function UTe(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function uV(t,e,i,r){let s,n,o,a,l,c,h,d,f,m;const g=e[0],y=e[1],v=e[2],x=r[0],S=r[1],E=r[2],C=i[0],R=i[1],O=i[2],U=ul();return Math.abs(g-C)<U&&Math.abs(y-R)<U&&Math.abs(v-O)<U?zp(t):(h=g-C,d=y-R,f=v-O,m=1/Math.sqrt(h*h+d*d+f*f),h*=m,d*=m,f*=m,s=S*f-E*d,n=E*h-x*f,o=x*d-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=d*o-f*n,l=f*s-h*o,c=h*n-d*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),t[0]=s,t[1]=a,t[2]=h,t[3]=0,t[4]=n,t[5]=l,t[6]=d,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(s*g+n*y+o*v),t[13]=-(a*g+l*y+c*v),t[14]=-(h*g+d*y+f*v),t[15]=1,t)}function kTe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],d=n-i[1],f=o-i[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let g=l*f-c*d,y=c*h-a*f,v=a*d-l*h;return m=g*g+y*y+v*v,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,v*=m),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=d*v-f*y,t[5]=f*g-h*v,t[6]=h*y-d*g,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function lKe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function cKe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function uKe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function VTe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function hKe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function dKe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function zTe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Nte(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],g=t[12],y=t[13],v=t[14],x=t[15],S=e[0],E=e[1],C=e[2],R=e[3],O=e[4],U=e[5],L=e[6],B=e[7],G=e[8],j=e[9],q=e[10],ie=e[11],ee=e[12],K=e[13],Y=e[14],D=e[15],V=ul();return Math.abs(i-S)<=V*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-E)<=V*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-C)<=V*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(n-R)<=V*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(o-O)<=V*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(a-U)<=V*Math.max(1,Math.abs(a),Math.abs(U))&&Math.abs(l-L)<=V*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-B)<=V*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(h-G)<=V*Math.max(1,Math.abs(h),Math.abs(G))&&Math.abs(d-j)<=V*Math.max(1,Math.abs(d),Math.abs(j))&&Math.abs(f-q)<=V*Math.max(1,Math.abs(f),Math.abs(q))&&Math.abs(m-ie)<=V*Math.max(1,Math.abs(m),Math.abs(ie))&&Math.abs(g-ee)<=V*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(y-K)<=V*Math.max(1,Math.abs(y),Math.abs(K))&&Math.abs(v-Y)<=V*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(x-D)<=V*Math.max(1,Math.abs(x),Math.abs(D))}function Fte(t){const e=ul(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function hV(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const pKe=ln,fKe=VTe;Object.freeze(Object.defineProperty({__proto__:null,add:uKe,adjoint:XJe,copy:Bo,determinant:ZJe,equals:Nte,exactEquals:zTe,frob:cKe,fromQuat:nKe,fromQuat2:QJe,fromRotation:vd,fromRotationTranslation:DTe,fromRotationTranslationScale:rKe,fromRotationTranslationScaleOrigin:sKe,fromScaling:JJe,fromTranslation:cV,fromXRotation:$Te,fromYRotation:KJe,fromZRotation:LTe,frustum:FTe,getRotation:iKe,getScaling:NTe,getTranslation:tKe,hasIdentityRotation:hV,identity:zp,invert:Va,invertOrIdentity:C3,isOrthoNormal:Fte,lookAt:uV,mul:pKe,multiply:ln,multiplyScalar:hKe,multiplyScalarAndAdd:dKe,ortho:UTe,perspective:oKe,perspectiveFromFieldOfView:aKe,rotate:ih,rotateX:NA,rotateY:lV,rotateZ:FA,scale:aV,set:Fy,str:lKe,sub:fKe,subtract:VTe,targetTo:kTe,translate:fu,transpose:hh},Symbol.toStringTag,{value:"Module"}));let QB,he=null;function BTe(){return!!he}function mKe(){return!!me("esri-wasm")}function GTe(){return QB||(QB=se(()=>import("./pe-wasm-67793c2f.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Cr(`esri/geometry/support/${e}`)})).then(t=>{HTe(t)}),QB)}var gY,Pn,yY;(function(t){function e(n,o,a){he.ensureCache.prepare();const l=PT(a),c=a===l,h=he.ensureFloat64(l),d=he._pe_geog_to_proj(he.getPointer(n),o,h);return d&&eb(a,o,h,c),d}function i(n,o,a,l){switch(l){case Pn.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Pn.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){he.ensureCache.prepare();const c=PT(a),h=a===c,d=he.ensureFloat64(c),f=he._pe_proj_to_geog_center(he.getPointer(n),o,d,l);return f&&eb(a,o,d,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(gY||(gY={})),function(t){function e(){t.PE_BUFFER_MAX=he.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=he.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=he.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=he.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=he.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=he.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=he.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=he.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=he.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=he.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=he.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=he.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=he.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=he.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=he.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=he.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=he.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=he.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=he.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=he.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=he.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=he.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=he.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=he.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=he.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=he.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=he.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=he.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=he.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=he.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Pn||(Pn={})),function(t){const e={},i={},r=m=>{if(m){const g=m.getType();switch(g){case Pn.PE_TYPE_GEOGCS:m=he.castObject(m,he.PeGeogcs);break;case Pn.PE_TYPE_PROJCS:m=he.castObject(m,he.PeProjcs);break;case Pn.PE_TYPE_GEOGTRAN:m=he.castObject(m,he.PeGeogtran);break;default:g&Pn.PE_TYPE_UNIT&&(m=he.castObject(m,he.PeUnit))}}return m};function s(){he.PeFactory.prototype.initialize(null)}function n(m){return o(Pn.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(g)))y=v[g];else{const x=he.PeFactory.prototype.factoryByType(m,g);he.compare(x,he.NULL)||(y=x,v[g]=y)}return y=r(y),y}function a(m,g){let y=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(g))y=v[g];else{const x=he.PeFactory.prototype.fromString(m,g);he.compare(x,he.NULL)||(y=x,v[g]=y)}return y=r(y),y}function l(m){return o(Pn.PE_TYPE_GEOGCS,m)}function c(m){return o(Pn.PE_TYPE_GEOGTRAN,m)}function h(m){return he.PeFactory.prototype.getCode(m)}function d(m){return o(Pn.PE_TYPE_PROJCS,m)}function f(m){return o(Pn.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f}(yY||(yY={}));let jTe=null;var xU,_Y,vY,bY,TU,wY,SU,EU,xY;function HTe(t){function e(n,o,a){n[o]=a(n[o])}he=t,Pn.init(),xU.init(),TU.init(),SU.init(),EU.init(),jTe=class extends he.PeGCSExtent{destroy(){he.destroy(this)}};const i=[he.PeDatum,he.PeGeogcs,he.PeGeogtran,he.PeObject,he.PeParameter,he.PePrimem,he.PeProjcs,he.PeSpheroid,he.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Pn.PE_NAME_MAX))});for(const n of[he.PeGeogtran,he.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Pn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=he.getValue(l,"*");a[c]=h?he.wrapPointer(h,he.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(he.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return eb(a,o,n.call(this)),a}),e(he.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=he._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=he.getPointer(l);for(let d=1;d<c;d++)a.push(he.wrapPointer(h+o*d,he.PeGTlistExtendedGTs))}}return a}});const r=he._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=l.getNump();if(c>1){const h=he.getPointer(l);for(let d=1;d<c;d++)a.push(he.wrapPointer(h+r*d,he.PeHorizon))}}return o.set(n,a),a};e(he.PeProjcs.prototype,"horizonGcsGenerate",s),e(he.PeProjcs.prototype,"horizonPcsGenerate",s),he.PeObject.prototype.toString=function(n=Pn.PE_STR_OPTS_NONE){he.ensureCache.prepare();const o=he.getPointer(this),a=he.ensureInt8(new Array(Pn.PE_BUFFER_MAX));return he.UTF8ToString(he._pe_object_to_string_ext(o,n,a))}}function Zy(t){if(!t)return;const e=he.getClass(t);if(!e)return;const i=he.getCache(e);if(!i)return;const r=he.getPointer(t);r&&delete i[r]}function EN(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(he.ensureInt8(r));return i}function PT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function eb(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=he.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=he.getValue(i,"double"),t[n][1]=he.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=he.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=he._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const d=new he.PeInteger(c);try{const f=he.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=he.getPointer(f);for(let g=1;g<c;g++)h.push(he.wrapPointer(m+e*g,he.PeGTlistExtendedEntry))}}finally{he.destroy(d)}return h}t.init=i,t.getGTlist=r})(xU||(xU={})),function(t){function e(i){if(i&&i.length){for(const r of i)Zy(r),r.getEntries().forEach(s=>{Zy(s);const n=s.getGeogtran();Zy(n),n.getParameters().forEach(Zy),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Zy(o);const a=o.getDatum();Zy(a),Zy(a.getSpheroid()),Zy(o.getPrimem()),Zy(o.getUnit())})});he.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(_Y||(_Y={})),function(t){function e(i,r,s,n,o){he.ensureCache.prepare();const a=PT(s),l=s===a,c=he.ensureFloat64(a);let h=0;n&&(h=he.ensureFloat64(n));const d=he._pe_geog_to_geog(he.getPointer(i),r,c,h,o);return d&&eb(s,r,c,l),d}t.geogToGeog=e}(vY||(vY={})),function(t){const e=(c,h,d,f,m,g)=>{let y,v;switch(he.ensureCache.prepare(),c){case"dd":y=he._pe_geog_to_dd,v=Pn.PE_DD_MAX;break;case"ddm":y=he._pe_geog_to_ddm,v=Pn.PE_DDM_MAX;break;case"dms":y=he._pe_geog_to_dms,v=Pn.PE_DMS_MAX}let x=0;h&&(x=he.getPointer(h));const S=PT(f),E=he.ensureFloat64(S),C=EN(d,v),R=y(x,d,E,m,he.ensureInt32(C));if(R)for(let O=0;O<d;O++)g[O]=he.UTF8ToString(C[O]);return R},i=(c,h,d,f,m)=>{let g;switch(he.ensureCache.prepare(),c){case"dd":g=he._pe_dd_to_geog;break;case"ddm":g=he._pe_ddm_to_geog;break;case"dms":g=he._pe_dms_to_geog}let y=0;h&&(y=he.getPointer(h));const v=f.map(C=>he.ensureString(C)),x=he.ensureInt32(v),S=he.ensureFloat64(new Array(2*d)),E=g(y,d,x,S);return E&&eb(m,d,S),E};function r(c,h,d,f,m){return e("dms",c,h,d,f,m)}function s(c,h,d,f){return i("dms",c,h,d,f)}function n(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return i("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return i("dd",c,h,d,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(bY||(bY={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=he.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=he.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){he.ensureCache.prepare();let d=0;s&&(d=he.getPointer(s));const f=PT(o),m=he.ensureFloat64(f),g=EN(n,Pn.PE_MGRS_MAX),y=he.ensureInt32(g),v=he._pe_geog_to_mgrs_extended(d,n,m,a,l,c,y);if(v)for(let x=0;x<n;x++)h[x]=he.UTF8ToString(g[x]);return v}function r(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const h=o.map(g=>he.ensureString(g)),d=he.ensureInt32(h),f=he.ensureFloat64(new Array(2*n)),m=he._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&eb(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(TU||(TU={})),function(t){function e(r,s,n,o,a,l,c){he.ensureCache.prepare();let h=0;r&&(h=he.getPointer(r));const d=PT(n),f=he.ensureFloat64(d),m=EN(s,Pn.PE_MGRS_MAX),g=he.ensureInt32(m),y=he._pe_geog_to_usng(h,s,f,o,a,l,g);if(y)for(let v=0;v<s;v++)c[v]=he.UTF8ToString(m[v]);return y}function i(r,s,n,o){he.ensureCache.prepare();let a=0;r&&(a=he.getPointer(r));const l=n.map(f=>he.ensureString(f)),c=he.ensureInt32(l),h=he.ensureFloat64(new Array(2*s)),d=he._pe_usng_to_geog(a,s,c,h);return d&&eb(o,s,h),d}t.geogToUsng=e,t.usngToGeog=i}(wY||(wY={})),function(t){function e(){t.PE_UTM_OPTS_NONE=he.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=he.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=he.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const h=PT(o),d=he.ensureFloat64(h),f=EN(n,Pn.PE_UTM_MAX),m=he.ensureInt32(f),g=he._pe_geog_to_utm(c,n,d,a,m);if(g)for(let y=0;y<n;y++)l[y]=he.UTF8ToString(f[y]);return g}function r(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const h=o.map(g=>he.ensureString(g)),d=he.ensureInt32(h),f=he.ensureFloat64(new Array(2*n)),m=he._pe_utm_to_geog(c,n,d,a,f);return m&&eb(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(SU||(SU={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=he.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=he.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=he.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(EU||(EU={})),function(t){function e(){return he.PeVersion.prototype.version_string()}t.versionString=e}(xY||(xY={}));const gKe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return gY},get PeDefs(){return Pn},get PeFactory(){return yY},get PeGCSExtent(){return jTe},get PeGTTransformations(){return vY},get PeGTlistExtended(){return xU},get PeGTlistExtendedEntry(){return _Y},get PeNotationDms(){return bY},get PeNotationMgrs(){return TU},get PeNotationUsng(){return wY},get PeNotationUtm(){return SU},get PePCSInfo(){return EU},get PeVersion(){return xY},_init:HTe,get _pe(){return he},isLoaded:BTe,isSupported:mKe,load:GTe},Symbol.toStringTag,{value:"Module"})),qu=Math.PI/180,yKe=/SPHEROID\[([^\]]+)]/i,Sv=zi.radius,of=zi.eccentricitySquared,_Ke={a1:Sv*of,a2:Sv*of*Sv*of,a3:Sv*of*of/2,a4:Sv*of*Sv*of*2.5,a5:Sv*of+Sv*of*of/2,a6:1-of},vKe={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:zi.radius,f:zi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:k_.radius,f:k_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:cy.radius,f:cy.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:cy.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let CN=0,e7=class TY{static fromGE(e){const i=new TY;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=CN++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=CN++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=CN++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=CN++}getInverse(){const e=new TY;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},SY=class aP{static cacheKey(e,i){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(e){const i=new aP;let r="";for(const s of e.steps){const n=e7.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const i of e.steps)i instanceof e7?this.steps.push(i):this.steps.push(new e7({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new aP;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[aP.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[aP.cacheKey(e,i)];return s===void 0?null:s}};function Ute(t,e,i){if(A(e)||A(i)||i.vcsWkid||us(e,i))return null;const r=L2(e)/L2(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>bKe(s,r);case"polyline":case"esriGeometryPolyline":return s=>xKe(s,r);case"polygon":case"esriGeometryPolygon":return s=>wKe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>TKe(s,r);case"extent":case"esriGeometryExtent":return s=>SKe(s,r);default:return null}}function bKe(t,e){t&&t.z!=null&&(t.z*=e)}function wKe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function xKe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function TKe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function SKe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Ab=null,$$=null,t7=null,i7={};const qTe=new vee;function Xb(){return!!Ab&&BTe()}function Zb(t){return A(t7)&&(t7=Promise.all([GTe(),se(()=>import("./geometryEngineBase-e1a33b0a.js"),[]).then(e=>e.g),se(()=>import("./hydrated-0210143f.js"),[])])),t7.then(([,e,{hydratedAdapter:i}])=>{_i(t),$$=i,Ab=e.default,Ab._enableProjection(gKe),qTe.notify()})}function bd(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:CU($$,t,t[0].spatialReference,e,i,r):CU($$,[t],t.spatialReference,e,i,r)[0]}function CU(t,e,i,r,s=null,n=null){if(A(i)||A(r))return e;if(Bp(i,r,s))return e.map(o=>WTe(o,i,r));if(A(s)){const o=SY.cacheKey(i,r);i7[o]!==void 0?s=i7[o]:(s=CKe(i,r,void 0),A(s)&&(s=new SY),i7[o]=s)}if(A(Ab)||A(t))throw new kte;return b(n)?Ab._project(t,e,i,r,s,n):Ab._project(t,e,i,r,s)}function WGt(t,e){const i=EKe([t],e);return b(i.pending)?{pending:i.pending,geometry:null}:b(i.geometries)?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function EKe(t,e){if(!Xb()){for(const i of t)if(b(i)&&!us(i.spatialReference,e)&&Vo(i.spatialReference)&&Vo(e)&&!Bp(i.spatialReference,e))return Vi(qTe),{pending:Zb(),geometries:null}}return{pending:null,geometries:t.map(i=>A(i)?null:us(i.spatialReference,e)?i:Vo(i.spatialReference)&&Vo(e)?MKe(i,e):null)}}function CKe(t,e,i=null){if(A(t)||A(e))return null;if(A(Ab)||A($$))throw new kte;const r=Ab._getTransformation($$,t,e,i,i==null?void 0:i.spatialReference);return r!==null?SY.fromGE(r):null}class kte extends J{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var oe;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(oe||(oe={}));function MKe(t,e){try{const i=bd(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=Ute(i.type,t.spatialReference,e);return b(r)&&r(i),i}catch(i){if(!(i instanceof kte))throw i;return null}}function Bp(t,e,i){return!i&&(!!us(t,e)||Vo(t)&&Vo(e)&&!!jte(t,e,qte))}async function Vte(t,e,i,r){if(Xb())return Gae(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!Bp(s,n,o))return Zb(r)}else if(!Bp(t,e,i))return Zb(r);return Gae(r)}function YGt(t,e){switch(jte(t,e,qte)){case ms:return"copy3";case gb:return"wgs84ToSphericalECEF";case G2:return"wgs84ToWebMercator";case mb:return"wgs84ToPlateCarree";case _b:return"wgs84ToWGS84ECEF";case f2:return"webMercatorToWGS84";case QTe:return"webMercatorToSphericalECEF";case e2e:return"webMercatorToWGS84ECEF";case t2e:return"webMercatorToPlateCarree";case vb:return"wgs84ECEFToWGS84";case s2e:return"wgs84ECEFToSphericalECEF";case n2e:return"wgs84ECEFToWebMercator";case yb:return"sphericalECEFToWGS84";case i2e:return"sphericalECEFToWebMercator";case AY:return"sphericalMarsPCPFToMars2000";case MY:return"sphericalMoonPCPFToMoon2000";case r2e:return"sphericalECEFToWGS84ECEF";case CY:return"mars2000ToSphericalPCPF";case EY:return"moon2000ToSphericalPCPF";default:return null}}function WTe(t,e,i){return t?"x"in t?YTe(t,e,new st,i,0):"xmin"in t?PKe(t,e,new ti,i,0):"rings"in t?XTe(t,e,new kl,i,0):"paths"in t?RKe(t,e,new cd,i,0):"points"in t?OKe(t,e,new YL,i,0):null:null}function AKe(t,e,i=e.spatialReference,r=0){return b(i)&&b(t.spatialReference)&&b(YTe(t,t.spatialReference,e,i,r))}function YTe(t,e,i,r,s){xr[0]=t.x,xr[1]=t.y;const n=t.z;return xr[2]=n!==void 0?n:s,un(xr,e,0,xr,r,0,1)?(i.x=xr[0],i.y=xr[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=xr[2],i.hasZ=!0),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function OKe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const d of n)h.push(d[0],d[1],o?d[2]:s);if(!un(h,e,0,h,r,0,c))return null;for(let d=0;d<c;++d){const f=3*d,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],n[d][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,n[d][2]]):l.push([m,g])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function RKe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return JTe(n,o??!1,a??!1,e,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function XGt({hasZ:t,spatialReference:e,paths:i},r,s=0){const n=My(e,M3),o=Ep[n][oe.WGS84_COMPARABLE_LON_LAT];if(A(o))return!1;const a=t?l=>l:l=>fe(xr,l[0],l[1],s);for(const l of i){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}r.push(c)}return!0}function ZGt({hasZ:t,spatialReference:e,rings:i},r,s=0){const n=My(e,M3),o=Ep[n][oe.WGS84_COMPARABLE_LON_LAT];if(A(o))return!1;const a=t?l=>l:l=>fe(xr,l[0],l[1],s);for(const l of i){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}r.push(c)}return!0}function JGt(t,e,i=e.spatialReference,r=0){return b(t.spatialReference)&&b(i)&&b(XTe(t,t.spatialReference,e,i,r))}function XTe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return JTe(n,o??!1,a??!1,e,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function PKe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return ece(n,o,c?t.zmin:s,e,xr,r)?(i.xmin=xr[0],i.ymin=xr[1],c&&(i.zmin=xr[2]),ece(a,l,c?t.zmax:s,e,xr,r)?(i.xmax=xr[0],i.ymax=xr[1],c&&(i.zmax=xr[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null):null}function Jb(t,e,i){if(A(e)||A(i))return null;const r=new st({spatialReference:i});return un(t,e,0,xr,i,0,1)?(r.x=xr[0],r.y=xr[1],r.z=xr[2],r):null}function ZTe(t,e,i){return un(t,e,0,xr,i.spatialReference,0,1)?(i.x=xr[0],i.y=xr[1],i.z=xr[2],i):null}function ll(t,e,i,r=0){xr[0]=t.x,xr[1]=t.y;const s=t.z;return xr[2]=s!==void 0?s:r,un(xr,t.spatialReference,0,e,i,0,1)}function ece(t,e,i,r,s,n){return on[0]=t,on[1]=e,on[2]=i,un(on,r,0,s,n,0,1)}function _a(t,e,i,r){return!(A(e)||A(r)||t.length<2)&&(t.length===2&&(on[0]=t[0],on[1]=t[1],on[2]=0,t=on),un(t,e,0,i,r,0,1))}function IKe(t,e){xr[0]=t.x,xr[1]=t.y;const i=t.z;return xr[2]=i!==void 0?i:0,$Ke(xr,t.spatialReference,e)}function $Ke(t,e,i){return LKe(t,e,i)}function LKe(t,e,i){if(A(e))return!1;const r=My(e,M3),s=Ep[r][oe.WGS84_COMPARABLE_LON_LAT];return!A(s)&&(s(t,0,on,0),i!==on&&(i[0]=on[0],i[1]=on[1],i.length>2&&(i[2]=on[2])),!0)}function un(t,e,i,r,s,n,o=1){const a=jte(e,s,qte);if(A(a))return!1;if(a===ms){if(t===r&&i===n)return!0;const c=i+3*o;for(let h=i,d=n;h<c;h++,d++)r[d]=t[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(t,c,r,h);return!0}function KGt(t,e,i,r,s){ge(xr,t),we(MN,t,e),_a(xr,i,xr,s),_a(MN,i,MN,s),be(r,MN,xr),Re(r,r)}function JTe(t,e,i,r,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!un(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const d of c)e&&i?h.push([a[l++],a[l++],a[l++],d[3]]):e?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],d[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function QGt(t,e,i,r){if(A(e)||A(r))return!1;const s=o2e(e,r,GKe);if(s.projector===ms)return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],!0;if(A(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===oe.WEB_MERCATOR){const a=Ep[n.spatialReferenceId][oe.WGS84];return!A(a)&&(a(t,0,Hf,0),G2(Hf,0,i,0),i[3]=tce(Hf[1],t[2],t[3],zi.radius),!0)}if(n.spatialReferenceId!==oe.WGS84&&n.spatialReferenceId!==oe.CGCS2000||o.spatialReferenceId!==oe.PLATE_CARREE){s.projector(t,0,i,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;i[3]=t[3]*a/l}else{const a=Ep[n.spatialReferenceId][oe.SPHERICAL_ECEF],l=Ep[oe.SPHERICAL_ECEF][oe.PLATE_CARREE];let c=t[3];b(a)&&b(l)&&(c=tce(t[1],t[2],t[3],zi.radius)),s.projector(t,0,i,0),i[3]=c}return!0}function tce(t,e,i,r){const s=r+e;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(nm*t)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function dV(t,e,i,r){return t!=null&&(us(e,r)?(z_(i,t),!0):(on[0]=t[0],on[1]=t[1],on[2]=0,!!un(on,e,0,on,r,0,1)&&(i[0]=on[0],i[1]=on[1],on[0]=t[2],on[1]=t[3],on[2]=0,!!un(on,e,0,on,r,0,1)&&(i[2]=on[0],i[3]=on[1],!0))))}function ejt(t,e,i,r){if(A(e)||A(r))return!1;const s=My(e,M3),n=My(r,a2e);if(s===n&&s!==oe.UNKNOWN||us(e,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===oe.SPHERICAL_ECEF){const o=ze(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/zi.radius;if(n===oe.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===oe.WGS84||n===oe.CGCS2000){const c=MI;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===oe.PLATE_CARREE){if(n===oe.WGS84||n===oe.CGCS2000)return i[0]=MI,i[1]=MI,i[2]=1,!0;if(n===oe.WEB_MERCATOR){const o=t[1]/zi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function Rm(t,e,i,r){if(A(t)||A(r))return!1;const s=My(t,M3),n=My(r,a2e);if(s===n&&!ice(n)&&(s!==oe.UNKNOWN||us(t,r)))return cV(i,e),!0;if(ice(n)){const o=Ep[s][oe.LON_LAT],a=Ep[oe.LON_LAT][n];return!A(o)&&!A(a)&&(o(e,0,Hf,0),a(Hf,0,Ev,0),KTe(nm*Hf[0],nm*Hf[1],i),i[12]=Ev[0],i[13]=Ev[1],i[14]=Ev[2],!0)}if((n===oe.WEB_MERCATOR||n===oe.PLATE_CARREE)&&(s===oe.WGS84||s===oe.CGCS2000&&n===oe.PLATE_CARREE||s===oe.SPHERICAL_ECEF||s===oe.WEB_MERCATOR)){const o=Ep[s][oe.LON_LAT],a=Ep[oe.LON_LAT][n];return!A(o)&&!A(a)&&(o(e,0,Hf,0),a(Hf,0,Ev,0),s===oe.SPHERICAL_ECEF?DKe(nm*Hf[0],nm*Hf[1],i):zp(i),i[12]=Ev[0],i[13]=Ev[1],i[14]=Ev[2],!0)}return!1}function ice(t){return t===oe.SPHERICAL_ECEF||t===oe.SPHERICAL_MARS_PCPF||t===oe.SPHERICAL_MOON_PCPF}function KTe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function DKe(t,e,i){return KTe(t,e,i),hh(i,i),i}function My(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Ec(t,1)),t.wkt===Qbe.wkt?e.spatialReferenceId=oe.SPHERICAL_ECEF:x$(t)?e.spatialReferenceId=oe.WGS84:xy(t)?e.spatialReferenceId=oe.WEB_MERCATOR:Iee(t)?e.spatialReferenceId=oe.PLATE_CARREE:t.wkt===ewe.wkt?e.spatialReferenceId=oe.WGS84_ECEF:t.wkid===xp.CGCS2000?e.spatialReferenceId=oe.CGCS2000:t.wkt===Nee.wkt?e.spatialReferenceId=oe.SPHERICAL_MARS_PCPF:t.wkt===Fee.wkt?e.spatialReferenceId=oe.SPHERICAL_MOON_PCPF:Ly(t)?e.spatialReferenceId=oe.GCSMARS2000:Dy(t)?e.spatialReferenceId=oe.GCSMOON2000:e.spatialReferenceId=oe.UNKNOWN):oe.UNKNOWN}function ms(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function f2(t,e,i,r){i[r++]=UA*(t[e++]/zi.radius),i[r++]=UA*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/zi.radius))),i[r]=t[e]}function QTe(t,e,i,r){f2(t,e,i,r),gb(i,r,i,r)}function e2e(t,e,i,r){f2(t,e,i,r),_b(i,r,i,r)}function zte(t,e,i,r,s){const n=.4999999*Math.PI,o=Se(nm*t[e+1],-n,n),a=Math.sin(o);i[r++]=nm*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function G2(t,e,i,r){zte(t,e,i,r,zi)}const rce=zi.radius*Math.PI/180,MI=180/(zi.radius*Math.PI);function mb(t,e,i,r){i[r]=t[e]*rce,i[r+1]=t[e+1]*rce,i[r+2]=t[e+2]}function t2(t,e,i,r){i[r]=t[e]*MI,i[r+1]=t[e+1]*MI,i[r+2]=t[e+2]}function t2e(t,e,i,r){f2(t,e,i,r),mb(i,r,i,r)}function NKe(t,e,i,r){vb(t,e,i,r),mb(i,r,i,r)}function FKe(t,e,i,r){yb(t,e,i,r),mb(i,r,i,r)}function UKe(t,e,i,r){t2(t,e,i,r),gb(i,r,i,r)}function kKe(t,e,i,r){t2(t,e,i,r),G2(i,r,i,r)}function VKe(t,e,i,r){t2(t,e,i,r),_b(i,r,i,r)}function j2(t){if(A(t))return!1;const e=My(t,M3);return!!Ep[e][oe.WGS84_COMPARABLE_LON_LAT]}function zKe(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}function Bte(t,e,i,r,s){const n=s+t[e+2],o=nm*t[e+1],a=nm*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function EY(t,e,i,r){Bte(t,e,i,r,k_.radius)}function CY(t,e,i,r){Bte(t,e,i,r,cy.radius)}function gb(t,e,i,r){Bte(t,e,i,r,zi.radius)}function Gte(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Fp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=UA*h,i[r++]=UA*c,i[r]=l-s}function MY(t,e,i,r){Gte(t,e,i,r,k_.radius)}function AY(t,e,i,r){Gte(t,e,i,r,cy.radius)}function yb(t,e,i,r){Gte(t,e,i,r,zi.radius)}function i2e(t,e,i,r){yb(t,e,i,r),G2(i,r,i,r)}function r2e(t,e,i,r){yb(t,e,i,r),_b(i,r,i,r)}function BKe(t,e,i,r,s){const n=nm*t[e],o=nm*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function _b(t,e,i,r){BKe(t,e,i,r,zi)}function vb(t,e,i,r){const s=_Ke,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,g,y,v,x,S,E,C,R,O,U,L,B,G,j,q;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),j=Math.atan2(o,n),m=a*a/d,g=c/d,R=s.a2/f,O=s.a3-s.a4/f,g>.3?(y=l/f*(1+g*(s.a1+R+m*O)/f),G=Math.asin(y),x=y*y,v=Math.sqrt(1-x)):(v=h/f*(1-m*(s.a5-R-g*O)/f),G=Math.acos(v),x=1-v*v,y=Math.sqrt(x)),S=1-zi.eccentricitySquared*x,E=zi.radius/Math.sqrt(S),C=s.a6*E,R=h-E*v,O=l-C*y,L=v*R+y*O,U=v*O-y*R,B=U/(C/S+L),G+=B,q=L+U*B/2,a<0&&(G=-G),i[r++]=UA*j,i[r++]=UA*G,i[r]=q}function s2e(t,e,i,r){vb(t,e,i,r),gb(i,r,i,r)}function n2e(t,e,i,r){vb(t,e,i,r),G2(i,r,i,r)}const Ep={[oe.WGS84]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:ms,[oe.SPHERICAL_ECEF]:gb,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:G2,[oe.PLATE_CARREE]:mb,[oe.WGS84]:ms,[oe.WGS84_ECEF]:_b},[oe.CGCS2000]:{[oe.CGCS2000]:ms,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:ms,[oe.SPHERICAL_ECEF]:gb,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:mb,[oe.WGS84]:null,[oe.WGS84_ECEF]:_b},[oe.GCSMARS2000]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:ms,[oe.GCSMOON2000]:null,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:null,[oe.SPHERICAL_ECEF]:null,[oe.SPHERICAL_MARS_PCPF]:CY,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:null,[oe.WGS84]:null,[oe.WGS84_ECEF]:null},[oe.GCSMOON2000]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:ms,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:null,[oe.SPHERICAL_ECEF]:null,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:EY,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:null,[oe.WGS84]:null,[oe.WGS84_ECEF]:null},[oe.WEB_MERCATOR]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:f2,[oe.WGS84_COMPARABLE_LON_LAT]:f2,[oe.SPHERICAL_ECEF]:QTe,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:ms,[oe.PLATE_CARREE]:t2e,[oe.WGS84]:f2,[oe.WGS84_ECEF]:e2e},[oe.WGS84_ECEF]:{[oe.CGCS2000]:vb,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:vb,[oe.WGS84_COMPARABLE_LON_LAT]:vb,[oe.SPHERICAL_ECEF]:s2e,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:n2e,[oe.PLATE_CARREE]:NKe,[oe.WGS84]:vb,[oe.WGS84_ECEF]:ms},[oe.SPHERICAL_ECEF]:{[oe.CGCS2000]:yb,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:yb,[oe.WGS84_COMPARABLE_LON_LAT]:yb,[oe.SPHERICAL_ECEF]:ms,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:i2e,[oe.PLATE_CARREE]:FKe,[oe.WGS84]:yb,[oe.WGS84_ECEF]:r2e},[oe.SPHERICAL_MARS_PCPF]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:AY,[oe.GCSMOON2000]:null,[oe.LON_LAT]:AY,[oe.WGS84_COMPARABLE_LON_LAT]:null,[oe.SPHERICAL_ECEF]:null,[oe.SPHERICAL_MARS_PCPF]:ms,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:null,[oe.WGS84]:null,[oe.WGS84_ECEF]:null},[oe.SPHERICAL_MOON_PCPF]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:MY,[oe.LON_LAT]:MY,[oe.WGS84_COMPARABLE_LON_LAT]:null,[oe.SPHERICAL_ECEF]:null,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:ms,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:null,[oe.WGS84]:null,[oe.WGS84_ECEF]:null},[oe.UNKNOWN]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:null,[oe.WGS84_COMPARABLE_LON_LAT]:null,[oe.SPHERICAL_ECEF]:null,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:ms,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:null,[oe.WGS84]:null,[oe.WGS84_ECEF]:null},[oe.LON_LAT]:{[oe.CGCS2000]:ms,[oe.GCSMARS2000]:ms,[oe.GCSMOON2000]:ms,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:ms,[oe.SPHERICAL_ECEF]:gb,[oe.SPHERICAL_MARS_PCPF]:CY,[oe.SPHERICAL_MOON_PCPF]:EY,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:G2,[oe.PLATE_CARREE]:mb,[oe.WGS84]:ms,[oe.WGS84_ECEF]:_b},[oe.WGS84_COMPARABLE_LON_LAT]:{[oe.CGCS2000]:null,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:ms,[oe.WGS84_COMPARABLE_LON_LAT]:ms,[oe.SPHERICAL_ECEF]:gb,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:null,[oe.PLATE_CARREE]:mb,[oe.WGS84]:ms,[oe.WGS84_ECEF]:_b},[oe.PLATE_CARREE]:{[oe.CGCS2000]:t2,[oe.GCSMARS2000]:null,[oe.GCSMOON2000]:null,[oe.LON_LAT]:t2,[oe.WGS84_COMPARABLE_LON_LAT]:t2,[oe.SPHERICAL_ECEF]:UKe,[oe.SPHERICAL_MARS_PCPF]:null,[oe.SPHERICAL_MOON_PCPF]:null,[oe.UNKNOWN]:null,[oe.WEB_MERCATOR]:kKe,[oe.PLATE_CARREE]:ms,[oe.WGS84]:t2,[oe.WGS84_ECEF]:VKe}};function jte(t,e,i=Hte()){return A(t)||A(e)?null:o2e(t,e,i).projector}function o2e(t,e,i){if(A(t)||A(e)||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=My(t,i.source),s=My(e,i.dest);return r===oe.UNKNOWN&&s===oe.UNKNOWN?us(t,e)?i.projector=ms:i.projector=null:i.projector=Ep[r][s],i}function Hte(){return{source:{spatialReference:null,spatialReferenceId:oe.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:oe.UNKNOWN,metersPerUnit:1},projector:ms}}const M3={spatialReference:null,spatialReferenceId:oe.UNKNOWN},a2e={spatialReference:null,spatialReferenceId:oe.UNKNOWN},qte=Hte(),GKe=Hte(),nm=ci(1),UA=Sc(1),on=$(),Hf=$(),Ev=$(),xr=$(),MN=$();var OY;let Sg=OY=class extends Ae{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new OY({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sg.prototype,"cols",void 0),u([p({type:Fr,json:{write:!0}})],Sg.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],Sg.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sg.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],Sg.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sg.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],Sg.prototype,"scale",void 0),Sg=OY=u([N("esri.layers.support.LOD")],Sg);const Or=Sg;let jKe=class{constructor(e,i,r,s,n){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var v1;const sce=new Hi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Aa=v1=class extends Ae{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Ye.WebMercator,numLODs:n=24}=t;if(!Vo(s)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new Or({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new Or({level:m,scale:f,resolution:f})),f*=2}return new v1({dpi:96,lods:d,origin:new st(0,0,s),size:[r,r],spatialReference:s})}const o=dd(s),a=t.origin?new st({x:t.origin.x,y:t.origin.y,spatialReference:s}):new st(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Ec(s)*39.37*l),h=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;h.push(new Or({level:d,scale:f,resolution:m}))}else{let d=Dk(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Or({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const g=d/2**e,y=g*c;h.push(new Or({level:m,scale:g,resolution:y})),d=g}}return new v1({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=dd(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return st.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("minScale",e),this._set("maxScale",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(us(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=_S(e,this.spatialReference);if(A(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new jKe(null,0,0,0,bi())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=v1.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===v1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=bi()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return v1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*e;i.push(new Or({level:n.level,scale:n.scale,resolution:o}))}return new v1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([p({type:Number,json:{write:!0}})],Aa.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],Aa.prototype,"dpi",void 0),u([p({type:String,json:{read:sce.read,write:sce.write,origins:{"web-scene":{read:!1,write:!1}}}})],Aa.prototype,"format",void 0),u([p({readOnly:!0})],Aa.prototype,"isWrappable",null),u([p({type:st,json:{write:!0}})],Aa.prototype,"origin",void 0),u([De("origin")],Aa.prototype,"readOrigin",null),u([p({type:[Or],value:null,json:{write:!0}})],Aa.prototype,"lods",null),u([p({readOnly:!0})],Aa.prototype,"minScale",void 0),u([p({readOnly:!0})],Aa.prototype,"maxScale",void 0),u([p({readOnly:!0})],Aa.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Aa.prototype,"size",void 0),u([De("size",["rows","cols"])],Aa.prototype,"readSize",null),u([Xe("size",{cols:{type:Fr},rows:{type:Fr}})],Aa.prototype,"writeSize",null),u([p({type:Ye,json:{write:!0}})],Aa.prototype,"spatialReference",void 0),Aa=v1=u([N("esri.layers.support.TileInfo")],Aa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Aa||(Aa={}));const m2=Aa,r6={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},r7={xsmall:544,small:768,medium:992,large:1200};function HKe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function s7(t,e){return e?r6[t].valueToClassName[e].split(" "):[]}const l2e=t=>{let e=class extends t{constructor(...i){super(...i),this._breakpointsHandles=new ir,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=r7}initialize(){this._breakpointsHandles.add(ae(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),ii))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=He(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=HKe(i);if(!r){const s=JSON.stringify(r7,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:r7,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=ru.acquire(),r=ru.acquire();let s,n=!1;for(s in r6){const o=this[s],a=r6[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,s7(s,o).forEach(l=>r.push(l)),s7(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),ru.release(i),ru.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in r6)s7(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([N("esri.views.BreakpointsOwner")],e),e};function pV(t){return typeof t=="string"?document.getElementById(t):t??null}function c2e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function nce(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function oce(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let dy=class extends Ee{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new ir,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,i,r={}){return this._installWatch(e,i,r,ae)}addWhen(e,i,r={}){return this._installWatch(e,i,r,wa)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([Gs(e,"after-changes",this._createSyncUpdatingCallback(),Mi),Gs(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),{remove:()=>this._handles.remove(n)}}addPromise(e){if(A(e))return e;const i=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(AN)||this._set("updating",!1))}},i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this._handles.add(o,n),{remove:()=>this._handles.remove(n)}}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=ae(e,r,{sync:!0,equals:()=>!1});return this._handles.add(s,i),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(AN),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(yS(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(AN))}),AN)}}};u([p({readOnly:!0})],dy.prototype,"updating",void 0),dy=u([N("esri.core.support.WatchUpdatingTracking")],dy);const AN=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var qKe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},IT={exports:{}},io={},L$={exports:{}},ES={};function u2e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function WKe(t,e,i){}function YKe(t,e,i){}var XKe=/javascript\s*\:/img;function ZKe(t,e){return XKe.test(e)?"":e}ES.whiteList=u2e();ES.getDefaultWhiteList=u2e;ES.onAttr=WKe;ES.onIgnoreAttr=YKe;ES.safeAttrValue=ZKe;var JKe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},AO=JKe;function KKe(t,e){t=AO.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=AO.trim(t.slice(s,n)),d=h.indexOf(":");if(d!==-1){var f=AO.trim(h.slice(0,d)),m=AO.trim(h.slice(d+1));if(f){var g=e(s,o.length,f,m,h);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return AO.trim(o)}var QKe=KKe,ON=ES,eQe=QKe;function ace(t){return t==null}function tQe(t){var e={};for(var i in t)e[i]=t[i];return e}function h2e(t){t=tQe(t||{}),t.whiteList=t.whiteList||ON.whiteList,t.onAttr=t.onAttr||ON.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||ON.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||ON.safeAttrValue,this.options=t}h2e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=eQe(t,function(l,c,h,d,f){var m=r[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(h,d),!!d){var y={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var v=s(h,d,y);return ace(v)?h+":"+d:v}else{var v=n(h,d,y);if(!ace(v))return v}}});return a};var iQe=h2e;(function(t,e){var i=ES,r=iQe;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(L$,L$.exports);var Wte={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},rQe=L$.exports.FilterCSS,sQe=L$.exports.getDefaultWhiteList,MU=Wte;function d2e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var p2e=new rQe;function nQe(t,e,i){}function oQe(t,e,i){}function aQe(t,e,i){}function lQe(t,e,i){}function f2e(t){return t.replace(uQe,"&lt;").replace(hQe,"&gt;")}function cQe(t,e,i,r){if(i=b2e(i),e==="href"||e==="src"){if(i=MU.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(RN.lastIndex=0,RN.test(i))return""}else if(e==="style"){if(lce.lastIndex=0,lce.test(i)||(cce.lastIndex=0,cce.test(i)&&(RN.lastIndex=0,RN.test(i))))return"";r!==!1&&(r=r||p2e,i=r.process(i))}return i=w2e(i),i}var uQe=/</g,hQe=/>/g,dQe=/"/g,pQe=/&quot;/g,fQe=/&#([a-zA-Z0-9]*);?/gim,mQe=/&colon;?/gim,gQe=/&newline;?/gim,RN=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,lce=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,cce=/u\s*r\s*l\s*\(.*/gi;function m2e(t){return t.replace(dQe,"&quot;")}function g2e(t){return t.replace(pQe,'"')}function y2e(t){return t.replace(fQe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function _2e(t){return t.replace(mQe,":").replace(gQe," ")}function v2e(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return MU.trim(e)}function b2e(t){return t=g2e(t),t=y2e(t),t=_2e(t),t=v2e(t),t}function w2e(t){return t=m2e(t),t=f2e(t),t}function yQe(){return""}function _Qe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:MU.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return MU.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function vQe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function bQe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}io.whiteList=d2e();io.getDefaultWhiteList=d2e;io.onTag=nQe;io.onIgnoreTag=oQe;io.onTagAttr=aQe;io.onIgnoreTagAttr=lQe;io.safeAttrValue=cQe;io.escapeHtml=f2e;io.escapeQuote=m2e;io.unescapeQuote=g2e;io.escapeHtmlEntities=y2e;io.escapeDangerHtml5Entities=_2e;io.clearNonPrintableCharacter=v2e;io.friendlyAttrValue=b2e;io.escapeAttrValue=w2e;io.onIgnoreTagStripAll=yQe;io.StripTagBody=_Qe;io.stripCommentTag=vQe;io.stripBlankChar=bQe;io.cssFilter=p2e;io.getDefaultCSSWhiteList=sQe;var fV={},j1=Wte;function wQe(t){var e=j1.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=j1.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function xQe(t){return t.slice(0,2)==="</"}function TQe(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"){r+=i(t.slice(s,n)),h=t.slice(n,a+1),c=wQe(h),r+=e(n,r.length,c,h,xQe(h)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var SQe=/[^a-zA-Z0-9\\_:.-]/gim;function EQe(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=j1.trim(f),f=f.replace(SQe,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:MQe(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;h=j1.trim(t.slice(r+1,d)),a(n,h),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=CQe(t,l),d===-1){h=j1.trim(t.slice(i,l)),a(h),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=AQe(t,l-1),d===-1){h=j1.trim(t.slice(i,l)),h=uce(h),a(n,h),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,uce(j1.trim(t.slice(i))))),j1.trim(s.join(" "))}function CQe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function MQe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function AQe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function OQe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function uce(t){return OQe(t)?t.substr(1,t.length-2):t}fV.parseTag=TQe;fV.parseAttr=EQe;var RQe=L$.exports.FilterCSS,qf=io,x2e=fV,PQe=x2e.parseTag,IQe=x2e.parseAttr,s6=Wte;function PN(t){return t==null}function $Qe(t){var e=s6.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=s6.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=s6.trim(t.slice(0,-1))),{html:t,closing:i}}function LQe(t){var e={};for(var i in t)e[i]=t[i];return e}function DQe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function T2e(t){t=LQe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=qf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=DQe(t.whiteList||t.allowList):t.whiteList=qf.whiteList,t.onTag=t.onTag||qf.onTag,t.onTagAttr=t.onTagAttr||qf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||qf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||qf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||qf.safeAttrValue,t.escapeHtml=t.escapeHtml||qf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new RQe(t.css))}T2e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=qf.stripBlankChar(t)),i.allowCommentTag||(t=qf.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=qf.StripTagBody(i.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=PQe(t,function(m,g,y,v,x){var S={sourcePosition:m,position:g,isClosing:x,isWhite:Object.prototype.hasOwnProperty.call(r,y)},E=s(y,v,S);if(!PN(E))return E;if(S.isWhite){if(S.isClosing)return"</"+y+">";var C=$Qe(v),R=r[y],O=IQe(C.html,function(U,L){var B=s6.indexOf(R,U)!==-1,G=o(y,U,L,B);return PN(G)?B?(L=l(y,U,L,h),L?U+'="'+L+'"':U):(G=a(y,U,L,B),PN(G)?void 0:G):G});return v="<"+y,O&&(v+=" "+O),C.closing&&(v+=" /"),v+=">",v}else return E=n(y,v,S),PN(E)?c(v):E},c);return d&&(f=d.remove(f)),f};var NQe=T2e;(function(t,e){var i=io,r=fV,s=NQe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(IT,IT.exports);var FQe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):IT.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new IT.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?IT.exports.escapeAttrValue(e):!n&&!s?IT.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):IT.exports.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(qKe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const mV=new Map;function S2e(){mV.clear()}function UQe(t){return mV.get(t)}function kQe(t,e){mV.set(t,e)}function n7(t){mV.delete(t)}var H2,kA,VQe=function(t){if("WebkitTransition"in t.style)H2="webkitTransitionEnd",kA="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");H2="transitionend",kA="animationend"}},E2e=function(t){H2||VQe(t)},zQe=function(t,e){return e===void 0&&(e=t+"-active"),function(i){E2e(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(H2,s),i.removeEventListener(kA,s),i.classList.remove(t),i.classList.remove(e))};i.classList.add(t),i.addEventListener(H2,s),i.addEventListener(kA,s),requestAnimationFrame(function(){i.classList.add(e)})}},BQe=function(t,e){return e===void 0&&(e=t+"-active"),function(i,r){E2e(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(H2,n),i.removeEventListener(kA,n),r())};i.classList.add(t),i.addEventListener(H2,n),i.addEventListener(kA,n),requestAnimationFrame(function(){i.classList.add(e)})}};const GQe=le.getLogger("esri.widgets.support.widgetUtils");function C2e(t){const e=ru.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return ru.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(i=>{var r;S2e();for(const s of i)(r=t.get(s.target))==null||r(s)});return(i,r,s)=>(t.has(i)&&GQe.error("Already observing element",i),t.set(i,r),e.observe(i,s),Dp(()=>{e.unobserve(i),t.delete(i)}))})();function ty(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function hce(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function AU(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function jQe(t,e){return(t==="enter"?zQe:BQe)(e)}const HQe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],qQe=HQe.reduce((t,e)=>(t[e]=[],t),{}),WQe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],M2e=new FQe({whiteList:qQe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(WQe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function YQe(t){return t==="Enter"||t===" "}const A2e="http://www.w3.org/",gV=`${A2e}2000/svg`,O2e=`${A2e}1999/xlink`;let dce=[],Yte=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},Xte=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),R2e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},XQe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(Xte(t[r],e))return r}return-1},o7=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Xte(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},ZQe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},RY=[],PY=!1,P2e=t=>{(t.children||[]).forEach(P2e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},pce=()=>{PY=!1,RY.forEach(P2e),RY.length=0},fce=t=>{RY.push(t),PY||(PY=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(pce,{timeout:16}):setTimeout(pce,16))},mce=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),fce(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),fce(t))},JQe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")IY(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(R2e(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===gV?a==="href"?t.setAttributeNS(O2e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=M2e.sanitize(l):I2e(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function I2e(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let OU,KQe=(t,e,i)=>{if(e)for(let r of e)gM(r,t,void 0,i)},$2e=(t,e,i)=>{KQe(t,e.children,i),e.text&&(t.textContent=e.text),JQe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},gM=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),d=o.slice(n,l);h==="."?s.classList.add(d):h==="#"?s.id=d:(d==="svg"&&(r=Yte(r,{namespace:gV})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}$2e(s,t,r)}},IY=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},QQe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=e[l];if(l==="class")h!==c&&(IY(t,h,!1),IY(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let y=f[g],v=!!c[y];v!==!!h[y]&&(s=!0,v?d.add(y):d.remove(y))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let g=d[m],y=c[g];y!==h[g]&&(s=!0,y?(R2e(y),r.styleApplyer(t,g,y)):r.styleApplyer(t,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===gV?l==="href"?t.setAttributeNS(O2e,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=M2e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):I2e(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},eet=(t,e,i,r,s)=>{if(i===r)return!1;r=r||dce;let n,o=(i=i||dce).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&Xte(d,f))h=OU(d,f,s)||h,l++;else{let m=XQe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)mce(i[n]),o7(i,n,t,"removed");h=OU(i[m],f,s)||h,l=m+1}else gM(f,e,l<o?i[l].domNode:void 0,s),ZQe(f),o7(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)mce(i[n]),o7(i,n,t,"removed");return h};OU=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=Yte(i,{namespace:gV})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=eet(e,r,t.children,e.children,i)||n,n=QQe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let OO=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,OU(r,i,e)},domNode:t.domNode});const tet={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let gC=t=>Yte(tet,t),bb={create:(t,e)=>(e=gC(e),gM(t,document.createElement("div"),void 0,e),OO(t,e)),append:(t,e,i)=>(i=gC(i),gM(e,t,void 0,i),OO(e,i)),insertBefore:(t,e,i)=>(i=gC(i),gM(e,t.parentNode,t,i),OO(e,i)),merge:(t,e,i)=>(i=gC(i),e.domNode=t,$2e(t,e,i),OO(e,i)),replace:(t,e,i)=>(i=gC(i),gM(e,t.parentNode,t,i),t.parentNode.removeChild(t),OO(e,i))},L2e,iet=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};L2e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let ret=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?L2e(i.children,s=>s.domNode===r):void 0}),i},set=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=iet(s.currentTarget,n.domNode);o.reverse();let a,l=ret(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},$Y=t=>{let e,i,r=gC(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let g,y=()=>g;r.eventHandlerInterceptor=set(e,y,s),g=d(f,m(),r),a.push(g),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(bb.append,d,f)},insertBefore:(d,f)=>{c(bb.insertBefore,d,f)},merge:(d,f)=>{c(bb.merge,d,f)},replace:(d,f)=>{c(bb.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},b1=class extends Ee{constructor(){super(...arguments),this.items=new xt,this._watchUpdatingTracking=new dy,this._callbacks=new Map,this._projector=$Y(),this._hiddenProjector=$Y()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const i=e.getContext("2d");i.save(),i.font=this._fontString(),this.items.forEach(r=>{i.save(),r.renderCanvas(i),i.restore()}),i.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],b1.prototype,"surface",void 0),u([p({readOnly:!0})],b1.prototype,"items",void 0),u([p({readOnly:!0})],b1.prototype,"needsRender",null),u([p({readOnly:!0})],b1.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],b1.prototype,"updating",null),b1=u([N("esri.views.overlay.ViewOverlay")],b1);const gce=b1;function qM(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);let o,a=0;const l=()=>{a=0,t.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const net="randomUUID"in crypto;function oet(){if(net)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const aet={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},cet={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},uet=t=>({...cet,...t}),het=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},det=(t,e)=>t.find(e),yce=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?det(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},pet=t=>{let e;const i={...aet,...t},r=uet(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var x;let y;r.eventHandlerInterceptor=(S,E,C,R)=>function(O){let U;s("domEvent",O);const L=het(O.currentTarget,y.domNode),B=L.some(j=>{var q;return customElements.get((q=j==null?void 0:j.tagName)==null?void 0:q.toLowerCase())});if(O.eventPhase===Event.CAPTURING_PHASE||!B)L.reverse(),U=yce(y.getLastRender(),L);else{const j=O.composedPath(),q=j.slice(j.indexOf(O.currentTarget),j.indexOf(y.domNode)).filter(ie=>ie.getRootNode()===ie.ownerDocument).reverse();U=yce(y.getLastRender(),q,!0)}let G;return U&&(G=i.handleInterceptedEvent(e,U,this,O)),s("domEventProcessed",O),G},(x=i.postProcessProjectionOptions)==null||x.call(i,r);const v=g();y=f(m,v,r),l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(bb.append,f,m)},insertBefore:(f,m)=>{h(bb.insertBefore,f,m)},merge:(f,m)=>{h(bb.merge,f,m)},replace:(f,m)=>{h(bb.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},yC={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let _C,D2e,yV,N2e=!1,RU=!1,Zte=!1,Wh=!1,_ce=null,LY=!1;const sjt=t=>{const e=new URL(t,Vl.$resourcesUrl$);return e.origin!==rD.location.origin?e.href:e.pathname},fet=t=>Vl.$resourcesUrl$=t,q2=(t,e="")=>()=>{},vce="http://www.w3.org/1999/xlink",bce={},met="http://www.w3.org/2000/svg",get="http://www.w3.org/1999/xhtml",yet=t=>t!=null,Jte=t=>(t=typeof t,t==="object"||t==="function"),F2e=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)r=d[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!Jte(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?PU(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,bet);const h=PU(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},PU=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},_et={},vet=t=>t&&t.$tag$===_et,bet={forEach:(t,e)=>t.map(wce).forEach(e),map:(t,e)=>t.map(wce).map(e).map(wet)},wce=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),wet=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),F2e(t.vtag,i,...t.vchildren||[])}const e=PU(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},xet=t=>Zet.map(e=>e(t)).find(e=>!!e),Tet=(t,e)=>t!=null&&!Jte(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Eet=t=>t,njt=(t,e,i)=>{const r=Eet(t);return{emit:s=>Cet(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},Cet=(t,e,i)=>{const r=Vl.ce(e,i);return t.dispatchEvent(r),r},xce=new WeakMap,Met=(t,e,i)=>{let r=$U.get(t);Qet&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,$U.set(t,r)},Aet=(t,e,i,r)=>{let s=U2e(e,i);const n=$U.get(s);if(t=t.nodeType===11?t:py,n)if(typeof n=="string"){t=t.head||t;let o=xce.get(t),a;o||xce.set(t,o=new Set),o.has(s)||(a=py.createElement("style"),a.innerHTML=n,t.insertBefore(a,t.querySelector("link")),o&&o.add(s))}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},Oet=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=q2("attachStyles",e.$tagName$),n=Aet(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},U2e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Tce=(t,e,i,r,s,n)=>{if(i!==r){let o=Mce(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Sce(i),h=Sce(r);l.remove(...c.filter(d=>d&&!h.includes(d))),l.add(...h.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Mce(rD,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&Vl.rel(t,e,i,!1),r&&Vl.ael(t,e,r,!1);else{const l=Jte(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const h=r??"";e==="list"?o=!1:(i==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(vce,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(vce,e,r):t.setAttribute(e,r))}}},Ret=/\s/,Sce=t=>t?t.split(Ret):[],k2e=(t,e,i,r)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||bce,o=e.$attrs$||bce;for(r in n)r in o||Tce(s,r,n[r],void 0,i,e.$flags$);for(r in o)Tce(s,r,n[r],o[r],i,e.$flags$)},IU=(t,e,i,r)=>{const s=e.$children$[i];let n=0,o,a,l;if(N2e||(Zte=!0,s.$tag$==="slot"&&(_C&&r.classList.add(_C+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=py.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=py.createTextNode("");else{if(Wh||(Wh=s.$tag$==="svg"),o=s.$elm$=py.createElementNS(Wh?met:get,s.$flags$&2?"slot-fb":s.$tag$),Wh&&s.$tag$==="foreignObject"&&(Wh=!1),k2e(null,s,Wh),yet(_C)&&o["s-si"]!==_C&&o.classList.add(o["s-si"]=_C),s.$children$)for(n=0;n<s.$children$.length;++n)a=IU(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Wh=!1:o.tagName==="foreignObject"&&(Wh=!0)}return o["s-hn"]=yV,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=D2e,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===s.$tag$&&t.$elm$&&D$(t.$elm$,!1)),o},D$=(t,e)=>{Vl.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==yV&&s["s-ol"]&&(B2e(s).insertBefore(s,Kte(s)),s["s-ol"].remove(),s["s-ol"]=void 0,Zte=!0),e&&D$(s,e)}Vl.$flags$&=-2},V2e=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===yV&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=IU(null,i,s,t),a&&(r[s].$elm$=a,o.insertBefore(a,Kte(e))))},z2e=(t,e,i,r,s)=>{for(;e<=i;++e)(r=t[e])&&(s=r.$elm$,H2e(r),RU=!0,s["s-ol"]?s["s-ol"].remove():D$(s,!0),s.remove())},Pet=(t,e,i,r)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],d=r.length-1,f=r[0],m=r[d],g,y;for(;s<=l&&n<=d;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--d];else if(IN(c,f))vC(c,f),c=e[++s],f=r[++n];else if(IN(h,m))vC(h,m),h=e[--l],m=r[--d];else if(IN(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&D$(c.$elm$.parentNode,!1),vC(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=r[--d];else if(IN(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&D$(h.$elm$.parentNode,!1),vC(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(y=e[o],y.$tag$!==f.$tag$?g=IU(e&&e[n],i,o,t):(vC(y,f),e[o]=void 0,g=y.$elm$),f=r[++n]):(g=IU(e&&e[n],i,n,t),f=r[++n]),g&&B2e(c.$elm$).insertBefore(g,Kte(c.$elm$))}s>l?V2e(t,r[d+1]==null?null:r[d+1].$elm$,i,r,n,d):n>d&&z2e(e,s,l)},IN=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,Kte=t=>t&&t["s-ol"]||t,B2e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,vC=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(Wh=n==="svg"?!0:n==="foreignObject"?!1:Wh,n==="slot"||k2e(t,e,Wh),r!==null&&s!==null?Pet(i,r,e,s):s!==null?(t.$text$!==null&&(i.textContent=""),V2e(i,null,e,s,0,s.length-1)):r!==null&&z2e(r,0,r.length-1),Wh&&n==="svg"&&(Wh=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},G2e=t=>{const e=t.childNodes;let i,r,s,n,o,a;for(r=0,s=e.length;r<s;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){i.hidden=!0;break}}G2e(i)}},Zf=[],j2e=t=>{let e,i,r,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(Ece(i,s)?(n=Zf.find(h=>h.$nodeToRelocate$===i),RU=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=e:Zf.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&Zf.map(h=>{Ece(h.$nodeToRelocate$,i["s-sn"])&&(n=Zf.find(d=>d.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Zf.some(h=>h.$nodeToRelocate$===i)||Zf.push({$nodeToRelocate$:i}));e.nodeType===1&&j2e(e)}},Ece=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",H2e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(H2e)},Iet=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,s=t.$vnode$||PU(null,null),n=vet(e)?e:F2e(null,null,e);yV=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,_C=i["s-sc"],D2e=i["s-cr"],N2e=(r.$flags$&1)!==0,RU=!1,vC(s,n);{if(Vl.$flags$|=1,Zte){j2e(n.$elm$);let o,a,l,c,h,d,f=0;for(;f<Zf.length;f++)o=Zf[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=py.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Zf.length;f++)if(o=Zf[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){h=d;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}RU&&G2e(n.$elm$),Vl.$flags$&=-2,Zf.length=0}},$et=(t,e)=>{},Qte=(t,e)=>(t.$flags$|=16,$et(t,t.$ancestorComponent$),itt(()=>Let(t,e))),Let=(t,e)=>{const i=t.$hostElement$,r=q2("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;let n;return e?n=WM(s,"componentWillLoad"):n=WM(s,"componentWillUpdate"),n=Cce(n,()=>WM(s,"componentWillRender")),r(),Cce(n,()=>Det(t,s,e))},Det=async(t,e,i)=>{const r=t.$hostElement$,s=q2("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&Oet(t);const n=q2("render",t.$cmpMeta$.$tagName$);Net(t,e,r),n(),s(),Fet(t)},Net=(t,e,i)=>{try{_ce=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(yC.hasRenderFn||yC.reflect)&&(yC.vdomRender||yC.reflect)&&(yC.hydrateServerSide||Iet(t,e))}catch(a){iD(a,t.$hostElement$)}return _ce=null,null},Fet=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=q2("postUpdate",e),s=i;t.$ancestorComponent$,WM(s,"componentDidRender"),t.$flags$&64?(WM(s,"componentDidUpdate"),r()):(t.$flags$|=64,WM(s,"componentDidLoad"),r())},ojt=t=>{{const e=tD(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Qte(e,!1),i}},WM=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){iD(r)}},Cce=(t,e)=>t&&t.then?t.then(e):e(),Uet=(t,e)=>tD(t).$instanceValues$.get(e),ket=(t,e,i,r)=>{const s=tD(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=Tet(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(f=>{try{l[f](i,o,e)}catch(m){iD(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;Qte(s,!1)}}}},Vet=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),s=t.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return Uet(this,n)},set(a){ket(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Vl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},zet=async(t,e,i,r,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=xet(t)]);const a=U2e(i,e.$modeName$);if(!$U.has(a)){const l=q2("registerStyles",i.$tagName$);Met(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>Qte(e,!0))()},Bet=t=>{},Get=t=>{if(!(Vl.$flags$&1)){const e=tD(t),i=e.$cmpMeta$,r=q2("connectedCallback",i.$tagName$);e.$flags$&1?(q2e(t,e,i.$listeners$),Bet(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&jet(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),zet(t,e,i)),r()}},jet=t=>{const e=t["s-cr"]=py.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},Het=t=>{if(!(Vl.$flags$&1)){const e=tD(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},ajt=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[],!Ace&&i.$flags$&1&&(i.$flags$|=8);const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){Xet(this,i)},connectedCallback(){Get(this),r&&r.call(this)},disconnectedCallback(){Het(this),s&&s.call(this)},__attachShadow(){Ace?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.shadowRoot=this}}),t.is=i.$tagName$,Vet(t,i)},ljt=(t,e)=>e,q2e=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=Wet(t,s),l=qet(e,o),c=Yet(s);Vl.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Vl.rel(a,n,l,c))})},qet=(t,e)=>i=>{try{yC.lazyLoad||t.$hostElement$[e](i)}catch(r){iD(r)}},Wet=(t,e)=>e&4?py:e&8?rD:e&16?py.body:t,Yet=t=>Jet?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,W2e=new WeakMap,tD=t=>W2e.get(t),Xet=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return q2e(t,i,e.$listeners$),W2e.set(t,i)},Mce=(t,e)=>e in t,iD=(t,e)=>(0,console.error)(t,e),$U=new Map,Zet=[],rD=typeof window<"u"?window:{},py=rD.document||{head:{}},cjt=rD.HTMLElement||class{},Vl={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},Ace=!0,Jet=(()=>{let t=!1;try{py.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Ket=t=>Promise.resolve(t),Qet=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Oce=[],Y2e=[],ett=(t,e)=>i=>{t.push(i),LY||(LY=!0,e&&Vl.$flags$&4?ttt(DY):Vl.raf(DY))},Rce=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){iD(i)}t.length=0},DY=()=>{Rce(Oce),Rce(Y2e),(LY=Oce.length>0)&&Vl.raf(DY)},ttt=t=>Ket().then(t),itt=ett(Y2e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const X2e="calcite-mode-auto",Z2e="calcite-mode-dark",rtt="calcite-mode-light",ujt={autoMode:X2e,darkMode:Z2e,lightMode:rtt,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var J2e=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],LU=J2e.join(","),K2e=typeof Element>"u",W2=K2e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,DU=!K2e&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},Q2e=function(e,i,r){var s=Array.prototype.slice.apply(e.querySelectorAll(LU));return i&&W2.call(e,LU)&&s.unshift(e),s=s.filter(r),s},eSe=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=W2.call(o,LU);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!r.shadowRootFilter||r.shadowRootFilter(o);if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},tSe=function(e,i){return e.tabIndex<0&&(i||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},stt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},iSe=function(e){return e.tagName==="INPUT"},ntt=function(e){return iSe(e)&&e.type==="hidden"},ott=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},att=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},ltt=function(e){if(!e.name)return!0;var i=e.form||DU(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=att(s,e.form);return!n||n===e},ctt=function(e){return iSe(e)&&e.type==="radio"},utt=function(e){return ctt(e)&&!ltt(e)},htt=function(e){for(var i,r=DU(e).host,s=!!((i=r)!==null&&i!==void 0&&i.ownerDocument.contains(r)||e.ownerDocument.contains(e));!s&&r;){var n;r=DU(r).host,s=!!((n=r)!==null&&n!==void 0&&n.ownerDocument.contains(r))}return s},Pce=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},dtt=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=W2.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(W2.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=DU(e);if(l&&!l.shadowRoot&&s(l)===!0)return Pce(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(htt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Pce(e);return!1},ptt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return W2.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},NU=function(e,i){return!(i.disabled||ntt(i)||dtt(i,e)||ott(i)||ptt(i))},NY=function(e,i){return!(utt(i)||tSe(i)<0||!NU(e,i))},ftt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},mtt=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=tSe(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(stt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},gtt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=eSe([e],i.includeContainer,{filter:NY.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:ftt}):r=Q2e(e,i.includeContainer,NY.bind(null,i)),mtt(r)},hjt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=eSe([e],i.includeContainer,{filter:NU.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=Q2e(e,i.includeContainer,NU.bind(null,i)),r},djt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return W2.call(e,LU)===!1?!1:NY(i,e)},ytt=J2e.concat("iframe").join(","),pjt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return W2.call(e,ytt)===!1?!1:NU(i,e)};const _tt={getShadowRoot:!0};function fjt(t){const e="dir",i=`[${e}]`,r=vtt(t,i);return r?r.getAttribute(e):"ltr"}function mjt(t,e,i){const r=`[${e}]`,s=t.closest(r);return s?s.getAttribute(e):i}function rSe(t){return t.getRootNode()}function sSe(t){return t.host||null}function gjt(t,{selector:e,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=rSe(s),o=i?"getElementById"in n?n.getElementById(i):null:e?n.querySelector(e):null,a=sSe(n);return o||(a?r(a):null)}return r(t)}function vtt(t,e){function i(r){return r?r.closest(e)||i(sSe(rSe(r))):null}return i(t)}function btt(t,e){return nSe(t,e)}function nSe(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return nSe(r instanceof ShadowRoot?r.host:r,e)}function yjt(t,e){return!!btt(e,i=>i===t?!0:void 0)}function wtt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function _jt(t){if(t)return wtt(t)?t.setFocus():t.focus()}function vjt(t){(gtt(t,_tt)[0]||t).focus()}const N$=":not([slot])";function bjt(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:N$;return i!=null&&i.all?xtt(t,r,i):Ttt(t,r,i)}function oSe(t,e){return t?Array.from(t.children||[]).filter(i=>i==null?void 0:i.matches(e)):[]}function xtt(t,e,i){let r=e===N$?oSe(t,N$):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(n=>n.parentElement===t),r=i!=null&&i.matches?r.filter(n=>n==null?void 0:n.matches(i.matches)):r;const s=i==null?void 0:i.selector;return s?r.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):r}function Ttt(t,e,i){let r=e===N$?oSe(t,N$)[0]||null:t.querySelector(e);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===t?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const s=i==null?void 0:i.selector;return s?r==null?void 0:r.querySelector(s):r}function wjt(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function xjt(t){return(!!t).toString()}function Tjt(t){return!!Stt(t).length}function Stt(t){return t.target.assignedElements({flatten:!0})}function Sjt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function Ice(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(Z2e)||t.contains(X2e)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Ett(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Ice():document.addEventListener("DOMContentLoaded",()=>Ice(),{once:!0}))}const Ctt=Ett;Ctt();let aSe;function Mtt(){fet(nd(Cr(aSe)))}aSe="components/assets";const lSe=Symbol("widget"),Att=Symbol("widget-test-data"),Ott=[],Rtt={},FU=new WeakMap;function cSe(t,e){let i=e.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=cSe(t,i[s]);else i=Ott;const r=e.vnodeSelector;if(eie(r)){const s=e.properties||Rtt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:Ptt,afterUpdate:Itt,afterRemoved:uSe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function Ptt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,FU.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r._internalHandles.add(Dp(()=>uSe(t)))}function Itt(t,e,i,{widgetProperties:r}){var n;const s=FU.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function uSe(t){var i;const e=FU.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),FU.delete(t))}function eie(t){return typeof t=="function"&&t[lSe]}const $ce=new Set;function $tt(t){$ce.add(t),t.finally(()=>$ce.delete(t))}var hSe;const Ltt="esri.widgets.Widget";let Dtt=0;const Ntt={widgetIcon:"esri-icon-checkbox-unchecked"};function dSe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?dSe(t[i],e==null?void 0:e[i]):t[i]=e[i]);return t}const Ftt=pet({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const d=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(S2e(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let a7=!1,Oa=class extends Ik(ws.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._internalHandles=new ir,this._projector=Ftt,this._readyForTrueRender=!1,this.iconClass=Ntt.widgetIcon,this.key=this,this._loadLocale=dee(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await hu(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await Swe(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=dSe(ue(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&le.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),Mtt();const r="esri-widget-uid-"+oet(),s=this.render.bind(this);this._trackingTarget=new Ok(()=>this.scheduleRender());const n=()=>{var d;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=s();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=r),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(d=o.children)==null||d.forEach(f=>{if(eie(f.vnodeSelector))return;let{properties:m}=f;m||(f.properties=m={}),m.key||(m.key=`${this.id}--${h++}`)}),cSe(this,o)};this.render=()=>{if(a7)return n();let o=UQe(this)??null;if(o)return o;this._trackingTarget.clear(),a7=!0;try{o=D_(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{a7=!1}return o&&kQe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),$tt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(gq)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(He(this._trackingTarget),He(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,n7(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return pV(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Dtt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(hSe=lSe,Att)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(n7(this),this._projector.scheduleRender())}classes(...e){return C2e.apply(this,e)}renderNow(){n7(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this._internalHandles.add(ae(()=>this.viewModel,(r,s)=>{s&&this._internalHandles.remove("delegated-events"),r&&Ck(r)&&this._internalHandles.add(this._delegatedEventNames.map(n=>zL(r,n,o=>{this.emit(n,o)})),"delegated-events")},ii)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(gq),this.scheduleRender()};this._internalHandles.add([xwe(e),ae(()=>this.uiStrings,e),wa(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};Oa[hSe]=!0,u([p()],Oa.prototype,"_readyForTrueRender",void 0),u([p({value:null})],Oa.prototype,"container",null),u([pi("container")],Oa.prototype,"castContainer",null),u([p()],Oa.prototype,"iconClass",void 0),u([p()],Oa.prototype,"id",null),u([p()],Oa.prototype,"label",null),u([p()],Oa.prototype,"renderable",null),u([p()],Oa.prototype,"uiStrings",void 0),u([p()],Oa.prototype,"viewModel",void 0),u([p({value:!0})],Oa.prototype,"visible",null),u([p()],Oa.prototype,"key",void 0),u([p()],Oa.prototype,"children",void 0),u([p()],Oa.prototype,"afterCreate",void 0),u([p()],Oa.prototype,"afterUpdate",void 0),u([p()],Oa.prototype,"afterRemoved",void 0),Oa=u([N(Ltt)],Oa);const hl=Oa;function pSe(t){return 32+t.length}function fSe(t){return 16}function mSe(t){if(!t)return 0;let e=_Se;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=pSe(r);break;case"number":e+=fSe();break;case"boolean":e+=4}}return e}function gSe(t){if(!t)return 0;if(Array.isArray(t))return Utt(t);let e=_Se;for(const i in t)t.hasOwnProperty(i)&&(e+=ySe(t[i]));return e}function Utt(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=vSe;for(let r=0;r<e;r++)i+=ySe(t[r]);return i}function ySe(t){switch(typeof t){case"object":return gSe(t);case"string":return pSe(t);case"number":return fSe();case"boolean":return 4;default:return 8}}function Cjt(t,e){return vSe+t.length*e}const _Se=32,vSe=32;var VA;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(VA||(VA={}));function bSe(t,e,i){return t.units[e][i]}function A3(t,e,i,r=2,s="abbr"){return`${_d(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${bSe(t,i,s)}`}function _V(t,e,i,r=2,s="abbr"){return`${_d(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${bSe(t,i,s)}`}function Mjt(t,e,i,r=2,s="abbr"){const n=kee(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Ajt(t,e,i,r=2,s="abbr"){const n=kee(e,i);return _V(t,Zr(e,i,n),n,r,s)}function Ojt(t,e,i,r=2,s="abbr"){const n=Vee(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Rjt(t,e,i,r=2,s="abbr"){const n=Vee(e,i);return _V(t,Zr(e,i,n),n,r,s)}function Pjt(t,e,i,r=2,s="abbr"){const n=zee(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Ijt(t,e,i,r=2,s="abbr"){const n=zee(e,i);return _V(t,Zr(e,i,n),n,r,s)}function $jt(t,e,i,r=2,s="abbr"){const n=Bee(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Ljt(t,e,i,r=2,s="abbr"){const n=Bee(e,i);return _V(t,Zr(e,i,n),n,r,s)}function Djt(t,e,i,r=2,s="abbr"){const n=Cqe(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Njt(t,e,i,r=2,s="abbr"){const n=Mqe(e,i);return A3(t,Zr(e,i,n),n,r,s)}function Fjt(t,e,i,r,s){s=vt(s,2);let n=oV.normalize(ktt(Zr(t,e,"degrees"),i,r),0,!0);const o={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s,minimumFractionDigits:s,signDisplay:n>0?"never":"exceptZero"};return n=wSe(n,o),_d(n,o)}function Ujt(t,e,i,r,s){i!==r&&(t=-t);const n={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s=vt(s,2),minimumFractionDigits:s,signDisplay:"exceptZero"};let o=Zr(t,e,"degrees")%360;return o=wSe(o,n),_d(o,n)}const Lce=new Map;function wSe(t,e){const i=JSON.stringify(e);let r=Lce.get(i);return r||(r=new Intl.NumberFormat("en-US",e),Lce.set(i,r)),/\-?\+?360/.test(r.format(t))?0:t}function ktt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":return Vtt(t);case"geographic":return ztt(t)}}function Vtt(t){return 90-t}function ztt(t){return-t-90}const Dce=["B","kB","MB","GB","TB"];function Btt(t,e){let i=e===0?0:Math.floor(Math.log(e)/Math.log(VA.KILOBYTES));i=Se(i,0,Dce.length-1);const r=_d(e/VA.KILOBYTES**i,{maximumFractionDigits:2});return wm(t.units.bytes[Dce[i]],{fileSize:r})}function Gtt(t){const{exifInfo:e,exifName:i,tagName:r}=t;if(!e||!i||!r)return null;const s=e.find(n=>n.name===i);return s?jtt({tagName:r,tags:s.tags}):null}function jtt(t){const{tagName:e,tags:i}=t;if(!i||!e)return null;const r=i.find(s=>s.name===e);return r&&r.value||null}var FY;const Htt={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Au=FY=class extends Ae{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=Gtt({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return Htt[e]||null}clone(){return new FY({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([p({type:String})],Au.prototype,"contentType",void 0),u([p()],Au.prototype,"exifInfo",void 0),u([p({readOnly:!0})],Au.prototype,"orientationInfo",null),u([p({type:Fr})],Au.prototype,"id",void 0),u([p({type:String})],Au.prototype,"globalId",void 0),u([p({type:String})],Au.prototype,"keywords",void 0),u([p({type:String})],Au.prototype,"name",void 0),u([p({json:{read:!1}})],Au.prototype,"parentGlobalId",void 0),u([p({json:{read:!1}})],Au.prototype,"parentObjectId",void 0),u([p({type:Fr})],Au.prototype,"size",void 0),u([p({json:{read:!1}})],Au.prototype,"url",void 0),Au=FY=u([N("esri.layers.support.AttachmentInfo")],Au);const qtt=Au;var UY;let Ya=UY=class extends Ae{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new UY(ue({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],Ya.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ya.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],Ya.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],Ya.prototype,"keywords",void 0),u([p({type:[Number],json:{write:!0}})],Ya.prototype,"globalIds",void 0),u([p({json:{write:!0}})],Ya.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ya.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],Ya.prototype,"objectIds",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ya.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],Ya.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Ya.prototype,"start",void 0),u([Xe("start"),Xe("num")],Ya.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ya.prototype,"where",void 0),Ya=UY=u([N("esri.rest.support.AttachmentQuery")],Ya),Ya.from=Vn(Ya);const UU=Ya,Wtt="esri.widgets.Feature.support.featureUtils",Nce=le.getLogger(Wtt),Ytt=/href=(""|'')/gi,Xtt=/(\{([^\{\r\n]+)\})/g,Ztt=/\'/g,xSe=/^\s*expression\//i,Jtt=/(\n)/gi,Ktt=/[\u00A0-\u9999<>\&]/gim,Qtt=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,eit=/^(?:mailto:|tel:)/,TSe="relationships/",kY=Hk("short-date-short-time");function SSe(t){if(!A(t))return t.get("sourceLayer")||t.get("layer")}async function kU(t,e){return typeof t=="function"?t.call(null,e):t}function ESe(t=""){if(t)return!eit.test(t.trim().toLowerCase())}function tie(t){return!!t&&xSe.test(t)}function tit(t,e){if(!tie(e)||!t)return null;const i=e.replace(xSe,"").toLowerCase();let r=null;return t.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function CSe(t,e){const i=tit(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function iit(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}function rit(t){return t.replace(Ytt,"")}function F$(t,e){const i=iie(e,t);return i?i.name:t}function sit(t,e){return t&&t.map(i=>F$(i,e))}function iie(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function MSe(t){return`${t}`.trim()}function i2({attributes:t,globalAttributes:e,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?VY({formattedAttributes:e,template:lit(r,{...e,...s,...t},i),fieldInfoMap:n}):""}function VY({formattedAttributes:t,template:e,fieldInfoMap:i}){return MSe(rit(wm(wm(e,r=>iit(r,i)),t)))}function nit(t,e,i=!1){const r=e[t];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(Ztt,s);e[t]=n}}function oit(t,e=!1){const i={...t};return Object.keys(i).forEach(r=>nit(r,i,e)),i}function ait(t,e,i){const r=(e=MSe(e))&&e[0]!=="{";return wm(t,oit(i,r||!1))}function zY(t,e){return t.replace(Xtt,(i,r,s)=>{const n=iie(e,s);return n?`{${n.name}}`:r})}function lit(t,e,i){const r=zY(t,i);return r&&r.replace(Qtt,(s,n,o)=>ait(s,n||o,e))}function cit(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function uit(t){return(t==null?void 0:t.type)==="feature"}function Fce(t){return!!(t!=null&&t.layer)}function hit(t){return(t==null?void 0:t.type)==="map-image"}function dit(t,e){var c;const i=e.fieldInfos,r=e.fieldName,s=(c=ASe(i,r))==null?void 0:c.clone(),n=e.preventPlacesFormatting,o=e.layer,a=iie(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new pM;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Fce(o)&&uit(o)&&o.datesInUnknownTimezone||Fce(o)&&hit(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof t=="string"&&wxe(r)&&l?l.formatRasterPixelValue(t):typeof(t=cit(t,l))=="string"||t==null||l==null?sD(t):n?_d(t,{...Exe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function ASe(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let r;return t.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function pit({fieldName:t,graphic:e,layer:i}){if(f_(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const s=i.getFeatureType(e);return s?s.name:null}function fit({fieldName:t,value:e,graphic:i,layer:r}){if(f_(t)||!r||typeof r.getFieldDomain!="function")return null;const s=i&&r.getFieldDomain(t,{feature:i});return s&&s.type==="coded-value"?s.getName(e):null}function mit(t,e){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=t;if(!e)return;const o=e[n];if(typeof o=="number"){const l=e[s];return{type:"edit",date:Ty(o,kY),user:l}}const a=e[r];if(typeof a=="number"){const l=e[i];return{type:"create",date:Ty(a,kY),user:l}}return null}function git(t,e){const i=new Map;return t&&t.forEach(r=>{const s=F$(r.fieldName,e);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function Uce(t){const e=[];if(!t)return e;const{fieldInfos:i,content:r}=t;return i&&e.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&e.push(...n)}}),e}function rie(t){return t.replace(Ktt,e=>`&#${e.charCodeAt(0)};`)}function sD(t){return typeof t=="string"?t.replace(Jtt,'<br class="esri-text-new-line" />'):t}function OSe(t){const{value:e,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=t;if(e==null)return"";const a=fit({fieldName:i,value:e,graphic:o,layer:n});if(a)return a;const l=pit({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return dit(e,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Ty(e,kY):sD(e)}function l7({fieldInfos:t,attributes:e,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>bit({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:t,layer:i})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=OSe({fieldName:a,fieldInfos:t,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function RSe(t,e){var h,d;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=t,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return Nce.warn(f,m),null}if(!((d=(h=Owe(i))==null?void 0:h.operations)!=null&&d.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Nce.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,e)).features[0]}async function yit(t){var r;if(!((r=t.expressionInfos)!=null&&r.length))return!1;const e=await Am(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function _it({graphic:t,popupTemplate:e,layer:i,spatialReference:r},s){if(!i||!e||(typeof i.load=="function"&&await i.load(s),!t.attributes))return;const n=t.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await e.getRequiredFields(i.fieldsIndex),l=eZe(a,t),c=l?[]:a,h=e.returnGeometry||await yit(e);if(l&&!h)return;const d=await RSe({layer:i,graphic:t,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);d&&(d.geometry&&(t.geometry=d.geometry),d.attributes&&(t.attributes={...t.attributes,...d.attributes}))}function f_(t=""){return!!t&&t.includes(TSe)}function vit(t){return t?`${TSe}${t.layerId}/${t.fieldName}`:""}function kce({attributes:t,graphic:e,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){t&&e&&i&&Object.keys(e.attributes).forEach(o=>{const a=vit({layerId:i.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=OSe({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:e})})}function bit({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(n=>kce({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(n=>kce({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s})))}const Vce=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},PSe=({layer:t,method:e,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const s=b(i.where)?i.where:null,n=b(i.geometry)?i.geometry:null;Vce(r)||Vce(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},wit=({query:t,layer:e,method:i})=>{PSe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},xit=({queryPayload:t,layer:e,method:i})=>{PSe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function Tit(t,e,i){return t&&e&&i?zce(t.allLayers,e,i)||zce(t.allTables,e,i):null}function zce(t,e,i){return t.find(r=>r!==e&&r.type==="feature"&&r.url===e.url&&r.layerId===i.relatedTableId)}const Bce={editing:!1,operations:{add:!0,update:!0,delete:!0}},ISe=xt.ofType(qtt);let Ou=class extends Ee{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Bce},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new ISe,this.fileInfos=new xt,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(ae(()=>this.graphic,()=>this._graphicChanged(),ii))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Bce,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new J("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),s=new UU({objectIds:[r],returnMetadata:!0}),n=[],o=e.queryAttachments(s).then(l=>l[r]||n).catch(()=>n);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return i.removeAll(),a.length&&i.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,i=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:s,abilities:n}=this;if(!i)throw new J("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new J("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new J("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new J("invalid-layer","addAttachment(): A valid layer is required.");const o=r.addAttachment(i,e).then(c=>this._queryAttachment(c.objectId,i)),a=await o;return s.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new J("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new J("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new J("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new J("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(s,[e.id]).then(()=>e),a=await o;return r.remove(a),a}async updateAttachment(e,i=this.activeAttachmentInfo){var h;const{_attachmentLayer:r,attachmentInfos:s,graphic:n,abilities:o}=this;if(!e)throw new J("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new J("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((h=o.operations)!=null&&h.update))throw new J("invalid-abilities","updateAttachment(): Update abilities are required.");const a=s.findIndex(d=>d===i);if(!r||typeof r.updateAttachment!="function")throw new J("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new J("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(n,i.id,e).then(d=>this._queryAttachment(d.objectId)),c=await l;return s.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const r={file:e,form:i};return this.fileInfos.add(r),r}updateFile(e,i,r=this.activeFileInfo){if(!e||!i||!r)return null;const s=this.fileInfos.findIndex(n=>r===n);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:i}),this.fileInfos.items[s]}deleteFile(e){const i=this.fileInfos.find(r=>r.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new J("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(i),n=new UU({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(n).then(o=>o[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=SSe(e);this._attachmentLayer=i?i.type==="scene"&&b(i.associatedLayer)?i.associatedLayer:i:null}};u([p()],Ou.prototype,"abilities",void 0),u([pi("abilities")],Ou.prototype,"castAbilities",null),u([p()],Ou.prototype,"activeAttachmentInfo",void 0),u([p()],Ou.prototype,"activeFileInfo",void 0),u([p({readOnly:!0,type:ISe})],Ou.prototype,"attachmentInfos",void 0),u([p()],Ou.prototype,"fileInfos",void 0),u([p({type:Ho})],Ou.prototype,"graphic",void 0),u([p()],Ou.prototype,"mode",void 0),u([p({readOnly:!0})],Ou.prototype,"state",null),u([p()],Ou.prototype,"filesEnabled",void 0),u([p({readOnly:!0})],Ou.prototype,"supportsResizeAttachments",null),Ou=u([N("esri.widgets.Attachments.AttachmentsViewModel")],Ou);const sie=Ou;function Gce(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function Sit(t){const e=Cr("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function za(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Eit=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},$Se=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?$Se(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=Eit(s)),e.push(s))}},Cit=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return $Se(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function ce(t,e,...i){return typeof t!="function"||eie(t)?Cit(t,e,...i):t(e,...i)}const jce={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Lr="esri-attachments",Pw="esri-button",ot={base:Lr,loaderContainer:`${Lr}__loader-container`,loader:`${Lr}__loader`,fadeIn:`${Lr}--fade-in`,container:`${Lr}__container`,containerList:`${Lr}__container--list`,containerPreview:`${Lr}__container--preview`,actions:`${Lr}__actions`,deleteButton:`${Lr}__delete-button`,addAttachmentButton:`${Lr}__add-attachment-button`,errorMessage:`${Lr}__error-message`,items:`${Lr}__items`,item:`${Lr}__item`,itemButton:`${Lr}__item-button`,itemMask:`${Lr}__item-mask`,itemMaskIcon:`${Lr}__item-mask--icon`,itemImage:`${Lr}__image`,itemImageResizable:`${Lr}__image--resizable`,itemLabel:`${Lr}__label`,itemFilename:`${Lr}__filename`,itemChevronIcon:`${Lr}__item-chevron-icon`,itemLink:`${Lr}__item-link`,itemLinkOverlay:`${Lr}__item-link-overlay`,itemLinkOverlayIcon:`${Lr}__item-link-overlay-icon`,itemEditIcon:`${Lr}__item-edit-icon`,itemAddIcon:`${Lr}__item-add-icon`,itemAddButton:`${Lr}__item-add-button`,formNode:`${Lr}__form-node`,fileFieldset:`${Lr}__file-fieldset`,fileLabel:`${Lr}__file-label`,fileName:`${Lr}__file-name`,fileInput:`${Lr}__file-input`,metadata:`${Lr}__metadata`,metadataFieldset:`${Lr}__metadata-fieldset`,progressBar:`${Lr}__progress-bar`,esriWidget:"esri-widget",esriButton:Pw,buttonDisabled:`${Pw}--disabled`,esriButtonSecondary:`${Pw}--secondary`,esriButtonTertiary:`${Pw}--tertiary`,esriButtonThird:`${Pw}--third`,esriButtonSmall:`${Pw}--small`,esriButtonHalf:`${Pw}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},c7=window.CSS;let rc=class extends hl{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...jce},this._supportsImageOrientation=c7&&c7.supports&&c7.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new sie),this.addHandles([Gs(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Gs(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),ii)])}loadDependencies(){return Promise.all([se(()=>import("./calcite-icon-ea823bcc.js"),["assets/calcite-icon-ea823bcc.js","assets/icon-ad2e5a3c.js","assets/observers-4f67f1fb.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...jce,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new J("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new J("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new J("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var r;const i=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:r}=i;return ce("div",{class:this.classes(ot.base,ot.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?ce("div",{key:"error-message",class:ot.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:r}=this.viewModel;return i==="add"?this.renderAddForm():i==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return ce("div",{class:ot.loaderContainer,key:"loader"},ce("div",{class:ot.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ce("div",{class:ot.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:i}=this,r=e||!i,s=this.visibleElements.cancelAddButton?ce("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(ot.esriButton,ot.esriButtonTertiary,ot.esriButtonSmall,ot.esriButtonHalf,e&&ot.buttonDisabled)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?ce("button",{type:"submit",disabled:r,class:this.classes(ot.esriButton,ot.esriButtonSecondary,ot.esriButtonSmall,ot.esriButtonHalf,{[ot.buttonDisabled]:r})},this.messages.add):null,o=i?ce("span",{key:"file-name",class:ot.fileName},i.name):null,a=ce("form",{bind:this,afterCreate:AU,afterRemoved:hce,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ce("fieldset",{class:ot.fileFieldset},o,ce("label",{class:this.classes(ot.fileLabel,ot.esriButton,ot.esriButtonSecondary)},i?this.messages.changeFile:this.messages.selectFile,ce("input",{class:ot.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return ce("div",{key:"add-form-container",class:ot.formNode},a)}renderDetailsForm(e){var C,R,O;const{visibleElements:i,viewModel:r,selectedFile:s,submitting:n}=this,{abilities:o}=r,a=n||!s;let l,c,h,d;s?(l=s.type,c=s.name,h=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,d=e.url);const f=o.editing&&((C=o.operations)!=null&&C.delete)&&i.deleteButton?ce("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:U=>this._submitDeleteAttachment(U,e),class:this.classes(ot.esriButton,ot.esriButtonSmall,ot.esriButtonTertiary,ot.deleteButton,{[ot.buttonDisabled]:n})},this.messages.delete):void 0,m=o.editing&&((R=o.operations)!=null&&R.update)&&i.updateButton?ce("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(ot.esriButton,ot.esriButtonSmall,ot.esriButtonThird,{[ot.buttonDisabled]:a})},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?ce("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(ot.esriButton,ot.esriButtonSmall,ot.esriButtonTertiary,ot.esriButtonThird,{[ot.buttonDisabled]:n})},this.messages.cancel):void 0,y=o.editing&&((O=o.operations)!=null&&O.update)?ce("fieldset",{key:"file",class:ot.fileFieldset},ce("span",{key:"file-name",class:ot.fileName},c),ce("label",{class:this.classes(ot.fileLabel,ot.esriButton,ot.esriButtonSecondary)},this.messages.changeFile,ce("input",{class:ot.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,v=ce("fieldset",{key:"size",class:ot.metadataFieldset},ce("label",null,Btt(this.messagesUnits,h??0))),x=ce("fieldset",{key:"content-type",class:ot.metadataFieldset},ce("label",null,l)),S=b(d)?ce("a",{class:ot.itemLink,href:d,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),ce("div",{class:ot.itemLinkOverlay},ce("span",{class:ot.itemLinkOverlayIcon},ce("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),E=ce("form",{bind:this,afterCreate:AU,afterRemoved:hce,"data-node-ref":"_updateAttachmentForm",onsubmit:U=>this._submitUpdateAttachment(U,e)},ce("div",{class:ot.metadata},v,x),y,ce("div",{class:ot.actions},f,g,m));return ce("div",{key:"edit-form-container",class:ot.formNode},S,E)}renderImageMask(e,i){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,i):null}renderGenericImageMask(e,i){const{supportsResizeAttachments:r}=this.viewModel,s=Sit(i),n={[ot.itemImageResizable]:r};return ce("div",{class:this.classes(ot.itemMaskIcon,ot.itemMask)},ce("img",{title:e,alt:e,src:s,class:this.classes(n,ot.itemImage)}))}renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:o}=e;if(!r||!Gce(s))return this.renderGenericImageMask(n,s);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,h={[ot.itemImageResizable]:r};return ce("div",{class:this.classes(ot.itemMask)},ce("img",{styles:l,alt:n,title:n,src:c,class:this.classes(h,ot.itemImage)}))}renderFile(e){const{file:i}=e;return ce("li",{class:ot.item,key:i},ce("button",{key:"details-button",bind:this,class:ot.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),ce("label",{class:ot.itemLabel},ce("span",{class:ot.itemFilename},i.name||this.messages.noTitle),ce("span",{"aria-hidden":"true",class:this.classes(ot.itemChevronIcon,ty(this.container)?ot.iconLeft:ot.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:r,effectiveDisplayType:s}=this,{abilities:n,supportsResizeAttachments:o}=r,{contentType:a,name:l,url:c}=e,h=this.renderImageMask(e,i==="list"?48:400),d=n.editing?ce("span",{"aria-hidden":"true",class:this.classes(ot.itemChevronIcon,ty(this.container)?ot.iconLeft:ot.iconRight)}):null,f=[h,s==="preview"&&o&&Gce(a)?null:ce("label",{class:ot.itemLabel},ce("span",{class:ot.itemFilename},l||this.messages.noTitle),d)],m=n.editing?ce("button",{key:"details-button",bind:this,class:ot.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},f):ce("a",{key:"details-link",class:ot.itemButton,href:c??void 0,target:"_blank"},f);return ce("li",{class:ot.item,key:e},m)}renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:i,visibleElements:r}=this,{attachmentInfos:s,abilities:n,fileInfos:o}=i,a=!!(s!=null&&s.length),l=!!(o!=null&&o.length),c={[ot.containerList]:e!=="preview",[ot.containerPreview]:e==="preview"},h=n.editing&&((g=n.operations)!=null&&g.add)&&r.addButton?ce("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(ot.esriButton,ot.esriButtonTertiary,ot.addAttachmentButton),type:"button"},ce("span",{"aria-hidden":"true",class:this.classes(ot.itemAddIcon,ot.iconPlus)}),this.messages.add):void 0,d=a?ce("ul",{key:"attachments-list",class:ot.items},s.toArray().map(y=>this.renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,f=l?ce("ul",{key:"file-list",class:ot.items},o.toArray().map(y=>this.renderFile(y))):void 0,m=l||a?void 0:ce("div",{class:ot.empty},this.messages.noAttachments);return ce("div",{key:"attachments-container",class:this.classes(ot.container,c)},d,f,m,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const i=e.target,r=i&&i.files&&i.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([p()],rc.prototype,"abilities",null),u([p()],rc.prototype,"displayType",void 0),u([p({readOnly:!0})],rc.prototype,"effectiveDisplayType",null),u([p()],rc.prototype,"graphic",null),u([p()],rc.prototype,"label",null),u([p(),za("esri/widgets/Attachments/t9n/Attachments")],rc.prototype,"messages",void 0),u([p(),za("esri/core/t9n/Units")],rc.prototype,"messagesUnits",void 0),u([p({readOnly:!0})],rc.prototype,"selectedFile",void 0),u([p({readOnly:!0})],rc.prototype,"submitting",void 0),u([p({readOnly:!0})],rc.prototype,"error",void 0),u([p({type:sie})],rc.prototype,"viewModel",void 0),u([p()],rc.prototype,"visibleElements",void 0),u([pi("visibleElements")],rc.prototype,"castVisibleElements",null),rc=u([N("esri.widgets.Attachments")],rc);const Mit=rc;let lP=class extends sie{constructor(e){super(e),this.description=null,this.title=null}};u([p()],lP.prototype,"description",void 0),u([p()],lP.prototype,"title",void 0),lP=u([N("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],lP);const nie=lP,Ait={heading:"esri-widget__heading"};function oie({level:t,class:e,...i},r){const s=Oit(t);return ce(`h${s}`,{...i,class:C2e(Ait.heading,e),role:"heading","aria-level":String(s)},r)}function Oit(t){return Se(Math.ceil(t),1,6)}const u7="esri-feature-element-info",h7={base:u7,title:`${u7}__title`,description:`${u7}__description`};let bC=class extends hl{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return ce("div",{class:h7.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ce(oie,{level:this.headingLevel,class:h7.title},e):null}renderDescription(){const{description:e}=this;return e?ce("div",{key:"description",class:h7.description},e):null}};u([p()],bC.prototype,"description",void 0),u([p()],bC.prototype,"headingLevel",void 0),u([p()],bC.prototype,"title",void 0),bC=u([N("esri.widgets.Feature.support.FeatureElementInfo")],bC);const vV=bC,Rit={base:"esri-feature-attachments"};let Eg=class extends hl{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new Mit,this.headingLevel=2,this.viewModel=new nie}initialize(){this._featureElementInfo=new vV,this.addHandles([ae(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),ii),ae(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,ii)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return ce("div",{class:Rit.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:i,headingLevel:r}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i,headingLevel:r})}};u([p({readOnly:!0})],Eg.prototype,"attachmentsWidget",void 0),u([p()],Eg.prototype,"description",null),u([p()],Eg.prototype,"displayType",null),u([p()],Eg.prototype,"graphic",null),u([p()],Eg.prototype,"headingLevel",void 0),u([p()],Eg.prototype,"title",null),u([p({type:nie})],Eg.prototype,"viewModel",void 0),Eg=u([N("esri.widgets.Feature.FeatureAttachments")],Eg);const Pit=Eg,Dm=t=>{let e=class extends t{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new ir}get updatingHandles(){return this._get("updatingHandles")||new dy}};return u([p({readOnly:!0})],e.prototype,"handles",null),u([p({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([N("esri.core.HandleOwner")],e),e};let Y2=class extends Dm(Ee){};Y2=u([N("esri.core.HandleOwner")],Y2);let w1=class extends Dm(Ee){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ae(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},ii))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:r}=this;e&&i&&(kU(r,{graphic:i}).catch(()=>null),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const r=kU(e,{graphic:i}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const s=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};u([p({readOnly:!0})],w1.prototype,"created",void 0),u([p()],w1.prototype,"creator",void 0),u([p()],w1.prototype,"destroyer",void 0),u([p({type:Ho})],w1.prototype,"graphic",void 0),u([p({readOnly:!0})],w1.prototype,"state",null),w1=u([N("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],w1);const VU=w1;function Yh(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:$it(t[e])}}}function Iit(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function $it(t){return function(e,...i){Iit(e)?YQe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function LSe(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:Lit(t);i.push(...r)}}function Lit(t){return t.split(",").map(e=>e.trim())}const DSe="calcite-mode-";function Dit(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function zU(){return Dit().startsWith("dark")}function Nit(){return`${DSe}${zU()?"dark":"light"}`}function Fit(t){Uit(t),t.classList.add(Nit())}function Uit(t){Array.from(t.classList).forEach(e=>{e.startsWith(DSe)&&t.classList.remove(e)})}function NSe(t){return t&&typeof t.render=="function"}function kit(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const d7="esri-feature-content",p7={base:d7,loaderContainer:`${d7}__loader-container`,loader:`${d7}__loader`};let wC=class extends hl{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(s=>{ESe(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return ce("div",{class:p7.loaderContainer,key:"loader"},ce("div",{class:p7.loader}))}renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?ce("div",{key:e,bind:e,afterCreate:this._attachToNode}):NSe(e)?ce("div",{key:e},!e.destroyed&&e.render()):ce("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return ce("div",{class:p7.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const i=this;e.appendChild(i)}};u([p()],wC.prototype,"creator",null),u([p()],wC.prototype,"graphic",null),u([p({type:VU})],wC.prototype,"viewModel",void 0),wC=u([N("esri.widgets.Feature.FeatureContent")],wC);const n6=wC;let E0=class extends Ee{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,r=[];return i==null||i.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=CSe(n,e),r.push(n)}),r}};u([p()],E0.prototype,"attributes",void 0),u([p({type:[$xe]})],E0.prototype,"expressionInfos",void 0),u([p()],E0.prototype,"description",void 0),u([p({type:[JL]})],E0.prototype,"fieldInfos",void 0),u([p({readOnly:!0})],E0.prototype,"formattedFieldInfos",null),u([p()],E0.prototype,"title",void 0),E0=u([N("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],E0);const bV=E0,Vit=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function zit(t){let e=null;return Vit.some(i=>(i.pattern.test(t)&&(e=i),!!e)),e}function Bit(t,e){if(typeof e!="string"||!e)return e;const i=zit(e);if(!i)return e;const r=e.match(i.pattern),s=r&&r[2],n=wm(wm(i.label,{messages:t,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const $N="esri-feature-fields",RO={base:$N,fieldHeader:`${$N}__field-header`,fieldData:`${$N}__field-data`,fieldDataDate:`${$N}__field-data--date`,esriTable:"esri-widget__table"};let xf=class extends hl{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new bV,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new vV,this.addHandles(ae(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),ii))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,i){const{attributes:r}=this.viewModel,s=e.fieldName,n=e.label||s,o=r?r[s]==null?"":r[s]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):Bit(this.messagesURIUtils,o),c={[RO.fieldDataDate]:a};return ce("tr",{key:`fields-element-info-row-${s}-${i}`},ce("th",{key:`fields-element-info-row-header-${s}-${i}`,class:RO.fieldHeader,innerHTML:n}),ce("td",{key:`fields-element-info-row-data-${s}-${i}`,class:this.classes(RO.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ce("table",{class:RO.esriTable,summary:this.messages.fieldsSummary},ce("tbody",null,e.map((i,r)=>this.renderFieldInfo(i,r)))):null}render(){var e;return ce("div",{class:RO.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};u([p()],xf.prototype,"attributes",null),u([p()],xf.prototype,"description",null),u([p()],xf.prototype,"expressionInfos",null),u([p()],xf.prototype,"fieldInfos",null),u([p()],xf.prototype,"title",null),u([p({type:bV,nonNullable:!0})],xf.prototype,"viewModel",void 0),u([p(),za("esri/widgets/Feature/t9n/Feature")],xf.prototype,"messages",void 0),u([p(),za("esri/widgets/support/t9n/uriUtils")],xf.prototype,"messagesURIUtils",void 0),xf=u([N("esri.widgets.Feature.FeatureFields")],xf);const FSe=xf,Git={maximumFractionDigits:20};function jit(t){return _d(t,Git)}var BY;let Ux=BY=class extends Ae{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new BY({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:et,json:{type:[Fr],write:!0}})],Ux.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Ux.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Ux.prototype,"value",void 0),u([Xe("value")],Ux.prototype,"writeValue",null),Ux=BY=u([N("esri.renderers.visualVariables.support.ColorStop")],Ux);const Hit=Ux;function nD(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function qit(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Wit(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=m,v[14]=g,v[15]=y,v}function Yit(t,e){return new Float32Array(t,e,16)}const Xit=nD();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Xit,clone:qit,create:nD,createView:Yit,fromValues:Wit},Symbol.toStringTag,{value:"Module"}));const Zit=(t,e)=>{const i=Fy(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return hh(i,i)},Jit=(t,e)=>{const i=Fy(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return hh(i,i)},Kit=(t,e)=>{const i=1-e,r=Fy(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return hh(r,r)},Qit=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=Fy(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return hh(s,s)},ert=(t,e)=>{const i=1-2*e,r=Fy(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return hh(r,r)},trt=(t,e)=>{const i=Fy(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return hh(i,i)},irt=(t,e)=>{const i=1-e,r=Fy(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return hh(r,r)};let USe=class kSe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Wu(e.strength,i.strength,r),this.radius=Wu(e.radius,i.radius,r),this.threshold=Wu(e.threshold,i.threshold,r)}clone(){return new kSe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:AI(this.radius),strength:this.strength,threshold:this.threshold}}},VSe=class zSe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Wu(e.radius,i.radius,r))}clone(){return new zSe(this.radius)}toJSON(){return{type:"blur",radius:AI(this.radius)}}},GY=class BSe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Wu(e.amount,i.amount,r),this._updateMatrix()}clone(){return new BSe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||nD();switch(this.type){case"brightness":this._colorMatrix=Zit(e,this.amount);break;case"contrast":this._colorMatrix=Jit(e,this.amount);break;case"grayscale":this._colorMatrix=Kit(e,this.amount);break;case"invert":this._colorMatrix=ert(e,this.amount);break;case"saturate":this._colorMatrix=trt(e,this.amount);break;case"sepia":this._colorMatrix=irt(e,this.amount)}}},GSe=class jSe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Wu(e.offsetX,i.offsetX,r),this.offsetY=Wu(e.offsetY,i.offsetY,r),this.blurRadius=Wu(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Wu(e.color[0],i.color[0],r)),this.color[1]=Math.round(Wu(e.color[1],i.color[1],r)),this.color[2]=Math.round(Wu(e.color[2],i.color[2],r)),this.color[3]=Wu(e.color[3],i.color[3],r)}clone(){return new jSe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:AI(this.offsetX),yoffset:AI(this.offsetY),blurRadius:AI(this.blurRadius),color:e}}},HSe=class qSe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Wu(e.angle,i.angle,r),this._updateMatrix()}clone(){return new qSe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||nD();this._colorMatrix=Qit(e,this.angle)}},WSe=class YSe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Wu(e.amount,i.amount,r)}clone(){return new YSe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Wu(t,e,i){return t+(e-t)*i}function AI(t){return Math.round(1e3*Up(t))/1e3}function rrt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new GY(t.type,0);case"saturate":case"brightness":case"contrast":return new GY(t.type,1);case"opacity":return new WSe(1);case"hue-rotate":return new HSe(0);case"blur":return new VSe(0);case"drop-shadow":return new GSe(0,0,0,[...Wee("transparent")]);case"bloom":return new USe(0,0,1)}}function srt(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function nrt(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(rrt(i[s]))}function ort(t){const e=t[0];return!!e&&"type"in e}var Hce,qce,jY={};function XSe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Wce(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new J("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Wce(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!srt(e[i].effects,e[i+1].effects))throw new J("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});nrt(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Wce(t){let e;if(!t)return[];try{e=jY.parse(t)}catch(i){throw new J("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>art(i))}function art(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return lrt(t);case"opacity":return crt(t);case"hue-rotate":return urt(t);case"blur":return hrt(t);case"drop-shadow":return drt(t);case"bloom":return prt(t)}}catch(e){throw e.details.filter=t,e}throw new J("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function lrt(t){let e=1;return O3(t.parameters,1),t.parameters.length===1&&(e=Yf(t.parameters[0])),new GY(t.name,e)}function crt(t){let e=1;return O3(t.parameters,1),t.parameters.length===1&&(e=Yf(t.parameters[0])),new WSe(e)}function urt(t){let e=0;return O3(t.parameters,1),t.parameters.length===1&&(e=vrt(t.parameters[0])),new HSe(e)}function hrt(t){let e=0;return O3(t.parameters,1),t.parameters.length===1&&(e=cie(t.parameters[0]),oD(e,t.parameters[0])),new VSe(e)}function drt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new J("effect:type-error","Accepts only one color",{});i=brt(r)}else{const s=cie(r);if(Object.isFrozen(e))throw new J("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&oD(s,r)}if(e.length<2||e.length>3)throw new J("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new GSe(e[0],e[1],e[2]||0,i||ZSe("black"))}function prt(t){let e=1,i=0,r=0;return O3(t.parameters,3),t.parameters[0]&&(e=Yf(t.parameters[0])),t.parameters[1]&&(i=cie(t.parameters[1]),oD(i,t.parameters[1])),t.parameters[2]&&(r=Yf(t.parameters[2])),new USe(e,i,r)}function O3(t,e){if(t.length>e)throw new J("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function wV(t){if(t.type==="color")return"<color>";if(t.unit){if(lie[t.unit])return"<length>";if(aie[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function oD(t,e){if(t<0)throw new J("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function frt(t){if(t.type!=="quantity"||t.unit!==null)throw new J("effect:type-error",`Expected <double>, Actual: ${wV(t)}`,{term:t})}function mrt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new J("effect:type-error",`Expected <double> or <percentage>, Actual: ${wV(t)}`,{term:t})}qce=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Md},h=Md,d="none",f=")",m=",",g="(",y="%",v="px",x="cm",S="mm",E="in",C="pt",R="pc",O="deg",U="rad",L="grad",B="turn",G="#",j=".",q="e",ie=/^[ \t\n\r]/,ee=/^[a-z\-]/,K=/^[0-9a-fA-F]/,Y=/^[+\-]/,D=/^[0-9]/,V=fl("none"),k=Ts("none",!1),Z=Ts(")",!1),Q=Ts(",",!1),ne=fl("whitespace"),te=jy([" ","	",`
`,"\r"],!1,!1),de=fl("function"),_e=Ts("(",!1),Ce=fl("identifier"),Pe=jy([["a","z"],"-"],!1,!1),Ze=fl("percentage"),Le=Ts("%",!1),Me=fl("length"),qe=Ts("px",!1),We=Ts("cm",!1),$t=Ts("mm",!1),ut=Ts("in",!1),Qt=Ts("pt",!1),ai=Ts("pc",!1),ui=fl("angle"),li=Ts("deg",!1),Ri=Ts("rad",!1),pr=Ts("grad",!1),Gi=Ts("turn",!1),Fi=fl("number"),pt=fl("color"),lt=Ts("#",!1),wt=jy([["0","9"],["a","f"],["A","F"]],!1,!1),Tt=jy(["+","-"],!1,!1),Lt=jy([["0","9"]],!1,!1),oi=Ts(".",!1),qi=Ts("e",!1),Wi=function(){return[]},Yi=function(re,Oe){return{type:"function",name:re,parameters:Oe||[]}},Xi=function(re,Oe){return Oe.length>0?Aw(re,Oe,3):[re]},Gr=function(re){return{type:"quantity",value:re.value,unit:re.unit}},mi=function(re){return{type:"color",colorType:re.type,value:re.value}},Li=function(re){return re},Pi=function(){return Wl()},Ws=function(re){return{value:re,unit:"%"}},vr=function(re){return{value:re,unit:"px"}},ds=function(re){return{value:re,unit:"cm"}},jr=function(re){return{value:re,unit:"mm"}},rs=function(re){return{value:re,unit:"in"}},xs=function(re){return{value:re,unit:"pt"}},rn=function(re){return{value:re,unit:"pc"}},Oo=function(re){return{value:re,unit:"deg"}},ro=function(re){return{value:re,unit:"rad"}},Ys=function(re){return{value:re,unit:"grad"}},ss=function(re){return{value:re,unit:"turn"}},ps=function(re){return{value:re,unit:null}},$s=function(){return{type:"hex",value:Wl()}},Sr=function(re){return{type:"function",value:re}},Wo=function(){return{type:"named",value:Wl()}},dl=function(){return parseFloat(Wl())},ve=0,Ir=0,bh=[{line:1,column:1}],Ro=0,pl=[],St=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Wl(){return s.substring(Ir,ve)}function Ts(re,Oe){return{type:"literal",text:re,ignoreCase:Oe}}function jy(re,Oe,Fe){return{type:"class",parts:re,inverted:Oe,ignoreCase:Fe}}function dO(){return{type:"end"}}function fl(re){return{type:"other",description:re}}function Bm(re){var Oe,Fe=bh[re];if(Fe)return Fe;for(Oe=re-1;!bh[Oe];)Oe--;for(Fe={line:(Fe=bh[Oe]).line,column:Fe.column};Oe<re;)s.charCodeAt(Oe)===10?(Fe.line++,Fe.column=1):Fe.column++,Oe++;return bh[re]=Fe,Fe}function Cd(re,Oe){var Fe=Bm(re),Ei=Bm(Oe);return{source:l,start:{offset:re,line:Fe.line,column:Fe.column},end:{offset:Oe,line:Ei.line,column:Ei.column}}}function hi(re){ve<Ro||(ve>Ro&&(Ro=ve,pl=[]),pl.push(re))}function Mw(re,Oe,Fe){return new e(e.buildMessage(re,Oe),re,Oe,Fe)}function Md(){var re;return(re=Gm())===a&&(re=jm()),re}function Gm(){var re,Oe;return St++,re=ve,Er(),s.substr(ve,4)===d?(Oe=d,ve+=4):(Oe=a,St===0&&hi(k)),Oe!==a?(Er(),Ir=re,re=Wi()):(ve=re,re=a),St--,re===a&&St===0&&hi(V),re}function jm(){var re,Oe;if(re=[],(Oe=Yo())!==a)for(;Oe!==a;)re.push(Oe),Oe=Yo();else re=a;return re}function Yo(){var re,Oe,Fe,Ei;return re=ve,Er(),(Oe=Ad())!==a?(Er(),(Fe=yu())===a&&(Fe=null),Er(),s.charCodeAt(ve)===41?(Ei=f,ve++):(Ei=a,St===0&&hi(Z)),Ei!==a?(Er(),Ir=re,re=Yi(Oe,Fe)):(ve=re,re=a)):(ve=re,re=a),re}function yu(){var re,Oe,Fe,Ei,so,Xs,gl,qm;if(re=ve,(Oe=_u())!==a){for(Fe=[],Ei=ve,so=Er(),s.charCodeAt(ve)===44?(Xs=m,ve++):(Xs=a,St===0&&hi(Q)),Xs===a&&(Xs=null),gl=Er(),(qm=_u())!==a?Ei=so=[so,Xs,gl,qm]:(ve=Ei,Ei=a);Ei!==a;)Fe.push(Ei),Ei=ve,so=Er(),s.charCodeAt(ve)===44?(Xs=m,ve++):(Xs=a,St===0&&hi(Q)),Xs===a&&(Xs=null),gl=Er(),(qm=_u())!==a?Ei=so=[so,Xs,gl,qm]:(ve=Ei,Ei=a);Ir=re,re=Xi(Oe,Fe)}else ve=re,re=a;return re}function _u(){var re,Oe;return re=ve,(Oe=yv())===a&&(Oe=Hy())===a&&(Oe=_v())===a&&(Oe=qy()),Oe!==a&&(Ir=re,Oe=Gr(Oe)),(re=Oe)===a&&(re=ve,(Oe=Hm())!==a&&(Ir=re,Oe=mi(Oe)),re=Oe),re}function Er(){var re,Oe;for(St++,re=[],ie.test(s.charAt(ve))?(Oe=s.charAt(ve),ve++):(Oe=a,St===0&&hi(te));Oe!==a;)re.push(Oe),ie.test(s.charAt(ve))?(Oe=s.charAt(ve),ve++):(Oe=a,St===0&&hi(te));return St--,Oe=a,St===0&&hi(ne),re}function Ad(){var re,Oe,Fe;return St++,re=ve,(Oe=rf())!==a?(s.charCodeAt(ve)===40?(Fe=g,ve++):(Fe=a,St===0&&hi(_e)),Fe!==a?(Ir=re,re=Li(Oe)):(ve=re,re=a)):(ve=re,re=a),St--,re===a&&(Oe=a,St===0&&hi(de)),re}function rf(){var re,Oe,Fe;if(St++,re=ve,Oe=[],ee.test(s.charAt(ve))?(Fe=s.charAt(ve),ve++):(Fe=a,St===0&&hi(Pe)),Fe!==a)for(;Fe!==a;)Oe.push(Fe),ee.test(s.charAt(ve))?(Fe=s.charAt(ve),ve++):(Fe=a,St===0&&hi(Pe));else Oe=a;return Oe!==a&&(Ir=re,Oe=Pi()),St--,(re=Oe)===a&&(Oe=a,St===0&&hi(Ce)),re}function yv(){var re,Oe,Fe;return St++,re=ve,Er(),(Oe=ml())!==a?(s.charCodeAt(ve)===37?(Fe=y,ve++):(Fe=a,St===0&&hi(Le)),Fe!==a?(Ir=re,re=Ws(Oe)):(ve=re,re=a)):(ve=re,re=a),St--,re===a&&St===0&&hi(Ze),re}function Hy(){var re,Oe,Fe;return St++,re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===v?(Fe=v,ve+=2):(Fe=a,St===0&&hi(qe)),Fe!==a?(Ir=re,re=vr(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===x?(Fe=x,ve+=2):(Fe=a,St===0&&hi(We)),Fe!==a?(Ir=re,re=ds(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===S?(Fe=S,ve+=2):(Fe=a,St===0&&hi($t)),Fe!==a?(Ir=re,re=jr(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===E?(Fe=E,ve+=2):(Fe=a,St===0&&hi(ut)),Fe!==a?(Ir=re,re=rs(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===C?(Fe=C,ve+=2):(Fe=a,St===0&&hi(Qt)),Fe!==a?(Ir=re,re=xs(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,Er(),(Oe=ml())!==a?(s.substr(ve,2)===R?(Fe=R,ve+=2):(Fe=a,St===0&&hi(ai)),Fe!==a?(Ir=re,re=rn(Oe)):(ve=re,re=a)):(ve=re,re=a)))))),St--,re===a&&St===0&&hi(Me),re}function _v(){var re,Oe,Fe;return St++,re=ve,(Oe=ml())!==a?(s.substr(ve,3)===O?(Fe=O,ve+=3):(Fe=a,St===0&&hi(li)),Fe!==a?(Ir=re,re=Oo(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,(Oe=ml())!==a?(s.substr(ve,3)===U?(Fe=U,ve+=3):(Fe=a,St===0&&hi(Ri)),Fe!==a?(Ir=re,re=ro(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,(Oe=ml())!==a?(s.substr(ve,4)===L?(Fe=L,ve+=4):(Fe=a,St===0&&hi(pr)),Fe!==a?(Ir=re,re=Ys(Oe)):(ve=re,re=a)):(ve=re,re=a),re===a&&(re=ve,(Oe=ml())!==a?(s.substr(ve,4)===B?(Fe=B,ve+=4):(Fe=a,St===0&&hi(Gi)),Fe!==a?(Ir=re,re=ss(Oe)):(ve=re,re=a)):(ve=re,re=a)))),St--,re===a&&(Oe=a,St===0&&hi(ui)),re}function qy(){var re,Oe;return St++,re=ve,Er(),(Oe=ml())!==a?(Ir=re,re=ps(Oe)):(ve=re,re=a),St--,re===a&&St===0&&hi(Fi),re}function Hm(){var re,Oe,Fe,Ei;if(St++,re=ve,s.charCodeAt(ve)===35?(Oe=G,ve++):(Oe=a,St===0&&hi(lt)),Oe!==a){if(Fe=[],K.test(s.charAt(ve))?(Ei=s.charAt(ve),ve++):(Ei=a,St===0&&hi(wt)),Ei!==a)for(;Ei!==a;)Fe.push(Ei),K.test(s.charAt(ve))?(Ei=s.charAt(ve),ve++):(Ei=a,St===0&&hi(wt));else Fe=a;Fe!==a?(Ir=re,re=$s()):(ve=re,re=a)}else ve=re,re=a;return re===a&&(re=ve,(Oe=Yo())!==a&&(Ir=re,Oe=Sr(Oe)),(re=Oe)===a&&(re=ve,(Oe=rf())!==a&&(Ir=re,Oe=Wo()),re=Oe)),St--,re===a&&(Oe=a,St===0&&hi(pt)),re}function ml(){var re,Oe,Fe,Ei,so,Xs,gl;for(re=ve,Y.test(s.charAt(ve))?(s.charAt(ve),ve++):St===0&&hi(Tt),Oe=ve,Fe=[],D.test(s.charAt(ve))?(Ei=s.charAt(ve),ve++):(Ei=a,St===0&&hi(Lt));Ei!==a;)Fe.push(Ei),D.test(s.charAt(ve))?(Ei=s.charAt(ve),ve++):(Ei=a,St===0&&hi(Lt));if(s.charCodeAt(ve)===46?(Ei=j,ve++):(Ei=a,St===0&&hi(oi)),Ei!==a){if(so=[],D.test(s.charAt(ve))?(Xs=s.charAt(ve),ve++):(Xs=a,St===0&&hi(Lt)),Xs!==a)for(;Xs!==a;)so.push(Xs),D.test(s.charAt(ve))?(Xs=s.charAt(ve),ve++):(Xs=a,St===0&&hi(Lt));else so=a;so!==a?Oe=Fe=[Fe,Ei,so]:(ve=Oe,Oe=a)}else ve=Oe,Oe=a;if(Oe===a)if(Oe=[],D.test(s.charAt(ve))?(Fe=s.charAt(ve),ve++):(Fe=a,St===0&&hi(Lt)),Fe!==a)for(;Fe!==a;)Oe.push(Fe),D.test(s.charAt(ve))?(Fe=s.charAt(ve),ve++):(Fe=a,St===0&&hi(Lt));else Oe=a;if(Oe!==a){if(Fe=ve,s.charCodeAt(ve)===101?(Ei=q,ve++):(Ei=a,St===0&&hi(qi)),Ei!==a){if(Y.test(s.charAt(ve))?(so=s.charAt(ve),ve++):(so=a,St===0&&hi(Tt)),so===a&&(so=null),Xs=[],D.test(s.charAt(ve))?(gl=s.charAt(ve),ve++):(gl=a,St===0&&hi(Lt)),gl!==a)for(;gl!==a;)Xs.push(gl),D.test(s.charAt(ve))?(gl=s.charAt(ve),ve++):(gl=a,St===0&&hi(Lt));else Xs=a;Xs!==a?Fe=Ei=[Ei,so,Xs]:(ve=Fe,Fe=a)}else ve=Fe,Fe=a;Fe===a&&(Fe=null),Ir=re,re=dl()}else ve=re,re=a;return re}function US(re,Oe){return re.map(function(Fe){return Fe[Oe]})}function Aw(re,Oe,Fe){return[re].concat(US(Oe,Fe))}if((o=h())!==a&&ve===s.length)return o;throw o!==a&&ve<s.length&&hi(dO()),Mw(pl,Ro<s.length?s.charAt(Ro):null,Ro<s.length?Cd(Ro,Ro+1):Cd(Ro,Ro))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,d=i("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+d+` |
`+l.line+" | "+f+`
`+d+" | "+i("",l.column-1," ")+i("",m,"^")}else n+=`
 at `+c}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function d(m){var g,y,v=m.map(h);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:r}},(Hce={get exports(){return jY},set exports(t){jY=t}}).exports&&(Hce.exports=qce());const aie={deg:1,grad:.9,rad:180/Math.PI,turn:360};function grt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&aie[t.unit]!=null))throw new J("effect:type-error",`Expected <angle>, Actual: ${wV(t)}`,{term:t})}const lie={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function yrt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&lie[t.unit]!=null))throw new J("effect:type-error",`Expected <length>, Actual: ${wV(t)}`,{term:t})}function Yf(t){mrt(t);const e=t.value;return oD(e,t),t.unit==="%"?.01*e:e}function _rt(t){return frt(t),oD(t.value,t),t.value}function vrt(t){return grt(t),t.value*aie[t.unit]||0}function cie(t){return yrt(t),t.value*lie[t.unit]||0}function brt(t){switch(t.colorType){case"hex":return JWe(t.value);case"named":return ZSe(t.value);case"function":return Trt(t.value)}}function ZSe(t){if(!Pwe(t))throw new J("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return ZWe(t)}const wrt=/^rgba?/i,xrt=/^hsla?/i;function Trt(t){if(O3(t.parameters,4),wrt.test(t.name))return[Yf(t.parameters[0]),Yf(t.parameters[1]),Yf(t.parameters[2]),t.parameters[3]?Yf(t.parameters[3]):1];if(xrt.test(t.name))return Iwe(_rt(t.parameters[0]),Yf(t.parameters[1]),Yf(t.parameters[2]),t.parameters[3]?Yf(t.parameters[3]):1);throw new J("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function uie(t,e,i){var r;try{return Ert(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function hie(t,e,i,r){try{const s=Srt(t);Tc(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function Srt(t){const e=XSe(t);return e?ort(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function Ert(t){if(!t||t.length===0)return null;if(Crt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Yce(i.value)});return e}return Yce(t)}function Crt(t){const e=t[0];return!!e&&"scale"in e}function Yce(t){if(!t||!t.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Jy(i,"amount")];break;case"blur":r=[Jy(i,"radius","pt")];break;case"hue-rotate":r=[Jy(i,"angle","deg")];break;case"drop-shadow":r=[Jy(i,"xoffset","pt"),Jy(i,"yoffset","pt"),Jy(i,"blurRadius","pt"),Mrt(i,"color")];break;case"bloom":r=[Jy(i,"strength"),Jy(i,"radius","pt"),Jy(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;XSe(s),e.push(s)}return e.join(" ")}function Jy(t,e,i){if(t[e]==null)throw new J("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function Mrt(t,e){if(t[e]==null)throw new J("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const o6=-3;var t_;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(t_||(t_={}));let Art=class{constructor(e,i,r){this._namespace=e,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this._namespace+e,i,r,s)}get(e){const i=this._storage.get(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}pop(e){const i=this._storage.pop(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this._namespace+e,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},die=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new vi,this._users=new vi}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,i,r,s){const n=this._db.get(e);if(n&&(this._size-=n.size,this._db.delete(e),n.entry!==i&&this._notifyRemove(e,n.entry,t_.ALL)),r>this._maxSize)return void this._notifyRemove(e,i,t_.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,o6)-o6;this._db.set(e,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(e,i,r){const s=this._db.get(e);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(e,i,t_.SOME);if(!(b(n)&&n>0))return void this._db.delete(e);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(e){const i=this._db.get(e);if(i)return this._size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(e){const i=this._db.get(e);if(i!==void 0)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const d=i[h]||0;i[h]=d+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+o6-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((i,r)=>{r.startsWith(e)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,t_.ALL))})}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,t_.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,i]of this._db){if(this._db.delete(e),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(e,i.entry,t_.SOME);b(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(e,i))}else--i.lives,this._db.set(e,i);if(this._size<=.9*this.maxSize)return}}},HY=class{constructor(e,i){this._storage=new die,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i){this._storage.put(e,i,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new HY(1e3);new et([128,128,128]);const Ort=new et("white");function Kjt(t){if(A(t)||!("symbolLayers"in t)||A(t.symbolLayers))return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function Rrt(t){return Ol(t.resource).href}function VS(t,e){if(!t)return null;let i=null;return B2(t)?i=Prt(t):sV(t)&&(i=t.color?new et(t.color):null),i?U$(i,e):null}function Prt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var s;r.type==="object"&&((s=r.resource)==null?void 0:s.href)!=null||(i=r.type==="water"?r.color:b(r.material)?r.material.color:null)}),i?new et(i):null}function U$(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new et(i)}function Irt(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>{const o=b(n)?n:null;return U$(e=e??o??(i!=null?Ort:null),i)};r.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||e)if(n.type==="water")n.color=s(n.color);else{const a=b(n.material)?n.material.color:null,l=s(a);A(n.material)?n.material=new fd({color:l}):n.material.color=l,i!=null&&"outline"in n&&b(n.outline)&&b(n.outline.color)&&(n.outline.color=U$(n.outline.color,i))}})}function $rt(t,e,i){(e=e??t.color)&&(t.color=U$(e,i)),i!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=U$(t.outline.color,i))}function f7(t,e,i){t&&(e||i!=null)&&(e&&(e=new et(e)),B2(t)?Irt(t,e,i):sV(t)&&$rt(t,e,i))}async function Lrt(t,e){const i=t.symbolLayers;i&&await $k(i,async r=>Drt(r,e))}async function Drt(t,e){switch(t.type){case"extrude":Frt(t,e);break;case"icon":case"line":case"text":Nrt(t,e);break;case"path":krt(t,e);break;case"object":await Urt(t,e)}}function Nrt(t,e){const i=JSe(e);b(i)&&(t.size=i)}function JSe(t){for(const e of t)if(typeof e=="number")return e;return null}function Frt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Urt(t,e){const{resourceSize:i,symbolSize:r}=await Vrt(t),s=KSe(e,i,r);t.width=OI(e[0],r[0],i[0],s),t.depth=OI(e[1],r[1],i[1],s),t.height=OI(e[2],r[2],i[2],s)}function krt(t,e){const i=KSe(e,ey,[t.width,void 0,t.height]);t.width=OI(e[0],t.width,1,i),t.height=OI(e[2],t.height,1,i)}function KSe(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function Vrt(t){const e=await se(()=>import("./symbolLayerUtils-57b44d85.js"),[]),i=await e.computeObjectLayerResourceSize(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function OI(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function zrt(t,e){const i=JSe(e);if(!A(i))switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function Brt(t,e){if(t&&e)return B2(t)?Lrt(t,e):void(sV(t)&&zrt(t,e))}function Grt(t,e,i){if(t&&e!=null)if(B2(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else sV(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function Qjt(t){return b(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function jrt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Hrt="<",qrt=">",Wrt=Hk("short-date");function Yrt(t,e,i,r){let s="";e===0?s=`${Hrt} `:e===i&&(s=`${qrt} `);let n=null;return n=r?Ty(t,Wrt):jit(t),s+n}const Xrt=new et([64,64,64]);function Zrt(t,e){const i=[],r=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,r),t.map((s,n)=>i.includes(n)?Yrt(s,n,r,e):null)}async function Jrt(t,e,i){let r=!1,s=[],n=[];if(t.stops){const c=t.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:Zrt(s,i??!1);return(await Promise.all(s.map(async(c,h)=>({value:c,color:t.type==="opacity"?await Krt(c,t,e):(await se(()=>Promise.resolve().then(()=>Aie),void 0)).getColor(t,c),label:r?n[h]:(l==null?void 0:l[h])??""})))).reverse()}async function Krt(t,e,i=Xrt){const r=new et(i),s=(await se(()=>Promise.resolve().then(()=>Aie),void 0)).getOpacity(e,t);return s!=null&&(r.a=s),r}var qY;let cP=qY=class extends Ae{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new qY({color:this.color,ratio:this.ratio})}};u([p({type:et,json:{type:[Fr],default:null,write:!0}})],cP.prototype,"color",void 0),u([p({type:Number,json:{write:!0}})],cP.prototype,"ratio",void 0),cP=qY=u([N("esri.renderers.support.HeatmapColorStop")],cP);const RI=cP;function Qrt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=e.length-1;if(e&&e[0]){const r=e[i];r&&r.ratio!==1&&(e.push(new RI({ratio:1,color:r.color})),i++)}return e.map((r,s)=>{var o,a;let n="";return s===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}le.getLogger("esri.renderers.support.utils");async function wh(t,e,i){fee(t,e,()=>[]).push(...i)}async function est(t){var i,r;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=(await Jrt(n)??[]).map(a=>a.color);await wh(e,n.field||n.valueExpression,o)}}if(t.type==="heatmap"){const s=Qrt(t).map(n=>n.color);await wh(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await wh(e,s.field||s.valueExpression,[s.color]);await wh(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,VS(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await wh(e,s.field||s.valueExpression,[s.color]);await wh(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((r=t.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of t.uniqueValueInfos??[])await wh(e,s.value.toString(),[VS(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(c=>VS(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=t;(n||l)&&await wh(e,n||l,s),o&&await wh(e,o,s),a&&await wh(e,a,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(a=>VS(a.symbol,null)),{field:n,valueExpression:o}=t;await wh(e,n??o,s)}else t.type==="simple"&&await wh(e,"default",[VS(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await wh(e,"default",[VS(t.defaultSymbol,null)]),e.forEach((s,n)=>{const o=NL(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(n,o)}),e}var WY;let uP=WY=class extends Ae{constructor(t){super(t),this.name=null,this.code=null}clone(){return new WY({name:this.name,code:this.code})}};u([p({type:String,json:{write:!0}})],uP.prototype,"name",void 0),u([p({type:[String,Number],json:{write:!0}})],uP.prototype,"code",void 0),uP=WY=u([N("esri.layers.support.CodedValue")],uP);const tst=new Hi({inherited:"inherited",codedValue:"coded-value",range:"range"});let hP=class extends Ae{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],hP.prototype,"name",void 0),u([It(tst)],hP.prototype,"type",void 0),hP=u([N("esri.layers.support.Domain")],hP);const xV=hP;var YY;let dP=YY=class extends xV{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new YY({codedValues:ue(this.codedValues),name:this.name})}};u([p({type:[uP],json:{write:!0}})],dP.prototype,"codedValues",void 0),u([It({codedValue:"coded-value"})],dP.prototype,"type",void 0),dP=YY=u([N("esri.layers.support.CodedValueDomain")],dP);const QSe=dP;var XY;let a6=XY=class extends xV{constructor(t){super(t),this.type="inherited"}clone(){return new XY}};u([It({inherited:"inherited"})],a6.prototype,"type",void 0),a6=XY=u([N("esri.layers.support.InheritedDomain")],a6);const eEe=a6;var ZY;let xC=ZY=class extends xV{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new ZY({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],xC.prototype,"maxValue",void 0),u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],xC.prototype,"minValue",void 0),u([It({range:"range"})],xC.prototype,"type",void 0),xC=ZY=u([N("esri.layers.support.RangeDomain")],xC);const tEe=xC,iEe={key:"type",base:xV,typeMap:{range:tEe,"coded-value":QSe,inherited:eEe}};function pie(t){if(!t||!t.type)return null;switch(t.type){case"range":return tEe.fromJSON(t);case"codedValue":return QSe.fromJSON(t);case"inherited":return eEe.fromJSON(t)}return null}const ist=new Hi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var JY;const rst=new Hi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let sc=JY=class extends Ae{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?rst.fromJSON(i.fieldValueType):null}clone(){return new JY({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],sc.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],sc.prototype,"defaultValue",void 0),u([p()],sc.prototype,"description",void 0),u([De("description")],sc.prototype,"readDescription",null),u([p({types:iEe,json:{read:{reader:pie},write:!0}})],sc.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],sc.prototype,"editable",void 0),u([p({type:Fr,json:{write:!0}})],sc.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],sc.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],sc.prototype,"nullable",void 0),u([It(ist)],sc.prototype,"type",void 0),u([p()],sc.prototype,"valueType",void 0),u([De("valueType",["description"])],sc.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],sc.prototype,"visible",void 0),sc=JY=u([N("esri.layers.support.Field")],sc);const R3=sc;var KY;let l_=KY=class extends Ae{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new KY({mapLayerId:t,gdbVersion:e})}};u([It({mapLayer:"map-layer"})],l_.prototype,"type",void 0),u([p({type:Fr,json:{write:!0}})],l_.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],l_.prototype,"gdbVersion",void 0),l_=KY=u([N("esri.layers.support.source.MapLayerSource")],l_);var QY;let C0=QY=class extends Ae{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new QY(n)}};u([It({queryTable:"query-table"})],C0.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],C0.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],C0.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],C0.prototype,"oidFields",void 0),u([p({type:Ye,json:{write:!0}})],C0.prototype,"spatialReference",void 0),u([It(k2)],C0.prototype,"geometryType",void 0),C0=QY=u([N("esri.layers.support.source.QueryTableDataSource")],C0);var eX;let TC=eX=class extends Ae{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new eX({workspaceId:t,dataSourceName:e})}};u([It({raster:"raster"})],TC.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],TC.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],TC.prototype,"workspaceId",void 0),TC=eX=u([N("esri.layers.support.source.RasterDataSource")],TC);var tX;let kx=tX=class extends Ae{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new tX({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([It({table:"table"})],kx.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],kx.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],kx.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],kx.prototype,"dataSourceName",void 0),kx=tX=u([N("esri.layers.support.source.TableDataSource")],kx);var iX,rX;const sst=jl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Ih=iX=class extends Ae{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Xce()(t,e,i)}castLeftTableSource(t){return xm(sX(),t)}readRightTableSource(t,e,i){return Xce()(t,e,i)}castRightTableSource(t){return xm(sX(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new iX(n)}};u([It({joinTable:"join-table"})],Ih.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Ih.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],Ih.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],Ih.prototype,"leftTableSource",void 0),u([De("leftTableSource")],Ih.prototype,"readLeftTableSource",null),u([pi("leftTableSource")],Ih.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],Ih.prototype,"rightTableSource",void 0),u([De("rightTableSource")],Ih.prototype,"readRightTableSource",null),u([pi("rightTableSource")],Ih.prototype,"castRightTableSource",null),u([It(sst)],Ih.prototype,"joinType",void 0),Ih=iX=u([N("esri.layers.support.source.JoinTableDataSource")],Ih);let m7=null;function Xce(){return m7||(m7=gw({types:sX()})),m7}let g7=null;function sX(){return g7||(g7={key:"type",base:null,typeMap:{"data-layer":eu,"map-layer":l_}}),g7}const nst={key:"type",base:null,typeMap:{"join-table":Ih,"query-table":C0,raster:TC,table:kx}};let eu=rX=class extends Ae{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new rX({fields:t,dataSource:e})}};u([It({dataLayer:"data-layer"})],eu.prototype,"type",void 0),u([p({type:[R3],json:{write:!0}})],eu.prototype,"fields",void 0),u([p({types:nst,json:{write:!0}})],eu.prototype,"dataSource",void 0),eu=rX=u([N("esri.layers.support.source.DataLayerSource")],eu),eu.from=Vn(eu);function rEe(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function tv(t){return typeof t=="string"?jo(t):ue(t)}function sEe(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=sEe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}const LN={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new cd({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator}),minus180Line:new cd({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new cd({paths:[[[180,-180],[180,180]]],spatialReference:Ye.WGS84}),minus180Line:new cd({paths:[[[-180,-180],[-180,180]]],spatialReference:Ye.WGS84})}};function r2(t,e){return Math.ceil((t-e)/(2*e))}function nEe(t,e){const i=PI(t);for(const r of i)for(const s of r)s[0]+=e;return t}function PI(t){return v_(t)?t.rings:t.paths}async function ost(t,e,i,r){const s=tv(t),n=e[0].spatialReference,o={...r,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:vS(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await tr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const d=Mm(h);return d.spatialReference=n,d})}}function ast(t){return{geometryType:vS(t[0]),geometries:t.map(e=>e.toJSON())}}function oEe(t,e,i){const r=_Xe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function lst(t,e,i){const r=typeof t=="string"?jo(t):t,s=e[0].spatialReference,n=vS(e[0]),o={...i,query:{...r.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(ast(e))}},{data:a}=await tr(r.path+"/simplify",o);return oEe(a.geometries,n,s)}const aEe=le.getLogger("esri.geometry.support.normalizeUtils");function cst(t){return t.type==="polygon"}function ust(t){return t[0].type==="polygon"}function hst(t){return t[0].type==="polyline"}function lEe(t,e){if(!(t instanceof cd||t instanceof kl)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw aEe.error(s),new J(s)}const i=PI(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/d,m=(c-a)/d,g=d/e;if(g>1){for(let S=1;S<=g-1;S++){const E=S*e,C=m*E+a,R=f*E+l;n.push([C,R])}const y=(d+Math.floor(g-1)*e)/2,v=m*y+a,x=f*y+l;n.push([v,x])}n.push([c,h])}}return cst(t)?new kl({rings:r,spatialReference:t.spatialReference}):new cd({paths:r,spatialReference:t.spatialReference})}function Zce(t,e,i){if(e){const r=lEe(t,1e6);t=ub(r,!0)}return i&&(t=nEe(t,i)),t}function Jce(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=r2(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=r2(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=r2(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=r2(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function dst(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=PI(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const d=-360*r2(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(s===i){if(ust(t))for(const a of PI(n))t[s]=t[s].addRing(a);else if(hst(t))for(const a of PI(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function TV(t,e,i){if(!Array.isArray(t))return TV([t],e);e&&typeof e!="string"&&aEe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??Mr.geometryServiceUrl;let s,n,o,a,l,c,h,d,f=0;const m=[],g=[];for(const C of t)if(A(C))g.push(C);else if(s||(s=C.spatialReference,n=dd(s),o=s.isWebMercator,c=o?102100:4326,a=LN[c].maxX,l=LN[c].minX,h=LN[c].plus180Line,d=LN[c].minus180Line),n)if(C.type==="mesh")g.push(C);else if(C.type==="point")g.push(Jce(C.clone(),a,l));else if(C.type==="multipoint"){const R=C.clone();R.points=R.points.map(O=>Jce(O,a,l)),g.push(R)}else if(C.type==="extent"){const R=C.clone()._normalize(!1,!1,n);g.push(R.rings?new kl(R):R)}else if(C.extent){const R=C.extent,O=r2(R.xmin,l)*(2*a);let U=O===0?C.clone():nEe(C.clone(),O);R.offset(O,0),R.intersects(h)&&R.xmax!==a?(f=R.xmax>f?R.xmax:f,U=Zce(U,o),m.push(U),g.push("cut")):R.intersects(d)&&R.xmin!==l?(f=R.xmax*(2*a)>f?R.xmax*(2*a):f,U=Zce(U,o,360),m.push(U),g.push("cut")):g.push(U)}else g.push(C.clone());else g.push(C);let y=r2(f,a),v=-90;const x=y,S=new cd;for(;y>0;){const C=360*y-180;S.addPath([[C,v],[C,-1*v]]),v*=-1,y--}if(m.length>0&&x>0){const C=dst(m,await ost(r,m,S,i)),R=[],O=[];for(let B=0;B<g.length;B++){const G=g[B];if(G!=="cut")O.push(G);else{const j=C.shift(),q=t[B];b(q)&&q.type==="polygon"&&q.rings&&q.rings.length>1&&j.rings.length>=q.rings.length?(R.push(j),O.push("simplify")):O.push(o?hy(j):j)}}if(!R.length)return O;const U=await lst(r,R,i),L=[];for(let B=0;B<O.length;B++){const G=O[B];G!=="simplify"?L.push(G):L.push(o?hy(U.shift()):U.shift())}return L}const E=[];for(let C=0;C<g.length;C++){const R=g[C];if(R!=="cut")E.push(R);else{const O=m.shift();E.push(o===!0?hy(O):O)}}return E}function tHt(t,e){const i=dd(e);if(i){const[r,s]=i.valid,n=s-r;if(t<r)for(;t<r;)t+=n;if(t>s)for(;t>s;)t-=n}return t}function cEe(t){const e={};for(const i in t){if(i==="declaredClass")continue;const r=t[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[i]=[];for(let s=0;s<r.length;s++)e[i][s]=cEe(r[s])}else typeof r=="object"?r.toJSON&&(e[i]=JSON.stringify(r)):e[i]=r}return e}var H1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(H1||(H1={}));const Kce=4294967296,pst=new TextDecoder("utf-8"),fst=me("safari")||me("ios")?6:me("ff")?12:32;let nX=class l6{constructor(e,i,r=0,s=e?e.byteLength:0){this._tag=0,this._dataType=H1.unknown,this._init(e,i,r,s)}_init(e,i,r,s){this._data=e,this._dataView=i,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new l6(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getUint32(i+4,!0)*Kce;return this._skip(8),r}getSFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getInt32(i+4,!0)*Kce;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+e);return this._skip(e),r}getBytes(){const e=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,i,r,s){const n=this.getMessage(),o=e(n,i,r,s);return n.release(),o}processMessage(e){const i=this.getMessage(),r=e(i);return i.release(),r}getMessage(){const e=this._getLength(),i=l6.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}release(){l6.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case H1.varint:this._decodeVarint();break;case H1.fixed64:this._skip(8);break;case H1.delimited:this._skip(this._getLength());break;case H1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let i=this._pos,r=0,s=0;if(this._end-i>=10)do{if(s=e[i++],r|=127&s,(128&s)==0||(s=e[i++],r|=(127&s)<<7,(128&s)==0)||(s=e[i++],r|=(127&s)<<14,(128&s)==0)||(s=e[i++],r|=(127&s)<<21,(128&s)==0)||(s=e[i++],r+=268435456*(127&s),(128&s)==0)||(s=e[i++],r+=34359738368*(127&s),(128&s)==0)||(s=e[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=e[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=e[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=e[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;i!==this._end&&(s=e[i],(128&s)!=0);)++i,r+=(127&s)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*n}return this._pos=i,r}_decodeSVarint(){const e=this._data;let i=this._pos,r=0,s=0;const n=1&e[i];if(this._end-i>=10)do{if(s=e[i++],r|=127&s,(128&s)==0||(s=e[i++],r|=(127&s)<<7,(128&s)==0)||(s=e[i++],r|=(127&s)<<14,(128&s)==0)||(s=e[i++],r|=(127&s)<<21,(128&s)==0)||(s=e[i++],r+=268435456*(127&s),(128&s)==0)||(s=e[i++],r+=34359738368*(127&s),(128&s)==0)||(s=e[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=e[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=e[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=e[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;i!==this._end&&(s=e[i],(128&s)!=0);)++i,r+=(127&s)*o,o*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*o}return this._pos=i,n?-(r+1)/2:r/2}_getLength(){if(this._dataType!==H1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,i,r){if((r=Math.min(this._end,r))-i>fst){const o=e.subarray(i,r);return pst.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=e[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,i,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,i,r-i)}};nX.pool=new pa(nX,void 0,t=>{t._data=null,t._dataView=null});let dh=class c6{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new c6([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(e){return e?(e.set(this.coords),new c6(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new c6(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},Kb=class uEe{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new uEe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function mst(t){return!(A(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let iHt=class extends Kb{},hEe=class dEe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new dEe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const pEe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let sHt=class{constructor(e){this._options=e,this.geometryTypes=pEe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new hEe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||us(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=L2(this._options.sourceSpatialReference)/L2(e.spatialReference);if(i!==1)for(const r of e.features){if(!mst(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(e,i){e.features.push(i)}createFeature(){return new Kb}createSpatialReference(){return{wkid:0}}createGeometry(){return new dh}addField(e,i){e.fields.push(i)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,i){e.coords[this._coordinatePtr++]=i}addCoordinatePoint(e,i){e.coords.push(i)}addLength(e,i){e.lengths.push(i)}addQueryGeometry(e,i){e.queryGeometry=i.queryGeometry,e.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new dh}};const Qce=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],eue=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],tue=["upperLeft","lowerLeft"];function iue(t){return t>=Qce.length?null:Qce[t]}function gst(t){return t>=eue.length?null:eue[t]}function rue(t){return t>=tue.length?null:tue[t]}function sue(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function yst(t,e,i){const s=t.asUnsafe(),n=e.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)e.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function _st(t,e,i){const n=t.asUnsafe(),o=e.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(;n.pos()<c;)e.addLength(o,n.getUInt32(),h++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(e.allocateCoordinates(o);n.pos()<c;)e.addCoordinate(o,n.getSInt64(),h),h++,h===a&&(h=0);break}default:n.skip()}return o}function vst(t){const s=t.asUnsafe(),n=new dh;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=pEe[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function bst(t){const h=t.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function wst(t){const a=t.asUnsafe(),l={type:iue(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=iue(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=gst(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function xst(t){const r={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:r.name=s.getString();break;case 2:r.isSystemMaintained=s.getBool();break;default:s.skip()}return r}function Tst(t,e,i,r){const a=e.createFeature(i);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=r[l++].name;a.attributes[c]=t.processMessage(bst);break}case 2:a.geometry=t.processMessageWithArgs(_st,e,i);break;case 4:a.centroid=t.processMessageWithArgs(yst,e,i);break;default:t.skip()}return a}function Sst(t){const n=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function Est(t){const n=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function Cst(t){const s={originPosition:rue(0)},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=rue(n.getEnum());break;case 2:s.scale=n.processMessage(Sst);break;case 3:s.translate=n.processMessage(Est);break;default:n.skip()}return s}function Mst(t){const s={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function Ast(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function Ost(t,e){const y=e.createFeatureResult(),v=t.asUnsafe();y.geometryType=sue(e,0);let x=!1;for(;v.next();)switch(v.tag()){case 1:y.objectIdFieldName=v.getString();break;case 3:y.globalIdFieldName=v.getString();break;case 4:y.geohashFieldName=v.getString();break;case 5:y.geometryProperties=v.processMessage(Mst);break;case 7:y.geometryType=sue(e,v.getEnum());break;case 8:y.spatialReference=v.processMessageWithArgs(Ast,e);break;case 10:y.hasZ=v.getBool();break;case 11:y.hasM=v.getBool();break;case 12:y.transform=v.processMessage(Cst);break;case 9:{const S=v.getBool();y.exceededTransferLimit=S;break}case 13:e.addField(y,v.processMessage(wst));break;case 15:x||(e.prepareFeatures(y),x=!0),e.addFeature(y,v.processMessageWithArgs(Tst,e,y,y.fields));break;case 2:y.uniqueIdField=v.processMessage(xst);break;default:v.skip()}return e.finishFeatureResult(y),y}function Rst(t,e){const s={};let n=null;for(;t.next();)switch(t.tag()){case 4:n=t.processMessageWithArgs(vst);break;case 1:s.featureResult=t.processMessageWithArgs(Ost,e);break;default:t.skip()}return b(n)&&s.featureResult&&e.addQueryGeometry(s,n),s}function Pst(t,e){try{const r=new nX(new Uint8Array(t),new DataView(t)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(Rst,e):r.skip();return s}catch(i){throw new J("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function Ist(t,e){const i=Pst(t,e),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function oX(t,e,i){if(!i||!i.features||!i.hasZ)return;const r=Ute(i.geometryType,e,t.outSpatialReference);if(!A(r))for(const s of i.features)r(s.geometry)}const nue="Layer does not support extent calculation.";function $st(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const i=t.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Lst(t,e){const i=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(b(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=vS(i),s.geometry=$st(i,t.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=t.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&b(o)&&b(t.quantizationParameters)&&b(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c??"null"},${h??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&b(o)&&b(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Dst(t,e,i,r){const s=b(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await aD(t,e,"json",r);return oX(e,i,s.data),s}async function Nst(t,e,i,r){if(b(e.timeExtent)&&e.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await Fst(t,e,r),n=s;return n.data=Ist(s.data,i),n}function Fst(t,e,i){return aD(t,e,"pbf",i)}function Ust(t,e,i){return b(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):aD(t,e,"json",i,{returnIdsOnly:!0})}function kst(t,e,i){return b(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):aD(t,e,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function Vst(t,e,i){return b(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):aD(t,e,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(nue);if(s.hasOwnProperty("count"))throw new Error(nue);return r})}function aD(t,e,i,r={},s={}){const n=typeof t=="string"?jo(t):t,o=e.geometry?[e.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",TV(o,null,r).then(a=>{const l=a&&a[0];b(l)&&((e=e.clone()).geometry=l);const c=cEe({...n.query,f:i,...s,...Lst(e,s)});return tr($2(n.path,"query"),{...r,query:{...c,...r.query}})})}var aX;const lX=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Xa=aX=class extends Ae{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const i=Ye.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const o=t[n],a=Ho.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;b(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&b(h))for(const d in h){const f=h[d],m=(s=c[d])==null?void 0:s.spatialReference;b(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void lX.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&b(n.geometry))return void lX.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=Mm(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Ye.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&b(r.geometry)&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new aX(this.cloneProperties())}cloneProperties(){return ue({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t&&t[i];r.geometry=s&&s.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:h}of e)b(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=v_(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(v_(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i){return t==="point"?r=>{r.x=e(r.x),r.y=i(r.y)}:t==="polyline"||t==="polygon"?r=>{const s=v_(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,d=c.length;h<d;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=e(n),f[1]=i(o)}}}:t==="extent"?r=>{r.xmin=e(r.xmin),r.ymin=i(r.ymin),r.xmax=e(r.xmax),r.ymax=i(r.ymax)}:t==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=e(n),c[1]=i(o)}}:null}};u([p({type:String,json:{write:!0}})],Xa.prototype,"displayFieldName",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"exceededTransferLimit",void 0),u([p({type:[Ho],json:{write:!0}})],Xa.prototype,"features",void 0),u([De("features")],Xa.prototype,"readFeatures",null),u([p({type:[R3],json:{write:!0}})],Xa.prototype,"fields",void 0),u([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:lX.read}}})],Xa.prototype,"geometryType",void 0),u([Xe("geometryType")],Xa.prototype,"writeGeometryType",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"hasZ",void 0),u([p({types:yw,json:{write:!0}})],Xa.prototype,"queryGeometry",void 0),u([De("queryGeometry")],Xa.prototype,"readQueryGeometry",null),u([p({type:Ye,json:{write:!0}})],Xa.prototype,"spatialReference",void 0),u([Xe("spatialReference")],Xa.prototype,"writeSpatialReference",null),u([p({json:{write:!0}})],Xa.prototype,"transform",void 0),Xa=aX=u([N("esri.rest.support.FeatureSet")],Xa),Xa.prototype.toJSON.isDefaultToJSON=!0;const lD=Xa,oue={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},zst={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Bst(t,e){const i=new Date(t,e+1,1);return i.setDate(0),i.getDate()}function g2(t,e,i){const r=new Date(t.getTime());if(e&&i){const s=zst[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=Bst(r.getFullYear(),r.getMonth()+e);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+e*a)}return r}function aue(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function Gst(t,e,i){return t===0?0:t*oue[e]/oue[i]}var Tf;let jh=Tf=class extends Ae{static get allTime(){return lue}static get empty(){return jst}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Tf.allTime)}get isEmpty(){return this.equals(Tf.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Tf({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=b(this.start)?this.start.getTime():this.start,i=b(this.end)?this.end.getTime():this.end,r=b(t.start)?t.start.getTime():t.start,s=b(t.end)?t.end.getTime():t.end;return e===r&&i===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=fa(this.start,r=>aue(r,t)),i=fa(this.end,r=>{const s=aue(r,t);return r.getTime()===s.getTime()?s:g2(s,1,t)});return new Tf({start:e,end:i})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Tf.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=id(this.start,-1/0,a=>a.getTime()),i=id(this.end,1/0,a=>a.getTime()),r=id(t.start,-1/0,a=>a.getTime()),s=id(t.end,1/0,a=>a.getTime());let n,o;if(r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Tf;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Tf.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Tf,{start:r,end:s}=this;return b(r)&&(i.start=g2(r,t,e)),b(s)&&(i.end=g2(s,t,e)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return lue.clone();const e=b(this.start)&&b(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=b(this.end)&&b(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Tf({start:e,end:i})}};u([p({type:Date,json:{write:{allowNull:!0}}})],jh.prototype,"end",void 0),u([De("end")],jh.prototype,"readEnd",null),u([Xe("end")],jh.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],jh.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],jh.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],jh.prototype,"start",void 0),u([De("start")],jh.prototype,"readStart",null),u([Xe("start")],jh.prototype,"writeStart",null),jh=Tf=u([N("esri.TimeExtent")],jh);const lue=new jh,jst=new jh({start:void 0,end:void 0}),Jp=jh;let Vx=class extends hn(Ae){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:b(this.onFields)&&this.onFields.length>0}}}}})],Vx.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],Vx.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],Vx.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],Vx.prototype,"searchType",void 0),Vx=u([N("esri.rest.support.FullTextSearch")],Vx);const Hst=Vx;var cX;const cue=new Hi({upperLeft:"upper-left",lowerLeft:"lower-left"});let zx=cX=class extends Ae{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new cX(ue({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:ti,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],zx.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],zx.prototype,"mode",void 0),u([p({type:String,json:{read:cue.read,write:cue.write}})],zx.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],zx.prototype,"tolerance",void 0),zx=cX=u([N("esri.rest.support.QuantizationParameters")],zx);const fEe=zx;var uX;const uue=new Hi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Sf=uX=class extends Ae{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ue(t))}clone(){return new uX({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ue(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],Sf.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],Sf.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],Sf.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],Sf.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],Sf.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:uue.read},write:{target:"statisticType",writer:uue.write}}})],Sf.prototype,"statisticType",void 0),u([p({type:Object})],Sf.prototype,"statisticParameters",void 0),u([Xe("statisticParameters")],Sf.prototype,"writeStatisticParameters",null),Sf=uX=u([N("esri.rest.support.StatisticDefinition")],Sf);const mEe=Sf;var YM;const qst=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Wst=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ni=YM=class extends Ae{static from(t){return U_(YM,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new YM(ue({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:b(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};ni.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],ni.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],ni.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],ni.prototype,"datumTransformation",void 0),u([pi("datumTransformation")],ni.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],ni.prototype,"distance",void 0),u([p({type:eu,json:{write:!0}})],ni.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],ni.prototype,"formatOf3DObjects",void 0),u([p({type:[Hst],json:{write:{enabled:!0,overridePolicy(){return{enabled:b(this.fullText)&&this.fullText.length>0}}}}})],ni.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],ni.prototype,"gdbVersion",void 0),u([p({types:yw,json:{read:Mm,write:!0}})],ni.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],ni.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],ni.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],ni.prototype,"having",void 0),u([p({type:Date})],ni.prototype,"historicMoment",void 0),u([Xe("historicMoment")],ni.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],ni.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>YM.MAX_MAX_RECORD_COUNT_FACTOR?YM.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],ni.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],ni.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],ni.prototype,"num",void 0),u([p({json:{write:!0}})],ni.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],ni.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],ni.prototype,"outFields",void 0),u([p({type:Ye,json:{name:"outSR",write:!0}})],ni.prototype,"outSpatialReference",void 0),u([p({type:[mEe],json:{write:{enabled:!0,overridePolicy(){return{enabled:b(this.outStatistics)&&this.outStatistics.length>0}}}}})],ni.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],ni.prototype,"parameterValues",void 0),u([Xe("parameterValues")],ni.prototype,"writeParameterValues",null),u([p({type:st,json:{write:!0}})],ni.prototype,"pixelSize",void 0),u([p({type:fEe,json:{write:!0}})],ni.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],ni.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],ni.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],ni.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],ni.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],ni.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ni.prototype,"returnZ",void 0),u([p({type:Ye,json:{write:!0}})],ni.prototype,"sourceSpatialReference",void 0),u([It(qst,{ignoreUnknown:!1,name:"spatialRel"})],ni.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],ni.prototype,"start",void 0),u([Xe("start"),Xe("num")],ni.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],ni.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],ni.prototype,"text",void 0),u([p({type:Jp,json:{write:!0}})],ni.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ni.prototype,"timeReferenceUnknownClient",void 0),u([It(Wst,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],ni.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],ni.prototype,"where",void 0),u([Xe("where")],ni.prototype,"writeWhere",null),ni=YM=u([N("esri.rest.support.Query")],ni);const _o=ni;async function u6(t,e,i){const r=await gEe(t,e,i);return lD.fromJSON(r)}async function gEe(t,e,i){const r=tv(t),s={...i},n=_o.from(e),{data:o}=await Dst(r,n,n.sourceSpatialReference,s);return o}function zl(t,e){return t?e?4:3:e?3:2}const P3=le.getLogger("esri.layers.graphics.featureConversionUtils"),yEe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Yst=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},hue=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},Xst=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},Zst=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function fie(t,e,i,r){if(t){if(i)return e&&r?Zst:hue;if(e&&r)return Xst}else if(e&&r)return hue;return Yst}function y7({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function _7({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function v7({scale:t,translate:e},i,r){return i*t[r]+e[r]}function hX(t,e,i){return t?e?i?yie(t):mie(t):i?gie(t):SV(t):null}function SV(t){const e=t.coords;return{x:e[0],y:e[1]}}function _Ee(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function mie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Jst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function gie(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Kst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function yie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Qst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function ent(t,e,i,r){let s=SV;i&&r?s=yie:i?s=mie:r&&(s=gie);for(const n of e){const{geometry:o,attributes:a}=n,l=b(o)?s(o):null;t.push({attributes:a,geometry:l})}return t}function _ie(t,e){return t&&e?Qst:t?Jst:e?Kst:_Ee}function vEe(t,e,i,r,s){const n=_ie(i,r);for(const{geometry:o,attributes:a}of e){const l=b(o)?n(new dh,o):null;t.push(new Kb(l,a,null,s?a[s]:void 0))}return t}function aHt(t,e,i=_ie(e.z!=null,e.m!=null)){return i(t,e)}function tnt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:b(s)?vie(s,i,r):null});return t}function vie(t,e,i){if(A(t))return null;const r=zl(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function bEe(t,e,i,r,s){const n=zl(i,r);for(const{geometry:o,attributes:a}of e){const l=b(o)?wEe(new dh,o,n):null;t.push(new Kb(l,a,null,s?a[s]:void 0))}return t}function wEe(t,e,i=zl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function int(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:b(s)?bie(s,i,r):null});return t}function bie(t,e,i){if(!t)return null;const r=zl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function xEe(t,e,i,r,s){const n=zl(i,r);for(const{geometry:o,attributes:a}of e){const l=b(o)?TEe(new dh,o,n):null;t.push(new Kb(l,a,null,s?a[s]:void 0))}return t}function TEe(t,e,i=zl(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function rnt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=b(s)?wie(s,i,r):null;if(b(o)){const l=SV(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function wie(t,e,i){if(!t)return null;const r=zl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function SEe(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=b(n)?EEe(new dh,n,i,r):null,c=s?a[s]:void 0;b(o)?t.push(new Kb(l,a,_Ee(new dh,o),c)):t.push(new Kb(l,a,null,c))}return t}function EEe(t,e,i=e.hasZ,r=e.hasM){return snt(t,e.rings,i,r),t}function snt(t,e,i,r){const s=zl(i,r),{lengths:n,coords:o}=t;let a=0;b_(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const XM=[],II=[];function lHt(t,e,i,r,s){XM[0]=t;const[n]=CEe(II,XM,e,i,r,s);return Pm(XM),Pm(II),n}function CEe(t,e,i,r,s,n){if(Pm(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new Kb(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return vEe(t,e,r,s,n);case"esriGeometryMultipoint":return bEe(t,e,r,s,n);case"esriGeometryPolyline":return xEe(t,e,r,s,n);case"esriGeometryPolygon":return SEe(t,e,r,s,n);default:P3.error("convertToFeatureSet:unknown-geometry",new J(`Unable to parse unknown geometry type '${i}'`)),Pm(t)}return t}function cHt(t,e,i,r,s,n){const o=t.length;switch(i){case"esriGeometryPoint":vEe(t,e,r,s,n);break;case"esriGeometryMultipoint":bEe(t,e,r,s,n);break;case"esriGeometryPolyline":xEe(t,e,r,s,n);break;case"esriGeometryPolygon":SEe(t,e,r,s,n);break;default:P3.error("convertToFeatureSet:unknown-geometry",new J(`Unable to parse unknown geometry type '${i}'`))}for(let a=0;a<e.length;a++)t[a+o].geometryType=i,t[a+o].insertAfter=e[a].insertAfter,t[a+o].groupId=e[a].groupId;return t}function uHt(t,e,i,r){II[0]=t,AEe(XM,II,e,i,r);const s=XM[0];return Pm(XM),Pm(II),s}function nnt(t,e,i){if(A(t))return null;const r=new dh;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),Bk(t)?_ie(e??t.z!=null,i??t.m!=null)(r,t):v_(t)?EEe(r,t,e,i):ZL(t)?TEe(r,t,zl(e,i)):zk(t)?wEe(r,t,zl(e,i)):void P3.error("convertFromGeometry:unknown-geometry",new J(`Unable to parse unknown geometry type '${t}'`))}function MEe(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(A(s))return null;switch(e){case"esriGeometryPoint":{let n=SV;return i&&r?n=yie:i?n=mie:r&&(n=gie),n(s)}case"esriGeometryMultipoint":return vie(s,i,r);case"esriGeometryPolyline":return bie(s,i,r);case"esriGeometryPolygon":return wie(s,i,r);default:return P3.error("convertToGeometry:unknown-geometry",new J(`Unable to parse unknown geometry type '${e}'`)),null}}function ont(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function AEe(t,e,i,r,s){if(Pm(t),A(i))return ont(t,e);switch(i){case"esriGeometryPoint":return ent(t,e,r,s);case"esriGeometryMultipoint":return tnt(t,e,r,s);case"esriGeometryPolyline":return int(t,e,r,s);case"esriGeometryPolygon":return rnt(t,e,r,s);default:P3.error("convertToFeatureSet:unknown-geometry",new J(`Unable to parse unknown geometry type '${i}'`))}return t}function hHt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:AEe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:MEe(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function dHt(t,e){const i=new hEe,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&CEe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(P3.error(new J("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function pHt(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)b(n.geometry)&&pX(n.geometry,n.geometry,r,s,e),b(n.centroid)&&pX(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function fHt(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new dh,k$(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new dh,k$(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function k$(t,e,i,r,s,n,o=i,a=r){if(b_(t),A(e)||!e.coords.length)return null;const l=yEe[s],{coords:c,lengths:h}=e,d=zl(i,r),f=zl(i&&o,r&&a),m=fie(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,y7(n,c[0]),_7(n,c[1])),b_(t,d,0),t;let g,y,v,x,S=0,E=0,C=E;for(const R of h){if(R<l)continue;let O=0;E=C,v=g=y7(n,c[S]),x=y=_7(n,c[S+1]),m(t.coords,c,E,S,v,x),O++,S+=d,E+=f;for(let U=1;U<R;U++,S+=d)v=y7(n,c[S]),x=_7(n,c[S+1]),v===g&&x===y||(m(t.coords,c,E,S,v-g,x-y),E+=f,O++,g=v,y=x);O>=l&&(t.lengths.push(O),C=E)}return Pm(t.coords,C),t.coords.length?t:null}function ant(t,e,i,r,s,n,o=i,a=r){if(b_(t),!e||!e.coords.length)return null;const l=yEe[s],{coords:c,lengths:h}=e,d=zl(i,r),f=zl(i&&o,r&&a),m=fie(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),b_(t,d,0),t;let g=0;const y=n*n;for(const v of h){if(v<l){g+=v*d;continue}const x=t.coords.length/f,S=g,E=g+(v-1)*d;m(t.coords,c,t.coords.length,S,c[S],c[S+1]),dX(t.coords,c,d,y,m,S,E),m(t.coords,c,t.coords.length,E,c[E],c[E+1]);const C=t.coords.length/f-x;C>=l?t.lengths.push(C):Pm(t.coords,x*f),g+=v*d}return t.coords.length?t:null}function lnt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const g=((s-h)*f+(n-d)*m)/(f*f+m*m);g>1?(h=l,d=c):g>0&&(h+=f*g,d+=m*g)}return f=s-h,m=n-d,f*f+m*m}function dX(t,e,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=lnt(e,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&dX(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&dX(t,e,i,r,s,c,o))}function mHt(t,e,i,r){if(A(e)||!e.coords||!e.coords.length)return null;const s=zl(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const d=c[h],f=c[h+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,f),l=Math.max(l,f)}}return zW(t)?VZe(t,n,o,a,l):vte(n,o,a,l,t),t}function pX(t,e,i,r,s){const{coords:n,lengths:o}=e,a=zl(i,r);if(!n.length)return t!==e&&b_(t),t;DL(s);const{originPosition:l,scale:c,translate:h}=s,d=hnt;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=v7(d,n[y],y);return t!==e&&b_(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let E=0;E<a;++E)t.coords[g+E]=v7(d,n[g+E],E);let x=t.coords[g],S=t.coords[g+1];g+=a;for(let E=1;E<v;E++,g+=a){x+=n[g]*f[0],S+=n[g+1]*f[1],t.coords[g]=x,t.coords[g+1]=S;for(let C=2;C<a;++C)t.coords[g+C]=v7(d,n[g+C],C)}}return t!==e&&b_(t,n.length,o.length),t}function cnt(t,e,i,r,s,n){if(b_(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=zl(i,r),a=fie(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function unt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function gHt(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=unt(i,s,a,e),s+=a}return Math.abs(n)}function yHt(t,e){if(A(t))return null;const i=t.clone(),r=t.coords,s=t.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[e*n],c=r[e*n+1];for(let h=1;h<a;h++){const d=l+r[e*(n+h)],f=c+r[e*(n+h)+1];i.coords[e*(n+h)]=d,i.coords[e*(n+h)+1]=f,l=d,c=f}n+=a}return i}function b_(t,e=0,i=0){Pm(t.lengths,i),Pm(t.coords,e)}function Pm(t,e=0){t.length!==e&&(t.length=e)}const hnt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var fX;let Bn=fX=class extends Ae{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new fX(ue({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],Bn.prototype,"cacheHint",void 0),u([p({type:eu,json:{write:!0}})],Bn.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Bn.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],Bn.prototype,"geometryPrecision",void 0),u([p({type:Date})],Bn.prototype,"historicMoment",void 0),u([Xe("historicMoment")],Bn.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Bn.prototype,"maxAllowableOffset",void 0),u([p({type:[Number],json:{write:!0}})],Bn.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Bn.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Bn.prototype,"outFields",void 0),u([p({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Bn.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],Bn.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Bn.prototype,"start",void 0),u([Xe("start"),Xe("num")],Bn.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Bn.prototype,"num",void 0),u([p({json:{write:!0}})],Bn.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bn.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bn.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Bn.prototype,"where",void 0),Bn=fX=u([N("esri.rest.support.RelationshipQuery")],Bn),Bn.from=Vn(Bn);const zA=Bn,due=Object.freeze(Object.defineProperty({__proto__:null,default:zA},Symbol.toStringTag,{value:"Module"}));var mX;let SC=mX=class extends Ae{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new mX({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([p({type:[String],json:{write:!0}})],SC.prototype,"groupByFields",void 0),u([p({type:Number,json:{write:!0}})],SC.prototype,"topCount",void 0),u([p({type:[String],json:{write:!0}})],SC.prototype,"orderByFields",void 0),SC=mX=u([N("esri.rest.support.TopFilter")],SC);const dnt=SC;var gX;const pue=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),fue=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let mn=gX=class extends Ae{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new gX(ue({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([p({type:Boolean,json:{write:!0}})],mn.prototype,"cacheHint",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],mn.prototype,"distance",void 0),u([p({types:yw,json:{read:Mm,write:!0}})],mn.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],mn.prototype,"geometryPrecision",void 0),u([p({type:Number,json:{write:!0}})],mn.prototype,"maxAllowableOffset",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],mn.prototype,"num",void 0),u([p({json:{write:!0}})],mn.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],mn.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],mn.prototype,"outFields",void 0),u([p({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],mn.prototype,"outSpatialReference",void 0),u([p({type:String,json:{write:!0}})],mn.prototype,"resultType",void 0),u([p({json:{write:!0}})],mn.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mn.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mn.prototype,"returnZ",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],mn.prototype,"start",void 0),u([Xe("start"),Xe("num")],mn.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"spatialRel",reader:pue.read},write:{target:"spatialRel",writer:pue.write}}})],mn.prototype,"spatialRelationship",void 0),u([p({type:Jp,json:{write:!0}})],mn.prototype,"timeExtent",void 0),u([p({type:dnt,json:{write:!0}})],mn.prototype,"topFilter",void 0),u([p({type:String,json:{read:fue.read,write:{writer:fue.write,overridePolicy(t){return{enabled:b(t)&&b(this.distance)&&this.distance>0}}}}})],mn.prototype,"units",void 0),u([p({type:String,json:{write:!0}})],mn.prototype,"where",void 0),mn=gX=u([N("esri.rest.support.TopFeaturesQuery")],mn),mn.from=Vn(mn);const DN=mn,pnt="esri.widgets.Feature.support.relatedFeatureUtils",mue=le.getLogger(pnt),gue=new Map;function h6(t){if(!f_(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function fnt(t,e){if(!e.relationships)return null;let i=null;const{relationships:r}=e;return r.some(s=>s.id===parseInt(t,10)&&(i=s,!0)),i}function mnt({originRelationship:t,relationships:e,layerId:i}){let r=null;return e&&e.some(s=>(`${s.relatedTableId}`===i&&s.id===(t==null?void 0:t.id)&&(r=s),!!r)),r}function gnt(t,e){const i=e.toLowerCase();for(const r in t)if(r.toLowerCase()===i)return t[r];return null}function ynt(t,e){const i=fnt(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function _nt(t,e){if(!e||!t)return;const{features:i,statsFeatures:r}=t,s=i&&i.value;e.relatedFeatures=s?s.features:[];const n=r&&r.value;e.relatedStatsFeatures=n?n.features:[]}function vnt(t,e,i,r){var n;const s=new zA;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[i.objectIdField]],((n=i.queryRelatedFeatures)==null?void 0:n.call(i,s,r))??Promise.resolve({})}function bnt(t,e,i){let r=0;const s=[];for(;r<e.length;)s.push(`${t} IN (${e.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function wnt(t,e,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!n||!o)return null;const d=mnt({originRelationship:o,relationships:n.relationships,layerId:s});if(d!=null&&d.relationshipTableId&&d.keyFieldInRelationshipTable){const m=(await vnt(t,d,i,r))[t.attributes[i.objectIdField]];if(!m)return null;const g=m.features.map(y=>y.attributes[n.objectIdField]);if(l!=null&&l.length&&n.supportsStatistics){const y=new _o;y.where=bnt(n.objectIdField,g,1e3),y.outFields=a,y.outStatistics=l,y.sourceSpatialReference=h;const v={features:Promise.resolve(m),statsFeatures:u6(c,y)};return hu(v)}}const f=d==null?void 0:d.keyField;if(f){const m=jk(Cnt(n.fields,f)),g=gnt(t.attributes,o.keyField),y=m?`${f}=${g}`:`${f}='${g}'`,v=u6(c,new _o({where:y,outFields:e.relatedFields,sourceSpatialReference:h}),r),x=e.outStatistics&&e.outStatistics.length>0&&n.supportsStatistics?u6(c,new _o({where:y,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),r):null,S={features:v};return x&&(S.statsFeatures=x),hu(S)}return null}function xnt(t,e){return tr(t,{query:{f:"json"},signal:e&&e.signal})}function Tnt({relatedInfos:t,layer:e},i){const r={};return t.forEach((s,n)=>{const{relation:o}=s;if(!o){const d=new J("relation-required","A relation is required on a layer to retrieve related records.");throw mue.error(d),d}const{relatedTableId:a}=o;if(typeof a!="number"){const d=new J("A related table ID is required on a layer to retrieve related records.");throw mue.error(d),d}const l=`${e.url}/${a}`,c=gue.get(l),h=c||xnt(l);c||gue.set(l,h),r[n]=h}),lp(hu(r),i)}function Snt({graphic:t,relatedInfos:e,layer:i},r){const s={};return e.forEach((n,o)=>{n.layerInfo&&(s[o]=wnt(t,n,i,r))}),hu(s)}function Ent({relatedInfo:t,fieldName:e,fieldInfo:i}){var r,s;if((r=t.relatedFields)==null||r.push(e),i.statisticType){const n=new mEe({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(n)}}function Cnt(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const yue={chartAnimation:!0};let Jo=class extends Ee{constructor(e){super(e),this.abilities={...yue},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...yue,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,r=(e+i)%i;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,r=i+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,r=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=i2({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.title}),l.caption=i2({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.caption}),l.altText=i2({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:s,layer:i}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:r,formattedAttributes:s,layer:i,expressionAttributes:n}),l}return null}).filter(b))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:r,formattedAttributes:s,layer:n}=e,{linkURL:o,sourceURL:a}=r;if(a){const l=zY(a,n);r.sourceURL=VY({formattedAttributes:s,template:l,fieldInfoMap:i})}if(o){const l=zY(o,n);r.linkURL=VY({formattedAttributes:s,template:l,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:r,formattedAttributes:s,chartType:n,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:d}=i,f=o;if(i.fields=sit(h,f),d&&(i.normalizeField=F$(d,f)),!h.some(g=>!!(s[g]!=null||f_(g)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];h.forEach(g=>{if(f_(g))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:g,formattedAttributes:s,chartType:n,value:i})]);const y=this._getChartOption({value:i,attributes:r,chartType:n,formattedAttributes:s,expressionAttributes:a,fieldName:g,fieldInfos:m});i.series.push(y)})}_getRelatedChartInfos(e){var m;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o}=e,a=[],l=h6(r),c=l&&((m=this.relatedInfos)==null?void 0:m.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:h,relation:d}=c;if(!d||!h)return a;const{cardinality:f}=d;return h.forEach(g=>{const{attributes:y}=g;y&&Object.keys(y).forEach(v=>{v===l.fieldName&&a.push(this._getChartOption({value:o,attributes:y,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:v,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:i}))})}),f==="one-to-many"||f==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:i,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var O;const{value:i,attributes:r,formattedAttributes:s,expressionAttributes:n,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,d=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:m,tooltipField:g}=i,y=m?f_(m)?r[h6(m).fieldName]:r[m]:null,v=tie(o)&&n&&n[o]!==void 0?n[o]:a&&r[a]!==void 0?r[a]:r[o]!==void 0?r[o]:s[o],x=new Cxe({fieldName:o,value:v===void 0?null:v&&y?v/y:v});if(f_(o)){const U=f.get(o.toLowerCase()),L=g&&f.get(g.toLowerCase()),B=(U==null?void 0:U.fieldName)??o,G=h&&g?h6(g).fieldName:(L==null?void 0:L.fieldName)??g,j=h&&G?r[G]:s[G]??(U==null?void 0:U.label)??(U==null?void 0:U.fieldName)??a,q=h&&a?r[a]:s[B];return x.tooltip=this._getTooltip({label:j,value:q,chartType:c}),x}const S=ASe(l,o),E=F$(o,d),C=g&&s[g]!==void 0?s[g]:CSe(S||new JL({fieldName:E}),(O=this.popupTemplate)==null?void 0:O.expressionInfos),R=s[E];return x.tooltip=this._getTooltip({label:C,value:R,chartType:c}),x}};u([p()],Jo.prototype,"abilities",void 0),u([pi("abilities")],Jo.prototype,"castAbilities",null),u([p()],Jo.prototype,"activeMediaInfoIndex",void 0),u([p({readOnly:!0})],Jo.prototype,"activeMediaInfo",null),u([p()],Jo.prototype,"attributes",void 0),u([p()],Jo.prototype,"description",void 0),u([p()],Jo.prototype,"fieldInfoMap",void 0),u([p()],Jo.prototype,"formattedAttributes",void 0),u([p()],Jo.prototype,"expressionAttributes",void 0),u([p({readOnly:!0})],Jo.prototype,"formattedMediaInfos",null),u([p()],Jo.prototype,"isAggregate",void 0),u([p()],Jo.prototype,"layer",void 0),u([p({readOnly:!0})],Jo.prototype,"formattedMediaInfoCount",null),u([p()],Jo.prototype,"mediaInfos",void 0),u([p()],Jo.prototype,"popupTemplate",void 0),u([p()],Jo.prototype,"relatedInfos",void 0),u([p()],Jo.prototype,"title",void 0),Jo=u([N("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Jo);const s2=Jo;var _ue=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Mnt=[].concat(_ue.slice(30,39),_ue.slice(28,30).reverse()),Ant=[{name:"default",colors:Mnt},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const vue="en-us",xie=new Map([["ar",()=>se(()=>import("./ar-bb1fe5ab.js"),["assets/ar-bb1fe5ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>se(()=>import("./bg_BG-184a2bfa.js"),["assets/bg_BG-184a2bfa.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>se(()=>import("./bs_BA-f32cc344.js"),["assets/bs_BA-f32cc344.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>se(()=>import("./ca_ES-d17ee95b.js"),["assets/ca_ES-d17ee95b.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>se(()=>import("./cs_CZ-bcd1e782.js"),["assets/cs_CZ-bcd1e782.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>se(()=>import("./da_DK-27b1b06e.js"),["assets/da_DK-27b1b06e.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>se(()=>import("./de_DE-c0a1d8dd.js"),["assets/de_DE-c0a1d8dd.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>se(()=>import("./de_CH-be7b4255.js"),["assets/de_CH-be7b4255.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>se(()=>import("./el_GR-05fb9ec0.js"),["assets/el_GR-05fb9ec0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>se(()=>import("./en_US-170979d8.js"),["assets/en_US-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>se(()=>import("./en_CA-170979d8.js"),["assets/en_CA-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>se(()=>import("./es_ES-d0b66640.js"),["assets/es_ES-d0b66640.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>se(()=>import("./et_EE-56dd74d3.js"),["assets/et_EE-56dd74d3.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>se(()=>import("./fi_FI-91d58cb9.js"),["assets/fi_FI-91d58cb9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>se(()=>import("./fr_FR-a11503e0.js"),["assets/fr_FR-a11503e0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>se(()=>import("./he_IL-90db98c4.js"),["assets/he_IL-90db98c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>se(()=>import("./hr_HR-fac8bb29.js"),["assets/hr_HR-fac8bb29.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>se(()=>import("./hu_HU-e8803856.js"),["assets/hu_HU-e8803856.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>se(()=>import("./id_ID-86e57d06.js"),["assets/id_ID-86e57d06.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>se(()=>import("./it_IT-2d4485ba.js"),["assets/it_IT-2d4485ba.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>se(()=>import("./ja_JP-77c6c16d.js"),["assets/ja_JP-77c6c16d.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>se(()=>import("./ko_KR-e155b9ab.js"),["assets/ko_KR-e155b9ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>se(()=>import("./lt_LT-fde47ae9.js"),["assets/lt_LT-fde47ae9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>se(()=>import("./lv_LV-359be050.js"),["assets/lv_LV-359be050.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>se(()=>import("./nb_NO-30d57c1a.js"),["assets/nb_NO-30d57c1a.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>se(()=>import("./nl_NL-cb904b48.js"),["assets/nl_NL-cb904b48.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>se(()=>import("./pl_PL-58c54c9f.js"),["assets/pl_PL-58c54c9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>se(()=>import("./pt_BR-d2e10248.js"),["assets/pt_BR-d2e10248.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>se(()=>import("./pt_PT-65a41842.js"),["assets/pt_PT-65a41842.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>se(()=>import("./ro_RO-15e90e9f.js"),["assets/ro_RO-15e90e9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>se(()=>import("./ru_RU-a74d21e5.js"),["assets/ru_RU-a74d21e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>se(()=>import("./sk_SK-a928dbd1.js"),["assets/sk_SK-a928dbd1.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>se(()=>import("./sl_SL-1a3c3078.js"),["assets/sl_SL-1a3c3078.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>se(()=>import("./sr_RS-0b18b911.js"),["assets/sr_RS-0b18b911.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>se(()=>import("./sv_SE-ce7e3f84.js"),["assets/sv_SE-ce7e3f84.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>se(()=>import("./th_TH-1448f333.js"),["assets/th_TH-1448f333.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>se(()=>import("./tr_TR-dd92f630.js"),["assets/tr_TR-dd92f630.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>se(()=>import("./uk_UA-fe4434ed.js"),["assets/uk_UA-fe4434ed.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>se(()=>import("./vi_VN-41938633.js"),["assets/vi_VN-41938633.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>se(()=>import("./zh_Hans-524a1291.js"),["assets/zh_Hans-524a1291.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>se(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>se(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function Ont(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const r of xie.keys())if(r.startsWith(e)){i=r;break}return i}function Rnt(t){return t?xie.has(t.toLowerCase())?t.toLowerCase():Ont(t)||vue:vue}let zS=null,PO=null;async function Pnt(t=Rp()){if(t=Rnt(t),zS&&t===PO)return zS;zS=se(()=>import("./index-a1a574a3.js"),["assets/index-a1a574a3.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.i),PO=t;try{const[e,i]=await Promise.all([zS,xie.get(PO)()]);PO===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return zS=null,PO=null,null}return zS}function Int(t,e="default"){const i=Ant.find(r=>r.name===e);return i?i.colors.map(r=>t.color(r)):null}const Cc="esri-feature-media",Wn={base:Cc,mediaContainer:`${Cc}__container`,mediaItemContainer:`${Cc}__item-container`,mediaItem:`${Cc}__item`,mediaItemTitle:`${Cc}__item-title`,mediaItemCaption:`${Cc}__item-caption`,mediaPrevious:`${Cc}__previous`,mediaPreviousIconLTR:`${Cc}__previous-icon`,mediaPreviousIconRTL:`${Cc}__previous-icon--rtl`,mediaNext:`${Cc}__next`,mediaNextIconLTR:`${Cc}__next-icon`,mediaNextIconRTL:`${Cc}__next-icon--rtl`,mediaChart:`${Cc}__chart`,mediaButton:`${Cc}__button`,mediaIcon:`${Cc}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},b7=.05,w7=.95,x7=15,Ky="color",Cv="tooltip",IO="value",bue="default-line-value";let Ru=class extends hl{constructor(e,i){super(e,i),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new s2,this.messages=null,this._getChartDependencies=async r=>{const s=await Pnt(),{destroyed:n,viewModel:o}=this;if(n||!o||!r)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(s);this._renderChart({chartDiv:r,mediaInfo:a,chartsModule:s,colorMap:l})}}initialize(){this._featureElementInfo=new vV,this.addHandles([ae(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(i=this.viewModel)==null?void 0:i.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),ii),ae(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),ii)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return ce("div",{bind:this,class:Wn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ce("div",{key:"media-element-container",class:Wn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:h,linkURL:d}=n,f=ESe(d??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",g=o?i:null,y=g?g.timestamp:0,v=g?g.sourceURL:h,x=ce("img",{alt:a||l,key:`media-${c}-${r}-${s}-${y}`,src:v??void 0});return(d?ce("a",{title:l,href:d,rel:m,target:f},x):null)||x}renderChartMediaInfo(e){const{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel;return ce("div",{key:`media-${e.type}-${i}-${r}`,bind:this,class:Wn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const i=e.title?ce("div",{key:"media-title",class:Wn.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?ce("div",{key:"media-caption",class:Wn.mediaItemCaption,innerHTML:e.caption}):null;return ce("div",{key:"media-container",class:Wn.mediaItemContainer},ce("div",{key:"media-item-container",class:Wn.mediaItem},this.renderMediaInfoType()),i,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const i=e==="previous",r=i?this.messages.previous:this.messages.next,s=i?this.classes(Wn.mediaButton,Wn.mediaPrevious):this.classes(Wn.mediaButton,Wn.mediaNext),n=i?this.classes(Wn.mediaIcon,Wn.mediaPreviousIconLTR,Wn.iconLeftTriangleArrow):this.classes(Wn.mediaIcon,Wn.mediaNextIconLTR,Wn.iconRightTriangleArrow),o=i?this.classes(Wn.mediaIcon,Wn.mediaPreviousIconRTL,Wn.iconRightTriangleArrow):this.classes(Wn.mediaIcon,Wn.mediaNextIconRTL,Wn.iconLeftTriangleArrow),a=i?"media-previous":"media-next",l=i?this._previous:this._next;return ce("button",{type:"button",key:a,title:r,"aria-label":r,tabIndex:0,class:s,bind:this,onclick:l},ce("span",{"aria-hidden":"true",class:n}),ce("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:i}=this.viewModel;return e&&(i!=null&&i.featureReduction)&&"renderer"in i.featureReduction?i.featureReduction.renderer:i==null?void 0:i.renderer}async _getRendererColors(e){const{am4core:i}=e,r=new Map,s=this._getRenderer(),n="default";if(!s)return r;const o=await est(s);return o.delete(n),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(r.set(bue,i.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&r.set(a,i.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),r}_handleMediaKeyup(e){const i=AT(e);i==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:i}=this.viewModel,{chartsModule:r,chartDiv:s,mediaInfo:n,colorMap:o}=e,{value:a,type:l}=n,{am4core:c}=r,h=Int(c);function d(g){g instanceof c.ColorSet&&h&&(g.list=h)}zU()&&c.useTheme(r.am4themes_dark);const f=window.matchMedia("(prefers-reduced-motion: reduce)");i.chartAnimation&&!f.matches?c.useTheme(r.am4themes_animated):c.unuseTheme(r.am4themes_animated),c.useTheme(d);const m=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);s.setAttribute("aria-label",n.altText||n.title),m.data=a.series.map(g=>({[Cv]:g.tooltip,[IO]:g.value,[Ky]:o.get(g.fieldName)})).filter(g=>l!=="pie-chart"||g.value!=null&&g.value>0)}_customizeChartTooltip(e,i){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=i.color("#ffffff"),e.background.fill=i.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:i,chartsModule:r}=e,{am4core:s,am4charts:n}=r,o=s.create(i,n.PieChart);o.rtl=ty(this.container);const a=o.series.push(new n.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=IO,a.dataFields.category=Cv,this._customizeChartTooltip(a.tooltip,s),a.slices.template.propertyFields.fill=Ky,a.slices.template.propertyFields.stroke=Ky,o}_getMinSeriesValue(e){let i=0;return e.forEach(r=>i=Math.min(r.value,i)),i}_createColumnChart(e,i){const{chartsModule:r,mediaInfo:s}=i,{value:n}=s,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Cv,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),d=h.renderer.labels.template;h.renderer.minLabelPosition=b7,h.renderer.maxLabelPosition=w7,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),d.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueY=IO,f.dataFields.categoryX=Cv,f.columns.template.propertyFields.fill=Ky,f.columns.template.propertyFields.stroke=Ky,e.cursor=new a.XYCursor,n.series.length>x7&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,i){const{chartsModule:r,mediaInfo:s}=i,{value:n}=s,{am4core:o,am4charts:a}=r,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=Cv,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new a.ValueAxis),d=h.renderer.labels.template;h.renderer.minLabelPosition=b7,h.renderer.maxLabelPosition=w7,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),d.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueX=IO,f.dataFields.categoryY=Cv,f.columns.template.propertyFields.fill=Ky,f.columns.template.propertyFields.stroke=Ky,e.cursor=new a.XYCursor,n.series.length>x7&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,i){const{chartsModule:r,mediaInfo:s,colorMap:n}=i,{value:o}=s,{am4core:a,am4charts:l}=r,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=Cv,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,a),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const d=e.yAxes.push(new l.ValueAxis),f=d.renderer.labels.template;d.renderer.minLabelPosition=b7,d.renderer.maxLabelPosition=w7,d.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(d.tooltip,a),f.wrap=!0;const m=e.series.push(new l.LineSeries);m.dataFields.categoryX=Cv,m.dataFields.valueY=IO,m.strokeWidth=1;const g=n.get(bue);g&&(m.stroke=g);const y=m.bullets.push(new l.CircleBullet);y.propertyFields.fill=Ky,y.propertyFields.stroke=Ky,e.cursor=new l.XYCursor,o.series.length>x7&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:i,chartsModule:r,mediaInfo:s}=e,{type:n}=s,{am4core:o,am4charts:a}=r,l=o.create(i,a.XYChart);return l.rtl=ty(this.container),n==="column-chart"&&this._createColumnChart(l,e),n==="bar-chart"&&this._createBarChart(l,e),n==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const i=Date.now();this._refreshIntervalInfo={timestamp:i,sourceURL:e&&this._getImageSource(e,i)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:i,value:r}=e;if(!i)return;const s=6e4*i;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,i){const r=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${r}timestamp=${i}${n?"#":""}${n}`}};u([p()],Ru.prototype,"attributes",null),u([p()],Ru.prototype,"activeMediaInfoIndex",null),u([p()],Ru.prototype,"description",null),u([p()],Ru.prototype,"fieldInfoMap",null),u([p()],Ru.prototype,"layer",null),u([p()],Ru.prototype,"mediaInfos",null),u([p()],Ru.prototype,"popupTemplate",null),u([p()],Ru.prototype,"relatedInfos",null),u([p()],Ru.prototype,"title",null),u([p({type:s2})],Ru.prototype,"viewModel",void 0),u([p(),za("esri/widgets/Feature/t9n/Feature")],Ru.prototype,"messages",void 0),Ru=u([N("esri.widgets.Feature.FeatureMedia")],Ru);const OEe=Ru;var yX;let pP=yX=class extends Ae{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new yX({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],pP.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],pP.prototype,"maxValue",void 0),pP=yX=u([N("esri.renderer.support.AuthoringInfoClassBreakInfo")],pP);var _X;let q1=_X=class extends Ae{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new _X({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ue(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],q1.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],q1.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],q1.prototype,"label",void 0),u([p({type:[pP],json:{write:!0}})],q1.prototype,"classBreakInfos",void 0),q1=_X=u([N("esri.renderers.support.AuthoringInfoFieldInfo")],q1);var vX;const NN=new Hi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),FN=new Hi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),wue={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},xue=["high-to-low","above-and-below","centered-on","extremes"],Tue=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Sue=["seconds","minutes","hours","days","months","years"];let Pu=vX=class extends Ae{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new vX({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:wue,json:{write:!0}})],Pu.prototype,"endTime",void 0),u([pi("endTime")],Pu.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],Pu.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],Pu.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],Pu.prototype,"minSliderValue",void 0),u([p({types:wue,json:{write:!0}})],Pu.prototype,"startTime",void 0),u([pi("startTime")],Pu.prototype,"castStartTime",null),u([p({type:NN.apiValues,value:null,json:{type:NN.jsonValues,read:NN.read,write:NN.write}})],Pu.prototype,"style",null),u([p({type:Tue,value:null,json:{type:Tue,origins:{"web-scene":{type:xue,write:{writer:(t,e)=>{xue.includes(t)&&(e.theme=t)}}}},write:!0}})],Pu.prototype,"theme",null),u([p({type:FN.apiValues,json:{type:FN.jsonValues,read:FN.read,write:FN.write}})],Pu.prototype,"type",void 0),u([p({type:Sue,json:{type:Sue,write:!0}})],Pu.prototype,"units",void 0),Pu=vX=u([N("esri.renderers.support.AuthoringInfoVisualVariable")],Pu);const $nt=Pu;let d6=class extends Ae{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],d6.prototype,"type",void 0),d6=u([N("esri.rest.support.ColorRamp")],d6);const Tie=d6;var bX;let Bx=bX=class extends Tie{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new bX({fromColor:ue(this.fromColor),toColor:ue(this.toColor),algorithm:this.algorithm})}};u([It({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Bx.prototype,"algorithm",void 0),u([p({type:et,json:{type:[Fr],write:!0}})],Bx.prototype,"fromColor",void 0),u([p({type:et,json:{type:[Fr],write:!0}})],Bx.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],Bx.prototype,"type",void 0),Bx=bX=u([N("esri.rest.support.AlgorithmicColorRamp")],Bx);const Sie=Bx;var wX;let fP=wX=class extends Tie{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new wX({colorRamps:ue(this.colorRamps)})}};u([p({type:[Sie],json:{write:!0}})],fP.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],fP.prototype,"type",void 0),fP=wX=u([N("esri.rest.support.MultipartColorRamp")],fP);const REe=fP,Lnt={key:"type",base:Tie,typeMap:{algorithmic:Sie,multipart:REe}};function Dnt(t){return t&&t.type?t.type==="algorithmic"?Sie.fromJSON(t):t.type==="multipart"?REe.fromJSON(t):null:null}var xX;const Iw=new Hi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),UN=new Hi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Eue=new Hi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Cue=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],Nnt=["high-to-low","above-and-below","above","below","90-10"],Fnt=["flow-line","wave-front"],Unt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Xn=xX=class extends Ae{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Dnt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new xX({classificationMethod:this.classificationMethod,colorRamp:ue(this.colorRamp),fadeRatio:ue(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ue(this.field1),field2:ue(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:Iw.apiValues,value:null,json:{type:Iw.jsonValues,read:Iw.read,write:Iw.write,origins:{"web-document":{default:"manual",type:Iw.jsonValues,read:Iw.read,write:Iw.write}}}})],Xn.prototype,"classificationMethod",null),u([p({types:Lnt,json:{write:!0}})],Xn.prototype,"colorRamp",void 0),u([De("colorRamp")],Xn.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],Xn.prototype,"fields",null),u([p({type:q1,value:null,json:{write:!0}})],Xn.prototype,"field1",null),u([p({type:q1,value:null,json:{write:!0}})],Xn.prototype,"field2",null),u([p({type:Fnt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Xn.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:Fr,write:!0}})],Xn.prototype,"numClasses",null),u([p({type:Cue,json:{type:Cue,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Xn.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Xn.prototype,"standardDeviationInterval",null),u([p({type:UN.apiValues,value:null,json:{type:UN.jsonValues,read:UN.read,write:UN.write,origins:{"web-scene":{type:Eue.jsonValues,write:{writer:Eue.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Xn.prototype,"type",null),u([p({type:[$nt],json:{write:!0}})],Xn.prototype,"visualVariables",void 0),u([p({type:Unt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"univariateSymbolStyle",null),u([p({type:Nnt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"univariateTheme",null),Xn=xX=u([N("esri.renderers.support.AuthoringInfo")],Xn);const Eie=Xn,T7=new Hi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let mP=class extends Ae{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:Eie,json:{write:!0}})],mP.prototype,"authoringInfo",void 0),u([p({type:T7.apiValues,readOnly:!0,json:{type:T7.jsonValues,read:!1,write:{writer:T7.write,ignoreOrigin:!0}}})],mP.prototype,"type",void 0),mP=u([N("esri.renderers.Renderer")],mP);const iv=mP;function knt(t){var e,i;return((i=(e=t.match(Vnt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const Vnt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var TX;let ZM=TX=class extends Ae{constructor(){super(...arguments),this.title=null}clone(){return new TX({title:this.title})}};u([p({type:String,json:{write:!0}})],ZM.prototype,"title",void 0),ZM=TX=u([N("esri.renderers.support.LegendOptions")],ZM);var SX;let p6=SX=class extends ZM{constructor(){super(...arguments),this.showLegend=null}clone(){return new SX({title:this.title,showLegend:this.showLegend})}};u([p({type:Boolean,json:{write:!0}})],p6.prototype,"showLegend",void 0),p6=SX=u([N("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],p6);const PEe=p6,S7=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Ef=class extends Ae{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(le.getLogger(this.declaredClass).error(".field: field must be a string value"),null):BL(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],Ef.prototype,"index",void 0),u([p({type:S7.apiValues,readOnly:!0,json:{read:S7.read,write:S7.write}})],Ef.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Ef.prototype,"field",void 0),u([pi("field")],Ef.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Ef.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Ef.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],Ef.prototype,"arcadeRequired",null),u([p({type:PEe,json:{write:!0}})],Ef.prototype,"legendOptions",void 0),Ef=u([N("esri.renderers.visualVariables.VisualVariable")],Ef);const cD=Ef;var EX;let Gx=EX=class extends cD{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new EX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],Gx.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],Gx.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Gx.prototype,"normalizationField",void 0),u([p({type:[Hit],json:{write:!0}})],Gx.prototype,"stops",null),Gx=EX=u([N("esri.renderers.visualVariables.ColorVariable")],Gx);const IEe=Gx;var CX;let x1=CX=class extends Ae{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return S$(e.transparency)}writeOpacity(t,e,i){e[i]=Vk(t)}clone(){return new CX({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],x1.prototype,"label",void 0),u([p({type:Number,json:{type:Fr,write:{target:"transparency"}}})],x1.prototype,"opacity",void 0),u([De("opacity",["transparency"])],x1.prototype,"readOpacity",null),u([Xe("opacity")],x1.prototype,"writeOpacity",null),u([p({type:Number,json:{write:!0}})],x1.prototype,"value",void 0),x1=CX=u([N("esri.renderers.visualVariables.support.OpacityStop")],x1);const znt=x1;var MX;let jx=MX=class extends cD{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new MX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],jx.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],jx.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],jx.prototype,"normalizationField",void 0),u([p({type:[znt],json:{write:!0}})],jx.prototype,"stops",null),jx=MX=u([N("esri.renderers.visualVariables.OpacityVariable")],jx);const $Ee=jx;var AX;let M0=AX=class extends cD{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new J("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new AX({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([p({readOnly:!0})],M0.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],M0.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],M0.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],M0.prototype,"rotationType",void 0),u([p({type:String,json:{write:!0}})],M0.prototype,"valueExpressionTitle",void 0),u([Xe("web-scene","valueExpressionTitle")],M0.prototype,"writeValueExpressionTitleWebScene",null),M0=AX=u([N("esri.renderers.visualVariables.RotationVariable")],M0);const LEe=M0;var OX;let EC=OX=class extends Ae{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new OX({label:this.label,size:this.size,value:this.value})}};u([p({type:String,json:{write:!0}})],EC.prototype,"label",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],EC.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],EC.prototype,"value",void 0),EC=OX=u([N("esri.renderers.visualVariables.support.SizeStop")],EC);const CC=EC;var RX;let f6=RX=class extends PEe{constructor(){super(...arguments),this.customValues=null}clone(){return new RX({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([p({type:[Number],json:{write:!0}})],f6.prototype,"customValues",void 0),f6=RX=u([N("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],f6);const Bnt=f6;var w_,Na;function wb(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function V$(t){return t!=null&&!isNaN(t)&&isFinite(t)}function DEe(t){return t.valueExpression?w_.Expression:t.field&&typeof t.field=="string"?w_.Field:w_.Unknown}function Gnt(t,e){const i=e||DEe(t),r=t.valueUnit||"unknown";return i===w_.Unknown?Na.Constant:t.stops?Na.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Na.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Na.Proportional:Na.Additive:Na.Identity:Na.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(w_||(w_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Na||(Na={}));const BA={inches:Zr(1,"meters","inches"),feet:Zr(1,"meters","feet"),"us-feet":Zr(1,"meters","us-feet"),yards:Zr(1,"meters","yards"),miles:Zr(1,"meters","miles"),"nautical-miles":Zr(1,"meters","nautical-miles"),millimeters:Zr(1,"meters","millimeters"),centimeters:Zr(1,"meters","centimeters"),decimeters:Zr(1,"meters","decimeters"),meters:Zr(1,"meters","meters"),kilometers:Zr(1,"meters","kilometers"),"decimal-degrees":1/swe(1,"meters",zi.radius)},Qb=le.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Mue=new Ho,m6=Math.PI,NEe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function FEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Qb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(A(i)||A(i.arcade))return void Qb.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),x=y.createExecContext(n,v);if(!d){const S=y.createSyntaxTree(r.valueExpression);d=y.createFunction(S),r.cache.compiledFunc=d}a=y.executeFunction(d,x)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Mie(a,c);if(g){const y=g[0],v=g[1],x=y===v?r.stops[y].color:et.blendColors(r.stops[y].color,r.stops[v].color,g[2],b(i)?i.color:void 0);return new et(x)}}}function UEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Qb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(A(i)||A(i.arcade))return void Qb.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),x=y.createExecContext(n,v);if(!d){const S=y.createSyntaxTree(r.valueExpression);d=y.createFunction(S),r.cache.compiledFunc=d}a=y.executeFunction(d,x)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Mie(a,c);if(g){const y=g[0],v=g[1];if(y===v)return r.stops[y].opacity;{const x=r.stops[y].opacity;return x+(r.stops[v].opacity-x)*g[2]}}}}function kEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Qb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(A(i)||A(i.arcade))return void Qb.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(m),v=g.createExecContext(a,y);if(!d){const x=g.createSyntaxTree(r.valueExpression);d=g.createFunction(x),r.cache.compiledFunc=d}f=g.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function jnt(t,e,i){const r=typeof e=="number",s=r?null:e,n=s&&s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=b(i)?i.scale:void 0,d=b(i)?i.view:void 0;o=h==null||d==="3d"?Hnt(t):h}else if(!r)switch(t.inputValueType){case w_.Expression:{if(A(i)||A(i.arcade))return void Qb.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(s,f);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case w_.Field:n&&(o=n[t.field]);break;case w_.Unknown:o=null}if(!V$(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return V$(c)&&c!==0?o/c:null}function Hnt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function EV(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Qb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=zEe(jnt(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function oh(t,e,i){return t==null?null:wb(t)?EV(t,e,i):V$(t)?t:null}function VEe(t,e,i){return V$(i)&&t>i?i:V$(e)&&t<e?e:t}function qnt(t,e,i,r){return t+((oh(e.minSize,i,r)||e.minDataValue)??0)}function Wnt(t,e,i){const r=t.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=t.minSize),oh(s,e,i)}function Ynt(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=oh(e.minSize,i,r),o=oh(e.maxSize,i,r),a=b(r)?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?m6*(n/2)**2:n*n,h=c+s*((l?m6*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/m6):Math.sqrt(h)}return n+s*(o-n)}function Xnt(t,e,i,r){const s=b(r)?r.shape:void 0,n=t/e.minDataValue,o=oh(e.minSize,i,r),a=oh(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,VEe(l,o,a)}function Znt(t,e,i,r,s){var l,c,h;const[n,o,a]=Mie(t,s);if(n===o)return oh((l=e.stops)==null?void 0:l[n].size,i,r);{const d=oh((c=e.stops)==null?void 0:c[n].size,i,r);return d+(oh((h=e.stops)==null?void 0:h[o].size,i,r)-d)*a}}function Jnt(t,e,i,r){const s=(b(r)&&r.resolution?r.resolution:1)*BA[e.valueUnit],n=oh(e.minSize,i,r),o=oh(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/m6)/s:a==="radius"||a==="distance"?2*t/s:t/s,VEe(l,n,o)}function zEe(t,e,i,r,s){switch(e.transformationType){case Na.Additive:return qnt(t,e,i,r);case Na.Constant:return Wnt(e,i,r);case Na.ClampedLinear:return Ynt(t,e,i,r);case Na.Proportional:return Xnt(t,e,i,r);case Na.Stops:return Znt(t,e,i,r,s);case Na.RealWorldSize:return Jnt(t,e,i,r);case Na.Identity:return t;case Na.Unknown:return null}}function Knt(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=oh(t.minSize,Mue,s),o=oh(t.maxSize,Mue,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Cie(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=FEe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=UEe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=kEe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=EV(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Mie(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Qnt(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":EV(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const Aie=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Qnt,getColor:FEe,getOpacity:UEe,getRotationAngle:kEe,getSize:EV,getSizeForValue:zEe,getSizeFromNumberOrVariable:oh,getSizeRangeAtScale:Knt,getVisualVariableValues:Cie,viewScaleRE:NEe},Symbol.toStringTag,{value:"Module"}));var PX;const kN=new Hi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),IX=new Hi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Aue(t){if(t!=null)return typeof t=="string"||typeof t=="number"?kr(t):t.type==="size"?wb(t)?t:(delete(t={...t}).type,new Yr(t)):void 0}function Oue(t,e,i){if(typeof t!="object")return t;const r=new Yr;return r.read(t,i),r}let Yr=PX=class extends cD{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&NEe.test(this.valueExpression)}}set expression(t){le.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){wb(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),wb(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return DEe(this)}set maxDataValue(t){t&&this.stops&&(le.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(le.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Aue(t)}readMaxSize(t,e,i){return Oue(t,e,i)}set minDataValue(t){t&&this.stops&&(le.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(le.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Aue(t)}readMinSize(t,e,i){return Oue(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(le.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Gnt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new J("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?IX.read(t):null}clone(){return new PX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:wb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:wb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Na.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Na.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],Yr.prototype,"cache",null),u([p({type:kN.apiValues,json:{type:kN.jsonValues,origins:{"web-map":{read:!1}},read:kN.read,write:kN.write}})],Yr.prototype,"axis",void 0),u([p({type:String,value:null,json:{read:!1}})],Yr.prototype,"expression",null),u([p()],Yr.prototype,"index",null),u([p({type:String,readOnly:!0})],Yr.prototype,"inputValueType",null),u([p({type:Bnt,json:{write:!0}})],Yr.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],Yr.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Yr.prototype,"maxSize",null),u([pi("maxSize")],Yr.prototype,"castMaxSize",null),u([De("maxSize")],Yr.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],Yr.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Yr.prototype,"minSize",null),u([pi("minSize")],Yr.prototype,"castMinSize",null),u([De("minSize")],Yr.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],Yr.prototype,"normalizationField",void 0),u([p({readOnly:!0})],Yr.prototype,"arcadeRequired",null),u([p({type:String})],Yr.prototype,"scaleBy",void 0),u([p({type:[CC],value:null,json:{write:!0}})],Yr.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],Yr.prototype,"target",void 0),u([p({type:String,readOnly:!0})],Yr.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],Yr.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Yr.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],Yr.prototype,"valueExpression",void 0),u([De("valueExpression",["valueExpression","expression"])],Yr.prototype,"readValueExpression",null),u([Xe("web-scene","valueExpression")],Yr.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Yr.prototype,"valueRepresentation",void 0),u([p({type:IX.apiValues,json:{write:IX.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Yr.prototype,"valueUnit",void 0),u([De("valueUnit")],Yr.prototype,"readValueUnit",null),Yr=PX=u([N("esri.renderers.visualVariables.SizeVariable")],Yr);const CV=Yr,eot={color:IEe,size:CV,opacity:$Ee,rotation:LEe},tot=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),iot=/^\[([^\]]+)\]$/i;let g6=class extends Ee{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(i=>!!i))&&e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s&&s.match(iot),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=tot.read(l.type),h=eot[c];h||(le.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),r&&r.messages&&r.messages.push(new Np("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new h;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],g6.prototype,"visualVariables",null),g6=u([N("esri.renderers.visualVariables.VisualVariableFactory")],g6);const rot=g6,sot={base:cD,key:"type",typeMap:{opacity:$Ee,color:IEe,rotation:LEe,size:CV}},I3=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new rot}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&pd(i,r,n.field),n.normalizationField&&pd(i,r,n.normalizationField),n.valueExpression&&(not(n.valueExpression,i,r)||await pu(i,r,n.valueExpression)))}};return u([p({types:[sot],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([De("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([Xe("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([N("esri.renderers.mixins.VisualVariablesMixin")],e),e};function not(t,e,i){const r=knt(t);return!!b(r)&&(pd(e,i,r),!0)}const $O={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function oot(t,e=$O){var a,l;if(!t)return{symbol:null};const{retainId:i=$O.retainId,ignoreDrivers:r=$O.ignoreDrivers,hasLabelingContext:s=$O.hasLabelingContext,retainCIM:n=$O.retainCIM}=e;let o=null;if(B2(t)||t instanceof SS)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new J("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():fb.fromCIMSymbol(t)}else if(t instanceof uh)o=tV.fromSimpleLineSymbol(t);else if(t instanceof gm)o=fb.fromSimpleMarkerSymbol(t);else if(t instanceof rV)o=fb.fromPictureMarkerSymbol(t);else if(t instanceof Cy)o=e.geometryType&&e.geometryType==="mesh"?iV.fromSimpleFillSymbol(t):eD.fromSimpleFillSymbol(t);else{if(!(t instanceof E3))return{error:new J("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?eV.fromTextSymbol(t):fb.fromTextSymbol(t)}if(i&&o&&o.type!=="cim"&&(o.id=t.id),r&&B2(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function BU(t,e,i,r){const s=BEe(t,{},{context:r,isLabelSymbol:!1});b(s)&&(e[i]=s)}function Rue(t,e,i,r){const s=BEe(t,{},{context:r,isLabelSymbol:!0});b(s)&&(e[i]=s)}function Pue(t){return t instanceof S3||t instanceof SS}function BEe(t,e,i){if(A(t))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!Pue(t)){const a=oot(t,{retainCIM:!0,hasLabelingContext:s});return b(a.symbol)?a.symbol.write(e,r):(o==null||o.push(new J("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!Cwe(r==null?void 0:r.layer))&&Pue(t)?(o==null||o.push(new J("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function SHt(t,e){return gJe(t,null,e)}const $3={types:nV,json:{write:{writer:BU},origins:{"web-scene":{types:Ble,write:{writer:BU},read:{reader:gw({types:Ble})}}}}},GEe={types:{base:yh,key:"type",typeMap:{"simple-fill":Hu.typeMap["simple-fill"],"picture-fill":Hu.typeMap["picture-fill"],"polygon-3d":Hu.typeMap["polygon-3d"]}},json:{write:{writer:BU},origins:{"web-scene":{type:eD,write:{writer:BU}}}}},y6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var $X;let T1=$X=class extends Ae{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new $X({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],T1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],T1.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],T1.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],T1.prototype,"maxValue",void 0),u([p($3)],T1.prototype,"symbol",void 0),T1=$X=u([N("esri.renderers.support.ClassBreakInfo")],T1);const GU=T1;var LX;const jEe="log",_6="percent-of-total",v6="field",VN=new Hi({esriNormalizeByLog:jEe,esriNormalizeByPercentOfTotal:_6,esriNormalizeByField:v6}),aot=Vn(GU);let Ko=LX=class extends I3(iv){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new GU;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(le.getLogger(this.declaredClass).error(".field: field must be a string value"),null):BL(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&v6||i&&_6||null,e&&i&&le.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==v6&&t!==_6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new GU({minValue:t,maxValue:e,symbol:ETe(i)}):aot(ue(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(A(e)||A(e.arcade))&&le.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(A(e)||A(e.arcade))&&(i={...i,arcade:await Am()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(A(e)||A(e.arcade)))return void le.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(A(e)||A(e.arcade))){const s=await Am(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new LX({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ue(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ue(this.visualVariables),legendOptions:ue(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),pu(t,e,this.valueExpression)];pd(t,e,this.field),pd(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===jEe)s=Math.log(s)*Math.LOG10E;else if(r!==_6||n==null||isNaN(n)){if(r===v6&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([p(GEe)],Ko.prototype,"backgroundFillSymbol",void 0),u([p({type:[GU]})],Ko.prototype,"classBreakInfos",void 0),u([De("classBreakInfos")],Ko.prototype,"readClassBreakInfos",null),u([Xe("classBreakInfos")],Ko.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],Ko.prototype,"defaultLabel",void 0),u([p($3)],Ko.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],Ko.prototype,"field",void 0),u([pi("field")],Ko.prototype,"castField",null),u([p({type:Boolean})],Ko.prototype,"isMaxInclusive",void 0),u([p({type:ZM,json:{write:!0}})],Ko.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Ko.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],Ko.prototype,"normalizationField",void 0),u([p({type:Number,cast:t=>mp(t),json:{write:!0}})],Ko.prototype,"normalizationTotal",void 0),u([p({type:VN.apiValues,value:null,json:{type:VN.jsonValues,read:VN.read,write:VN.write}})],Ko.prototype,"normalizationType",null),u([It({classBreaks:"class-breaks"})],Ko.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Ko.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Ko.prototype,"valueExpressionTitle",void 0),Ko=LX=u([N("esri.renderers.ClassBreaksRenderer")],Ko);const HEe=Ko;let lot=class{constructor(e,i){this._storage=new die,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i,r){this._storage.put(e,i,r,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const Iue="esri.renderers.support.DictionaryLoader",cot={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Oie=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new lot(100),this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(kn(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&e.attributes[g]!=null){const y=""+e.attributes[g];s[m]=y}else s[m]=""}const n=r==null?void 0:r(s,i);if(!n||typeof n!="string")return null;const o=uee(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const y=g[0],v=g[1];let x=g[2];if(v==="DashTemplate")x=x.split(" ").map(S=>Number(S));else if(v==="Color"){const S=new et(x).toRgba();x=[S[0],S[1],S[2],255*S[3]]}else x=Number(x);h.push({primitiveName:y,propertyName:v,value:x})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const d=!b(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,d,i);return this._symbolCache.put(o,f,1),f}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void le.getLogger(Iue).error("no valid URL!");const i=tr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:b(e)?e.signal:null}),[{data:r}]=await Promise.all([i,Am()]);if(!r)throw this._dictionaryPromise=null,new J("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(b(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],d=e.fields.filter(f=>f.name===h);d.length>0&&a.push({...d[0],name:c})}const l=MXe(s,b(e)?e.spatialReference:null,a,o).then(c=>{const h={scale:0};return(d,f)=>{if(A(c))return null;const m=c.repurposeFeature({geometry:null,attributes:d});return h.scale=b(f)?f.scale??void 0:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(le.getLogger(Iue).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,i,r,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)qEe(l,a);return new x3({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(e,i){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),s=tr(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,i,r){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=cot),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}};function qEe(t,e){if(!t)return;const i=t.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&uot(s,e)}}function uot(t,e){const i=t.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":qEe(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const MHt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Oie},Symbol.toStringTag,{value:"Module"}));var DX;let Cf=DX=class extends I3(iv){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Oie(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new DX({config:ue(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ue(this.fieldMap),url:ue(this.url),visualVariables:ue(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await pu(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:Oie})],Cf.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Cf.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],Cf.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Cf.prototype,"scaleExpression",void 0),u([Xe("scaleExpression")],Cf.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Cf.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],Cf.prototype,"url",void 0),u([Xe("visualVariables")],Cf.prototype,"writeVisualVariables",null),Cf=DX=u([N("esri.renderers.DictionaryRenderer")],Cf);const hot=Cf;var NX;let A0=NX=class extends Ae{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(le.getLogger(this.declaredClass).error(".field: field must be a string value"),null):BL(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new NX({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:et,json:{type:[Number],write:!0}})],A0.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],A0.prototype,"field",void 0),u([pi("field")],A0.prototype,"castField",null),u([p({type:String,json:{write:!0}})],A0.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],A0.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],A0.prototype,"valueExpressionTitle",void 0),A0=NX=u([N("esri.renderers.support.AttributeColorInfo")],A0);const WEe=A0;var FX;let b6=FX=class extends Ae{constructor(){super(...arguments),this.unit=null}clone(){return new FX({unit:this.unit})}};u([p({type:String,json:{write:!0}})],b6.prototype,"unit",void 0),b6=FX=u([N("esri.renderers.support.DotDensityLegendOptions")],b6);const dot=b6;var UX;let Iu=UX=class extends I3(iv){constructor(t){super(t),this.attributes=null,this.backgroundColor=new et([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new uh,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Cy({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new UX({attributes:ue(this.attributes),backgroundColor:ue(this.backgroundColor),dotBlendingEnabled:ue(this.dotBlendingEnabled),dotShape:ue(this.dotShape),dotSize:ue(this.dotSize),dotValue:ue(this.dotValue),legendOptions:ue(this.legendOptions),outline:ue(this.outline),referenceScale:ue(this.referenceScale),visualVariables:ue(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await pu(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([p({type:[WEe],json:{write:!0}})],Iu.prototype,"attributes",void 0),u([p({type:et,json:{write:!0}})],Iu.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],Iu.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],Iu.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],Iu.prototype,"dotSize",void 0),u([p({type:dot,json:{write:!0}})],Iu.prototype,"legendOptions",void 0),u([p({type:uh,json:{default:null,write:!0}})],Iu.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],Iu.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],Iu.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],Iu.prototype,"seed",void 0),u([It({dotDensity:"dot-density"})],Iu.prototype,"type",void 0),Iu=UX=u([N("esri.renderers.DotDensityRenderer")],Iu);const pot=Iu;let MC=class extends hn(Ae){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],MC.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],MC.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],MC.prototype,"title",void 0),MC=u([N("esri.renderers.support.HeatmapLegendOptions")],MC);function Ai(){return[0,0,0,0]}function uD(t){return[t[0],t[1],t[2],t[3]]}function di(t,e,i,r){return[t,e,i,r]}function Rie(t){const e=Ai(),i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function YEe(t,e){return new Float64Array(t,e,4)}function XEe(){return Ai()}function ZEe(){return di(1,1,1,1)}function JEe(){return di(1,0,0,0)}function KEe(){return di(0,1,0,0)}function QEe(){return di(0,0,1,0)}function eCe(){return di(0,0,0,1)}const fy=XEe(),Tp=ZEe(),fot=JEe(),mot=KEe(),got=QEe(),yot=eCe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Tp,UNIT_W:yot,UNIT_X:fot,UNIT_Y:mot,UNIT_Z:got,ZEROS:fy,clone:uD,create:Ai,createView:YEe,fromArray:Rie,fromValues:di,ones:ZEe,unitW:eCe,unitX:JEe,unitY:KEe,unitZ:QEe,zeros:XEe},Symbol.toStringTag,{value:"Module"}));const Pie=2.4;function _ot(t){return Up(t*Pie)}function vot(t){return ka(t)/Pie}function bot(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Se((r-n)/(a-n),0,1);kk(t,s.toArray(),o.toArray(),l)}function OHt(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=Ai();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];bot(o,r,s,l),i.set(o,4*a)}return i}function RHt(t,e,i,r){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(ka(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const d=Tot(o,n),f=new Set;for(const m of t){const g=m.getCursor();for(;g.next();){const y=g.getObjectId();if(f.has(y))continue;f.add(y);const v=g.readLegacyPointGeometry(),x=128;if(v.x<-x||v.x>=i+x||v.y<-x||v.y>r+x)continue;const S=+d(g),E=Math.max(0,Math.round(v.x)-a),C=Math.max(0,Math.round(v.y)-a),R=Math.min(r,Math.round(v.y)+a),O=Math.min(i,Math.round(v.x)+a);for(let U=C;U<R;U++)for(let L=E;L<O;L++){const B=U*i+L,G=xot(v.x-L,v.y-U,a);c=l[B]+=G*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function PHt(t,e,i,r,s,n){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const o=t.getImageData(0,0,e,e);i&&r&&o.data.set(new Uint8ClampedArray(wot(e,i,r,s,n))),t.putImageData(o,0,0)}function wot(t,e,i,r,s){const n=new Uint32Array(t*t),o="buffer"in e?e:new Float64Array(e),a="buffer"in i?new Uint32Array(i.buffer):new Uint32Array(new Uint8Array(i).buffer),l=a.length/(s-r);for(let c=0;c<o.length;c++){const h=o[c],d=Math.floor((h-r)*l);n[c]=a[Se(d,0,a.length-1)]}return n.buffer}function xot(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function IHt(t,e){return typeof t=="function"?t:t?typeof e=="string"?i=>-1*+i[t]:i=>+i[t]+e:()=>1}function Tot(t,e){return t!=null?typeof e=="string"?i=>-1*+i.readAttribute(t):i=>+i.readAttribute(t)+e:i=>1}var kX;const tCe="esri.renderers.HeatmapRenderer",Sot=le.getLogger(tCe);function $ue(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let Ra=kX=class extends iv{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new RI({ratio:0,color:new et("rgba(255, 140, 0, 0)")}),new RI({ratio:.75,color:new et("rgba(255, 140, 0, 1)")}),new RI({ratio:.9,color:new et("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return $ue(t)}get blurRadius(){return vot(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",_ot(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Pie**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||ga(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,yS(()=>{mq(Sot,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=$ue(t),super.read(t,e)}getSymbol(){return new gm}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await pd(t,e,i),r&&typeof r=="string"&&await pu(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new kX({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ue(this.colorStops),field:this.field,legendOptions:ue(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Eie,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ra.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ra.prototype,"blurRadius",null),u([p({type:[RI],json:{write:!0}})],Ra.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],Ra.prototype,"field",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],Ra.prototype,"fieldOffset",void 0),u([p({type:MC,json:{write:!0}})],Ra.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],Ra.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ra.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],Ra.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ra.prototype,"minPixelIntensity",null),u([p({type:Number,cast:kr,json:{write:!0}})],Ra.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],Ra.prototype,"referenceScale",void 0),u([It({heatmap:"heatmap"})],Ra.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ra.prototype,"valueExpression",void 0),u([p({type:String})],Ra.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],Ra.prototype,"_pixelIntensityToDensity",null),Ra=kX=u([N(tCe)],Ra);const iCe=Ra;let $T=class extends hn(Ae){constructor(){super(...arguments),this.color=new et([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:et,json:{write:!0}})],$T.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],$T.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],$T.prototype,"threshold",void 0),$T=u([N("esri.renderers.support.OthersCategory")],$T);let w6=class extends hn(Ae){constructor(){super(...arguments),this.title=null}};u([p({type:String,json:{write:!0}})],w6.prototype,"title",void 0),w6=u([N("esri.renderers.support.PieChartLegendOptions")],w6);let $h=class extends I3(hn(iv)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new et([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new $T,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new gm({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(b)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await pu(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([p({type:[WEe],json:{write:!0}})],$h.prototype,"attributes",void 0),u([p({type:Cy,json:{default:null,write:!0}})],$h.prototype,"backgroundFillSymbol",void 0),u([p({type:et,json:{write:!0}})],$h.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],$h.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],$h.prototype,"holePercentage",void 0),u([p({type:$T,json:{write:!0}})],$h.prototype,"othersCategory",void 0),u([p({type:w6,json:{write:!0}})],$h.prototype,"legendOptions",void 0),u([p({type:uh,json:{default:null,write:!0}})],$h.prototype,"outline",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],$h.prototype,"size",void 0),u([It({pieChart:"pie-chart"})],$h.prototype,"type",void 0),$h=u([N("esri.renderers.PieChartRenderer")],$h);const Eot=$h;var VX;let Hx=VX=class extends I3(iv){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new VX({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ue(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([p({type:String,json:{write:!0}})],Hx.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Hx.prototype,"label",void 0),u([p($3)],Hx.prototype,"symbol",void 0),u([It({simple:"simple"})],Hx.prototype,"type",void 0),Hx=VX=u([N("esri.renderers.SimpleRenderer")],Hx);const GA=Hx,Cot=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function zX(t){return t instanceof Ee}function Lue(t){return t instanceof xt?Object.keys(t.items):zX(t)?ga(t).keys():t?Object.keys(t):[]}function zN(t,e){return t instanceof xt?t.items[e]:t[e]}function Mot(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function $I(t){return t?t.declaredClass:null}function rCe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=Lue(t),s=Lue(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||Mot(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(d=>!r.includes(d)),o=r.filter(d=>!s.includes(d)),a=r.filter(d=>s.includes(d)&&zN(t,d)!==zN(e,d)).concat(n,o).sort(),l=$I(t);if(l&&Cot.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=zX(t)&&zX(e);for(const d of a){const f=zN(t,d),m=zN(e,d);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[d]&&typeof i[d]=="function")g=i[d](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&$I(f)===$I(m)?rCe(f,m):{type:"complete",oldValue:f,newValue:m};b(g)&&(b(c)?c.diff[d]=g:c={type:"partial",diff:{[d]:g}})}}return c}function Aot(t,e){if(A(t))return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function NHt(t,e){for(const i of e)if(Aot(t,i))return!0;return!1}function Oot(t,e){if(!(typeof t=="function"||typeof e=="function"||A(t)&&A(e)))return A(t)||A(e)||typeof t=="object"&&typeof e=="object"&&$I(t)!==$I(e)?{type:"complete",oldValue:t,newValue:e}:rCe(t,e)}function BN(t){if(A(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!BN(i))return!1;for(const i of e.removed)if(!BN(i))return!1;for(const i of e.changed)if(!BN(i))return!1;return!0}case"partial":for(const e in t.diff)if(!BN(t.diff[e]))return!1;return!0}}let AC=class extends hn(Ae){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(y6)],AC.prototype,"value",void 0),u([p(y6)],AC.prototype,"value2",void 0),u([p(y6)],AC.prototype,"value3",void 0),AC=u([N("esri.renderers.support.UniqueValue")],AC);const JM=AC;let S1=class extends hn(Ae){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new JM({value:r})):i==="object"?e[0]instanceof JM?e:e.map(r=>new JM(r)):null}};u([p({type:String,json:{write:!0}})],S1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],S1.prototype,"label",void 0),u([p($3)],S1.prototype,"symbol",void 0),u([p({type:[JM],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new JM({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(b).map(n=>n.toString());i.push(s)}e.values=i}}}})],S1.prototype,"values",void 0),u([pi("values")],S1.prototype,"castValues",null),S1=u([N("esri.renderers.support.UniqueValueClass")],S1);const sCe=S1;let gP=class extends hn(Ae){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],gP.prototype,"heading",void 0),u([p({type:[sCe],json:{write:!0}})],gP.prototype,"classes",void 0),gP=u([N("esri.renderers.support.UniqueValueGroup")],gP);const BX=gP;var GX;let qx=GX=class extends Ae{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new GX({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],qx.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],qx.prototype,"label",void 0),u([p($3)],qx.prototype,"symbol",void 0),u([p(y6)],qx.prototype,"value",void 0),qx=GX=u([N("esri.renderers.support.UniqueValueInfo")],qx);const LI=qx,Rot=()=>!!me("enable-feature:force-wosr"),VHt=()=>!!me("enable-feature:direct-3d-object-feature-layer-display"),zHt=()=>!!me("enable-feature:SceneLayer-editing");let E7={};async function Pot(t,e){try{return{data:(await Dot(t,e)).data,baseUrl:lqe(t),styleUrl:t}}catch(i){return Pl(i),null}}function Iot(t,e,i){const r=b(e.portal)?e.portal:du.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${t}`;return E7[n]||(E7[n]=$ot(t,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),E7[n]}function $ot(t,e,i){return e.load(i).then(()=>{const r=new a_({disableExtraQuery:!0,query:`owner:${Due} AND type:${Nue} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Nue&&a.owner===Due){s=a;break}}if(!s)throw new J("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function Lot(t,e,i){return t&&b(t.styleUrl)?Pot(t.styleUrl,i):t&&b(t.styleName)?Iot(t.styleName,e,i):Promise.reject(new J("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function BHt(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function GHt(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Rot()){for(const i of t.formatInfos)if(i.type==="gltf")return i.href}return t.webRef}function Dot(t,e){const i={responseType:"json",query:{f:"json"},...e};return tr(Op(t),i)}const Due="esri_en",Nue="Style",jHt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var yP;const nCe="esri.renderers.UniqueValueRenderer",Mv=le.getLogger(nCe),Fue="uvInfos-watcher",Uue="uvGroups-watcher",Not=",",Fot=Vn(LI);function Uot(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var x;const{symbol:c,label:h,value:d,description:f}=l,[m,g,y]=a?((x=d==null?void 0:d.toString())==null?void 0:x.split(s||""))||[]:[d],v=[];return(e||o)&&v.push(m),i&&v.push(g),r&&v.push(y),{symbol:c,label:h,values:[v],description:f}})}]}let An=yP=class extends I3(iv){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?Oot(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:BL(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r&&r.messages?r.messages.push(new J("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Mv.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||du.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=T3(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=z2(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?Mv.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Mv.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void Mv.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?Fot(t):new LI({value:t,symbol:ETe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Mv.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let i=0;i<e.length;i++)if(e[i].value===t+""){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(A(e)||A(e.arcade))&&(i={...i,arcade:await Am()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(A(e)||A(e.arcade)))return void Mv.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(A(i)||A(i.arcade))){const s=await Am(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new yP({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ue(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ue(this.visualVariables),legendOptions:ue(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ue(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ue(this.uniqueValueInfos),i=ue(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ue(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),pu(t,e,this.valueExpression)];pd(t,e,this.field),pd(t,e,this.field2),pd(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return Lot(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new SS({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new LI({value:r.name,symbol:s});e.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",Not)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Fue);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(ae(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Fue)}}_watchUniqueValueGroups(){this.removeHandles(Uue);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(ae(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(ae(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Uue)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const g of f??[]){const{value:y,value2:v,value3:x}=g,S=[y];i&&S.push(v),r&&S.push(x);const E=a?S.join(s||""):S[0];t.push(new LI({symbol:h,label:d,value:E,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var x;const{symbol:h,label:d,value:f,description:m}=c,[g,y,v]=o?((x=f==null?void 0:f.toString())==null?void 0:x.split(s||""))||[]:[f];return new sCe({symbol:h,label:d,description:m,values:[new JM({value:g,value2:y,value3:v})]})}),l=[new BX({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(e,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof e=="function"?r=e(t):e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new yP(e&&e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e&&e.portal||du.getDefault());const r=i.populateFromStyle();return r.catch(s=>{Mv.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new yP(e&&e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{Mv.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([p({readOnly:!0})],An.prototype,"_cache",null),u([It({uniqueValue:"unique-value"})],An.prototype,"type",void 0),u([p(GEe)],An.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],An.prototype,"field",null),u([pi("field")],An.prototype,"castField",null),u([Xe("field")],An.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],An.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],An.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],An.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],An.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],An.prototype,"valueExpressionTitle",void 0),u([p({type:ZM,json:{write:!0}})],An.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],An.prototype,"defaultLabel",void 0),u([p(z1e({...$3},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],An.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],An.prototype,"fieldDelimiter",null),u([p({type:du,readOnly:!0})],An.prototype,"portal",void 0),u([De("portal",["styleName"])],An.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],An.prototype,"styleOrigin",void 0),u([De("styleOrigin",["styleName","styleUrl"])],An.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],An.prototype,"writeStyleOrigin",null),u([p({type:[BX],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||Uot(e)).map(r=>BX.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],An.prototype,"uniqueValueGroups",null),u([p({type:[LI],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],An.prototype,"uniqueValueInfos",null),An=yP=u([N(nCe)],An);const hD=An,L3={key:"type",base:iv,typeMap:{heatmap:iCe,simple:GA,"unique-value":hD,"class-breaks":HEe,"dot-density":pot,dictionary:hot,"pie-chart":Eot},errorContext:"renderer"},Iie={key:"type",base:iv,typeMap:{simple:GA,"unique-value":hD,"class-breaks":HEe,heatmap:iCe},errorContext:"renderer"};function HHt(t,e){return z$(t,null,e)}const kot=gw({types:L3});function z$(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Np("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):kot(t,e,i):null}let Vot=class oCe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(pq),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new oCe,r=this._originStores[ht.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ue(s),ht.DEFAULTS)});for(let s=ht.SERVICE;s<pq;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,ue(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=ht.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=ht.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r&&r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||ht.DEFAULTS}forEach(e){this._values.forEach(e)}};const aCe=t=>{let e=class extends t{constructor(...i){super(...i);const r=ga(this),s=r.store,n=new Vot;r.store=n,Ibe(r,s,n)}read(i,r){Lbe(this,i,r)}getAtOrigin(i,r){const s=C7(this),n=Qu(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return y$(this.originIdOf(i))}originIdOf(i){return C7(this).originOf(i)}revert(i,r){const s=C7(this),n=Qu(r),o=ga(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([N("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function C7(t){return ga(t).store}let kue=class extends aCe(Ee){};kue=u([N("esri.core.ReadOnlyMultiOriginJSONSupport")],kue);const zot=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return M7(this).delete(i,Qu(r))}write(i={},r){return Fbe(this,i=i||{},r),i}setAtOrigin(i,r,s){ga(this).setAtOrigin(i,r,Qu(s))}removeOrigin(i){const r=M7(this),s=Qu(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),ht.USER)}updateOrigin(i,r){const s=M7(this),n=Qu(r),o=this.get(i);for(let a=n+1;a<pq;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=u([N("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function M7(t){return ga(t).store}const CS=t=>{let e=class extends zot(aCe(t)){constructor(...i){super(...i)}};return e=u([N("esri.core.MultiOriginJSONSupport")],e),e};let jX=class extends CS(Ee){};jX=u([N("esri.core.MultiOriginJSONSupport")],jX);async function Bot(t,e){const{WhereClause:i}=await se(()=>Promise.resolve().then(()=>ooe),void 0);return i.create(t,e)}function MV(t,e){return b(t)?b(e)?`(${t}) AND (${e})`:t:e}var HX;let Wx=HX=class extends Ae{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new HX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],Wx.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],Wx.prototype,"name",void 0),u([p({type:["boolean","date","number","string"],json:{write:!0}})],Wx.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],Wx.prototype,"title",void 0),Wx=HX=u([N("esri.form.ExpressionInfo")],Wx);const Got=Wx;let Yx=class extends Ae{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([p({type:String,json:{write:!0}})],Yx.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Yx.prototype,"label",void 0),u([p()],Yx.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Yx.prototype,"visibilityExpression",void 0),Yx=u([N("esri.form.elements.Element")],Yx);const jA=Yx;var qX;let x6=qX=class extends Ae{constructor(t){super(t),this.type=null}clone(){return new qX({type:this.type})}};u([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],x6.prototype,"type",void 0),x6=qX=u([N("esri.form.elements.inputs.AttachmentInput")],x6);const jot=x6;var WX;let Xx=WX=class extends jA{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new WX({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({type:String,json:{write:!0}})],Xx.prototype,"attachmentKeyword",void 0),u([p({type:Boolean,json:{write:!0}})],Xx.prototype,"editable",void 0),u([p({type:jot,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Xx.prototype,"input",void 0),u([p({type:["attachment"],json:{read:!1,write:!0}})],Xx.prototype,"type",void 0),Xx=WX=u([N("esri.form.elements.AttachmentElement")],Xx);const Vue=Xx;let T6=class extends Ae{constructor(e){super(e),this.type=null}};u([p()],T6.prototype,"type",void 0),T6=u([N("esri.form.elements.inputs.Input")],T6);const D3=T6;let _P=class extends D3{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([p({type:Number,json:{write:!0}})],_P.prototype,"maxLength",void 0),u([p({type:Number,json:{write:!0}})],_P.prototype,"minLength",void 0),_P=u([N("esri.form.elements.inputs.TextInput")],_P);const $ie=_P;var YX;let S6=YX=class extends $ie{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new YX({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],S6.prototype,"type",void 0),S6=YX=u([N("esri.form.elements.inputs.BarcodeScannerInput")],S6);const Hot=S6;var XX;let OC=XX=class extends D3{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new XX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([p({type:String,json:{write:!0}})],OC.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],OC.prototype,"showNoValueOption",void 0),u([p({type:["combo-box"],json:{read:!1,write:!0}})],OC.prototype,"type",void 0),OC=XX=u([N("esri.form.elements.inputs.ComboBoxInput")],OC);const qot=OC;var ZX;function zue(t){return t!=null?new Date(t):null}function Bue(t){return t?t.getTime():null}let Mf=ZX=class extends D3{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return zue(e.max)}writeMax(t,e){e.max=Bue(t)}readMin(t,e){return zue(e.min)}writeMin(t,e){e.min=Bue(t)}clone(){return new ZX({includeTime:this.includeTime,max:this.max,min:this.min})}};u([p({type:Boolean,json:{write:!0}})],Mf.prototype,"includeTime",void 0),u([p({type:Date,json:{type:Number,write:!0}})],Mf.prototype,"max",void 0),u([De("max")],Mf.prototype,"readMax",null),u([Xe("max")],Mf.prototype,"writeMax",null),u([p({type:Date,json:{type:Number,write:!0}})],Mf.prototype,"min",void 0),u([De("min")],Mf.prototype,"readMin",null),u([Xe("min")],Mf.prototype,"writeMin",null),u([p({type:["datetime-picker"],json:{read:!1,write:!0}})],Mf.prototype,"type",void 0),Mf=ZX=u([N("esri.form.elements.inputs.DateTimePickerInput")],Mf);const Wot=Mf;var JX;let RC=JX=class extends D3{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new JX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([p({type:String,json:{write:!0}})],RC.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],RC.prototype,"showNoValueOption",void 0),u([p({type:["radio-buttons"],json:{read:!1,write:!0}})],RC.prototype,"type",void 0),RC=JX=u([N("esri.form.elements.inputs.RadioButtonsInput")],RC);const Yot=RC;var KX;let PC=KX=class extends D3{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new KX({offValue:this.offValue,onValue:this.onValue})}};u([p({type:[String,Number],json:{write:!0}})],PC.prototype,"offValue",void 0),u([p({type:[String,Number],json:{write:!0}})],PC.prototype,"onValue",void 0),u([p({type:["switch"],json:{read:!1,write:!0}})],PC.prototype,"type",void 0),PC=KX=u([N("esri.form.elements.inputs.SwitchInput")],PC);const Xot=PC;var QX;let E6=QX=class extends $ie{constructor(t){super(t),this.type="text-area"}clone(){return new QX({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-area"],json:{read:!1,write:!0}})],E6.prototype,"type",void 0),E6=QX=u([N("esri.form.elements.inputs.TextAreaInput")],E6);const Zot=E6;var eZ;let C6=eZ=class extends $ie{constructor(t){super(t),this.type="text-box"}clone(){return new eZ({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-box"],json:{read:!1,write:!0}})],C6.prototype,"type",void 0),C6=eZ=u([N("esri.form.elements.inputs.TextBoxInput")],C6);const Jot=C6,Kot={base:D3,key:"type",typeMap:{"barcode-scanner":Hot,"combo-box":qot,"datetime-picker":Wot,"radio-buttons":Yot,switch:Xot,"text-area":Zot,"text-box":Jot}};var tZ;const lCe="esri.form.elements.FieldElement",Gue=le.getLogger(lCe);let Xd=tZ=class extends jA{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return mq(Gue,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){mq(Gue,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new tZ({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([p({types:iEe,json:{read:{reader:pie},write:!0}})],Xd.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],Xd.prototype,"editable",null),u([p({type:String,json:{write:!0}})],Xd.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],Xd.prototype,"fieldName",void 0),u([p({type:String,json:{write:!0}})],Xd.prototype,"hint",void 0),u([p({types:Kot,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Xd.prototype,"input",void 0),u([p({type:String,json:{write:!0}})],Xd.prototype,"requiredExpression",void 0),u([p({type:String,json:{read:!1,write:!0}})],Xd.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Xd.prototype,"valueExpression",void 0),Xd=tZ=u([N(lCe)],Xd);const jue=Xd;var iZ;let O0=iZ=class extends jA{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new iZ({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ue(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([p({type:Number,json:{write:!0}})],O0.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],O0.prototype,"displayType",void 0),u([p({type:Boolean,json:{write:!0}})],O0.prototype,"editable",void 0),u([p({type:[gte],json:{write:!0}})],O0.prototype,"orderByFields",void 0),u([p({type:Number,json:{write:!0}})],O0.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],O0.prototype,"type",void 0),O0=iZ=u([N("esri.form.elements.RelationshipElement")],O0);const Hue=O0;function cCe(t){return{typesWithGroup:{base:jA,key:"type",typeMap:{attachment:Vue,field:jue,group:t,relationship:Hue}},typesWithoutGroup:{base:jA,key:"type",typeMap:{attachment:Vue,field:jue,relationship:Hue}}}}function uCe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function hCe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function dCe(t,e,i=!0){return t?t.map(r=>xm(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var rZ;let kg=rZ=class extends jA{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return dCe(t,A7,!1)}readElements(t,e){return uCe(e.formElements,A7,!1)}writeElements(t,e){e.formElements=hCe(t,A7,!1)}clone(){return new rZ({description:this.description,elements:ue(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({json:{write:!0}})],kg.prototype,"elements",void 0),u([pi("elements")],kg.prototype,"castElements",null),u([De("elements",["formElements"])],kg.prototype,"readElements",null),u([Xe("elements")],kg.prototype,"writeElements",null),u([p({type:["collapsed","expanded"],json:{write:!0}})],kg.prototype,"initialState",void 0),u([p({type:String,json:{read:!1,write:!0}})],kg.prototype,"type",void 0),kg=rZ=u([N("esri.form.elements.GroupElement")],kg);const A7=cCe(kg),Qot=kg;var sZ;const O7=cCe(Qot);let Af=sZ=class extends Ae{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return dCe(t,O7)}readElements(t,e){return uCe(e.formElements,O7)}writeElements(t,e){e.formElements=hCe(t,O7)}clone(){return new sZ({description:this.description,expressionInfos:ue(this.expressionInfos),elements:ue(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([p({type:String,json:{write:!0}})],Af.prototype,"description",void 0),u([p({json:{write:!0}})],Af.prototype,"elements",void 0),u([pi("elements")],Af.prototype,"castElements",null),u([De("elements",["formElements"])],Af.prototype,"readElements",null),u([Xe("elements")],Af.prototype,"writeElements",null),u([p({type:[Got],json:{write:!0}})],Af.prototype,"expressionInfos",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Af.prototype,"preserveFieldValuesWhenHidden",void 0),u([p({type:String,json:{write:!0}})],Af.prototype,"title",void 0),Af=sZ=u([N("esri.form.FormTemplate")],Af);const eat=Af;function que(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function tat(t,e,i){if(!t&&!e||!i)return;const r=L2(i);Wue(t,i,r),Wue(e,i,r)}function Wue(t,e,i){if(t)for(const r of t)iat(r.geometry,e,i)}function iat(t,e,i){if(A(t)||!t.spatialReference||us(t.spatialReference,e))return;const r=L2(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)que(t,t.rings,r);else if("paths"in t)que(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}let rat=0;const pCe="esri.layers.graphics.sources.MemorySource",R7=le.getLogger(pCe);let Y0=class extends Tm.LoadableMixin(Ik(Dm(xt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=b(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);oX(e,this.layer.spatialReference,r);const s=lD.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new J("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return oX(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:ti.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new J("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const d=o(h);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const d=o(h);d!=null&&a.set(d,h)}}tat(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||A(e))return;const r=[];for(const{geometry:s}of e)!b(s)||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new J("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!s&&b(a.geometry)&&(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(rat++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return A(i)?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?kl.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await Dte("MemorySourceWorker",{strategy:me("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{R7.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:i&&i.map(m=>m.toJSON()),geometryType:Kq.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:r&&r.toJSON(),timeInfo:a?a.toJSON():null},d=await this._connection.invoke("load",h,{signal:e});for(const m of d.warnings)R7.warn(m.message,{layer:this.layer,warning:m});d.featureErrors.length&&R7.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const f=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=Kq.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(d.assignedObjectIds)}};u([_ee({Type:Ho,ensureType:Vn(Ho)})],Y0.prototype,"itemType",void 0),u([p()],Y0.prototype,"type",void 0),u([p({constructOnly:!0})],Y0.prototype,"layer",void 0),u([p({readOnly:!0})],Y0.prototype,"_workerGeometryType",null),u([p()],Y0.prototype,"sourceJSON",void 0),Y0=u([N(pCe)],Y0);function sat(t){return"portalItem"in t}const fCe=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):sat(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([p({type:String})],e.prototype,"apiKey",null),e=u([N("esri.layers.mixins.APIKeyMixin")],e),e},mCe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},gCe=Object.values(mCe),yCe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${gCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),nat=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${gCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),oat=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function KHt(t){return!!yCe.test(t)}function N3(t){if(A(t))return null;const e=jo(t),i=e.path.match(yCe)||e.path.match(nat);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:Lie(a!==-1?s.slice(a+1):s),serverType:mCe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function aat(t){const e=jo(t).path.match(oat);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Lie(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function lat(t,e){const i=[];if(t){const r=N3(t);b(r)&&r.title&&i.push(r.title)}if(e){const r=Lie(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function _Ce(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(s);return n&&o}function cat(t,e){return t&&qbe(Ybe(t,e))}function uat(t){let{url:e}=t;if(!e)return{url:e};e=Ybe(e,t.logger);const i=jo(e),r=N3(i.path);let s;if(b(r))r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=aat(i.path);b(n)&&(e=n.serviceUrl,s=n.sublayerId)}return{url:qbe(e),layerId:s}}function hat(t,e,i,r,s){jb(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=$2(r.url,i,t.layerId.toString()))}function dat(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}const vCe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=N3(this.url);if(b(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",cat(i,le.getLogger(this.declaredClass)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([N("esri.layers.mixins.ArcGISService")],e),e},Yue={read:{reader:uie},write:{allowNull:!0,writer:hie}},F3=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([p({json:{read:!1,write:!1,origins:{"web-map":Yue,"portal-item":Yue}}})],e.prototype,"effect",void 0),e=u([N("esri.layers.mixins.BlendLayer")],e),e},Die=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([N("esri.layers.mixins.CustomParametersMixin")],e),e},pat=new ws.EventEmitter,bCe="esri.layers.mixins.EditBusLayer",wCe=Symbol(bCe);function QHt(t){return t!=null&&typeof t=="object"&&wCe in t}const fat=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this.when().then(()=>{this.own([pat.on("edits",s=>{var h,d,f;const n="layer"in s?s.layer:null,o="layer"in s?(h=s.layer)==null?void 0:h.url:s.serviceUrl,a="layer"in s?(d=s.layer)==null?void 0:d.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",ue(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:g,deletes:y}=c.editedFeatures,v={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:y?y.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:g?g.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:ue(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",v)}})])},()=>{})}};return e=wCe,i=u([N(bCe)],i),i};var nZ;const P7=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),I7=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Cg=nZ=class extends Ae{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new _o({geometry:ue(i),objectIds:ue(n),spatialRelationship:r,timeExtent:ue(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new nZ({geometry:ue(e),objectIds:ue(s),spatialRelationship:i,timeExtent:ue(r),where:t,units:n,distance:o})}};u([p({type:String,json:{write:!0}})],Cg.prototype,"where",void 0),u([p({types:yw,json:{write:!0}})],Cg.prototype,"geometry",void 0),u([p({type:P7.apiValues,json:{name:"spatialRel",read:{reader:P7.read},write:{allowNull:!1,writer:P7.write,overridePolicy(){return{enabled:b(this.geometry)}}}}})],Cg.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Cg.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],Cg.prototype,"objectIds",void 0),u([p({type:I7.apiValues,json:{read:I7.read,write:{writer:I7.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Cg.prototype,"units",void 0),u([p({type:Jp,json:{write:!0}})],Cg.prototype,"timeExtent",void 0),Cg=nZ=u([N("esri.layers.support.FeatureFilter")],Cg);const mat=Cg;var oZ;const Xue={read:{reader:uie},write:{writer:hie,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Zue={read:{reader:uie},write:{writer:hie,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Jue={name:"showExcludedLabels",default:!0};let Zx=oZ=class extends Ae{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new J("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new J("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new oZ({filter:b(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:mat,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?Tc(i,s,e):Tc(i,null,e)}}}})],Zx.prototype,"filter",void 0),u([p({json:{write:!0,origins:{"web-map":Xue,"portal-item":Xue}}})],Zx.prototype,"includedEffect",void 0),u([p({json:{write:!0,origins:{"web-map":Zue,"portal-item":Zue}}})],Zx.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Jue,"portal-item":Jue}}})],Zx.prototype,"excludedLabelsVisible",void 0),Zx=oZ=u([N("esri.layers.support.FeatureEffect")],Zx);const gat=Zx,Kue={write:{allowNull:!0}},xCe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p({type:gat,json:{origins:{"web-map":Kue,"portal-item":Kue}}})],e.prototype,"featureEffect",void 0),e=u([N("esri.layers.mixins.FeatureEffectLayer")],e),e};var vP;const jU=jl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),TCe=jU.jsonValues.slice();g$(TCe,"orthometric");const DI=jl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Of=vP=class extends Ae{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return jU.write(t,e,i)}readHeightModel(t,e,i){return jU.read(t)||(i&&i.messages&&i.messages.push(yat(t,{context:i})),null)}readHeightUnit(t,e,i){return DI.read(t)||(i&&i.messages&&i.messages.push(Que(t,{context:i})),null)}readHeightUnitService(t,e,i){return nwe(t)||DI.read(t)||(i&&i.messages&&i.messages.push(Que(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new vP({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=owe(e);return new vP({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new vP;return e.read(t,{origin:"web-scene"}),e}};function Que(t,e){return new Np("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function yat(t,e){return new Np("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:jU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:TCe,default:"ellipsoidal"}}}})],Of.prototype,"heightModel",void 0),u([Xe("web-scene","heightModel")],Of.prototype,"writeHeightModel",null),u([De(["web-scene","service"],"heightModel")],Of.prototype,"readHeightModel",null),u([p({type:DI.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:DI.jsonValues,write:DI.write}}}})],Of.prototype,"heightUnit",void 0),u([De("web-scene","heightUnit")],Of.prototype,"readHeightUnit",null),u([De("service","heightUnit")],Of.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Of.prototype,"vertCRS",void 0),u([De("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Of.prototype,"readVertCRS",null),Of=vP=u([N("esri.geometry.HeightModelInfo")],Of);const U3=Of;function _at(t){if(!t)return t;const{start:e,end:i}=t;return new Jp({start:b(e)?g2(e,-e.getTimezoneOffset(),"minutes"):e,end:b(i)?g2(i,-i.getTimezoneOffset(),"minutes"):i})}function vat(t){if(!t)return t;const{start:e,end:i}=t;return new Jp({start:b(e)?g2(e,e.getTimezoneOffset(),"minutes"):e,end:b(i)?g2(i,i.getTimezoneOffset(),"minutes"):i})}var aZ;let bP=aZ=class extends Ae{constructor(t){super(t)}async collectRequiredFields(t,e){return pu(t,e,this.expression)}clone(){return new aZ({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:!0}})],bP.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],bP.prototype,"title",void 0),bP=aZ=u([N("esri.layers.support.FeatureExpressionInfo")],bP);const ehe=bP;function bat(t){return!!t&&BA[t]!=null}function SCe(t){return 1/(BA[t]||1)}function wat(){const t=Object.keys(BA);return t.sort(),t}const xat=wat();var lZ;const GN=jl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),the=new Hi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let R0=lZ=class extends Ae{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):b(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new lZ({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&CGe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:ehe,json:{write:!0}})],R0.prototype,"featureExpressionInfo",void 0),u([De("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],R0.prototype,"readFeatureExpressionInfo",null),u([Xe("featureExpressionInfo",{featureExpressionInfo:{type:ehe},"featureExpression.value":{type:[0]}})],R0.prototype,"writeFeatureExpressionInfo",null),u([p({type:GN.apiValues,nonNullable:!0,json:{type:GN.jsonValues,read:GN.read,write:{writer:GN.write,isRequired:!0}}})],R0.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],R0.prototype,"offset",void 0),u([p({type:xat,json:{type:String,read:the.read,write:the.write}})],R0.prototype,"unit",null),R0=lZ=u([N("esri.layers.support.ElevationInfo")],R0);const ECe=R0,CCe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},dD={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},AV={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},OV={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:jb}}},Nie={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},MCe={value:null,type:ECe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function eqt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const ACe={write:!0,read:!0},HU={type:Number,json:{origins:{"web-document":ACe,"portal-item":{write:!0}}}},Tat={...HU,json:{...HU.json,origins:{"web-document":{...ACe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?S$(e.layerDefinition.drawingInfo.transparency):void 0:S$(e.drawingInfo.transparency)}}},Sat={type:Jp,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;t&&(s=vat(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=_at(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},tqt={type:ti,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=ti.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Ye.fromJSON(e.spatialReference)),i}}}},read:!1}},Fie={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Eat={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},Cat={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},OCe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},ihe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class MS extends Error{}class Mat extends MS{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Aat extends MS{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Oat extends MS{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class wP extends MS{}class RCe extends MS{constructor(e){super(`Invalid unit ${e}`)}}class gp extends MS{}class Av extends MS{constructor(){super("Zone is an abstract class")}}const gt="numeric",Im="short",md="long",qU={year:gt,month:gt,day:gt},PCe={year:gt,month:Im,day:gt},Rat={year:gt,month:Im,day:gt,weekday:Im},ICe={year:gt,month:md,day:gt},$Ce={year:gt,month:md,day:gt,weekday:md},LCe={hour:gt,minute:gt},DCe={hour:gt,minute:gt,second:gt},NCe={hour:gt,minute:gt,second:gt,timeZoneName:Im},FCe={hour:gt,minute:gt,second:gt,timeZoneName:md},UCe={hour:gt,minute:gt,hourCycle:"h23"},kCe={hour:gt,minute:gt,second:gt,hourCycle:"h23"},VCe={hour:gt,minute:gt,second:gt,hourCycle:"h23",timeZoneName:Im},zCe={hour:gt,minute:gt,second:gt,hourCycle:"h23",timeZoneName:md},BCe={year:gt,month:gt,day:gt,hour:gt,minute:gt},GCe={year:gt,month:gt,day:gt,hour:gt,minute:gt,second:gt},jCe={year:gt,month:Im,day:gt,hour:gt,minute:gt},HCe={year:gt,month:Im,day:gt,hour:gt,minute:gt,second:gt},Pat={year:gt,month:Im,day:gt,weekday:Im,hour:gt,minute:gt},qCe={year:gt,month:md,day:gt,hour:gt,minute:gt,timeZoneName:Im},WCe={year:gt,month:md,day:gt,hour:gt,minute:gt,second:gt,timeZoneName:Im},YCe={year:gt,month:md,day:gt,weekday:md,hour:gt,minute:gt,timeZoneName:md},XCe={year:gt,month:md,day:gt,weekday:md,hour:gt,minute:gt,second:gt,timeZoneName:md};class pD{get type(){throw new Av}get name(){throw new Av}get ianaName(){return this.name}get isUniversal(){throw new Av}offsetName(e,i){throw new Av}formatOffset(e,i){throw new Av}offset(e){throw new Av}equals(e){throw new Av}get isValid(){throw new Av}}let $7=null;class RV extends pD{static get instance(){return $7===null&&($7=new RV),$7}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return JCe(e,i,r)}formatOffset(e,i){return FI(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let M6={};function Iat(t){return M6[t]||(M6[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),M6[t]}const $at={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Lat(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function Dat(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=$at[n];n==="era"?r[a]=o:qr(a)||(r[a]=parseInt(o,10))}return r}let jN={};class B_ extends pD{static create(e){return jN[e]||(jN[e]=new B_(e)),jN[e]}static resetCache(){jN={},M6={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=B_.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return JCe(e,i,r,this.name)}formatOffset(e,i){return FI(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=Iat(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?Dat(r,i):Lat(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=Vie({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let rhe={};function Nat(t,e={}){const i=JSON.stringify([t,e]);let r=rhe[i];return r||(r=new Intl.ListFormat(t,e),rhe[i]=r),r}let cZ={};function uZ(t,e={}){const i=JSON.stringify([t,e]);let r=cZ[i];return r||(r=new Intl.DateTimeFormat(t,e),cZ[i]=r),r}let hZ={};function Fat(t,e={}){const i=JSON.stringify([t,e]);let r=hZ[i];return r||(r=new Intl.NumberFormat(t,e),hZ[i]=r),r}let dZ={};function Uat(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=dZ[s];return n||(n=new Intl.RelativeTimeFormat(t,e),dZ[s]=n),n}let xP=null;function kat(){return xP||(xP=new Intl.DateTimeFormat().resolvedOptions().locale,xP)}function Vat(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=uZ(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=uZ(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function zat(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function Bat(t){const e=[];for(let i=1;i<=12;i++){const r=Ji.utc(2016,i,1);e.push(t(r))}return e}function Gat(t){const e=[];for(let i=1;i<=7;i++){const r=Ji.utc(2016,11,13+i);e.push(t(r))}return e}function HN(t,e,i,r,s){const n=t.listingMode(i);return n==="error"?null:n==="en"?r(e):s(e)}function jat(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Hat{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=Fat(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):kie(e,3);return la(i,this.padTo)}}}class qat{constructor(e,i,r){this.opts=r;let s;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&B_.create(a).valid?(s=a,this.dt=e):(s="UTC",r.timeZoneName?this.dt=e:this.dt=e.offset===0?e:Ji.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,s=e.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=uZ(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class Wat{constructor(e,i,r){this.opts={style:"long",...r},!i&&ZCe()&&(this.rtf=Uat(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):ult(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class $n{static fromOpts(e){return $n.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,s=!1){const n=e||oa.defaultLocale,o=n||(s?"en-US":kat()),a=i||oa.defaultNumberingSystem,l=r||oa.defaultOutputCalendar;return new $n(o,a,l,n)}static resetCache(){xP=null,cZ={},hZ={},dZ={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return $n.create(e,i,r)}constructor(e,i,r,s){const[n,o,a]=Vat(e);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=zat(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=jat(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:$n.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1,r=!0){return HN(this,e,r,eMe,()=>{const s=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=Bat(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1,r=!0){return HN(this,e,r,rMe,()=>{const s=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=Gat(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return HN(this,void 0,e,()=>sMe,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ji.utc(2016,11,13,9),Ji.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(e,i=!0){return HN(this,e,i,nMe,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ji.utc(-40,1,1),Ji.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new Hat(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new qat(e,this.intl,i)}relFormatter(e={}){return new Wat(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Nat(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let L7=null;class yc extends pD{static get utcInstance(){return L7===null&&(L7=new yc(0)),L7}static instance(e){return e===0?yc.utcInstance:new yc(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new yc(IV(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${FI(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${FI(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return FI(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Yat extends pD{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function tb(t,e){if(qr(t)||t===null)return e;if(t instanceof pD)return t;if(Xat(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?RV.instance:i==="utc"||i==="gmt"?yc.utcInstance:yc.parseSpecifier(i)||B_.create(t)}else return y2(t)?yc.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new Yat(t)}let she=()=>Date.now(),nhe="system",ohe=null,ahe=null,lhe=null,che=60,uhe;class oa{static get now(){return she}static set now(e){she=e}static set defaultZone(e){nhe=e}static get defaultZone(){return tb(nhe,RV.instance)}static get defaultLocale(){return ohe}static set defaultLocale(e){ohe=e}static get defaultNumberingSystem(){return ahe}static set defaultNumberingSystem(e){ahe=e}static get defaultOutputCalendar(){return lhe}static set defaultOutputCalendar(e){lhe=e}static get twoDigitCutoffYear(){return che}static set twoDigitCutoffYear(e){che=e%100}static get throwOnInvalid(){return uhe}static set throwOnInvalid(e){uhe=e}static resetCaches(){$n.resetCache(),B_.resetCache()}}function qr(t){return typeof t>"u"}function y2(t){return typeof t=="number"}function PV(t){return typeof t=="number"&&t%1===0}function Xat(t){return typeof t=="string"}function Zat(t){return Object.prototype.toString.call(t)==="[object Date]"}function ZCe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Jat(t){return Array.isArray(t)?t:[t]}function hhe(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function Kat(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function HA(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function m_(t,e,i){return PV(t)&&t>=e&&t<=i}function Qat(t,e){return t-e*Math.floor(t/e)}function la(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function W1(t){if(!(qr(t)||t===null||t===""))return parseInt(t,10)}function $w(t){if(!(qr(t)||t===null||t===""))return parseFloat(t)}function Uie(t){if(!(qr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function kie(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function fD(t){return t%4===0&&(t%100!==0||t%400===0)}function NI(t){return fD(t)?366:365}function WU(t,e){const i=Qat(e-1,12)+1,r=t+(e-i)/12;return i===2?fD(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Vie(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function YU(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function pZ(t){return t>99?t:t>oa.twoDigitCutoffYear?1900+t:2e3+t}function JCe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function IV(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function KCe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new gp(`Invalid unit value ${t}`);return e}function XU(t,e){const i={};for(const r in t)if(HA(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=KCe(s)}return i}function FI(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${la(i,2)}:${la(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${la(i,2)}${la(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function $V(t){return Kat(t,["hour","minute","second","millisecond"])}const elt=["January","February","March","April","May","June","July","August","September","October","November","December"],QCe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],tlt=["J","F","M","A","M","J","J","A","S","O","N","D"];function eMe(t){switch(t){case"narrow":return[...tlt];case"short":return[...QCe];case"long":return[...elt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const tMe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],iMe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ilt=["M","T","W","T","F","S","S"];function rMe(t){switch(t){case"narrow":return[...ilt];case"short":return[...iMe];case"long":return[...tMe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const sMe=["AM","PM"],rlt=["Before Christ","Anno Domini"],slt=["BC","AD"],nlt=["B","A"];function nMe(t){switch(t){case"narrow":return[...nlt];case"short":return[...slt];case"long":return[...rlt];default:return null}}function olt(t){return sMe[t.hour<12?0:1]}function alt(t,e){return rMe(e)[t.weekday-1]}function llt(t,e){return eMe(e)[t.month-1]}function clt(t,e){return nMe(e)[t.year<0?0:1]}function ult(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function dhe(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const hlt={D:qU,DD:PCe,DDD:ICe,DDDD:$Ce,t:LCe,tt:DCe,ttt:NCe,tttt:FCe,T:UCe,TT:kCe,TTT:VCe,TTTT:zCe,f:BCe,ff:jCe,fff:qCe,ffff:YCe,F:GCe,FF:HCe,FFF:WCe,FFFF:XCe};class mc{static create(e,i={}){return new mc(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(e){return hlt[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTime(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTimeParts(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).formatToParts()}formatInterval(e,i={}){return this.loc.dtFormatter(e.start,{...this.opts,...i}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return la(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?olt(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?llt(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?alt(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=mc.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>r?clt(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return dhe(mc.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=mc.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return dhe(n,s(a))}}class om{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const oMe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function k3(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function V3(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function z3(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function aMe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=W1(e[i+s]);return[r,null,i+s]}}const lMe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,dlt=`(?:${lMe.source}?(?:\\[(${oMe.source})\\])?)?`,zie=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,cMe=RegExp(`${zie.source}${dlt}`),Bie=RegExp(`(?:T${cMe.source})?`),plt=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,flt=/(\d{4})-?W(\d\d)(?:-?(\d))?/,mlt=/(\d{4})-?(\d{3})/,glt=aMe("weekYear","weekNumber","weekDay"),ylt=aMe("year","ordinal"),_lt=/(\d{4})-(\d\d)-(\d\d)/,uMe=RegExp(`${zie.source} ?(?:${lMe.source}|(${oMe.source}))?`),vlt=RegExp(`(?: ${uMe.source})?`);function KM(t,e,i){const r=t[e];return qr(r)?i:W1(r)}function blt(t,e){return[{year:KM(t,e),month:KM(t,e+1,1),day:KM(t,e+2,1)},null,e+3]}function B3(t,e){return[{hours:KM(t,e,0),minutes:KM(t,e+1,0),seconds:KM(t,e+2,0),milliseconds:Uie(t[e+3])},null,e+4]}function mD(t,e){const i=!t[e]&&!t[e+1],r=IV(t[e+1],t[e+2]),s=i?null:yc.instance(r);return[{},s,e+3]}function gD(t,e){const i=t[e]?B_.create(t[e]):null;return[{},i,e+1]}const wlt=RegExp(`^T?${zie.source}$`),xlt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Tlt(t){const[e,i,r,s,n,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f($w(i)),months:f($w(r)),weeks:f($w(s)),days:f($w(n)),hours:f($w(o)),minutes:f($w(a)),seconds:f($w(l),l==="-0"),milliseconds:f(Uie(c),d)}]}const Slt={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Gie(t,e,i,r,s,n,o){const a={year:e.length===2?pZ(W1(e)):W1(e),month:QCe.indexOf(i)+1,day:W1(r),hour:W1(s),minute:W1(n)};return o&&(a.second=W1(o)),t&&(a.weekday=t.length>3?tMe.indexOf(t)+1:iMe.indexOf(t)+1),a}const Elt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Clt(t){const[,e,i,r,s,n,o,a,l,c,h,d]=t,f=Gie(e,s,r,i,n,o,a);let m;return l?m=Slt[l]:c?m=0:m=IV(h,d),[f,new yc(m)]}function Mlt(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Alt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Olt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Rlt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function phe(t){const[,e,i,r,s,n,o,a]=t;return[Gie(e,s,r,i,n,o,a),yc.utcInstance]}function Plt(t){const[,e,i,r,s,n,o,a]=t;return[Gie(e,a,i,r,s,n,o),yc.utcInstance]}const Ilt=k3(plt,Bie),$lt=k3(flt,Bie),Llt=k3(mlt,Bie),Dlt=k3(cMe),hMe=V3(blt,B3,mD,gD),Nlt=V3(glt,B3,mD,gD),Flt=V3(ylt,B3,mD,gD),Ult=V3(B3,mD,gD);function klt(t){return z3(t,[Ilt,hMe],[$lt,Nlt],[Llt,Flt],[Dlt,Ult])}function Vlt(t){return z3(Mlt(t),[Elt,Clt])}function zlt(t){return z3(t,[Alt,phe],[Olt,phe],[Rlt,Plt])}function Blt(t){return z3(t,[xlt,Tlt])}const Glt=V3(B3);function jlt(t){return z3(t,[wlt,Glt])}const Hlt=k3(_lt,vlt),qlt=k3(uMe),Wlt=V3(B3,mD,gD);function Ylt(t){return z3(t,[Hlt,hMe],[qlt,Wlt])}const Xlt="Invalid Duration",dMe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Zlt={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...dMe},Rd=146097/400,BS=146097/4800,Jlt={years:{quarters:4,months:12,weeks:Rd/7,days:Rd,hours:Rd*24,minutes:Rd*24*60,seconds:Rd*24*60*60,milliseconds:Rd*24*60*60*1e3},quarters:{months:3,weeks:Rd/28,days:Rd/4,hours:Rd*24/4,minutes:Rd*24*60/4,seconds:Rd*24*60*60/4,milliseconds:Rd*24*60*60*1e3/4},months:{weeks:BS/7,days:BS,hours:BS*24,minutes:BS*24*60,seconds:BS*24*60*60,milliseconds:BS*24*60*60*1e3},...dMe},Jx=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Klt=Jx.slice(0).reverse();function Ov(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Xr(r)}function Qlt(t){return t<0?Math.floor(t):Math.ceil(t)}function pMe(t,e,i,r,s){const n=t[s][i],o=e[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?Qlt(o):Math.trunc(o);r[s]+=l,e[i]-=l*n}function ect(t,e){Klt.reduce((i,r)=>qr(e[r])?i:(i&&pMe(t,e,i,e,r),r),null)}function tct(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Xr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?Jlt:Zlt;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||$n.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Xr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new gp(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Xr({values:XU(e,Xr.normalizeUnit),loc:$n.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(y2(e))return Xr.fromMillis(e);if(Xr.isDuration(e))return e;if(typeof e=="object")return Xr.fromObject(e);throw new gp(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=Blt(e);return r?Xr.fromObject(r,i):Xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=jlt(e);return r?Xr.fromObject(r,i):Xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new gp("need to specify a reason the Duration is invalid");const r=e instanceof om?e:new om(e,i);if(oa.throwOnInvalid)throw new Oat(r);return new Xr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new RCe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?mc.create(this.loc,r).formatDurationFromString(this,e):Xlt}toHuman(e={}){const i=Jx.map(r=>{const s=this.values[r];return qr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=kie(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Xr.fromDurationLike(e),r={};for(const s of Jx)(HA(i.values,s)||HA(this.values,s))&&(r[s]=i.get(s)+this.get(s));return Ov(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Xr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=KCe(e(this.values[r],r));return Ov(this,{values:i},!0)}get(e){return this[Xr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...XU(e,Xr.normalizeUnit)};return Ov(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return Ov(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return ect(this.matrix,e),Ov(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=tct(this.normalize().shiftToAll().toObject());return Ov(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Xr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of Jx)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;y2(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Jx.indexOf(c)>Jx.indexOf(o)&&pMe(this.matrix,s,c,i,o)}else y2(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Ov(this,{values:i},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return Ov(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Jx)if(!i(this.values[r],e.values[r]))return!1;return!0}}const GS="Invalid Interval";function ict(t,e){return!t||!t.isValid?po.invalid("missing or invalid start"):!e||!e.isValid?po.invalid("missing or invalid end"):e<t?po.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class po{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new gp("need to specify a reason the Interval is invalid");const r=e instanceof om?e:new om(e,i);if(oa.throwOnInvalid)throw new Aat(r);return new po({invalid:r})}static fromDateTimes(e,i){const r=NO(e),s=NO(i),n=ict(r,s);return n??new po({start:r,end:s})}static after(e,i){const r=Xr.fromDurationLike(i),s=NO(e);return po.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Xr.fromDurationLike(i),s=NO(e);return po.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=Ji.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Ji.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return po.fromDateTimes(n,a);if(o){const c=Xr.fromISO(s,i);if(c.isValid)return po.after(n,c)}else if(l){const c=Xr.fromISO(r,i);if(c.isValid)return po.before(a,c)}}return po.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?po.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(NO).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(po.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Xr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(po.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:po.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return po.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(po.fromDateTimes(i,l.time)),i=null);return po.merge(s)}difference(...e){return po.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:GS}toLocaleString(e=qU,i={}){return this.isValid?mc.create(this.s.loc.clone(i),e).formatInterval(this):GS}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:GS}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:GS}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:GS}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:GS}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Xr.invalid(this.invalidReason)}mapEndpoints(e){return po.fromDateTimes(e(this.s),e(this.e))}}class qN{static hasDST(e=oa.defaultZone){const i=Ji.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return B_.isValidZone(e)}static normalizeZone(e){return tb(e,oa.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||$n.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||$n.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||$n.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||$n.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return $n.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return $n.create(i,null,"gregory").eras(e)}static features(){return{relative:ZCe()}}}function fhe(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Xr.fromMillis(r).as("days"))}function rct(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=fhe(l,c);return(h-h%7)/7}],["days",fhe]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function sct(t,e,i,r){let[s,n,o,a]=rct(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Xr.fromObject(n,r);return c.length>0?Xr.fromMillis(l,r).shiftTo(...c).plus(h):h}const jie={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},mhe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},nct=jie.hanidec.replace(/[\[|\]]/g,"").split("");function oct(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(jie.hanidec)!==-1)e+=nct.indexOf(t[i]);else for(const s in mhe){const[n,o]=mhe[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function af({numberingSystem:t},e=""){return new RegExp(`${jie[t||"latn"]}${e}`)}const act="missing Intl.DateTimeFormat.formatToParts support";function fs(t,e=i=>i){return{regex:t,deser:([i])=>e(oct(i))}}const lct=String.fromCharCode(160),fMe=`[ ${lct}]`,mMe=new RegExp(fMe,"g");function cct(t){return t.replace(/\./g,"\\.?").replace(mMe,fMe)}function ghe(t){return t.replace(/\./g,"").replace(mMe," ").toLowerCase()}function lf(t,e){return t===null?null:{regex:RegExp(t.map(cct).join("|")),deser:([i])=>t.findIndex(r=>ghe(i)===ghe(r))+e}}function yhe(t,e){return{regex:t,deser:([,i,r])=>IV(i,r),groups:e}}function D7(t){return{regex:t,deser:([e])=>e}}function uct(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hct(t,e){const i=af(e),r=af(e,"{2}"),s=af(e,"{3}"),n=af(e,"{4}"),o=af(e,"{6}"),a=af(e,"{1,2}"),l=af(e,"{1,3}"),c=af(e,"{1,6}"),h=af(e,"{1,9}"),d=af(e,"{2,4}"),f=af(e,"{4,6}"),m=v=>({regex:RegExp(uct(v.val)),deser:([x])=>x,literal:!0}),y=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return lf(e.eras("short",!1),0);case"GG":return lf(e.eras("long",!1),0);case"y":return fs(c);case"yy":return fs(d,pZ);case"yyyy":return fs(n);case"yyyyy":return fs(f);case"yyyyyy":return fs(o);case"M":return fs(a);case"MM":return fs(r);case"MMM":return lf(e.months("short",!0,!1),1);case"MMMM":return lf(e.months("long",!0,!1),1);case"L":return fs(a);case"LL":return fs(r);case"LLL":return lf(e.months("short",!1,!1),1);case"LLLL":return lf(e.months("long",!1,!1),1);case"d":return fs(a);case"dd":return fs(r);case"o":return fs(l);case"ooo":return fs(s);case"HH":return fs(r);case"H":return fs(a);case"hh":return fs(r);case"h":return fs(a);case"mm":return fs(r);case"m":return fs(a);case"q":return fs(a);case"qq":return fs(r);case"s":return fs(a);case"ss":return fs(r);case"S":return fs(l);case"SSS":return fs(s);case"u":return D7(h);case"uu":return D7(a);case"uuu":return fs(i);case"a":return lf(e.meridiems(),0);case"kkkk":return fs(n);case"kk":return fs(d,pZ);case"W":return fs(a);case"WW":return fs(r);case"E":case"c":return fs(i);case"EEE":return lf(e.weekdays("short",!1,!1),1);case"EEEE":return lf(e.weekdays("long",!1,!1),1);case"ccc":return lf(e.weekdays("short",!0,!1),1);case"cccc":return lf(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return yhe(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return yhe(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return D7(/[a-z_+-/]{1,256}?/i);default:return m(v)}})(t)||{invalidReason:act};return y.token=t,y}const dct={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function pct(t,e){const{type:i,value:r}=t;if(i==="literal")return{literal:!0,val:r};const s=e[i];let n=dct[i];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function fct(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function mct(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(HA(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function gct(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return qr(t.z)||(i=B_.create(t.z)),qr(t.Z)||(i||(i=new yc(t.Z)),r=t.Z),qr(t.q)||(t.M=(t.q-1)*3+1),qr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),qr(t.u)||(t.S=Uie(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let N7=null;function yct(){return N7||(N7=Ji.fromMillis(1555555555555)),N7}function _ct(t,e){if(t.literal)return t;const i=mc.macroTokenToFormatOpts(t.val),r=_Me(i,e);return r==null||r.includes(void 0)?t:r}function gMe(t,e){return Array.prototype.concat(...t.map(i=>_ct(i,e)))}function yMe(t,e,i){const r=gMe(mc.parseFormat(i),t),s=r.map(o=>hct(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=fct(s),l=RegExp(o,"i"),[c,h]=mct(e,l,a),[d,f,m]=h?gct(h):[null,null,void 0];if(HA(h,"a")&&HA(h,"H"))throw new wP("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:h,result:d,zone:f,specificOffset:m}}}function vct(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=yMe(t,e,i);return[r,s,n,o]}function _Me(t,e){return t?mc.create(e,t).formatDateTimeParts(yct()).map(s=>pct(s,t)):null}const vMe=[0,31,59,90,120,151,181,212,243,273,304,334],bMe=[0,31,60,91,121,152,182,213,244,274,305,335];function Cp(t,e){return new om("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function wMe(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function xMe(t,e,i){return i+(fD(t)?bMe:vMe)[e-1]}function TMe(t,e){const i=fD(t)?bMe:vMe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function fZ(t){const{year:e,month:i,day:r}=t,s=xMe(e,i,r),n=wMe(e,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=YU(a)):o>YU(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...$V(t)}}function _he(t){const{weekYear:e,weekNumber:i,weekday:r}=t,s=wMe(e,1,4),n=NI(e);let o=i*7+r-s-3,a;o<1?(a=e-1,o+=NI(a)):o>n?(a=e+1,o-=NI(e)):a=e;const{month:l,day:c}=TMe(a,o);return{year:a,month:l,day:c,...$V(t)}}function F7(t){const{year:e,month:i,day:r}=t,s=xMe(e,i,r);return{year:e,ordinal:s,...$V(t)}}function vhe(t){const{year:e,ordinal:i}=t,{month:r,day:s}=TMe(e,i);return{year:e,month:r,day:s,...$V(t)}}function bct(t){const e=PV(t.weekYear),i=m_(t.weekNumber,1,YU(t.weekYear)),r=m_(t.weekday,1,7);return e?i?r?!1:Cp("weekday",t.weekday):Cp("week",t.week):Cp("weekYear",t.weekYear)}function wct(t){const e=PV(t.year),i=m_(t.ordinal,1,NI(t.year));return e?i?!1:Cp("ordinal",t.ordinal):Cp("year",t.year)}function SMe(t){const e=PV(t.year),i=m_(t.month,1,12),r=m_(t.day,1,WU(t.year,t.month));return e?i?r?!1:Cp("day",t.day):Cp("month",t.month):Cp("year",t.year)}function EMe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=m_(e,0,23)||e===24&&i===0&&r===0&&s===0,o=m_(i,0,59),a=m_(r,0,59),l=m_(s,0,999);return n?o?a?l?!1:Cp("millisecond",s):Cp("second",r):Cp("minute",i):Cp("hour",e)}const U7="Invalid DateTime",bhe=864e13;function WN(t){return new om("unsupported zone",`the zone "${t.name}" is not supported`)}function k7(t){return t.weekData===null&&(t.weekData=fZ(t.c)),t.weekData}function LO(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Ji({...i,...e,old:i})}function CMe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function whe(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function A6(t,e,i){return CMe(Vie(t),e,i)}function xhe(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,WU(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Xr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Vie(n);let[l,c]=CMe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function DO(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0){const l=e||a,c=Ji.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Ji.invalid(new om("unparsable",`the input "${s}" can't be parsed as ${r}`))}function YN(t,e,i=!0){return t.isValid?mc.create($n.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function V7(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=la(t.c.year,i?6:4),e?(r+="-",r+=la(t.c.month),r+="-",r+=la(t.c.day)):(r+=la(t.c.month),r+=la(t.c.day)),r}function The(t,e,i,r,s,n){let o=la(t.c.hour);return e?(o+=":",o+=la(t.c.minute),(t.c.second!==0||!i)&&(o+=":")):o+=la(t.c.minute),(t.c.second!==0||!i)&&(o+=la(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=la(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=la(Math.trunc(-t.o/60)),o+=":",o+=la(Math.trunc(-t.o%60))):(o+="+",o+=la(Math.trunc(t.o/60)),o+=":",o+=la(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const MMe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},xct={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Tct={ordinal:1,hour:0,minute:0,second:0,millisecond:0},AMe=["year","month","day","hour","minute","second","millisecond"],Sct=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Ect=["year","ordinal","hour","minute","second","millisecond"];function She(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new RCe(t);return e}function Ehe(t,e){const i=tb(e.zone,oa.defaultZone),r=$n.fromObject(e),s=oa.now();let n,o;if(qr(t.year))n=s;else{for(const c of AMe)qr(t[c])&&(t[c]=MMe[c]);const a=SMe(t)||EMe(t);if(a)return Ji.invalid(a);const l=i.offset(s);[n,o]=A6(t,l,i)}return new Ji({ts:n,zone:i,loc:r,o})}function Che(t,e,i){const r=qr(i.round)?!0:i.round,s=(o,a)=>(o=kie(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function Mhe(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Ji{constructor(e){const i=e.zone||oa.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new om("invalid input"):null)||(i.isValid?null:WN(i));this.ts=qr(e.ts)?oa.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=whe(this.ts,a),r=Number.isNaN(s.year)?new om("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||$n.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Ji({})}static local(){const[e,i]=Mhe(arguments),[r,s,n,o,a,l,c]=i;return Ehe({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Mhe(arguments),[r,s,n,o,a,l,c]=i;return e.zone=yc.utcInstance,Ehe({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=Zat(e)?e.valueOf():NaN;if(Number.isNaN(r))return Ji.invalid("invalid input");const s=tb(i.zone,oa.defaultZone);return s.isValid?new Ji({ts:r,zone:s,loc:$n.fromObject(i)}):Ji.invalid(WN(s))}static fromMillis(e,i={}){if(y2(e))return e<-bhe||e>bhe?Ji.invalid("Timestamp out of range"):new Ji({ts:e,zone:tb(i.zone,oa.defaultZone),loc:$n.fromObject(i)});throw new gp(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(y2(e))return new Ji({ts:e*1e3,zone:tb(i.zone,oa.defaultZone),loc:$n.fromObject(i)});throw new gp("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=tb(i.zone,oa.defaultZone);if(!r.isValid)return Ji.invalid(WN(r));const s=oa.now(),n=qr(i.specificOffset)?r.offset(s):i.specificOffset,o=XU(e,She),a=!qr(o.ordinal),l=!qr(o.year),c=!qr(o.month)||!qr(o.day),h=l||c,d=o.weekYear||o.weekNumber,f=$n.fromObject(i);if((h||a)&&d)throw new wP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new wP("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!h;let g,y,v=whe(s,n);m?(g=Sct,y=xct,v=fZ(v)):a?(g=Ect,y=Tct,v=F7(v)):(g=AMe,y=MMe);let x=!1;for(const L of g){const B=o[L];qr(B)?x?o[L]=y[L]:o[L]=v[L]:x=!0}const S=m?bct(o):a?wct(o):SMe(o),E=S||EMe(o);if(E)return Ji.invalid(E);const C=m?_he(o):a?vhe(o):o,[R,O]=A6(C,n,r),U=new Ji({ts:R,zone:r,o:O,loc:f});return o.weekday&&h&&e.weekday!==U.weekday?Ji.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${U.toISO()}`):U}static fromISO(e,i={}){const[r,s]=klt(e);return DO(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=Vlt(e);return DO(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=zlt(e);return DO(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(qr(e)||qr(i))throw new gp("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=$n.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=vct(o,e,i);return h?Ji.invalid(h):DO(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return Ji.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=Ylt(e);return DO(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new gp("need to specify a reason the DateTime is invalid");const r=e instanceof om?e:new om(e,i);if(oa.throwOnInvalid)throw new Mat(r);return new Ji({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=_Me(e,$n.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return gMe(mc.parseFormat(e),$n.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?k7(this).weekYear:NaN}get weekNumber(){return this.isValid?k7(this).weekNumber:NaN}get weekday(){return this.isValid?k7(this).weekday:NaN}get ordinal(){return this.isValid?F7(this.c).ordinal:NaN}get monthShort(){return this.isValid?qN.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?qN.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?qN.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?qN.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return fD(this.year)}get daysInMonth(){return WU(this.year,this.month)}get daysInYear(){return this.isValid?NI(this.year):NaN}get weeksInWeekYear(){return this.isValid?YU(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=mc.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(yc.instance(e),i)}toLocal(){return this.setZone(oa.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=tb(e,oa.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=A6(o,n,e)}return LO(this,{ts:s,zone:e})}else return Ji.invalid(WN(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return LO(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=XU(e,She),r=!qr(i.weekYear)||!qr(i.weekNumber)||!qr(i.weekday),s=!qr(i.ordinal),n=!qr(i.year),o=!qr(i.month)||!qr(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new wP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new wP("Can't mix ordinal dates with month/day");let c;r?c=_he({...fZ(this.c),...i}):qr(i.ordinal)?(c={...this.toObject(),...i},qr(i.day)&&(c.day=Math.min(WU(c.year,c.month),c.day))):c=vhe({...F7(this.c),...i});const[h,d]=A6(c,this.o,this.zone);return LO(this,{ts:h,o:d})}plus(e){if(!this.isValid)return this;const i=Xr.fromDurationLike(e);return LO(this,xhe(this,i))}minus(e){if(!this.isValid)return this;const i=Xr.fromDurationLike(e).negate();return LO(this,xhe(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=Xr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?mc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):U7}toLocaleString(e=qU,i={}){return this.isValid?mc.create(this.loc.clone(i),e).formatDateTime(this):U7}toLocaleParts(e={}){return this.isValid?mc.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=V7(this,o);return a+="T",a+=The(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?V7(this,e==="extended"):null}toISOWeekDate(){return YN(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+The(this,o==="extended",i,e,r,n):null}toRFC2822(){return YN(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return YN(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?V7(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),YN(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():U7}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Xr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=Jat(i).map(Xr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=sct(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(Ji.now(),e,i)}until(e){return this.isValid?po.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Ji.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Che(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Che(e.base||Ji.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Ji.isDateTime))throw new gp("min requires all arguments be DateTimes");return hhe(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Ji.isDateTime))throw new gp("max requires all arguments be DateTimes");return hhe(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=$n.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return yMe(o,e,i)}static fromStringExplain(e,i,r={}){return Ji.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return qU}static get DATE_MED(){return PCe}static get DATE_MED_WITH_WEEKDAY(){return Rat}static get DATE_FULL(){return ICe}static get DATE_HUGE(){return $Ce}static get TIME_SIMPLE(){return LCe}static get TIME_WITH_SECONDS(){return DCe}static get TIME_WITH_SHORT_OFFSET(){return NCe}static get TIME_WITH_LONG_OFFSET(){return FCe}static get TIME_24_SIMPLE(){return UCe}static get TIME_24_WITH_SECONDS(){return kCe}static get TIME_24_WITH_SHORT_OFFSET(){return VCe}static get TIME_24_WITH_LONG_OFFSET(){return zCe}static get DATETIME_SHORT(){return BCe}static get DATETIME_SHORT_WITH_SECONDS(){return GCe}static get DATETIME_MED(){return jCe}static get DATETIME_MED_WITH_SECONDS(){return HCe}static get DATETIME_MED_WITH_WEEKDAY(){return Pat}static get DATETIME_FULL(){return qCe}static get DATETIME_FULL_WITH_SECONDS(){return WCe}static get DATETIME_HUGE(){return YCe}static get DATETIME_HUGE_WITH_SECONDS(){return XCe}}function NO(t){if(Ji.isDateTime(t))return t;if(t&&t.valueOf&&y2(t.valueOf()))return Ji.fromJSDate(t);if(t&&typeof t=="object")return Ji.fromObject(t);throw new gp(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function Cct(t,e="system"){if(!t||!ihe.has(t.timeZone))return e;const i=ihe.get(t.timeZone);return Act(t.timeZone)||t.respectsDaylightSaving?i:Mct(i)}function Mct(t){const e=Ji.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${yc.instance(-i).formatOffset(0,"narrow")}`}function Act(t){return t.startsWith("UTC")}let E1=class extends hn(Ae){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,i){const{timeZone:r,respectsDaylightSaving:s}=i;return{timeZone:r,respectsDaylightSaving:s}}readTimeZone(e,i){return"timeZoneIANA"in i?i.timeZoneIANA:Cct(i)}writeTimeZone(e,i){i.timeZoneIANA=e}equals(e){return!(A(e)||A(this.timeZone)||A(e.timeZone))&&this.timeZone===e.timeZone}};u([p()],E1.prototype,"legacy",void 0),u([De("legacy",["timeZone"])],E1.prototype,"readLegacy",null),u([p({type:String,nonNullable:!0})],E1.prototype,"timeZone",void 0),u([De("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],E1.prototype,"readTimeZone",null),u([Xe("timeZone")],E1.prototype,"writeTimeZone",null),E1=u([N("esri.time.TimeReference")],E1);const ew=E1;let P0=class extends hn(Ae){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([p()],P0.prototype,"creatorField",void 0),u([p()],P0.prototype,"creationDateField",void 0),u([p()],P0.prototype,"editorField",void 0),u([p()],P0.prototype,"editDateField",void 0),u([p()],P0.prototype,"realm",void 0),u([p({type:ew})],P0.prototype,"dateFieldsTimeReference",void 0),P0=u([N("esri.layers.support.EditFieldsInfo")],P0);const Oct=P0;let Vg=class extends hn(Ae){constructor(e){super(e)}};u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"name",void 0),u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"fields",void 0),u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"isAscending",void 0),u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"indexType",void 0),u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"isUnique",void 0),u([p({constructOnly:!0,json:{write:!0}})],Vg.prototype,"description",void 0),Vg=u([N("esri.layers.support.FeatureIndex")],Vg);const mZ=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Rct(t,e,i,r){const s=await ww(t);if(await Hie(t,e,r),!s.addAttachment)throw new J(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function Hie(t,e,i){const{attributes:r}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?r?s&&r[s]?Promise.resolve():Promise.reject(new J(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new J(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new J(i,"A feature is required to add/delete/update attachments")):Promise.reject(new J(i,"this layer doesn't support attachments"))}async function Pct(t,e,i,r,s){const n=await ww(t);if(await Hie(t,e,s),!n.updateAttachment)throw new J(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function Ict(t,e,i){const r=await se(()=>import("./editingSupport-9205c61e.js"),["assets/editingSupport-9205c61e.js","assets/assetEditingSupport-2cebf928.js"]),s=await t.load();return r.applyEdits(s,s.source,e,i)}async function $ct(t,e,i,r){const s=await ww(t);if(await Hie(t,e,r),!s.deleteAttachments)throw new J(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function Lct(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new J(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function Dct(t,e,i,r){var m,g;e=UU.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new J(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||d||f))throw new J(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new J(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new J(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function Nct(t,e,i,r){const s=await ww(t);if(!s.queryObjectIds)throw new J(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(_o.from(e)??t.createQuery(),i)}async function Fct(t,e,i,r){const s=await ww(t);if(!s.queryFeatureCount)throw new J(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(_o.from(e)??t.createQuery(),i)}async function Uct(t,e,i,r){const s=await ww(t);if(!s.queryExtent)throw new J(r,"Layer source does not support queryExtent capability");return s.queryExtent(_o.from(e)??t.createQuery(),i)}async function kct(t,e,i,r){const s=await ww(t);if(!s.queryRelatedFeatures)throw new J(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(zA.from(e),i)}async function Vct(t,e,i,r){const s=await ww(t);if(!s.queryRelatedFeaturesCount)throw new J(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(zA.from(e),i)}async function zct(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(b(r)&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await Bot(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Bct(t){const e=new _o,i=t.get("capabilities.data"),r=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function OMe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function RMe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function Gct(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function ww(t){return(await t.load()).source}async function jct(t,e){if(!es||es.findCredential(t))return;let i;try{const r=await Awe(t,e);r&&(i=await es.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=b(e)?e.signal:null;await es.getCredential(t,{signal:r})}catch{}}async function Hct(t,e){var s;const i=(s=t.parsedUrl)==null?void 0:s.path;if(!i)return;const r=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||r!=null&&r.creatorField||r!=null&&r.editorField)&&await jct(i,e)}function qct(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let IC=class extends hn(Ae){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],IC.prototype,"shapeAreaField",void 0),u([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],IC.prototype,"shapeLengthField",void 0),u([p({type:String,json:{read:t=>Lqe.read(t)||Dqe.read(t)}})],IC.prototype,"units",void 0),IC=u([N("esri.layers.support.GeometryFieldsInfo")],IC);const Wct=IC;var gZ;let $C=gZ=class extends Ae{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new xt}clone(){return new gZ({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([p({type:String,json:{write:!0}})],$C.prototype,"floorField",void 0),u([p({json:{read:!1,write:!1}})],$C.prototype,"viewAllMode",void 0),u([p({json:{read:!1,write:!1}})],$C.prototype,"viewAllLevelIds",void 0),$C=gZ=u([N("esri.layers.support.LayerFloorInfo")],$C);const PMe=$C,Ahe=new Hi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Ohe=new Hi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Zd=class extends hn(Ae){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([p({json:{read:Ahe.read,write:Ahe.write}})],Zd.prototype,"cardinality",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"composite",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"id",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"keyField",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"keyFieldInRelationshipTable",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"name",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"relatedTableId",void 0),u([p({json:{read:!0,write:!0}})],Zd.prototype,"relationshipTableId",void 0),u([p({json:{read:Ohe.read,write:Ohe.write}})],Zd.prototype,"role",void 0),Zd=u([N("esri.layers.support.Relationship")],Zd);const Yct=Zd,Xct={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function yi(t,e,i){return!!(t&&t.hasOwnProperty(e)?t[e]:i)}function XN(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}function Zct(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function yD(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function qie(t,e){return{analytics:Jct(t),attachment:Kct(t),data:Qct(t),metadata:eut(t),operations:tut(t.capabilities,t,e),query:iut(t,e),queryRelated:rut(t),queryTopFeatures:sut(t),editing:nut(t)}}function Jct(t){return{supportsCacheHint:yD(t.advancedQueryCapabilities,"queryAnalytics")}}function Kct(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:yD(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:yi(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=Xct[r.name];s&&(i[s]=!!r.isEnabled)}),i}function Qct(t){return{isVersioned:yi(t,"isDataVersioned",!1),supportsAttachment:yi(t,"hasAttachments",!1),supportsM:yi(t,"hasM",!1),supportsZ:yi(t,"hasZ",!1)}}function eut(t){return{supportsAdvancedFieldProperties:yi(t,"supportsFieldDescriptionProperty",!1)}}function tut(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?N3(i):null,n=r.includes(b(s)&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:yi(e,"supportsCalculate",!1),supportsTruncate:yi(e,"supportsTruncate",!1),supportsValidateSql:yi(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:yi(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:yi(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:yi(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:yi(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:yi(e,"supportsExceedsLimitStatistics",!1)}}function iut(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=me("mapserver-pbf-version-support"),l=_Ce(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:yi(i,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:yi(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:yi(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:Zct(i),supportsCentroid:yi(i,"supportsReturningGeometryCentroid",!1),supportsDistance:yi(i,"supportsQueryWithDistance",!1),supportsDistinct:yi(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:yi(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:yi(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:yi(i,"supportsHavingClause",!1),supportsOrderBy:yi(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:yi(i,"supportsPagination",!1),supportsQuantization:yi(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:yi(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:yi(t,"supportsReturningQueryGeometry",!1),supportsResultType:yi(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:yi(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:yi(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:yi(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:yi(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:yi(r,"allowOthersToQuery",!0),supportsHistoricMoment:yi(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:yi(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:yi(i,"supportsQueryWithCacheHint",!1)||yD(i,"query"),supportsDefaultSpatialReference:yi(i,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:yi(i,"supportsFullTextSearch",!1),maxRecordCountFactor:XN(t,"maxRecordCountFactor",void 0),maxRecordCount:XN(t,"maxRecordCount",void 0),standardMaxRecordCount:XN(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:XN(t,"tileMaxRecordCount",void 0)}}function rut(t){const e=t.advancedQueryCapabilities,i=yi(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:yi(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:yD(e,"queryRelated")}}function sut(t){return{supportsCacheHint:yD(t.advancedQueryCapabilities,"queryTopFilter")}}function nut(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:yi(t,"allowGeometryUpdates",!0),supportsGlobalId:yi(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:yi(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:yi(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:yi(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:yi(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:yi(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:yi(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:yi(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:yi(e,"allowOthersToUpdate",!0)}}const out=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Ye.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(xt.ofType(Vg)),this.version=void 0}readCapabilitiesFromService(i,r){return qie(r,this.url)}get effectiveCapabilities(){var o;const i=this.capabilities;if(!i)return null;const r=ue(i),{operations:s,editing:n}=r;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(i,r){return r.type==="Table"}readMinScale(i,r){return r.effectiveMinScale||i||0}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readGlobalIdFieldFromService(i,r){return OMe(r)}readObjectIdFieldFromService(i,r){return RMe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){const r=uat({layer:this,url:i,nonStandardUrlAllowed:!0,logger:le.getLogger(this.declaredClass)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){hat(this,i,null,r,n)}readVersion(i,r){return Gct(r)}};return u([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([De("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([p({type:ew})],e.prototype,"dateFieldsTimeReference",void 0),u([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([p({readOnly:!0,type:Oct})],e.prototype,"editFieldsInfo",void 0),u([p({readOnly:!0})],e.prototype,"editingInfo",void 0),u([De("editingInfo")],e.prototype,"readEditingInfo",null),u([p((()=>{const i=ue(MCe),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([p({type:PMe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([p({type:ti,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([p()],e.prototype,"gdbVersion",void 0),u([p({readOnly:!0,type:Wct,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:mZ.read}}}})],e.prototype,"geometryType",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([p({readOnly:!0,type:U3})],e.prototype,"heightModelInfo",void 0),u([p({type:Date})],e.prototype,"historicMoment",void 0),u([p({readOnly:!0})],e.prototype,"isTable",void 0),u([De("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([p(Eat)],e.prototype,"minScale",void 0),u([De("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([p(Cat)],e.prototype,"maxScale",void 0),u([De("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([p({type:String})],e.prototype,"globalIdField",void 0),u([De("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([p({type:String})],e.prototype,"objectIdField",void 0),u([De("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([p({type:ew})],e.prototype,"preferredTimeReference",void 0),u([p({type:[Yct],readOnly:!0})],e.prototype,"relationships",void 0),u([p()],e.prototype,"sourceJSON",void 0),u([p({type:Boolean})],e.prototype,"returnM",void 0),u([p({type:Boolean})],e.prototype,"returnZ",void 0),u([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([De("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([p({type:Ye,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([p({type:xt.ofType(Vg),readOnly:!0})],e.prototype,"indexes",void 0),u([p(OV)],e.prototype,"url",null),u([Xe("url")],e.prototype,"writeUrl",null),u([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([De("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([N("esri.layers.mixins.FeatureLayerBase")],e),e};let LC=class extends hn(Ae){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],LC.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],LC.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],LC.prototype,"returnType",void 0),LC=u([N("esri.layers.support.ExpressionInfo")],LC);const Wie=LC;var yZ;let I0=yZ=class extends Ae{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new yZ({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ue(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],I0.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"onStatisticField",void 0),u([p({type:Wie,json:{write:!0}})],I0.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"statisticType",void 0),I0=yZ=u([N("esri.layers.support.AggregateField")],I0);const X2=I0;let Ob=class extends Ae{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Ob.prototype,"type",void 0),Ob=u([N("esri.layers.support.FeatureReduction")],Ob);const Yie="__begin__",Xie="__end__",aut=new RegExp(Yie,"ig"),lut=new RegExp(Xie,"ig"),Rhe=new RegExp("^"+Yie,"i"),Phe=new RegExp(Xie+"$","i"),ZU='"',cut=ZU+" + ",uut=" + "+ZU;function hut(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function dut(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function LV(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=hut(t.labelExpression),e.type="conventional"),e}function put(t){const e=LV(t);if(!e)return null;switch(e.type){case"conventional":return _Z(e.expression);case"arcade":return e.expression}return null}function fut(t){const e=LV(t);if(!e)return null;switch(e.type){case"conventional":return gut(e.expression);case"arcade":return Zie(e.expression)}return null}function _Z(t){let e;return t?(e=wm(t,i=>Yie+'$feature["'+i+'"]'+Xie),e=Rhe.test(e)?e.replace(Rhe,""):ZU+e,e=Phe.test(e)?e.replace(Phe,""):e+ZU,e=e.replace(aut,cut).replace(lut,uut)):e='""',e}const mut=/^\s*\{([^}]+)\}\s*$/i;function gut(t){const e=t==null?void 0:t.match(mut);return e&&e[1].trim()||null}const yut=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,_ut=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,vut=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Zie(t){if(!t)return null;let e=yut.exec(t)||_ut.exec(t);return e?e[1]||e[3]:(e=vut.exec(t),e?e[2]:null)}var vZ;let C1=vZ=class extends Ae{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?_Z(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=_Z(this.value)),t!=null&&(e[i]=t)}clone(){return new vZ({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],C1.prototype,"expression",void 0),u([De("expression",["expression","value"])],C1.prototype,"readExpression",null),u([Xe("expression")],C1.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],C1.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],C1.prototype,"value",void 0),C1=vZ=u([N("esri.layers.support.LabelExpressionInfo")],C1);const IMe=C1,$Me=[252,146,31,255],cqt=[153,153,153,255],LMe={type:"esriSMS",style:"esriSMSCircle",size:6,color:$Me,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},DMe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:$Me},NMe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},but={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},wut={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},xut={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Tut={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Sut=gm.fromJSON(LMe),Eut=uh.fromJSON(DMe),Cut=Cy.fromJSON(NMe),Mut=E3.fromJSON(but);function uqt(t){if(A(t))return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return Sut;case"polyline":return Eut;case"polygon":case"extent":return Cut}return null}const hqt=gm.fromJSON(wut),dqt=uh.fromJSON(xut),pqt=Cy.fromJSON(Tut);var bZ;const ZN=new Hi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function JN(t,e,i){return{enabled:!Cwe(i==null?void 0:i.layer)}}function FMe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function Aut(t){return(t==null?void 0:t.type)==="map-image"}function UMe(t){var e,i;return!!Aut(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function Out(t){return FMe(t)||UMe(t==null?void 0:t.layer)}let oo=bZ=class extends Ae{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Mut,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=dut(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Zie(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&FMe(r))t=new IMe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return LV(this)}getLabelExpressionArcade(){return put(this)}getLabelExpressionSingleField(){return fut(this)}hash(){return JSON.stringify(this)}clone(){return new bZ({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ue(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ue(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],oo.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:JN}}}}})],oo.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:JN}}}}})],oo.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&UMe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],oo.prototype,"labelExpression",void 0),u([De("labelExpression")],oo.prototype,"readLabelExpression",null),u([Xe("labelExpression")],oo.prototype,"writeLabelExpression",null),u([p({type:IMe,json:{write:{overridePolicy:(t,e,i)=>Out(i)?{allowNull:!0}:{enabled:!1}}}})],oo.prototype,"labelExpressionInfo",void 0),u([Xe("labelExpressionInfo")],oo.prototype,"writeLabelExpressionInfo",null),u([p({type:ZN.apiValues,json:{type:ZN.jsonValues,read:ZN.read,write:ZN.write}})],oo.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],oo.prototype,"labelPosition",void 0),u([p({type:Number})],oo.prototype,"maxScale",void 0),u([Xe("maxScale")],oo.prototype,"writeMaxScale",null),u([p({type:Number})],oo.prototype,"minScale",void 0),u([Xe("minScale")],oo.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:JN}}}}})],oo.prototype,"repeatLabel",void 0),u([p({type:Number,cast:kr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:JN}}}}})],oo.prototype,"repeatLabelDistance",void 0),u([p({types:yJe,json:{origins:{"web-scene":{types:_Je,write:Rue,default:null}},write:Rue,default:null}})],oo.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],oo.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],oo.prototype,"where",void 0),oo=bZ=u([N("esri.layers.support.LabelClass")],oo);const G3=oo;var wZ;const z7=gw({types:nV}),Rut="esri.layers.support.FeatureReductionBinning";let kc=wZ=class extends Ob{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Tc(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?z$(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new hD({defaultSymbol:z7(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:z7(n.symbol,n,i)}))}):new GA({symbol:z7(e.defaultSymbol,e,i)}):null}clone(){return new wZ({fields:ue(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ue(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ue(this.popupTemplate),renderer:ue(this.renderer)})}};u([It({binning:"binning"})],kc.prototype,"type",void 0),u([It({geohash:"geohash"})],kc.prototype,"binType",void 0),u([p({type:Number,range:{min:1,max:9},json:{write:!0}})],kc.prototype,"fixedBinLevel",void 0),u([p({type:[G3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],kc.prototype,"labelingInfo",void 0),u([p(AV)],kc.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],kc.prototype,"maxScale",void 0),u([p(dD)],kc.prototype,"popupEnabled",void 0),u([p({type:vw,json:{name:"popupInfo",write:!0}})],kc.prototype,"popupTemplate",void 0),u([p({type:[X2],json:{write:!0}})],kc.prototype,"fields",void 0),u([Xe("fields")],kc.prototype,"writeFields",null),u([p({types:L3,json:{write:{target:"drawingInfo.renderer"}}})],kc.prototype,"renderer",void 0),u([De("renderer",["drawingInfo.renderer"])],kc.prototype,"readRenderer",null),kc=wZ=u([N(Rut)],kc);const kMe=kc;var xZ;const B7=gw({types:nV}),Put="esri.layers.support.FeatureReductionCluster";function Ihe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Qo=xZ=class extends Ae{constructor(t){super(t),this.type="cluster",this.clusterRadius=kr("80px"),this.clusterMinSize=kr("12px"),this.clusterMaxSize=kr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?Ihe(r)?null:z$(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new hD({defaultSymbol:B7(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:B7(o.symbol,o,i)}))}):new GA({symbol:B7(e.defaultSymbol,e,i)}):null}readSymbol(t,e,i){var s,n,o;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r&&Ihe(r)?(o=z$(r,e,i))==null?void 0:o.symbol:null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new GA({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Tc(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>X2.fromJSON(r))}clone(){return new xZ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ue(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ue(this.fields),maxScale:this.maxScale,renderer:ue(this.renderer),symbol:ue(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ue(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Qo.prototype,"type",void 0),u([p({type:Number,cast:t=>t==="auto"?t:kr(t),json:{write:!0}})],Qo.prototype,"clusterRadius",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Qo.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:kr,json:{write:!0}})],Qo.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Qo.prototype,"maxScale",void 0),u([p(dD)],Qo.prototype,"popupEnabled",void 0),u([p({type:vw,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Qo.prototype,"popupTemplate",void 0),u([p({types:L3,json:{write:{target:"drawingInfo.renderer"}}})],Qo.prototype,"renderer",void 0),u([De("renderer",["drawingInfo.renderer"])],Qo.prototype,"readRenderer",null),u([p({types:mJe})],Qo.prototype,"symbol",void 0),u([De("symbol",["drawingInfo.renderer"])],Qo.prototype,"readSymbol",null),u([Xe("symbol")],Qo.prototype,"writeSymbol",null),u([p({type:[G3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Qo.prototype,"labelingInfo",void 0),u([p(AV)],Qo.prototype,"labelsVisible",void 0),u([p({type:[X2],json:{write:!0}})],Qo.prototype,"fields",void 0),u([Xe("fields")],Qo.prototype,"writeFields",null),u([De("fields")],Qo.prototype,"readFields",null),Qo=xZ=u([N(Put)],Qo);const VMe=Qo;var TZ;let O6=TZ=class extends Ob{constructor(t){super(t),this.type="selection"}clone(){return new TZ}};u([p({type:["selection"]})],O6.prototype,"type",void 0),O6=TZ=u([N("esri.layers.support.FeatureReductionSelection")],O6);const $he=O6,Lhe={key:"type",base:Ob,typeMap:{cluster:VMe,binning:kMe}},Iut={types:{key:"type",base:Ob,typeMap:{selection:$he,cluster:VMe,binning:kMe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Lhe},"portal-item":{types:Lhe},"web-scene":{types:{key:"type",base:Ob,typeMap:{selection:$he}}}}}},jS={Base64:0,Hex:1,String:2,Raw:3},QM=8,zMe=(1<<QM)-1;function xb(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function $ut(t){const e=[];for(let i=0,r=t.length*QM;i<r;i+=QM)e[i>>5]|=(t.charCodeAt(i/QM)&zMe)<<i%32;return e}function Lut(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=QM)e.push(String.fromCharCode(t[i>>5]>>>i%32&zMe));return e.join("")}function Dut(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function Nut(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function Fut(t,e){return t<<e|t>>>32-e}function DV(t,e,i,r,s,n){return xb(Fut(xb(xb(e,t),xb(r,n)),s),i)}function Yl(t,e,i,r,s,n,o){return DV(e&i|~e&r,t,e,s,n,o)}function Xl(t,e,i,r,s,n,o){return DV(e&r|i&~r,t,e,s,n,o)}function Zl(t,e,i,r,s,n,o){return DV(e^i^r,t,e,s,n,o)}function Jl(t,e,i,r,s,n,o){return DV(i^(e|~r),t,e,s,n,o)}function Uut(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,h=n;i=Yl(i,r,s,n,t[o+0],7,-680876936),n=Yl(n,i,r,s,t[o+1],12,-389564586),s=Yl(s,n,i,r,t[o+2],17,606105819),r=Yl(r,s,n,i,t[o+3],22,-1044525330),i=Yl(i,r,s,n,t[o+4],7,-176418897),n=Yl(n,i,r,s,t[o+5],12,1200080426),s=Yl(s,n,i,r,t[o+6],17,-1473231341),r=Yl(r,s,n,i,t[o+7],22,-45705983),i=Yl(i,r,s,n,t[o+8],7,1770035416),n=Yl(n,i,r,s,t[o+9],12,-1958414417),s=Yl(s,n,i,r,t[o+10],17,-42063),r=Yl(r,s,n,i,t[o+11],22,-1990404162),i=Yl(i,r,s,n,t[o+12],7,1804603682),n=Yl(n,i,r,s,t[o+13],12,-40341101),s=Yl(s,n,i,r,t[o+14],17,-1502002290),r=Yl(r,s,n,i,t[o+15],22,1236535329),i=Xl(i,r,s,n,t[o+1],5,-165796510),n=Xl(n,i,r,s,t[o+6],9,-1069501632),s=Xl(s,n,i,r,t[o+11],14,643717713),r=Xl(r,s,n,i,t[o+0],20,-373897302),i=Xl(i,r,s,n,t[o+5],5,-701558691),n=Xl(n,i,r,s,t[o+10],9,38016083),s=Xl(s,n,i,r,t[o+15],14,-660478335),r=Xl(r,s,n,i,t[o+4],20,-405537848),i=Xl(i,r,s,n,t[o+9],5,568446438),n=Xl(n,i,r,s,t[o+14],9,-1019803690),s=Xl(s,n,i,r,t[o+3],14,-187363961),r=Xl(r,s,n,i,t[o+8],20,1163531501),i=Xl(i,r,s,n,t[o+13],5,-1444681467),n=Xl(n,i,r,s,t[o+2],9,-51403784),s=Xl(s,n,i,r,t[o+7],14,1735328473),r=Xl(r,s,n,i,t[o+12],20,-1926607734),i=Zl(i,r,s,n,t[o+5],4,-378558),n=Zl(n,i,r,s,t[o+8],11,-2022574463),s=Zl(s,n,i,r,t[o+11],16,1839030562),r=Zl(r,s,n,i,t[o+14],23,-35309556),i=Zl(i,r,s,n,t[o+1],4,-1530992060),n=Zl(n,i,r,s,t[o+4],11,1272893353),s=Zl(s,n,i,r,t[o+7],16,-155497632),r=Zl(r,s,n,i,t[o+10],23,-1094730640),i=Zl(i,r,s,n,t[o+13],4,681279174),n=Zl(n,i,r,s,t[o+0],11,-358537222),s=Zl(s,n,i,r,t[o+3],16,-722521979),r=Zl(r,s,n,i,t[o+6],23,76029189),i=Zl(i,r,s,n,t[o+9],4,-640364487),n=Zl(n,i,r,s,t[o+12],11,-421815835),s=Zl(s,n,i,r,t[o+15],16,530742520),r=Zl(r,s,n,i,t[o+2],23,-995338651),i=Jl(i,r,s,n,t[o+0],6,-198630844),n=Jl(n,i,r,s,t[o+7],10,1126891415),s=Jl(s,n,i,r,t[o+14],15,-1416354905),r=Jl(r,s,n,i,t[o+5],21,-57434055),i=Jl(i,r,s,n,t[o+12],6,1700485571),n=Jl(n,i,r,s,t[o+3],10,-1894986606),s=Jl(s,n,i,r,t[o+10],15,-1051523),r=Jl(r,s,n,i,t[o+1],21,-2054922799),i=Jl(i,r,s,n,t[o+8],6,1873313359),n=Jl(n,i,r,s,t[o+15],10,-30611744),s=Jl(s,n,i,r,t[o+6],15,-1560198380),r=Jl(r,s,n,i,t[o+13],21,1309151649),i=Jl(i,r,s,n,t[o+4],6,-145523070),n=Jl(n,i,r,s,t[o+11],10,-1120210379),s=Jl(s,n,i,r,t[o+2],15,718787259),r=Jl(r,s,n,i,t[o+9],21,-343485551),i=xb(i,a),r=xb(r,l),s=xb(s,c),n=xb(n,h)}return[i,r,s,n]}function BMe(t,e=jS.Hex){const i=e||jS.Base64,r=Uut($ut(t),t.length*QM);switch(i){case jS.Raw:return r;case jS.Hex:return Dut(r);case jS.String:return Lut(r);case jS.Base64:return Nut(r)}}var SZ;let TP=SZ=class extends CV{writeLevels(t,e,i){for(const r in t){const s=this.levels[r];return void(e.stops=s)}}clone(){return new SZ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:wb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:wb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ue(this.levels)})}};u([p()],TP.prototype,"levels",void 0),u([Xe("levels")],TP.prototype,"writeLevels",null),TP=SZ=u([N("esri.views.2d.engine.LevelDependentSizeVariable")],TP);const kut=le.getLogger("esri.views.2d.layers.support.clusterUtils");me.add("esri-cluster-arcade-enabled",!0);const Vut=me("esri-cluster-arcade-enabled"),zut=(t,e,i,r,s)=>{const n=e.clone();if(!Gut(n))return n;if(n.authoringInfo||(n.authoringInfo=new Eie),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=GMe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Lw(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=FO(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Lw(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Lw(t,l.field,"avg","number"):l.valueExpression&&(l.field=FO(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),A(a)&&!But(o)&&s&&(o.push(jMe(i,r)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Lw(t,o.field,"sum","number"):o.valueExpression&&(o.field=FO(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Lw(t,n.field,"mode","string"):n.valueExpression&&(n.field=FO(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Lw(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Lw(t,n.field,"avg","number"):n.valueExpression&&(n.field=FO(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},GMe=t=>{for(const e of t)if(e.type==="size")return e;return null};function fqt(t,e,i){const r=t.clone();let s=!1;if("visualVariables"in r){const n=(r.visualVariables||[]).filter(a=>a.valueExpression!=="$view.scale"),o=GMe(n);A(o)&&(r.visualVariables||(r.visualVariables=[]),r.visualVariables.push(jMe(e,i)),r.dynamicClusterSize=!0,s=!0)}return{renderer:r,didInject:s}}const But=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},jMe=(t,e)=>{const i=[new CC({value:0,size:0}),new CC({value:1})];if(A(e))return new CV({field:"cluster_count",stops:[...i,new CC({value:2,size:0})]});const r=Object.keys(e).reduce((s,n)=>({...s,[n]:[...i,new CC({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new CC({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new TP({field:"cluster_count",levels:r})},Gut=t=>{const e=i=>kut.error(new J("Unsupported-renderer",i,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!Vut){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function jut(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+BMe(n)}}}function FO(t,e,i,r){const s=BMe(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new X2({name:n,isAutoGenerated:!0,onStatisticExpression:new Wie({expression:e,returnType:r}),statisticType:i})),n}function Lw(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=jut(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new X2({name:n,isAutoGenerated:!0,onStatisticExpression:new Wie({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new X2({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const HMe=t=>{let e=class extends t{constructor(...i){super(...i),this.own(this.watch("renderer",()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},!0))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){var a;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new X2({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(l=>!l.isAutoGenerated);if(i.renderer&&!((a=i.renderer.authoringInfo)!=null&&a.isAutoGenerated))return r.fields=[...s,...n],r;if(i.symbol)return r.fields=[...s,...n],r.renderer=null,r;if(!this.renderer)return i;const o=zut(s,this.renderer,i,null,!1);return r.fields=[...s,...n],r.renderer=o,r}};return u([p(Iut)],e.prototype,"featureReduction",null),e=u([N("esri.layers.mixins.FeatureReductionLayer")],e),e},Hut={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},_D=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&Nbe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}read(i,r){r&&(r.layer=this),THe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=Hut[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new J("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof J&&l.name==="web-document-write:property-required").length;return SA(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new J("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([p(OCe)],e.prototype,"listMode",void 0),u([Xe("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([Xe("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(HU)],e.prototype,"opacity",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([Xe("title"),Xe(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([N("esri.layers.mixins.OperationalLayer")],e),e};var EZ;const G7=new Hi({asc:"ascending",desc:"descending"});let DC=EZ=class extends Ae{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new EZ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([p({type:String,json:{write:!0}})],DC.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],DC.prototype,"valueExpression",void 0),u([p({type:G7.apiValues,json:{read:G7.read,write:G7.write}})],DC.prototype,"order",void 0),DC=EZ=u([N("esri.layers.support.OrderByInfo")],DC);const qMe=DC;function qut(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new qMe;return s.read(r,i),[s]}function Wut(t,e,i,r){const s=t.find(n=>!!n.field);s&&Tc(i,[s.toJSON()],e)}const WMe=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([p({type:[qMe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:qut},write:{target:"layerDefinition.orderBy",writer:Wut}}})],e.prototype,"orderBy",void 0),e=u([N("esri.layers.mixins.OrderedLayer")],e),e};async function Yut(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return ub(t);const i=Ye.WGS84;return await Vte(e,i),bd(t,i)}function mqt(t,e){if(!Xut(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function Xut(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function gqt(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}async function yqt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return Yut(i)}const _qt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function Dhe(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const vD=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=He(this.portalItem)}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new wI({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await se(()=>import("./layersLoader-019e8cf4.js"),["assets/layersLoader-019e8cf4.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"]);return _i(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(s){throw kn(s)||le.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Pl(r),!0)))}async _setUserPrivileges(i,r){if(!Mr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Pl(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return Dhe(s);let o,a;if(n)o=s.portal.url;else try{o=await Awe(this.url,r)}catch(d){Pl(d)}if(!o||!KHe(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const d=b(r)?r.signal:null;a=await(es==null?void 0:es.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){Pl(d)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new wI({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return Dhe(s)}catch(d){Pl(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){Pl(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?es==null?void 0:es.findCredential(this.url):null;if(!r)return!0;const s=KN.credential===r?KN.user:await this._fetchEditingUser(i);return KN.credential=r,KN.user=s,A(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,d;const r=(d=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:d.user;if(r)return r;const s=es.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=du.getDefault();if(o&&o.loaded&&Op(o.restUrl)===Op(n))return o.user;const a=`${n}/community/self`,l=b(i)?i.signal:null,c=await Sm(tr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Hee.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||du.getDefault());return s&&n&&!Gbe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new J("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([p({type:wI})],e.prototype,"portalItem",null),u([De("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([Xe("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([N("esri.layers.mixins.PortalLayer")],e),e},KN={credential:null,user:null};let SP=class extends Ee{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([p()],SP.prototype,"updating",void 0),u([p()],SP.prototype,"status",void 0),SP=u([N("esri.layers.support.PublishingInfo")],SP);const Zut=SP,YMe="esri.layers.mixins.PublishableLayer",Jut=Symbol(YMe),Kut=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new Zut;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=Jut,u([p({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([N(YMe)],i),i},B$=new xt,UI=new WeakMap;function Qut(t){XMe(t)&&B$.push(t)}function eht(t){XMe(t)&&B$.includes(t)&&B$.remove(t)}function XMe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function ZMe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:ZMe(e,t%e):0}let j7=0,QN=0;function tht(){const t=Date.now();for(const e of B$)e.refreshInterval&&t-(UI.get(e)??0)+5>=6e4*e.refreshInterval&&(UI.set(e,t),e.refresh(t))}abe(()=>{const t=Date.now();let e=0;for(const i of B$)e=ZMe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?UI.get(i)||UI.set(i,t):UI.delete(i);if(e!==QN){if(QN=e,clearInterval(j7),QN===0)return void(j7=0);j7=setInterval(tht,QN)}});function iht(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const bD=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=dee(()=>this.hasDataChanged()),this.when().then(()=>{Qut(this)},()=>{})}destroy(){eht(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){VM(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{le.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([p({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p()],e.prototype,"refreshParameters",null),e=u([N("esri.layers.mixins.RefreshableLayer")],e),e},j3=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&rht(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([N("esri.layers.mixins.ScaleRangeLayer")],e),e};function rht(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const JMe=jl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let EP=class extends hn(Ae){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Gst(this.value,this.unit,"milliseconds")}};u([It(JMe,{nonNullable:!0})],EP.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],EP.prototype,"value",void 0),EP=u([N("esri.TimeInterval")],EP);const JU=EP;function Nhe(t,e){return JU.fromJSON({value:t,unit:e})}let nc=class extends hn(Ae){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,i){if(!i.timeExtent||!Array.isArray(i.timeExtent)||i.timeExtent.length!==2)return null;const r=new Date(i.timeExtent[0]),s=new Date(i.timeExtent[1]);return new Jp({start:r,end:s})}writeFullTimeExtent(e,i){e&&b(e.start)&&b(e.end)?i.timeExtent=[e.start.getTime(),e.end.getTime()]:i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?Nhe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?Nhe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],nc.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],nc.prototype,"endField",void 0),u([p({type:Jp,json:{write:{enabled:!0,allowNull:!0}}})],nc.prototype,"fullTimeExtent",void 0),u([De("fullTimeExtent",["timeExtent"])],nc.prototype,"readFullTimeExtent",null),u([Xe("fullTimeExtent")],nc.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],nc.prototype,"hasLiveData",void 0),u([p({type:JU,json:{write:{enabled:!0,allowNull:!0}}})],nc.prototype,"interval",void 0),u([De("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],nc.prototype,"readInterval",null),u([Xe("interval")],nc.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],nc.prototype,"startField",void 0),u([p({type:ew,json:{write:{enabled:!0,allowNull:!0}}})],nc.prototype,"timeReference",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],nc.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],nc.prototype,"useTime",void 0),nc=u([N("esri.layers.support.TimeInfo")],nc);const KMe=nc,NV=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=JMe.fromJSON(s.timeOffsetUnits);return n&&o?new JU({value:n,unit:o}):null}set timeInfo(i){hte(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([p({type:Jp,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:JU})],e.prototype,"timeOffset",void 0),u([De("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:KMe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([N("esri.layers.mixins.TemporalLayer")],e),e},Fhe=new Hi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let M1=class extends hn(Ae){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([p({json:{write:!0}})],M1.prototype,"name",void 0),u([p({json:{write:!0}})],M1.prototype,"description",void 0),u([p({json:{read:Fhe.read,write:Fhe.write}})],M1.prototype,"drawingTool",void 0),u([p({json:{write:!0}})],M1.prototype,"prototype",void 0),u([p({json:{write:!0}})],M1.prototype,"thumbnail",void 0),M1=u([N("esri.layers.support.FeatureTemplate")],M1);const FV=M1;let $0=class extends hn(Ae){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=pie(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};u([p({json:{write:!0}})],$0.prototype,"id",void 0),u([p({json:{write:!0}})],$0.prototype,"name",void 0),u([p({json:{write:!0}})],$0.prototype,"domains",void 0),u([De("domains")],$0.prototype,"readDomains",null),u([Xe("domains")],$0.prototype,"writeDomains",null),u([p({type:[FV],json:{write:!0}})],$0.prototype,"templates",void 0),$0=u([N("esri.layers.support.FeatureType")],$0);const UV=$0;function sht(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function Uhe(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function khe(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let QMe=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const i=[];for(const r of e){const s=r==null?void 0:r.name,n=zhe(r==null?void 0:r.name);if(s&&n){const o=Vhe(s);this._fieldsMap.set(s,r),this._fieldsMap.set(o,r),this._normalizedFieldsMap.set(n,r),i.push(o),sht(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):jk(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Uhe(r)||khe(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Uhe(e)||khe(e)||e.nullable||BXe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(Vhe(e))??this._normalizedFieldsMap.get(zhe(e)),i&&this._fieldsMap.set(e,i),i)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const i=this.get(e);if(i)return i.name??void 0}};function Vhe(t){return t.trim().toLowerCase()}function zhe(t){var e;return((e=$Xe(t))==null?void 0:e.toLowerCase())??""}function eAe(){return{fields:{type:[R3],value:null},fieldsIndex:{readOnly:!0,get(){return new QMe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||le.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return mxe(this.fieldsIndex,t)}}}}const H7=le.getLogger("esri.layers.support.labelingInfo"),nht=/\[([^\[\]]+)\]/gi;function CZ(t,e,i){return t?t.map(r=>{const s=new G3;if(s.read(r,i),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(nht,(o,a)=>`[${oht(a,n)}]`)}return s}):null}function oht(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const aht={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function lht(t,e){const i=ue(t);return i.some(r=>cht(r,e))?[]:i}function cht(t,e){const i=t.labelPlacement,r=aht[e];if(!t.symbol)return H7.warn("No ILabelClass symbol specified."),!0;if(!r)return H7.error(new J("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!r.includes(i)){const s=r[0];i&&H7.warn(`Found invalid label placement type ${i} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const Rf=[];function tAe(t,e){if(_Ce(t.url??""))return!0;const{wkid:i}=e;for(const r of Rf){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Rf.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),Rf.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),Rf.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),Rf.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),Rf.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),Rf.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),Rf.push([10.61,()=>new Set([102497])]),Rf.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),Rf.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),Rf.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function uht(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Sm(r.populateFromStyle());if(_i(i),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new Np("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const hht=["oid","global-id"],dht=["oid","global-id","guid"];function Jie({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=_ht({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=wht({titleBase:s,fields:i,displayField:t}),l=bht();return new vw({title:a,content:l,fieldInfos:o})}const pht=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],fht=(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r})=>r?r.has(t.name):!iAe(t.name,e)&&(!i||t.name!==i)&&!hht.includes(t.type)&&!pht.some(s=>s.test(t.name));function mht(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(ght),t}function ght(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Bhe(t)?-1:Bhe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function iAe(t,e){if(!t||!e)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(t.toLowerCase())}function yht(t,e){return t.editable&&!dht.includes(t.type)&&!iAe(t.name,e)}function _ht({editFieldsInfo:t,fields:e,objectIdField:i},r){return mht(e??[],(r==null?void 0:r.ignoreFieldTypes)||xht).map(s=>new JL({fieldName:s.name,isEditable:yht(s,t),label:s.alias,format:vht(s),visible:fht(s,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function vht(t){switch(t.type){case"small-integer":case"integer":case"single":return new pM({digitSeparator:!0,places:0});case"double":return new pM({digitSeparator:!0,places:2});case"date":return new pM({dateFormat:"long-month-day-year"});default:return t.type==="string"&&wxe(t.name)?new pM({digitSeparator:!0,places:0}):null}}function bht(){return[new $A,new C$]}function wht(t){const e=NXe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function Bhe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const xht=["geometry","blob","raster","guid","xml"],Mc="FeatureLayer",rAe="esri.layers.FeatureLayer",Tht=le.getLogger(rAe);function eF(t,e){return new J("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function Ghe(t){return t&&t instanceof xt}const q7=eAe();function W7(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Dt=class extends out(HMe(xCe(Kut(fat(F3(WMe(NV(j3(bD(vCe(_D(vD(CS(Die(fCe(hn(V_))))))))))))))))){constructor(...e){super(...e),this._handles=new ir,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ye.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=He(this._handles)}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){var s;const i=b(e)?e.signal:null;if((s=this.portalItem)!=null&&s.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(i).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Pl).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstLayerId(i);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new J("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(i))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>Hct(this,e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,i){return i=i.layerDefinition||i,qie(i,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,i){return this._readEditingEnabled(i,!1)}readEditingEnabledFromWebMap(e,i,r){return this._readEditingEnabled(i,!0,r)}writeEditingEnabled(e,i){this._writeEditingEnabled(e,i,!1)}writeEditingEnabledToWebMap(e,i,r,s){this._writeEditingEnabled(e,i,!0,s)}get effectiveEditingEnabled(){return qct(this)}readIsTable(e,i){return(i=(i==null?void 0:i.layerDefinition)??i).type==="Table"||!i.geometryType}writeIsTable(e,i,r,s){s!=null&&s.writeLayerSchema&&Tc(r,e?"Table":"Feature Layer",i)}readGlobalIdField(e,i){return OMe(i.layerDefinition||i)}readObjectIdField(e,i){return RMe(i.layerDefinition||i)}get parsedUrl(){const e=jo(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=$2(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=$2(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){gU(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,i,r){var n;const s=(n=(i=i.layerDefinition||i).drawingInfo)==null?void 0:n.renderer;if(s){const o=z$(s,i,r)??void 0;return o||Tht.error("Failed to create renderer",{rendererDefinition:i.drawingInfo.renderer,layer:this,context:r}),o}if(i.defaultSymbol)return i.types&&i.types.length?new hD({defaultSymbol:Y7(i.defaultSymbol,i,r),field:i.typeIdField,uniqueValueInfos:i.types.map(o=>({id:o.id,symbol:Y7(o.symbol,o,r)}))}):new GA({symbol:Y7(i.defaultSymbol,i,r)})}set source(e){const i=this._get("source");i!==e&&(Ghe(i)&&this._resetMemorySource(i),Ghe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof xt?new Y0({layer:this,items:e}):e:null}readSource(e,i){const r=lD.fromJSON(i.featureSet);return new Y0({layer:this,items:(r==null?void 0:r.features)??[]})}readTemplates(e,i){const r=i.editFieldsInfo,s=r&&r.creatorField,n=r&&r.editorField;return e=e&&e.map(o=>FV.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,i){var n;const r=((n=i.layerDefinition)==null?void 0:n.name)??i.name,s=i.title||i.layerDefinition&&i.layerDefinition.title;if(r){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?lat(this.url,r):r;let a=r;if(!a&&this.url){const l=N3(this.url);b(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),Lie(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,i){return i.title||i.layerDefinition&&i.layerDefinition.name}readTypeIdField(e,i){let r=(i=i.layerDefinition||i).typeIdField;if(r&&i.fields){r=r.toLowerCase();const s=i.fields.find(n=>n.name.toLowerCase()===r);s&&(r=s.name)}return r}readTypes(e,i){e=(i=i.layerDefinition||i).types;const r=i.editFieldsInfo,s=r&&r.creatorField,n=r&&r.editorField;return e&&e.map(o=>(o=UV.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,i){return i.layerDefinition&&i.layerDefinition.defaultVisibility!=null?!!i.layerDefinition.defaultVisibility:i.visibility!=null?!!i.visibility:void 0}async addAttachment(e,i){return Rct(this,e,i,Mc)}async updateAttachment(e,i,r){return Pct(this,e,i,r,Mc)}async applyEdits(e,i){return Ict(this,e,i)}on(e,i){return super.on(e,i)}createPopupTemplate(e){return Jie(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:i}=await lp(se(()=>import("./FeatureLayerSource-151f2662.js"),["assets/FeatureLayerSource-151f2662.js","assets/assetEditingSupport-2cebf928.js"]),e);return new i({layer:this}).load({signal:e})}createQuery(){const e=Bct(this);e.dynamicDataSource=this.dynamicDataSource;const i=b(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,r=MV(this.definitionExpression,i);return e.where=r||"1=1",e}async deleteAttachments(e,i){return $ct(this,e,i,Mc)}async fetchRecomputedExtents(e){return Lct(this,e,Mc)}getFeatureType(e){const{typeIdField:i,types:r}=this;if(!i||!e)return null;const s=e.attributes?e.attributes[i]:void 0;if(s==null)return null;let n=null;return r==null||r.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,i){const r=i&&i.feature,s=this.getFeatureType(r);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,i){return Dct(this,e,i,Mc)}async queryFeatures(e,i){const r=await this.load(),s=await r.source.queryFeatures(_o.from(e)??r.createQuery(),i);if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=r;return s}async queryObjectIds(e,i){return Nct(this,e,i,Mc)}async queryFeatureCount(e,i){return Fct(this,e,i,Mc)}async queryExtent(e,i){return Uct(this,e,i,Mc)}async queryRelatedFeatures(e,i){return kct(this,e,i,Mc)}async queryRelatedFeaturesCount(e,i){return Vct(this,e,i,Mc)}async queryTopFeatures(e,i){var o;const{source:r,capabilities:s}=await this.load();if(!r.queryTopFeatures||!((o=s==null?void 0:s.query)!=null&&o.supportsTopFeaturesQuery))throw new J(Mc,"Layer source does not support queryTopFeatures capability");const n=await r.queryTopFeatures(DN.from(e),i);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopObjectIds||!(s!=null&&s.query.supportsTopFeaturesQuery))throw new J(Mc,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(DN.from(e),i)}async queryTopFeaturesExtent(e,i){var n;const{source:r,capabilities:s}=await this.load();if(!r.queryTopExtents||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new J(Mc,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(DN.from(e),i)}async queryTopFeatureCount(e,i){var n;const{source:r,capabilities:s}=await this.load();if(!r.queryTopCount||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new J(Mc,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(DN.from(e),i)}read(e,i){const r=e.featureCollection;if(r){const s=r.layers;s&&s.length===1&&(super.read(s[0],i),r.showLegend!=null&&super.read({showLegend:r.showLegend},i))}super.read(e,i),i&&i.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,i){i={...i,origin:(i==null?void 0:i.origin)??void 0,writeLayerSchema:(i==null?void 0:i.writeLayerSchema)??this._hasMemorySource()};const{origin:r,layerContainerType:s,messages:n}=i;if(this.dynamicDataSource)return n==null||n.push(eF(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&s!=="tables")return n==null||n.push(eF(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(eF(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&s==="tables")return n==null||n.push(eF(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,i)}clone(){if(this._hasMemorySource())throw new J(Mc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var i;return!!this.loaded&&(((i=this.source)==null?void 0:i.type)==="memory"||tAe(this,e))}async save(e){return(await se(()=>import("./featureLayerUtils-3941538f.js"),["assets/featureLayerUtils-3941538f.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"])).save(this,e)}async saveAs(e,i){return(await se(()=>import("./featureLayerUtils-3941538f.js"),["assets/featureLayerUtils-3941538f.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-dfe209c3.js","assets/jsonContext-90367540.js"])).saveAs(this,e,i)}_readEditingEnabled(e,i,r){var n;let s=(n=e.layerDefinition)==null?void 0:n.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,i&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(i=>i.trim()).includes("editing")}_writeEditingEnabled(e,i,r,s){var n,o;if(!e){const a=(o=(n=this.capabilities)==null?void 0:n.operations)!=null&&o.supportsSync?"Query,Sync":"Query";Tc("layerDefinition.capabilities",a,i),r&&!(s!=null&&s.writeLayerSchema)&&(i.capabilities=a)}}_getLayerDomain(e){const i=this.fieldsIndex.get(e);return i?i.domain:null}_fetchFirstLayerId(e){return tr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(i=>{const r=i.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async initLayerProperties(e){var i;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(i=this.portalItem)==null?void 0:i.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),gU(this.renderer,this.fieldsIndex),hte(this.timeInfo,this.fieldsIndex),uht(this,{origin:"service"})}async hasDataChanged(){return zct(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var i,r;const e=((i=this.parsedUrl)==null?void 0:i.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(r=this.fields)!=null&&r.some(s=>s.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,i){e&&e.forEach(r=>{const s=r.prototype&&r.prototype.attributes;s&&i&&delete s[i]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new J("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new J("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(i=>{i.layer=this,i.sourceLayer=this}),this._handles.add([e.on("after-add",i=>{i.item.layer=this,i.item.sourceLayer=this}),e.on("after-remove",i=>{i.item.layer=null,i.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(i=>{i.layer=null,i.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([De("service","capabilities")],Dt.prototype,"readCapabilities",null),u([p({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Dt.prototype,"charts",void 0),u([p({readOnly:!0})],Dt.prototype,"createQueryVersion",null),u([p({json:{read:{source:"layerDefinition.copyrightText"}}})],Dt.prototype,"copyright",void 0),u([p({json:{read:{source:"layerDefinition.displayField"}}})],Dt.prototype,"displayField",void 0),u([p({types:Hu,readOnly:!0})],Dt.prototype,"defaultSymbol",void 0),u([p({type:eu})],Dt.prototype,"dynamicDataSource",void 0),u([p({type:Boolean})],Dt.prototype,"editingEnabled",null),u([De(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Dt.prototype,"readEditingEnabled",null),u([De("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Dt.prototype,"readEditingEnabledFromWebMap",null),u([Xe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Dt.prototype,"writeEditingEnabled",null),u([Xe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Dt.prototype,"writeEditingEnabledToWebMap",null),u([p({readOnly:!0})],Dt.prototype,"effectiveEditingEnabled",null),u([p({...q7.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:W7}}}}})],Dt.prototype,"fields",void 0),u([p(q7.fieldsIndex)],Dt.prototype,"fieldsIndex",void 0),u([p({type:eat,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Dt.prototype,"formTemplate",void 0),u([p({json:{read:{source:"layerDefinition.extent"}}})],Dt.prototype,"fullExtent",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:W7,writer(t,e,i){const r=t?mZ.toJSON(t):null;r&&Tc(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:mZ.read}}})],Dt.prototype,"geometryType",void 0),u([p({json:{read:{source:"layerDefinition.hasM"}}})],Dt.prototype,"hasM",void 0),u([p({json:{read:{source:"layerDefinition.hasZ"}}})],Dt.prototype,"hasZ",void 0),u([p(Fie)],Dt.prototype,"id",void 0),u([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Dt.prototype,"infoFor3D",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Dt.prototype,"isTable",void 0),u([De("service","isTable",["type","geometryType"]),De("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Dt.prototype,"readIsTable",null),u([Xe("web-map","isTable")],Dt.prototype,"writeIsTable",null),u([p(AV)],Dt.prototype,"labelsVisible",void 0),u([p({type:[G3],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:CZ},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:CZ},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Dt.prototype,"labelingInfo",void 0),u([p((()=>{const t=ue(Tat);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){Tc(r,Vk(e),i)}}},t})())],Dt.prototype,"opacity",void 0),u([p(Nie)],Dt.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:(()=>{const t=ue(OCe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Dt.prototype,"listMode",void 0),u([De("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Dt.prototype,"readGlobalIdField",null),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:W7}}}}})],Dt.prototype,"objectIdField",void 0),u([De("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Dt.prototype,"readObjectIdField",null),u([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Dt.prototype,"operationalLayerType",void 0),u([p(q7.outFields)],Dt.prototype,"outFields",void 0),u([p({readOnly:!0})],Dt.prototype,"parsedUrl",null),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Dt.prototype,"path",void 0),u([p(dD)],Dt.prototype,"popupEnabled",void 0),u([p({type:vw,json:{name:"popupInfo",write:!0}})],Dt.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],Dt.prototype,"defaultPopupTemplate",null),u([p({types:L3,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Iie,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Dt.prototype,"renderer",null),u([De("service","renderer",["drawingInfo.renderer","defaultSymbol"]),De("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Dt.prototype,"readRenderer",null),u([p((()=>{const t=ue(CCe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Dt.prototype,"screenSizePerspectiveEnabled",void 0),u([p({clonable:!1})],Dt.prototype,"source",null),u([pi("source")],Dt.prototype,"castSource",null),u([De("portal-item","source",["featureSet"]),De("web-map","source",["featureSet"])],Dt.prototype,"readSource",null),u([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Dt.prototype,"spatialReference",void 0),u([p({type:Number})],Dt.prototype,"subtypeCode",void 0),u([p({type:[FV]})],Dt.prototype,"templates",void 0),u([De("templates",["editFieldsInfo","creatorField","editorField","templates"])],Dt.prototype,"readTemplates",null),u([p({type:KMe})],Dt.prototype,"timeInfo",void 0),u([p()],Dt.prototype,"title",void 0),u([De("service","title",["name"]),De("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Dt.prototype,"readTitle",null),u([De("web-map","title",["layerDefinition.name","title"])],Dt.prototype,"readTitleFromWebMap",null),u([p({type:String})],Dt.prototype,"sublayerTitleMode",void 0),u([p({json:{read:!1}})],Dt.prototype,"type",void 0),u([p({type:String})],Dt.prototype,"typeIdField",void 0),u([De("service","typeIdField"),De("typeIdField",["layerDefinition.typeIdField"])],Dt.prototype,"readTypeIdField",null),u([p({type:[UV]})],Dt.prototype,"types",void 0),u([De("service","types",["types"]),De("types",["layerDefinition.types"])],Dt.prototype,"readTypes",null),u([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Dt.prototype,"visible",void 0),u([De("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Dt.prototype,"readVisible",null),Dt=u([N(rAe)],Dt);const Y7=gw({types:nV}),kV=Dt,Sht=Object.freeze(Object.defineProperty({__proto__:null,default:kV},Symbol.toStringTag,{value:"Module"})),Eht=["$datastore","$map","$layer","$aggregatedfeatures"],Cht="esri.widgets.Feature.support.arcadeFeatureUtils",Mht=le.getLogger(Cht);function Aht(t){return typeof t=="string"?sD(rie(t)):Array.isArray(t)?Oht(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?Rht(t):t}function Oht(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?sD(rie(e)):e}</li>`).join("")}</ul>`}function Rht(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${typeof i=="string"?sD(rie(i)):i}</td></tr>`}).join("")}</table>`}function Pht({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h=s.sr,d={map:n,spatialReference:h,interceptor:a};if(c==="$map"&&(r.vars[c]=e.convertMapToFeatureSetCollection(d)),c==="$layer"&&(r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(r.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:g,geometryType:y,spatialReference:v,displayField:x}=f,S=new kV({fields:m,objectIdField:g,geometryType:y,spatialReference:v,displayField:x,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:t});r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:S,spatialReference:v,interceptor:a})}})}function sAe(){return se(()=>import("./arcadeUtils-408e2c2f.js").then(t=>t.ax),["assets/arcadeUtils-408e2c2f.js","assets/arcadeTimeUtils-9099ffb4.js","assets/number-3acb8d45.js","assets/hash-0ddfbf4b.js"])}function Iht(t){return"createQuery"in t&&"queryFeatures"in t}async function $ht({graphic:t,view:e}){const{isAggregate:i,layer:r}=t;if(!i||!r||(e==null?void 0:e.type)!=="2d")return[];const s=await e.whenLayerView(r);if(!Iht(s))return[];const n=s.createQuery(),o=t.getObjectId();n.aggregateIds=o!=null?[o]:[];const{features:a}=await s.queryFeatures(n);return a}async function nAe({expressionInfo:t,arcadeUtils:e,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=Eht.filter(m=>e.hasVariable(a,m)),[c]=await Promise.all([$ht({graphic:n,view:o}),e.loadScriptDependencies(a,!0,l)]),h=e.getViewInfo({spatialReference:r}),d=e.createExecContext(n,h);d.interceptor=i,d.useAsync=!0,Pht({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:d,viewInfo:h,map:s,graphic:n,interceptor:i});const f=e.createFunction(a,d);return e.executeAsyncFunction(f,d).catch(m=>Mht.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:t}))}async function Lht({expressionInfos:t,spatialReference:e,graphic:i,interceptor:r,map:s,view:n}){if(!t||!t.length)return{};const o=await sAe(),a={};for(const h of t)a[`expression/${h.name}`]=nAe({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:e,map:s,graphic:i,view:n});const l=await hu(a),c={};for(const h in l)c[h]=Aht(l[h].value);return c}const Dht=1;let Lh=class extends Dm(Ee){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var s,n;const i=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const r=i==="fields"?new bV:i==="media"?new s2:i==="text"?new VU:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=qM(this._compile,Dht,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:s,spatialReference:n,map:o,view:a,_abortController:l}=this;if(!(i&&r&&n&&o))return void this._set("contentElement",null);const c=await sAe();if(l!==this._abortController)return;const h=await nAe({arcadeUtils:c,expressionInfo:i,graphic:r,interceptor:s,map:o,spatialReference:n,view:a});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const d=await h.castAsJsonAsync(l==null?void 0:l.signal),f=d==null?void 0:d.type,m=f==="media"?O$.fromJSON(d):f==="text"?LA.fromJSON(d):f==="fields"?$A.fromJSON(d):null;this._set("contentElement",m)},this.handles.add([ae(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),ii),ae(()=>[this.contentElement],()=>this._createVM(),ii)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:r}=this;return e?"loading":i||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};u([p()],Lh.prototype,"_abortController",void 0),u([p({type:xxe})],Lh.prototype,"expressionInfo",void 0),u([p({type:Ho})],Lh.prototype,"graphic",void 0),u([p({readOnly:!0})],Lh.prototype,"contentElement",void 0),u([p({readOnly:!0})],Lh.prototype,"contentElementViewModel",void 0),u([p()],Lh.prototype,"interceptor",void 0),u([p()],Lh.prototype,"spatialReference",null),u([p({readOnly:!0})],Lh.prototype,"state",null),u([p()],Lh.prototype,"map",null),u([p()],Lh.prototype,"view",void 0),Lh=u([N("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Lh);const Kie=Lh,tF={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let R6=class extends hl{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new Kie}initialize(){this.addHandles(ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),ii))}destroy(){this._destroyContentWidget()}renderLoading(){return ce("div",{key:"loading-container",class:tF.loadingSpinnerContainer},ce("span",{class:this.classes(tF.iconLoading,tF.spinner)}))}render(){var i;const{state:e}=this.viewModel;return ce("div",{class:tF.base},e==="loading"?this.renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,r=i==null?void 0:i.type;this._destroyContentWidget();const s=e?r==="fields"?new FSe({viewModel:e}):r==="media"?new OEe({viewModel:e}):r==="text"?new n6({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};u([p({type:Kie})],R6.prototype,"viewModel",void 0),R6=u([N("esri.widgets.Feature.FeatureExpression")],R6);const Nht=R6,X7=100;let Ls=class extends hn(bS(Dm(Ee))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await VM(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await VM(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await VM(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryThrottled=qM(this._queryController,X7,this),this._queryFeatureCountThrottled=qM(this._queryFeatureCountController,X7,this),this._queryPageThrottled=qM(this._queryPageController,X7,this),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal})))},this.handles.add([ae(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),ii),ae(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),ae(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:r}=this,s=1,n=Math.ceil(r/i)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(r=>{const s=r.clone(),n=F$(r.field,i);return s.field=n,s}):e??[]}get supportsCacheHint(){var e,i,r;return!!((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&r.supportsCacheHint)}get canQuery(){var i,r;const e=(r=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,i;return((i=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:i.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new xt}get relatedLayer(){const{layer:e,map:i,relationship:r}=this;return e!=null&&e.loaded&&i&&r?Tit(i,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:i}=this;return typeof e=="number"?((r=i==null?void 0:i.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new xt}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:r,canQuery:s}=this;return i?"loading":e||r?"querying":s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(i=>!i.destroyed&&i.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:r,objectId:s,_queryFeatureCountAbortController:n,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!o||!e||!i)return void this._set("featureCount",0);const l=i.createQuery(),c=new zA({cacheHint:a,relationshipId:r,returnGeometry:!1,objectIds:[s],where:Oae(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:n==null?void 0:n.signal});this._set("featureCount",h[s]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:r}=this;return i?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:r,_queryPageAbortController:s}=this;!r||i<2||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var O;const{orderByFieldsFixedCasing:i,showAllEnabled:r,featuresPerPage:s,displayCount:n,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:d}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!h)return[];const g=r?((l-1)*s+c)%c:0,y=r?s:n,v=h.objectIdField,x=[...i==null?void 0:i.map(U=>U.field),v].filter(b),S=i==null?void 0:i.map(U=>`${U.field} ${U.order}`),E=h.createQuery(),C=new zA({orderByFields:S,start:g,num:y,outFields:x,cacheHint:d,relationshipId:a,returnGeometry:!1,objectIds:[m],where:Oae(E.where,void 0)}),R=((O=(await o.queryRelatedFeatures(C,{signal:e==null?void 0:e.signal}))[m])==null?void 0:O.features)||[];return R.forEach(U=>{U.sourceLayer=h,U.layer=h}),R}};u([p()],Ls.prototype,"_queryAbortController",void 0),u([p()],Ls.prototype,"_queryPageAbortController",void 0),u([p()],Ls.prototype,"_queryFeatureCountAbortController",void 0),u([p({value:1})],Ls.prototype,"featurePage",null),u([p()],Ls.prototype,"featuresPerPage",void 0),u([p({readOnly:!0})],Ls.prototype,"orderByFieldsFixedCasing",null),u([p({readOnly:!0})],Ls.prototype,"supportsCacheHint",null),u([p({readOnly:!0})],Ls.prototype,"canQuery",null),u([p()],Ls.prototype,"description",void 0),u([p({readOnly:!0})],Ls.prototype,"itemDescriptionFieldName",null),u([p({value:3})],Ls.prototype,"displayCount",null),u([p({type:Ho})],Ls.prototype,"graphic",void 0),u([p()],Ls.prototype,"layer",void 0),u([p()],Ls.prototype,"map",void 0),u([p({readOnly:!0})],Ls.prototype,"objectId",null),u([p({readOnly:!0})],Ls.prototype,"objectIdField",null),u([p()],Ls.prototype,"orderByFields",void 0),u([p({readOnly:!0})],Ls.prototype,"relatedFeatures",null),u([p({readOnly:!0})],Ls.prototype,"relatedLayer",null),u([p({readOnly:!0})],Ls.prototype,"relationship",null),u([p()],Ls.prototype,"featureCount",void 0),u([p({readOnly:!0})],Ls.prototype,"relatedFeatureViewModels",null),u([p()],Ls.prototype,"relationshipId",void 0),u([p()],Ls.prototype,"showAllEnabled",void 0),u([p()],Ls.prototype,"state",null),u([p()],Ls.prototype,"title",void 0),Ls=u([N("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Ls);const Qie=Ls,CP="esri-feature",Z7=`${CP}-relationship`,Qy={base:Z7,esriWidget:"esri-widget",listContainer:`${Z7}__list`,listContainerQuerying:`${Z7}__list--querying`,featureObserver:`${CP}__feature-observer`,stickySpinnerContainer:`${CP}__sticky-loading-container`,loadingSpinnerContainer:`${CP}__loading-container`,spinner:`${CP}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},jhe={title:!0,description:!0};let Vc=class extends hl{constructor(e,i){super(e,i),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Qie,this.messages=null,this.messagesCommon=null,this.visibleElements={...jhe},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:s,relatedFeatures:n,featuresPerPage:o,featurePage:a}=this.viewModel;r==="ready"&&s&&n.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new vV,this.addHandles([ae(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),ii),ae(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Gs(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([se(()=>import("./calcite-list-dafaf454.js"),["assets/calcite-list-dafaf454.js","assets/interactive-573cbe88.js","assets/observers-4f67f1fb.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/debounce-31e0cfcc.js","assets/t9n-29ad496f.js","assets/icon-ad2e5a3c.js","assets/loader-14f879d8.js","assets/guid-9426053f.js","assets/scrim-19df7b79.js"]),se(()=>import("./calcite-list-item-34a171b4.js"),["assets/calcite-list-item-34a171b4.js","assets/interactive-573cbe88.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/icon-ad2e5a3c.js","assets/observers-4f67f1fb.js"]),se(()=>import("./calcite-icon-ea823bcc.js"),["assets/calcite-icon-ea823bcc.js","assets/icon-ad2e5a3c.js","assets/observers-4f67f1fb.js"]),se(()=>import("./calcite-notice-bbb0e928.js"),["assets/calcite-notice-bbb0e928.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-29ad496f.js","assets/icon-ad2e5a3c.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=He(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:i,displayCount:r}=this.viewModel;return!e&&!!i&&(i>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:i}=this.viewModel;return Ug(i===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:i})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...jhe,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?ce("div",{key:"sticky-loader",class:Qy.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return ce("span",{class:this.classes(Qy.iconLoading,Qy.spinner)})}renderLoading(){return ce("div",{key:"loading-container",class:Qy.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return ce("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=ty(this.container)?"chevron-left":"chevron-right";return ce("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var n,o;const{itemDescriptionFieldName:i}=this.viewModel,r=e.title;e.description=i&&((n=e.formattedAttributes)==null?void 0:n.global[i]);const s=e.state==="loading";return ce("calcite-list-item",{key:e.uid,label:s?`${(o=this.messagesCommon)==null?void 0:o.loading}…`:r,description:s?"…":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?ce("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return ce("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},ce("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return ce("div",{key:"feature-observer",class:Qy.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return ce("calcite-list",null,e.toArray().map(i=>this.renderRelatedFeature(i)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:i}=this.viewModel;return ce("div",{key:"list-container",class:this.classes(Qy.listContainer,{[Qy.listContainerQuerying]:i==="querying"})},e?this.renderList():i==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return ce("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},ce("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var i;const{state:e}=this.viewModel;return ce("div",{class:this.classes(Qy.base,Qy.esriWidget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,i="related-feature-viewmodels";this.removeHandles(i),e==null||e.forEach(r=>{this.addHandles(ae(()=>[r.title,r.state],()=>this.scheduleRender(),ii),i)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:i}=this,r=i.description&&this.description,s=i.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:r,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:i}=this.viewModel;await R2(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([p()],Vc.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([p({readOnly:!0})],Vc.prototype,"displayShowAllButton",null),u([p({readOnly:!0})],Vc.prototype,"displayListItems",null),u([p()],Vc.prototype,"description",null),u([p({readOnly:!0})],Vc.prototype,"featureCountDescription",null),u([p()],Vc.prototype,"headingLevel",void 0),u([p()],Vc.prototype,"title",null),u([p({type:Qie})],Vc.prototype,"viewModel",void 0),u([p(),za("esri/widgets/Feature/t9n/Feature")],Vc.prototype,"messages",void 0),u([p(),za("esri/t9n/common")],Vc.prototype,"messagesCommon",void 0),u([p()],Vc.prototype,"visibleElements",void 0),u([pi("visibleElements")],Vc.prototype,"castVisibleElements",null),Vc=u([N("esri.widgets.Feature.FeatureRelationship")],Vc);const Hhe=Vc;let Fht=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var MP;const Uht=1,qhe="content-view-models",Whe="relationship-view-models",Yhe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let gn=MP=class extends bS(Ee){constructor(t){super(t),this._handles=new ir,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=qM(this._graphicChanged,Uht,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Yhe},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this._handles.add(ae(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),ii))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return b(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return git(Uce(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return SSe(this.graphic)}castAbilities(t){return{...Yhe,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof s2&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof s2&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof s2&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!t||!i)return;const s=(o=t==null?void 0:t.attributes)==null?void 0:o[r];if(s==null)return;const n=[s];if(!t.geometry){const l=(a=await RSe({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){kn(i)||(this._error=i,le.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(b):typeof t=="string"?this._compileText(new LA({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(Whe),(e=this._handles)==null||e.remove(qhe),this.contentViewModels.forEach(i=>i&&!i.destroyed&&i.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const i=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),r=e==null?void 0:e.getObjectId();return b(i)&&b(r)&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:r,spatialReference:s}=this;e==null||e.filter(Boolean).forEach(n=>{t.find(o=>this._matchesFeature(o,n))||t.add(new MP({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,graphic:n}))}),t.forEach(n=>{(e==null?void 0:e.find(a=>this._matchesFeature(n,a)))||t.remove(n)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=t,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createMediaVMParams(r,e))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,h=new Qie({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=h,this._handles.add(Gs(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),Whe),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new Kie({expressionInfo:i,graphic:r,interceptor:MP.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[e]=a,this._handles.add(ae(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),ii),qhe),t}_compileAttachments(t,e){const{graphic:i}=this,{description:r,title:s}=t;return this.contentViewModels[e]=new nie({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:r,destroyer:s}=t;return this.contentViewModels[e]=new VU({graphic:i,creator:r,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:i2({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t}),description:i2({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e})}}_createFieldsVMParams(t,e){var c;const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},n=(c=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>tie(h)||f_(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=t;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const i=t.clone(),r=new bV(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(r==null?void 0:r.attributes)??{},{description:d,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:h,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:d})}}_compileMedia(t,e){const i=t.clone(),r=new s2(this._createMediaVMParams(t,e));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=i2({attributes:o,fieldInfoMap:i,globalAttributes:a,expressionAttributes:s,layer:r,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new VU(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:r}=t,s=e==null?void 0:e.editFieldsInfo;return r&&s?mit(s,i==null?void 0:i.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=(r==null?void 0:r.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return i2({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:s,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.title;return kU(i,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.content;return kU(i,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!r)return;await _it({graphic:r,popupTemplate:s,layer:i,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await hu({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await hu({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Lht({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:r,map:n,interceptor:MP.interceptor,view:o})});e===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[e]=l7({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[e]=l7({fieldInfos:t.fieldInfos,graphic:r,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:l7({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(t)&&t.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,Uce(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=b(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!n||!t)return;const o=e.filter(c=>c&&f_(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,n));const a=await Tnt({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),d=(f=a[c])==null?void 0:f.value;h&&d&&(h.layerInfo=d.data)});const l=await Snt({graphic:t,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;_nt((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,r=h6(t.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||ynt(s,e);o&&(Ent({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(s,o))}};gn.interceptor=new Fht(wit,xit),u([p()],gn.prototype,"_error",void 0),u([p()],gn.prototype,"_featureAbortController",void 0),u([p({readOnly:!0})],gn.prototype,"_effectivePopupTemplate",null),u([p({readOnly:!0})],gn.prototype,"_fieldInfoMap",null),u([p({readOnly:!0})],gn.prototype,"_sourceLayer",null),u([p()],gn.prototype,"abilities",void 0),u([pi("abilities")],gn.prototype,"castAbilities",null),u([p({readOnly:!0})],gn.prototype,"content",void 0),u([p({readOnly:!0})],gn.prototype,"contentViewModels",void 0),u([p()],gn.prototype,"description",void 0),u([p({type:Boolean})],gn.prototype,"defaultPopupTemplateEnabled",void 0),u([p({readOnly:!0})],gn.prototype,"isTable",null),u([p({readOnly:!0})],gn.prototype,"state",null),u([p({readOnly:!0})],gn.prototype,"formattedAttributes",void 0),u([p({type:Ho,value:null})],gn.prototype,"graphic",null),u([p({readOnly:!0})],gn.prototype,"lastEditInfo",void 0),u([p({readOnly:!0})],gn.prototype,"relatedInfos",void 0),u([p()],gn.prototype,"spatialReference",null),u([p({readOnly:!0})],gn.prototype,"title",void 0),u([p()],gn.prototype,"map",null),u([p({readOnly:!0})],gn.prototype,"waitingForContent",null),u([p()],gn.prototype,"view",void 0),gn=MP=u([N("esri.widgets.FeatureViewModel")],gn);const ere=gn,vl="esri-feature",Gn={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:vl,container:`${vl}__size-container`,title:`${vl}__title`,main:`${vl}__main-container`,btn:`${vl}__button`,icon:`${vl}__icon`,content:`${vl}__content`,contentNode:`${vl}__content-node`,contentElement:`${vl}__content-element`,text:`${vl}__text`,lastEditedInfo:`${vl}__last-edited-info`,fields:`${vl}__fields`,fieldHeader:`${vl}__field-header`,fieldData:`${vl}__field-data`,fieldDataDate:`${vl}__field-data--date`,loadingSpinnerContainer:`${vl}__loading-container`,spinner:`${vl}__loading-spinner`},oAe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>NSe(i)&&!i.destroyed?ce("div",{class:Gn.contentNode,key:i},i.render()):i instanceof HTMLElement?ce("div",{class:Gn.contentNode,key:i,bind:i,afterCreate:this._attachToNode}):kit(i)?ce("div",{class:Gn.contentNode,key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return e=u([N("esri.widgets.Feature.ContentMixin")],e),e};var MZ;const Xhe={title:!0,content:!0,lastEditedInfo:!0},Zhe="relationship-handles";let Pa=MZ=class extends oAe(hl){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Xhe},this.viewModel=new ere}initialize(){this.addHandles(ae(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),ii))}loadDependencies(){return se(()=>import("./calcite-notice-bbb0e928.js"),["assets/calcite-notice-bbb0e928.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-29ad496f.js","assets/icon-ad2e5a3c.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Xhe,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=ce("div",{class:Gn.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return ce("div",{class:this.classes(Gn.base,Gn.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return ce("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},i.title?ce("div",{key:"error-title",slot:"title"},t.errorMessage):null,ce("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return ce("div",{key:"loading-container",class:Gn.loadingSpinnerContainer},ce("span",{class:this.classes(Gn.iconLoading,Gn.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?ce("div",{class:Gn.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?ce(oie,{level:this.headingLevel,class:Gn.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?ce("div",{class:Gn.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:ce("div",{class:Gn.contentNode,key:`${e}-content`},i.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:r}=e.viewModel;return i==="loading"||r.length>0?ce("div",{key:this._buildKey("attachments-element",t),class:this.classes(Gn.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?ce("div",{key:this._buildKey("relationship-element",t),class:Gn.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ce("div",{key:this._buildKey("expression-element",t),class:Gn.contentElement},e.render())}renderCustom(t,e){const{creator:i}=t,r=this._contentWidgets[e];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("custom-element",e),class:Gn.contentElement},r.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ce("div",{key:this._buildKey("fields-element",t),class:Gn.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ce("div",{key:this._buildKey("media-element",t),class:Gn.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,o=Ug(n,{date:r,user:s});return ce("div",{key:"edit-info-element",class:this.classes(Gn.lastEditedInfo,Gn.contentElement)},o)}renderText(t,e){const i=t.text,r=this._contentWidgets[e];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("text-element",e),class:this.classes(Gn.contentElement,Gn.text)},r.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Zhe),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([Gs(()=>t,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new MZ({flowItems:e,viewModel:r,visibleElements:i})))}),Gs(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:r}=t;r.showAllEnabled=!0;const s=new Hhe({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),e.push(s)})],Zhe)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new Pit({displayType:s.displayType,headingLevel:e.title?t+1:t,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new FSe({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new OEe({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new n6({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new n6({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new Nht({viewModel:r[n]})),s.type==="relationship"){const o=new Hhe({viewModel:r[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new n6({viewModel:s}))}this.scheduleRender()}};u([p()],Pa.prototype,"graphic",null),u([p()],Pa.prototype,"defaultPopupTemplateEnabled",null),u([p()],Pa.prototype,"flowItems",void 0),u([p()],Pa.prototype,"headingLevel",void 0),u([p({readOnly:!0})],Pa.prototype,"isTable",null),u([p()],Pa.prototype,"label",null),u([p(),za("esri/widgets/Feature/t9n/Feature")],Pa.prototype,"messages",void 0),u([p(),za("esri/t9n/common")],Pa.prototype,"messagesCommon",void 0),u([p(),za("esri/widgets/support/t9n/uriUtils")],Pa.prototype,"messagesURIUtils",void 0),u([p()],Pa.prototype,"spatialReference",null),u([p({readOnly:!0})],Pa.prototype,"title",null),u([p()],Pa.prototype,"visibleElements",void 0),u([pi("visibleElements")],Pa.prototype,"castVisibleElements",null),u([p()],Pa.prototype,"map",null),u([p()],Pa.prototype,"view",null),u([p({type:ere})],Pa.prototype,"viewModel",void 0),Pa=MZ=u([N("esri.widgets.Feature")],Pa);const kht=Pa;var aAe;const P6=Symbol("anchorHandles");let Kx=class extends ws.EventedAccessor{constructor(e){super(e),this[aAe]=new ir,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[P6].add([wa(()=>fa(this.screenLocationEnabled?this.view:null,i=>[i.size,i.type==="3d"?i.camera:i.viewpoint]),()=>this.notifyChange("screenLocation")),ae(()=>this.screenLocation,(i,r)=>{b(i)&&b(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[P6]=He(this[P6])}get screenLocation(){var s;const{location:e,view:i,screenLocationEnabled:r}=this;return r&&b(e)&&b(i)&&i.ready?(s=i.toScreen)==null?void 0:s.call(i,e):null}};aAe=P6,u([p()],Kx.prototype,"location",void 0),u([p()],Kx.prototype,"screenLocation",null),u([p()],Kx.prototype,"screenLocationEnabled",void 0),u([p()],Kx.prototype,"view",void 0),Kx=u([N("esri.widgets.support.AnchorElementViewModel")],Kx);const lAe=Kx,Vht="esri.widgets.CompassViewModel";let I6=class extends lAe{constructor(e){super(e),this.visible=!1}};u([p()],I6.prototype,"visible",void 0),I6=u([N(Vht)],I6);const cAe=I6,J7="esri-spinner",K7={base:J7,spinnerStart:`${J7}--start`,spinnerFinish:`${J7}--finish`};let Qx=class extends hl{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new cAe}initialize(){this.addHandles(ae(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:r}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const s=()=>this.hide();r&&r.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,r=!!i,s=e&&r,n=!e&&r,o={[K7.spinnerStart]:s,[K7.spinnerFinish]:n},a=this._getPositionStyles();return ce("div",{class:this.classes(K7.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=R2(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(A(i)||A(e))return{};const{padding:r}=i;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([p()],Qx.prototype,"location",null),u([p()],Qx.prototype,"view",null),u([p({type:cAe})],Qx.prototype,"viewModel",void 0),u([p()],Qx.prototype,"visible",null),Qx=u([N("esri.widgets.Spinner")],Qx);const zht=Qx,VV={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},n2=new w3({id:"zoom-to-feature",title:"{messages.zoom}",className:VV.iconZoom}),Jhe=new w3({id:"remove-selected-feature",title:"{messages.remove}",className:VV.iconTrash}),yM=new w3({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:VV.iconZoom}),_M=new w3({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:VV.iconBrowseClusteredFeatures}),Bht="esri.widgets.Popup.PopupViewModel",KU=le.getLogger(Bht),Ght=t=>{const{event:e,view:i}=t,{action:r}=e,s=i&&i.popup;if(!r)return Promise.reject(new J("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new J("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new J("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new J("trigger-action:invalid-action","Action is disabled"));if(o===n2.id)return Hht(s.viewModel).catch(gq);if(o===yM.id)return qht(s.viewModel);if(o===_M.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Jhe.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new J(`trigger-action:${Jhe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function uAe(t){const{selectedFeature:e,location:i,view:r}=t;return r?r.type==="3d"?e??i??null:t.get("selectedFeature.geometry")||i:null}function LT(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function jht(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let r;try{r=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function Hht(t){var h;const{location:e,selectedFeature:i,view:r,zoomFactor:s}=t,n=uAe(t);if(!r||!n){const d=new J("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw KU.error(d),d}const o=r.scale/s,a=(h=t.selectedFeature)==null?void 0:h.geometry,l=a??e,c=b(l)&&l.type==="point"&&await jht(i,r);n2.active=!0,n2.disabled=!0;try{await t.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new J("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});KU.error(f)}finally{n2.active=!1,n2.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function qht(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const o=new J("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw KU.error(o),o}if(!e||!LT(e)){const o=new J("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw KU.error(o),o}const[r,s]=await tre(i,e);yM.active=!0,yM.disabled=!0;const{extent:n}=await r.queryExtent(s);await t.zoomTo({target:n}),yM.active=!1,yM.disabled=!1}async function Wht(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[r,s]=await tre(e,i),{extent:n}=await r.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(t.selectedClusterBoundaryFeature)}async function Yht(t){var o;const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[r,s]=await tre(i,e);_M.active=!0,_M.disabled=!0;const{features:n}=await r.queryFeatures(s);_M.active=!1,_M.disabled=!1,(o=i.popup)==null||o.open({features:[e].concat(n),featureMenuOpen:!0})}async function tre(t,e){const i=await t.whenLayerView(e.sourceLayer),r=i.createQuery(),s=e.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]}function Xht(t){const e=t.features.filter(i=>LT(i));e.length&&(t.features=e)}function hAe(t){var e;if(A(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const Kt="esri-popup",UO=`${Kt}__header`,Dw=`${Kt}--is-docked`,Ue={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Kt,widget:"esri-widget",main:`${Kt}__main-container`,loadingContainer:`${Kt}__loading-container`,isCollapsible:`${Kt}--is-collapsible`,isCollapsed:`${Kt}--is-collapsed`,shadow:`${Kt}--shadow`,isDocked:Dw,isDockedTopLeft:`${Dw}-top-left`,isDockedTopCenter:`${Dw}-top-center`,isDockedTopRight:`${Dw}-top-right`,isDockedBottomLeft:`${Dw}-bottom-left`,isDockedBottomCenter:`${Dw}-bottom-center`,isDockedBottomRight:`${Dw}-bottom-right`,alignTopCenter:`${Kt}--aligned-top-center`,alignBottomCenter:`${Kt}--aligned-bottom-center`,alignTopLeft:`${Kt}--aligned-top-left`,alignBottomLeft:`${Kt}--aligned-bottom-left`,alignTopRight:`${Kt}--aligned-top-right`,alignBottomRight:`${Kt}--aligned-bottom-right`,isFeatureMenuOpen:`${Kt}--feature-menu-open`,isActionsMenuOpen:`${Kt}--actions-menu-open`,hasFeatureUpdated:`${Kt}--feature-updated`,header:UO,headerButtons:`${UO}-buttons`,headerContainer:`${UO}-container`,headerContainerButton:`${UO}-container--button`,headerTitle:`${UO}-title`,content:`${Kt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Kt}__footer`,footerHasPagination:`${Kt}__footer--has-pagination`,footerHasActions:`${Kt}__footer--has-actions`,footerHasActionsMenu:`${Kt}__footer--has-actions-menu`,button:`${Kt}__button`,buttonDisabled:`${Kt}__button--disabled`,buttonDock:`${Kt}__button--dock`,icon:`${Kt}__icon`,iconDock:`${Kt}__icon--dock-icon`,inlineActionsContainer:`${Kt}__inline-actions-container`,actionsMenuButton:`${Kt}__actions-menu-button`,actions:`${Kt}__actions`,action:`${Kt}__action`,actionImage:`${Kt}__action-image`,actionText:`${Kt}__action-text`,actionToggle:`${Kt}__action-toggle`,actionToggleOn:`${Kt}__action-toggle--on`,actionExit:`${Kt}__action--exit`,actionSelectFeature:`${Kt}__action--select-feature`,pointer:`${Kt}__pointer`,pointerDirection:`${Kt}__pointer-direction`,navigation:`${Kt}__navigation`,paginationPrevious:`${Kt}__pagination-previous`,paginationNext:`${Kt}__pagination-next`,paginationPreviousIconLTR:`${Kt}__pagination-previous-icon`,paginationPreviousIconRTL:`${Kt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Kt}__pagination-next-icon`,paginationNextIconRTL:`${Kt}__pagination-next-icon--rtl`,featureMenu:`${Kt}__feature-menu`,featureMenuList:`${Kt}__feature-menu-list`,featureMenuItem:`${Kt}__feature-menu-item`,featureMenuViewport:`${Kt}__feature-menu-viewport`,featureMenuHeader:`${Kt}__feature-menu-header`,featureMenuNote:`${Kt}__feature-menu-note`,featureMenuSelected:`${Kt}__feature-menu-item--selected`,featureMenuButton:`${Kt}__feature-menu-button`,featureMenuTitle:`${Kt}__feature-menu-title`,featureMenuObserver:`${Kt}__feature-menu-observer`,featureMenuLoader:`${Kt}__feature-menu-loader`,collapseButton:`${Kt}__collapse-button`,collapseIcon:`${Kt}__collapse-icon`},dAe="OBJECTID";var Z2;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(Z2||(Z2={}));function pAe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Zht(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Jht(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function Kht(t,e){return new Float32Array(t,e,6)}function fAe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function Qht(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)fAe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Zht,create:pAe,createView:Kht,fromValues:Jht,transform:fAe,transformMany:Qht},Symbol.toStringTag,{value:"Module"}));function edt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function tdt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function idt(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function ire(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function rdt(t){return t[0]*t[3]-t[1]*t[2]}function mAe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],d=i[2],f=i[3],m=i[4],g=i[5];return t[0]=r*c+n*h,t[1]=s*c+o*h,t[2]=r*d+n*f,t[3]=s*d+o*f,t[4]=r*m+n*g+a,t[5]=s*m+o*g+l,t}function zV(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=s*h+o*c,t[2]=r*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function rre(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function G$(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*h+a,t[5]=s*c+o*h+l,t}function gAe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function yAe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function sre(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function sdt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ndt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function odt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function _Ae(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function adt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function ldt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function cdt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function udt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],g=ul();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const hdt=mAe,ddt=_Ae;Object.freeze(Object.defineProperty({__proto__:null,add:odt,copy:edt,determinant:rdt,equals:udt,exactEquals:cdt,frob:ndt,fromRotation:gAe,fromScaling:yAe,fromTranslation:sre,identity:tdt,invert:ire,mul:hdt,multiply:mAe,multiplyScalar:adt,multiplyScalarAndAdd:ldt,rotate:zV,scale:rre,set:idt,str:sdt,sub:ddt,subtract:_Ae,translate:G$},Symbol.toStringTag,{value:"Module"}));const Khe=me("android");me("chrome")||Khe&&Khe>=4;$Y();function Lqt(t){return t=t||globalThis.location.hostname,fdt.some(e=>(t==null?void 0:t.match(e))!=null)}function pdt(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(vAe)!=null||e.match(wAe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(bAe)!=null||e.match(xAe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const vAe=/^devext.arcgis.com$/,bAe=/^qaext.arcgis.com$/,wAe=/^[\w-]*\.mapsdevext.arcgis.com$/,xAe=/^[\w-]*\.mapsqa.arcgis.com$/,fdt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,vAe,bAe,/^jsapps.esri.com$/,wAe,xAe];Z2.size;Z2.maxSize;Z2.maxOutlineSize;Z2.lineWidth;Z2.tallSymbolWidth;function TAe(t){return t&&"opacity"in t?t.opacity*TAe(t.parent):1}async function mdt(t,e){if(!t)return;const i=t.sourceLayer,r=(b(e)&&e.useSourceLayer?i:t.layer)??i,s=TAe(r);if(b(t.symbol)&&(!b(e)||e.ignoreGraphicSymbol!==!0)){const v=t.symbol.type==="web-style"?await jrt(t.symbol,{...e,cache:b(e)?e.webStyleCache:null}):t.symbol.clone();return f7(v,null,s),v}const n=(b(e)?e.renderer:null)??(r&&"renderer"in r?r.renderer:null);let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:b(e)?e.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return f7(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(A(e)||A(e.arcade))){const v={...e};v.arcade=await Am(),e=v}const a=await se(()=>Promise.resolve().then(()=>Aie),void 0),l=[],c=[],h=[],d=[];for(const v of n.visualVariables)switch(v.type){case"color":l.push(v);break;case"opacity":c.push(v);break;case"rotation":d.push(v);break;case"size":v.target||h.push(v)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,t,e):null,g=!!c.length&&c[c.length-1];let y=g?a.getOpacity(g,t,e):null;if(s!=null&&(y=y!=null?y*s:s),f7(o,m,y),h.length){const v=a.getAllSizes(h,t,e);await Brt(o,v)}for(const v of d)Grt(o,a.getRotationAngle(v,t,e),v.axis);return o}let G_=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new K1e(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=ube(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)Hae(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)Hae(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const gdt=me("mac")?"Meta":"Ctrl",BV={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)BV[t]=String.fromCharCode(t);for(let t=1;t<25;t++)BV[111+t]=`F${t}`;for(let t=65;t<91;t++)BV[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function ydt(t){if(t.key!==void 0)return AT(t);const e=BV[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function _dt(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let vdt=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const Qhe=le.getLogger("esri.views.input.InputHandler");let Is=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Qhe.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new vdt(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new bdt(n,r,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new wdt(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Qhe.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},bdt=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},wdt=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},xdt=class extends Is{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},QU=class{constructor(e){this._observable=new vee,this._value=e}get(){return Vi(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},Tdt=class extends Is{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new QU(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},zf=class extends Ee{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=gdt,this._latestPointerType="mouse",this._propertiesPool=new G_({latestPointerLocation:Cdt},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,i,r=Es.INTERNAL){if(this._nameToGroup[e])return void le.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void le.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):le.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)_dt(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(A(s)||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new xdt((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Tdt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Es.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Es.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Sdt(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new wU,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r;const e=Ol(this._currentPropagation);for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((r=(i=e.currentHandler).eventCallback)==null||r.call(i,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const i=new wU;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};u([p({readOnly:!0})],zf.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],zf.prototype,"eventSource",void 0),u([p({constructOnly:!0})],zf.prototype,"recognizers",void 0),u([p()],zf.prototype,"_latestPointerType",void 0),u([p()],zf.prototype,"latestPointerType",null),u([p()],zf.prototype,"multiTouchActive",null),u([p({readOnly:!0})],zf.prototype,"latestPointerLocation",void 0),zf=u([N("esri.views.input.InputManager")],zf);let Sdt=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Y1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Y1.STOPPED}shouldStopPropagation(){return(this._propagationState&Y1.STOPPED)!=0}async(e){this._propagationState|=Y1.PAUSED;const i=(r,s)=>{this._propagationState&=~Y1.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&Y1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Y1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Y1||(Y1={}));const Es={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Edt=class{};const Cdt=Edt;function ede(t){return t&&typeof t.highlight=="function"}function Mdt(t){return t&&typeof t.maskOccludee=="function"}function qqt(t,e,i){return A(t)||t>i&&(e===0||t<e)}function Wqt(t,e){return b(t)&&t>0||b(e)&&e>0}function Yqt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const nre=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return DL(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([N("esri.widgets.support.GoTo")],e),e},kI=xt.ofType({key:"type",defaultKeyValue:"button",base:Yk,typeMap:{button:w3,toggle:Lxe}}),Adt=()=>[n2.clone()],Odt=()=>[yM.clone(),_M.clone()];let fr=class extends nre(lAe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new ir,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new kI,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ho({symbol:new Cy({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([ae(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ae(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ae(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ae(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.animation)==null?void 0:i.state},e=>this._animationStateChange(e)),ae(()=>this.location,e=>this._locationChange(e)),ae(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ae(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ae(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ae(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Ght({event:e,view:this.view})),wa(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Mi),ae(()=>{var e,i;return[this.features,(e=this.view)==null?void 0:e.map,(i=this.view)==null?void 0:i.spatialReference]},()=>this._updateFeatureVMs()),ae(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),wa(()=>!this.visible,()=>this.browseClusterEnabled=!1),ae(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new kI;e.removeAll();const{actions:i,defaultActions:r,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:o}=this,a=n?r.concat(i):i,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(s)||o.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(a):a;return h&&h.filter(Boolean).forEach(d=>e.add(d)),e}get defaultActions(){const e=this._get("defaultActions")||new kI;return e.removeAll(),e.addMany(LT(this.selectedFeature)?Odt():Adt()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const i=e||[];this._set("features",i);const{pendingPromisesCount:r,promiseCount:s,selectedFeatureIndex:n}=this,o=s&&i.length;o&&r&&n===-1?this.selectedFeatureIndex=0:o&&n!==-1||(this.selectedFeatureIndex=i.length?0:-1)}get location(){return this._get("location")||null}set location(e){var s,n,o;let i=e;const r=(n=(s=this.view)==null?void 0:s.spatialReference)==null?void 0:n.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&r&&(i=hy(e)),this._set("location",i)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(i=>{this._pendingPromises.add(i);const r=n=>{this._pendingPromises.has(i)&&this._updateFeatures(n),this._updatePendingPromises(i)},s=()=>this._updatePendingPromises(i);i.then(r,s)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:i}=this;return i===-1?null:e[i]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:i}=this;e=isNaN(e)||e<-1||!i?-1:(e+i)%i,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,i=uAe(this);return i&&e?this.callGoTo({target:{target:i,scale:e.scale}}):Promise.reject(new J("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:i,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,i){const{view:r}=this;if(!r||!e)throw new J("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:i&&i.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:i&&i.signal})}open(e){const i={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=i;delete i.fetchFeatures,r&&this._setFetchFeaturesPromises(i.location);const s=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const n of s)delete i[n];this.set(i)}triggerAction(e){const i=this.allActions.getItemAt(e);i&&!i.disabled&&this.emit("trigger-action",{action:i})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){Xht(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:i}=this;(e==null?void 0:e.type)==="2d"?LT(i)?(await Wht(this),await Yht(this)):le.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",i):le.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",i)}_animationStateChange(e){this.zoomToLocation||(n2.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var i;const e=(i=this.view)==null?void 0:i.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(LT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:i,updateLocationEnabled:r}=this;r&&e&&(!i||i.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:i,featurePage:r,featuresPerPage:s,featureViewModels:n}=this;if(r===null)return;const o=((r-1)*s+i)%i,a=o+s;n.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:i,updateLocationEnabled:r,view:s}=this;if(e&&s){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),LT(e)?void 0:(e.symbol=await mdt(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));!r&&i||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const n=(o=s.center)==null?void 0:o.clone();n&&(this.location=n)}):this.location=hAe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(i=>{const{clientOnlyGraphics:r,promisesPerLayerView:s}=i,n=Promise.resolve(r),o=s.map(a=>a.promise);this.promises=[n,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:i,featureViewModels:r}=this;if(LT(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!i||!i.length)return;const s=r.slice(0),n=[];i.forEach((o,a)=>{var c,h;if(!o)return;let l=null;if(s.some((d,f)=>(d&&d.graphic===o&&(l=d,s.splice(f,1)),!!l)),l)n[a]=l;else{const d=new ere({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(h=this.view)==null?void 0:h.map,view:this.view});n[a]=d}}),s.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:i}=this;return i&&e&&typeof i.toScreen=="function"?i.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:i,autoOpenEnabled:r}=this;if(i.remove(e),r&&this.view){const s=this.view.on("click",n=>{n.pointerType==="mouse"&&n.button!==0||this._fetchFeaturesAndOpen(n)},Es.WIDGET);i.add(s,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,i){this._cancelFetchingFeatures();const r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:s,event:i});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:i,mapPoint:r}=e,{view:s}=this;this._fetchFeaturesWithController(i,e).then(n=>{var h;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=n,c=[Promise.resolve(o),...a.map(d=>d.promise)];return(h=s==null?void 0:s.popup)==null||h.open({location:l||r,promises:c}),n})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,i){return await e.when(),e.whenLayerView(i)}_getHighlightLayer(e){const{layer:i,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:i}_getHighlightTarget(e,i){const r=i.type==="imagery"?void 0:"objectIdField"in i?i.objectIdField||dAe:null,s=e.attributes;return s&&r&&s[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:i,view:r,activeFeature:s,visible:n}=this;if(!(s&&r&&i&&n))return;const o=this._getHighlightLayer(s);if(!(o&&o instanceof V_))return;const a=this._getLayerView(r,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&ede(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(s,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:i,highlightEnabled:r,view:s,visible:n}=this;if(!(i&&s&&r&&n))return;const o=this._getHighlightLayer(i);if(!(o&&o instanceof V_))return;const a=this._getLayerView(s,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&ede(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(i,o));this._handles.add(c,e)}_updateFeatures(e){const{features:i}=this;if(!e||!e.length)return;if(!i.length)return void(this.features=e);const r=e.filter(s=>!i.includes(s));this.features=i.concat(r)}};u([p()],fr.prototype,"featurePage",void 0),u([p()],fr.prototype,"isLoadingFeature",null),u([p({type:kI})],fr.prototype,"actions",void 0),u([p({readOnly:!0})],fr.prototype,"active",null),u([p()],fr.prototype,"activeFeature",void 0),u([p({readOnly:!0})],fr.prototype,"allActions",null),u([p({type:Boolean})],fr.prototype,"defaultPopupTemplateEnabled",void 0),u([p()],fr.prototype,"autoCloseEnabled",void 0),u([p()],fr.prototype,"autoOpenEnabled",void 0),u([p()],fr.prototype,"browseClusterEnabled",void 0),u([p()],fr.prototype,"content",void 0),u([p({type:kI,readOnly:!0})],fr.prototype,"defaultActions",null),u([p({readOnly:!0})],fr.prototype,"featureCount",null),u([p()],fr.prototype,"features",null),u([p()],fr.prototype,"featuresPerPage",void 0),u([p()],fr.prototype,"featureViewModelAbilities",void 0),u([p({readOnly:!0})],fr.prototype,"featureViewModels",void 0),u([p()],fr.prototype,"highlightEnabled",void 0),u([p()],fr.prototype,"includeDefaultActions",void 0),u([p({type:st})],fr.prototype,"location",null),u([p({readOnly:!0})],fr.prototype,"pendingPromisesCount",null),u([p({readOnly:!0})],fr.prototype,"selectedClusterBoundaryFeature",void 0),u([p({readOnly:!0})],fr.prototype,"waitingForResult",null),u([p({readOnly:!0})],fr.prototype,"promiseCount",null),u([p()],fr.prototype,"promises",null),u([p({value:null,readOnly:!0})],fr.prototype,"selectedFeature",null),u([p({value:-1})],fr.prototype,"selectedFeatureIndex",null),u([p({readOnly:!0})],fr.prototype,"selectedFeatureViewModel",null),u([p({readOnly:!0})],fr.prototype,"state",null),u([p()],fr.prototype,"title",void 0),u([p()],fr.prototype,"updateLocationEnabled",void 0),u([p()],fr.prototype,"view",void 0),u([p()],fr.prototype,"visible",void 0),u([p()],fr.prototype,"zoomFactor",void 0),u([p()],fr.prototype,"zoomToLocation",void 0),u([p()],fr.prototype,"centerAtLocation",null),fr=u([N("esri.widgets.Popup.PopupViewModel")],fr);const SAe=fr,tde="selected-index",Rdt=0,ide="popup-spinner",rde={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},sde="esri-popup";function e0(t,e){return e===void 0?`${sde}__${t}`:`${sde}__${t}-${e}`}const nde={closeButton:!0,featureNavigation:!0};let Jt=class extends oAe(hl){constructor(e,i){super(e,i),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new ir,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=qM(()=>this._displaySpinner(),Rdt),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new xt,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new SAe,this.visibleElements={...nde},this._handleOpenRelatedFeature=r=>{this._openRelatedFeature(r)},this._addSelectedFeatureIndexHandle(),this.addHandles([ae(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),ae(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ae(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,s)=>{!!r!=!!s&&this.reposition()}),ae(()=>{var r,s,n,o,a,l;return[(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.padding,(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),ae(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),ae(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.size},(r,s)=>this._updateDockEnabledForViewSize(r,s)),ae(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,s)=>this._viewChange(r,s)),ae(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.ready},(r,s)=>this._viewReadyChange(r??!1,s??!1)),ae(()=>{var r,s;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ae(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),ae(()=>{var r,s,n,o;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.title,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),ae(()=>{var r,s,n,o;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.content,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),wa(()=>!this.collapsed,()=>{var r,s;((s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Gs(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),ae(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),ii),ae(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),Gs(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),ae(()=>{var r,s,n,o;return[(s=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:s.state,(o=(n=this._activeFlowItemWidget)==null?void 0:n.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([se(()=>import("./calcite-flow-0021ae6a.js"),["assets/calcite-flow-0021ae6a.js","assets/observers-4f67f1fb.js"]),se(()=>import("./calcite-flow-item-dd19a8a7.js"),["assets/calcite-flow-item-dd19a8a7.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-29ad496f.js","assets/observers-4f67f1fb.js","assets/guid-9426053f.js","assets/action-bdead85d.js","assets/icon-ad2e5a3c.js","assets/loader-14f879d8.js","assets/tooltip-92850d8d.js","assets/debounce-31e0cfcc.js","assets/scrim-19df7b79.js"]),se(()=>import("./calcite-action-d2c80f52.js"),["assets/calcite-action-d2c80f52.js","assets/action-bdead85d.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-29ad496f.js","assets/observers-4f67f1fb.js","assets/icon-ad2e5a3c.js","assets/loader-14f879d8.js"]),se(()=>import("./calcite-tooltip-3977f803.js"),["assets/calcite-tooltip-3977f803.js","assets/tooltip-92850d8d.js","assets/debounce-31e0cfcc.js","assets/guid-9426053f.js"]),se(()=>import("./calcite-icon-ea823bcc.js"),["assets/calcite-icon-ea823bcc.js","assets/icon-ad2e5a3c.js","assets/observers-4f67f1fb.js"])])}destroy(){var e,i;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(i=this._featureMenuIntersectionObserver)==null||i.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:i}=this;if(!e)return!!(i!=null&&i.content);const r=e.viewModel;if(r!=null&&r.waitingForContent||(r==null?void 0:r.state)==="error")return!0;const s=r==null?void 0:r.content;return Array.isArray(s)?!!s.length:!!s}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||rde}set dockOptions(e){var l,c;const i={...rde},r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,s={};r&&(s.width=r.xsmall,s.height=r.xsmall);const n={...i,...e},o={...i.breakpoint,...s},{breakpoint:a}=n;typeof a=="object"?n.breakpoint={...o,...a}:a&&(n.breakpoint=o),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:i,headingLevel:r,_flowItems:s}=this,{selectedFeatureViewModel:n}=this.viewModel,o={...i,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=o):this._feature=new kht({flowItems:s,headingLevel:r+1,viewModel:n,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...nde,...e}}blur(){const{active:e}=this.viewModel;e||le.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e||le.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var n,o;this._handles.remove(tde);const i=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,s={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:i};((o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(s.collapsed=!0),this.set(s),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var y,v,x,S;const{actionsMenuOpen:e,dockEnabled:i,featureMenuVisible:r,dividedActions:s,currentAlignment:n,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=s,c=a&&l.length>1&&e,h=a&&i,d=a&&!i,f=(v=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:v.title,m=(S=(x=this.selectedFeature)==null?void 0:x.layer)==null?void 0:S.id,g={[Ue.alignTopCenter]:n==="top-center",[Ue.alignBottomCenter]:n==="bottom-center",[Ue.alignTopLeft]:n==="top-left",[Ue.alignBottomLeft]:n==="bottom-left",[Ue.alignTopRight]:n==="top-right",[Ue.alignBottomRight]:n==="bottom-right",[Ue.isDocked]:h,[Ue.shadow]:d,[Ue.isDockedTopLeft]:o==="top-left",[Ue.isDockedTopCenter]:o==="top-center",[Ue.isDockedTopRight]:o==="top-right",[Ue.isDockedBottomLeft]:o==="bottom-left",[Ue.isDockedBottomCenter]:o==="bottom-center",[Ue.isDockedBottomRight]:o==="bottom-right",[Ue.isFeatureMenuOpen]:r,[Ue.isActionsMenuOpen]:c};return ce("div",{class:this.classes(Ue.base,g),role:"presentation","data-layer-title":f,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(Ue.icon,Ue.iconLoading,Ue.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ce("div",{key:e0("loading-container"),role:"presentation",class:Ue.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=ty(this.container),i={[Ue.iconRightTriangleArrow]:e,[Ue.paginationPreviousIconRTL]:e,[Ue.iconLeftTriangleArrow]:!e,[Ue.paginationPreviousIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(Ue.icon,i)})}renderPreviousButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ue.button,Ue.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=ty(this.container),i={[Ue.iconLeftTriangleArrow]:e,[Ue.paginationNextIconRTL]:e,[Ue.iconRightTriangleArrow]:!e,[Ue.paginationNextIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(Ue.icon,i)})}renderNextButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ue.button,Ue.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:i,messagesCommon:r}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ue.button,Ue.featureMenuButton),"aria-haspopup":"true","aria-controls":i,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,i=this._wouldDockTo(),r={[Ue.iconUndock]:e,[Ue.iconDock]:!e,[Ue.iconDockToRight]:!e&&(i==="top-right"||i==="bottom-right"),[Ue.iconDockToLeft]:!e&&(i==="top-left"||i==="bottom-left"),[Ue.iconDockToTop]:!e&&i==="top-center",[Ue.iconDockToBottom]:!e&&i==="bottom-center"};return ce("span",{"aria-hidden":"true",class:this.classes(r,Ue.icon)})}renderDockButton(){var n,o,a;const{dockEnabled:e,messages:i}=this,r=(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint,s=e?i.undock:i.dock;return r!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?ce("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ue.button,Ue.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:i,collapsible:r,contentCollapsed:s,messagesCommon:n}=this,o={[Ue.headerContainerButton]:r},a=ce(oie,{level:this.headingLevel,class:Ue.headerTitle,innerHTML:e??""}),l=r?ce("button",{key:`${e}--collapsible`,id:i,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ue.headerContainer,o),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,ce("calcite-icon",{class:Ue.collapseIcon,key:"collapse-icon",icon:s?"chevron-down":"chevron-up",scale:"m"})):ce("div",{key:e??"title",id:i,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ue.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(Ue.icon,Ue.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:i}=this;return e.closeButton?ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ue.button,"aria-label":i.close,title:i.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ce("header",{class:Ue.header},this.renderTitle(),ce("div",{class:Ue.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:i,contentCollapsed:r,_flowItems:s}=this,{content:n}=this.viewModel,o=s.toArray(),a={[Ue.contentHasFlows]:!!o.length};return i&&!r?ce("div",{key:n??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Ue.content,a)},ce("calcite-flow",{bind:this},ce("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:AU,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:i}=this,r=zU(),s="graphic"in e&&!e.isTable;return ce("calcite-flow-item",{bind:this,class:this.classes({[Ue.calciteThemeDark]:!r,[Ue.calciteThemeLight]:r}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},ce("calcite-action",{class:Ue.actionExit,icon:"move-up",label:i==null?void 0:i.exitRelatedRecords,text:i==null?void 0:i.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),s?ce("calcite-action",{class:Ue.actionSelectFeature,icon:"zoom-to-object",label:i==null?void 0:i.selectFeature,text:i==null?void 0:i.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,ce("div",{class:this.classes(Ue.contentFlowItem,{[Ue.calciteThemeDark]:r,[Ue.calciteThemeLight]:!r})},e.render()))}renderFlowItemTooltips(e){const{messages:i,_exitRelatedRecordsActions:r,_featureSelectionActions:s}=this,n=zU(),o=s.get(e);return[ce("calcite-tooltip",{class:this.classes({[Ue.calciteThemeDark]:!n,[Ue.calciteThemeLight]:n}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},i==null?void 0:i.exitRelatedRecords),o?ce("calcite-tooltip",{class:this.classes({[Ue.calciteThemeDark]:!n,[Ue.calciteThemeLight]:n}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},i==null?void 0:i.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:s,messagesCommon:n}=this,o=r?n.close:n.open,{menuActions:a}=s;return a.length?ce("div",{key:e0("actions-menu-button"),class:this.classes(Ue.button,Ue.actionsMenuButton),role:"button",id:i,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},ce("span",{"aria-hidden":"true",class:Ue.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:s}=this,{menuActions:n}=s;return n.length&&r?ce("ul",{id:e,role:"menu","aria-labelledby":i,key:e0("actions"),class:Ue.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(i=>this.renderAction({action:i,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:i}=this.dividedActions,r=!!e.length,s=!!i.length;return r||s?ce("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":s.toString(),class:Ue.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ce("section",{key:e0("navigation"),class:this.classes(Ue.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:i}=this,{inlineActions:r,menuActions:s}=i,n=!!r.length,o=!!s.length,a={[Ue.footerHasPagination]:e,[Ue.footerHasActions]:n,[Ue.footerHasActionsMenu]:o};return e||n?ce("div",{key:e0("feature-buttons"),class:this.classes(Ue.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:i,isLoadingFeature:r}=this.viewModel,s=Ug(e.selectedFeatures,{total:i.length});return ce("section",{key:e0("menu"),class:Ue.featureMenu},ce("strong",{class:Ue.featureMenuHeader},s),ce("nav",{bind:this,class:Ue.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:AU},this.renderFeatureMenu(),ce("div",{class:Ue.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?ce("div",{class:Ue.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ce("div",{key:e0("pointer"),class:Ue.pointer,role:"presentation"},ce("div",{class:this.classes(Ue.pointerDirection,Ue.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:i,currentDockPosition:r,titleId:s,contentId:n,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,d=i==="bottom-left"||i==="bottom-center"||i==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",f=i==="top-left"||i==="top-center"||i==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",m={[Ue.shadow]:e,[Ue.isCollapsible]:o,[Ue.isCollapsed]:l};return ce("div",{class:this.classes(Ue.main,Ue.widget,m),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?s:"","aria-describedby":a&&!l?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),f?this.renderFooter():null,f?this.renderFeatureMenuContainer():null)}renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?ce("div",{class:Gn.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return ce("span",{key:"text",class:Ue.actionText},e)}renderActionIcon(e){const i=this._getActionClass(e),r=this._getActionImage(e),s={[Ue.iconLoading]:e.active,[Ue.rotating]:e.active,[Ue.icon]:!!i,[Ue.actionImage]:!e.active&&!!r};return i&&(s[i]=!e.active),ce("span",{key:"icon","aria-hidden":"true",class:this.classes(Ue.icon,s),styles:this._getIconStyles(r)})}renderAction(e){const{action:i,type:r}=e,s=this._getActionTitle(i),n={[Ue.action]:i.type!=="toggle",[Ue.actionToggle]:i.type==="toggle",[Ue.actionToggleOn]:i.type==="toggle"&&i.value,[Ue.buttonDisabled]:i.disabled},o=[this.renderActionIcon(i),this.renderActionText(s)],a=r==="menu-item"?ce("li",{key:i.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(Ue.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):ce("div",{key:i.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(Ue.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return i.visible?a:null}renderFeatureMenuItem(e,i){const{messages:r,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[Ue.featureMenuSelected]:a},c=a?ce("span",{key:e0(`feature-menu-selected-feature-${n}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Ue.iconCheckMark}):null,h=ce("span",{innerHTML:e.title||s.untitled});return ce("li",{role:"menuitem",tabIndex:-1,key:e0(`feature-menu-feature-${n}`),class:this.classes(l,Ue.featureMenuItem),bind:this,"data-feature-index":i,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},ce("span",{class:Ue.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:i}=this.viewModel;return i.length>1?ce("ol",{class:Ue.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},i.filter(r=>!!r.graphic).map((r,s)=>this.renderFeatureMenuItem(r,s))):null}_storeFeatureSelectionAction(e,i){this._featureSelectionActions.set(e,i),this.scheduleRender()}_storeExitRelatedRecordsAction(e,i){this._exitRelatedRecordsActions.set(e,i),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,r=i==null?void 0:i.geometry;if(A(r)||A(i))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const s=hAe(r);this.open({features:[i],location:b(s)?s:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:i,selectedFeature:r,messagesCommon:s}=this,{id:n}=e,o=r==null?void 0:r.attributes,a=e.title??"",l=n==="zoom-to-feature"?Ug(a,{messages:i}):n==="remove-selected-feature"?Ug(a,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?Ug(a,{messages:i}):e.title;return l&&o?Ug(l,o):l??""}_getActionClass(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{className:s,image:n}=e,o=n||s?s:Ue.iconDefaultAction;return o&&r?Ug(o,r):o??""}_getActionImage(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{image:s}=e;return s&&r?Ug(s,r):s??""}_createFeatureUpdatedAnimation(){return jQe("enter",Ue.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:i}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(i?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const i="actions";this._handles.remove(i),e&&e.forEach(r=>{this._handles.add(ae(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),i)})}_divideActions(){const{allActions:e}=this.viewModel,i=e.filter(o=>o.visible),r=this._getInlineActionCount(),s=r===null,n=r===0;return{inlineActions:s?i.slice(0):n?new xt:i.slice(0,r),menuActions:s?new xt:n?i.slice(0):i.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,s;const{selectedFeatureWidget:e,messagesCommon:i}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?i.errorMessage:((s=e.viewModel)==null?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){AT(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){AT(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:i}=this,r=e.currentTarget["data-feature-index"];i.activeFeature=i.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const i=AT(e),{_featureMenuNode:r}=this,s=e.currentTarget["data-feature-index"];if(!r)return;const n=r.querySelectorAll("li"),o=n.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(s+1+o)%o].focus()):(e.stopPropagation(),n[(s-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const i=AT(e),{_actionsMenuNode:r}=this,s=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,o=n.findIndex(c=>c.uid===s);if(!r)return;const a=r.querySelectorAll("li"),l=a.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const i=AT(e);i==="ArrowLeft"&&(e.stopPropagation(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const i=this.get("viewModel.view");this._createSpinner(i)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:r}=this.viewModel;r&&i?e.show({location:i}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await Wb(()=>{var i;return((i=this.viewModel)==null?void 0:i.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,r)=>this._selectedFeatureIndexUpdated(i,r));this._handles.add(e,tde)}_selectedFeatureIndexUpdated(e,i){const{featureCount:r}=this;r&&e!==i&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,i){return e.x>-1&&e.y>-1&&e.x<=i.width&&e.y<=i.height}_isOutsideView(e){const{popupHeight:i,popupWidth:r,screenLocation:s,side:n,view:o}=e;if(isNaN(r)||isNaN(i)||!o||!s)return!1;const a=o.padding;return n==="right"&&s.x+r/2>o.width-a.right||n==="left"&&s.x-r/2<a.left||n==="top"&&s.y-i<a.top||n==="bottom"&&s.y+i>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:i,_containerNode:r,_mainContainerNode:s,viewModel:n}=this,{screenLocation:o,view:a}=n;if(A(o)||!a||!r)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(C){return parseInt(C.replace(/[^-\d\.]/g,""),10)}const c=s?window.getComputedStyle(s,null):null,h=c?l(c.getPropertyValue("max-height")):0,d=c?l(c.getPropertyValue("height")):0,{height:f,width:m}=r.getBoundingClientRect(),g=m+i,y=Math.max(f,h,d)+i,v=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:o,side:"right",view:a}),x=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:o,side:"left",view:a}),S=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:o,side:"top",view:a}),E=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:o,side:"bottom",view:a});return x?S?"bottom-right":"top-right":v?S?"bottom-left":"top-left":S?E?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:i}=this;return i||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const i=["left","right"];return ty(this.container)&&i.reverse(),e.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const i=(a=this.viewModel)==null?void 0:a.view,r=ty(this.container)?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:o}=i;return o&&n<=o.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:i}=this.viewModel,{width:r}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(i,r);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(e){const{currentAlignment:i,_pointerOffsetInPx:r}=this;return i==="top-left"||i==="bottom-left"||i==="top-right"||i==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,i,r,s){const{currentAlignment:n,_pointerOffsetInPx:o}=this;if(!r)return;const{padding:a}=r,l=s/2,c=r.height-i,h=r.width-e;return n==="bottom-center"?{top:i+o-a.top,left:e-l-a.left}:n==="top-left"?{bottom:c+o-a.bottom,right:h+o-a.right}:n==="bottom-left"?{top:i+o-a.top,right:h+o-a.right}:n==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:n==="bottom-right"?{top:i+o-a.top,left:e+o-a.left}:n==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,i){const{dockEnabled:r,view:s}=this;if(!s)return;if(r)return{left:"",top:"",right:"",bottom:""};if(A(e)||!i)return;const n=this._calculateFullWidth(i),o=this._calculateAlignmentPosition(e.x,e.y,s,n);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,i){e&&i&&(this.close(),this.clear())}_viewReadyChange(e,i){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else i&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:i}=this;i&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,i,r){const[s,n]=e,[o,a]=i,{width:l=0,height:c=0}=r??{};return s<=l&&o>l||s>l&&o<=l||n<=c&&a>c||n>c&&a<=c}_updateDockEnabledForViewSize(e,i){if(!e||!i)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=r.left+r.right,n=r.top+r.bottom,o=[],a=[];o[0]=e[0]-s,o[1]=e[1]-n,a[0]=i[0]-s,a[1]=i[1]-n;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:i}=this;if(!i)return;const r=i.active&&!e;i.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var l,c;const i=e.breakpoint,r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!r)return!1;const{width:s,height:n}=r;if(isNaN(s)||isNaN(n)||!i)return!1;const o=i.hasOwnProperty("width")&&s<=(i.width??0),a=i.hasOwnProperty("height")&&n<=(i.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,i){return this.featureNavigationVisible?Ug(this.messages.pageText,{index:i+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:i}=this;e&&(i&&i.ui&&i.ui.remove(e,ide),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new zht({view:e}),e.ui.add(this._spinner,{key:ide,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const i=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,s=r.findIndex(o=>o.uid===i),n=r.getItemAt(s);n&&n.type==="toggle"&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(s)}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([p({readOnly:!0})],Jt.prototype,"actionsMenuId",null),u([p({readOnly:!0})],Jt.prototype,"actionsMenuButtonId",null),u([p({readOnly:!0})],Jt.prototype,"featureMenuId",null),u([p({readOnly:!0})],Jt.prototype,"titleId",null),u([p({readOnly:!0})],Jt.prototype,"contentId",null),u([p({readOnly:!0})],Jt.prototype,"hasContent",null),u([p({readOnly:!0})],Jt.prototype,"featureNavigationVisible",null),u([p({readOnly:!0})],Jt.prototype,"collapsible",null),u([p({readOnly:!0})],Jt.prototype,"featureMenuVisible",null),u([p({readOnly:!0})],Jt.prototype,"contentCollapsed",null),u([p({readOnly:!0})],Jt.prototype,"dividedActions",null),u([p({readOnly:!0,dependsOn:["_flowItems.length"]})],Jt.prototype,"_activeFlowItemWidget",null),u([p()],Jt.prototype,"actions",null),u([p()],Jt.prototype,"actionsMenuOpen",null),u([p()],Jt.prototype,"alignment",void 0),u([p()],Jt.prototype,"autoCloseEnabled",null),u([p()],Jt.prototype,"autoOpenEnabled",null),u([p()],Jt.prototype,"defaultPopupTemplateEnabled",null),u([p()],Jt.prototype,"content",null),u([p()],Jt.prototype,"collapsed",void 0),u([p()],Jt.prototype,"collapseEnabled",void 0),u([p({readOnly:!0})],Jt.prototype,"currentAlignment",null),u([p({readOnly:!0})],Jt.prototype,"currentDockPosition",null),u([p()],Jt.prototype,"dockOptions",null),u([p()],Jt.prototype,"dockEnabled",void 0),u([p({readOnly:!0})],Jt.prototype,"featureCount",null),u([p()],Jt.prototype,"featureMenuOpen",void 0),u([p()],Jt.prototype,"features",null),u([p()],Jt.prototype,"goToOverride",null),u([p()],Jt.prototype,"headingLevel",void 0),u([p()],Jt.prototype,"highlightEnabled",null),u([p()],Jt.prototype,"location",null),u([p()],Jt.prototype,"label",null),u([p()],Jt.prototype,"maxInlineActions",void 0),u([p(),za("esri/widgets/Popup/t9n/Popup")],Jt.prototype,"messages",void 0),u([p(),za("esri/t9n/common")],Jt.prototype,"messagesCommon",void 0),u([p()],Jt.prototype,"promises",null),u([p({readOnly:!0})],Jt.prototype,"selectedFeature",null),u([p()],Jt.prototype,"selectedFeatureIndex",null),u([p({readOnly:!0})],Jt.prototype,"selectedFeatureWidget",null),u([p()],Jt.prototype,"spinnerEnabled",void 0),u([p()],Jt.prototype,"title",null),u([p()],Jt.prototype,"updateLocationEnabled",null),u([p()],Jt.prototype,"view",null),u([p({type:SAe}),LSe(["triggerAction","trigger-action"])],Jt.prototype,"viewModel",void 0),u([p()],Jt.prototype,"visible",null),u([p()],Jt.prototype,"visibleElements",void 0),u([pi("visibleElements")],Jt.prototype,"castVisibleElements",null),u([Yh()],Jt.prototype,"_close",null),u([Yh()],Jt.prototype,"_toggleDockEnabled",null),u([Yh()],Jt.prototype,"_toggleFeatureMenu",null),u([Yh()],Jt.prototype,"_toggleActionsMenu",null),u([Yh()],Jt.prototype,"_triggerAction",null),u([Yh()],Jt.prototype,"_selectFeature",null),u([Yh()],Jt.prototype,"_next",null),u([Yh()],Jt.prototype,"_previous",null),Jt=u([N("esri.widgets.Popup")],Jt);const ode=Jt,Q7=[0,0];function Pdt(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return Q7[0]=i.left+((e==null?void 0:e.pageXOffset)??0),Q7[1]=i.top+((e==null?void 0:e.pageYOffset)??0),Q7}function ade(t){t&&(c2e(t),t.parentNode&&t.parentNode.removeChild(t))}function Idt(t){const e=document.createElement("div");return t.appendChild(e),e}const kO=16,iF=750,$dt=512,Ldt=2,EAe=t=>{let e=class extends t{constructor(...i){var r;super(...i),this._freqInfo={freq:kO,time:iF},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,i.length!==0&&((r=i[0])==null?void 0:r.popup)!==void 0||(this.popup=new ode({view:this})),this.handles.add([ae(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),ae(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(ae(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=He(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=pV(i);if(s||typeof i!="string"||le.getLogger(this.declaredClass).error("#container",`element with id '${i}' not found`),r===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ade(this.root),this._set("root",null)),this.userContent&&(oce(this.userContent,r),ade(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",oce(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new gce;a.appendChild(c.surface),this._set("overlay",c),ae(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=F_({render:()=>{var d;return(d=this.overlay)==null?void 0:d.render()}}):this._overlayRenderTaskHandle=is(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(ae(()=>this.size,h=>{const[d,f]=h,m="esri-view-surface--inset-outline";d>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},ii),n),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([ae(()=>this.root,r=>{i.container=r?Idt(r):null},ii),ae(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},ii)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=kO,i.time=iF,this.handles.add([(()=>{const r=()=>{i.freq=kO,i.time=iF};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),F_({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=kO,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?kO:Math.min(iF,n.freq*Ldt),!s&&n.freq>=$dt&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&Pdt(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p({type:ode})],e.prototype,"popup",null),u([p({type:gce})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p()],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([N("esri.views.DOMContainer")],e),e},CAe=t=>{let e=class extends t{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:W8([l,...h]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:b(s)?s.event:void 0,signal:b(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!b(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(b(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const s=await this.popupHitTest(i),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),b(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return b(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return e=u([N("esri.views.PopupView")],e),e};let VI=class extends Dm(xt){constructor(e){super(e),this.handles.add([this.on("before-add",i=>{A(i.item)&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(xt.ofType(this.itemType.Type))(e):new xt(e)}};function e9(t,e){return{type:t,cast:Rbe,set(i){const r=I2(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([p()],VI.prototype,"owner",null),VI=u([N("esri.core.support.OwningCollection")],VI);let qA=class extends VI{constructor(e){super(e),this.handles.add(this.on("before-add",i=>{A(i.item)||i.item.parent===this.owner&&(le.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};qA=u([N("esri.support.AnalysesCollection")],qA);let _2=class extends VI{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([_ee({Type:Ho,ensureType:Vn(Ho)})],_2.prototype,"itemType",void 0),_2=u([N("esri.support.GraphicsCollection")],_2);let A1=class extends Ee{constructor(e){super(e),this.view=null,this.baseLayerViews=new xt,this.referenceLayerViews=new xt,this._loadingHandle=ae(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},ii)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r;if(this.view&&this.view.suspended)return!1;const e=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([p({constructOnly:!0})],A1.prototype,"view",void 0),u([p({readOnly:!0})],A1.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],A1.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],A1.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],A1.prototype,"updating",null),A1=u([N("esri.views.BasemapView")],A1);function Ddt(t){return"tryRecycleWith"in t}let Ndt=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=N_(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ol(this._controller.signal,()=>{const s=new J("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Ddt(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(_i(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>ol(this._controller.signal,()=>h(er())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let a,l;if(await i.load({signal:e}),"prefetchResources"in i&&await((s=i.prefetchResources)==null?void 0:s.call(i,{signal:e})),Udt(i))a=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new J("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(i);_i(e),a="default"in d?new d.default({layer:i,view:r}):new d({layer:i,view:r})}const c=()=>{l=is(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=ol(e,c),_i(e);try{await a.when()}catch(d){throw c(),d}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new J("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new J("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},Jd=class extends Ee{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new dy,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>(A(this._workPromise)&&(this._workPromise=N_(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(yS(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),A(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=d=>{if(!A(d)){for(const f of d)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const d of this._rootCollectionNames)o(this.get(d));for(const[d,f]of this._layerLayerViewInfoMap)if(!r.has(d)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[d,f]of this._recyclingInfoMap)r.has(d)||(this._recyclingInfoMap.delete(f.layer),f.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(h=i==null?void 0:i.basemap)==null?void 0:h.referenceLayers,i==null?void 0:i.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Gs(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ae(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Tr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,b(this._workPromise)&&(this._workPromise.reject(er()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return b(this._workPromise)||this._watchUpdatingTracking.updating||ua(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new J("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=r,i.getItemAt(s)!==a&&i.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Ndt(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(kn(r)||r.name==="cancelled:layerview-create")||le.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],Jd.prototype,"_workPromise",void 0),u([p({readOnly:!0})],Jd.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],Jd.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],Jd.prototype,"_rootCollectionNames",null),u([p()],Jd.prototype,"layerViewImporter",void 0),u([p()],Jd.prototype,"supportsGround",void 0),u([p({readOnly:!0})],Jd.prototype,"updating",null),u([p({readOnly:!0})],Jd.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],Jd.prototype,"view",void 0),Jd=u([N("esri.views.LayerViewManager")],Jd);const Fdt=Jd;function Udt(t){return"createLayerView"in t&&t.createLayerView!=null}let Dh=class extends Ee{constructor(e){super(e),this.factor=1.5,this.offset=xo(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],Dh.prototype,"factor",void 0),u([p({nonNullable:!0})],Dh.prototype,"offset",void 0),u([p()],Dh.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],Dh.prototype,"size",void 0),u([p()],Dh.prototype,"maskUrl",void 0),u([p()],Dh.prototype,"maskEnabled",void 0),u([p()],Dh.prototype,"overlayUrl",void 0),u([p()],Dh.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],Dh.prototype,"version",null),u([p({type:Boolean})],Dh.prototype,"visible",void 0),Dh=u([N("esri.views.Magnifier")],Dh);const MAe=Dh;let kdt=class{constructor(){this._tasks=new Array,this._running=new QU(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new lde(s,n,e,i,r)))}unshift(e,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new lde(s,n,e,i,r)))}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=yo(i.signal);if(s&&!i.abortCallback)i.reject(er());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,er()):i.callback(e);gh(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=er();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.set(!1)}},lde=class{constructor(e,i,r,s,n){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},AP=class extends Ee{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],AP.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],AP.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),AP=u([N("esri.views.support.DebugFlags")],AP);const Vdt=new AP;var Ki;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ki||(Ki={}));function zdt(){return new t9.Scheduler}var al,Nt;(function(t){t[t.YIELD=1]="YIELD"})(al||(al={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(Nt||(Nt={}));const Bg=0,cde=new Map([[Nt.RESOURCE_CONTROLLER_IMMEDIATE,Bg],[Nt.RESOURCE_CONTROLLER,4],[Nt.SLIDE,Bg],[Nt.STREAM_DATA_LOADER,Bg],[Nt.ELEVATION_QUERY,Bg],[Nt.TERRAIN_SURFACE,1],[Nt.SURFACE_GEOMETRY_UPDATES,1],[Nt.LOD_RENDERER,2],[Nt.GRAPHICS_CORE,2],[Nt.I3S_CONTROLLER,2],[Nt.POINT_CLOUD_LAYER,2],[Nt.FEATURE_TILE_FETCHER,2],[Nt.OVERLAY,4],[Nt.STAGE,4],[Nt.GRAPHICS_DECONFLICTOR,4],[Nt.FILTER_VISIBILITY,4],[Nt.SCALE_VISIBILITY,4],[Nt.FRUSTUM_VISIBILITY,4],[Nt.CLOUDS_GENERATOR,4],[Nt.POINT_OF_INTEREST_FREQUENT,6],[Nt.POINT_OF_INTEREST_INFREQUENT,30],[Nt.LABELER,8],[Nt.FEATURE_QUERY_ENGINE,8],[Nt.FEATURE_TILE_TREE,16],[Nt.FEATURE_TILE_TREE_ACTIVE,Bg],[Nt.ELEVATION_ALIGNMENT,12],[Nt.TEXT_TEXTURE_ATLAS,12],[Nt.TEXTURE_UNLOAD,12],[Nt.LINE_OF_SIGHT_TOOL,16],[Nt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Bg],[Nt.SNAPPING,Bg],[Nt.SHADOW_ACCUMULATOR,30]]);function ude(t){return cde.has(t)?cde.get(t):typeof t=="number"?t:1}const hde=6.5,dde=1,Bdt=30,pde=1e3/30,fde=100,mde=.9;var t9,Nw;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(n=>n.needsUpdate))}constructor(){this._updating=new QU(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new p_("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Ki.INTERACTING,this._tasks=new vi,this._runQueue=new vi,this._load=0,this._idleStateCallbacks=new vi,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ae(()=>Vdt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,ii);for(const o of Object.keys(Nt))this.performanceInfo.tasks.set(Nt[o],new p_(Nt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:hde,INTERACTING_BUDGET:pde,IDLE_BUDGET:fde,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),is(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=ude(n),l=new i(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new p_(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ki.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ki.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ki.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=hde,a=n.frameDuration,l=dde;switch(this.state){case Ki.IDLE:o=0,a=Math.max(fde,n.frameDuration),l=Bdt;break;case Ki.INTERACTING:a=Math.max(pde,n.frameDuration);case Ki.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Ki.IDLE&&a<dde&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ki.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ki.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Nw.SCHEDULED;let o=Nw.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Nw.READY:o!==Nw.READY&&(o=Nw.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*mde+n*(1-mde)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Bg&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Bg&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===al.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){le.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Nt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(Nt))this._frameTaskTimes.set(Nt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new kdt,this._handles=new ir,this.schedulePriority=this._basePriority,this._task=new QU(b(a)?a:this._queue),this._handles.add(wa(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(gc),this._scheduler.removeTask(this),this.schedule=WA.schedule,this.reschedule=WA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=ude(n);this._basePriority!==Bg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ki.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(t9||(t9={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Nw||(Nw={}));const gc=(()=>{const t=new t9.Budget;return t.enabled=!1,t})();let Gdt=class{remove(){}processQueue(){}schedule(e,i,r){try{if(yo(i)){const s=er();return r?Promise.resolve(r(s)):Promise.reject(s)}return yq(e(gc))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const WA=new Gdt;let vM=class extends Ee{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(Nt.TEXTURE_UNLOAD))??WA}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,i,r){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=i();n={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(s,n)}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.onRemove&&e.onRemove(),e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return b(i)?`${e}.${i}px`:e}};u([p()],vM.prototype,"_frameTask",void 0),u([p()],vM.prototype,"updating",null),vM=u([N("esri.views.3d.support.TextureCollection")],vM);var gde;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(gde||(gde={}));const AAe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],OAe={};function RAe(t){return!!OAe[t]}function jdt(t){for(const e of t)if(!RAe(e))return!1;return!0}AAe.forEach(t=>{OAe[t]=!0});let Hdt=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!jdt(n))return n.some(RAe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Es.DEFAULT;const l=this._createUniqueGroupName(),c=new qdt(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},qdt=class extends Is{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:xo(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(xo(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Sc(i.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:d,timestamp:f}=e;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:d,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var j$,yde,_de;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(j$||(j$={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(yde||(yde={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(_de||(_de={}));function Wdt(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return le.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function AZ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(j$.USER)&&t.getEditableFlag(j$.MANAGER)}function np(t){return xo(t.x,t.y)}function hWt(t){return zs(t.x,t.y)}function PAe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?xo(e.clientX-i.left,e.clientY-i.top):xo(0,0)}function i9(t,e){return e instanceof Event?PAe(t,e):np(e)}function r9(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Ydt=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":vde(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!bde(e))break;const s=np(e),n=this._intersect(s,e.pointerType,i.forEachTool);if(A(n))break;const o=n.manipulator,a=n.tool;!(b(o)&&b(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),b(o)&&b(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&A(i.activeTool)&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!bde(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=fa(s,({manipulator:h})=>h),o=fa(s,({tool:h})=>h);if(A(n)||A(o))break;const a=np(e);a.x=Se(a.x,0,i.view.width),a.y=Se(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=np(e),n=this._intersect(s,e.pointerType,i.forEachTool);if(Xdt(e)||i.forEachTool(c=>{if((!b(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),A(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const s=np(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=b(n)?n.manipulator:null;if(A(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=np(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=b(n)?n.manipulator:null;if(A(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=np(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=b(n)?n.manipulator:null;if(A(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:np(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=fa(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);A(r)||r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:np(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return ua(e,({manipulator:r})=>!(A(r)||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=EGe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=b(o)?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(A(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let s=null;return r(n=>{if(n.manipulators==null||!AZ(n))return!1;const o=n.manipulators.intersect(e,i);return!A(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(xo(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!vde(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(np(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=this._intersect(e,r,s);const o=fa(this._hoveredManipulators.get(i),({manipulator:a})=>a);b(n)&&!n.manipulator.interactive&&(n=null),b(n)&&o===n.manipulator||(b(o)&&(o.hovering=!1),b(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function vde(t){return t==="mouse"}function bde(t){return t.pointerType!=="mouse"||t.button===0}function Xdt(t){return!!t.native.shiftKey}const wde="attached",eG="tools";let L0=class extends Y2{constructor(e){super(e),this._manipulatorState=new Ydt,this.tools=new xt,this.cursor=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.handles.add([this.view.on(AAe,e=>{this._handleInputEvent(e)},Es.TOOL),...Wdt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(b(e)&&!this.view.ready)return void le.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),b(i)&&i.deactivate(),b(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=AZ(r);!A(this.activeTool)&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new vM(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ae(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i))),Dp(()=>this._set("textures",He(this.textures)))],wde)):this.handles.add(ae(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){b(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(wde)}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};b(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!i&&b(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(eG),this._forEachTool(e=>{if(e instanceof Ee){const i=ae(()=>[e.cursor,e.visible,e.editable],()=>{AZ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(i,eG)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],eG)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,j$.MANAGER,A(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;A(e)&&this._forEachTool(i=>!(!b(i.cursor)||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(A(e)||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}};u([p({constructOnly:!0,nonNullable:!0})],L0.prototype,"view",void 0),u([p({readOnly:!0,nonNullable:!0})],L0.prototype,"textures",void 0),u([p({value:null})],L0.prototype,"activeTool",null),u([p({readOnly:!0,type:xt})],L0.prototype,"tools",void 0),u([p({readOnly:!0})],L0.prototype,"cursor",void 0),u([p({readOnly:!0})],L0.prototype,"updating",null),L0=u([N("esri.views.ToolViewManager")],L0);const Zdt=L0;let NC=class extends Ee{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Jdt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Kdt[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],NC.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],NC.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],NC.prototype,"axisThreshold",null),NC=u([N("esri.views.input.gamepad.GamepadInputDevice")],NC);const Jdt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Kdt={standard:.15,spacemouse:.025,unknown:0},ore=NC;let OP=class extends Ee{constructor(...e){super(...e),this.devices=new xt,this.enabledFocusMode="document"}};u([p({type:xt.ofType(ore),readOnly:!0})],OP.prototype,"devices",void 0),u([p({type:["document","view","none"]})],OP.prototype,"enabledFocusMode",void 0),OP=u([N("esri.views.input.gamepad.GamepadSettings")],OP);const Qdt=OP;let $6=class extends Ee{constructor(){super(...arguments),this.gamepad=new Qdt}};u([p({readOnly:!0})],$6.prototype,"gamepad",void 0),$6=u([N("esri.views.input.Input")],$6);const ept=$6;let O1=class extends Ee{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],O1.prototype,"enabled",void 0),u([p({type:ore})],O1.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],O1.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],O1.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],O1.prototype,"velocityFactor",void 0),O1=u([N("esri.views.navigation.gamepad.GamepadSettings")],O1);const IAe=O1;let eT=class extends Ee{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new IAe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([p({type:Boolean})],eT.prototype,"browserTouchPanEnabled",void 0),u([p({type:IAe,nonNullable:!0})],eT.prototype,"gamepad",void 0),u([p({type:Boolean})],eT.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],eT.prototype,"mouseWheelZoomEnabled",void 0),eT=u([N("esri.views.navigation.Navigation")],eT);const $Ae=eT;function vWt(t,e,i){const r=LAe(t),s=e,n=tpt(r,s,i);if(r){const o=U3.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new J("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new J("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!ipt(t)||n===Gu.Unsupported)return new J("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Gu.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new J("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Gu.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new J("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Gu.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new J("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function tpt(t,e,i){if(!xde(t)||!xde(e))return Gu.Unsupported;if(t==null||e==null)return Gu.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Gu.Units;if(t.heightModel!==e.heightModel)return Gu.HeightModel;switch(t.heightModel){case"gravity-related-height":return Gu.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Gu.Ok:Gu.CRS;default:return Gu.Unsupported}}var Gu;function xde(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function ipt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!FAe(t)}function LAe(t){var r;const e=t.url?N3(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&b(e)&&e.serverType==="ImageServer")&&DAe(t)&&t.heightModelInfo?t.heightModelInfo:FAe(t)?U3.deriveUnitFromSR(spt,t.spatialReference):null}function DAe(t){return"heightModelInfo"in t}function NAe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function FAe(t){return NAe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):UAe(t)}function rpt(t){return t.layers!=null||UAe(t)||NAe(t)||DAe(t)}function UAe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Gu||(Gu={}));const spt=new U3({heightModel:"gravity-related-height"});var it;function Tde(t){return t==="global"?it.Global:it.Local}function tG(t){return t===it.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(it||(it={}));let OZ,iG=null;async function npt(t){iG||(iG=se(()=>Promise.resolve().then(()=>ZIt),void 0).then(e=>OZ=e)),await iG,_i(t)}async function kAe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return Xb()||Bp(s,e)?bd(t,e):OZ?OZ.projectGeometry(t,e,i,r):(await Promise.race([npt(r),Zb(r)]),kAe(t,e,i,r))}let Ds=class extends Ee{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=lu(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return b(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return A(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return b(this.priorityCollection)&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);b(a)&&(r=a)}if(b(r)&&r.length===1)break}if(i&&(A(r)||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:b(s)?s.spatialReference:null,viewingMode:b(s)?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(rpt(o)){const a=LAe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(b(s.fullExtent)?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(A(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:b(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(b(this._projectExtentTask.task)&&(this._projectExtentTask.task=lu(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:jL(async n=>{try{const o=await kAe(r.extent,s,r.layer.portalItem,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(yo(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(A(e))return i;const r=[],s=(n,o)=>b(n)?b(o)?n===o&&n:n:o;for(const n of e)for(const o of i){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:n.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return A(e)||e.length<1?b(i)?{spatialReference:i,viewingMode:null}:null:(b(i)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==it.Local)&&(e=e.filter(({viewingMode:r})=>r!==it.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(b(n)){const o=b(n.constraints)?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||A(this.userSpatialReference)||a.equals(this.userSpatialReference))&&r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i={layers:[],preloading:-1,updating:!1};for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([p()],Ds.prototype,"required",void 0),u([p({constructOnly:!0})],Ds.prototype,"map",void 0),u([p({constructOnly:!0})],Ds.prototype,"getSpatialReferenceSupport",void 0),u([p()],Ds.prototype,"defaultSpatialReference",void 0),u([p()],Ds.prototype,"userSpatialReference",void 0),u([p()],Ds.prototype,"sourcePreloadCount",void 0),u([p()],Ds.prototype,"priorityCollection",void 0),u([p()],Ds.prototype,"requiresExtentInSpatialReference",void 0),u([p()],Ds.prototype,"suspended",void 0),u([p({readOnly:!0})],Ds.prototype,"ready",null),u([p({readOnly:!0})],Ds.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],Ds.prototype,"spatialReference",null),u([p({readOnly:!0})],Ds.prototype,"extent",null),u([p({readOnly:!0})],Ds.prototype,"heightModelInfo",null),u([p({readOnly:!0})],Ds.prototype,"vcsWkid",null),u([p({readOnly:!0})],Ds.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],Ds.prototype,"viewingMode",null),u([p({readOnly:!0})],Ds.prototype,"tileInfo",null),u([p({readOnly:!0})],Ds.prototype,"mapCollections",null),u([p({readOnly:!0})],Ds.prototype,"_allLayers",null),u([p({readOnly:!0})],Ds.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],Ds.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],Ds.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],Ds.prototype,"_extentCandidatesTask",null),u([p()],Ds.prototype,"_extentTask",null),u([p()],Ds.prototype,"_projectExtentTask",void 0),Ds=u([N("esri.views.support.DefaultsFromMap")],Ds);var L6;let ri=L6=class extends Dm(ws.EventedMixin(Ik(Ee))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Gb({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new _2,this.analyses=new qA,this.typeSpecificPreconditionsReady=!0,this.layerViews=new xt,this.magnifier=new MAe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new ew,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new ept,this.navigation=new $Ae,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Hdt(this),this.persistableViewModels=new xt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ae(()=>this.preconditionsReady,e=>{var i,r;e?(this._currentSpatialReference=this.spatialReference,L6.views.add(this)):(this._currentSpatialReference=null,L6.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((i=this.toolViewManager)==null||i.detach(),b(this.analysisViewManager)&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):e&&!this.ready&&(this._startup(),b(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Mi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,Wb(()=>this.ready)))),this.basemapView=new A1({view:this}),this.layerViewManager=new Fdt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Zdt({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ae(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ae(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ae(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ae(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(b(t))return;const s=Dp(()=>t=lu(t));t=jL(async n=>{try{await R2(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}le.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=He(this.graphics),this.analyses=He(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),He(this.analysisViewManager),this.toolViewManager=He(this.toolViewManager),this.layerViewManager=He(this.layerViewManager),this.basemapView=He(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return le.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ds({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Tm.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(le.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),Tm.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!us(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return b(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new J("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return b(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&le.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(wa(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};ri.views=new xt,u([p()],ri.prototype,"_userSpatialReference",void 0),u([p()],ri.prototype,"activeTool",null),u([p({readOnly:!0})],ri.prototype,"allLayerViews",void 0),u([p()],ri.prototype,"groundView",void 0),u([p()],ri.prototype,"animation",null),u([p()],ri.prototype,"basemapView",void 0),u([p()],ri.prototype,"center",null),u([p({readOnly:!0})],ri.prototype,"_defaultsFromMapSettings",null),u([p()],ri.prototype,"defaultsFromMap",null),u([p()],ri.prototype,"fatalError",void 0),u([p({type:ti})],ri.prototype,"extent",null),u([p(e9(_2,"graphics"))],ri.prototype,"graphics",void 0),u([p(e9(qA,"analyses"))],ri.prototype,"analyses",void 0),u([p({readOnly:!0,type:U3})],ri.prototype,"heightModelInfo",null),u([p({readOnly:!0})],ri.prototype,"interacting",null),u([p({readOnly:!0})],ri.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],ri.prototype,"preconditionsReady",null),u([p({readOnly:!0})],ri.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:xt,readOnly:!0})],ri.prototype,"layerViews",void 0),u([p()],ri.prototype,"resolution",null),u([p({type:MAe})],ri.prototype,"magnifier",void 0),u([p({value:null,type:Gk})],ri.prototype,"map",null),u([p()],ri.prototype,"padding",void 0),u([p({readOnly:!0})],ri.prototype,"ready",void 0),u([p({type:Ye})],ri.prototype,"spatialReference",null),u([p()],ri.prototype,"spatialReferenceWarningDelay",void 0),u([p()],ri.prototype,"stationary",null),u([p({readOnly:!0})],ri.prototype,"supportsGround",void 0),u([p({type:Jp})],ri.prototype,"timeExtent",void 0),u([p({type:ew,nonNullable:!0})],ri.prototype,"timeReference",void 0),u([p()],ri.prototype,"tools",null),u([p()],ri.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],ri.prototype,"type",void 0),u([p({type:Number})],ri.prototype,"scale",void 0),u([p({readOnly:!0})],ri.prototype,"updating",void 0),u([p({readOnly:!0})],ri.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],ri.prototype,"initialExtent",null),u([p()],ri.prototype,"cursor",null),u([p({readOnly:!0})],ri.prototype,"input",void 0),u([p({type:$Ae,nonNullable:!0})],ri.prototype,"navigation",void 0),u([p()],ri.prototype,"layerViewManager",void 0),u([p()],ri.prototype,"analysisViewManager",void 0),u([p()],ri.prototype,"width",void 0),u([p()],ri.prototype,"height",void 0),u([p({readOnly:!0})],ri.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],ri.prototype,"size",null),u([p({readOnly:!0})],ri.prototype,"suspended",void 0),u([p({readOnly:!0})],ri.prototype,"viewEvents",void 0),u([p({readOnly:!0})],ri.prototype,"persistableViewModels",void 0),u([p()],ri.prototype,"_isValid",void 0),u([p()],ri.prototype,"_readyCycleForced",void 0),u([p()],ri.prototype,"_currentSpatialReference",void 0),ri=L6=u([N("esri.views.View")],ri);const VAe=ri;let R1=class extends rU{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,i)=>this._dfd={resolve:e,reject:i}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new J("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,i){i||(i=gh(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([p({readOnly:!0})],R1.prototype,"done",null),u([p({readOnly:!0,type:String})],R1.prototype,"state",void 0),u([p()],R1.prototype,"target",void 0),R1=u([N("esri.views.ViewAnimation")],R1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(R1||(R1={}));const j_=R1;function DT(t,e,i,r){const s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,l=3*(r-e)-a,c=1-a-l;function h(g){return((o*g+n)*g+s)*g}function d(g){return((c*g+l)*g+a)*g}function f(g){return(3*o*g+2*n)*g+s}function m(g,y){let v,x,S,E,C,R;for(S=g,R=0;R<8;R++){if(E=h(S)-g,Math.abs(E)<y)return S;if(C=f(S),Math.abs(C)<1e-6)break;S-=E/C}if(v=0,x=1,S=g,S<v)return v;if(S>x)return x;for(;v<x;){if(E=h(S),Math.abs(E-g)<y)return S;g>E?v=S:x=S,S=.5*(x-v)+v}return S}return function(g,y=1e-6){return d(m(g,y))}}const opt=/^cubic-bezier\((.*)\)/,cp={};function apt(t){let e=cp[t]||null;if(!e){const i=opt.exec(t);if(i){const r=i[1].split(",").map(s=>parseFloat(s.trim()));r.length!==4||r.some(s=>isNaN(s))||(e=DT.apply(DT,r))}}return e}cp.ease=DT(.25,.1,.25,1),cp.linear=DT(0,0,1,1),cp.easeIn=cp["ease-in"]=DT(.42,0,1,1),cp.easeOut=cp["ease-out"]=DT(0,0,.58,1),cp.easeInOut=cp["ease-in-out"]=DT(.42,0,.58,1);function Rb(){return[1,0,0,1,0,0]}function lpt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function cpt(t,e,i,r,s,n){return[t,e,i,r,s,n]}function upt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:lpt,create:Rb,createView:upt,fromValues:cpt},Symbol.toStringTag,{value:"Module"}));function Ao(t,e){return t[0]=e[0],t[1]=e[1],t}function Vt(t,e,i){return t[0]=e,t[1]=i,t}function ed(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Bs(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function zAe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function BAe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function hpt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function dpt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function ppt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function fpt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function mpt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function tl(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function x_(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Gp(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function wd(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function J2(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function tw(t){const e=t[0],i=t[1];return e*e+i*i}function are(t,e){return t[0]=-e[0],t[1]=-e[1],t}function gpt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function iw(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Us(t,e){return t[0]*e[0]+t[1]*e[1]}function GAe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function NT(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function ypt(t,e){e=e||1;const i=2*qL()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function RZ(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function qg(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function _pt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function vpt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function bpt(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function wpt(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function xpt(t){return"vec2("+t[0]+", "+t[1]+")"}function jAe(t,e){return t[0]===e[0]&&t[1]===e[1]}function HAe(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=ul();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Tpt(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const Spt=J2,GV=Bs,Ept=zAe,Cpt=BAe,qAe=Gp,Mpt=wd,Apt=tw;Object.freeze(Object.defineProperty({__proto__:null,add:ed,angle:wpt,ceil:hpt,copy:Ao,cross:GAe,dist:qAe,distance:Gp,div:Cpt,divide:BAe,dot:Us,equals:HAe,exactEquals:jAe,floor:dpt,inverse:gpt,len:Spt,length:J2,lerp:NT,max:fpt,min:ppt,mul:Ept,multiply:zAe,negate:are,normalize:iw,projectAndScale:Tpt,random:ypt,rotate:bpt,round:mpt,scale:tl,scaleAndAdd:x_,set:Vt,sqrDist:Mpt,sqrLen:Apt,squaredDistance:wd,squaredLength:tw,str:xpt,sub:GV,subtract:Bs,transformMat2:RZ,transformMat2d:qg,transformMat3:_pt,transformMat4:vpt},Symbol.toStringTag,{value:"Module"}));function je(){return[0,0]}function bM(t){return[t[0],t[1]]}function nr(t,e){return[t,e]}function WAe(t){const e=je(),i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function YAe(t,e){return new Float64Array(t,e,2)}function XAe(){return je()}function ZAe(){return nr(1,1)}function JAe(){return nr(1,0)}function KAe(){return nr(0,1)}const mu=XAe(),QAe=ZAe(),Opt=JAe(),Rpt=KAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:QAe,UNIT_X:Opt,UNIT_Y:Rpt,ZEROS:mu,clone:bM,create:je,createView:YAe,fromArray:WAe,fromValues:nr,ones:ZAe,unitX:JAe,unitY:KAe,zeros:XAe},Symbol.toStringTag,{value:"Module"}));const e3e=96,t3e=39.37,Ppt=180/Math.PI;function i3e(t){return t.wkid?t:t.spatialReference||Ye.WGS84}function lre(t,e){return e.type?Vt(t,e.x,e.y):Ao(t,e)}function r3e(t){return Ec(t)}function zI(t,e){const i=Math.max(1,e[0]),r=Math.max(1,e[1]);return Math.max(t.width/i,t.height/r)*Vpt(t.spatialReference)}async function RP(t,e,i,r){let s,n;if(!t||Array.isArray(t)&&!t.length)return null;if(xt.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const a=t.every(h=>"attributes"in h),l=t.some(h=>!h.geometry);let c=t;if(a&&l&&e&&e.allLayerViews){const h=new Map;for(const g of t){const y=g.layer,v=h.get(y)||[],x=g.attributes[y.objectIdField];x!=null&&v.push(x),h.set(y,v)}const d=[];h.forEach((g,y)=>{const v=e.allLayerViews.find(x=>x.layer.id===y.id);if(v&&"queryFeatures"in v){const x=y.createQuery();x.objectIds=g,x.returnGeometry=!0,d.push(v.queryFeatures(x))}});const f=await Promise.all(d),m=[];for(const g of f)if(g&&g.features&&g.features.length)for(const y of g.features)b(y.geometry)&&m.push(y.geometry);c=m}for(const h of c)r=await RP(h,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")s=new st(t);else if(t instanceof K_)s=t;else if("geometry"in t){if(t.geometry)s=t.geometry;else if(t.layer){const a=t.layer,l=e.allLayerViews.find(c=>c.layer.id===a.id);if(l&&"queryFeatures"in l){const c=a.createQuery();c.objectIds=[t.attributes[a.objectIdField]],c.returnGeometry=!0;const h=await l.queryFeatures(c);s=Hn(h,"features",0,"geometry")}}}if(A(s)||(n=s.type==="point"?new ti({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference}):s.extent,!n))return null;Xb()||Bp(n.spatialReference,i)||await Zb();const o=bd(n,i);return o?r=r?r.union(o):o:null}function Ipt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,i=0;for(const r of t){const s=r.layer;s&&s.minScale&&s.maxScale&&(e=s.minScale<e?s.minScale:e,i=s.maxScale>i?s.maxScale:i)}return e&&i?{min:e,max:i}:null}}}function rG(t,e){return us(i3e(t),e)?t:bd(t,e)}async function $pt(t,e){if(!t||!e)return new ya({targetGeometry:new st,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:o}=e,a=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let l=null;t instanceof ya?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l&&l.targetGeometry?c=l.targetGeometry:t instanceof ti?c=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(c=await RP(t.center,e,i)||await RP(t.extent,e,i)||await RP(t.target,e,i)||await RP(t,e,i)),!c&&n&&n.targetGeometry?c=n.targetGeometry:!c&&e.extent&&(c=e.extent),i||(i=i3e(e.spatialReference||e.extent||c)),Xb()||us(c.spatialReference,i)||Bp(c,i)||await Zb();const h=rG(c.center?c.center:c,i);let d=0;if(l&&b(l.targetGeometry)&&l.targetGeometry.type==="point")d=l.scale;else if("scale"in t&&t.scale)d=t.scale;else if("zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs)d=r.zoomToScale(t.zoom);else if(Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0){const y=rG(e.extent,i);d=b(y)?zI(y,a):e.extent?zI(e.extent,a):n.scale}else d=zI(rG(c.extent,i),a);const f=Ipt(t);f&&(f.min&&f.min>d?d=f.min:f.max&&f.max<d&&(d=f.max));let m=0;l?m=l.rotation:t.hasOwnProperty("rotation")?m=t.rotation:n&&(m=n.rotation);let g=new ya({targetGeometry:h,scale:d,rotation:m});return r&&(g=r.fit(g),r.constrainByGeometry(g),r.rotationEnabled||(g.rotation=m)),g}function Nm(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Lpt(t,e,i){return i?Vt(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):tl(t,e,.5)}const Dpt=function(){const t=je();return function(e,i,r){const s=i.targetGeometry;lre(t,s);const n=.5*H3(i);return e.xmin=t[0]-n*r[0],e.ymin=t[1]-n*r[1],e.xmax=t[0]+n*r[0],e.ymax=t[1]+n*r[1],e.spatialReference=s.spatialReference,e}}();function Npt(t,e,i,r,s){return PZ(t,e,i.center),t.scale=zI(i,r),s&&s.constraints&&s.constraints.constrain(t),t}function Fpt(t,e,i,r){return hre(t,e,i,r),ire(t,t)}const s3e=function(){const t=je();return function(e,i,r){return GV(e,zpt(e,i),Lpt(t,i,r))}}(),Upt=function(){const t=Rb(),e=je();return function(i,r,s,n){const o=H3(r),a=cre(r);return Vt(e,o,o),yAe(t,e),zV(t,t,a),G$(t,t,s3e(e,s,n)),G$(t,t,[0,n.top-n.bottom]),Vt(i,t[4],t[5])}}();function H3(t){return t.scale*kpt(t.targetGeometry)}function kpt(t){return b(t)&&Vo(t.spatialReference)?1/(r3e(t.spatialReference)*t3e*e3e):1}function cre(t){return Fk(t.rotation)||0}function Vpt(t){return Vo(t)?r3e(t)*t3e*e3e:1}function zpt(t,e){return tl(t,e,.5)}const ure=function(){const t=je(),e=je(),i=je();return function(r,s,n,o,a,l){return are(t,s),tl(e,n,.5*l),Vt(i,1/o*l,-1/o*l),sre(r,e),a&&zV(r,r,a),rre(r,r,i),G$(r,r,t),r}}(),hre=function(){const t=je();return function(e,i,r,s){const n=H3(i),o=cre(i);return lre(t,i.targetGeometry),ure(e,t,r,n,o,s)}}(),Bpt=function(){const t=je();return function(e,i,r,s){const n=H3(i);return lre(t,i.targetGeometry),ure(e,t,r,n,0,s)}}();function Gpt(t){const e=dd(t);return e?e.valid[1]-e.valid[0]:0}function jpt(t,e){return Math.round(Gpt(t)/e)}const Hpt=function(){const t=je(),e=je(),i=[0,0,0];return function(r,s,n){Bs(t,r,s),iw(t,t),Bs(e,r,n),iw(e,e),GAe(i,t,e);let o=Math.acos(Us(t,e)/(J2(t)*J2(e)))*Ppt;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),qpt=function(){const t=je();return function(e,i,r,s){const n=e.targetGeometry;return Nm(e,i),Upt(t,i,r,s),n.x+=t[0],n.y+=t[1],e}}(),PZ=function(t,e,i){Nm(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},Wpt=function(){const t=je();return function(e,i,r,s,n){n||(n="center"),GV(t,r,s),tl(t,t,.5);const o=t[0],a=t[1];switch(n){case"center":Vt(t,0,0);break;case"left":Vt(t,-o,0);break;case"top":Vt(t,0,a);break;case"right":Vt(t,o,0);break;case"bottom":Vt(t,0,-a);break;case"top-left":Vt(t,-o,a);break;case"bottom-left":Vt(t,-o,-a);break;case"top-right":Vt(t,o,a);break;case"bottom-right":Vt(t,o,-a)}return jV(e,i,t),e}}();function xWt(t,e,i){return Nm(t,e),t.rotation+=i,t}function Ypt(t,e,i){return Nm(t,e),t.rotation=i,t}const Xpt=function(){const t=je();return function(e,i,r,s,n){return Nm(e,i),isNaN(r)||r===0||(o3e(t,s,i,n),e.scale=i.scale*r,a3e(t,t,e,n),jV(e,e,Vt(t,t[0]-s[0],s[1]-t[1]))),e}}();function Sde(t,e,i){return Nm(t,e),t.scale=i,t}const n3e=function(){const t=je();return function(e,i,r,s,n,o){return Nm(e,i),isNaN(r)||r===0||(o3e(t,n,i,o),e.scale=i.scale*r,e.rotation+=s,a3e(t,t,e,o),jV(e,e,Vt(t,t[0]-n[0],n[1]-t[1]))),e}}(),TWt=function(){const t=je(),e=je();return function(i,r,s,n,o,a,l){return s3e(e,a,l),ed(t,o,e),n?n3e(i,r,s,n,t,a):Xpt(i,r,s,t,a)}}(),o3e=function(){const t=Rb();return function(e,i,r,s){return qg(e,i,Fpt(t,r,s,1))}}(),a3e=function(){const t=Rb();return function(e,i,r,s){return qg(e,i,hre(t,r,s,1))}}(),jV=function(){const t=je(),e=Rb();return function(i,r,s){Nm(i,r);const n=H3(r),o=i.targetGeometry;return gAe(e,cre(r)),rre(e,e,nr(n,n)),qg(t,s,e),o.x+=t[0],o.y+=t[1],i}}();let Zpt=class{constructor(e,i,r,s){const n=e.targetGeometry,o=i.targetGeometry;s?typeof s=="string"&&(s=apt(s)||cp.ease):s=cp.ease,this.easing=s,this.duration=r,this.sCenterX=n.x,this.sCenterY=n.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,i){const r=this.easing(i);let s,n,o,a;i>=1?(s=this.tCenterX,n=this.tCenterY,o=this.tRotation,a=this.tScale):(s=this.sCenterX+r*this.dCenterX,n=this.sCenterY+r*this.dCenterY,o=this.sRotation+r*this.dRotation,a=this.sScale+r*this.dScale),e.targetGeometry.x=s,e.targetGeometry.y=n,e.scale=a,e.rotation=o}},D0=class extends Ee{constructor(e){super(e),this.updateFunction=null,this.animation=null,this.duration=200,this.transition=null,this.easing=cp.ease,this.view=null,this.viewpoint=new ya({targetGeometry:new st,scale:0,rotation:0}),this._updateTask=F_({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=is(this._updateTask)}animate(e,i,r){this.stop();const s=this.viewpoint;Nm(s,i),this.transition=new Zpt(this.viewpoint,e.target,r&&r.duration||this.duration,r&&r.easing||this.easing);const n=()=>{var o,a;this.animation===e&&this._updateTask&&(e.state==="finished"&&((o=this.transition)==null||o.applyRatio(this.viewpoint,1),(a=this.view)!=null&&a.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new j_({target:e.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var r,s;const i=this.animation;if(i&&i.state!==j_.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const n=this.transition,o=(performance.now()-this._startTime)/n.duration,a=o>=1;n.applyRatio(this.viewpoint,o),a&&((r=this.animation)==null||r.finish())}(s=this.view)!=null&&s.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};u([p()],D0.prototype,"animation",void 0),u([p()],D0.prototype,"duration",void 0),u([p()],D0.prototype,"transition",void 0),u([p()],D0.prototype,"easing",void 0),u([p()],D0.prototype,"view",void 0),u([p()],D0.prototype,"viewpoint",void 0),D0=u([N("esri.views.2d.AnimationManager")],D0);const Jpt=D0;let Kpt=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var a;this._updateRequested=!1;const{basemapView:i,graphicsView:r,labelManager:s,layerViews:n,state:{id:o}}=this.view;i==null||i.baseLayerViews.forEach(this._updateLayerView,this),n.forEach(this._updateLayerView,this),i==null||i.referenceLayerViews.forEach(this._updateLayerView,this),b(s)&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),b(r)&&(r.lastUpdateId!==o&&(r.viewChange(),r.lastUpdateId=o),r.updateRequested&&r.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((a=this._frameTaskHandle)==null||a.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=ae(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=F_(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}};function ho(){return Promise.all([se(()=>import("./webglDeps-1deeae7f.js"),["assets/webglDeps-1deeae7f.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-3f37b110.js"]),se(()=>import("./mapViewDeps-5259a775.js"),["assets/mapViewDeps-5259a775.js","assets/CIMResourceManager-e389f275.js","assets/Rasterizer-fef7f176.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/utils-35d9b505.js","assets/alignmentUtils-ae955d28.js","assets/definitions-19bfb61c.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/imageutils-6de27084.js","assets/Container-0639ee3d.js","assets/BufferPool-dc72dc51.js","assets/enums-b1d611e3.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/VTLMaterialManager-5216362a.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-046c9108.js","assets/Matcher-f36ffa66.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/CircularArray-7b2394fa.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/MaterialPrograms-05d78577.js","assets/GraphicsView2D-28d2d544.js","assets/normalizeUtilsSync-360fb6bc.js","assets/AttributeStoreView-0d158480.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/GraphicsView-a2abd211.js","assets/GraphicContainer-caf957bb.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/TileContainer-c1add888.js"])])}const VO=()=>ho().then(()=>se(()=>import("./TileLayerView2D-5baeace6.js"),["assets/TileLayerView2D-5baeace6.js","assets/Rasterizer-fef7f176.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/utils-35d9b505.js","assets/alignmentUtils-ae955d28.js","assets/definitions-19bfb61c.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/Container-0639ee3d.js","assets/BufferPool-dc72dc51.js","assets/enums-b1d611e3.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/MagnifierPrograms-046c9108.js","assets/imageutils-6de27084.js","assets/Matcher-f36ffa66.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/CircularArray-7b2394fa.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView2D-28d2d544.js","assets/normalizeUtilsSync-360fb6bc.js","assets/AttributeStoreView-0d158480.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/GraphicsView-a2abd211.js","assets/imageUtils-05b52030.js","assets/BitmapTileContainer-816dc43b.js","assets/Bitmap-99ee7f2b.js","assets/TileContainer-c1add888.js","assets/LayerView2D-52985332.js","assets/HighlightGraphicContainer-8c28ab06.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/MapServiceLayerViewHelper-34527599.js","assets/drapedUtils-8847b824.js","assets/popupUtils-fdf02f9f.js"])),HS=()=>ho().then(()=>se(()=>import("./FeatureLayerView2D-6ae7a99c.js"),["assets/FeatureLayerView2D-6ae7a99c.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView2D-52985332.js","assets/schemaUtils-5ed910d9.js","assets/enums-b1d611e3.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-f978585c.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6a784d48.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-03d4fc54.js","assets/util-5c979b56.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),Ede={"base-dynamic":()=>ho().then(()=>se(()=>import("./BaseDynamicLayerView2D-b1bf9aac.js"),["assets/BaseDynamicLayerView2D-b1bf9aac.js","assets/BitmapContainer-4f01c71a.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/ExportStrategy-592f4635.js","assets/Bitmap-99ee7f2b.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),"base-tile":VO,"bing-maps":VO,csv:HS,"geo-rss":()=>ho().then(()=>se(()=>import("./GeoRSSLayerView2D-7e66880b.js"),["assets/GeoRSSLayerView2D-7e66880b.js","assets/LayerView2D-52985332.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/GraphicContainer-caf957bb.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6a784d48.js","assets/TileContainer-c1add888.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/LayerView-fee1e4f7.js"])),feature:HS,geojson:HS,graphics:()=>ho().then(()=>se(()=>import("./GraphicsLayerView2D-0cbe44a1.js"),["assets/GraphicsLayerView2D-0cbe44a1.js","assets/LayerView2D-52985332.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/GraphicContainer-caf957bb.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6a784d48.js","assets/TileContainer-c1add888.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/LayerView-fee1e4f7.js"])),group:()=>ho().then(()=>se(()=>import("./GroupLayerView2D-d8ab34f3.js"),["assets/GroupLayerView2D-d8ab34f3.js","assets/GroupContainer-d48a340a.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/GroupLayerView-551572a5.js","assets/LayerView-fee1e4f7.js"])),imagery:()=>ho().then(()=>se(()=>import("./ImageryLayerView2D-fa81844d.js"),["assets/ImageryLayerView2D-fa81844d.js","assets/RasterVFDisplayObject-38391a40.js","assets/dataUtils-8c20a88d.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/definitions-19bfb61c.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-22e7c87b.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/HighlightGraphicContainer-8c28ab06.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/TileContainer-c1add888.js","assets/BitmapContainer-4f01c71a.js","assets/Bitmap-99ee7f2b.js","assets/ExportStrategy-592f4635.js","assets/rasterProjectionHelper-00c1b486.js","assets/ImageryLayerView-946c4247.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),"imagery-tile":()=>ho().then(()=>se(()=>import("./ImageryTileLayerView2D-570a7e57.js"),["assets/ImageryTileLayerView2D-570a7e57.js","assets/multidimensionalUtils-9537302d.js","assets/RasterVFDisplayObject-38391a40.js","assets/dataUtils-8c20a88d.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/definitions-19bfb61c.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-22e7c87b.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/TileContainer-c1add888.js","assets/RawBlockCache-d675f4f4.js","assets/rasterProjectionHelper-00c1b486.js","assets/util-5c979b56.js","assets/ImageryTileLayerView-df398d83.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),kml:()=>ho().then(()=>se(()=>import("./KMLLayerView2D-ab31d901.js"),["assets/KMLLayerView2D-ab31d901.js","assets/kmlUtils-cabb4be5.js","assets/Bitmap-99ee7f2b.js","assets/BitmapContainer-4f01c71a.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/GraphicContainer-caf957bb.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/TileContainer-c1add888.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/LayerView-fee1e4f7.js","assets/rasterProjectionHelper-00c1b486.js","assets/MaterialPrograms-05d78577.js","assets/programUtils-f035fe8a.js"])),"knowledge-graph":()=>ho().then(()=>se(()=>import("./KnowledgeGraphLayerView2D-a9432204.js"),["assets/KnowledgeGraphLayerView2D-a9432204.js","assets/LayerView2D-52985332.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView-fee1e4f7.js"])),"link-chart":()=>ho().then(()=>se(()=>import("./KnowledgeGraphLayerView2D-a9432204.js"),["assets/KnowledgeGraphLayerView2D-a9432204.js","assets/LayerView2D-52985332.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView-fee1e4f7.js"])),"knowledge-graph-sublayer":HS,"map-image":()=>ho().then(()=>se(()=>import("./MapImageLayerView2D-d70990ec.js"),["assets/MapImageLayerView2D-d70990ec.js","assets/BitmapContainer-4f01c71a.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/HighlightGraphicContainer-8c28ab06.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/TileContainer-c1add888.js","assets/ExportStrategy-592f4635.js","assets/Bitmap-99ee7f2b.js","assets/LayerView-fee1e4f7.js","assets/MapImageLayerView-a96e688e.js","assets/RefreshableLayerView-7dc52eae.js","assets/MapServiceLayerViewHelper-34527599.js","assets/drapedUtils-8847b824.js","assets/popupUtils-fdf02f9f.js"])),"map-notes":()=>ho().then(()=>se(()=>import("./MapNotesLayerView2D-78e54d23.js"),["assets/MapNotesLayerView2D-78e54d23.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/GroupContainer-d48a340a.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/LayerView2D-52985332.js","assets/GraphicContainer-caf957bb.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/TileContainer-c1add888.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/LayerView-fee1e4f7.js"])),media:()=>ho().then(()=>se(()=>import("./MediaLayerView2D-18b3c8b7.js"),["assets/MediaLayerView2D-18b3c8b7.js","assets/MediaElementView-3b774207.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Rasterizer-fef7f176.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/utils-35d9b505.js","assets/alignmentUtils-ae955d28.js","assets/definitions-19bfb61c.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/Container-0639ee3d.js","assets/BufferPool-dc72dc51.js","assets/enums-b1d611e3.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/MagnifierPrograms-046c9108.js","assets/imageutils-6de27084.js","assets/Matcher-f36ffa66.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/CircularArray-7b2394fa.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView2D-28d2d544.js","assets/AttributeStoreView-0d158480.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/GraphicsView-a2abd211.js","assets/perspectiveUtils-fb723c80.js","assets/LayerView2D-52985332.js","assets/LayerView-fee1e4f7.js"])),"ogc-feature":()=>ho().then(()=>se(()=>import("./OGCFeatureLayerView2D-9e1f9f35.js"),["assets/OGCFeatureLayerView2D-9e1f9f35.js","assets/FeatureLayerView2D-6ae7a99c.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView2D-52985332.js","assets/schemaUtils-5ed910d9.js","assets/enums-b1d611e3.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-f978585c.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6a784d48.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-03d4fc54.js","assets/util-5c979b56.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/OGCFeatureLayerView-e9339ed8.js"])),"open-street-map":VO,"oriented-imagery":HS,route:()=>ho().then(()=>se(()=>import("./RouteLayerView2D-e6a98a34.js"),["assets/RouteLayerView2D-e6a98a34.js","assets/Stop-158dd4e3.js","assets/LayerView2D-52985332.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/GraphicContainer-caf957bb.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/AttributeStoreView-0d158480.js","assets/visualVariablesUtils-e8f7cd46.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6a784d48.js","assets/TileContainer-c1add888.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/GraphicsView2D-28d2d544.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/normalizeUtilsSync-360fb6bc.js","assets/Matcher-f36ffa66.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/GraphicsView-a2abd211.js","assets/LayerView-fee1e4f7.js"])),stream:()=>ho().then(()=>se(()=>import("./StreamLayerView2D-207fecb5.js"),["assets/StreamLayerView2D-207fecb5.js","assets/FeatureLayerView2D-6ae7a99c.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView2D-52985332.js","assets/schemaUtils-5ed910d9.js","assets/enums-b1d611e3.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-f978585c.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6a784d48.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-03d4fc54.js","assets/util-5c979b56.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),"subtype-group":()=>ho().then(()=>se(()=>import("./SubtypeGroupLayerView2D-eaba900b.js"),["assets/SubtypeGroupLayerView2D-eaba900b.js","assets/FeatureLayerView2D-6ae7a99c.js","assets/Container-0639ee3d.js","assets/definitions-19bfb61c.js","assets/LayerView2D-52985332.js","assets/schemaUtils-5ed910d9.js","assets/enums-b1d611e3.js","assets/color-916b4f87.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-f978585c.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6a784d48.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/utils-35d9b505.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-03d4fc54.js","assets/util-5c979b56.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),tile:VO,"vector-tile":()=>ho().then(()=>se(()=>import("./VectorTileLayerView2D-02afd24d.js"),["assets/VectorTileLayerView2D-02afd24d.js","assets/TileInfoViewPOT-ac5f73ba.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/TileContainer-c1add888.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/StyleRepository-7fc711a8.js","assets/colorUtils-7641d345.js","assets/GeometryUtils-53652037.js","assets/LayerView2D-52985332.js","assets/LayerView-fee1e4f7.js"])),wcs:()=>ho().then(()=>se(()=>import("./ImageryTileLayerView2D-570a7e57.js"),["assets/ImageryTileLayerView2D-570a7e57.js","assets/multidimensionalUtils-9537302d.js","assets/RasterVFDisplayObject-38391a40.js","assets/dataUtils-8c20a88d.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/definitions-19bfb61c.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-22e7c87b.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/TileContainer-c1add888.js","assets/RawBlockCache-d675f4f4.js","assets/rasterProjectionHelper-00c1b486.js","assets/util-5c979b56.js","assets/ImageryTileLayerView-df398d83.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),"web-tile":VO,wfs:HS,wms:()=>ho().then(()=>se(()=>import("./WMSLayerView2D-b570dec4.js"),["assets/WMSLayerView2D-b570dec4.js","assets/BitmapContainer-4f01c71a.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/LayerView2D-52985332.js","assets/ExportStrategy-592f4635.js","assets/Bitmap-99ee7f2b.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/WMSLayerView-7966db0e.js"])),wmts:()=>ho().then(()=>se(()=>import("./WMTSLayerView2D-d30aff6c.js"),["assets/WMTSLayerView2D-d30aff6c.js","assets/imageUtils-05b52030.js","assets/BitmapTileContainer-816dc43b.js","assets/Bitmap-99ee7f2b.js","assets/WGLContainer-22e7c87b.js","assets/definitions-19bfb61c.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/alignmentUtils-ae955d28.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/Container-0639ee3d.js","assets/TileContainer-c1add888.js","assets/LayerView2D-52985332.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"])),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function Qpt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new J(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const Cde={hasLayerViewModule:t=>b(Ede[t.type]),importLayerView:t=>{const e=Ede[t.type];if(A(e))throw Qpt(t);return e(t)}};function eft(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let s=Number.POSITIVE_INFINITY,n=0,o=0;const a=[0,0],l=t.type==="extent"?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const c of l)for(let h=0;h<c.length-1;h++){ZYe(a,r,c,h);const d=Gp(r,a);d<s&&(s=d,n=a[0],o=a[1])}return{coordinate:new st({x:n,y:o,spatialReference:i}),distance:s}}var IZ;let FT=IZ=class extends cte(Ee){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(A(this.geometry)||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return bd(this.geometry,this.spatialReference)}catch(t){return le.getLogger(this.declaredClass).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(A(this.normalizedGeometry))return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?Nk(this.normalizedGeometry,i):ywe(this.normalizedGeometry,i))return t;const{coordinate:r}=eft(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){var t,e;return new IZ({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};u([p({constructOnly:!0})],FT.prototype,"geometry",void 0),u([p({readOnly:!0})],FT.prototype,"normalizedGeometry",null),u([p({constructOnly:!0})],FT.prototype,"spatialReference",void 0),FT=IZ=u([N("esri.views.2d.constraints.GeometryConstraint")],FT);var $Z;let PP=$Z=class extends cte(Ee){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new $Z({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([p()],PP.prototype,"enabled",void 0),u([p()],PP.prototype,"rotationEnabled",void 0),PP=$Z=u([N("esri.views.2d.constraints.RotationConstraint")],PP);const l3e=PP;var LZ;let $u=LZ=class extends cte(Ee){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!e||!e.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(h=>h.clone()),e.sort((h,d)=>d.scale-h.scale),e.forEach((h,d)=>h.level=d);for(const h of e)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=t?t.level:-1,c=!0),t=h;s===-1&&(s=i===0?0:o),n===-1&&(n=r===0?e.length-1:a),s=Math.max(s,0),s=Math.min(s,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),s>n&&([s,n]=[n,s]),i=e[s].scale,r=e[n].scale,e.splice(0,s),e.splice(n-s+1,e.length),e.forEach((h,d)=>{this._lodByScale[h.scale]=h,this._scales[d]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=t.targetGeometry,n=e&&e.targetGeometry,o=r!==0&&t.scale<r,a=i!==0&&t.scale>i;if(o||a){const l=a?i:r;if(e&&n){const c=(l-e.scale)/(t.scale-e.scale);s.x=n.x+(s.x-n.x)*c,s.y=n.y+(s.y-n.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.round(t-.5),r=Math.round(t);return e[r]+(r-t)*(e[i]-e[r])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(i=e[s],r=e[s+1],r===t)return s+this.effectiveMinZoom+1;if(i>t&&r<t)return s+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new LZ({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};u([p({readOnly:!0})],$u.prototype,"effectiveLODs",void 0),u([p({readOnly:!0})],$u.prototype,"effectiveMinZoom",void 0),u([p({readOnly:!0})],$u.prototype,"effectiveMaxZoom",void 0),u([p({readOnly:!0})],$u.prototype,"effectiveMinScale",void 0),u([p({readOnly:!0})],$u.prototype,"effectiveMaxScale",void 0),u([p()],$u.prototype,"lods",void 0),u([p()],$u.prototype,"minZoom",void 0),u([p()],$u.prototype,"maxZoom",void 0),u([p()],$u.prototype,"minScale",void 0),u([p()],$u.prototype,"maxScale",void 0),u([p()],$u.prototype,"snapToZoom",void 0),$u=LZ=u([N("esri.views.2d.constraints.ZoomConstraint")],$u);const c3e=$u,tft={base:null,key:"type",typeMap:{extent:ti,polygon:kl}};let ao=class extends Ee{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,i,r;return`${(e=this._zoom)==null?void 0:e.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(r=this._geometry)==null?void 0:r.uid}`}get _defaultLODs(){var r,s,n;const e=(s=(r=this.view)==null?void 0:r.defaultsFromMap)==null?void 0:s.tileInfo,i=(n=this.view)==null?void 0:n.spatialReference;return e&&i&&e.spatialReference.equals(i)?e.lods:null}get _geometry(){var e;return new FT({geometry:this.geometry,spatialReference:(e=this.view)==null?void 0:e.spatialReference})}get _rotation(){return new l3e({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),i=this.lods||this._defaultLODs,r=this.minZoom,s=this.maxZoom,n=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===s&&e.minScale===n&&e.maxScale===o&&e.snapToZoom===a?e:new c3e({lods:i,minZoom:r,maxZoom:s,minScale:n,maxScale:o,snapToZoom:a})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([p({readOnly:!0})],ao.prototype,"effectiveLODs",null),u([p({readOnly:!0})],ao.prototype,"effectiveMinScale",null),u([p({readOnly:!0})],ao.prototype,"effectiveMaxScale",null),u([p({readOnly:!0})],ao.prototype,"effectiveMinZoom",null),u([p({readOnly:!0})],ao.prototype,"effectiveMaxZoom",null),u([p({types:tft,value:null})],ao.prototype,"geometry",null),u([p({type:[Or]})],ao.prototype,"lods",void 0),u([p()],ao.prototype,"minScale",void 0),u([p()],ao.prototype,"maxScale",void 0),u([p()],ao.prototype,"minZoom",void 0),u([p()],ao.prototype,"maxZoom",void 0),u([p()],ao.prototype,"rotationEnabled",void 0),u([p()],ao.prototype,"snapToZoom",void 0),u([p()],ao.prototype,"view",void 0),u([p({readOnly:!0})],ao.prototype,"version",null),u([p()],ao.prototype,"_defaultLODs",null),u([p({type:FT})],ao.prototype,"_geometry",null),u([p({type:l3e})],ao.prototype,"_rotation",null),u([p({readOnly:!0,type:c3e})],ao.prototype,"_zoom",null),ao=u([N("esri.views.2d.MapViewConstraints")],ao);const u3e=ao;function jp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ift(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function dre(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function pre(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Hp(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function AS(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let g=i*d+r*f+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-h*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=f*g,t[4]=(h*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function rft(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-r*h,t[2]=r*a-s*o,t[3]=a*l-n*h,t[4]=i*h-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function sft(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function YA(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1],g=i[2],y=i[3],v=i[4],x=i[5],S=i[6],E=i[7],C=i[8];return t[0]=f*r+m*o+g*c,t[1]=f*s+m*a+g*h,t[2]=f*n+m*l+g*d,t[3]=y*r+v*o+x*c,t[4]=y*s+v*a+x*h,t[5]=y*n+v*l+x*d,t[6]=S*r+E*o+C*c,t[7]=S*s+E*a+C*h,t[8]=S*n+E*l+C*d,t}function s9(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+d,t}function fre(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=d,t}function mre(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function nft(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function oft(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function aft(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function lft(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function cft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function gre(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,x=n*l;return t[0]=1-d-g,t[3]=h-x,t[6]=f+v,t[1]=h+x,t[4]=1-c-g,t[7]=m-y,t[2]=f-v,t[5]=m+y,t[8]=1-c-d,t}function h3e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,g=i*d+r*f+s*m;if(!g)return null;const y=1/g;return t[0]=d*y,t[1]=(-h*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=f*y,t[4]=(h*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t}function XA(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],x=e[15],S=i*a-r*o,E=i*l-s*o,C=i*c-n*o,R=r*l-s*a,O=r*c-n*a,U=s*c-n*l,L=h*y-d*g,B=h*v-f*g,G=h*x-m*g,j=d*v-f*y,q=d*x-m*y,ie=f*x-m*v;let ee=S*ie-E*q+C*j+R*G-O*B+U*L;return ee?(ee=1/ee,t[0]=(a*ie-l*q+c*j)*ee,t[1]=(l*G-o*ie-c*B)*ee,t[2]=(o*q-a*G+c*L)*ee,t[3]=(s*q-r*ie-n*j)*ee,t[4]=(i*ie-s*G+n*B)*ee,t[5]=(r*G-i*q-n*L)*ee,t[6]=(y*U-v*O+x*R)*ee,t[7]=(v*C-g*U-x*E)*ee,t[8]=(g*O-y*C+x*S)*ee,t):null}function uft(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function hft(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function dft(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function pft(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function d3e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function fft(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function mft(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function gft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function yft(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],g=e[3],y=e[4],v=e[5],x=e[6],S=e[7],E=e[8],C=ul();return Math.abs(i-d)<=C*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=C*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=C*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=C*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=C*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=C*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-x)<=C*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-S)<=C*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-E)<=C*Math.max(1,Math.abs(h),Math.abs(E))}function yre(t){const e=ul(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const _ft=YA,vft=d3e;Object.freeze(Object.defineProperty({__proto__:null,add:pft,adjoint:rft,copy:ift,determinant:sft,equals:yft,exactEquals:gft,frob:dft,fromMat2d:cft,fromMat4:jp,fromQuat:gre,fromRotation:aft,fromScaling:lft,fromTranslation:oft,identity:pre,invert:AS,isOrthoNormal:yre,mul:_ft,multiply:YA,multiplyScalar:fft,multiplyScalarAndAdd:mft,normalFromMat4:XA,normalFromMat4Legacy:h3e,projection:uft,rotate:fre,scale:mre,scaleByVec2:nft,set:dre,str:hft,sub:vft,subtract:d3e,translate:s9,transpose:Hp},Symbol.toStringTag,{value:"Module"}));function cu(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function p3e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function D6(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function bft(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:p3e,create:cu,createView:bft,fromValues:D6},Symbol.toStringTag,{value:"Module"}));function _re(){return new Float32Array(2)}function wft(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function yp(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function xft(t,e){return new Float32Array(t,e,2)}function f3e(){return _re()}function m3e(){return yp(1,1)}function g3e(){return yp(1,0)}function y3e(){return yp(0,1)}const _3e=f3e(),v3e=m3e(),Tft=g3e(),Sft=y3e();Object.freeze(Object.defineProperty({__proto__:null,ONES:v3e,UNIT_X:Tft,UNIT_Y:Sft,ZEROS:_3e,clone:wft,create:_re,createView:xft,fromValues:yp,ones:m3e,unitX:g3e,unitY:y3e,zeros:f3e},Symbol.toStringTag,{value:"Module"}));function Eft(t){return t instanceof Float32Array&&t.length>=2}function Cft(t){return Array.isArray(t)&&t.length>=2}function sG(t){return Eft(t)||Cft(t)}var DZ;const t0=[0,0];let P1=DZ=class extends Ae{constructor(t){super(t),this._viewpoint2D={center:je(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ti,this.id=0,this.inverseTransform=Rb(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Rb(),this.transformNoRotation=Rb(),this.displayMat3=cu(),this.displayViewMat3=cu(),this.viewMat3=cu(),this.viewMat2d=pAe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Nm(i,t.viewpoint),this._set("size",Ao(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new DZ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return sG(e)?qg(t,e,this.inverseTransform):(t0[0]=e,t0[1]=i,qg(t,t0,this.inverseTransform))}toScreen(t,e,i){return sG(e)?qg(t,e,this.transform):(t0[0]=e,t0[1]=i,qg(t,t0,this.transform))}toScreenNoRotation(t,e,i){return sG(e)?qg(t,e,this.transformNoRotation):(t0[0]=e,t0[1]=i,qg(t,t0,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return ure(t,i,s,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new ya({targetGeometry:new st(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!e||!i)return;this.resolution=H3(o),this.rotation=r,this.scale=i,this.spatialReference=e,Ao(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;dre(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=pre(this.viewMat3),h=yp(n[0]/2,n[1]/2),d=yp(-n[0]/2,-n[1]/2),f=Fk(r);s9(c,c,h),fre(c,c,f),s9(c,c,d),YA(this.displayViewMat3,this.displayMat3,c);const m=sre(this.viewMat2d,h);return zV(m,m,f),G$(m,m,d),Dpt(this.extent,o,n),hre(this.transform,o,n,s),ire(this.inverseTransform,this.transform),Bpt(this.transformNoRotation,o,n,s),this.worldScreenWidth=jpt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([p({readOnly:!0})],P1.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],P1.prototype,"pixelRatio",null),u([p({json:{write:!0}})],P1.prototype,"size",null),u([p()],P1.prototype,"spatialReference",void 0),u([p({type:ya,json:{write:!0}})],P1.prototype,"viewpoint",null),P1=DZ=u([N("esri.views.2d.ViewState")],P1);const NZ=P1;var FZ,UZ;let i_=FZ=class extends Ee{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new FZ({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([p()],i_.prototype,"left",void 0),u([p()],i_.prototype,"top",void 0),u([p()],i_.prototype,"right",void 0),u([p()],i_.prototype,"bottom",void 0),i_=FZ=u([N("esri.views.2d.PaddedViewState.Padding")],i_);let FC=UZ=class extends NZ{constructor(...t){super(...t),this.paddedViewState=new NZ,this._updateContent=(()=>{const e=je();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;Vt(e,r.left+r.right,r.top+r.bottom),Bs(e,i,e),Ao(s.size,e);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(ae(()=>[this.size,this.padding],()=>this._updateContent(),Mi)),this.padding=new i_,this.size=[0,0]}set padding(t){this._set("padding",t||new i_)}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,qpt(e,t,this._get("size"),this._get("padding"));const i=this._viewpoint2D,r=e.targetGeometry;i.center[0]=r.x,i.center[1]=r.y,i.rotation=e.rotation,i.scale=e.scale,i.spatialReference=r.spatialReference,this._update()}}clone(){return new UZ({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([p()],FC.prototype,"paddedViewState",void 0),u([p({type:i_})],FC.prototype,"padding",null),u([p()],FC.prototype,"viewpoint",null),FC=UZ=u([N("esri.views.2d.PaddedViewState")],FC);const Mft=FC;let Aft=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},b3e=class{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new wU(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&b(i)&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=ol(i,()=>s.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(er())},a=()=>{l.remove(),b(n)&&n.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=Ak(s.signal,o),c=N_();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=yS(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(A(e))return;let i;const r=new AbortController,s=new Aft(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}gh(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){return{update:e=>this.runTask(e)}}};function Oft(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const nG=new Set,rF=[],qS=new Map,Mde=[0,0];let Rv=class extends Ee{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i}=this;this._queue=new b3e({concurrency:e,process:(r,s)=>{const n=this._keyToItem.get(r);return i(n,{signal:s})},peeker:r=>r.values().next().value})}destroy(){this.clear(),this._queue=He(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e,i){const r=e.key.id+"-"+i;if(this.has(r))return this.get(r);const s=this._queue.push(r),n=()=>{this._keyToItem.delete(r),this.notifyChange("updating")};return this._keyToItem.set(r,e),s.then(n,n),this.notifyChange("updating"),s}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(h=>{const d=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(d.key);qS.has(f)||(qS.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),qS.get(f).push(d.key),nG.add(f)});let n=this.state.scale;qS.has(n)||(Oft(rF,nG),rF.sort((h,d)=>h-d),n=rF.reduce((h,d)=>Math.abs(d-n)<Math.abs(h-n)?d:h,rF[0])),n=Math.min(n,r),n=Math.max(n,s);const o=qS.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,d)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),nG.clear(),qS.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Mde,a.key);const l=Gp(Mde,r);l<n&&(n=l,s=a.key)}),s.id}};u([p({constructOnly:!0})],Rv.prototype,"concurrency",void 0),u([p({constructOnly:!0})],Rv.prototype,"process",void 0),u([p()],Rv.prototype,"state",void 0),u([p({constructOnly:!0})],Rv.prototype,"strategy",void 0),u([p({constructOnly:!0})],Rv.prototype,"tileInfoView",void 0),u([p({readOnly:!0})],Rv.prototype,"updating",null),Rv=u([N("esri.views.2d.tiling.PagedTileQueue")],Rv);let rw=class tT{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new tT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new tT(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new tT(e,i,r,s),new tT(e,i,r+1,s),new tT(e,i+1,r,s),new tT(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};rw.pool=new pa(rw,null,null,25,50);function Pv(t,e){return[t,e]}function Fw(t,e,i){return t[0]=e,t[1]=i,t}function Rft(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const cf=new rw("0/0/0/0");let Pft=class w3e{static create(e,i,r=null){const s=dd(e.spatialReference),n=i.origin||Pv(e.origin.x,e.origin.y),o=Pv(e.size[0]*i.resolution,e.size[1]*i.resolution),a=Pv(-1/0,-1/0),l=Pv(1/0,1/0),c=Pv(1/0,1/0);b(r)&&(Fw(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),Fw(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),Fw(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:d}=i;let f,m,g,y;return!r&&h&&d&&(Fw(a,h[0],d[0]),Fw(l,h[1],d[1]),Fw(c,h[1]-h[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=Pv(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=Pv(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=Pv(f[0]+m[0]-1,l[1]),y=!0):(m=a,g=l,f=c,y=!1),new w3e(i.level,i.resolution,i.scale,n,a,l,c,o,m,g,f,y)}constructor(e,i,r,s,n,o,a,l,c,h,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=h,this.worldSize=d,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){cf.set(i);const s=r?cf.col:this.denormalizeCol(cf.col,cf.world),n=cf.row;return Rft(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){cf.set(i);const s=r?cf.col:this.denormalizeCol(cf.col,cf.world);return Array.isArray(e)?Fw(e,this.getXForColumn(s),this.getYForRow(cf.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(cf.row)),e}},ZA=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};ZA.pool=new pa(ZA);let oG=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Cn=new rw("0/0/0/0");let Ift=class x3e{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,h=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new x3e(r,Math.floor(s),Math.ceil(o),c,a<0?h:d,a<0?d:h,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const xh=[[0,0],[0,0],[0,0],[0,0]],$ft=1e-6;let Lft=class{constructor(e,i=null){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const r=e.lods.slice();r.sort((n,o)=>o.scale-n.scale);const s=this._lodInfos=r.map(n=>Pft.create(e,n,i));r.forEach((n,o)=>{this._infoByLevel[n.level]=s[o],this._infoByScale[n.scale]=s[o],this.scales[o]=n.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Cn.set(i);const s=this._infoByLevel[Cn.level];return s?s.getTileBounds(e,Cn,r):e}getTileCoords(e,i,r=!1){Cn.set(i);const s=this._infoByLevel[Cn.level];return s?s.getTileCoords(e,Cn,r):e}getTileCoverage(e,i=192,r="closest"){const s=r==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),n=ZA.pool.acquire(s),o=this._wrap;let a,l,c,h=1/0,d=-1/0;const f=n.spans;xh[0][0]=xh[0][1]=xh[1][1]=xh[3][0]=-i,xh[1][0]=xh[2][0]=e.size[0]+i,xh[2][1]=xh[3][1]=e.size[1]+i;for(const v of xh)e.toMap(v,v),v[0]=s.getColumnForX(v[0]),v[1]=s.getRowForY(v[1]);const m=[];let g=3;for(let v=0;v<4;v++){if(xh[v][1]===xh[g][1]){g=v;continue}const x=Ift.create(xh[v],xh[g]);h=Math.min(x.ymin,h),d=Math.max(x.ymax,d),m[x.ymin]===void 0&&(m[x.ymin]=[]),m[x.ymin].push(x),g=v}if(h==null||d==null||d-h>100)return null;let y=[];for(a=h;a<d;){m[a]!=null&&(y=y.concat(m[a])),l=1/0,c=-1/0;for(let v=y.length-1;v>=0;v--){const x=y[v];l=Math.min(l,x.getLeftCol()),c=Math.max(c,x.getRightCol())}if(l=Math.floor(l),c=Math.floor(c),a>=s.first[1]&&a<=s.last[1])if(o)if(s.size[0]<s.worldSize[0]){const v=Math.floor(c/s.worldSize[0]);for(let x=Math.floor(l/s.worldSize[0]);x<=v;x++)f.push(new oG(a,Math.max(s.getFirstColumnForWorld(x),l),Math.min(s.getLastColumnForWorld(x),c)))}else f.push(new oG(a,l,c));else l>s.last[0]||c<s.first[0]||(l=Math.max(l,s.first[0]),c=Math.min(c,s.last[0]),f.push(new oG(a,l,c)));a+=1;for(let v=y.length-1;v>=0;v--){const x=y[v];x.ymax>=a?x.incrRow():y.splice(v,1)}}return n}getTileParentId(e){Cn.set(e);const i=this._infoByLevel[Cn.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Cn,this._lodInfos[r],Cn),Cn.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Cn.set(i);const r=this._infoByLevel[Cn.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Cn,s,Cn);const o=s.denormalizeCol(Cn.col,Cn.world);for(const a of e.spans)if(a.row===Cn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Cn.col,Cn.world),d=s.getColumnForX(r.getXForColumn(h)),f=s.getRowForY(r.getYForRow(Cn.row)),m=s.getColumnForX(r.getXForColumn(h+1))-1,g=s.getRowForY(r.getYForRow(Cn.row+1))-1;return!(d>c||m<l||f>a||g<o)}const n=s.denormalizeCol(Cn.col,Cn.world);return e.spans.some(o=>o.row===Cn.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=dd(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+$ft)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}};function Dft(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const aG=new Set,sF=[],WS=new Map,Ade=[0,0];let N0=class extends Ee{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new b3e({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=He(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,e),r.then(s,s),this.notifyChange("updating"),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(h=>{const d=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(d.key);WS.has(f)||(WS.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),WS.get(f).push(d.key),aG.add(f)});let n=this.state.scale;WS.has(n)||(Dft(sF,aG),sF.sort((h,d)=>h-d),n=sF.reduce((h,d)=>Math.abs(d-n)<Math.abs(h-n)?d:h,sF[0])),n=Math.min(n,r),n=Math.max(n,s);const o=WS.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,d)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),aG.clear(),WS.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Ade,a.key);const l=Gp(Ade,r);l<n&&(n=l,s=a.key)}),s.id}};u([p({constructOnly:!0})],N0.prototype,"concurrency",void 0),u([p({constructOnly:!0})],N0.prototype,"process",void 0),u([p()],N0.prototype,"state",void 0),u([p({constructOnly:!0})],N0.prototype,"strategy",void 0),u([p({constructOnly:!0})],N0.prototype,"tileInfoView",void 0),u([p({readOnly:!0})],N0.prototype,"updating",null),N0=u([N("esri.views.2d.tiling.TileQueue")],N0);const DWt=N0;let Nft=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];Ode(this._tilePerId,e);for(let n=0;n<s.length;n++)if(s[n].id===e){s.splice(n,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(e,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&n>=0;)n!==e&&(s=this._pruneAroundCenterTile(s,i,r,n)),n--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,e))}_pruneAroundCenterTile(e,i,r,s){const n=this._tileKeysPerLevel[s];if(!n||n.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],h=[0,0],d=[0,0];for(n.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),d[0]=a.x+l*(m.col+.5),d[1]=a.y-c*(m.row+.5),wd(h,i)-wd(d,i)));n.length>0;){const f=n.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),Ode(this._tilePerId,e)}};function Ode(t,e){t.delete(e)}const Uw=new rw(0,0,0,0),Pd=new Map,YS=[],nF=[];let FWt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=e.resampling==null||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new Nft(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:r}=this,s=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(nF.length=0,YS.length=0,Pd.clear(),!s)return;const{minScale:n,maxScale:o}=this.tileInfoView.tileInfo,{spans:a,lodInfo:l}=s,{level:c}=l,{scale:h,center:d,resolution:f}=e.state,m=!e.stationary&&h>this._previousScale;if(this._previousScale=h,this.tiles.length=0,!i&&(h>n||h<o))return this.tiles.length=0,Pd.clear(),r.forEach(x=>{this.releaseTile(x)}),r.clear(),nF.length=0,YS.length=0,Pd.clear(),ZA.pool.release(s),!0;r.forEach(x=>x.visible=!0);let g=0,y=0;if(a.length>0)for(const{row:x,colFrom:S,colTo:E}of a)for(let C=S;C<=E;C++){g++;const R=Uw.set(c,x,l.normalizeCol(C),l.getWorldForColumn(C)).id;if(r.has(R)){const O=r.get(R);O.isReady?(Pd.set(R,O),y++):m||this._addParentTile(R,Pd)}else{let O;if(this._tileCache&&this._tileCache.has(R)){if(O=this._tileCache.pop(R),this.tileIndex.set(R,O),O.isReady){Pd.set(R,O),y++;continue}}else O=this.acquireTile(Uw),this.tileIndex.set(R,O);m||this._addParentTile(R,Pd)}}const v=y===g;r.forEach((x,S)=>{if(Uw.set(S),Pd.has(S))return;const E=this.tileInfoView.intersects(s,Uw),C=this.cachePolicy==="purge"?Uw.level!==c:Uw.level>c;!E||!m&&v?!C&&E||YS.push(S):x.isReady?C&&this.cachePolicy==="purge"&&this._hasReadyAncestor(Uw,c)?YS.push(S):nF.push(S):C&&YS.push(S)});for(const x of nF){const S=r.get(x);S&&S.isReady&&Pd.set(x,S)}for(const x of YS){const S=r.get(x);this._tileCache?this._tileCache.add(S):this.releaseTile(S),r.delete(x)}return Pd.forEach(x=>this.tiles.push(x)),r.forEach(x=>{Pd.has(x.key.id)||(x.visible=!1)}),this._tileCache&&this._tileCache.prune(c,d,f),ZA.pool.release(s),Pd.clear(),v}clear(e=!0){const{tileIndex:i}=this;e&&i.forEach(r=>{this.releaseTile(r)}),i.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s&&s.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache&&this._tileCache.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s&&s.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(e,i){const r=bi();this.tileInfoView.getTileBounds(r,e,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<e.level){const n=bi();if(this.tileInfoView.getTileBounds(n,s.key,!0),FW(n,r))return!0}return!1}};function HV(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function vre(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Rde=class extends Is{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){HV(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Fft=class extends Is{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:s,delta:n}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(s){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=n,a.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const l=1.015**n.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const d=l.snapScale(this._currentScale),f=(n.y>0?Math.max(d,l.snapToPreviousScale(this._startScale)):Math.min(d,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f);break}}}},wD=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Uft=class extends Is{constructor(e,i,r){super(!0),this.view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new wD({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&HV(r.data,this.pointerAction)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},kft=class extends Is{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new wD({start:(n,o)=>{s.rotate.begin(this._view,o.data),o.stopPropagation()},update:(n,o)=>{s.rotate.update(this._view,o.data),o.stopPropagation()},end:(n,o)=>{s.rotate.end(),o.stopPropagation()},condition:(n,o)=>n===1&&HV(o.data,this.pointerAction)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}};function uf(t){let e=t*t;return t<0&&(e*=-1),e}function Vft(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function kZ(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=uf(s.axes[0]),r.translation[1]=uf(s.axes[1]),r.translation[2]=uf(s.buttons[7])-uf(s.buttons[6]),r.heading=uf(s.axes[2]),r.tilt=uf(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*uf(s.axes[0]),r.translation[1]=1.2*uf(s.axes[1]),r.translation[2]=2*-uf(s.axes[2]),r.heading=1.2*uf(s.axes[5]),r.tilt=1.2*uf(s.axes[3])),r.tilt*=o,pe(r.translation,r.translation,a),r}function Pde(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function N6(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let zft=class extends Is{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new ir,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ae(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=F_({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},ii)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Vft(this._transformation)):(this._currentDevice=e.data.device,kZ(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const i=this._transformation;if(N6(i))return;const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=Gft*s*e;jV(r,r,[i.translation[0]*n,-i.translation[1]*n]);const o=1+i.translation[2]*jft*e,a=this._view.constraints.rotationEnabled?-i.heading*Bft*e:0,l=this._view.size,c=[l[0]/2,l[1]];n3e(r,r,o,a,c,l);const h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}};const Bft=.06,Gft=.7,jft=6e-4;let Hft=class extends Is{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=this._keyMap[e.data.key];if(this._pressed=r!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),r){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},qft=class extends Is{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[e.data.key];if(this._pressed=s!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var wM;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(wM||(wM={}));let Wft=class extends Is{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=wM.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=wM.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view;let o=null;switch(s){case wM.IN:o=n.zoomIn();break;case wM.OUT:o=n.zoomOut();break;default:return}n.begin(),o.then(()=>n.end()),e.stopPropagation()}};const Yft=.6;let Xft=class extends Is{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=e.data,o=1/Yft**(1/60*n),a=i.zoom(o,[r,s]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},Zft=class extends Is{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new wD({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function Ide(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:e.axes.map(i=>Qft(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Jft(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Kft(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Qft(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let emt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Ide(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new ore(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=F_({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Ide(n),l=r||Kft(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Jft(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&e(s)}}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const $de=me("edge"),tmt=me("chrome"),imt=me("ff"),rmt=me("safari"),Lde="esri-view-surface",XS={touchNone:`${Lde}--touch-none`,touchPan:`${Lde}--touch-pan`};let bre=class T3e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new emt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=He(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(lG[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&lG[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(lG[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?XS.touchNone:XS.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?XS.touchPan:XS.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(XS.touchNone),this._element.classList.remove(XS.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=PAe(this._element,e);return T3e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=ydt(i);r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:$de&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}$de?r*=.7:tmt||rmt?r*=.6:imt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};bre.test={disableSubpixelCoordinates:!1};const lG={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let S3e=class extends Is{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function wre(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function smt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function nmt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:xo()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[E,C]=t,[R,O]=[C.x-E.x,C.y-E.y];return e.radius=Math.sqrt(R*R+O*O)/2,e.center.x=(E.x+C.x)/2,e.center.y=(E.y+C.y)/2,e}let i=0,r=0;for(let E=0;E<t.length;E++)i+=t[E].x,r+=t[E].y;i/=t.length,r/=t.length;const s=t.map(E=>E.x-i),n=t.map(E=>E.y-r);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let E=0;E<s.length;E++){const C=s[E],R=n[E],O=C*C,U=R*R;o+=O,a+=U,l+=C*R,c+=O*C,h+=U*R,d+=C*U,f+=R*O}const m=.5*(c+d),g=.5*(h+f),y=o*a-l*l,v=(m*a-g*l)/y,x=(o*g-l*m)/y,S=xo(v+i,x+r);return{radius:Math.sqrt(v*v+x*x+(o+a)/t.length),center:S}}function v2(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}const Mp={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let E3e=class extends Is{constructor(e=Mp.maximumDoubleClickDelay,i=Mp.maximumDoubleClickDistance,r=Mp.maximumDoubleTouchDelay,s=Mp.maximumDoubleTouchDistance,n=VL){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=is(e.doubleClickTimer))}get hasPendingInputs(){return ua(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=is(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:s}=e.native;return r==="mouse"?`${i}:${s}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=this._getPointerId(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;wre(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=v2(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=v2(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},omt=class extends Is{constructor(e=Mp.maximumDoubleClickDelay,i=Mp.maximumDoubleClickDistance,r=Mp.maximumDoubleTouchDelay,s=Mp.maximumDoubleTouchDistance,n=VL){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=xo(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new wD({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=is(e.doubleTapTimeout)})}get hasPendingInputs(){return ua(this._pointerState,e=>e.doubleTapTimeout!=null)}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=is(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,i,r){const{button:s,buttons:n,pointer:o,pointers:a,pointerType:l,timestamp:c}=r;return{action:e,delta:i,button:s,buttons:n,pointer:o,pointers:a,pointerType:l,timestamp:c}}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;const o=this._createDoubleTapDragData("begin",xo(0,0),r);this._doubleTapDrag.emit(o,void 0,s),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=xo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",n,i);this._doubleTapDrag.emit(o,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=xo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",n,i);this._doubleTapDrag.emit(o,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=v2(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){const o=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),wre(s.event.data,i)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,s=v2(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}},C3e=class extends Is{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:amt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=oF(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=F6(s,M3e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=oF(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=oF(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=F6(r,i)-e,r.lastAngle=F6(r,i)-e})}_emitEvent(e,i,r){const s=oF(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function M3e(t){const e=[];return t.forEach(i=>{e.push(xo(i.event.x,i.event.y))}),nmt(e)}function oF(t){const e=M3e(t);let i=0;return t.forEach(r=>{let s=F6(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function amt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function F6(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var Dde;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Dde||(Dde={}));let A3e=class extends Is{constructor(e=Mp.maximumDoubleClickDelay,i=Mp.maximumDoubleClickDistance,r=Mp.maximumDoubleTouchDelay,s=Mp.maximumDoubleTouchDistance,n=VL){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=v2(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=v2(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;wre(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=v2(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const zO={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let O3e=class extends Is{constructor(e=zO.maximumClickDelay,i=zO.movementUntilMouseDrag,r=zO.movementUntilPenDrag,s=zO.movementUntilTouchDrag,n=zO.holdDelay,o=VL){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=is(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):smt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};const aF={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let iT=class extends Ee{constructor(){super(...arguments),this._handles=new ir}initialize(){const e=()=>{var i;return(i=this.view)==null?void 0:i.ready};this._handles.add([wa(()=>!e(),()=>this._disconnect()),wa(e,()=>this._connect())])}destroy(){this._handles=He(this._handles),this._disconnect()}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=He(this._inputManager)}_connect(){const e=this.view.surface,i=new bre(e,this.view.input),r=[new A3e,new O3e,new E3e,new C3e(this.view.navigation),new omt],s=new zf({eventSource:i,recognizers:r});s.installHandlers("prevent-context-menu",[new S3e],Es.INTERNAL),s.installHandlers("navigation",[new Zft(this.view),new zft(this.view),new Xft(this.view),new Rde(this.view),new Rde(this.view,[aF.counter]),new Uft(this.view,"primary"),new Hft(this.view,aF.pan),new Wft(this.view,aF.zoom),new qft(this.view,aF.rotate),new kft(this.view,"secondary"),new Fft(this.view,"touch")],Es.INTERNAL),this.view.viewEvents.connect(s),this._source=i,this._inputManager=s,ae(()=>{var n,o;return(o=(n=this.view)==null?void 0:n.navigation)==null?void 0:o.browserTouchPanEnabled},n=>{this._source&&(this._source.browserTouchPanningEnabled=!n)},ii)}get test(){return{inputManager:this._inputManager}}};u([p()],iT.prototype,"view",void 0),u([p()],iT.prototype,"latestPointerType",null),u([p()],iT.prototype,"latestPointerLocation",null),u([p()],iT.prototype,"multiTouchActive",null),iT=u([N("esri.views.2d.input.MapViewInputManager")],iT);const lmt=iT;var Nde,Fde,Ude,VZ={},cmt={get exports(){return VZ},set exports(t){VZ=t}};Nde=cmt,Fde=function(){function t(s,n,o,a,l){e(s,n,o||0,a||s.length-1,l||r)}function e(s,n,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,h=n-o+1,d=Math.log(c),f=.5*Math.exp(2*d/3),m=.5*Math.sqrt(d*f*(c-f)/c)*(h-c/2<0?-1:1);e(s,n,Math.max(o,Math.floor(n-h*f/c+m)),Math.min(a,Math.floor(n+(c-h)*f/c+m)),l)}var g=s[n],y=o,v=a;for(i(s,o,n),l(s[a],g)>0&&i(s,o,a);y<v;){for(i(s,y,v),y++,v--;l(s[y],g)<0;)y++;for(;l(s[v],g)>0;)v--}l(s[o],g)===0?i(s,o,v):i(s,++v,a),v<=n&&(o=v+1),n<=v&&(a=v-1)}}function i(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return t},(Ude=Fde())!==void 0&&(Nde.exports=Ude);const umt=VZ;function n9(t,e){if(!(this instanceof n9))return new n9(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function hmt(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function ZS(t,e){IP(t,0,t.children.length,e,t)}function IP(t,e,i,r,s){s||(s=UC(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,o=e;o<i;o++)n=t.children[o],$P(s,t.leaf?r(n):n);return s}function $P(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function kde(t,e){return t.minX-e.minX}function Vde(t,e){return t.minY-e.minY}function cG(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function lF(t){return t.maxX-t.minX+(t.maxY-t.minY)}function dmt(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function pmt(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function uG(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function cF(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function UC(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function zde(t,e,i,r,s){for(var n,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(n=e+Math.ceil((i-e)/r/2)*r,umt(t,n,e,i,s),o.push(e,n,n,i))}n9.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!cF(t,e))return i;for(var s,n,o,a,l=[];e;){for(s=0,n=e.children.length;s<n;s++)o=e.children[s],cF(t,a=e.leaf?r(o):o)&&(e.leaf?i.push(o):uG(t,a)?this._all(o,i):l.push(o));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!cF(t,e))return!1;for(var r,s,n,o,a=[];e;){for(r=0,s=e.children.length;r<s;r++)if(n=e.children[r],cF(t,o=e.leaf?i(n):n)){if(e.leaf||uG(t,o))return!0;a.push(n)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=UC([]),this},remove:function(t,e){if(!t)return this;for(var i,r,s,n,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),n=!0),o.leaf&&(s=hmt(t,o.children,e))!==-1)return o.children.splice(s,1),l.push(o),this._condense(l),this;n||o.leaf||!uG(o,a)?r?(i++,o=r.children[i],n=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:kde,compareMinY:Vde,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,n=i-e+1,o=this._maxEntries;if(n<=o)return ZS(s=UC(t.slice(e,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),(s=UC([])).leaf=!1,s.height=r;var a,l,c,h,d=Math.ceil(n/o),f=d*Math.ceil(Math.sqrt(o));for(zde(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(zde(t,a,c=Math.min(a+f-1,i),d,this.compareMinY),l=a;l<=c;l+=d)h=Math.min(l+d-1,c),s.children.push(this._build(t,l,h,r-1));return ZS(s,this.toBBox),s},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,c,h,d;r.push(e),!e.leaf&&r.length-1!==i;){for(h=d=1/0,s=0,n=e.children.length;s<n;s++)l=cG(o=e.children[s]),(c=dmt(t,o)-l)<d?(d=c,h=l<h?l:h,a=o):c===d&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),$P(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=UC(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,ZS(i,this.toBBox),ZS(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=UC([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ZS(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,c,h;for(l=c=1/0,r=e;r<=i-e;r++)o=pmt(s=IP(t,0,r,this.toBBox),n=IP(t,r,i,this.toBBox)),a=cG(s)+cG(n),o<l?(l=o,h=r,c=a<c?a:c):o===l&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:kde,s=t.leaf?this.compareMinY:Vde;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s,n,o=this.toBBox,a=IP(t,0,e,o),l=IP(t,i-e,i,o),c=lF(a)+lF(l);for(s=e;s<i-e;s++)n=t.children[s],$P(a,t.leaf?o(n):n),c+=lF(a);for(s=i-e-1;s>=e;s--)n=t.children[s],$P(l,t.leaf?o(n):n),c+=lF(l);return c},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)$P(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():ZS(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};let Bde=class R3e{constructor(e,i){this.key=new rw(0,0,0,0),this.bounds=bi(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level}get id(){return this.key.id}get extent(){return ti.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const e=this.key.getChildKeys(),i=ru.acquire();for(let r=0;r<e.length;r++)i[r]=new R3e(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return fEe.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const kw={added:[],removed:[]},hG=new Set,fmt=new rw(0,0,0,0);let mmt=class extends ws{constructor(e){super(),this._tiles=new Map,this._index=n9(9,me("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const s=new Bde(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of e.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){const h=fmt.set(n,o,s.normalizeCol(c),s.getWorldForColumn(c)).id;if(hG.add(h),!this.has(h)){const d=new Bde(this.tileScheme,h);this._tiles.set(h,d),this._index.insert(d),this.tiles.push(d),kw.added.push(d)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];hG.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),kw.removed.push(a))}(kw.added.length||kw.removed.length)&&this.emit("update",kw),ZA.pool.release(i),hG.clear(),kw.added.length=0,kw.removed.length=0}},rT=class extends Ee{constructor(){super(...arguments),this.color=new et([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};u([p({type:et})],rT.prototype,"color",void 0),u([p({type:et})],rT.prototype,"haloColor",void 0),u([p()],rT.prototype,"haloOpacity",void 0),u([p()],rT.prototype,"fillOpacity",void 0),rT=u([N("esri.views.2d.support.HighlightOptions")],rT);const P3e=rT,gmt=t=>t.includes("Brush");let I3e=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),gmt(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function ymt(t,e,i,r,s,n,o,a){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let l=null;t.width!=null&&t.height!=null?l=[t.width,t.height]:t.width==null&&t.height!=null?l=[t.height,t.height]:t.width!=null&&t.height==null?l=[t.width,t.width]:t.width==null&&t.height==null&&(l=null);const c=i[0]-(r.left+r.right),h=i[1]-(r.top+r.bottom);let d,f,m=t.area||{x:0,y:0,width:c,height:h};if(l){const g=c/h,y=l[0]/l[1];if(y>g){const v=m.width/y;m={x:m.x,y:Math.round(m.y+(m.height-v)/2),width:m.width,height:Math.round(v)}}else{const v=m.height*y;m={x:Math.round(m.x+(m.width-v)/2),y:m.y,width:Math.round(v),height:m.height}}}else l=[m.width,m.height];return l[0]>m.width?(d=Math.min(l[0]/m.width,e),f=l[0]/m.width/d):(d=1,f=l[0]/m.width),{resolutionScale:d,cropArea:{x:Math.round((m.x+r.left)*d),y:Math.round((m.y+r.top)*d),width:Math.round(m.width*d),height:Math.round(m.height*d)},outputScale:f,format:s,quality:n,children:o,rotation:a}}let BO=null,o9=!0;function dG(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(o9)try{return new ImageData(t,e)}catch{o9=!1}return $3e(t,e,i)}function _mt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(o9)try{return new ImageData(t,e,i)}catch{o9=!1}const s=$3e(e,i,r);return s.data.set(t,0),s}function vmt(){return BO||(BO=document.createElement("canvas"),BO.width=1,BO.height=1),BO}function $3e(t,e,i){return i||(i=vmt()),i.getContext("2d").createImageData(t,e)}const Gde=2048,bmt=1.5,wmt=8;function xmt(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=xre(t,e.padding),a=Pmt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=Rmt(t,a),h=N3e(i),d=F3e[h];return{format:h,quality:Se(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function Tmt(t,e){const i=xmt(t,e),r=i.area,s=i.width/r.width,n=xre(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),d=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function U6(t,e,i){const{ctx:r,canvas:s}=L3e(t,i),n=r.getImageData(0,0,t.width,t.height),o=Emt(s,e);return D3e(s),{dataUrl:o,data:n}}function k6(t,e){const{ctx:i,canvas:r}=L3e(t,e),s=i.getImageData(0,0,t.width,t.height);return D3e(r),s}function L3e(t,e){const i=Smt();e.premultipliedAlpha&&Dmt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Lmt(r),{ctx:r,canvas:i}}function D3e(t){t.width=0,t.height=0}function Smt(){return A(pG)&&(pG=document.createElement("canvas")),pG}let pG=null;function Emt(t,e){const i=Nmt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function Cmt(t,e){const i=N3e(t),r=F3e[i];return{format:i,quality:Se(e??r,0,100)}}function Mmt(t,e){return e/Math.max(t[0],t[1])}function Amt(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=n/c,m=o/h,g=Math.ceil(f/2),y=Math.ceil(m/2),v=t.width;for(let x=0;x<h;x++)for(let S=0;S<c;S++){const E=4*(S+(a?h-x-1:x)*c);let C=0,R=0,O=0,U=0,L=0,B=0;const G=(x+.5)*m;for(let j=Math.floor(x*m);j<(x+1)*m;j++){const q=Math.abs(G-(j+.5))/y,ie=(S+.5)*f,ee=q*q;for(let K=Math.floor(S*f);K<(S+1)*f;K++){const Y=Math.abs(ie-(K+.5))/g,D=Math.sqrt(ee+Y*Y);if(D>=1)continue;let V=2*D*D*D-3*D*D+1;const k=4*(r+K+(s+j)*v);B+=V*l[k+3],R+=V,!i&&l[k+3]<255&&(V=V*l[k+3]/255),O+=V*l[k],U+=V*l[k+1],L+=V*l[k+2],C+=V}}d[E]=O/C,d[E+1]=U/C,d[E+2]=L/C,d[E+3]=B/R}return e}function Omt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=xre(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,d=s-c,f=Math.min(wmt,Math.min((Gde-l)/h,(Gde-c)/d));return f<bmt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function Rmt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Pmt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return Imt($mt(i,t),e)}function Imt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function $mt(t,e){if(!e||e.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function xre(t,e){return!e||t&&t.ignorePadding?Umt:e}function N3e(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Fmt}}function Lmt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Dmt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r+0]=e[r+0]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const Nmt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},jde=98,Fmt="png",F3e={png:100,jpg:jde,jpeg:jde},Umt={top:0,right:0,bottom:0,left:0};var Ft;function kmt(t,e,i={}){const r=U3e(t);for(;r.length>1;){const s=a9(e,r.shift(),i);if(b(s))return s}return Vmt(e,r.shift(),i)}function U3e(t){const e=me("esri-force-webgl");if(e===Ft.WEBGL1||e===Ft.WEBGL2)return[e];switch(t){case"2d":return me("mac")&&me("chrome")?[Ft.WEBGL1,Ft.WEBGL2]:[Ft.WEBGL2,Ft.WEBGL1];case"3d":return[Ft.WEBGL2,Ft.WEBGL1]}}function Vmt(t,e,i={}){if(!window.WebGLRenderingContext)return Hde(t,zmt),null;const r=a9(t,e,i);return A(r)&&Hde(t,Bmt),r}function a9(t,e,i={}){const r=e===Ft.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=t.getContext(n,i)}catch{}if(s)break}return s}function Hde(t,e){const i=t.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Ft||(Ft={}));const zmt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Bmt=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`;let fG,mG;function Gmt(t){const e=U3e(t);for(;e.length>1;){const i=qde(e.shift());if(i.available)return i}return qde(e.shift())}function qde(t){switch(t){case Ft.WEBGL1:return jmt();case Ft.WEBGL2:return Hmt()}}function jmt(){return fG||(fG=Ymt()),fG}function Hmt(){return mG||(mG=Xmt()),mG}let k3e=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},qmt=class extends k3e{constructor(){super(...arguments),this.type=Ft.WEBGL1}},Wmt=class extends k3e{constructor(){super(...arguments),this.type=Ft.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function V3e(t,e){var n;if(t===Ft.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Ft.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=a9(i,t,{failIfMajorPerformanceCaveat:!0});if(A(r)&&(r=a9(i,t),b(r)&&(e.majorPerformanceCaveat=!0)),A(r))return r;if(t===Ft.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),r}function Ymt(){const t=new qmt,e=V3e(Ft.WEBGL1,t);return A(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Xmt(){const t=new Wmt,e=V3e(Ft.WEBGL2,t);return A(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function z3e(t){const e=Gmt(t);if(!e.available)return new J("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new J("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new J("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new J("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Ft.WEBGL1){if(!e.supportsElementIndexUint)return new J("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new J("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new J("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Zmt(t){return t&&"nodeType"in t}function Jmt(t){return t&&typeof t.render=="function"}const Wde={component:"esri-component"};let sT=class extends Ee{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Wde.component),i&&i.classList.remove(Wde.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Zmt(e)?(this._set("widget",null),pV(e)):(Jmt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p({dependsOn:[]})],sT.prototype,"id",null),u([p()],sT.prototype,"node",null),u([pi("node")],sT.prototype,"castNode",null),u([p({readOnly:!0})],sT.prototype,"widget",void 0),sT=u([N("esri.views.ui.Component")],sT);const V6=sT,Kmt={left:0,top:0,bottom:0,right:0},B3e={bottom:30,top:15,right:15,left:15},gG="manual",i0="esri-ui",Ac={ui:i0,corner:`${i0}-corner`,innerContainer:`${i0}-inner-container`,manualContainer:`${i0}-manual-container`,cornerContainer:`${i0}-corner-container`,topLeft:`${i0}-top-left`,topRight:`${i0}-top-right`,bottomLeft:`${i0}-bottom-left`,bottomRight:`${i0}-bottom-right`};function Qmt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function yG(t){const e=t,i=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(i===null||i===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function _G(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let Mg=class extends ws.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=Rp(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&_G(i,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&_G(i,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ae(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,ii),ae(()=>this.padding,this._applyUIPadding,ii),ae(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},ii),xwe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(Ac.ui),Fit(e),this._attachContainers(e)),i&&(i.classList.remove(Ac.ui),_G(i,{top:"",bottom:"",left:"",right:""}),c2e(i)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.top+i.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...B3e,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.left+i.right;return Math.max(e-r,0)}add(e,i){let r,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,i));const n=yG(e);n&&({index:r,position:i,component:e,key:s}=n),i&&typeof i=="object"&&({index:r,key:s,position:i}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){const s=this._componentToKey;if(s.has(e)&&s.get(e)!==i)return;const n=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map(i=>this.empty(i)).reduce((i,r)=>i.concat(r)):(e=e||gG)===gG?Array.prototype.slice.call(this._manualContainer.children).filter(i=>!i.classList.contains(Ac.corner)).map(i=>this.remove(i)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=yG(e)||yG(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s){e instanceof V6||(e=new V6({node:e})),this._place({component:e,position:i,index:r}),this._components.push(e),s&&this._componentToKey.set(e,s)}_find(e){return e?e instanceof V6?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||Kmt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ac.innerContainer),e.classList.add(Ac.cornerContainer);const i=document.createElement("div");i.classList.add(Ac.innerContainer),i.classList.add(Ac.manualContainer);const r=document.createElement("div");r.classList.add(Ac.topLeft),r.classList.add(Ac.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Ac.topRight),s.classList.add(Ac.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Ac.bottomLeft),n.classList.add(Ac.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Ac.bottomRight),o.classList.add(Ac.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=ty();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.component,r=e.position||gG,s=e.index,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if(Qmt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.prototype.slice.call(n.children);if(s===0)return void(n.firstChild?nce(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):nce(i.node,a[s])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let i,r=null;return this._components.some(s=>(i=s===e,i&&(r=s),i)),r}_findById(e){let i,r=null;return this._components.some(s=>(i=s.id===e,i&&(r=s),i)),r}_findByNode(e){let i,r=null;return this._components.some(s=>(i=s.node===e,i&&(r=s),i)),r}};u([p()],Mg.prototype,"_locale",void 0),u([p()],Mg.prototype,"container",null),u([p()],Mg.prototype,"height",null),u([p({value:B3e})],Mg.prototype,"padding",null),u([pi("padding")],Mg.prototype,"castPadding",null),u([p()],Mg.prototype,"view",void 0),u([p()],Mg.prototype,"width",null),Mg=u([N("esri.views.ui.UI")],Mg);const egt=Mg;function Yde(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function tgt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function uF(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function igt(t){return t.type==="bing-maps"}const Iv=[];let kC=class extends Y2{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new xt,this.view=null,this._allLayerViewsChange=i=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(s=>ae(()=>{var n;return[s.suspended,(n=s.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),i&&i.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.handles.add([Gs(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),wa(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;Iv.length=0,e&&i?(i.forEach(r=>{var o;if(r.suspended||!((o=r.layer)!=null&&o.attributionVisible))return;const s=r.layer;if(Yde(s,"user"))return void uF(Iv,r,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(r)){const a=this._fetchedAttributionData.get(r);return void(a?uF(Iv,r,this._getDynamicAttribution(a,e,s)):Yde(s)&&uF(Iv,r,s.copyright))}return void this._fetchAttributionData(r)}const n=s.get("portalItem.accessInformation");uF(Iv,r,n||s.copyright)}),tgt(this.items,Iv)&&(this.items.removeAll(),this.items.addMany(Iv)),Iv.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Sm(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,igt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ye.WGS84},m={extent:hy(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=h;g<=d;g++)s[g]=s[g]||[],s[g].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var h;const{extent:s,scale:n}=i;let o=((h=r.tileInfo)==null?void 0:h.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=_S(s.center.clone().normalize(),i.spatialReference),c={};return a?a.filter(d=>{const f=d.id,m=!c[f]&&l&&d.extent&&Nk(d.extent,l);return m&&(c[f]=!0),m}).sort((d,f)=>f.score-d.score||d.objectId-f.objectId).map(d=>d.attribution).join(", "):""}};u([p({readOnly:!0,type:xt})],kC.prototype,"items",void 0),u([p({readOnly:!0})],kC.prototype,"state",null),u([p()],kC.prototype,"view",void 0),kC=u([N("esri.widgets.Attribution.AttributionViewModel")],kC);const G3e=kC,JS="esri-attribution",$v={base:`${JS} esri-widget`,poweredBy:`${JS}__powered-by`,sources:`${JS}__sources`,open:`${JS}--open`,sourcesOpen:`${JS}__sources--open`,link:`${JS}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let zc=class extends hl{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=$v.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new G3e}initialize(){this.addHandles(Gs(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[$v.open]:this._isOpen};return ce("div",{bind:this,class:this.classes($v.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ce("div",{class:$v.poweredBy},"Powered by"," ",ce("a",{class:$v.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?"0":"",{attributionText:s}=this,n={[$v.sourcesOpen]:e,[$v.interactive]:i};return ce("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes($v.sources,n),innerHTML:s,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],zc.prototype,"_isOpen",void 0),u([p()],zc.prototype,"_isInteractive",null),u([p()],zc.prototype,"_attributionTextOverflowed",void 0),u([p()],zc.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],zc.prototype,"attributionText",null),u([p()],zc.prototype,"iconClass",void 0),u([p()],zc.prototype,"itemDelimiter",void 0),u([p()],zc.prototype,"label",null),u([p(),za("esri/widgets/Attribution/t9n/Attribution")],zc.prototype,"messages",void 0),u([p()],zc.prototype,"view",null),u([p({type:G3e})],zc.prototype,"viewModel",void 0),u([Yh()],zc.prototype,"_toggleState",null),zc=u([N("esri.widgets.Attribution")],zc);const rgt=zc,sgt="esri.widgets.CompassViewModel";let nT=class extends nre(Ee){constructor(e){super(e),this._handles=new ir,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ae(()=>this.view,this._updateRotationWatcher,ii))}destroy(){is(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var i;if(!this.get("view.ready"))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ae(()=>e==null?void 0:e.rotation,this._updateForRotation,ii):ae(()=>e==null?void 0:e.camera,this._updateForCamera,ii))}};u([p({readOnly:!0})],nT.prototype,"canShowNorth",null),u([p()],nT.prototype,"orientation",void 0),u([p({readOnly:!0})],nT.prototype,"state",null),u([p()],nT.prototype,"view",void 0),nT=u([N(sgt)],nT);const j3e=nT,Lv={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Ag=class extends hl{constructor(e,i){super(e,i),this.iconClass=Lv.widgetIcon,this.messages=null,this.viewModel=new j3e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="disabled",s=(i==="rotation"?"rotation":"compass")=="compass",n=r?-1:0,o={[Lv.disabled]:r,[Lv.interactive]:!r},a={[Lv.northIcon]:s,[Lv.rotationIcon]:!s},{messages:l}=this;return ce("div",{bind:this,class:this.classes(Lv.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},ce("span",{"aria-hidden":"true",class:this.classes(Lv.icon,a),styles:this._toRotationTransform(e)}),ce("span",{class:Lv.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([p()],Ag.prototype,"goToOverride",null),u([p()],Ag.prototype,"iconClass",void 0),u([p()],Ag.prototype,"label",null),u([p(),za("esri/widgets/Compass/t9n/Compass")],Ag.prototype,"messages",void 0),u([p()],Ag.prototype,"view",null),u([p({type:j3e})],Ag.prototype,"viewModel",void 0),u([Yh()],Ag.prototype,"_reset",null),Ag=u([N("esri.widgets.Compass")],Ag);const ngt=Ag,KS="esri-navigation-toggle",Id={base:`${KS} esri-widget`,button:`${KS}__button esri-widget--button`,activeButton:`${KS}__button--active`,panButton:`${KS}__button--pan`,rotateButton:`${KS}__button--rotate`,isLayoutHorizontal:`${KS}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let VC=class extends Ee{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(wa(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([p({readOnly:!0})],VC.prototype,"state",null),u([p()],VC.prototype,"navigationMode",void 0),u([p()],VC.prototype,"view",void 0),VC=u([N("esri.widgets.NavigationToggleViewModel")],VC);const H3e=VC;let Og=class extends hl{constructor(e,i){super(e,i),this.iconClass=Id.widgetIcon,this.messages=null,this.viewModel=new H3e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",i=this.get("viewModel.navigationMode")==="pan",r={[Id.disabled]:e,[Id.isLayoutHorizontal]:this.layout==="horizontal"},s={[Id.activeButton]:i},n={[Id.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return ce("div",{bind:this,class:this.classes(Id.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},ce("div",{class:this.classes(Id.button,Id.panButton,s)},ce("span",{class:Id.panIcon})),ce("div",{class:this.classes(Id.button,Id.rotateButton,n)},ce("span",{class:Id.rotationIcon})))}_toggle(){this.toggle()}};u([p()],Og.prototype,"iconClass",void 0),u([p()],Og.prototype,"label",null),u([p({value:"vertical"})],Og.prototype,"layout",null),u([p(),za("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Og.prototype,"messages",void 0),u([p()],Og.prototype,"view",null),u([p({type:H3e})],Og.prototype,"viewModel",void 0),u([Yh()],Og.prototype,"_toggle",null),Og=u([N("esri.widgets.NavigationToggle")],Og);const ogt=Og,GO={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let I1=class extends hl{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,i={[GO.disabled]:!this.enabled,[GO.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return ce("div",{bind:this,class:this.classes(GO.button,i),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ce("span",{"aria-hidden":"true",role:"presentation",class:this.classes(GO.icon,r)}),ce("span",{class:GO.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([p()],I1.prototype,"action",void 0),u([p()],I1.prototype,"enabled",void 0),u([p()],I1.prototype,"iconClass",void 0),u([p()],I1.prototype,"title",void 0),u([Yh()],I1.prototype,"_triggerAction",null),I1=u([N("esri.widgets.IconButton")],I1);const Xde=I1;let zC=class extends Ee{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMaxScale");return i===0||e>i}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMinScale");return i===0||e<i}};u([p({readOnly:!0})],zC.prototype,"canZoomIn",null),u([p({readOnly:!0})],zC.prototype,"canZoomOut",null),u([p()],zC.prototype,"view",void 0),zC=u([N("esri.widgets.Zoom.ZoomConditions2D")],zC);const agt=zC;let BC=class extends Ee{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],BC.prototype,"canZoomIn",null),u([p({readOnly:!0})],BC.prototype,"canZoomOut",null),u([p()],BC.prototype,"view",void 0),BC=u([N("esri.widgets.Zoom.ZoomConditions3D")],BC);const lgt=BC;let $1=class extends Ee{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return b(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return b(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new agt({view:e}):e.type==="3d"&&(this._zoomConditions=new lgt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():VM(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():VM(e.goTo({zoomFactor:.5}))}};u([p()],$1.prototype,"_zoomConditions",void 0),u([p()],$1.prototype,"canZoomIn",null),u([p()],$1.prototype,"canZoomOut",null),u([p({readOnly:!0})],$1.prototype,"state",null),u([p()],$1.prototype,"view",null),$1=u([N("esri.widgets.Zoom.ZoomViewModel")],$1);const q3e=$1,jO={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let F0=class extends hl{constructor(e,i){super(e,i),this.iconClass=jO.widgetIcon,this.messages=null,this.viewModel=new q3e}initialize(){this._zoomInButton=new Xde({action:this.zoomIn.bind(this),iconClass:jO.zoomInIcon}),this._zoomOutButton=new Xde({action:this.zoomOut.bind(this),iconClass:jO.zoomOutIcon})}destroy(){this._zoomInButton=He(this._zoomInButton),this._zoomOutButton=He(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[jO.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:s}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,ce("div",{class:this.classes(jO.base,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([p()],F0.prototype,"iconClass",void 0),u([p()],F0.prototype,"label",null),u([p({value:"vertical"})],F0.prototype,"layout",null),u([p(),za("esri/widgets/Zoom/t9n/Zoom")],F0.prototype,"messages",void 0),u([p()],F0.prototype,"view",null),u([p({type:q3e})],F0.prototype,"viewModel",void 0),F0=u([N("esri.widgets.Zoom")],F0);const cgt=F0;function ugt(t){return t&&t.view!==void 0}let z6=class extends egt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([ae(()=>this.components,this._componentsWatcher.bind(this),ii),ae(()=>this.view,this._updateViewAwareWidgets.bind(this),ii)])}_add(e,i,r,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,i,r,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(i=>{const r=this._find(i),s=r&&r.widget;ugt(s)&&(s.view=e)})}_componentsWatcher(e,i){this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);if(i)return new V6({id:e,node:i})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new rgt({view:this.view})}_createCompass(){return new ngt({view:this.view})}_createNavigationToggle(){return new ogt({view:this.view})}_createZoom(){return new cgt({view:this.view})}};u([p()],z6.prototype,"components",void 0),z6=u([N("esri.views.ui.DefaultUI")],z6);const W3e=z6;let B6=class extends W3e{constructor(e){super(e),this.components=["attribution","zoom"]}};u([p()],B6.prototype,"components",void 0),B6=u([N("esri.views.ui.2d.DefaultUI2D")],B6);const Y3e=B6;var zZ;let G6=zZ=class extends Ae{constructor(t){super(t),this.color=new et([0,0,0,1])}clone(){return new zZ(ue({color:this.color}))}};u([p({type:et,json:{write:!0}})],G6.prototype,"color",void 0),G6=zZ=u([N("esri.webmap.background.ColorBackground")],G6);const hgt=G6;let X3e,Z3e,J3e,K3e,Q3e,eOe;async function dgt(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,Stage:n}]=await Promise.all([se(()=>import("./webglDeps-1deeae7f.js"),["assets/webglDeps-1deeae7f.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-3f37b110.js"]),se(()=>import("./mapViewDeps-5259a775.js"),["assets/mapViewDeps-5259a775.js","assets/CIMResourceManager-e389f275.js","assets/Rasterizer-fef7f176.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/utils-35d9b505.js","assets/alignmentUtils-ae955d28.js","assets/definitions-19bfb61c.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/imageutils-6de27084.js","assets/Container-0639ee3d.js","assets/BufferPool-dc72dc51.js","assets/enums-b1d611e3.js","assets/WGLContainer-22e7c87b.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-916b4f87.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-3f37b110.js","assets/MaterialKey-a958dec2.js","assets/utils-f978585c.js","assets/heatmapTextureUtils-056b357c.js","assets/VTLMaterialManager-5216362a.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-046c9108.js","assets/Matcher-f36ffa66.js","assets/visualVariablesUtils-e8f7cd46.js","assets/visualVariablesUtils-6a784d48.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-95dd8b1b.js","assets/ExpandedCIM-03d4fc54.js","assets/CircularArray-7b2394fa.js","assets/ComputedAttributeStorage-0b11aa21.js","assets/arcadeTimeUtils-9099ffb4.js","assets/centroid-d352bf1e.js","assets/MaterialPrograms-05d78577.js","assets/GraphicsView2D-28d2d544.js","assets/normalizeUtilsSync-360fb6bc.js","assets/AttributeStoreView-0d158480.js","assets/schemaUtils-5ed910d9.js","assets/util-5c979b56.js","assets/GraphicsView-a2abd211.js","assets/GraphicContainer-caf957bb.js","assets/BaseGraphicContainer-2764499a.js","assets/FeatureContainer-b394ad2c.js","assets/TileContainer-c1add888.js"])]);Z3e=t,J3e=e,K3e=i,Q3e=r,eOe=s,X3e=n}const Zde=160;function pgt(t){return t&&t.declaredClass==="esri.Viewpoint"}let Ci=class extends l2e(EAe(CAe(VAe))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Gb({getCollections:()=>{var i,r;return[(i=this.basemapView)==null?void 0:i.baseLayerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.rendering=!1,this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this._stationaryTimer=null,this._gotoTask=null,this.frameTask=new Kpt(this),this._pePromise=null,this.floors=new xt,this.highlightOptions=new P3e,this.inputManager=new lmt({view:this}),this.map=null,this.resizeAlign="center",this.spatialReferenceLocked=!1,this.timeline=new I3e,this.type="2d",this.ui=new Y3e,this._pixelFormat={flipY:!0,premultipliedAlpha:!0},this.constraints=new u3e,this.padding={top:0,right:0,bottom:0,left:0},this.handles.add([ae(()=>this.viewpoint,()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(Zde)},Mi),this.on("resize",i=>this._resizeHandler(i)),ae(()=>{var i;return(i=this.animationManager)==null?void 0:i.animation},i=>{this.animation=i})]),PTe()}destroy(){this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null,this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new mmt(this.featuresTilingScheme)}get initialExtentRequired(){var a;const{scale:e,constraints:i,center:r,viewpoint:s,extent:n}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!n&&(i!=null&&i.effectiveLODs||(o=-1),(!r||e===0&&o===-1)&&(!s||!b(s.targetGeometry)||s.targetGeometry.type!=="extent"&&!s.scale))}get resourceManager(){return this._stage.resourceManager}get textureManager(){return this._stage.painter.textureManager}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get _projectionEngineLoaded(){return!!Xb()||(this._pePromise||(this._pePromise=Zb().finally(()=>{this._pePromise=null})),!1)}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const i=this.spatialReference,r=e.targetGeometry;return!!Bp(r.spatialReference,i)||this._projectionEngineLoaded}set animation(e){const i=this._get("animation");if(e===i)return;if(i&&i.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e),this.frameTask.animationInProgress=!0;const r=()=>{var s;e===this._get("animation")&&(this._set("animation",null),(s=this.frameTask)==null||s.requestFrame()),this.frameTask&&(this.frameTask.animationInProgress=!1)};e.when(r,r)}get background(){return mgt(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return new st({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");let i;try{i=this._project(e,this.spatialReference)}catch(s){return void le.getLogger(this.declaredClass).error(new J("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}const r=this.viewpoint;PZ(r,r,i),this.viewpoint=r}set constraints(e){const i=this._get("constraints");i&&(this.handles.remove("map-view-constraints"),i.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(ae(()=>e.version,()=>{this.ready&&this.state&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint))},Mi),"map-view-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void le.getLogger(this.declaredClass).error(new J("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");let i;try{i=this._project(e,this.spatialReference)}catch(s){return void le.getLogger(this.declaredClass).error(new J("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const r=this.viewpoint;Npt(r,r,i,this.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;Ypt(i,i,e),this.viewpoint=i}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",-1);const r=this._get("extent");return r&&(this._set("extent",null),this._set("center",r.center)),void this.notifyChange("initialExtentRequired")}const i=this.viewpoint;Sde(i,i,e),this.viewpoint=i}get stationary(){return!(this.animation||this.navigating||this.resizing||this._stationaryTimer)}get updating(){var i,r,s;const e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(n=>!n.destroyed&&!("layerViews"in n)&&n.updating===!0));if(me("esri-2d-log-updating")){const n=this.allLayerViews.reduce((o,a)=>({...o,[a.layer.id]:!a.destroyed&&!("layerViews"in a)&&a.updating}),{});console.log(`Updating MapView: ${e}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(i=this.layerViewManager)==null?void 0:i.updating}
-> labelManager.updating: ${(r=this.labelManager)==null?void 0:r.updating}
-> graphicsView.updating: ${(s=this.graphicsView)==null?void 0:s.updating}
-> allLayerViews: ${JSON.stringify(n)}
`)}return e}get viewpoint(){if(!this.ready)return this._get("viewpoint");const e=this.state.paddedViewState;return e&&e.viewpoint.clone()}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");let i,r;try{i=this._project(e,this.spatialReference),!e.scale||isNaN(e.scale)?r=new J("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):A(e.targetGeometry)&&(r=new J("mapview:invalid-viewpoint","geometry not defined"))}catch(n){r=new J("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:n})}if(r)return void le.getLogger(this.declaredClass).error(r);this._scaleBeforeChangingSpatialReference=null;const s=new ya({targetGeometry:new st,scale:0,rotation:0});Nm(s,i),this.constraints.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this.frameTask.requestFrame(),this._set("viewpoint",s)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(e){if(e==null)return;if(!this.ready){this._set("zoom",e),this._set("scale",0);const r=this._get("extent");return r&&(this._set("extent",null),this._set("center",r.center)),void this.notifyChange("initialExtentRequired")}if(!this.constraints.effectiveLODs)return void this._set("zoom",-1);const i=this.viewpoint;Sde(i,i,this.constraints.zoomToScale(e)),this.viewpoint=i,this._set("zoom",this.constraints.scaleToZoom(this.scale))}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}goTo(e,i){if(e)return this.animation&&(this.animation=null),this._createAnimation(),Wb(()=>this.ready,i).then(()=>{var n;const r={animate:!0,...i},s=$pt(e,this);return(n=this.animation)==null||n.update(s),this._gotoTask={},r.animate?this._gotoAnimated(s,r):this._gotoImmediate(s,r)});le.getLogger(this.declaredClass).error("#goTo()","target cannot be null or undefined")}async hitTest(e,i){const r=r9(e)?i9(this,e):e;if(!this.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set,n=!1,o=null,a=null;i!=null&&i.include?Kde(i.include,Jde(this,d=>s.add(d),d=>{o||(o=new Set),o.add(d)},d=>s.add(d),()=>n=!0)):(n=!0,s=new Set(this.allLayerViews)),i!=null&&i.exclude&&Kde(i.exclude,Jde(this,d=>s.delete(d),d=>{a||(a=new Set),a.add(d)}));const l=this.allLayerViews.filter(d=>!d.suspended&&s.has(d)).reverse(),c=this.toMap(r);let h=[...n?this.graphicsView.hitTest(c).map(d=>({type:"graphic",graphic:d,layer:null,mapPoint:c})):[],...await Promise.all(l.map(d=>d.hitTest(c,r)).toArray())].filter(b).flat().filter(b);return o&&(h=h.filter(d=>!("graphic"in d)||!d.graphic||(o==null?void 0:o.has(BZ(d.graphic))))),a&&(h=h.filter(d=>!("graphic"in d)||!d.graphic||(a==null?void 0:a.has(BZ(d.graphic))))),{screenPoint:r,results:h}}async takeScreenshot(e){const i=this._createScreenshotPlan(e),r=await this._stage.takeScreenshot(i);return U6(r,{format:i.format,quality:i.quality,rotation:0,disableDecorations:!1},this._pixelFormat)}async _takeScreenshot(e){const i=this._createScreenshotPlan(e),r=await this._stage.takeScreenshot(i);return k6(r,this._pixelFormat)}_createScreenshotPlan(e){e=e??{};const i=this.supersampleScreenshotsEnabled?Math.min(4,Mmt(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let r;e.layers?(r=[],e.layers.forEach(o=>{const a=this.allLayerViews.find(l=>l.layer.id===o.id);a&&"container"in a&&a.container&&r.push(a.container)})):r=this._stage.children;const{format:s,quality:n}=Cmt(e.format,e.quality);return ymt(e,i,this.size,this.padding,s,n,r,e.rotation)}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}toMap(e){if(!this.ready)return null;const i=r9(e)?i9(this,e):e,r=[0,0],[s,n]=this.state.toMap(r,[i.x,i.y]),o=this.spatialReference;return new st({x:s,y:n,spatialReference:o})}toScreen(e){if(!this.ready)return null;const i=this._project(e,this.spatialReference),r=[i.x,i.y];return this.state.toScreen(r,r),xo(r[0],r[1])}on(e,i,r,s){return this.inputManager&&this.viewEvents.on(e,i,r,s)||super.on(e,i)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,i,r;return this.map&&"initialViewProperties"in this.map&&((i=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||null}hasLayerViewModule(e){return Cde.hasLayerViewModule(e)}importLayerView(e){return Cde.importLayerView(e)}pixelSizeAt(){return this.ready?this.state.resolution:(le.getLogger(this.declaredClass).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(e){return this.hitTest(e).then(i=>({...i,mapPoint:this.toMap(e)}))}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){let e=z3e(this.type);return me("safari")&&me("safari")<9&&(e=new J("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:me("safari")})),b(e)?(le.getLogger(this.declaredClass).warn("#validate()",e.message),Promise.reject(e)):dgt()}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new j_),this.animation}_cancellableGoTo(e,i,r){const s=()=>e===this._gotoTask,n=r.then(()=>{s()&&(this.animation=null)}).catch(a=>{throw s()&&(i&&!i.done&&(i.stop(),this.frameTask.animationInProgress=!1),this.animation=null),a}),o=new Promise(a=>a(n));return i.when().catch(()=>{s()&&o.cancel&&o.cancel()}),o}_gotoImmediate(e,i){const r=this._gotoTask,s=this.animation,n=e.then(o=>{if(_i(i),r!==this._gotoTask)throw new J("view:goto-interrupted","Goto was interrupted");this.viewpoint=s.target=o,s.finish()});return this._cancellableGoTo(r,s,n)}_flipStationary(e){return this._stationaryTimer!==null||(this._stationaryTimer=setTimeout(()=>{this._stationaryTimer=null;const i=performance.now()-this._lastStationaryEventTimestamp;i<Zde&&(this._stationaryTimer=this._flipStationary(i))},e)),this._stationaryTimer}_getDefaultViewpoint(){var x,S,E,C;const{constraints:e,initialExtent:i,map:r,padding:s,size:n}=this;if(!e)return null;const o=r&&"initialViewProperties"in r?r.initialViewProperties:void 0,a={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint"),spatialReference:this._userSpatialReference};e.effectiveLODs?a.zoom!==-1&&(a.scale=e.zoomToScale(a.zoom)):a.zoom=-1;let l=null,c=null,h=0;const d=a.viewpoint&&a.viewpoint.rotation,f=a.viewpoint&&a.viewpoint.targetGeometry;b(f)&&(f.type==="extent"?l=f:f.type==="point"&&(c=f,h=a.viewpoint.scale));const m=a.extent||l||((S=(x=o==null?void 0:o.viewpoint)==null?void 0:x.targetGeometry)==null?void 0:S.extent)||i,g=a.center||c||(m==null?void 0:m.center),y=a.scale||h||((E=o==null?void 0:o.viewpoint)==null?void 0:E.scale)||m&&zI(m,[n[0]-s.left-s.right,n[1]-s.top-s.bottom]),v=a.rotation||d||((C=o==null?void 0:o.viewpoint)==null?void 0:C.rotation)||0;return g&&y?new ya({targetGeometry:g,scale:y,rotation:v}):null}_gotoAnimated(e,i){const r=this._gotoTask,s=this.animation;if(!s)return Promise.resolve();const n=e.then(o=>{if(_i(i),r!==this._gotoTask)throw new J("view:goto-interrupted","Goto was interrupted");return s.update(o),this.animationManager.animate(s,this.viewpoint,i),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,s,n)}_project(e,i){var n;const r=e&&e.targetGeometry||e;if(!i)return e;if(!r)return null;if(i.imageCoordinateSystem||(n=r.spatialReference)!=null&&n.imageCoordinateSystem||us(i,r.spatialReference))return e;const s=bd(r,i);if(!s)throw new J("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return pgt(e)?(e.targetGeometry=s,e):s}_resizeHandler(e){if(!this.ready)return;const i=this.state;let r=this.state.paddedViewState.viewpoint;const s=this.state.paddedViewState.size.concat();i.size=[e.width,e.height],Wpt(r,r,s,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints.constrain(r,void 0),this.state.viewpoint=r}_startup(){var l,c;this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint(),i=e.targetGeometry;try{this._project(e,this.spatialReference)}catch(h){le.getLogger(this.declaredClass).warn(new Np("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:i.toJSON(),spatialReference:this.spatialReference,error:h})),e.targetGeometry=((l=this.defaultsFromMap.extent)==null?void 0:l.center)||new st({x:0,y:0,spatialReference:this.spatialReference})}(c=this.constraints)==null||c.fit(e),this._set("state",new Mft({padding:this._get("padding"),size:this.size,viewpoint:e})),this.graphics.owner=this;const r=new X3e(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this._stage=r,this._magnifierView=new eOe,this._magnifierView.magnifier=this.magnifier;const s=new K3e({view:this});this._set("labelManager",s);const n=new Jpt({view:this});this._set("animationManager",n);const o=new Q3e({view:this,animationManager:n});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.handles.add([this.rootLayerViews.on("change",()=>this._updateStageChildren()),r.on("post-render",()=>this._set("rendering",r.renderRequested)),r.on("will-render",()=>this._set("rendering",r.renderRequested)),r.on("webgl-error",h=>this.fatalError=h.error),ae(()=>this.stationary,h=>r.stationary=h,Tr),ae(()=>this.background,h=>{r.background=h,this._magnifierView.background=h},Tr),ae(()=>this.magnifier,h=>this._magnifierView.magnifier=h,Tr),ae(()=>this.renderingOptions,h=>r.renderingOptions=h,Tr),ae(()=>this.highlightOptions,h=>r.highlightOptions=h,Tr),ae(()=>this.state.id,()=>r.state=this.state,Tr)],"map-view"),this._updateStageChildren();const a=this._resolveWhenReady;this._resolveWhenReady=[],a.forEach(h=>h(this)),this.timeline.end("MapView Startup"),this.frameTask&&this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.handles.remove("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask&&this.frameTask.stop(),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null),this._set("ready",!1);const{center:[e,i],spatialReference:r,rotation:s,scale:n}=this.state.paddedViewState,o=new st({x:e,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("spatialReference",r),this._set("state",null),this.animation=null}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach(i=>{this._stage.addChild(i.container)});const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const e=new Lft(m2.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const i=new Z3e({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new J3e(e)});this.frameTask.graphicsView=i,this._set("graphicsView",i)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),this.frameTask.graphicsView=null,e.destroy(),this._set("featuresTilingScheme",null)}_spatialReferenceChanged(e){if(!this.ready)return;this.frameTask.stop();for(const l of this.allLayerViews)l.processDetach();this._destroySpatialReferenceDependentProperties();const i=this.state.paddedViewState.clone();if(A(this._scaleBeforeChangingSpatialReference))this._scaleBeforeChangingSpatialReference=i.scale;else{const l=i.viewpoint.clone();l.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=l}const r=i.clone(),[s,n]=i.center;let o=null;try{o=this._project(new st({x:s,y:n,spatialReference:i.spatialReference}),e)}catch(l){Xb()||le.getLogger(this.declaredClass).warn(new Np("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o==null?void 0:o.toJSON(),spatialReference:e,error:l}))}o||(o=new st({x:0,y:0,spatialReference:e}));const a=PZ(new ya({targetGeometry:new st,scale:0,rotation:0}),i.viewpoint,o);r.viewpoint=a;try{const c=[i.size[0]/2,i.size[1]/2],h=[c[0]+20,c[1]],d=i.toMap([0,0],h),{x:f,y:m}=this._project(new st({x:d[0],y:d[1],spatialReference:i.spatialReference}),e);d[0]=f,d[1]=m,r.toScreen(d,d);const g=Hpt(c,d,h),y=Math.hypot(d[0]-c[0],d[1]-c[1])/20;!Number.isFinite(y)||Math.abs(y)>4?(a.rotation=0,a.targetGeometry=new st({x:0,y:0,spatialReference:e})):(a.scale*=y,a.scale>me("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(g)?g:0)}catch{}this._get("constraints").constrain(a,void 0),this._get("state").viewpoint=a,this._stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const l of this.allLayerViews)l.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}};Ci.type="2d",u([p({readOnly:!0})],Ci.prototype,"animationManager",void 0),u([p({constructOnly:!0})],Ci.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Ci.prototype,"debugWebGLExtensions",void 0),u([p({readOnly:!0})],Ci.prototype,"featuresTilingScheme",void 0),u([p({readOnly:!0})],Ci.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Ci.prototype,"graphicsTileStore",null),u([p()],Ci.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Ci.prototype,"state",void 0),u([p()],Ci.prototype,"initialExtentRequired",null),u([p()],Ci.prototype,"labelManager",void 0),u([p({readOnly:!0})],Ci.prototype,"resourceManager",null),u([p({readOnly:!0})],Ci.prototype,"textureManager",null),u([p({readOnly:!0})],Ci.prototype,"mapViewNavigation",void 0),u([p({constructOnly:!0})],Ci.prototype,"renderCanvas",void 0),u([p()],Ci.prototype,"renderingOptions",void 0),u([p({readOnly:!0})],Ci.prototype,"rendering",void 0),u([p({constructOnly:!0})],Ci.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Ci.prototype,"supportsGround",void 0),u([p()],Ci.prototype,"_stationaryTimer",void 0),u([p()],Ci.prototype,"_defaultsFromMapSettings",null),u([p()],Ci.prototype,"_pePromise",void 0),u([p({readOnly:!0})],Ci.prototype,"typeSpecificPreconditionsReady",null),u([p()],Ci.prototype,"animation",null),u([p({type:hgt})],Ci.prototype,"background",null),u([p({value:null,type:st,dependsOn:["state.id","ready"]})],Ci.prototype,"center",null),u([p({type:u3e})],Ci.prototype,"constraints",null),u([p({value:null,type:ti,dependsOn:["state.id","ready"]})],Ci.prototype,"extent",null),u([p()],Ci.prototype,"floors",void 0),u([p({type:P3e})],Ci.prototype,"highlightOptions",void 0),u([p({readOnly:!0})],Ci.prototype,"inputManager",void 0),u([p()],Ci.prototype,"map",void 0),u([p({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],Ci.prototype,"padding",null),u([p()],Ci.prototype,"resizeAlign",void 0),u([p({readOnly:!0,dependsOn:["state.id"]})],Ci.prototype,"resolution",null),u([p({value:0,type:Number,dependsOn:["state.id","ready"]})],Ci.prototype,"rotation",null),u([p({value:0,type:Number,dependsOn:["state.id","ready"]})],Ci.prototype,"scale",null),u([p({constructOnly:!0})],Ci.prototype,"spatialReferenceLocked",void 0),u([p()],Ci.prototype,"stationary",null),u([p({type:I3e,readOnly:!0})],Ci.prototype,"timeline",void 0),u([p({readOnly:!0})],Ci.prototype,"type",void 0),u([p({readOnly:!0})],Ci.prototype,"updating",null),u([p({value:null,type:ya,dependsOn:["state.id","ready"]})],Ci.prototype,"viewpoint",null),u([p({value:-1,dependsOn:["state.id","ready"]})],Ci.prototype,"zoom",null),u([p({readOnly:!0})],Ci.prototype,"navigating",null),u([p({type:Y3e})],Ci.prototype,"ui",void 0),Ci=u([N("esri.views.MapView")],Ci);const fgt=Ci;function BZ(t){var i,r;const e=t.getObjectId();return e?`${((i=t.layer)==null?void 0:i.uid)??((r=t.sourceLayer)==null?void 0:r.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function Jde(t,e,i,r,s){return n=>{if(n instanceof Ho){if(n.layer===t)s==null||s();else{const o=t.allLayerViews.find(a=>a.layer===n.layer);o&&(r==null||r(o))}i(BZ(n))}else{const o=t.allLayerViews.find(a=>a.layer===n);o&&e(o)}}}function Kde(t,e){if(t)if(m$(t))for(const i of t)if(m$(i))for(const r of i)e(r);else e(i);else e(t)}function mgt(t){return(t==null?void 0:t.declaredClass)==="esri.WebMap"}let rv=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&wA(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Qde);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Qde));e++)this._items.push(this._allocator())}};const Qde=1024;function Ge(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function JA(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Tre(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,y){return[t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,y]}function tOe(t,e){return new Float64Array(t,e,16)}const xd=Ge();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:xd,clone:JA,create:Ge,createView:tOe,fromValues:Tre},Symbol.toStringTag,{value:"Module"}));var rh;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(rh||(rh={}));function Hs(){return[1,0,0,0,1,0,0,0,1]}function ggt(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function ygt(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function iOe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:ggt,create:Hs,createView:iOe,fromValues:ygt},Symbol.toStringTag,{value:"Module"}));function Kp(){return[0,0,0,1]}function _gt(t){return[t[0],t[1],t[2],t[3]]}function vgt(t,e,i,r){return[t,e,i,r]}function rOe(t,e){return new Float64Array(t,e,4)}const bgt=Kp();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:bgt,clone:_gt,create:Kp,createView:rOe,fromValues:vgt},Symbol.toStringTag,{value:"Module"}));let q3=class oT{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&wA(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=QS){return new oT(16,YAe,e)}static createVec3f64(e=QS){return new oT(24,Yee,e)}static createVec4f64(e=QS){return new oT(32,YEe,e)}static createMat3f64(e=QS){return new oT(72,iOe,e)}static createMat4f64(e=QS){return new oT(128,tOe,e)}static createQuatf64(e=QS){return new oT(32,rOe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const QS=4*VA.KILOBYTES,MYt=q3.createVec2f64(),tt=q3.createVec3f64(),Sre=q3.createVec4f64();q3.createMat3f64();const Ere=q3.createMat4f64(),AYt=q3.createQuatf64();function Fm(t){return t?{origin:zr(t.origin),vector:zr(t.vector)}:{origin:$(),vector:$()}}function wgt(t,e){const i=Tgt.get();return i.origin=t,i.vector=e,i}function OYt(t,e=Fm()){return xgt(t.origin,t.vector,e)}function xgt(t,e,i=Fm()){return ge(i.origin,t),ge(i.vector,e),i}function b2(t,e,i=Fm()){return ge(i.origin,t),be(i.vector,e,t),i}function Cre(t,e){const i=be(tt.get(),e,t.origin),r=xe(t.vector,i),s=xe(t.vector,t.vector),n=Se(r/s,0,1),o=be(tt.get(),pe(tt.get(),t.vector,n),i);return xe(o,o)}function RYt(t,e,i){return GZ(t,e,0,1,i)}function PYt(t,e,i){return we(i,t.origin,pe(i,t.vector,e))}function GZ(t,e,i,r,s){const{vector:n,origin:o}=t,a=be(tt.get(),e,o),l=xe(n,a)/Ll(n);return pe(s,n,Se(l,i,r)),we(s,s,t.origin)}function IYt(t,e){if(nOe(t,wgt(e.origin,e.direction),!1,l9)){const{tA:i,pB:r,distance2:s}=l9;if(i>=0&&i<=1)return s;if(i<0)return Eo(t.origin,r);if(i>1)return Eo(we(tt.get(),t.origin,t.vector),r)}return null}function sOe(t,e,i){return!!nOe(t,e,!0,l9)&&(ge(i,l9.pA),!0)}function nOe(t,e,i,r){const n=t.origin,o=we(tt.get(),n,t.vector),a=e.origin,l=we(tt.get(),a,e.vector),c=tt.get(),h=tt.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=tt.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],y=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*y-m*m;if(Math.abs(v)<1e-6)return!1;let x=(f*m-g*y)/v,S=(f+m*x)/y;i&&(x=Se(x,0,1),S=Se(S,0,1));const E=tt.get(),C=tt.get();return E[0]=n[0]+x*d[0],E[1]=n[1]+x*d[1],E[2]=n[2]+x*d[2],C[0]=a[0]+S*h[0],C[1]=a[1]+S*h[1],C[2]=a[2]+S*h[2],r.tA=x,r.tB=S,r.pA=E,r.pB=C,r.distance2=Eo(E,C),!0}const l9={tA:0,tB:0,pA:$(),pB:$(),distance2:0},Tgt=new rv(()=>Fm());function ha(t){return t?epe(zr(t.origin),zr(t.direction)):epe($(),$())}function epe(t,e){return{origin:t,direction:e}}function $Yt(t,e){return L_(t.origin,e.origin)&&L_(t.direction,e.direction)}function Td(t,e){const i=Mgt.get();return i.origin=t,i.direction=e,i}function c9(t,e=ha()){return oOe(t.origin,t.direction,e)}function Sgt(t,e,i=ha()){return ge(i.origin,t),be(i.direction,e,t),i}function oOe(t,e,i=ha()){return ge(i.origin,t),ge(i.direction,e),i}function Egt(t,e){const i=Et(tt.get(),Re(tt.get(),t.direction),be(tt.get(),e,t.origin));return xe(i,i)}function Cgt(t,e,i){const r=xe(t.direction,be(i,e,t.origin));return we(i,t.origin,pe(i,t.direction,r)),i}const Mgt=new rv(()=>ha());function LYt(t,e,i){const r=xe(t,e)/xe(t,t);return pe(i,t,r)}function Pb(t,e){return xe(t,e)/ze(t)}function Mre(t,e){const i=xe(t,e)/(ze(t)*ze(e));return-Co(i)}function aOe(t,e,i){Re(hF,t),Re(vG,e);const r=xe(hF,vG),s=Co(r),n=Et(hF,hF,vG);return xe(n,i)<0?2*Math.PI-s:s}const hF=$(),vG=$();function to(){return Ai()}function KA(t,e=to()){return im(e,t)}function lOe(t,e){return di(t[0],t[1],t[2],e)}function Agt(t){return t}function cOe(t){t[0]=t[1]=t[2]=t[3]=0}function qV(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function T_(t){return t[3]}function Ogt(t){return t}function uOe(t,e,i,r){return di(t,e,i,r)}function Rgt(t,e,i){return t!==i&&ge(i,t),i[3]=t[3]+e,i}function Pgt(t,e,i){return le.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:KA(t,i)}function xw(t,e,i){if(A(e))return!1;const{origin:r,direction:s}=e,n=Igt;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(h<0||d<h&&d>0)&&(h=d),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const Igt=$();function jZ(t,e){return xw(t,e,null)}function $gt(t,e,i){if(xw(t,e,i))return i;const r=W3(t,e,tt.get());return we(i,e.origin,pe(tt.get(),e.direction,Wr(e.origin,r)/ze(e.direction))),i}function W3(t,e,i){const r=tt.get(),s=Ere.get();Et(r,e.origin,e.direction);const n=T_(t);Et(i,r,e.origin),pe(i,i,1/ze(i)*n);const o=pOe(t,e.origin),a=Mre(e.origin,i);return vd(s,a+o,r),at(i,i,s),i}function Lgt(t,e,i){return xw(t,e,i)?i:(Cgt(e,t,i),hOe(t,i,i))}function hOe(t,e,i){const r=be(tt.get(),e,t),s=pe(tt.get(),r,t[3]/ze(r));return we(i,s,t)}function dOe(t,e){const i=be(tt.get(),e,t),r=Ll(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function pOe(t,e){const i=be(tt.get(),e,t),r=ze(i),s=T_(t),n=s+Math.abs(s-r);return Co(s/n)}const bG=$();function fOe(t,e,i,r){const s=be(bG,e,t);switch(i){case rh.X:{const n=Ele(s,bG)[2];return fe(r,-Math.sin(n),Math.cos(n),0)}case rh.Y:{const n=Ele(s,bG),o=n[1],a=n[2],l=Math.sin(o);return fe(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case rh.Z:return Re(r,s);default:return}}function mOe(t,e){const i=be(HZ,e,t);return ze(i)-t[3]}function Dgt(t,e,i,r){const s=mOe(t,e),n=fOe(t,e,rh.Z,HZ),o=pe(HZ,n,i-s);return we(r,e,o)}function Ngt(t,e){const i=Eo(t,e),r=T_(t);return i<=r*r}const HZ=$(),WV=to(),Fgt=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:mOe,angleToSilhouette:pOe,axisAt:fOe,clear:cOe,closestPoint:Lgt,closestPointOnSilhouette:W3,containsPoint:Ngt,copy:KA,create:to,distanceToSilhouette:dOe,elevate:Rgt,fromCenterAndRadius:lOe,fromRadius:qV,fromValues:uOe,getCenter:Ogt,getRadius:T_,intersectRay:xw,intersectRayClosestSilhouette:$gt,intersectsRay:jZ,projectPoint:hOe,setAltitudeAt:Dgt,setExtent:Pgt,tmpSphere:WV,wrap:Agt},Symbol.toStringTag,{value:"Module"}));function K2(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function Ugt(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return fe(t,i,r,s),t}function DYt(t,e,i){i=i||t;const r=xe(t,e);fe(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Re(i,i)}function kgt(t,e,i){Math.abs(t[0])>Math.abs(t[1])?fe(e,0,1,0):fe(e,1,0,0),Et(i,t,e),Re(e,e),Et(e,i,t),Re(i,i)}function dF(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function Vgt(t,e,i,r=$()){const s=ze(t),n=ze(e),o=xe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return pe(o2,t,c),pe(a2,e,h),we(r,o2,a2)}return En(r,t,e,i)}function NYt(t,e,i,r=$(),s=$()){const n=ze(t),o=ze(e),a=xe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,g=m/o*h;pe(o2,t,m/n*d),pe(a2,e,g),we(r,o2,a2)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+d*(-n+o));pe(o2,t,m);const g=1/o*(Math.cos(i*l)*l*f+h*(-n+o));pe(a2,e,g),we(s,o2,a2),pe(s,s,1/c)}return s}return En(r,t,e,i),be(s,e,t),Re(s,s),s}function j6(t,e,i){t=Re(o2,t),e=Re(a2,e);const r=Co(xe(t,e));if(i){const s=Et(zgt,t,e);if(xe(s,i)<0)return-r}return r}function H6(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function FYt(t,e,i,r){be(tpe,e,t),be(ipe,i,t),Et(r,tpe,ipe),Re(r,r),r[3]=-xe(t,r)}const tpe=$(),ipe=$(),zgt=$(),o2=$(),a2=$();function gr(t=LP){return[t[0],t[1],t[2],t[3]]}function Bgt(t=LP[0],e=LP[1],i=LP[2],r=LP[3]){return Are(t,e,i,r,Sre.get())}function YV(t,e){return Are(e[0],e[1],e[2],e[3],t)}function Are(t,e,i,r,s=gr()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function gOe(t,e,i){return ge(i,t),i[3]=e,i}function xD(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Il(t,e,i,r=gr()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=h*h+d*d+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*g,r[1]=d*g,r[2]=f*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function yOe(t,e,i,r,s){const n=t.length/3;if(n<3)return!1;fe(HO,t[3*i],t[3*i+1],t[3*i+2]);let o=r,a=!1;for(;o<n-1&&!a;){const l=3*o;fe(eE,t[l],t[l+1],t[l+2]),o++,a=!Ur(HO,eE)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;fe(UT,t[l],t[l+1],t[l+2]),o++,be(pF,HO,eE),Re(pF,pF),be(fF,eE,UT),Re(fF,fF),a=!Ur(HO,UT)&&!Ur(eE,UT)&&Math.abs(xe(pF,fF))<Ggt}return a?(Il(HO,eE,UT,e),!0):(i!==0||r!==1||s!==2)&&yOe(t,e,0,1,2)}const Ggt=.99619469809,HO=$(),eE=$(),UT=$(),pF=$(),fF=$();function qZ(t,e,i){return e!==t&&YV(t,e),t[3]=-xe(t,i),t}function WZ(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function H$(t,e,i,r){return Et(UT,e,t),xD(i,UT,r)}function UYt(t,e,i,r){return XV(t,e,be(tt.get(),i,e),Xgt,r)}function OS(t,e,i){return!!b(e)&&XV(t,e.origin,e.direction,Zgt,i)}function jgt(t,e,i){return XV(t,e.origin,e.vector,my.NONE,i)}function Hgt(t,e,i){return XV(t,e.origin,e.vector,my.CLAMP,i)}function _Oe(t,e){return Kr(t,e)>=0}function qgt(t,e){const i=xe(t,e.ray.direction),r=-Kr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Wgt(t,e){const i=xe(t,e.ray.direction),r=-Kr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Ygt(t,e,i){const r=pe(tt.get(),t,-t[3]),s=YZ(t,be(tt.get(),e,r),tt.get());return we(i,s,r),i}function kYt(t,e,i,r){const s=t,n=tt.get(),o=tt.get();kgt(s,n,o);const a=be(tt.get(),i,e),l=Pb(n,a),c=Pb(o,a),h=Pb(s,a);return fe(r,l,c,h)}function YZ(t,e,i){const r=pe(tt.get(),t,xe(t,e));return be(i,e,r),i}function Kr(t,e){return xe(t,e)+t[3]}function XV(t,e,i,r,s){const n=xe(t,i);if(n===0)return!1;let o=-(xe(t,e)+t[3])/n;return r&my.CLAMP&&(o=Se(o,0,1)),!(!(r&my.INFINITE_MIN)&&o<0||!(r&my.INFINITE_MAX)&&o>1)&&(we(s,e,pe(s,i,o)),!0)}function VYt(t){return t}const LP=[0,0,1,0];var my;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(my||(my={}));const Xgt=my.INFINITE_MIN|my.INFINITE_MAX,Zgt=my.INFINITE_MAX,wG=le.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Jgt=class{constructor(){this.plane=gr(),this.origin=$(),this.basis1=$(),this.basis2=$()}};const vOe=Jgt;function sv(t=ROe){return{plane:gr(t.plane),origin:zr(t.origin),basis1:zr(t.basis1),basis2:zr(t.basis2)}}function Kgt(t,e,i){const r=uyt.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=Bgt(0,0,0,0),ZV(r),r}function RS(t,e=sv()){return Ore(t.origin,t.basis1,t.basis2,e)}function Qgt(t,e){ge(e.origin,t.origin),ge(e.basis1,t.basis1),ge(e.basis2,t.basis2),YV(e.plane,t.plane)}function Ore(t,e,i,r=sv()){return ge(r.origin,t),ge(r.basis1,e),ge(r.basis2,i),ZV(r),lyt(r,"fromValues()"),r}function ZV(t){H$(t.basis2,t.basis1,t.origin,t.plane)}function bOe(t,e,i){t!==i&&RS(t,i);const r=pe(tt.get(),H_(t),e);return we(i.origin,i.origin,r),i.plane[3]-=e,i}function eyt(t,e,i){return wOe(e,i),bOe(i,$re(t,t.origin),i),i}function wOe(t,e=sv()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return fe(e.origin,t[0]+i,t[1]+r,0),fe(e.basis1,i,0,0),fe(e.basis2,0,r,0),Are(0,0,1,0,e.plane),e}function Rre(t,e,i){return!!OS(t.plane,e,i)&&AOe(t,i)}function tyt(t,e,i){if(Rre(t,e,i))return i;const r=xOe(t,e,tt.get());return we(i,e.origin,pe(tt.get(),e.direction,Wr(e.origin,r)/ze(e.direction))),i}function xOe(t,e,i){const r=u9.get();OOe(t,e,r,u9.get());let s=Number.POSITIVE_INFINITY;for(const n of Dre){const o=Lre(t,n,JV.get()),a=tt.get();if(jgt(r,o,a)){const l=Q_(tt.get(),e.origin,a),c=Math.abs(Co(xe(e.direction,l)));c<s&&(s=c,ge(i,a))}}return s===Number.POSITIVE_INFINITY?TOe(t,e,i):i}function TOe(t,e,i){if(Rre(t,e,i))return i;const r=u9.get(),s=u9.get();OOe(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of Dre){const a=Lre(t,o,JV.get()),l=tt.get();if(Hgt(r,a,l)){const c=Egt(e,l);if(!_Oe(s,l))continue;c<n&&(n=c,ge(i,l))}}return Pre(t,e.origin)<n&&SOe(t,e.origin,i),i}function SOe(t,e,i){const r=Ygt(t.plane,e,tt.get()),s=GZ(rpe(t,t.basis1),r,-1,1,tt.get()),n=GZ(rpe(t,t.basis2),r,-1,1,tt.get());return be(i,we(tt.get(),s,n),t.origin),i}function EOe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=be(tt.get(),e,r),a=Pb(s,o),l=Pb(n,o),c=Pb(H_(t),o);return fe(i,a,l,c)}function Pre(t,e){const i=EOe(t,e,tt.get()),{basis1:r,basis2:s}=t,n=ze(r),o=ze(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function iyt(t,e){return Math.sqrt(Pre(t,e))}function ryt(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of Dre){const s=Lre(t,r,JV.get()),n=Cre(s,e);n>i&&(i=n)}return Math.sqrt(i)}function Ire(t,e){return _Oe(t.plane,e)&&AOe(t,e)}function syt(t,e,i,r){return ayt(t,i,r)}function $re(t,e){const i=-t.plane[3];return Pb(H_(t),e)-i}function nyt(t,e,i,r){const s=$re(t,e),n=pe(cyt,H_(t),i-s);return we(r,e,n),r}function COe(t,e){return Ur(t.basis1,e.basis1)&&Ur(t.basis2,e.basis2)&&Ur(t.origin,e.origin)}function MOe(t,e,i){return t!==i&&RS(t,i),Va(tE,e),hh(tE,tE),at(i.basis1,t.basis1,tE),at(i.basis2,t.basis2,tE),at(i.plane,t.plane,tE),at(i.origin,t.origin,e),qZ(i.plane,i.plane,i.origin),i}function oyt(t,e,i,r){return t!==r&&RS(t,r),vd(xG,e,i),at(r.basis1,t.basis1,xG),at(r.basis2,t.basis2,xG),ZV(r),r}function H_(t){return t.plane}function ayt(t,e,i){switch(e){case rh.X:ge(i,t.basis1),Re(i,i);break;case rh.Y:ge(i,t.basis2),Re(i,i);break;case rh.Z:ge(i,H_(t))}return i}function AOe(t,e){const i=be(tt.get(),e,t.origin),r=Ll(t.basis1),s=Ll(t.basis2),n=xe(t.basis1,i),o=xe(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function rpe(t,e){const i=JV.get();return ge(i.origin,t.origin),ge(i.vector,e),i}function Lre(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=pe(tt.get(),r,e.origin[0]),a=pe(tt.get(),s,e.origin[1]);we(i.origin,o,a),we(i.origin,i.origin,n);const l=pe(tt.get(),r,e.direction[0]),c=pe(tt.get(),s,e.direction[1]);return pe(i.vector,we(l,l,c),2),i}function lyt(t,e){Math.abs(xe(t.basis1,t.basis2)/(ze(t.basis1)*ze(t.basis2)))>1e-6&&wG.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(xe(t.basis1,H_(t)))>1e-6&&wG.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-xe(H_(t),t.origin)-t.plane[3])>1e-6&&wG.warn(e,"Plane offset is not consistent with plane origin")}function OOe(t,e,i,r){const s=H_(t);H$(s,e.direction,e.origin,i),H$(i,s,e.origin,r)}const ROe={plane:gr(),origin:Ve(0,0,0),basis1:Ve(1,0,0),basis2:Ve(0,1,0)},u9=new rv(gr),JV=new rv(Fm),cyt=$(),uyt=new rv(()=>sv()),Dre=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],tE=Ge(),xG=Ge(),hyt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:vOe,UP:ROe,altitudeAt:$re,axisAt:syt,closestPoint:TOe,closestPointOnSilhouette:xOe,copy:RS,copyWithoutVerify:Qgt,create:sv,distance:iyt,distance2:Pre,distanceToSilhouette:ryt,elevate:bOe,equals:COe,extrusionContainsPoint:Ire,fromAABoundingRect:wOe,fromValues:Ore,intersectRay:Rre,intersectRayClosestSilhouette:tyt,normal:H_,projectPoint:SOe,projectPointLocal:EOe,rotate:oyt,setAltitudeAt:nyt,setExtent:eyt,transform:MOe,updateUnboundedPlane:ZV,wrap:Kgt},Symbol.toStringTag,{value:"Module"})),dyt=new Ye(Qbe),spe=new Ye(Nee),npe=new Ye(Fee),BYt=new Ye(ewe);function KV(t){return t&&(Ly(t)||us(t,spe))?spe:t&&(Dy(t)||us(t,npe))?npe:dyt}function pyt(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function fyt(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function myt(t){return{operations:t,value:t.create()}}function POe(t,e,i=myt(t)){return i.operations=t,t.copy(e,i.value),i}function gyt(t){return POe(Fgt,uOe(0,0,0,ur(t).radius))}const ope=2**50;function yyt(){return POe(hyt,Ore([0,0,0],[ope,0,0],[0,ope,0]))}function _yt(t,e,i){return t.operations.axisAt(t.value,e,rh.Z,i)}function vyt(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function byt(t,e,i){return t.operations.intersectRay(t.value,e,i)}function wyt(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function xyt(t,e){return t.operations.altitudeAt(t.value,e)}function IOe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Tyt(t,e,i,r){return e!==r&&Bo(r,e),fe(iE,r[12],r[13],r[14]),IOe(t,iE,i,iE),r[12]=iE[0],r[13]=iE[1],r[14]=iE[2],r}function TG(t,e,i){return t.operations.elevate(t.value,e,i.value)}const iE=$();function ape(t,e,i,r,s){return s[0]=xe(t,e),s[1]=xe(t,i),s[2]=xe(t,r),s}function XZ(t,e,i,r,s){ge(i,t),ge(mF,e),Re(mF,mF),Et(r,mF,i),Et(s,r,i)}function $Oe(t,e){return t?KV(e):e.isGeographic?Ye.PlateCarree:e}const mF=$(),Nre=96;function h9(t,e){const i=e||t.extent,r=t.width,s=Ec(i&&i.spatialReference);return i&&r?i.width/r*s*Uee*Nre:0}function Syt(t,e){return t/(Ec(e)*Uee*Nre)}function Eyt(t){return t/(Uee*Nre)}const Fre=le.getLogger("esri.layers.support.ElevationSampler");let LOe=class{queryElevation(e){return DOe(e.clone(),this)}on(){return Ryt}projectIfRequired(e,i){return NOe(e,i)}},Cyt=class extends LOe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=Xk(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Ec(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return!A(i)&&this.containsAt(i.x,i.y)}containsAt(e,i){return Zk(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return Fre.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return vt(this.tile.sample(e,i),this.noDataValue)}},HYt=class extends LOe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new Cyt(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=Xk(bi(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return Fre.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function DOe(t,e){const i=NOe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Myt(t,i,e);break;case"polyline":Ayt(t,i,e);break;case"multipoint":Oyt(t,i,e)}return t}function NOe(t,e){if(A(t))return null;const i=t.spatialReference;if(i.equals(e))return t;const r=_S(t,e);return r||Fre.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Myt(t,e,i){t.z=i.elevationAt(e.x,e.y)}function Ayt(t,e,i){Xg.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Xg.x=c[0],Xg.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Xg.x,Xg.y)}}t.hasZ=!0}function Oyt(t,e,i){Xg.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Xg.x=o[0],Xg.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Xg.x,Xg.y)}t.hasZ=!0}const Xg=new st,Ryt={remove(){}},Pyt=12;let Zu=class Bc{constructor(e){const i=Bc.checkUnsupported(e);if(b(i))throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=j2(this.spatialReference)||Ly(this.spatialReference)||Dy(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,d)=>(h.level<c.min&&(c.min=h.level,c.minIndex=d),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Bc(this.toTileInfo())}toTileInfo(){return new m2({dpi:this.dpi,origin:new st({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Or({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=ple(e[0]),i[1]=lU(e[1]),i[2]=ple(e[2]),i[3]=lU(e[3])):this._isGCS&&(i[0]=ci(e[0]),i[1]=ci(e[1]),i[2]=ci(e[2]),i[3]=ci(e[3]))}getExtentGeometry(e,i,r,s=new ti){return this.getExtent(e,i,r,Zm),s.spatialReference=this.spatialReference,s.xmin=Zm[0],s.ymin=Zm[1],s.xmax=Zm[2],s.ymax=Zm[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Bc)){if(Bc.checkUnsupported(e))return!1;e=new Bc(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!__(e.origin[0],this.origin[0],s)||!__(e.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*Pyt,__(r,e.levels[i].resolution,s))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(A(e)||n[0]===0||n[1]===0)return s;Bc.computeRowColExtent(e,n,this.origin,Zm);let o=Zm[1],a=Zm[3],l=Zm[0],c=Zm[2];const h=c-l,d=a-o;if(h*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return b(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!kYe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new J("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return A(e)?Ure():e.lods.length<1?new J("tilingscheme:generic","Tiling scheme must have at least one level"):Bc.isPowerOfTwo(e)?Bc.hasGapInLevels(e)?new J("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Bc.tileSizeSupported(e)?Bc.hasOriginPerLODs(e)?new J("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new J("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new J("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Ec(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new Bc(new m2({size:[a,a],origin:new st({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Or({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Bc(Bc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Bc(new m2({size:[i,i],origin:new st({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Or({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function Ure(){return new J("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Zu.WebMercatorAuxiliarySphereTileInfo=new m2({size:[256,256],origin:new st({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ye.WebMercator}),spatialReference:Ye.WebMercator,lods:[new Or({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Zu.WebMercatorAuxiliarySphere=Zu.makeWebMercatorAuxiliarySphere(19);const Zm=bi(),xM=64,DP=512,Iyt=2.5,q$=VYe(qq/10),FOe=2,UOe=bi();Zu.WebMercatorAuxiliarySphere.getExtent(0,0,0,UOe);const $yt=bi([-180,-90,180,90]),Lyt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Dyt="Surface extent is too large for tile resolution at level 0.",Nyt=3;let Fyt=Nyt;function ZZ(t){return t<4?3:Fyt}let L1=class extends ws.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=q$}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||A(e.extent)||A(e.spatialReference))return null;const i=Xk(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return vt((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,Ye.WGS84)}elevationAt(e,i){var r;if(A(this.extent)||!hc(this.extent,e,i)){const s=b(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return le.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return vt((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return DOe(e.clone(),this)}};u([p({readOnly:!0})],L1.prototype,"demResolution",void 0),u([p({readOnly:!0})],L1.prototype,"extent",null),u([p({readOnly:!0})],L1.prototype,"noDataValue",void 0),u([p()],L1.prototype,"spatialReference",null),u([p({constructOnly:!0})],L1.prototype,"view",void 0),L1=u([N("esri.views.support.GroundViewElevationSampler")],L1);const Uyt=L1;let D1=class extends Ee{constructor(e){super(e),this._handles=new ir,this.view=null,this.layerViews=new xt}initialize(){this._handles.add(wa(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Uyt({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>ae(()=>e.updating,()=>this._updateUpdating(),Mi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],D1.prototype,"elevationSampler",null),u([p({type:Boolean,readOnly:!0})],D1.prototype,"updating",null),u([p({constructOnly:!0})],D1.prototype,"view",void 0),u([p({type:xt,readOnly:!0})],D1.prototype,"layerViews",void 0),u([p({readOnly:!0})],D1.prototype,"suspended",null),D1=u([N("esri.views.GroundView")],D1);const kyt=D1,qO=()=>se(()=>import("./TileLayerView3D-5ff377c9.js"),["assets/TileLayerView3D-5ff377c9.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/MapServiceLayerViewHelper-34527599.js","assets/drapedUtils-8847b824.js","assets/popupUtils-fdf02f9f.js"]),lpe=()=>se(()=>import("./ElevationLayerView3D-1fa2cf01.js"),["assets/ElevationLayerView3D-1fa2cf01.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/LayerView-fee1e4f7.js"]),cpe={"base-dynamic":()=>se(()=>import("./BaseDynamicLayerView3D-15ed339b.js"),["assets/BaseDynamicLayerView3D-15ed339b.js","assets/DynamicLayerView3D-fc8eb574.js","assets/LayerView3D-2f960f05.js","assets/projectExtentUtils-f23a1505.js","assets/ImageMaterial-16df11df.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),"base-elevation":lpe,"base-tile":qO,"bing-maps":qO,"building-scene":()=>se(()=>import("./BuildingSceneLayerView3D-3effcca2.js"),["assets/BuildingSceneLayerView3D-3effcca2.js","assets/BuildingGroupSublayer-5c73cac7.js","assets/BuildingComponentSublayer-7e173974.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-34618750.js","assets/I3SLayerDefinitions-bf0cf266.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/popupUtils-fdf02f9f.js","assets/I3SMeshView3D-c0eb2a0a.js","assets/I3SOverrides-39895cea.js","assets/I3SNode-5e16d2d0.js","assets/RenderTexture-0f2142b8.js","assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/SceneModification-cb872ed3.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/SceneLayerWorker-6944e21b.js","assets/I3SQueryFeatureStore-ca83f922.js","assets/DefinitionExpressionSceneLayerView-65c77ccf.js"]),csv:()=>se(()=>import("./CSVLayerView3D-1ebcb8a2.js"),["assets/CSVLayerView3D-1ebcb8a2.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),dimension:()=>se(()=>import("./DimensionLayerView3D-71c3195d.js"),["assets/DimensionLayerView3D-71c3195d.js","assets/LayerView3D-2f960f05.js","assets/LayerView-fee1e4f7.js"]),elevation:lpe,feature:()=>se(()=>import("./FeatureLayerView3D-d8fe2f2f.js"),["assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),geojson:()=>se(()=>import("./GeoJSONLayerView3D-812f0b47.js"),["assets/GeoJSONLayerView3D-812f0b47.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),graphics:()=>se(()=>import("./GraphicsLayerView3D-88ac4a5b.js"),["assets/GraphicsLayerView3D-88ac4a5b.js","assets/LayerView3D-2f960f05.js","assets/queryForSymbologySnapping-28f1961f.js","assets/GraphicsProcessor-4e60627d.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView-fee1e4f7.js"]),group:()=>se(()=>import("./GroupLayerView-551572a5.js"),["assets/GroupLayerView-551572a5.js","assets/LayerView-fee1e4f7.js"]),imagery:()=>se(()=>import("./ImageryLayerView3D-ce0b8b67.js"),["assets/ImageryLayerView3D-ce0b8b67.js","assets/DynamicLayerView3D-fc8eb574.js","assets/LayerView3D-2f960f05.js","assets/projectExtentUtils-f23a1505.js","assets/ImageMaterial-16df11df.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/ImageryLayerView-946c4247.js","assets/popupUtils-fdf02f9f.js"]),"integrated-mesh":()=>se(()=>import("./IntegratedMeshLayerView3D-64df9d52.js"),["assets/IntegratedMeshLayerView3D-64df9d52.js","assets/I3SMeshView3D-c0eb2a0a.js","assets/I3SOverrides-39895cea.js","assets/I3SNode-5e16d2d0.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/RenderTexture-0f2142b8.js","assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/SceneModification-cb872ed3.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/SceneLayerWorker-6944e21b.js"]),"line-of-sight":()=>se(()=>import("./LineOfSightLayerView3D-b7fd7bc3.js"),["assets/LineOfSightLayerView3D-b7fd7bc3.js","assets/LayerView3D-2f960f05.js","assets/LayerView-fee1e4f7.js"]),"map-image":()=>se(()=>import("./MapImageLayerView3D-158dfcd6.js"),["assets/MapImageLayerView3D-158dfcd6.js","assets/DynamicLayerView3D-fc8eb574.js","assets/LayerView3D-2f960f05.js","assets/projectExtentUtils-f23a1505.js","assets/ImageMaterial-16df11df.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/MapImageLayerView-a96e688e.js","assets/MapServiceLayerViewHelper-34527599.js","assets/drapedUtils-8847b824.js","assets/popupUtils-fdf02f9f.js"]),media:()=>se(()=>import("./MediaLayerView3D-f80177c5.js"),["assets/MediaLayerView3D-f80177c5.js","assets/MediaElementView-3b774207.js","assets/normalizeUtilsSync-360fb6bc.js","assets/LayerView3D-2f960f05.js","assets/ImageMaterial-16df11df.js","assets/LayerView-fee1e4f7.js"]),"ogc-feature":()=>se(()=>import("./OGCFeatureLayerView3D-c8302540.js"),["assets/OGCFeatureLayerView3D-c8302540.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/OGCFeatureLayerView-e9339ed8.js"]),"open-street-map":qO,"oriented-imagery":()=>se(()=>import("./FeatureLayerView3D-d8fe2f2f.js"),["assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),"point-cloud":()=>se(()=>import("./PointCloudLayerView3D-b3528940.js").then(t=>t.P),["assets/PointCloudLayerView3D-b3528940.js","assets/LayerView3D-2f960f05.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/PointCloudWorkerUtil-81f54173.js","assets/PointCloudUniqueValueRenderer-d2a220ca.js","assets/PopupSceneLayerView-9108dd79.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js"]),voxel:()=>se(()=>import("./VoxelLayerView3D-1123a35e.js"),["assets/VoxelLayerView3D-1123a35e.js","assets/LayerView3D-2f960f05.js","assets/PopupSceneLayerView-9108dd79.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js"]),route:()=>se(()=>import("./RouteLayerView3D-37dfd1de.js"),["assets/RouteLayerView3D-37dfd1de.js","assets/Stop-158dd4e3.js","assets/LayerView3D-2f960f05.js","assets/GraphicsProcessor-4e60627d.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/projectExtentUtils-f23a1505.js","assets/EventedSet-5497911d.js","assets/LayerView-fee1e4f7.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?se(()=>import("./SceneLayerView3D-b205b70c.js"),["assets/SceneLayerView3D-b205b70c.js","assets/I3SMeshView3D-c0eb2a0a.js","assets/I3SOverrides-39895cea.js","assets/I3SNode-5e16d2d0.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/RenderTexture-0f2142b8.js","assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/SceneModification-cb872ed3.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/SceneLayerWorker-6944e21b.js","assets/SceneLayerView-05a94f59.js","assets/DefinitionExpressionSceneLayerView-65c77ccf.js","assets/I3SQueryFeatureStore-ca83f922.js","assets/PopupSceneLayerView-9108dd79.js"]):se(()=>import("./SceneLayerGraphicsView3D-50afe96d.js"),["assets/SceneLayerGraphicsView3D-50afe96d.js","assets/I3SOverrides-39895cea.js","assets/I3SNode-5e16d2d0.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/RenderTexture-0f2142b8.js","assets/FeatureLayerView3D-d8fe2f2f.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/SceneLayerView-05a94f59.js","assets/DefinitionExpressionSceneLayerView-65c77ccf.js","assets/PopupSceneLayerView-9108dd79.js"]),stream:()=>se(()=>import("./StreamLayerView3D-0135a2c2.js"),["assets/StreamLayerView3D-0135a2c2.js","assets/StreamFeatureManager-38a173ae.js","assets/CircularArray-7b2394fa.js","assets/createConnection-8ff8a841.js","assets/EventedSet-5497911d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/LayerView-fee1e4f7.js"]),tile:qO,"imagery-tile":()=>se(()=>import("./ImageryTileLayerView3D-1a50bfe1.js"),["assets/ImageryTileLayerView3D-1a50bfe1.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/ImageryTileLayerView-df398d83.js","assets/rasterProjectionHelper-00c1b486.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/drapedUtils-8847b824.js"]),"vector-tile":()=>se(()=>import("./VectorTileLayerView3D-a53ecc32.js"),["assets/VectorTileLayerView3D-a53ecc32.js","assets/TileInfoViewPOT-ac5f73ba.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-da353a58.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/WGLBrushVTLSymbol-69c603f9.js","assets/definitions-19bfb61c.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/VTLMaterialManager-5216362a.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/StyleRepository-7fc711a8.js","assets/colorUtils-7641d345.js","assets/GeometryUtils-53652037.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/LayerView-fee1e4f7.js"]),wcs:()=>se(()=>import("./ImageryTileLayerView3D-1a50bfe1.js"),["assets/ImageryTileLayerView3D-1a50bfe1.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/ImageryTileLayerView-df398d83.js","assets/rasterProjectionHelper-00c1b486.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/drapedUtils-8847b824.js"]),"web-tile":qO,wfs:()=>se(()=>import("./WFSLayerView3D-df533a09.js"),["assets/WFSLayerView3D-df533a09.js","assets/FeatureLayerViewBase3D-467fa76d.js","assets/FeatureLikeLayerView3D-1af64c96.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/queryForSymbologySnapping-28f1961f.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/heatmapTextureUtils-056b357c.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView3D-2f960f05.js","assets/EventedSet-5497911d.js","assets/FeatureLayerView-92821e96.js","assets/popupUtils-fdf02f9f.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),wms:()=>se(()=>import("./WMSLayerView3D-e328aa79.js"),["assets/WMSLayerView3D-e328aa79.js","assets/DynamicLayerView3D-fc8eb574.js","assets/LayerView3D-2f960f05.js","assets/projectExtentUtils-f23a1505.js","assets/ImageMaterial-16df11df.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js","assets/WMSLayerView-7966db0e.js"]),wmts:()=>se(()=>import("./WMTSLayerView3D-4a4a2b7a.js"),["assets/WMTSLayerView3D-4a4a2b7a.js","assets/LayerView3D-2f960f05.js","assets/TiledLayerView3D-33f29f16.js","assets/LayerView-fee1e4f7.js","assets/RefreshableLayerView-7dc52eae.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Vyt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new J(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const upe={hasLayerViewModule:t=>b(cpe[t.type]),importLayerView:t=>{const e=cpe[t.type];if(A(e))throw Vyt(t);return e(t)}},hpe="analyses-owner-handles";var TM,kT;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(TM||(TM={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(kT||(kT={}));let aT=class extends Y2{constructor(e){super(e),this._allAnalysisViews=new xt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=dpe(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(er("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(er()),this._attachedToViewResolver=dpe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(A(i)||i.state.list===kT.REMOVED)throw new J("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),hpe)}_disconnectOwners(){this.handles.remove(hpe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:TM.PENDING,list:kT.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=jL(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=kT.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=kT.REMOVED,this._scheduleUpdate()):le.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){b(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=yS(()=>this._update()))}_update(){this._scheduledUpdateHandle=is(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===kT.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case TM.PENDING:e.createAnalysisViewTask=lu(e.createAnalysisViewTask);break;case TM.CREATED:b(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=He(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,A(n.module))try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(yo(i))throw this._creatingViewCount-=1,er("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(yo(i))throw this._creatingViewCount-=1,o.destroy(),er("AnalysisView creation aborted");return e.view=o,e.state.view=TM.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return se(()=>import("./AreaMeasurementAnalysisView3D-abd67d7b.js").then(i=>i.A),["assets/AreaMeasurementAnalysisView3D-abd67d7b.js","assets/UnitNormalizer-a48c44a6.js","assets/quantityFormatUtils-018bdc61.js","assets/AnalysisView3D-e2ceb63d.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/measurementUtils-999dc2c1.js","assets/LineVisualElement-78cd90ab.js","assets/EditGeometryOperations-db5a0065.js","assets/analysisThemeUtils-2730aa3c.js","assets/Segment-81cd44da.js","assets/TextOverlayItem-5acee2ee.js"]);case"dimension":return se(()=>import("./DimensionAnalysisView3D-8c3842f4.js"),["assets/DimensionAnalysisView3D-8c3842f4.js","assets/AnalysisView3D-e2ceb63d.js","assets/LengthDimension-ff94a894.js","assets/quantityFormatUtils-018bdc61.js","assets/Segment-81cd44da.js","assets/LineVisualElement-78cd90ab.js","assets/TextOverlayItem-5acee2ee.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/Factory-e452a86d.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/analysisViewUtils-8e8822f7.js","assets/RenderTexture-0f2142b8.js"]);case"direct-line-measurement":return se(()=>import("./DirectLineMeasurementAnalysisView3D-a2a8a55f.js").then(i=>i.D),["assets/DirectLineMeasurementAnalysisView3D-a2a8a55f.js","assets/UnitNormalizer-a48c44a6.js","assets/quantityFormatUtils-018bdc61.js","assets/AnalysisView3D-e2ceb63d.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/LineVisualElement-78cd90ab.js","assets/analysisThemeUtils-2730aa3c.js","assets/Segment-81cd44da.js","assets/TextOverlayItem-5acee2ee.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/VisualElementResources-0bf527a0.js"]);case"line-of-sight":return se(()=>import("./LineOfSightAnalysisView3D-be22b847.js"),["assets/LineOfSightAnalysisView3D-be22b847.js","assets/AnalysisView3D-e2ceb63d.js","assets/LineOfSightAnalysisTarget-0481e093.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/LineVisualElement-78cd90ab.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/manipulatorUtils-a50340e3.js","assets/PointVisualElement-436a9da2.js","assets/VisualElementResources-0bf527a0.js","assets/analysisViewUtils-8e8822f7.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js"]);case"slice":return se(()=>import("./SliceAnalysisView3D-e8d330ab.js"),["assets/SliceAnalysisView3D-e8d330ab.js","assets/AnalysisView3D-e2ceb63d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/LineVisualElement-78cd90ab.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/BuildingComponentSublayer-7e173974.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-34618750.js","assets/I3SLayerDefinitions-bf0cf266.js","assets/I3SUtil-6c216874.js","assets/I3SBinaryReader-90fedac1.js","assets/popupUtils-fdf02f9f.js","assets/Factory-e452a86d.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/analysisViewUtils-8e8822f7.js"])}}};function dpe(){const t=zb();return t.promise.catch(()=>{}),t}u([p()],aT.prototype,"updating",null),u([p({constructOnly:!0})],aT.prototype,"view",void 0),u([p()],aT.prototype,"_allAnalysisViews",void 0),u([p()],aT.prototype,"_creatingViewCount",void 0),aT=u([N("esri.views.3d.analysis.AnalysisViewManager3D")],aT);const zyt=aT;let U0=class extends Ee{constructor(e){super(e),this.collision=new NP,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===it.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==it.Local?this._set("altitude",e):le.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Se(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Se(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===it.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=SG)=>(r.min=Ka.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?H6([[4e3,Ka.max],[1e4,ci(88)],[6e6,ci(88)]]):()=>Ka.max;return(i,r=SG)=>(r.min=Ka.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?H6([[4e3,Ka.max],[5e4,ci(88)],[6e6,ci(88)],[2e7,Ka.min]]):H6([[3e5,Ka.max],[3e6,ci(88)],[6e6,ci(88)],[2e7,Ka.min]]);return(i,r=SG)=>(r.min=Ka.min,r.max=e(i),r)}};function Byt(t){return{min:-2e5,max:4*t.radius}}u([p()],U0.prototype,"altitude",null),u([p({readOnly:!0})],U0.prototype,"collision",void 0),u([p()],U0.prototype,"distance",void 0),u([p({readOnly:!0})],U0.prototype,"minimumPoiDistance",void 0),u([p()],U0.prototype,"tilt",void 0),u([p({constructOnly:!0})],U0.prototype,"mode",void 0),U0=u([N("esri.views.3d.state.Constraints")],U0);const ppe=Byt(zi),Ka={min:ci(.5),max:ci(179.5)},SG={min:0,max:0};let NP=class extends Ee{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],NP.prototype,"enabled",void 0),u([p({type:Number})],NP.prototype,"elevationMargin",void 0),NP=u([N("esri.views.3d.state.Constraints.CollisionConstraint")],NP);let SM=class extends Ee{constructor(){super(...arguments),this.min=ppe.min,this.max=ppe.max}};u([p({type:Number})],SM.prototype,"min",void 0),u([p({type:Number})],SM.prototype,"max",void 0),SM=u([N("esri.views.3d.constraints.AltitudeConstraint")],SM);let X0=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([p({type:Number,value:1e-8})],X0.prototype,"near",null),u([pi("near")],X0.prototype,"castNear",null),u([p({type:Number,value:1e-8})],X0.prototype,"far",null),u([pi("far")],X0.prototype,"castFar",null),u([p({type:["auto","manual"]})],X0.prototype,"mode",void 0),X0=u([N("esri.views.3d.constraints.ClipDistanceConstraint")],X0);const JZ={min:Sc(Ka.min),max:Sc(Ka.max)};let VT=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Se(e,JZ.min,JZ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],VT.prototype,"mode",void 0),u([p({type:Number,value:JZ.max})],VT.prototype,"max",null),u([pi("max")],VT.prototype,"castMax",null),VT=u([N("esri.views.3d.constraints.TiltConstraint")],VT);let zT=class extends Ee{constructor(){super(...arguments),this.tilt=new VT,this.altitude=new SM,this.clipDistance=new X0}};u([p({type:VT})],zT.prototype,"tilt",void 0),u([p({type:SM})],zT.prototype,"altitude",void 0),u([p({type:X0})],zT.prototype,"clipDistance",void 0),zT=u([N("esri.views.3d.constraints.Constraints")],zT);var KZ;let Kd=KZ=class extends Ae{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new KZ(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],Kd.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Kd.prototype,"date",void 0),u([De("date",["datetime"])],Kd.prototype,"readDate",null),u([Xe("date")],Kd.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Kd.prototype,"directShadowsEnabled",void 0),u([De("directShadowsEnabled",["directShadows"])],Kd.prototype,"readDirectShadowsEnabled",null),u([Xe("directShadowsEnabled")],Kd.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],Kd.prototype,"displayUTCOffset",void 0),u([Xe("displayUTCOffset")],Kd.prototype,"writeDisplayUTCOffset",null),Kd=KZ=u([N("esri.webscene.SunLighting")],Kd);const W$=Kd;var GC;let Rg=GC=class extends ws.EventedMixin(W$){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new GC(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=GC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;b(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=GC.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(EG.target=this,EG.timezoneOffset=s,this.emit("timezone-will-change",EG)),b(t))return!!isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new GC({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],Rg.prototype,"cameraTrackingEnabled",void 0),u([p({type:Boolean})],Rg.prototype,"ambientOcclusionEnabled",void 0),u([p({type:Boolean})],Rg.prototype,"waterReflectionEnabled",void 0),u([p({type:Date})],Rg.prototype,"defaultDate",null),u([p({type:Date})],Rg.prototype,"date",null),Rg=GC=u([N("esri.views.3d.environment.SunLighting")],Rg),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(Rg||(Rg={}));const EG={target:null,timezoneOffset:0},N1=Rg;var QZ;let FP=QZ=class extends Ae{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new QZ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:!0}})],FP.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],FP.prototype,"directShadowsEnabled",void 0),FP=QZ=u([N("esri.webscene.VirtualLighting")],FP);const QV=FP;var q6;let jC=q6=class extends ws.EventedMixin(QV){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new q6({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new q6(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],jC.prototype,"ambientOcclusionEnabled",void 0),u([p({type:Boolean})],jC.prototype,"waterReflectionEnabled",void 0),u([p({type:Boolean})],jC.prototype,"cameraTrackingEnabled",void 0),jC=q6=u([N("esri.views.3d.environment.VirtualLighting")],jC);const UP=jC,Gyt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:N1,virtual:UP}};var eJ;let BI=eJ=class extends Ee{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new eJ({quality:this.quality})}};u([p({type:["low","high"],value:"low"})],BI.prototype,"quality",null),BI=eJ=u([N("esri.views.3d.environment.SceneViewAtmosphere")],BI);var tJ;let kP=tJ=class extends Ae{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new tJ({cloudCover:this.cloudCover})}};u([It({sunny:"sunny"})],kP.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],kP.prototype,"cloudCover",void 0),kP=tJ=u([N("esri.views.3d.environment.SunnyWeather")],kP);const iJ=kP;var rJ;let VP=rJ=class extends Ae{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new rJ({cloudCover:this.cloudCover})}};u([It({cloudy:"cloudy"})],VP.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],VP.prototype,"cloudCover",void 0),VP=rJ=u([N("esri.views.3d.environment.CloudyWeather")],VP);const jyt=VP;var sJ;let zP=sJ=class extends Ae{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new sJ({fogStrength:this.fogStrength})}};u([It({foggy:"foggy"})],zP.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],zP.prototype,"fogStrength",void 0),zP=sJ=u([N("esri.views.3d.environment.FoggyWeather")],zP);const Hyt=zP;var nJ;let HC=nJ=class extends Ae{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new nJ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([It({rainy:"rainy"})],HC.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],HC.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],HC.prototype,"precipitation",void 0),HC=nJ=u([N("esri.views.3d.environment.RainyWeather")],HC);const qyt=HC;var oJ;let lT=oJ=class extends Ae{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new oJ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([It({snowy:"snowy"})],lT.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lT.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lT.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],lT.prototype,"snowCover",void 0),lT=oJ=u([N("esri.views.3d.environment.SnowyWeather")],lT);const Wyt=lT,kOe={key:"type",base:iJ,typeMap:{sunny:iJ,cloudy:jyt,rainy:qyt,snowy:Wyt,foggy:Hyt}},Yyt=Object.keys(kOe.typeMap);function Xyt(t,e){return!!Yyt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const pp=1e4,Zyt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:W$,virtual:QV}};let W6=class extends Ae{constructor(e){super(e)}clone(){}};u([p({readOnly:!0,json:{read:!1}})],W6.prototype,"type",void 0),W6=u([N("esri.webscene.background.Background")],W6);const VOe=W6;var aJ;const Jyt={...ev,nonNullable:!0};let BP=aJ=class extends VOe{constructor(t){super(t),this.type="color",this.color=new et([0,0,0,1])}clone(){return new aJ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([It({color:"color"},{readOnly:!0})],BP.prototype,"type",void 0),u([p(Jyt)],BP.prototype,"color",void 0),BP=aJ=u([N("esri.webscene.background.ColorBackground")],BP);const zOe=BP,fpe={base:VOe,key:"type",typeMap:{color:zOe}};function Kyt(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const Qyt={types:fpe,json:{read:Kyt(fpe),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var lJ;const BOe="esri.webscene.Environment",e0t=le.getLogger(BOe),mpe=(t,e,i)=>({enabled:!i||!i.isPresentation});let F1=lJ=class extends Ae{constructor(t){super(t),this.lighting=new W$,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Xyt(t==null?void 0:t.type,e0t)&&this._set("weather",t)}clone(){return new lJ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?QV.prototype.clone.call(this.lighting):W$.prototype.clone.call(this.lighting),background:ue(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:Zyt,nonNullable:!0,json:{write:!0}})],F1.prototype,"lighting",void 0),u([p(Qyt)],F1.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:mpe}}})],F1.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:mpe}}})],F1.prototype,"starsEnabled",void 0),u([p({types:kOe,nonNullable:!0,json:{write:!0},value:new iJ})],F1.prototype,"weather",null),F1=lJ=u([N(BOe)],F1);const GOe=F1;var GP;let qC=GP=class extends GOe{constructor(t){super(t),this.atmosphere=new BI,this.lighting=new N1,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new GP({...e,lighting:e.lighting?e.lighting.type==="virtual"?UP.fromWebsceneLighting(e.lighting):N1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,i;return t?t instanceof N1||t instanceof UP?t:t instanceof W$?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new N1({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof QV?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new UP({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):xm(Gyt,t):new N1}clone(){return new GP({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ue(this.background)})}cloneWithWebsceneEnvironment(t){return new GP({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ue(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):N1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):UP.fromWebsceneLighting(t.lighting);default:return t.lighting,N1.fromWebsceneLighting(t.lighting)}}};u([p({type:BI,json:{read:!1},nonNullable:!0})],qC.prototype,"atmosphere",void 0),u([p({nonNullable:!0})],qC.prototype,"lighting",void 0),u([pi("lighting")],qC.prototype,"castLighting",null),qC=GP=u([N("esri.views.3d.environment.SceneViewEnvironment")],qC);const WC=qC;var Io;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(Io||(Io={}));function kre(t){return Se((t-1e5)/(1e6-1e5),0,1)}const cJ=1e4,t0t=.085,Y$=1e5;let i0t=class{};const Br=i0t;function T(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(T||(T={}));var P;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(P||(P={}));var Nn;function gy(t,e){switch(e.textureCoordinateType){case Nn.Default:return t.attributes.add(P.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Nn.Compressed:return t.attributes.add(P.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Nn.Atlas:return t.attributes.add(P.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(P.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Nn.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case Nn.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Nn||(Nn={}));function _h(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Sd(t){t.include(_h),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function ez(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Vr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Vr||(Vr={}));let dn=class{constructor(e,i,r,s,n=null){this.name=e,this.type=i,this.arraySize=n,this.bind={[Vr.Pass]:null,[Vr.Draw]:null},b(r)&&b(s)&&(this.bind[r]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},fi=class extends dn{constructor(e,i){super(e,"vec3",Vr.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}},Be=class extends dn{constructor(e,i){super(e,"float",Vr.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function nv(t){t.uniforms.add(new fi("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Uy(t){t.uniforms.add(new fi("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function r0t(t,e){e.useLegacyTerrainShading?t.uniforms.add(new Be("lightingFixedFactor",(i,r)=>r.lighting.noonFactor*(1-r.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function d9(t,e){const i=t.fragment;nv(i),Uy(i),r0t(i,e),i.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let hr=class extends dn{constructor(e,i){super(e,"vec2",Vr.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}},Ni=class extends dn{constructor(e,i){super(e,"vec4",Vr.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},Ps=class extends dn{constructor(e,i){super(e,"mat4",Vr.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const jOe=le.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let HOe=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){jOe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))r[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${e[n]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},ar=class extends HOe{constructor(){super(...arguments),this.vertex=new gpe,this.fragment=new gpe,this.attributes=new o0t,this.varyings=new a0t,this.extensions=new uJ,this.constants=new qOe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?c0t:l0t,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];b(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];b(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](i,o,a,l)}}},s0t=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(A(e))jOe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new J(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>b(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},n0t=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},gpe=class extends HOe{constructor(){super(...arguments),this.uniforms=new s0t,this.code=new n0t,this.constants=new qOe}get builder(){return this}},o0t=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}},a0t=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},uJ=class hJ{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?hJ.ALLOWLIST_VERTEX:hJ.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};uJ.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],uJ.ALLOWLIST_VERTEX=[];let qOe=class lo{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=lo._numberToFloatStr(r);break;case"int":s=lo._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${lo._numberToFloatStr(r[0])},                            ${lo._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${lo._numberToFloatStr(r[0])},                            ${lo._numberToFloatStr(r[1])},                            ${lo._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${lo._numberToFloatStr(r[0])},                            ${lo._numberToFloatStr(r[1])},                            ${lo._numberToFloatStr(r[2])},                            ${lo._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${lo._numberToIntStr(r[0])},                             ${lo._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${lo._numberToIntStr(r[0])},                             ${lo._numberToIntStr(r[1])},                             ${lo._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${lo._numberToIntStr(r[0])},                             ${lo._numberToIntStr(r[1])},                             ${lo._numberToIntStr(r[2])},                             ${lo._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>lo._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const l0t=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,c0t=`precision highp float;
precision highp sampler2D;`,Vre="Size",tz="InvSize";function Pp(t,e,i=!1,r=0){if(t.hasWebGL2Context){const s=T`vec2(textureSize(${e}, ${T.int(r)}))`;return i?"(1.0 / "+s+")":s}return i?e+tz:e+Vre}function _c(t,e,i,r=null,s=0){if(t.hasWebGL2Context)return T`texelFetch(${e}, ivec2(${i}), ${T.int(s)})`;let n=T`texture2D(${e}, ${i} * `;return n+=r?T`(${r}))`:T`${e+tz})`,n}var Ar;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(Ar||(Ar={}));let Yt=class extends dn{constructor(e,i){super(e,"sampler2D",Vr.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function ym(t,e,i=Ar.None){const r=[new Yt(t,e)];if(i&Ar.Size){const s=t+Vre;r.push(new hr(s,(n,o)=>{const a=e(n,o);return b(a)?Vt(ype,a.descriptor.width,a.descriptor.height):mu}))}if(i&Ar.InvSize){const s=t+tz;r.push(new hr(s,(n,o)=>{const a=e(n,o);return b(a)?Vt(ype,1/a.descriptor.width,1/a.descriptor.height):mu}))}return r}const ype=je(),GI=Ve(parseFloat(5802e-9 .toFixed(6)),parseFloat(13558e-9 .toFixed(6)),parseFloat(331e-7 .toFixed(6))),CG=3,MG=Ve(CG*parseFloat(65e-8 .toFixed(6)),CG*parseFloat(1881e-9 .toFixed(6)),CG*parseFloat(85e-9 .toFixed(6))),u0t=3996e-9,h0t=Ve(parseFloat(Number(GI[0]+MG[0]).toFixed(6)),parseFloat(Number(GI[1]+MG[1]).toFixed(6)),parseFloat(Number(GI[2]+MG[2]).toFixed(6)));function d0t(t){const e=new ar;e.attributes.add(P.POSITION,"vec2"),e.include(gy,{textureCoordinateType:Nn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Ps("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(s,n)=>C3(p0t,n.camera.viewMatrix))]),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new hr("radii",s=>s.radii),new fi("cameraPosition",(s,n)=>n.camera.eye),new Ni("heightParameters",s=>s.heightParameters),new Be("innerFadeDistance",s=>s.innerFadeDistance),new Be("altitudeFade",s=>s.altitudeFade),new Yt("depthTex",s=>s.depthTex),new Be("hazeStrength",s=>s.hazeStrength)]),r.constants.add("betaRayleigh","vec3",GI),r.constants.add("betaCombined","vec3",h0t),r.constants.add("betaMie","float",u0t),r.constants.add("scaleHeight","float",t0t*Y$),nv(r),e.include(ez),t.haze&&(r.include(Sd),r.uniforms.add(new hr("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(T`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?T``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:T`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:T`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const p0t=Ge(),f0t=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:GI,build:d0t},Symbol.toStringTag,{value:"Module"}));let lr=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var _s,Xt,Ne,Ay,Wt,am,QA,Mt,hs,Tn,mt,qt,Ut,Qe,Bt,Zt,pc,or,rd,na,en,sr;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(_s||(_s={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Xt||(Xt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ne||(Ne={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Ay||(Ay={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Wt||(Wt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(am||(am={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(QA||(QA={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Mt||(Mt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(hs||(hs={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Tn||(Tn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(mt||(mt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(qt||(qt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ut||(Ut={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Qe||(Qe={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Bt||(Bt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Zt||(Zt={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(pc||(pc={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(or||(or={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(rd||(rd={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(na||(na={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(en||(en={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(sr||(sr={}));const AG=33984;var zo,Hh;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(zo||(zo={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Hh||(Hh={}));const _pe=33306;var _n,cc,vpe,bpe,p9,dJ,wpe;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(_n||(_n={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(cc||(cc={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(vpe||(vpe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(bpe||(bpe={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(p9||(p9={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(dJ||(dJ={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(wpe||(wpe={}));let dr=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=dt(this._program),this._pipeline=this._configuration=null}reload(e){dt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,i=null,r){e.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Xt.TRIANGLES}getPipelineState(e,i){return this._pipeline}initializeConfiguration(e,i){}};const rr=new Map([[P.POSITION,0],[P.NORMAL,1],[P.UV0,2],[P.COLOR,3],[P.SIZE,4],[P.TANGENT,4],[P.AUXPOS1,5],[P.SYMBOLCOLOR,5],[P.AUXPOS2,6],[P.FEATUREATTRIBUTE,6],[P.INSTANCEFEATUREATTRIBUTE,6],[P.INSTANCECOLOR,7],[P.OBJECTANDLAYERIDCOLOR,7],[P.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[P.MODEL,8],[P.MODELNORMAL,12],[P.MODELORIGINHI,11],[P.MODELORIGINLO,15]]),m0t=le.getLogger("esri.views.webgl.checkWebGLError");function g0t(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const WOe=!!me("enable-feature:webgl-debug");function Xh(){return WOe}function pJ(){return WOe}function ib(t){if(Xh()){const e=t.getError();if(e){const i=g0t(t,e),r=new Error().stack;m0t.error(new J("webgl-error","WebGL error occured",{message:i,stack:r}))}}}let cr=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new vi({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(Vr.Pass,this),this.bindDraw=i.generateBind(Vr.Draw,this),this._fragmentUniforms=Xh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(A(i)||i.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),b(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var ts,Q2,vn,S_,uu,q_,Ib,e3,Nr,eS,c_;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(ts||(ts={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Q2||(Q2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(vn||(vn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(S_||(S_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(uu||(uu={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(q_||(q_={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(Ib||(Ib={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(e3||(e3={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Nr||(Nr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(eS||(eS={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(c_||(c_={}));function Um(t,e,i=Ay.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function qo(t,e,i,r,s=Ay.ADD,n=Ay.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const zre={face:am.BACK,mode:QA.CCW},YOe={face:am.FRONT,mode:QA.CCW},iz=t=>t===ts.Back?zre:t===ts.Front?YOe:null,gu={zNear:0,zFar:1},wi={r:!0,g:!0,b:!0,a:!0};function y0t(t){return E0t.intern(t)}function _0t(t){return C0t.intern(t)}function v0t(t){return M0t.intern(t)}function b0t(t){return A0t.intern(t)}function w0t(t){return O0t.intern(t)}function x0t(t){return R0t.intern(t)}function T0t(t){return P0t.intern(t)}function S0t(t){return I0t.intern(t)}function si(t){return $0t.intern(t)}let ov=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function av(t){return"["+t.join(",")+"]"}const E0t=new ov(XOe,t=>({__tag:"Blending",...t}));function XOe(t){return t?av([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const C0t=new ov(ZOe,t=>({__tag:"Culling",...t}));function ZOe(t){return t?av([t.face,t.mode]):null}const M0t=new ov(JOe,t=>({__tag:"PolygonOffset",...t}));function JOe(t){return t?av([t.factor,t.units]):null}const A0t=new ov(KOe,t=>({__tag:"DepthTest",...t}));function KOe(t){return t?av([t.func]):null}const O0t=new ov(QOe,t=>({__tag:"StencilTest",...t}));function QOe(t){return t?av([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const R0t=new ov(eRe,t=>({__tag:"DepthWrite",...t}));function eRe(t){return t?av([t.zNear,t.zFar]):null}const P0t=new ov(tRe,t=>({__tag:"ColorWrite",...t}));function tRe(t){return t?av([t.r,t.g,t.b,t.a]):null}const I0t=new ov(iRe,t=>({__tag:"StencilWrite",...t}));function iRe(t){return t?av([t.mask]):null}const $0t=new ov(L0t,t=>({blending:y0t(t.blending),culling:_0t(t.culling),polygonOffset:v0t(t.polygonOffset),depthTest:b0t(t.depthTest),stencilTest:w0t(t.stencilTest),depthWrite:x0t(t.depthWrite),colorWrite:T0t(t.colorWrite),stencilWrite:S0t(t.stencilWrite)}));function L0t(t){return t?av([XOe(t.blending),ZOe(t.culling),JOe(t.polygonOffset),KOe(t.depthTest),QOe(t.stencilTest),eRe(t.depthWrite),tRe(t.colorWrite),iRe(t.stencilWrite)]):null}let D0t=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},N0t=class extends Br{constructor(){super(...arguments),this.heightParameters=Ai(),this.radii=je(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},fJ=class rRe extends dr{initializeProgram(e){return new cr(e.rctx,rRe.shader.get().build(this.configuration),rr)}initializePipeline(){return this.configuration.haze?si({blending:qo(Ne.ONE,Ne.ZERO,Ne.ONE_MINUS_SRC_COLOR,Ne.ONE),colorWrite:wi}):si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};fJ.shader=new lr(f0t,()=>se(()=>import("./ChapmanAtmosphere.glsl-1df13213.js"),[]));let Hl=class extends Br{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function X(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(h){if(this[r]!==h&&(this[r]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof h)}})}}}let sRe=class extends Hl{constructor(){super(...arguments),this.haze=!1}};u([X()],sRe.prototype,"haze",void 0);let Ba=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new Ba(P.POSITION,3,Mt.FLOAT,0,12);new Ba(P.POSITION,3,Mt.FLOAT,0,20),new Ba(P.UV0,2,Mt.FLOAT,12,20);new Ba(P.POSITION,3,Mt.FLOAT,0,32),new Ba(P.NORMAL,3,Mt.FLOAT,12,32),new Ba(P.UV0,2,Mt.FLOAT,24,32);new Ba(P.POSITION,3,Mt.FLOAT,0,16),new Ba(P.COLOR,4,Mt.UNSIGNED_BYTE,12,16);const Bre=[new Ba(P.POSITION,2,Mt.FLOAT,0,8)],Y3=[new Ba(P.POSITION,2,Mt.FLOAT,0,16),new Ba(P.UV0,2,Mt.FLOAT,8,16)];function xpe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function il(t,e){return t.vertexBuffers[e].size/F0t(t.layout[e])}function F0t(t){return t[0].stride}function Gre(t,e,i,r,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function jre(t,e,i,r){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Wt.ARRAY_BUFFER)}function nRe(t){switch(t){case Qe.ALPHA:case Qe.LUMINANCE:case Qe.RED:case Qe.RED_INTEGER:case Bt.R8:case Bt.R8I:case Bt.R8UI:case Bt.R8_SNORM:case pc.STENCIL_INDEX8:return 1;case Qe.LUMINANCE_ALPHA:case Qe.RG:case Qe.RG_INTEGER:case Bt.RGBA4:case Bt.R16F:case Bt.R16I:case Bt.R16UI:case Bt.RG8:case Bt.RG8I:case Bt.RG8UI:case Bt.RG8_SNORM:case Bt.RGB565:case Bt.RGB5_A1:case pc.DEPTH_COMPONENT16:return 2;case Qe.DEPTH_COMPONENT:case Qe.RGB:case Qe.RGB_INTEGER:case Bt.RGB8:case Bt.RGB8I:case Bt.RGB8UI:case Bt.RGB8_SNORM:case Bt.SRGB8:case pc.DEPTH_COMPONENT24:return 3;case Qe.DEPTH_STENCIL:case Qe.RGBA:case Qe.RGBA_INTEGER:case Bt.RGBA8:case Bt.R32F:case Bt.R11F_G11F_B10F:case Bt.RG16F:case Bt.R32I:case Bt.R32UI:case Bt.RG16I:case Bt.RG16UI:case Bt.RGBA8I:case Bt.RGBA8UI:case Bt.RGBA8_SNORM:case Bt.SRGB8_ALPHA8:case Bt.RGB9_E5:case Bt.RGB10_A2UI:case Bt.RGB10_A2:case pc.DEPTH_STENCIL:case pc.DEPTH_COMPONENT32F:case pc.DEPTH24_STENCIL8:return 4;case pc.DEPTH32F_STENCIL8:return 5;case Bt.RGB16F:case Bt.RGB16I:case Bt.RGB16UI:return 6;case Bt.RG32F:case Bt.RG32I:case Bt.RG32UI:case Bt.RGBA16F:case Bt.RGBA16I:case Bt.RGBA16UI:return 8;case Bt.RGB32F:case Bt.RGB32I:case Bt.RGB32UI:return 12;case Bt.RGBA32F:case Bt.RGBA32I:case Bt.RGBA32UI:return 16;case _n.COMPRESSED_RGB_S3TC_DXT1_EXT:case _n.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case _n.COMPRESSED_RGBA_S3TC_DXT3_EXT:case _n.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case _n.COMPRESSED_R11_EAC:case _n.COMPRESSED_SIGNED_R11_EAC:case _n.COMPRESSED_RGB8_ETC2:case _n.COMPRESSED_SRGB8_ETC2:case _n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case _n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case _n.COMPRESSED_RG11_EAC:case _n.COMPRESSED_SIGNED_RG11_EAC:case _n.COMPRESSED_RGBA8_ETC2_EAC:case _n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function tS(t){if(A(t))return 0;if("descriptor"in t)return t.glName?tS(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const i="hasMipmap"in t&&t.hasMipmap?1.3:1,r=t.width*t.height;return nRe(e)*r*i}const Vw=le.getLogger("esri.views.webgl.VertexArrayObject");let qp=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(zo.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].size,b(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var i,r,s;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Vw.warn("Leaked WebGL VAO"));if(this._glName){const n=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):Vw.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const n in this._buffers)(s=this._buffers[n])==null||s.dispose(),delete this._buffers[n];this._indexBuffer=dt(this._indexBuffer)}this._context.instanceCounter.decrement(zo.VertexArrayObject,this),this._context=O2(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Vw.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Vw.error("Vertex buffer is uninitialized!");const a=i[n];a||Vw.error("Vertex element descriptor is empty!"),Gre(this._context,this._locations,o,a)}b(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||Vw.error("Vertex buffer dictionary is empty!");for(const r in e){const s=e[r];s||Vw.error("Vertex buffer is uninitialized!");const n=i[r];jre(this._context,this._locations,s,n)}b(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},km=class extends qp{};const Jm=le.getLogger("esri.views.webgl.BufferObject");let yr=class YC{static createIndex(e,i,r){return new YC(e,Wt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new YC(e,Wt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==Ft.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new YC(e,Wt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=or.STREAM_READ,r){if(e.type!==Ft.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new YC(e,Wt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=or.STREAM_DRAW,r){if(e.type!==Ft.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new YC(e,Wt.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(zo.BufferObject,this),this._glName=this._context.gl.createBuffer(),ib(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Wt.ELEMENT_ARRAY_BUFFER?this._indexType===Mt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Wt.ELEMENT_ARRAY_BUFFER||this.bufferType===Wt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(zo.BufferObject,this),this._context=O2(this._context)):this._glName&&Jm.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&Jm.error("Buffer size needs to be positive!"),this.bufferType===Wt.ELEMENT_ARRAY_BUFFER&&b(i))switch(this._indexType=i,i){case Mt.UNSIGNED_SHORT:e*=2;break;case Mt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Wt.ELEMENT_ARRAY_BUFFER&&(see(e)&&(i/=2,this._indexType=Mt.UNSIGNED_SHORT),nee(e)&&(i/=4,this._indexType=Mt.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;b(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),ib(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteSize)&&Jm.error("offset is out of range!"),r>=s&&Jm.error("end must be bigger than start!"),(i+(s-r))*e.BYTES_PER_ELEMENT>this.byteSize&&Jm.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Ft.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r);else{const a=r===0&&s===e.length?e:e.subarray(r,s);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}ib(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(this._context.type!==Ft.WEBGL2)return void Jm.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Jm.error("Problem getting subdata: offset and length were less than zero!");const n=U0t(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return void Jm.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s??0)>this.byteSize&&Jm.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Wt.COPY_READ_BUFFER),o.getBufferSubData(Wt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Wt.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,s){this._context.type===Ft.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)):Jm.error("Get buffer subdata is supported in WebGL2 only!")}};function U0t(t){return AGe(t)}const OG={target:Ut.TEXTURE_2D,samplingMode:mt.LINEAR,wrapMode:qt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},Tpe=4;let At=class{constructor(e,i,r=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(zo.Texture,this),this._descriptor={...OG,...i};for(const s in OG)this._descriptor[s]===void 0&&(this._descriptor[s]=OG[s]);if(e.type!==Ft.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),zw(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Ut.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(zo.Texture,this))}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Ut.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Ut.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Ut.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=zw(n);e===null&&(s.width=s.width||Tpe,s.height=s.height||Tpe,o&&(s.depth=s.depth??1));const a=this._context.bindTexture(this,At.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(At.TEXTURE_UNIT_FOR_UPDATES),At._validateTexture(this._context,s),this._configurePixelStorage(),ib(r);const l=s.pixelFormat;let c=s.internalFormat??this._deriveInternalFormat(l,s.dataType);if(RG(e)){let h=e.width,d=e.height;const f=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,d,f),this._texImage(n,0,c,h,d,f,e),ib(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=d),o&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:d,depth:f}=s;if(h==null||d==null)throw new Error("Width and height must be specified!");if(o&&f==null)throw new Error("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,d,f),r.DEPTH24_STENCIL8&&c===r.DEPTH_STENCIL&&(c=r.DEPTH24_STENCIL8),Y6(e)){const m=e.levels,g=Spe(n,h,d,f),y=Math.min(g-1,m.length-1);b(this._context.gl2)?r.texParameteri(s.target,this._context.gl2.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&g===m.length;const v=c;if(!V0t(v))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((x,S,E,C)=>{const R=m[Math.min(x,m.length-1)];this._compressedTexImage(n,x,v,S,E,C,R)},y)}else b(e)?(this._texImage(n,0,c,h,d,f,e),ib(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,y,v)=>{this._texImage(n,m,c,g,y,v,null),ib(r)})}At._applySamplingMode(r,this._descriptor),At._applyWrapMode(r,this._descriptor),At._applyAnisotropicFilteringParameters(this._context,this._descriptor),ib(r),this._context.bindTexture(a,At.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:h,dataType:d,target:f,isImmutable:m}=c,g=c.internalFormat??this._deriveInternalFormat(h,d);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,At.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||s>c.width||n>c.height||i+s>c.width||r+n>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(A(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if(RG(o)?b(this._context.gl2)?this._context.gl2.texSubImage2D(f,e,i,r,s,n,h,d,o):l.texSubImage2D(f,e,i,r,h,d,o):Y6(o)?l.compressedTexSubImage2D(f,e,i,r,s,n,g,o.levels[e]):l.texSubImage2D(f,e,i,r,s,n,h,d,o),a){if(A(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(y,At.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(A(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:d,dataType:f,isImmutable:m,target:g}=h,y=h.internalFormat??this._deriveInternalFormat(d,f);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");zw(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._context.bindTexture(this,At.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(At.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),Y6(l))l=l.levels[e],c.compressedTexSubImage3D(g,e,i,r,s,n,o,a,y,l);else{const x=l;c.texSubImage3D(g,e,i,r,s,n,o,a,d,f,x)}this._context.bindTexture(v,At.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,At._validateTexture(this._context,e)}e.samplingMode===mt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=mt.LINEAR_MIPMAP_NEAREST):e.samplingMode===mt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=mt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,At.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(At.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(i,At.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,At._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(At._applySamplingMode(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(At._applyWrapMode(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(e,i){if(this._context.type===Ft.WEBGL1)return e;switch(i){case Zt.FLOAT:switch(e){case Qe.RGBA:return Bt.RGBA32F;case Qe.RGB:return Bt.RGB32F;default:throw new Error("Unable to derive format")}case Zt.UNSIGNED_BYTE:switch(e){case Qe.RGBA:return Bt.RGBA8;case Qe.RGB:return Bt.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const a=this._context.gl2;if(A(a))throw new Error("Immutable textures are not supported in WebGL1");if(!k0t(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Spe(e,s,n,o):1;if(zw(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Ft.WEBGL2,d=zw(e),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(h&&(c=l),h||!RG(a))if(f){if(b(a)){const y=a;if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,i,0,0,0,s,n,o,m,g,y)}else l.texSubImage2D(e,i,0,0,s,n,m,g,y)}}else{const y=a;if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,i,r,s,n,o,0,m,g,y)}else l.texImage2D(e,i,r,s,n,0,m,g,y)}else l.texImage2D(e,0,r,m,g,a)}_compressedTexImage(e,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=zw(e),d=this._descriptor.isImmutable;if(h){if(this._context.type!==Ft.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(d){if(b(a))if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Ut.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(e,i){(i.width!=null&&i.width<0||i.height!=null&&i.height<0||i.depth!=null&&i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=e.type===Ft.WEBGL2,s=i.width!=null&&Cm(i.width)&&i.height!=null&&Cm(i.height);r||!i.isImmutable&&!zw(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==qt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===qt.CLAMP_TO_EDGE&&i.wrapMode.t===qt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,i){let r=i.samplingMode,s=i.samplingMode;r===mt.LINEAR_MIPMAP_NEAREST||r===mt.LINEAR_MIPMAP_LINEAR?(r=mt.LINEAR,i.hasMipmap||(s=mt.LINEAR)):r!==mt.NEAREST_MIPMAP_NEAREST&&r!==mt.NEAREST_MIPMAP_LINEAR||(r=mt.NEAREST,i.hasMipmap||(s=mt.NEAREST)),e.texParameteri(i.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(i.target,e.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(e,i){typeof i.wrapMode=="number"?(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode)):(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode.s),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,i){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,i.maxAnisotropy??1)}};function k0t(t){return t in Bt}function V0t(t){return t in _n}function Y6(t){return b(t)&&"type"in t&&t.type==="compressed"}function z0t(t){return b(t)&&"byteLength"in t}function RG(t){return b(t)&&!Y6(t)&&!z0t(t)}function zw(t){return t===Ut.TEXTURE_3D||t===Ut.TEXTURE_2D_ARRAY}function Spe(t,e,i,r=1){let s=Math.max(e,i);return t===Ut.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}At.TEXTURE_UNIT_FOR_UPDATES=0;function ql(t,e=Bre,i=rr,r=-1,s=1){let n=null;return e===Y3?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new km(t,i,{geometry:e},{geometry:yr.createVertex(t,or.STATIC_DRAW,n)})}function B0t(t,e=Bre,i=rr){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new km(t,i,{geometry:e},{geometry:yr.createVertex(t,or.STATIC_DRAW,r)})}const oRe=4;function aRe(t,e=oRe){return new At(t,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:e,height:e})}function G0t(t,e,i=oRe){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*e[0],r[s+1]=255*e[1],r[s+2]=255*e[2],r[s+3]=255*e[3];return new At(t,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:i,height:i},r)}function lRe(t){return new At(t,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let PG=class{constructor(e,i){this._view=e,this.type=Io.Realistic,this._handles=new ir,this._passParameters=new N0t,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=zi.radius,this._fadeHaze=0,this._updateRadius(zi.radius);const r=i.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ae(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),ae(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new sRe;s.haze=!1,this._atmosphereTechnique=i.techniqueRepository.acquire(fJ,s),s.haze=!0,this._atmosphereHazeTechnique=i.techniqueRepository.acquire(fJ,s),this._vao=ql(r,Y3)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,i){this._fadeHaze=i,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,i,r){if(A(r))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=r;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,e))}_renderCommon(e,i){A(this._vao)||(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Xt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=zi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(zi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Vt(this._passParameters.radii,e,e+Y$),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-cJ)*cJ)}_update(e){if(A(e))return;const i=Ll(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Se((r-this._passParameters.radii[0])/Y$,0,1);Rr(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=kre(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=ei(ei(.6,1,OA(9500,10500,r-zi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function ys(){return new Float32Array(3)}function f9(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function cRe(t,e){return new Float32Array(t,e,3)}function Hre(){return ys()}function uRe(){return wr(1,1,1)}function hRe(){return wr(1,0,0)}function dRe(){return wr(0,1,0)}function pRe(){return wr(0,0,1)}const j0t=Hre(),H0t=uRe(),q0t=hRe(),W0t=dRe(),Y0t=pRe();Object.freeze(Object.defineProperty({__proto__:null,ONES:H0t,UNIT_X:q0t,UNIT_Y:W0t,UNIT_Z:Y0t,ZEROS:j0t,clone:f9,create:ys,createView:cRe,fromValues:wr,ones:uRe,unitX:hRe,unitY:dRe,unitZ:pRe,zeros:Hre},Symbol.toStringTag,{value:"Module"}));function fRe(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(T`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function qre(t,e){switch(t.include(gy,e),t.fragment.code.add(T`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case Nn.Default:case Nn.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Nn.Atlas:return t.include(fRe),void t.fragment.code.add(T`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case Nn.None:case Nn.COUNT:return}}let gd=class extends dn{constructor(e,i){super(e,"vec3",Vr.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},X$=class extends dn{constructor(e,i){super(e,"vec2",Vr.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}},TD=class extends dn{constructor(e,i){super(e,"sampler2D",Vr.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function $b(t,e,i=Ar.None){const r=[new TD(t,e)];if(i&Ar.Size){const s=t+Vre;r.push(new X$(s,(n,o)=>{const a=e(n,o);return b(a)?Vt(Epe,a.descriptor.width,a.descriptor.height):mu}))}if(i&Ar.InvSize){const s=t+tz;r.push(new X$(s,(n,o)=>{const a=e(n,o);return b(a)?Vt(Epe,1/a.descriptor.width,1/a.descriptor.height):mu}))}return r}const Epe=je();let Tw=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return S_.LOADED}},Wre=class extends Tw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Os(this._texture),this._textureNormal=Os(this._textureNormal),this._textureEmissive=Os(this._textureEmissive),this._textureOcclusion=Os(this._textureOcclusion),this._textureMetallicRoughness=Os(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?S_.LOADED:S_.LOADING}get textureBindParameters(){return new mRe(b(this._texture)?this._texture.glTexture:null,b(this._textureNormal)?this._textureNormal.glTexture:null,b(this._textureEmissive)?this._textureEmissive.glTexture:null,b(this._textureOcclusion)?this._textureOcclusion.glTexture:null,b(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(A(this._texture)||e!==this._texture.id)&&(this._texture=Os(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(A(e))return void i(null);const r=this._textureRepository.acquire(e);if(gh(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Os(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},mRe=class extends Br{constructor(e=null,i=null,r=null,s=null,n=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}};const FXt=wr(0,.6,.2);var Ot;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Ot||(Ot={}));function Yre(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Ot.Normal&&r&&t.include(qre,e),e.pbrMode!==Ot.Schematic)if(e.pbrMode!==Ot.Disabled){if(e.pbrMode===Ot.Normal){i.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.supportsTextureAtlas?e.hasWebGL2Context?Ar.None:Ar.Size:Ar.None,n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===Vr.Pass?ym("texMetallicRoughness",o=>o.textureMetallicRoughness,s):$b("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(T`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===Vr.Pass?ym("texEmission",o=>o.textureEmissive,s):$b("texEmission",o=>o.textureEmissive,s)),i.code.add(T`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===Vr.Pass?ym("texOcclusion",o=>o.textureOcclusion,s):$b("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(T`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(T`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===Vr.Pass?[new fi("emissionFactor",o=>o.emissiveFactor),new fi("mrrFactors",o=>o.mrrFactors)]:[new gd("emissionFactor",o=>o.emissiveFactor),new gd("mrrFactors",o=>o.mrrFactors)]),i.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?T`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?T`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?T`
                vtc.size = ${Pp(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:T`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?T`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?T`
                vtc.size = ${Pp(e,"texEmission")};
                applyEmission(vtc);`:T`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?T`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?T`
                vtc.size = ${Pp(e,"texOcclusion")};
                applyOcclusion(vtc);`:T`applyOcclusion(vtc);`:""}
    }
  `)}}else i.code.add(T`float getBakedOcclusion() { return 1.0; }`);else i.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Xre(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new fi("lightingAmbientSH0",(s,n)=>fe(Cpe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new Ni("lightingAmbientSH_R",(s,n)=>Rr(r0,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Ni("lightingAmbientSH_G",(s,n)=>Rr(r0,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Ni("lightingAmbientSH_B",(s,n)=>Rr(r0,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new fi("lightingAmbientSH0",(s,n)=>fe(Cpe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Ni("lightingAmbientSH_R1",(s,n)=>Rr(r0,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Ni("lightingAmbientSH_G1",(s,n)=>Rr(r0,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Ni("lightingAmbientSH_B1",(s,n)=>Rr(r0,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Ni("lightingAmbientSH_R2",(s,n)=>Rr(r0,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Ni("lightingAmbientSH_G2",(s,n)=>Rr(r0,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Ni("lightingAmbientSH_B2",(s,n)=>Rr(r0,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||i.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Cpe=$(),r0=Ai();function SD(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var wn,iS;function X0t(t){return b(t)&&b(t.cubeMap)}function Zre(t){return b(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(wn||(wn={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(iS||(iS={}));let Z0t=class{constructor(){this.readChannels=iS.RG,this.renderingStage=wn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=$(),this.isCameraPositionFinal=!0,this.parallax=new Mpe,this.parallaxNew=new Mpe,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:$o.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Yu.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:sw.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===$o.FADE_OUT||this.fadeInOut.stage===$o.FADE_IN||this.fadeIn.stage===Yu.FADE_IN||this.fadeInOutHeight.stage!==sw.FINISHED||this.renderingStage===wn.FADING_TEXTURE_CHANNELS}};var Yu,$o,sw;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Yu||(Yu={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}($o||($o={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(sw||(sw={}));let Mpe=class{constructor(){this.anchorPointClouds=$(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=Ge()}},E_=class extends dn{constructor(e,i){super(e,"bool",Vr.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},J0t=class extends dn{constructor(e,i){super(e,"samplerCube",Vr.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function gRe(t){const e=t.fragment;e.uniforms.add([new Ps("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new Ps("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new fi("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new fi("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Be("cloudsHeight",(i,r)=>r.cloudsFade.parallax.cloudsHeight),new Be("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Be("totalFadeInOut",(i,r)=>r.cloudsFade.fadeInOut.stage===$o.FINISHED?r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeIn.factor:r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeInOut.factor),new Be("crossFadeAnchorFactor",(i,r)=>Se(r.cloudsFade.crossFade.factor,0,1)),new J0t("cubeMap",(i,r)=>b(r.cloudsFade.data)&&b(r.cloudsFade.data.cubeMap)?r.cloudsFade.data.cubeMap.colorTexture:null),new E_("crossFade",(i,r)=>r.cloudsFade.crossFade.enabled),new E_("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===iS.RG),new E_("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===wn.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",zi.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),nv(e),Uy(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function ky(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function K0t(){const t=new ar;t.attributes.add(P.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add([new Ps("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(r,s)=>C3(Q0t,s.camera.viewMatrix))]),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(ky),i.include(_h),t.include(Xre,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(SD),t.include(ez),t.include(d9,{useLegacyTerrainShading:!1}),t.include(gRe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),i.uniforms.add([new fi("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const Q0t=Ge(),e_t=Object.freeze(Object.defineProperty({__proto__:null,build:K0t},Symbol.toStringTag,{value:"Module"}));let yRe=class _Re extends dr{constructor(e){super(e,new Hl,()=>this.destroy())}initializeProgram(e){return new cr(e.rctx,_Re.shader.get().build(),rr)}initializePipeline(){return si({blending:qo(Ne.ONE,Ne.ZERO,Ne.SRC_ALPHA,Ne.ONE),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};yRe.shader=new lr(e_t,()=>se(()=>import("./CloudsComposition.glsl-a0cfae5c.js"),[]));let cT=class extends Ee{constructor(e){super(e),this._technique=new yRe(e),this._vao=ql(e.rctx)}destroy(){this._technique=Os(this._technique),this._vao=dt(this._vao)}render(e){const i=e.bindParameters.cloudsFade;if(A(this._vao)||A(i.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,t_t,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Xt.TRIANGLE_STRIP,0,4)}};u([p({constructOnly:!0})],cT.prototype,"rctx",void 0),u([p({constructOnly:!0})],cT.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],cT.prototype,"planetRadius",void 0),u([p({constructOnly:!0})],cT.prototype,"requestRender",void 0),cT=u([N("esri.views.3d.environment.CloudsComposition")],cT);const t_t=new Br;var ou;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(ou||(ou={}));let X6=class extends Hl{constructor(){super(...arguments),this.steps=ou.SIXTEEN,this.writeTextureChannels=iS.RG}};u([X({count:ou.COUNT})],X6.prototype,"steps",void 0),u([X({constValue:me("esri-mobile")?1024:2048})],X6.prototype,"cubeMapSize",void 0),u([X()],X6.prototype,"writeTextureChannels",void 0);let jP=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Ape=new jP([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ou.SIXTEEN),El={sunny:Ape,cloudy:new jP([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ou.TWOHUNDRED,.6),rainy:new jP([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ou.TWOHUNDRED,.4),snowy:new jP([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ou.HUNDRED,.65),foggy:new jP([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ou.SIXTEEN),default:Ape},fp=me("esri-mobile")?64:128,i_t=fp/128,Bf=Math.ceil(Math.sqrt(fp)),Jf=(fp+2)*Bf,r_t=1e5,IG=128,s_t=Jf/1560;function Qp(t,e=!0){t.attributes.add(P.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let Z$=class extends dn{constructor(e,i){super(e,"mat3",Vr.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},vRe=class extends Br{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=El.default.raymarchingSteps,this.weatherTile=je()}},bRe=class extends Br{constructor(){super(...arguments),this.viewMatrix=Hs()}};function n_t(t){const e=new ar;e.include(Qp,!1);const i=e.fragment;return i.uniforms.add([new Be("cloudRadius",r=>r.cloudRadius),new Be("power",r=>ei(35,120,r.absorption)),new Be("sigmaE",r=>1+r.absorption),new Be("density",r=>ei(0,.3,r.density)),new Be("cloudSize",r=>ei(0,.02,Math.max(.01,1-r.cloudSize))),new Be("detailSize",r=>ei(0,.2,Math.max(.01,1-r.detailSize))),new Be("smoothness",r=>ei(0,.5,1-r.smoothness)),new Be("cloudHeight",r=>ei(0,1500,r.cloudHeight)),new Be("coverage",r=>r.coverage),new Z$("view",r=>r.viewMatrix),new Yt("cloudShapeTexture",r=>b(r.noiseTexture)?r.noiseTexture.textureAtlas:null),new hr("cloudVariables",r=>Vt(o_t,r.coverage,r.absorption))]),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(T`
    const int STEPS = ${t.steps===ou.SIXTEEN?T`16`:t.steps===ou.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(Jf)};
      const float dataWidth = ${T.float(Jf)};
      const float tileRows = ${T.float(Bf)};
      const vec3 atlasDimensions = vec3(${T.float(fp)}, ${T.float(fp)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(i_t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${T.float(s_t)} * p) / ${T.float(Jf)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),i.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(T`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const o_t=je(),a_t=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:bRe,CloudsPassParameters:vRe,build:n_t},Symbol.toStringTag,{value:"Module"}));let wRe=class xRe extends dr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new cr(e.rctx,xRe.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:Um(Ne.CONSTANT_COLOR,Ne.ONE_MINUS_CONSTANT_COLOR,Ay.ADD,this.configuration.writeTextureChannels===iS.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};wRe.shader=new lr(a_t,()=>se(()=>import("./Clouds.glsl-74462812.js"),[]));var ad;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(ad||(ad={}));let mJ=class extends Hl{constructor(){super(...arguments),this.mode=ad.Full}};u([X({count:ad.COUNT})],mJ.prototype,"mode",void 0);let TRe=class extends Br{constructor(){super(...arguments),this.weatherTile=nr(0,0)}};function l_t(t){const e=new ar;return e.include(Qp,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===ad.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(Bf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new hr("weatherTile",i=>i.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(IG)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(IG)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(r_t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===ad.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(fp)} + 2.0 * padWidth;
        float tileCount = ${T.float(Bf)} * ${T.float(Bf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(fp)};
          }

          if (startPadY) {
            pixel.y += ${T.float(fp)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(fp)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(fp)};
          }

          uv = vec2(pixel.xy / ${T.float(fp)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(fp)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(Bf)} * ${T.float(Bf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(Bf)} * ${T.float(Bf)});
        p = p_;
        p.z /= (${T.float(Bf)} * ${T.float(Bf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(IG)} * (gl_FragCoord.xy / ${T.float(Jf)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===ad.Full?T`gl_FragColor.ba = vec2(0.0, map);`:T`gl_FragColor = vec4(map);`};
    }
  `),e}const c_t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:TRe,build:l_t},Symbol.toStringTag,{value:"Module"}));let gJ=class SRe extends dr{initializeProgram(e){return new cr(e.rctx,SRe.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:this.configuration.mode===ad.Full?Um(Ne.ONE,Ne.ZERO):qo(Ne.ZERO,Ne.ONE,Ne.ONE,Ne.ZERO),depthTest:{func:hs.ALWAYS},colorWrite:wi})}};gJ.shader=new lr(c_t,()=>se(()=>import("./NoiseTextureAtlas.glsl-92bed8a2.js"),[]));let XC=class{constructor(e,i){this._context=e,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(zo.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Ft.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}resize(e,i){const r=this._desc;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(zo.Renderbuffer,this),this._context=O2(this._context))}},Sn=class ZC{constructor(e,i,r=null,s=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...i},e.instanceCounter.increment(zo.FramebufferObject,this),b(r)){Array.isArray(r)||(r=[r]);for(let n=0;n<r.length;++n){const o=r[n],a=Hh.COLOR_ATTACHMENT0+n;let l;Rpe(o)?(k0(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new At(this._context,l))),gF(l,this._desc)):(Ope(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new XC(this._context,l))),$G(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(b(s)){let n,o;if(Rpe(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),k0(s)?(o=s.descriptor,this._depthStencilTexture=s):(o=s,this._depthStencilTexture=new At(this._context,o)),gF(o,this._desc);else{Ope(s)?(o=s.descriptor,n=s):(o=s,n=new XC(this._context,o));const a=this._desc.depthStencilTarget??sr.DEPTH_STENCIL_RENDER_BUFFER;a===sr.STENCIL_RENDER_BUFFER?this._stencilAttachment=n:a===sr.DEPTH_RENDER_BUFFER||a===sr.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,$G(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(zo.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(Hh.COLOR_ATTACHMENT0);return e&&k0(e)?e:null}get colorAttachment(){return this._colorAttachments.get(Hh.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+tS(r),0)+tS(this.depthStencilAttachment)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&k0(i)?i:null}attachColorTexture(e,i=Hh.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(i),gF(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e))}detachColorTexture(e=Hh.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(k0(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}}setColorTextureTarget(e,i=Hh.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);k0(r)&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencilTexture(e){if(A(e))return;const i=e.descriptor;i.pixelFormat!==Qe.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Zt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),gF(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==sr.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=sr.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,_pe)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,_pe)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(A(e))return;const i=e.descriptor;if(i.internalFormat!==pc.DEPTH_STENCIL&&i.internalFormat!==pc.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),$G(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===pc.DEPTH_STENCIL?sr.DEPTH_STENCIL_RENDER_BUFFER:sr.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===sr.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(na.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===sr.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(na.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((e,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==Ut.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,d=h.bindTexture(a,At.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(At.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(Ut.TEXTURE_2D,0,n,o,e,i,r,s),h.bindTexture(d,At.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){if(this._context.type!==Ft.WEBGL2)return Xh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,s,n,o,a);const l=this._context.gl,c=yr.createPixelPack(this._context,or.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){const r=this._desc;if(r.width!==e||r.height!==i){if(r.width=e,r.height=i,!this._initialized)return this._colorAttachments.forEach(s=>{s&&s.resize(e,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,i));this._colorAttachments.forEach(s=>{s&&s.resize(e,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,i),this._stencilAttachment&&this._stencilAttachment.resize(e,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=na.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=n.colorTarget??en.RENDER_BUFFER,a=n.width??1,l=n.height??1;if(i.bindFramebuffer(e,s),this._colorAttachments.size===0)if(o===en.TEXTURE||o===en.CUBEMAP)this._colorAttachments.set(Hh.COLOR_ATTACHMENT0,u_t(r,n,this.descriptor.colorTarget===en.CUBEMAP?Ut.TEXTURE_CUBE_MAP:Ut.TEXTURE_2D));else{const h=new XC(r,{internalFormat:Bt.RGBA4,width:a,height:l});this._colorAttachments.set(Hh.COLOR_ATTACHMENT0,h)}this._colorAttachments.forEach((h,d)=>{h&&(k0(h)?this._framebufferTexture2D(h.glName,d,Ppe(h),e):i.framebufferRenderbuffer(e,d,i.RENDERBUFFER,h.glName))});const c=n.depthStencilTarget??sr.NONE;switch(c){case sr.DEPTH_RENDER_BUFFER:case sr.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new XC(r,{internalFormat:n.depthStencilTarget===sr.DEPTH_RENDER_BUFFER?pc.DEPTH_COMPONENT16:pc.DEPTH_STENCIL,width:a,height:l}));const h=c===sr.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(e,h,i.RENDERBUFFER,this._depthAttachment.glName);break}case sr.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new XC(r,{internalFormat:pc.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(e,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case sr.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const h={target:Ut.TEXTURE_2D,pixelFormat:Qe.DEPTH_STENCIL,dataType:Zt.UNSIGNED_INT_24_8,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new At(r,h)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Ppe(this._depthStencilTexture),e)}Xh()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(e,i=Hh.COLOR_ATTACHMENT0,r=Ut.TEXTURE_2D,s=na.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_detachColorAttachment(e){Xh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(e);return k0(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(na.FRAMEBUFFER,e,i.RENDERBUFFER,null)),this._colorAttachments.delete(e),r}_disposeColorAttachments(){this._colorAttachments.forEach((e,i)=>{this._detachColorAttachment(i),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===sr.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(na.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(na.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(ZC._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;ZC._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else ZC._MAX_COLOR_ATTACHMENTS=1}const i=e-Hh.COLOR_ATTACHMENT0;i+1>ZC._MAX_COLOR_ATTACHMENTS&&le.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${ZC._MAX_COLOR_ATTACHMENTS} color attachments`)}};function k0(t){return t!=null&&"type"in t&&t.type==="texture"}function Ope(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function Rpe(t){return k0(t)||t!=null&&"pixelFormat"in t}function u_t(t,e,i){return new At(t,{target:i,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,width:e.width,height:e.height})}function gF(t,e){t.target!==Ut.TEXTURE_2D&&t.target!==Ut.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function $G(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function Ppe(t){return t.descriptor.target===Ut.TEXTURE_CUBE_MAP?Ut.TEXTURE_CUBE_MAP_POSITIVE_X:Ut.TEXTURE_2D}Sn._MAX_COLOR_ATTACHMENTS=-1;let HP=class extends Ee{constructor(e){super(e),this._needsRender=!0,this._passParameters=new TRe,this._frameBuffer=new Sn(e.context.renderContext.rctx,{colorTarget:en.TEXTURE,width:Jf,height:Jf},{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,hasMipmap:!1,width:Jf,height:Jf}),this._vao=ql(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return b(this._texture)?b(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(ad.WeatherMap)):b(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(ad.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Ao(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Os(this._fullTechniqueCached),this._weatherMapTechniqueCached=Os(this._weatherMapTechniqueCached),this._frameBuffer=dt(this._frameBuffer),this._vao=dt(this._vao)}get _fullTechnique(){if(A(this._fullTechniqueCached)){const e=new mJ;e.mode=ad.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(gJ,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(A(this._weatherMapTechniqueCached)){const e=new mJ;e.mode=ad.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(gJ,e)}return this._weatherMapTechniqueCached}_render(e){if(A(this._vao)||A(this._frameBuffer))return null;const i=e===ad.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,Jf,Jf),r.bindFramebuffer(this._frameBuffer);const n=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([p({constructOnly:!0})],HP.prototype,"context",void 0),u([p({readOnly:!0})],HP.prototype,"_techniqueRepository",null),HP=u([N("esri.views.3d.environment.NoiseTextureAtlas")],HP);function ERe(t){t.include(Sd),t.uniforms.add([new Yt("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepthTexture),new hr("nearFar",(e,i)=>i.camera.nearFar)]),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let h_t=class{constructor(){this.enabled=!1}};function Ed(t,e){e.hasMultipassTerrain&&(t.fragment.include(Sd),t.fragment.uniforms.add(new Yt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new hr("nearFar",(i,r)=>r.camera.nearFar)),t.fragment.uniforms.add(new hr("inverseViewport",(i,r)=>r.inverseViewport)),t.fragment.code.add(T`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let d_t=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function p_t(t,e){const i=t.fragment;i.include(Sd),i.uniforms.add(new hr("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Yt("depthMap",(r,s)=>s.linearDepthTexture)),i.uniforms.add(new Ps("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.uniforms.add(new Be("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.uniforms.add(new Ps("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let f_t=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=Ge()}};function rz(t){return t?{ray:ha(t.ray),c0:t.c0,c1:t.c1}:{ray:ha(),c0:0,c1:Number.MAX_VALUE}}function m_t(t,e=rz()){return c9(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function g_t(t,e,i=rz()){const r=ze(t.vector);return oOe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function tZt(t,e){return CRe(t,t.c0,e)}function iZt(t,e){return CRe(t,t.c1,e)}function CRe(t,e,i){return we(i,t.ray.origin,pe(i,t.ray.direction,e))}new rv(()=>rz());function J$(t){return t?[gr(t[0]),gr(t[1]),gr(t[2]),gr(t[3]),gr(t[4]),gr(t[5])]:[gr(),gr(),gr(),gr(),gr(),gr()]}function MRe(){return[$(),$(),$(),$(),$(),$(),$(),$()]}function m9(t,e){for(let i=0;i<nw.NUM;i++)YV(t[i],e[i])}function ARe(t,e,i,r=w_t){const s=ln(Ere.get(),e,t);Va(s,s);for(let n=0;n<yJ.NUM;++n){const o=ld(Sre.get(),b_t[n],s);fe(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}ORe(i,r)}function ORe(t,e){Il(e[_t.FAR_BOTTOM_LEFT],e[_t.NEAR_BOTTOM_LEFT],e[_t.NEAR_TOP_LEFT],t[Jr.LEFT]),Il(e[_t.NEAR_BOTTOM_RIGHT],e[_t.FAR_BOTTOM_RIGHT],e[_t.FAR_TOP_RIGHT],t[Jr.RIGHT]),Il(e[_t.FAR_BOTTOM_LEFT],e[_t.FAR_BOTTOM_RIGHT],e[_t.NEAR_BOTTOM_RIGHT],t[Jr.BOTTOM]),Il(e[_t.NEAR_TOP_LEFT],e[_t.NEAR_TOP_RIGHT],e[_t.FAR_TOP_RIGHT],t[Jr.TOP]),Il(e[_t.NEAR_BOTTOM_LEFT],e[_t.NEAR_BOTTOM_RIGHT],e[_t.NEAR_TOP_RIGHT],t[Jr.NEAR]),Il(e[_t.FAR_BOTTOM_RIGHT],e[_t.FAR_BOTTOM_LEFT],e[_t.FAR_TOP_LEFT],t[Jr.FAR])}function Tb(t,e){for(let i=0;i<nw.NUM;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function y_t(t,e){return PRe(t,m_t(e,IRe.get()))}function rZt(t,e){for(let i=0;i<nw.NUM;i++){const r=t[i];if(!Wgt(r,e))return!1}return!0}function __t(t,e,i){return PRe(t,g_t(e,i,IRe.get()))}function RRe(t,e){for(let i=0;i<nw.NUM;i++)if(Kr(t[i],e)>0)return!1;return!0}function PRe(t,e){for(let i=0;i<nw.NUM;i++)if(!qgt(t[i],e))return!1;return!0}var Jr,_t;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Jr||(Jr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(_t||(_t={}));const v_t={bottom:[_t.FAR_BOTTOM_RIGHT,_t.NEAR_BOTTOM_RIGHT,_t.NEAR_BOTTOM_LEFT,_t.FAR_BOTTOM_LEFT],near:[_t.NEAR_BOTTOM_LEFT,_t.NEAR_BOTTOM_RIGHT,_t.NEAR_TOP_RIGHT,_t.NEAR_TOP_LEFT],far:[_t.FAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_LEFT,_t.FAR_TOP_LEFT,_t.FAR_TOP_RIGHT],right:[_t.NEAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_RIGHT,_t.FAR_TOP_RIGHT,_t.NEAR_TOP_RIGHT],left:[_t.FAR_BOTTOM_LEFT,_t.NEAR_BOTTOM_LEFT,_t.NEAR_TOP_LEFT,_t.FAR_TOP_LEFT],top:[_t.FAR_TOP_LEFT,_t.NEAR_TOP_LEFT,_t.NEAR_TOP_RIGHT,_t.FAR_TOP_RIGHT]};var nw,yJ;(function(t){t[t.NUM=6]="NUM"})(nw||(nw={})),function(t){t[t.NUM=8]="NUM"}(yJ||(yJ={}));const b_t=[di(-1,-1,-1,1),di(1,-1,-1,1),di(1,1,-1,1),di(-1,1,-1,1),di(-1,-1,1,1),di(1,-1,1,1),di(1,1,1,1),di(-1,1,1,1)],IRe=new rv(rz),w_t=MRe();function x_t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function T_t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function S_t(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function E_t(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var _J;let jt=_J=class extends Ee{constructor(t={}){super(t),this._center=$(),this._up=$(),this._viewUp=$(),this._viewForward=$(),this._viewRight=$(),this._ray=ha(),this._viewport=di(0,0,1,1),this._padding=di(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=nr(1,1e3),this._viewDirty=!0,this._viewMatrix=Ge(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ge(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ge(),this._frustumDirty=!0,this._frustum=J$(),this._fullViewport=Ai(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return be(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Bo(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=b3(Ai(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&tte(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[$i.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[$i.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[$i.RIGHT]+this._padding[$i.LEFT]}set fullWidth(t){this.width=t-(this._padding[$i.RIGHT]+this._padding[$i.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[$i.TOP]+this._padding[$i.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[$i.TOP]+this._padding[$i.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[$i.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[$i.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){HM(this._padding,t)||(this._viewport[0]+=t[$i.LEFT]-this._padding[$i.LEFT],this._viewport[1]+=t[$i.BOTTOM]-this._padding[$i.BOTTOM],this._viewport[2]-=t[$i.RIGHT]+t[$i.LEFT]-(this._padding[$i.RIGHT]+this._padding[$i.LEFT]),this._viewport[3]-=t[$i.TOP]+t[$i.BOTTOM]-(this._padding[$i.TOP]+this._padding[$i.BOTTOM]),im(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(ln(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,s=FTe(Ge(),-r*(1+2*this._padding[$i.LEFT]/t),r*(1+2*this._padding[$i.RIGHT]/t),-i*(1+2*this._padding[$i.BOTTOM]/e),i*(1+2*this._padding[$i.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&Nte(n,s)?n:s}get inverseProjectionMatrix(){return Va(Ge(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ge()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return S_t(this._fov,this.width,this.height)}set fovX(t){this._fov=x_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return E_t(this._fov,this.width,this.height)}set fovY(t){this._fov=T_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Wr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Va(this._viewInverseTransposeMatrix,this.viewMatrix),hh(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ge(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,im(this._viewport,t.viewport),this.notifyChange("_viewport"),im(this._padding,t.padding),this.notifyChange("_padding"),Ao(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Bo(this._viewMatrix,t.viewMatrix),ge(this._viewRight,t.viewRight),ge(this._viewUp,t.viewUp),ge(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(m9(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Bo(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),im(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new _J().copyFrom(this)}equals(t){return Ur(this.eye,t.eye)&&Ur(this.center,t.center)&&Ur(this.up,t.up)&&HM(this._viewport,t.viewport)&&HM(this._padding,t.padding)&&jAe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||pU(t.padding,this._padding)>=.5||pU(this.screenViewport,t.screenViewport)>=.5)return!1;as(bl,t.eye,t.center),as(LG,this.eye,this.center);const e=xe(bl,LG),i=MA(bl),r=MA(LG),s=5e-4;return e*e>=(1-1e-10)*i*r&&Jee(t.eye,this.eye)<Math.max(i,r)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(Pb(this.viewForward,be(bl,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=zs()){return t[0]=(this.padding[$i.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[$i.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[$i.LEFT]+this.width*e,t[1]=this.padding[$i.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Ii&&ge(Ii,t),Ii[3]=1,ld(Ii,Ii,this.projectionMatrix);const i=Math.abs(Ii[3]);pe(Ii,Ii,1/i);const r=this.fullViewport;e[0]=ei(0,r[0]+r[2],.5+.5*Ii[0]),e[1]=ei(0,r[1]+r[3],.5+.5*Ii[1]),e[2]=.5*(Ii[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Ii[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Ii[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Ii[2]=(2*t[2]-1)*t[3],Ii[3]=t[3],this.inverseProjectionMatrix!=null&&(ld(Ii,Ii,this.inverseProjectionMatrix),e[0]=Ii[0],e[1]=Ii[1],e[2]=Ii[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,DG),this.renderToScreen(DG,e),e}projectToRenderScreen(t,e){if(Ii[0]=t[0],Ii[1]=t[1],Ii[2]=t[2],Ii[3]=1,ld(Ii,Ii,this.viewProjectionMatrix),Ii[3]===0)return null;pe(Ii,Ii,1/Math.abs(Ii[3]));const i=this.fullViewport;return"x"in e?(e.x=ei(0,i[0]+i[2],.5+.5*Ii[0]),e.y=ei(0,i[1]+i[3],.5+.5*Ii[1])):(e[0]=ei(0,i[0]+i[2],.5+.5*Ii[0]),e[1]=ei(0,i[1]+i[3],.5+.5*Ii[1]),e.length>2&&(e[2]=.5*(Ii[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,DG),e)}unprojectFromRenderScreen(t,e){if(ln(yF,this.projectionMatrix,this.viewMatrix),!Va(yF,yF))return null;const i=this.fullViewport;return Ii[0]=2*(t[0]-i[0])/i[2]-1,Ii[1]=2*(t[1]-i[1])/i[3]-1,Ii[2]=2*t[2]-1,Ii[3]=1,ld(Ii,Ii,yF),Ii[3]===0?null:(e[0]=Ii[0]/Ii[3],e[1]=Ii[1]/Ii[3],e[2]=Ii[2]/Ii[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-s-i/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(t){t===it.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){be(bl,this.center,this.eye);const t=ze(this.center);t<1?(fe(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(xe(bl,this.center))>.9999*ze(bl)*t||(Et(this._up,bl,this.center),Et(this._up,this._up,bl),Re(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Q_(bl,this.eye,this.center),Math.abs(bl[2])<=.9999&&(pe(bl,bl,bl[2]),fe(this._up,-bl[0],-bl[1],1-bl[2]),Re(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Ur(t,e)||(ge(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):le.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(ARe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(uV(this._viewMatrix,this.eye,this.center,this.up),fe(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),fe(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),fe(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],jt.prototype,"_center",void 0),u([p()],jt.prototype,"_up",void 0),u([p()],jt.prototype,"_viewport",void 0),u([p()],jt.prototype,"_padding",void 0),u([p()],jt.prototype,"_fov",void 0),u([p()],jt.prototype,"_nearFar",void 0),u([p()],jt.prototype,"_pixelRatio",void 0),u([p()],jt.prototype,"pixelRatio",null),u([p()],jt.prototype,"eye",null),u([p()],jt.prototype,"center",null),u([p()],jt.prototype,"up",null),u([p({readOnly:!0})],jt.prototype,"nearFar",null),u([p()],jt.prototype,"near",null),u([p()],jt.prototype,"far",null),u([p()],jt.prototype,"viewport",null),u([p({readOnly:!0})],jt.prototype,"screenViewport",null),u([p()],jt.prototype,"x",null),u([p()],jt.prototype,"y",null),u([p()],jt.prototype,"width",null),u([p()],jt.prototype,"height",null),u([p()],jt.prototype,"fullWidth",null),u([p()],jt.prototype,"fullHeight",null),u([p({readOnly:!0})],jt.prototype,"_aspect",null),u([p()],jt.prototype,"padding",null),u([p({readOnly:!0})],jt.prototype,"projectionMatrix",null),u([p({readOnly:!0})],jt.prototype,"inverseProjectionMatrix",null),u([p()],jt.prototype,"fov",null),u([p()],jt.prototype,"fovX",null),u([p()],jt.prototype,"fovY",null),jt=_J=u([N("esri.views.3d.webgl-engine.lib.Camera")],jt);const Ii=Ai(),yF=Ge(),bl=$(),LG=$(),DG=ma();var $i;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})($i||($i={}));var Ie;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(Ie||(Ie={}));var zt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(zt||(zt={}));let Jre=class{constructor(e=$()){this.intensity=e}},$Re=class{constructor(e=$(),i=Ve(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},g9=class{constructor(e=$(),i=Ve(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},LRe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function C_t(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function NG(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function eA(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function DRe(t){return(t+1)*(t+1)}function M_t(t){return Se(Math.floor(Math.sqrt(t)-1),0,2)}function NRe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=DRe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function A_t(t,e){const i=DRe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function O_t(t,e){const i=M_t(e.r.length);for(const r of t)Ul(vJ,r.direction),NRe(vJ,i,u_),C_t(u_,Z6),NG(u_,r.intensity[0],rE),eA(e.r,rE),NG(u_,r.intensity[1],rE),eA(e.g,rE),NG(u_,r.intensity[2],rE),eA(e.b,rE);return e}function R_t(t,e){NRe(vJ,0,u_);for(const i of t)e.r[0]+=u_[0]*Z6[0]*i.intensity[0]*4*Math.PI,e.g[0]+=u_[0]*Z6[0]*i.intensity[1]*4*Math.PI,e.b[0]+=u_[0]*Z6[0]*i.intensity[2]*4*Math.PI;return e}function P_t(t,e,i,r){A_t(e,r),fe(i.intensity,0,0,0);let s=!1;const n=I_t,o=$_t,a=L_t;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof g9&&!s?(ge(i.direction,l.direction),ge(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof g9||l instanceof $Re?n.push(l):l instanceof Jre?o.push(l):l instanceof LRe&&a.push(l);O_t(n,r),R_t(o,r);for(const l of a)eA(r.r,l.r),eA(r.g,l.g),eA(r.b,l.b)}const I_t=[],$_t=[],L_t=[],u_=[0],rE=[0],vJ=$(),Z6=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Ipe=class{constructor(){this.color=$(),this.intensity=1}},D_t=class{constructor(){this.direction=$(),this.ambient=new Ipe,this.diffuse=new Ipe}};const FRe=.4;let FG=class{constructor(){this._shOrder=2,this._legacy=new D_t,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new LRe,this._mainLight=new g9($(),Ve(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){P_t(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ge(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,pe(this._legacy.diffuse.color,this._mainLight.intensity,i),ge(_F,this._legacy.diffuse.color),pe(_F,_F,FRe*this.globalFactor),we(this._legacy.ambient.color,this._legacy.ambient.color,_F)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=zr(e.mainLight.direction),this._mainLight.intensity=zr(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(En(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=ei(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=ei(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ge(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=ei(e.globalFactor,i.globalFactor,r),this.noonFactor=ei(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=ei(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=ei(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=ei(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const _F=$();let sz=class{constructor(e,i,r){this.shadowMap=e,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ie.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=zt.NONE,this._camera=new jt,this._inverseViewport=je(),this.oldLighting=new FG,this.newLighting=new FG,this._fadedLighting=new FG,this._lighting=this.newLighting,this.ssr=new f_t,this.multipassTerrain=new d_t,this.multipassGeometry=new h_t,this.overlays=[],this.cloudsFade=new Z0t}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Gc=class extends Ee{constructor(e){super(e),this._handles=new ir,this._techniques=new Array,this._techniqueConfiguration=new X6,this._bindParameters=new sz(null,null,null),this._passParameters=new vRe,this._drawParameters=new bRe,this._weatherTile=je(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=ei(El.default.coverage[0],El.default.coverage[1],.5),this.density=ei(El.default.density[0],El.default.density[1],.5),this.absorption=ei(El.default.absorption[0],El.default.absorption[1],.5),this.cloudSize=ei(El.default.cloudSize[0],El.default.cloudSize[1],.5),this.detailSize=ei(El.default.detailSize[0],El.default.detailSize[1],.5),this.smoothness=ei(El.default.smoothness[0],El.default.smoothness[1],.5),this.cloudHeight=ei(El.default.cloudHeight[0],El.default.cloudHeight[1],.5),this.raymarchingSteps=El.default.raymarchingSteps,this._viewMatrix=Ge(),this._dirty=!1,this.running=!1}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===iS.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new wRe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Vt(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(b(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&b(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),HAe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=ql(this.context.renderContext.rctx);const e=ur(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Nt.CLOUDS_GENERATOR,this),ae(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),ii)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Os(e)),this._frameBufferCube=dt(this._frameBufferCube),this._techniques.length=0,this._vao=dt(this._vao),this._passParameters.noiseTexture=He(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case ou.SIXTEEN:return 1;case ou.HUNDRED:return 4;case ou.COUNT:case ou.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(b(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new HP({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return b(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(A(this._frameBufferCube)){const i={target:Ut.TEXTURE_CUBE_MAP,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Sn(this.context.renderContext.rctx,{colorTarget:en.CUBEMAP,width:e,height:e},i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=dt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=ei(n[0],n[1],r);return i<.5?ei(n[0],o,2*i):ei(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(A(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=wn.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Ao(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return al.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=wn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,s=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const h=N_t[this._faceIndex],d=F_t[this._faceIndex];kTe(this._viewMatrix,U_t,h,d),jp(this._drawParameters.viewMatrix,this._viewMatrix);const f=Ut.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=wn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),al.YIELD}};u([p({constructOnly:!0})],Gc.prototype,"context",void 0),u([p({constructOnly:!0})],Gc.prototype,"view",void 0),u([p({constructOnly:!0})],Gc.prototype,"requestRender",void 0),u([p()],Gc.prototype,"coverage",void 0),u([p()],Gc.prototype,"density",void 0),u([p()],Gc.prototype,"absorption",void 0),u([p()],Gc.prototype,"cloudSize",void 0),u([p()],Gc.prototype,"detailSize",void 0),u([p()],Gc.prototype,"smoothness",void 0),u([p()],Gc.prototype,"cloudHeight",void 0),u([p()],Gc.prototype,"raymarchingSteps",void 0),u([p()],Gc.prototype,"running",void 0),Gc=u([N("esri.views.3d.environment.CloudsGenerator")],Gc);const N_t=[wr(1,0,0),wr(-1,0,0),wr(0,1,0),wr(0,-1,0),wr(0,0,1)],F_t=[wr(0,1,0),wr(0,1,0),wr(0,0,-1),wr(0,0,1),wr(0,1,0)],U_t=Hre();let Kre=class extends Br{constructor(){super(...arguments),this.fogColor=$(),this.hazeColor=$(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function k_t(t){const e=new ar;e.attributes.add(P.POSITION,"vec2"),e.include(gy,{textureCoordinateType:Nn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Ps("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(s,n)=>C3(V_t,n.camera.viewMatrix))]),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Be("atmosphereC",s=>s.atmosphereC)),r.uniforms.add(new fi("cameraPosition",(s,n)=>n.camera.eye)),r.uniforms.add(new hr("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new Yt("depthTex",s=>s.depthTexture)),r.uniforms.add(new Be("fogStrength",s=>t.haze?s.hazeStrength:s.fogStrength)),r.uniforms.add(new Be("fogAmount",s=>t.haze?s.hazeAmount:s.fogAmount)),r.uniforms.add(new fi("fogColor",s=>t.haze?s.hazeColor:s.fogColor)),e.include(ez),r.include(Sd),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(T`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?T`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const V_t=Ge(),URe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:Kre,build:k_t},Symbol.toStringTag,{value:"Module"}));let kRe=class VRe extends dr{initializeProgram(e){return new cr(e.rctx,VRe.shader.get().build(this.configuration),rr)}initializePipeline(){return this.configuration.haze?si({blending:qo(Ne.ONE,Ne.ZERO,Ne.ONE_MINUS_SRC_COLOR,Ne.ONE),colorWrite:wi}):si({blending:qo(Ne.SRC_ALPHA,Ne.ZERO,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE),colorWrite:wi})}};kRe.shader=new lr(URe,()=>se(()=>import("./FogHaze.glsl-1d59a1c4.js"),[]));let Qre=class extends Hl{constructor(){super(...arguments),this.haze=!1}};u([X()],Qre.prototype,"haze",void 0);const z_t=.95,B_t=1;let qP=class extends Ee{constructor(e){super(e),this._passParameters=new Kre;const i=e.context.renderContext.rctx;this._vao=ql(i,Y3),this._technique=e.context.techniqueRepository.acquire(kRe,new Qre);const r=ur(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Y$}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Xt.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Re($pe,r.eye);const s=Math.max(0,xe($pe,e.bindParameters.lighting.mainLight.direction)),n=i.color;pe(Lpe,n,.1),En(this._passParameters.fogColor,Lpe,n,s);const o=ze(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-OA(z_t*pp,B_t*pp,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([p({constructOnly:!0})],qP.prototype,"context",void 0),u([p({constructOnly:!0})],qP.prototype,"view",void 0),qP=u([N("esri.views.3d.environment.Fog")],qP);let G_t=class{constructor(){this.color=$(),this.strength=0,this.amount=0}};const $pe=$(),Lpe=$();let ca=class extends Hl{constructor(){super(...arguments),this.hasWebGL2Context=!1}};u([X({constValue:!0})],ca.prototype,"hasSliceHighlight",void 0),u([X({constValue:!1})],ca.prototype,"hasSliceInVertexProgram",void 0),u([X({constValue:!1})],ca.prototype,"instancedDoublePrecision",void 0),u([X({constValue:!1})],ca.prototype,"useLegacyTerrainShading",void 0),u([X({constValue:!1})],ca.prototype,"hasModelTransformation",void 0),u([X({constValue:Vr.Pass})],ca.prototype,"pbrTextureBindType",void 0),u([X()],ca.prototype,"hasWebGL2Context",void 0);var Oy;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Oy||(Oy={}));let ese=class extends ca{constructor(){super(...arguments),this.geometry=Oy.Cone}};u([X({count:Oy.COUNT})],ese.prototype,"geometry",void 0);var H;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(H||(H={}));function ED(t){t.attributes.add(P.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}function y9({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Vy=class extends dn{constructor(e,i){super(e,"mat3",Vr.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function tA(t,e){t.include(ED);const i=t.vertex;i.include(y9,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add([new fi("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Vy("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Ps("transformProjFromView",r=>r.transformProjFromView),new Z$("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new gd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new gd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let zRe=class extends Br{constructor(){super(...arguments),this.transformWorldFromViewTH=$(),this.transformWorldFromViewTL=$(),this.transformViewFromCameraRelativeRS=Hs(),this.transformProjFromView=Ge()}},BRe=class extends Br{constructor(){super(...arguments),this.transformWorldFromModelRS=Hs(),this.transformWorldFromModelTH=ys(),this.transformWorldFromModelTL=ys()}};function ow(t){t.varyings.add("linearDepth","float")}function rS(t){t.vertex.uniforms.add(new hr("nearFar",(e,i)=>i.camera.nearFar))}function nz(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function X3(t,e){const{vertex:i}=t;switch(e.output){case H.Color:if(e.receiveShadows)return ow(t),void i.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case H.Depth:case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:return t.include(tA,e),ow(t),rS(t),nz(t),void i.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(T`void forwardLinearDepth() {}`)}function au(t,e){if(nz(t),e.hasModelTransformation)return t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let tse=class extends Br{constructor(){super(...arguments),this.texV=je(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new GRe}},GRe=class{constructor(){this.center=$(),this.v1=$(),this.v2=$()}};function j_t(t){const e=new ar,{vertex:i,fragment:r}=e;if(nv(i),t.geometry===Oy.Underground)e.attributes.add(P.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add([new fi("cameraPosition",(s,n)=>n.camera.eye),new Be("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),i.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(T`void main() {
gl_FragColor = color;
}`);else{e.include(au,t),e.attributes.add(P.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Oy.Cylinder;i.uniforms.add([new Ps("proj",(a,l)=>l.camera.projectionMatrix),new Ps("view",(a,l)=>l.camera.viewMatrix)]),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new fi("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new fi("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new fi("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new hr("texV",a=>a.texV)),i.uniforms.add(new Be("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(T`
		void main(void) {
      ${s?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Yt("tex",a=>a.texture)),s||r.uniforms.add(new Be("altitudeFade",a=>a.altitudeFade)),r.code.add(T`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?T`gl_FragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const H_t=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:GRe,SimpleAtmospherePassParameters:tse,build:j_t},Symbol.toStringTag,{value:"Module"}));let _9=class jRe extends dr{initializeProgram(e){return new cr(e.rctx,jRe.shader.get().build(this.configuration),rr)}initializePipeline(){return this.configuration.geometry===Oy.Cylinder?si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),culling:zre,depthTest:{func:hs.LEQUAL},colorWrite:wi}):si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};_9.shader=new lr(H_t,()=>se(()=>import("./SimpleAtmosphere.glsl-500033f0.js"),[]));const HRe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function vh(t,e=0){const i=t.stride;return t.fieldNames.filter(r=>{const s=t.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,o=q_t(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Ba(r,n,o,a,i,l,e)})}function q_t(t){const e=W_t[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const W_t={u8:Mt.UNSIGNED_BYTE,u16:Mt.UNSIGNED_SHORT,u32:Mt.UNSIGNED_INT,i8:Mt.BYTE,i16:Mt.SHORT,i32:Mt.INT,f32:Mt.FLOAT};let ise=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};ise.ElementCount=9;let rse=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};rse.ElementCount=16;let lv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};lv.ElementCount=1;let cv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Vt(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};cv.ElementCount=2;let uv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,fe(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};uv.ElementCount=3;let hv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Rr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};hv.ElementCount=4;let sse=class qRe extends lv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new qRe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};sse.ElementType="f32";let dv=class bJ extends cv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(bJ,e,i)}static fromTypedArray(e,i){return new bJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dv.ElementType="f32";let cs=class wJ extends uv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(wJ,e,i)}static fromTypedArray(e,i){return new wJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cs.ElementType="f32";let ph=class xJ extends hv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(xJ,e,i)}static fromTypedArray(e,i){return new xJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ph.ElementType="f32";let aw=class TJ extends ise{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(TJ,e,i)}static fromTypedArray(e,i){return new TJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};aw.ElementType="f32";let nse=class SJ extends ise{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(SJ,e,i)}static fromTypedArray(e,i){return new SJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};nse.ElementType="f64";let ose=class EJ extends rse{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(EJ,e,i)}static fromTypedArray(e,i){return new EJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ose.ElementType="f32";let K$=class CJ extends rse{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(CJ,e,i)}static fromTypedArray(e,i){return new CJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};K$.ElementType="f64";let ase=class MJ extends lv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(MJ,e,i)}static fromTypedArray(e,i){return new MJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ase.ElementType="f64";let lse=class AJ extends cv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(AJ,e,i)}static fromTypedArray(e,i){return new AJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lse.ElementType="f64";let Bl=class OJ extends uv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(OJ,e,i)}static fromTypedArray(e,i){return new OJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Bl.ElementType="f64";let oz=class RJ extends hv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(RJ,e,i)}static fromTypedArray(e,i){return new RJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};oz.ElementType="f64";let t3=class PJ extends lv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(PJ,e,i)}static fromTypedArray(e,i){return new PJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};t3.ElementType="u8";let az=class IJ extends cv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(IJ,e,i)}static fromTypedArray(e,i){return new IJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};az.ElementType="u8";let Q$=class $J extends uv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer($J,e,i)}static fromTypedArray(e,i){return new $J(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Q$.ElementType="u8";let Gl=class LJ extends hv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(LJ,e,i)}static fromTypedArray(e,i){return new LJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Gl.ElementType="u8";let lz=class DJ extends lv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(DJ,e,i)}static fromTypedArray(e,i){return new DJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lz.ElementType="u16";let cse=class NJ extends cv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(NJ,e,i)}static fromTypedArray(e,i){return new NJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cse.ElementType="u16";let cz=class FJ extends uv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(FJ,e,i)}static fromTypedArray(e,i){return new FJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cz.ElementType="u16";let CD=class UJ extends hv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(UJ,e,i)}static fromTypedArray(e,i){return new UJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CD.ElementType="u16";let uz=class kJ extends lv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(kJ,e,i)}static fromTypedArray(e,i){return new kJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uz.ElementType="u32";let use=class VJ extends cv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(VJ,e,i)}static fromTypedArray(e,i){return new VJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};use.ElementType="u32";let WRe=class zJ extends uv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(zJ,e,i)}static fromTypedArray(e,i){return new zJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};WRe.ElementType="u32";let YRe=class BJ extends hv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(BJ,e,i)}static fromTypedArray(e,i){return new BJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};YRe.ElementType="u32";let hse=class GJ extends lv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(GJ,e,i)}static fromTypedArray(e,i){return new GJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hse.ElementType="i8";let hz=class jJ extends cv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(jJ,e,i)}static fromTypedArray(e,i){return new jJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hz.ElementType="i8";let XRe=class HJ extends uv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(HJ,e,i)}static fromTypedArray(e,i){return new HJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};XRe.ElementType="i8";let ZRe=class qJ extends hv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(qJ,e,i)}static fromTypedArray(e,i){return new qJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ZRe.ElementType="i8";let JRe=class WJ extends lv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(WJ,e,i)}static fromTypedArray(e,i){return new WJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};JRe.ElementType="i16";let dz=class YJ extends cv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(YJ,e,i)}static fromTypedArray(e,i){return new YJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dz.ElementType="i16";let KRe=class XJ extends uv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(XJ,e,i)}static fromTypedArray(e,i){return new XJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KRe.ElementType="i16";let QRe=class ZJ extends hv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(ZJ,e,i)}static fromTypedArray(e,i){return new ZJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QRe.ElementType="i16";let ePe=class JJ extends lv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(JJ,e,i)}static fromTypedArray(e,i){return new JJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ePe.ElementType="i32";let tPe=class KJ extends cv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(KJ,e,i)}static fromTypedArray(e,i){return new KJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tPe.ElementType="i32";let iPe=class QJ extends uv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(QJ,e,i)}static fromTypedArray(e,i){return new QJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iPe.ElementType="i32";let rPe=class eK extends hv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(eK,e,i)}static fromTypedArray(e,i){return new eK(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rPe.ElementType="i32";function sPe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function Y_t(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function X_t(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function Z_t(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let Dpe=class nPe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fieldNames){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new nPe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}},J_t=class oPe{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,i){return this._appendField(e,dv,i),this}vec2f64(e,i){return this._appendField(e,lse,i),this}vec3f(e,i){return this._appendField(e,cs,i),this}vec3f64(e,i){return this._appendField(e,Bl,i),this}vec4f(e,i){return this._appendField(e,ph,i),this}vec4f64(e,i){return this._appendField(e,oz,i),this}mat3f(e,i){return this._appendField(e,aw,i),this}mat3f64(e,i){return this._appendField(e,nse,i),this}mat4f(e,i){return this._appendField(e,ose,i),this}mat4f64(e,i){return this._appendField(e,K$,i),this}vec4u8(e,i){return this._appendField(e,Gl,i),this}f32(e,i){return this._appendField(e,sse,i),this}f64(e,i){return this._appendField(e,ase,i),this}u8(e,i){return this._appendField(e,t3,i),this}u16(e,i){return this._appendField(e,lz,i),this}i8(e,i){return this._appendField(e,hse,i),this}vec2i8(e,i){return this._appendField(e,hz,i),this}vec2i16(e,i){return this._appendField(e,dz,i),this}vec2u8(e,i){return this._appendField(e,az,i),this}vec4u16(e,i){return this._appendField(e,CD,i),this}u32(e,i){return this._appendField(e,uz,i),this}_appendField(e,i,r){const s=i.ElementCount*sPe(i.ElementType),n=this.stride;this.fields.set(e,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new Dpe(this,e)}createView(e){return new Dpe(this,e)}clone(){const e=new oPe;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((i,r)=>e.fields.set(r,i)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function qs(){return new J_t}let ct=class{constructor(e,i,r=!1,s=i){this.data=e,this.size=i,this.exclusive=r,this.stride=s}};var tK;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(tK||(tK={}));var xn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(xn||(xn={}));function fh(t,e=!1){return t<=wy?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function K_t(t){return length<=wy?Array.from(t):new Float64Array(t)}function Ip(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Fn(t,e=!1){return t<=wy?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Npe(t){return length<=wy?Array.from(t):new Float32Array(t)}function Fpe(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Q_t(t){if(t.length<wy)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Kl=Ai();let evt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Rt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new evt(`${e} at ${i}`)}}function sE(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Upe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function vF(t,e,i,r,s,n=je()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function kpe(t,e,i,r,s){Kl[0]=t[0],Kl[1]=t[1],Kl[2]=t[2],Kl[3]=1,ld(Kl,Kl,e),s.length>2&&(s[2]=-Kl[2]),ld(Kl,Kl,i),Rt(Kl[3]!==0),s[0]=Kl[0]/Kl[3],s[1]=Kl[1]/Kl[3],s[2]=Kl[2]/Kl[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function tvt(t,e){return Math.log(t)/Math.log(e)}function ivt(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function aPe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let lPe=class cPe{constructor(e,i,r,s){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this._children=void 0,Rt(e.length>=1),Rt(r.length%this._numIndexPerPrimitive==0),Rt(r.length>=e.length*this._numIndexPerPrimitive),Rt(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*r[this._numIndexPerPrimitive*e[0]];Bw.clear(),Bw.push(l);const c=Ve(n[l],n[l+1],n[l+2]),h=zr(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let y=0;y<this._numIndexPerPrimitive;++y){l=o*r[g+y],Bw.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const d=En($(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Bw.length;++m){l=Bw.getItemAt(m);const g=n[l]-d[0],y=n[l+1]-d[1],v=n[l+2]-d[2],x=g*g+y*y+v*v;if(x<=f)continue;const S=Math.sqrt(x),E=.5*(S-this.radius);this.radius=this.radius+E,f=this.radius*this.radius;const C=E/S;d[0]+=g*C,d[1]+=y*C,d[2]+=v*C}this.center=d,Bw.clear()}getChildren(){if(this._children||Eo(this.bbMin,this.bbMax)<=1)return this._children;const e=En($(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[d],m=n[f],g=n[f+1],y=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[d+v];const x=n[f],S=n[f+1],E=n[f+2];x<m&&(m=x),S<g&&(g=S),E<y&&(y=E)}m<e[0]&&(h|=1),g<e[1]&&(h|=2),y<e[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new cPe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Bw.prune()}};const Bw=new vi({deallocator:null});let MD=class{constructor(){this.id=nh()}unload(){}};function rvt(t){return t?{p0:zr(t.p0),p1:zr(t.p1),p2:zr(t.p2)}:{p0:$(),p1:$(),p2:$()}}function Vpe(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function svt(t,e,i){return be(UG,e,t),be(zpe,i,t),ze(Et(UG,UG,zpe))/2}new rv(Fm);new rv(()=>rvt());const UG=$(),zpe=$();function nvt(t,e,i){if(!t||!e)return!1;const{size:r,data:s}=t;fe(i,0,0,0),fe(up,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*r,c=e[a+1]*r,h=e[a+2]*r;fe(aa,s[l+0],s[l+1],s[l+2]),fe(h_,s[c+0],s[c+1],s[c+2]),fe(bF,s[h+0],s[h+1],s[h+2]);const d=svt(aa,h_,bF);d?(we(aa,aa,h_),we(aa,aa,bF),pe(aa,aa,1/3*d),we(i,i,aa),n+=d):(we(up,up,aa),we(up,up,h_),we(up,up,bF),o+=3)}return(o!==0||n!==0)&&(n!==0?(pe(i,i,1/n),!0):o!==0&&(pe(i,up,1/o),!0))}function ovt(t,e,i){if(!t||!e)return!1;const{size:r,data:s}=t;fe(i,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&pe(i,i,1/o),o>0}function avt(t,e,i,r){if(!t)return!1;fe(r,0,0,0),fe(up,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const d=h<l?h:l,f=h<l?h+1:0,m=(e?e[d]:d)*o,g=(e?e[f]:f)*o;aa[0]=a[m],aa[1]=a[m+1],aa[2]=a[m+2],h_[0]=a[g],h_[1]=a[g+1],h_[2]=a[g+2],pe(aa,we(aa,aa,h_),.5);const y=WL(aa,h_);y>0?(we(r,r,pe(aa,aa,y)),s+=y):s===0&&(we(up,up,aa),n++)}return s!==0?(pe(r,r,1/s),!0):n!==0&&(pe(r,up,1/n),!0)}const aa=$(),h_=$(),bF=$(),up=$();function iA(t){if(Array.isArray(t)){if(t.length<wy)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<wy)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function uPe(t){const e=3*t;return e<=wy?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let X1=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const hPe=[0],rA=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function i3(t){if(t===1)return hPe;if(t<wy)return Array.from(new Uint16Array(rA.buffer,0,t));if(t<rA.length)return new Uint16Array(rA.buffer,0,t);if(t>X1.length){const e=Math.max(2*X1.length,t);X1=new Uint32Array(e);for(let i=0;i<X1.length;i++)X1[i]=i}return new Uint32Array(X1.buffer,0,t)}function $Zt(t){if(t===1)return hPe;if(t<wy)return Array.from(new Uint16Array(rA.buffer,0,t));if(t<rA.length)return new Uint16Array(rA.slice(0,t));if(t>X1.length){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}return new Uint32Array(X1.slice(0,t))}let v9=class{constructor(e){this.channel=e,this.id=nh()}};function iK(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function lvt(t,e){const i=t.length;for(let r=0;r<i;++r)EM[0]=t[r],e[r]=EM[0];return e}function cvt(t,e){const i=t.length;for(let r=0;r<i;++r)EM[0]=t[r],EM[1]=t[r]-EM[0],e[r]=EM[1];return e}const EM=new Float32Array(2);function rK(t,e){return A(t)&&(t=[]),t.push(e),t}function sK(t,e){if(A(t))return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function uvt(t,e,i,r,s){wF[0]=t.get(e,0),wF[1]=t.get(e,1),wF[2]=t.get(e,2),iK(wF,Gw,3),i.set(s,0,Gw[0]),r.set(s,0,Gw[1]),i.set(s,1,Gw[2]),r.set(s,1,Gw[3]),i.set(s,2,Gw[4]),r.set(s,2,Gw[5])}const wF=$(),Gw=new Float32Array(6);let qn=class dPe extends MD{constructor(e,i,r=[],s=null,n=xn.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of i)c&&this._vertexAttributes.set(l,{...c});if(r==null||r.length===0){const l=hvt(this._vertexAttributes),c=i3(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of r)c&&(this._indices.set(l,iA(c)),l===P.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const i=new dPe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,s)=>{r.exclusive=!1,i._vertexAttributes.set(s,r)}),this._indices.forEach((r,s)=>i._indices.set(s,r)),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let i=this._vertexAttributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Q_t(i.data)},this._vertexAttributes.set(e,i)),i}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return A(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===xn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===xn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(b(this._transformation)&&at(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.indices.get(P.POSITION),r=this.vertexAttributes.get(P.POSITION);return nvt(r,i,e)}_computeAttachmentOriginLines(e){const i=this.vertexAttributes.get(P.POSITION),r=this.indices.get(P.POSITION);return avt(i,r,r&&dvt(this.material.parameters,i,r),e)}_computeAttachmentOriginPoints(e){const i=this.indices.get(P.POSITION),r=this.vertexAttributes.get(P.POSITION);return ovt(r,i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(P.POSITION),i=this.vertexAttributes.get(P.POSITION);if(!e||e.length===0||!i)return null;const r=this.type===xn.Mesh?3:1;Rt(e.length%r==0,"Indexing error: "+e.length+" not divisible by "+r);const s=i3(e.length/r);return new lPe(s,r,e,i)}get transformation(){return vt(this._transformation,xd)}set transformation(e){this._transformation=e&&e!==xd?JA(e):null}get shaderTransformation(){return b(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return b(this._shaderTransformer)}addHighlight(){const e=new v9(q_.Highlight);return this.highlights=rK(this.highlights,e),e}removeHighlight(e){this.highlights=sK(this.highlights,e)}};function hvt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function dvt(t,e,i){return!(!("isClosed"in t)||!t.isClosed)&&(i?i.length>2:e.data.length>6)}const nE=tK,kG=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],pvt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],fvt=[0,0,1,0,1,1,0,1],mvt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],pPe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)pPe[6*t+e]=t;const uT=new Array(36);for(let t=0;t<6;t++)uT[6*t+0]=0,uT[6*t+1]=1,uT[6*t+2]=2,uT[6*t+3]=2,uT[6*t+4]=3,uT[6*t+5]=0;function gvt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=kG[r][0]*e[0],i[3*r+1]=kG[r][1]*e[1],i[3*r+2]=kG[r][2]*e[2];return new qn(t,[[P.POSITION,new ct(i,3,!0)],[P.NORMAL,new ct(pvt,3)],[P.UV0,new ct(fvt,2)]],[[P.POSITION,mvt],[P.NORMAL,pPe],[P.UV0,uT]])}const VG=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],yvt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],_vt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],vvt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function bvt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=VG[r][0]*e[0],i[3*r+1]=VG[r][1]*e[1],i[3*r+2]=VG[r][2]*e[2];return new qn(t,[[P.POSITION,new ct(i,3,!0)],[P.NORMAL,new ct(yvt,3)]],[[P.POSITION,_vt],[P.NORMAL,vvt]])}const J6=wr(-.5,0,-.5),K6=wr(.5,0,-.5),Q6=wr(0,0,.5),e8=wr(0,.5,0),oE=ys(),aE=ys(),sA=ys(),nA=ys(),oA=ys();be(oE,J6,e8),be(aE,J6,K6),Et(sA,oE,aE),Re(sA,sA),be(oE,K6,e8),be(aE,K6,Q6),Et(nA,oE,aE),Re(nA,nA),be(oE,Q6,e8),be(aE,Q6,J6),Et(oA,oE,aE),Re(oA,oA);const zG=[J6,K6,Q6,e8],wvt=[0,-1,0,sA[0],sA[1],sA[2],nA[0],nA[1],nA[2],oA[0],oA[1],oA[2]],xvt=[0,1,2,3,1,0,3,2,1,3,0,2],Tvt=[0,0,0,1,1,1,2,2,2,3,3,3];function Svt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=zG[r][0]*e[0],i[3*r+1]=zG[r][1]*e[1],i[3*r+2]=zG[r][2]*e[2];return new qn(t,[[P.POSITION,new ct(i,3,!0)],[P.NORMAL,new ct(wvt,3)]],[[P.POSITION,xvt],[P.NORMAL,Tvt]])}function DZt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),d=(c+1)*(h+1),f=Fn(3*d),m=Fn(3*d),g=Fn(2*d),y=[];let v=0;for(let C=0;C<=h;C++){const R=[],O=C/h,U=a+O*l,L=Math.cos(U);for(let B=0;B<=c;B++){const G=B/c,j=n+G*o,q=Math.cos(j)*L,ie=Math.sin(U),ee=-Math.sin(j)*L;f[3*v]=q*e,f[3*v+1]=ie*e,f[3*v+2]=ee*e,m[3*v]=q,m[3*v+1]=ie,m[3*v+2]=ee,g[2*v]=G,g[2*v+1]=O,R.push(v),++v}y.push(R)}const x=new Array;for(let C=0;C<h;C++)for(let R=0;R<c;R++){const O=y[C][R],U=y[C][R+1],L=y[C+1][R+1],B=y[C+1][R];C===0?(x.push(O),x.push(L),x.push(B)):C===h-1?(x.push(O),x.push(U),x.push(L)):(x.push(O),x.push(U),x.push(L),x.push(L),x.push(B),x.push(O))}const S=[[P.POSITION,x],[P.NORMAL,x]],E=[[P.POSITION,new ct(f,3,!0)],[P.NORMAL,new ct(m,3,!0)]];return s.uv&&(E.push([P.UV0,new ct(g,2,!0)]),S.push([P.UV0,x])),s.offset&&(S[0][0]=P.OFFSET,E[0][0]=P.OFFSET,S.push([P.POSITION,new Array(x.length).fill(0)]),E.push([P.POSITION,new ct(Float64Array.from(s.offset),3,!0)])),new qn(t,E,S)}function Evt(t,e,i,r){const{vertexAttributes:s,indices:n}=fPe(e,i,r);return new qn(t,s,n)}function fPe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=r*(1+Math.sqrt(5))/2;s=[-r,h,0,r,h,0,-r,-h,0,r,-h,0,0,-r,h,0,r,h,0,-r,-h,0,r,-h,h,0,-r,h,0,r,-h,0,-r,-h,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)nE.scale(s,h,t/nE.length(s,h));let o={};function a(h,d){h>d&&([h,d]=[d,h]);const f=h.toString()+"."+d.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,nE.add(s,3*h,s,3*d,s,m),nE.scale(s,m,t/nE.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const d=n.length,f=new Array(4*d);for(let m=0;m<d;m+=3){const g=n[m],y=n[m+1],v=n[m+2],x=a(g,y),S=a(y,v),E=a(v,g),C=4*m;f[C]=g,f[C+1]=x,f[C+2]=E,f[C+3]=y,f[C+4]=S,f[C+5]=x,f[C+6]=v,f[C+7]=E,f[C+8]=S,f[C+9]=x,f[C+10]=S,f[C+11]=E}n=f,o={}}const l=Npe(s);for(let h=0;h<l.length;h+=3)nE.normalize(l,h);const c=[[P.POSITION,n],[P.NORMAL,n]];return{vertexAttributes:[[P.POSITION,new ct(Npe(s),3,!0)],[P.NORMAL,new ct(l,3,!0)]],indices:c}}function nK(t,e,i,r,s,n,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=b(s)&&s.length===2?s:[1,1],m=[[P.POSITION,new ct(c,3,!0)],[P.NORMAL,new ct(h,3,!0)],[P.UV0,new ct(o,o.length)],[P.COLOR,new ct(d,4,!0)],[P.SIZE,new ct(f,2)]];if(n!=null){const g=[n[0],n[1],n[2],n[3]];m.push([P.AUXPOS1,new ct(g,4)])}if(a!=null){const g=[a[0],a[1],a[2],a[3]];m.push([P.AUXPOS2,new ct(g,4)])}return new qn(t,m,null,null,xn.Point,l)}const Cvt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function NZt(t,e=Cvt){const i=new Array(12);for(let h=0;h<4;h++)for(let d=0;d<3;d++)i[3*h+d]=e[h][d];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[P.POSITION,r],[P.NORMAL,n],[P.UV0,r],[P.COLOR,n]],c=[[P.POSITION,new ct(i,3,!0)],[P.NORMAL,new ct(s,3,!0)],[P.UV0,new ct(o,2,!0)],[P.COLOR,new ct(a,4,!0)]];return new qn(t,c,l)}function Bpe(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let h=wr(0,a,0),d=wr(0,a+c,0),f=wr(0,-1,0),m=wr(0,1,0);s&&(a=c,d=wr(0,0,0),h=wr(0,a,0),f=wr(0,1,0),m=wr(0,-1,0));const g=[d,h],y=[f,m],v=r+2,x=Math.sqrt(c*c+l*l);if(s)for(let L=r-1;L>=0;L--){const B=L*(2*Math.PI/r),G=wr(Math.cos(B)*l,a,Math.sin(B)*l);g.push(G);const j=wr(c*Math.cos(B)/x,-l/x,c*Math.sin(B)/x);y.push(j)}else for(let L=0;L<r;L++){const B=L*(2*Math.PI/r),G=wr(Math.cos(B)*l,a,Math.sin(B)*l);g.push(G);const j=wr(c*Math.cos(B)/x,l/x,c*Math.sin(B)/x);y.push(j)}const S=new Array,E=new Array;if(n){for(let L=3;L<g.length;L++)S.push(1),S.push(L-1),S.push(L),E.push(0),E.push(0),E.push(0);S.push(g.length-1),S.push(2),S.push(1),E.push(0),E.push(0),E.push(0)}if(o){for(let L=3;L<g.length;L++)S.push(L),S.push(L-1),S.push(0),E.push(L),E.push(L-1),E.push(1);S.push(0),S.push(2),S.push(g.length-1),E.push(1),E.push(2),E.push(y.length-1)}const C=Fn(3*v);for(let L=0;L<v;L++)C[3*L]=g[L][0],C[3*L+1]=g[L][1],C[3*L+2]=g[L][2];const R=Fn(3*v);for(let L=0;L<v;L++)R[3*L]=y[L][0],R[3*L+1]=y[L][1],R[3*L+2]=y[L][2];const O=[[P.POSITION,S],[P.NORMAL,E]],U=[[P.POSITION,new ct(C,3,!0)],[P.NORMAL,new ct(R,3,!0)]];return new qn(t,U,O)}function Mvt(t,e,i,r,s,n,o){const a=s?f9(s):wr(1,0,0),l=n?f9(n):wr(0,0,0);o=o??!0;const c=ys();Re(c,a);const h=ys();pe(h,c,Math.abs(e));const d=ys();pe(d,h,-.5),we(d,d,l);const f=wr(0,1,0);Math.abs(1-xe(c,f))<.2&&fe(f,0,0,1);const m=ys();Et(m,c,f),Re(m,m),Et(f,m,c);const g=2*r+(o?2:0),y=r+(o?2:0),v=Fn(3*g),x=Fn(3*y),S=Fn(2*g),E=new Array(3*r*(o?4:2)),C=new Array(3*r*(o?4:2));o&&(v[3*(g-2)+0]=d[0],v[3*(g-2)+1]=d[1],v[3*(g-2)+2]=d[2],S[2*(g-2)]=0,S[2*(g-2)+1]=0,v[3*(g-1)+0]=v[3*(g-2)+0]+h[0],v[3*(g-1)+1]=v[3*(g-2)+1]+h[1],v[3*(g-1)+2]=v[3*(g-2)+2]+h[2],S[2*(g-1)]=1,S[2*(g-1)+1]=1,x[3*(y-2)+0]=-c[0],x[3*(y-2)+1]=-c[1],x[3*(y-2)+2]=-c[2],x[3*(y-1)+0]=c[0],x[3*(y-1)+1]=c[1],x[3*(y-1)+2]=c[2]);const R=(j,q,ie)=>{E[j]=q,C[j]=ie};let O=0;const U=ys(),L=ys();for(let j=0;j<r;j++){const q=j*(2*Math.PI/r);pe(U,f,Math.sin(q)),pe(L,m,Math.cos(q)),we(U,U,L),x[3*j+0]=U[0],x[3*j+1]=U[1],x[3*j+2]=U[2],pe(U,U,i),we(U,U,d),v[3*j+0]=U[0],v[3*j+1]=U[1],v[3*j+2]=U[2],S[2*j+0]=j/r,S[2*j+1]=0,v[3*(j+r)+0]=v[3*j+0]+h[0],v[3*(j+r)+1]=v[3*j+1]+h[1],v[3*(j+r)+2]=v[3*j+2]+h[2],S[2*(j+r)+0]=j/r,S[2*j+1]=1;const ie=(j+1)%r;R(O++,j,j),R(O++,j+r,j),R(O++,ie,ie),R(O++,ie,ie),R(O++,j+r,j),R(O++,ie+r,ie)}if(o){for(let j=0;j<r;j++){const q=(j+1)%r;R(O++,g-2,y-2),R(O++,j,y-2),R(O++,q,y-2)}for(let j=0;j<r;j++){const q=(j+1)%r;R(O++,j+r,y-1),R(O++,g-1,y-1),R(O++,q+r,y-1)}}const B=[[P.POSITION,E],[P.NORMAL,C],[P.UV0,E]],G=[[P.POSITION,new ct(v,3,!0)],[P.NORMAL,new ct(x,3,!0)],[P.UV0,new ct(S,2,!0)]];return new qn(t,G,B)}function FZt(t,e,i,r,s,n){r=r||10,s=s==null||s,Rt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const h=c/r*2*Math.PI;l.push([Math.cos(h)*i,Math.sin(h)*i])}return Avt(t,l,e,o,a,s,n)}function Avt(t,e,i,r,s,n,o=wr(0,0,0)){const a=e.length,l=Fn(i.length*a*3+(6*r.length||0)),c=Fn(i.length*a*3+(r?6:0)),h=new Array,d=new Array;let f=0,m=0;const g=ys(),y=ys(),v=ys(),x=ys(),S=ys(),E=ys(),C=ys(),R=$(),O=ys(),U=ys(),L=ys(),B=ys(),G=ys(),j=gr();fe(O,0,1,0),be(y,i[1],i[0]),Re(y,y),n?(we(R,i[0],o),Re(v,R)):fe(v,0,0,1),b9(y,v,O,O,S,v,Gpe),ge(x,v),ge(B,S);for(let k=0;k<r.length;k++)pe(E,S,r[k][0]),pe(R,v,r[k][2]),we(E,E,R),we(E,E,i[0]),l[f++]=E[0],l[f++]=E[1],l[f++]=E[2];c[m++]=-y[0],c[m++]=-y[1],c[m++]=-y[2];for(let k=0;k<s.length;k++)h.push(s[k][0]>0?s[k][0]:-s[k][0]-1+r.length),h.push(s[k][1]>0?s[k][1]:-s[k][1]-1+r.length),h.push(s[k][2]>0?s[k][2]:-s[k][2]-1+r.length),d.push(0),d.push(0),d.push(0);let q=r.length;const ie=r.length-1;for(let k=0;k<i.length;k++){let Z=!1;k>0&&(ge(g,y),k<i.length-1?(be(y,i[k+1],i[k]),Re(y,y)):Z=!0,we(U,g,y),Re(U,U),we(L,i[k-1],x),xD(i[k],U,j),OS(j,Td(L,g),R)?(be(R,R,i[k]),Re(v,R),Et(S,U,v),Re(S,S)):b9(U,x,B,O,S,v,Gpe),ge(x,v),ge(B,S)),n&&(we(R,i[k],o),Re(G,R));for(let Q=0;Q<a;Q++)if(pe(E,S,e[Q][0]),pe(R,v,e[Q][1]),we(E,E,R),Re(C,E),c[m++]=C[0],c[m++]=C[1],c[m++]=C[2],we(E,E,i[k]),l[f++]=E[0],l[f++]=E[1],l[f++]=E[2],!Z){const ne=(Q+1)%a;h.push(q+Q),h.push(q+a+Q),h.push(q+ne),h.push(q+ne),h.push(q+a+Q),h.push(q+a+ne);for(let te=0;te<6;te++){const de=h.length-6;d.push(h[de+te]-ie)}}q+=a}const ee=i[i.length-1];for(let k=0;k<r.length;k++)pe(E,S,r[k][0]),pe(R,v,r[k][1]),we(E,E,R),we(E,E,ee),l[f++]=E[0],l[f++]=E[1],l[f++]=E[2];const K=m/3;c[m++]=y[0],c[m++]=y[1],c[m++]=y[2];const Y=q-a;for(let k=0;k<s.length;k++)h.push(s[k][0]>=0?q+s[k][0]:-s[k][0]-1+Y),h.push(s[k][2]>=0?q+s[k][2]:-s[k][2]-1+Y),h.push(s[k][1]>=0?q+s[k][1]:-s[k][1]-1+Y),d.push(K),d.push(K),d.push(K);const D=[[P.POSITION,h],[P.NORMAL,d]],V=[[P.POSITION,new ct(l,3,!0)],[P.NORMAL,new ct(c,3,!0)]];return new qn(t,V,D)}function UZt(t,e,i,r){Rt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Rt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Rt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),Rt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=fh(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let d=0;d<3;d++)s[o++]=e[h][d];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([P.POSITION,n]),c.push([P.POSITION,new ct(s,3,!0)]),i){const h=Fn(3*i.length);let d=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[d++]=i[f][m];l.push([P.NORMAL,n]),c.push([P.NORMAL,new ct(h,3,!0)])}return r&&(c.push([P.COLOR,new ct(r,4)]),l.push([P.COLOR,i3(r.length/4)])),new qn(t,c,l,null,xn.Line)}function kZt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new qn(t,[[P.POSITION,new ct(o,3,!0)]],[[P.POSITION,l]])}function VZt(t,e){const i=t.getMutableAttribute(P.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];fe(lE,s,n,o),at(lE,lE,e),i[r]=lE[0],i[r+1]=lE[1],i[r+2]=lE[2]}}function Ovt(t,e=t){const i=t.vertexAttributes,r=i.get(P.POSITION).data,s=i.get(P.NORMAL).data;if(s){const n=e.getMutableAttribute(P.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(P.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function BG(t,e,i,r,s){return!(Math.abs(xe(e,t))>s)&&(Et(i,t,e),Re(i,i),Et(r,i,t),Re(r,r),!0)}function b9(t,e,i,r,s,n,o){return BG(t,e,s,n,o)||BG(t,i,s,n,o)||BG(t,r,s,n,o)}const Gpe=.99619469809,lE=ys();let Rvt=class{constructor(e,i){this.type=Io.Panoramic,this._configuration=new ese,this._passParameters=new tse,this._configuration.geometry=Oy.Cylinder,this._technique=i.techniqueRepository.acquire(_9,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=il(this._vao,"geometry"),this._passParameters.texture=new At(r,{pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0,width:1,height:512},HRe)}destroy(){this._passParameters.texture=dt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);Pvt(jpe,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",jpe),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Xt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=fPe(1,2,!1),r=i.indices[0][1],s=i.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const n=s.data,o=Hpe.createBuffer(r.length),a=o.position;for(let l=0;l<r.length;++l){const c=3*r[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new km(e,rr,{geometry:vh(Hpe)},{geometry:yr.createVertex(e,or.STATIC_DRAW,o.buffer)})}};function Pvt(t,e){Bo(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const jpe=Ge(),Hpe=qs().vec3f(P.POSITION);var W_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(W_||(W_={}));let oK=class extends Hl{constructor(){super(...arguments),this.type=W_.Rain}};u([X({count:W_.COUNT})],oK.prototype,"type",void 0);function Ivt(t){const e=new ar;return e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new fi("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new fi("offset",(i,r)=>$vt(i,r))),e.vertex.uniforms.add(new Be("width",i=>i.width)),e.vertex.uniforms.add(new Ps("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Ps("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Be("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===W_.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new Be("opacity",i=>i.opacity),new fi("particleColor",(i,r)=>Lvt(r,t))]),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===W_.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function $vt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=Uwe(aK,fe(aK,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return as(n,i,pe(n,n,t.width))}function Lvt(t,e){const i=e.type===W_.Rain?Nvt:Dvt,r=pe(aK,i,Fvt),s=t.camera.eye;Re(qpe,s);const n=Math.max(0,xe(qpe,t.lighting.mainLight.direction));return En(r,r,i,n)}const aK=$(),qpe=$(),Dvt=Ve(1,1,1),Nvt=Ve(.85,.85,.85),Fvt=.7,Uvt=Object.freeze(Object.defineProperty({__proto__:null,build:Ivt},Symbol.toStringTag,{value:"Module"}));let kvt=class extends Br{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},lK=class mPe extends dr{initializeProgram(e){return new cr(e.rctx,mPe.shader.get().build(this.configuration),t8)}initializePipeline(){return si({blending:qo(Ne.ONE,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};lK.shader=new lr(Uvt,()=>se(()=>import("./Precipitation.glsl-4ec74018.js"),[]));const t8=new Map([[P.POSITION,0],[P.INSTANCEFEATUREATTRIBUTE,1]]);let gPe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return b(i)?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},Vvt=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},hT=class extends Ee{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new kvt,this._animation=new gPe,this._updatingTracking=new dy,this._passParameters.time=0,this._passParameters.radius=ur(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Os(this._snowTechniqueCached),this._rainTechniqueCached=Os(this._rainTechniqueCached),this._vao=dt(this._vao),this._instanceIdBuffer=dt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(A(this._rainTechniqueCached)){const e=new oK;e.type=W_.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(lK,e)}return this._rainTechniqueCached}get _snowTechnique(){if(A(this._snowTechniqueCached)){const e=new oK;e.type=W_.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(lK,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){var l;const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),A(s)||A(this._vao)||A(this._instanceIdBuffer)||(b(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?ei(0,o,2*i):ei(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*pee(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Gre(n,t8,this._instanceIdBuffer,Wpe,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(Xt.TRIANGLES,0,3,this._numParticles*i),jre(n,t8,this._instanceIdBuffer,Wpe)}_ensureResources(e){A(this._vao)&&(this._vao=this._createVertexArrayObject(e)),A(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return yr.createVertex(e,or.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new km(e,t8,{geometry:vh(zvt)},{geometry:yr.createVertex(e,or.STATIC_DRAW,i)})}};u([p({constructOnly:!0})],hT.prototype,"context",void 0),u([p({constructOnly:!0})],hT.prototype,"view",void 0),u([p({readOnly:!0})],hT.prototype,"updating",null),u([p()],hT.prototype,"_updatingTracking",void 0),hT=u([N("esri.views.3d.environment.Precipitation")],hT);const zvt=qs().vec3f(P.POSITION),Wpe=vh(qs().f32(P.INSTANCEFEATUREATTRIBUTE),1),Bvt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),xF=128,Ype=-cJ,Xpe=0,GG=50,Gvt=()=>1-511/512,jvt=H6([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let Hvt=class{constructor(e,i){this.view=e,this.type=Io.Simple,this._passParameters=new tse,this._vaoCount=0,this._texV1=1,this._isMars=Ly(e.spatialReference);const r=ur(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Ype)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Xpe)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Xpe/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const s=i.renderContext.rctx;this._cameraChangeHandle=ae(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),Tr),this._vao=this._createRibbon(s),this._vaoCount=il(this._vao,"geometry"),this._fadeVao=ql(s),this._fadeVaoCount=il(this._fadeVao,"geometry");const n=this._isMars?Bvt:HRe;this._passParameters.texture=new At(s,{pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0,width:1,height:512},n);const o=new ese;o.geometry=Oy.Cone,this._coneTechnique=this._techniqueRepository.acquire(_9,o),o.geometry=Oy.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(_9,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=dt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(Xt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Xt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=$(),r=this._planetRadius,s=ze(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(GG,n),a=r+Ype;this._passParameters.innerScale=qvt(r+o,r,a)-1,this._passParameters.altitudeFade=kre(n),pe(i,e.eye,(r+GG)/s),Zpe(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=Gvt(),h=jvt(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>GG){Zpe(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Se((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,f=this._texV0+ei(this._texV1,l*h,g)*this._texVScale}Vt(this._passParameters.texV,d,f)}_createRibbon(e){const i=Fn(3+3*xF*3),r=new Uint32Array(3*xF*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<xF;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===xF-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=Jpe.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new km(e,rr,{geometry:vh(Jpe)},{geometry:yr.createVertex(e,or.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return we(cE,s.center,s.v2),pe(TF,cE,this._outerRimFactor),uV(jG,i,cE,r),kpe(cE,jG,e.projectionMatrix,e.viewport,cE),kpe(TF,jG,e.projectionMatrix,e.viewport,TF),Wr(cE,TF)/e.height}};function Zpe(t,e,i,r,s){const n=ze(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return pe(s.center,t,a/n),Et(l,t,e),Ll(l)<1&&Et(l,t,i),pe(l,l,o/ze(l)),Et(c,l,t),pe(c,c,o/ze(c)),o}const jG=Ge(),cE=$(),TF=$();function qvt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const Jpe=qs().vec3f(P.POSITION);let yPe=class _Pe extends dr{initializeProgram(e){return new cr(e.rctx,_Pe.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:qo(Ne.ONE,Ne.ZERO,Ne.ONE_MINUS_SRC_COLOR,Ne.ONE),colorWrite:wi})}};yPe.shader=new lr(URe,()=>se(()=>import("./FogHaze.glsl-1d59a1c4.js"),[]));const Wvt=.7,Yvt=1;let WP=class extends Ee{constructor(e){super(e),this._passParameters=new Kre;const i=e.context.renderContext.rctx;this._vao=ql(i,Y3);const r=ur(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Y$;const s=new Qre;s.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(yPe,s)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,i){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,i),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(n,e)})}_renderSimpleHaze(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Xt.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Re(Kpe,r.eye);const s=Math.max(0,xe(Kpe,e.bindParameters.lighting.mainLight.direction)),n=Zvt;pe(Qpe,n,0),En(this._passParameters.hazeColor,Qpe,n,s);const o=ze(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-OA(Wvt*pp,Yvt*pp,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([p({constructOnly:!0})],WP.prototype,"context",void 0),u([p({constructOnly:!0})],WP.prototype,"view",void 0),WP=u([N("esri.views.3d.environment.SimpleHaze")],WP);let Xvt=class{constructor(){this.strength=0,this.amount=0}};const Zvt=Ve(.24,.44,.8),Kpe=$(),Qpe=$();function dse(t){const e=T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(i),t.fragment.code.add(e),t.fragment.code.add(i)}function Jvt(){const t=new ar;return t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.COLOR,"vec4"),t.attributes.add(P.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new Ps("transform",(e,i)=>Kvt(e,i)),new Ni("viewport",(e,i)=>i.camera.fullViewport),new Be("pixelRatio",(e,i)=>i.camera.pixelRatio)]),t.include(dse),t.vertex.code.add(T`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function Kvt(t,e){return Bo(Dv,e.camera.projectionMatrix),Dv[10]=24e-8-1,Dv[11]=-1,Dv[14]=(24e-8-2)*e.camera.near,ln(Dv,Dv,e.camera.viewMatrix),ln(Dv,Dv,t.modelMatrix)}const Dv=Ge(),Qvt=Object.freeze(Object.defineProperty({__proto__:null,build:Jvt},Symbol.toStringTag,{value:"Module"}));let e1t=class extends Br{constructor(){super(...arguments),this.modelMatrix=Ge()}},vPe=class bPe extends dr{constructor(e){super(e,new Hl,()=>this.destroy())}initializeProgram(e){return new cr(e.rctx,bPe.shader.get().build(),rr)}initializePipeline(){return si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),depthTest:{func:hs.LEQUAL},colorWrite:wi})}};vPe.shader=new lr(Qvt,()=>se(()=>import("./Stars.glsl-3313ceb9.js"),[]));let U1=class extends Ee{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return b(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new e1t,this._updatingTracking=new dy}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=lu(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Os(this._technique),this._vao=dt(this._vao)}render(e){const{rctx:i}=e;if(this._ensureResources(i),A(this._technique)||A(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Xt.POINTS,0,this._numPoints)}_ensureResources(e){if(b(this._technique)||A(uE))return;this._technique=new vPe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=uE.byteLength/efe;const i=new Float32Array(uE,0,2*this._numPoints),r=new Uint8Array(uE,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),ii)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),s=Bo(this._renderParameter.modelMatrix,r1t);FA(s,s,-r*Math.PI),ln(s,i1t,s),FA(s,s,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,s){const n=tfe.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=i[2*c+0],d=i[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(d)),o.set(c,1,-Math.sin(h)*Math.sin(d)),o.set(c,2,-Math.cos(d));const f=this._unpackUint8Attributes(r[c]),m=this._hexToRGB(t1t[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new km(e,rr,{geometry:vh(tfe)},{geometry:yr.createVertex(e,or.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(b(uE))return null;const e=jL(async i=>{const{data:r}=await AWe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),uE=r});return e.promise.catch(i=>{kn(i)||le.getLogger(this.declaredClass).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new J("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/efe;if(i%1!=0||i>5e4||i<5e3)throw new J("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([p({constructOnly:!0})],U1.prototype,"view",void 0),u([p({constructOnly:!0})],U1.prototype,"requestRender",void 0),u([p({readOnly:!0})],U1.prototype,"updating",null),u([p()],U1.prototype,"_loadDataTask",void 0),u([p()],U1.prototype,"_updatingTracking",void 0),U1=u([N("esri.views.3d.environment.Stars")],U1);const t1t=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],i1t=Tre(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),r1t=Tre(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),efe=9,tfe=qs().vec3f(P.POSITION).vec4u8(P.COLOR).f32(P.SIZE);let uE=null;function s1t(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function w9(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function pse(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>ul()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function fse(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-r*c,t[2]=n*h+o*c+r*l-s*a,t[3]=o*h-r*a-s*l-n*c,t}function n1t(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function o1t(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function a1t(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function l1t(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function i8(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=i[0],g=i[1],y=i[2],v=i[3];return c=s*m+n*g+o*y+a*v,c<0&&(c=-c,m=-m,g=-g,y=-y,v=-v),1-c>ul()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(d=1-r,f=r),t[0]=d*s+f*m,t[1]=d*n+f*g,t[2]=d*o+f*y,t[3]=d*a+f*v,t}function c1t(t){const e=qL,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function u1t(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function sS(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function wPe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function h1t(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function d1t(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const mse=im,p1t=Rr,f1t=Kee,m1t=fse,g1t=b3,y1t=Wwe,_1t=kk,xPe=Qee,v1t=xPe,TPe=ete,b1t=TPe,gse=qwe,w1t=HM,x1t=tte;function T1t(t,e,i){const r=xe(e,i);return r<-.999999?(Et(Km,S1t,e),Bu(Km)<1e-6&&Et(Km,E1t,e),Re(Km,Km),w9(t,Km,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Et(Km,e,i),t[0]=Km[0],t[1]=Km[1],t[2]=Km[2],t[3]=1+r,gse(t,t))}const Km=$(),S1t=Ve(1,0,0),E1t=Ve(0,1,0);function C1t(t,e,i,r,s,n){return i8(ife,e,s,n),i8(rfe,i,r,n),i8(t,ife,rfe,2*n*(1-n)),t}const ife=Kp(),rfe=Kp();function M1t(t,e,i,r){const s=A1t;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],gse(t,wPe(t,s))}const A1t=Hs();Object.freeze(Object.defineProperty({__proto__:null,add:f1t,calculateW:l1t,conjugate:sS,copy:mse,dot:y1t,equals:x1t,exactEquals:w1t,fromEuler:h1t,fromMat3:wPe,getAxisAngle:pse,identity:s1t,invert:u1t,len:v1t,length:xPe,lerp:_1t,mul:m1t,multiply:fse,normalize:gse,random:c1t,rotateX:n1t,rotateY:o1t,rotateZ:a1t,rotationTo:T1t,scale:g1t,set:p1t,setAxes:M1t,setAxisAngle:w9,slerp:i8,sqlerp:C1t,sqrLen:b1t,squaredLength:TPe,str:d1t},Symbol.toStringTag,{value:"Module"}));function AD(t=R1t){return[t[0],t[1],t[2],t[3]]}function KZt(t,e,i=AD()){return ge(i,t),i[3]=e,i}function sfe(t,e,i=AD()){return Et(i,t,e),Re(i,i),i[3]=-zwe(t,e),i}function QZt(t,e,i=AD()){return w9(SF,t,nfe(t)),w9(ofe,e,nfe(e)),fse(SF,ofe,SF),O1t(i,Sc(pse(i,SF)))}function eJt(t){return t}function tJt(t){return t[3]}function nfe(t){return ci(t[3])}function O1t(t,e){return t[3]=e,t}const R1t=[0,0,1,0],SF=Kp(),ofe=Kp();AD();function P1t(t,e,i){const r=t.parallax.anchorPointClouds;t.fadeIn.stage===Yu.FINISHED&&(t.fadeIn.factor=0,ge(r,Zg),t.fadeIn.stage=Yu.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=$o.FINISHED),t.fadeIn.stage===Yu.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(Zre(t.data)&&t.renderingStage!==wn.RENDERING||t.renderingStage===wn.FADING_TEXTURE_CHANNELS)&&(ge(r,Zg),t.fadeIn.stage=Yu.FADE_IN,t.startTime=e,t.renderingStage===wn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=wn.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Yu.FADE_IN?t.fadeIn.factor=i?Se((e-t.startTime)/(SPe*i),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Yu.FADE_IN&&(t.fadeIn.stage=Yu.FINISHED,t.fadeIn.factor=1)}function I1t(t,e,i){const{fadeInOut:r,crossFade:s}=t;r.stage===$o.FINISHED&&(t.startTime=e,r.factor=1,r.stage=$o.FADE_OUT),r.factor>0&&r.stage===$o.FADE_OUT?r.factor=i?1-Se((e-t.startTime)/(F1t*i),0,1):0:(r.factor<=0&&r.stage===$o.FADE_OUT&&(r.factor=0,ge(t.parallax.anchorPointClouds,Zg)),r.factor<=0&&r.stage===$o.FADE_OUT&&t.isCameraPositionFinal&&(r.factor=0,r.stage=$o.SWITCH,t.crossFade.enabled=!1,s.factor=1),r.stage===$o.SWITCH&&(Zre(t.data)&&t.renderingStage!==wn.RENDERING||t.renderingStage===wn.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,r.factor=0,r.stage=$o.FADE_IN,ge(t.parallax.anchorPointClouds,Zg),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===wn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=wn.SWITCH_CHANNELS)),r.factor<1&&r.stage===$o.FADE_IN?r.factor=i?Se((e-t.startTime)/(SPe*i),0,1):1:r.factor>=1&&r.stage===$o.FADE_IN&&(r.stage=$o.FINISHED,r.factor=1))}function $1t(t,e,i,r){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!r||(ge(t.parallaxNew.anchorPointClouds,Zg),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=i?Se((e-t.startTime)/(U1t*i),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,ge(n,t.parallaxNew.anchorPointClouds),t.renderingStage===wn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=wn.SWITCH_CHANNELS))}function afe(t,e,i,r){const s=t.fadeInOutHeight,n=s.stage===sw.FINISHED?i:t.startTimeHeightFade;if(r!==0){const o=(i-n)/(k1t*r);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=i,s.factor=Se(s.factor,0,1),s.stage=sw.HEIGHT_FADE}function L1t(t,e,i,r,s){t.renderingStage===wn.FINISHED_RENDERING&&(t.renderingStage=wn.FADING_TEXTURE_CHANNELS);const n=ze(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-zi.radius>pp?1:0),t.isCameraPositionFinal=Bb(t.cameraPositionLastFrame,e.eye),Re(Zg,e.eye),pe(Zg,Zg,zi.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&ge(o.anchorPointClouds,Zg);const a=ze(be(N1t,o.anchorPointClouds,Zg));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Yu.FINISHED?P1t(t,r,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==$o.FINISHED?I1t(t,r,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===wn.FADING_TEXTURE_CHANNELS?$1t(t,r,s,(i!==Ki.IDLE||!Zre(t.data))&&t.renderingStage!==wn.FADING_TEXTURE_CHANNELS):l=!1;const c=n-zi.radius;if((c>1.7*pp||c<-pp)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>pp||c<-.35*pp)&&t.fadeInOutHeight.factor<1?afe(t,!1,r,s):c<pp&&c>-.35*pp&&t.fadeInOutHeight.factor>0?afe(t,!0,r,s):t.fadeInOutHeight.stage=sw.FINISHED,t.renderingStage===wn.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=wn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-zi.radius*zi.radius,0))/n,sfe(lfe,o.anchorPointClouds,hE),ih(o.transform,xd,hE[3],hE),l){const{parallaxNew:h}=t;sfe(lfe,h.anchorPointClouds,hE),ih(h.transform,xd,hE[3],hE)}ge(t.cameraPositionLastFrame,e.eye)}function D1t(t){return t.crossFade.enabled||t.fadeInOut.stage!==$o.FINISHED||t.fadeIn.stage!==Yu.FINISHED||t.fadeInOutHeight.stage!==sw.FINISHED||t.renderingStage!==wn.FINISHED}const lfe=Ve(0,0,1),hE=AD(),Zg=$(),N1t=$(),SPe=1,F1t=.5,U1t=1.3,k1t=1;let Z3=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var In;function cfe(t=me("enable-feature:high-quality-idle")){const e=new Z3;return t&&(e.set(Ki.INTERACTING,In.Antialiasing,!0),e.set(Ki.IDLE,In.Antialiasing,!0),e.set(Ki.INTERACTING,In.HighQualityTransparency,!0),e.set(Ki.IDLE,In.HighQualityTransparency,!0),e.set(Ki.INTERACTING,In.RealisticAtmosphere,!0),e.set(Ki.IDLE,In.RealisticAtmosphere,!0),e.set(Ki.IDLE,In.SSAO,!0),e.set(Ki.IDLE,In.WaterReflection,!0),e.set(Ki.IDLE,In.PhysicalPixelRendering,!0)),e.set(Ki.ANIMATING,In.ShadowMapUpdate,!0),e.set(Ki.INTERACTING,In.ShadowMapUpdate,!0),e.set(Ki.IDLE,In.ShadowMapUpdate,!0),e.set(Ki.IDLE,In.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(In||(In={}));var aA;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(aA||(aA={}));var YP;const V1t=[Ie.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ie.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let ea=YP=class extends Ee{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new HG,this._newWeatherParameters=new HG,this._fadedWeatherParameters=new HG,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(V1t,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return b(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(In.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return b(this.atmosphere)?this.atmosphere.type:Io.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===Io.Realistic}updateAnimation(t){return!!b(this._precipitation)&&this._precipitation.update(t)}get updating(){return b(this._stars)&&this._stars.updating||b(this._clouds)&&this._clouds.running}get weatherVisible(){return ze(this.view.state.camera.eye)-ur(this.view.spatialReference).radius<=pp}get _stars(){var r;const t=this.view,e=((r=t.environment)==null?void 0:r.starsEnabled)??!1,i=this._get("_stars");return!e||A(this._context)?(He(i),null):b(i)?i:new U1({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||A(this._context))return He(t),null;const e=this.view,i=this._context;return b(t)&&t.context===i?t:(He(t),new hT({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||A(this._context))return He(t),null;if(b(t))return t;const e=this.view,i=this._context;return He(t),new Gc({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||A(this._context))return He(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=ur(this.view.spatialReference).radius;return b(t)&&t.viewingMode===e&&t.planetRadius===r?t:(He(t),new cT({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||A(this._context))return He(t),null;if(b(t))return t;const e=this.view,i=this._context;return new qP({context:i,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||A(this._context))return He(t),null;if(b(t))return t;const e=this.view,i=this._context;return new WP({context:i,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([wa(()=>{var i;return(i=this.view)==null?void 0:i.basemapTerrain},()=>this._updateBasemapTerrain(),Tr),ae(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),i=>this._updateAtmosphere(i),Tr),ae(()=>this._stars,e),ae(()=>this._precipitation,e),ae(()=>this._clouds,()=>this._updateWeather(),ii),ae(()=>this._fog,()=>this._updateFogHaze(),ii),ae(()=>this._simpleHaze,()=>this._updateFogHaze(),ii),ae(()=>this.view.state.mode,()=>{this._setNeedsRender()},Mi),ae(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Tr),ae(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Tr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=He(this._atmosphere),this._hqAtmosphere=He(this._hqAtmosphere),this._set("_stars",He(this._stars)),this._set("_precipitation",He(this._precipitation)),this._set("_clouds",He(this._clouds)),this._set("_cloudsComposition",He(this._cloudsComposition)),this._set("_fog",He(this._fog)),this._set("_simpleHaze",He(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=X0t(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(L1t(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===wn.FINISHED&&b(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===H.Color)switch(t.bindParameters.slot){case Ie.POSTPROCESSING_ENVIRONMENT_OPAQUE:b(this._stars)&&this._stars.render(t),b(this.atmosphere)&&(this.atmosphere.render(t),b(this._cloudsComposition)&&b(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&b(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),D1t(t.bindParameters.cloudsFade)&&b(this._context)&&this._context.requestRender());break;case Ie.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(b(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==Io.Realistic&&b(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&b(this._fog)&&this._fog.render(t,this._weatherParameters.fog),b(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(b(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=i,s.bindParameters.newLighting.set(t),r===aA.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return A(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Yu.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===$o.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;A(t)||A(this._clouds)||(this._clouds.applyPreset(El[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){b(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(A(this._fog)||A(this._simpleHaze)||A(t)||A(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=ei(3e-5,.005,t.weatherAdjustment**3),ge(this._newWeatherParameters.fog.color,ufe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Io.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=ei(4e-6,2e-4,(t.effect??0)**3),ge(this._newWeatherParameters.fog.color,z1t),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=ei(4e-6,2e-4,(t.effect??0)**3),ge(this._newWeatherParameters.fog.color,ufe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Io.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(b(this._atmosphere)?this._atmosphere.type===e:e===Io.None)return;this._atmosphere=He(this._atmosphere),this._hqAtmosphere=He(this._hqAtmosphere);const i=this._getAtmosphereClass(e);i&&b(this._context)&&(this._atmosphere=new i(this.view,this._context),e===Io.Simple&&(this._hqAtmosphere=new PG(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case Io.Realistic:return PG;case Io.Panoramic:return Rvt;case Io.Simple:return Hvt;default:case Io.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:i,viewingMode:r}=t;return!e||Dy(this.view.spatialReference)?Io.None:r===it.Local?Io.Panoramic:b(this._context)&&i==="high"&&PG.isSupported(this._context)&&w$(this.view.spatialReference)?Io.Realistic:Io.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===Io.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{hfe=YP.prototype._getAtmosphereClass,YP.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{YP.prototype._getAtmosphereClass=hfe}}}};u([p({constructOnly:!0})],ea.prototype,"view",void 0),u([p({readOnly:!0})],ea.prototype,"atmosphere",null),u([p({readOnly:!0})],ea.prototype,"_atmosphereType",null),u([p({type:Boolean,readOnly:!0})],ea.prototype,"updating",null),u([p({readOnly:!0})],ea.prototype,"weatherVisible",null),u([p()],ea.prototype,"_context",void 0),u([p()],ea.prototype,"_atmosphere",void 0),u([p()],ea.prototype,"_hqAtmosphere",void 0),u([p({readOnly:!0})],ea.prototype,"_stars",null),u([p({readOnly:!0})],ea.prototype,"_precipitation",null),u([p({readOnly:!0})],ea.prototype,"_clouds",null),u([p({readOnly:!0})],ea.prototype,"_cloudsComposition",null),u([p({readOnly:!0})],ea.prototype,"_fog",null),u([p({readOnly:!0})],ea.prototype,"_simpleHaze",null),u([p({readOnly:!0})],ea.prototype,"weatherEnabled",null),u([p({readOnly:!0})],ea.prototype,"_precipitationEnabled",null),u([p({readOnly:!0})],ea.prototype,"_weatherUpdateParameters",null),ea=YP=u([N("esri.views.3d.environment.EnvironmentRenderer")],ea);let HG=class{constructor(){this.fog=new G_t,this.haze=new Xvt}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,ge(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=ei(e.fog.amount,i.fog.amount,r),this.haze.amount=ei(e.haze.amount,i.haze.amount,r),this.fog.strength=ei(e.fog.strength,i.fog.strength,r),this.haze.strength=ei(e.haze.strength,i.haze.strength,r),En(this.fog.color,e.fog.color,i.fog.color,r)}};const z1t=Ve(.5,.5,.5),ufe=Ve(1.5,1.5,1.5);let hfe;function dfe(t,e,i){if(A(e.longitude)||A(e.latitude)||A(i.longitude)||A(i.latitude))throw new Error("Invalid points: no lon/lat");return B1t(t,e.longitude,e.latitude,i.longitude,i.latitude)}function B1t(t,e,i,r,s){const n=ci(i),o=ci(s),a=n-o,l=ci(e)-ci(r),c=Math.sin(a/2),h=Math.sin(l/2),d=2*Fp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function G1t(t,e,i){const r=e.spatialReference,s=ur(r),n=new st(e.x,t.y,r),o=new st(i.x,t.y,r),a=new st(t.x,e.y,r),l=new st(t.x,i.y,r);return{lon:dfe(s.radius,n,o),lat:dfe(s.radius,a,l)}}function j1t(t,e,i){const r=e/i,s=ci(t),n=Math.sin(r/2),o=Math.cos(s),a=2*Fp(Math.sqrt(n*n/(o*o)));return Sc(a)}function H1t(t,e){let i=t/15;return e||(i=Math.round(i)),i}function pfe(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=H1t(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var ffe,mfe,gfe,cK={},q1t={get exports(){return cK},set exports(t){cK=t}};ffe=q1t,mfe=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,d={dec:0,ra:0};function f(D){return D.valueOf()/l-.5+c}function m(D){return new Date((D+.5-c)*l)}function g(D){return f(D)-h}var y=23.4397*a;function v(D,V){return n(e(D)*i(y)-r(V)*e(y),i(D))}function x(D,V){return s(e(V)*i(y)+i(V)*e(y)*e(D))}function S(D,V,k){return n(e(D),i(D)*e(V)-r(k)*i(V))}function E(D,V,k){return s(e(V)*e(k)+i(V)*i(k)*i(D))}function C(D,V){return a*(280.16+360.9856235*D)-V}function R(D){return a*(357.5291+.98560028*D)}function O(D){return a*(1.9148*e(D)+.02*e(2*D)+3e-4*e(3*D))}function U(D,V){return D+V+102.9372*a+t}function L(D,V){var k=R(D),Z=U(k,O(k));return V||(V={dec:0,ra:0}),V.dec=x(Z,0),V.ra=v(Z,0),V}var B={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(D,V,k,Z){var Q=a*-k,ne=a*V,te=g(D),de=L(te,d),_e=C(te,Q)-de.ra;return Z||(Z={azimuth:0,altitude:0}),Z.azimuth=S(_e,ne,de.dec),Z.altitude=E(_e,ne,de.dec),Z}},G=[[-.83,"sunrise","sunset"]];B.addTime=function(D,V,k){G.push([D,V,k])};var j=9e-4;function q(D,V){return Math.round(D-j-V/(2*t))}function ie(D,V,k){return j+(D+V)/(2*t)+k}function ee(D,V,k){return h+D+.0053*e(V)-.0069*e(2*k)}function K(D,V,k){return o((e(D)-e(V)*e(k))/(i(V)*i(k)))}function Y(D){var V=a*(134.963+13.064993*D),k=a*(93.272+13.22935*D),Z=a*(218.316+13.176396*D)+6.289*a*e(V),Q=5.128*a*e(k),ne=385001-20905*i(V);return{ra:v(Z,Q),dec:x(Z,Q),dist:ne}}return B.getTimes=function(D,V,k){var Z=a*-k,Q=a*V,ne=q(g(D),Z),te=ie(0,Z,ne),de=R(te),_e=O(de),Ce=U(de,_e),Pe=x(Ce,0),Ze=ee(te,de,Ce);function Le(ui){return ee(ie(K(ui,Q,Pe),Z,ne),de,Ce)}function Me(ui){var li=(e(ui)-e(Q)*e(Pe))/(i(Q)*i(Pe));return li<-1?B.PolarException.MIDNIGHT_SUN:li>1?B.PolarException.POLAR_NIGHT:B.PolarException.NORMAL}var qe,We,$t,ut,Qt,ai={solarNoon:m(Ze),nadir:m(Ze-.5),polarException:B.PolarException.NORMAL};for(qe=0,We=G.length;qe<We;qe+=1)Qt=Ze-((ut=Le(($t=G[qe])[0]*a))-Ze),ai[$t[1]]=m(Qt),ai[$t[2]]=m(ut);return ai.polarException=Me(G[0][0]*a),ai},B.getMoonPosition=function(D,V,k){var Z=a*-k,Q=a*V,ne=g(D),te=Y(ne),de=C(ne,Z)-te.ra,_e=E(de,Q,te.dec);return _e+=.017*a/r(_e+10.26*a/(_e+5.1*a)),{azimuth:S(de,Q,te.dec),altitude:_e,distance:te.dist}},B.getMoonFraction=function(D){var V=g(D),k=L(V),Z=Y(V),Q=149598e3,ne=o(e(k.dec)*e(Z.dec)+i(k.dec)*i(Z.dec)*i(k.ra-Z.ra)),te=n(Q*e(ne),Z.dist-Q*i(ne));return(1+i(te))/2},B},(gfe=mfe())!==void 0&&(ffe.exports=gfe);const nS=cK,Gg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function W1t(t,e,i,r,s,n){fe(n.ambient.color,1,1,1),n.ambient.intensity=Gg.global.ambient,fe(n.direct.color,1,1,1),n.direct.intensity=Gg.global.direct;const o=e[2],a=Se((Math.abs(o)-Gg.local.altitude)/(Gg.global.altitude-Gg.local.altitude),0,1);let l;if(n.globalFactor=a,b(t)&&(l=nS.getTimes(t,e[1],e[0])),a<1){let c;if(b(t))c=ebt(t,l,r);else{const h=MPe(r);c={direct:{intensity:Gg.local.directAtNoon*h.direct,color:Ve(1,1,1)},ambient:{intensity:Gg.local.ambientAtNoon*h.ambient,color:Ve(1,1,1)},timeOfDay:"early afternoon"}}En(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=ei(c.ambient.intensity,n.ambient.intensity,a),En(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=ei(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=b(t)?Q1t(t,l):1,b(t)?Y1t(t,e,i,n.direct.directionToLightSource):EPe(s,i,n.direct.directionToLightSource)}function EPe(t,e,i){e===it.Global?Re(qG,t.eye):fe(qG,0,0,1),pe(WG,t.viewForward,-1);const r=j6(WG,qG),s=Math.max(r-2*YG,0),n=.85*s/(s+1),o=Math.max(YG,r-YG-n);vd(_fe,-o,t.viewRight),at(i,WG,_fe),we(i,i,pe(tbt,t.viewRight,ibt)),Re(i,i)}function Y1t(t,e,i,r){const s=K1t,n=zp(J1t);if(i===it.Global)nS.getPosition(t,0,0,s),fe(r,0,0,-1),NA(n,n,-s.azimuth),lV(n,n,-s.altitude),at(r,r,n);else{const o=Gg.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Se(c,0,1),c<1?(nS.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),fe(r,0,-1,0),FA(n,n,-s.azimuth),NA(n,n,-s.altitude),at(r,r,n)}}function X1t(t,e){if(e===it.Global)return!0;const i=Gg.planarDirection;return Math.abs(t)<i.localAltitude}const Z1t=Ve(.5773502691896258,-.5773502691896258,.5773502691896258);let CPe=class{constructor(){this.ambient={color:Ve(1,1,1),intensity:.55},this.direct={color:Ve(1,1,1),intensity:.55,directionToLightSource:zr(Z1t)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const J1t=Ge(),K1t={azimuth:0,altitude:0};function Q1t(t,e){const i=t.valueOf();let r,s;e.polarException===nS.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===nS.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Se(Math.abs(i-n)/432e5,0,1)}function MPe(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function yfe(t,e){const i=(t[0]+t[1]+t[2])/3;for(let r=0;r<3;r++)t[r]=t[r]+(i-t[r])*e;return t}function ebt(t,e,i){const r=t.valueOf();let s,n;e.polarException===nS.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===nS.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=s-d/2,m=s+d/2,g=n-d/2,y=n+d/2,v=Gg.local,x=[.01,v.ambientAtNight],S=[.8,.8,1],E=[.01,.01,.01],C=[v.directAtTwilight,v.ambientAtTwilight],R=[1,.6,.5],O=[.8,.8,1],U=[.9*v.directAtNoon,v.ambientAtNoon],L=[1,.98,.98],B=[.98,.98,1],G=[v.directAtNoon,v.ambientAtNoon],j=[1,1,1],q=[1,1,1],ie=U,ee=L,K=B,Y=C,D=R,V=O;let k,Z,Q=[0,0],ne=[0,0,0],te=[0,0,0];r<f||r>y?(Q=x,ne=E,te=S,Z="night"):r<m?(k=m-f,Q=qa(r-f,k,x,C),ne=qa(r-f,k,E,R),te=qa(r-f,k,S,O),Z="sun rising"):r<c?(k=c-m,Q=qa(r-m,k,C,U),ne=qa(r-m,k,R,L),te=qa(r-m,k,O,B),Z="early morning"):r<a?(k=a-c,Q=qa(r-c,k,U,G),ne=qa(r-c,k,L,j),te=qa(r-c,k,B,q),Z="late morning"):r<h?(k=h-a,Q=qa(r-a,k,G,ie),ne=qa(r-a,k,j,ee),te=qa(r-a,k,q,K),Z="early afternoon"):r<g?(k=g-h,Q=qa(r-h,k,ie,Y),ne=qa(r-h,k,ee,D),te=qa(r-h,k,K,V),Z="late afternoon"):r<y&&(k=y-g,Q=qa(r-g,k,Y,x),ne=qa(r-g,k,D,E),te=qa(r-g,k,V,S),Z="sun setting");let de=0;switch(i){case"rainy":case"foggy":case"snowy":de=.5}de>0&&(ne=yfe(ne,de),te=yfe(te,de));const _e=Ve(ne[0],ne[1],ne[2]),Ce=Ve(te[0],te[1],te[2]),Pe=MPe(i);return{direct:{intensity:Q[0]*Pe.direct,color:_e},ambient:{intensity:Q[1]*Pe.ambient,color:Ce},timeOfDay:Z}}function qa(t,e,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*t/e+i[n];return s}const _fe=Ge(),qG=$(),WG=$(),tbt=$(),YG=.25,ibt=.2;let Pf=class extends ws.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new ir,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new g9,this._ambientLight=new Jre,this._moonLight=new $Re,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===it.Global&&w$(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new ea({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([ae(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Mi),ae(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Mi),ae(()=>e.stationary,()=>this._interactingStationaryHandler()),ae(()=>e.environment.lighting.directShadowsEnabled,i,Mi),ae(()=>e.environment.lighting.ambientOcclusionEnabled,i,Mi),ae(()=>e.environment.lighting.waterReflectionEnabled,i,Mi),ae(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},i,Mi),ae(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Mi),ae(()=>e.environment.weather.type,()=>this._updateLighting(null,aA.Faded),Mi),ae(()=>this.weatherEnabled,()=>this._updateLighting(null,aA.Faded),Mi),ae(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Tr),ae(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Tr),ae(()=>e.state.camera,r,Tr),ae(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=He(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!j2(r)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),b(this._referencePosWGS84Comparable)){const s=pfe(this._referencePosWGS84Comparable,vfe);b(s)&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=w$(this._view.spatialReference);if(r&&!j2(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return A(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=$()),r?IKe(s,this._referencePosWGS84Comparable):fe(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=aA.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=b(s)?rbt:sbt,o=this.weatherVisible?r.environment.weather.type:"disabled";b(s)?W1t(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&EPe(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;pe(a.intensity,l.color,l.intensity*Math.PI),ge(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;pe(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;En(h.intensity,obt,abt,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));pe(h.intensity,h.intensity,d),ge(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||A(e))return!1;const r=nbt;r.setTime((i||this._view.environment.lighting.date).getTime());const s=pfe(e,vfe);if(A(s))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=id(this._referencePosWGS84Comparable,!0,n=>X1t(n[2],this._view.state.viewingMode)),r=this._view.environment.background,s=r instanceof zOe?{type:"color",color:Rie(et.toUnitRGBA(r.color))}:{type:"color",color:di(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=R2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=R2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};u([p({type:Boolean,readOnly:!0})],Pf.prototype,"updating",null),u([p()],Pf.prototype,"disableQueries",void 0),u([p()],Pf.prototype,"_disableWeather",void 0),u([p()],Pf.prototype,"weatherEnabled",null),u([p()],Pf.prototype,"weatherVisible",null),u([p()],Pf.prototype,"referencePositionWGS84Comparable",null),u([p()],Pf.prototype,"_renderer",void 0),u([p()],Pf.prototype,"_referencePosWGS84Comparable",void 0),Pf=u([N("esri.views.3d.environment.SceneViewEnvironmentManager")],Pf);const rbt=new CPe,sbt=new CPe,nbt=new Date,vfe={hours:0,minutes:0,seconds:0},obt=Ve(.22,.22,.33),abt=Ve(.22,.22,.22);var vs;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(vs||(vs={}));var Oi;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Oi||(Oi={}));var va;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(va||(va={}));function eL(t,e){return(t&e)!=0}function x9(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const lw={selection:vs.NONE,interactionType:Oi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:va.TUMBLE};function APe(t,e,i,r){return e=e||t.viewForward,ge(r,e),pe(r,r,Math.sign(xe(e,i))),r}function lbt(t,e,i,r){return pbt(t,e,i,hbt(r,e,i,!0))}function cbt(t,e,i,r){const s=xe(i,be(t,r,e));return we(t,e,pe(t,i,s))}const ubt={dir:$(),len:0,clip:je()};function hbt(t,e,i,r){const s=ubt;return t?(i&&r&&(s.len=Wr(e,i)),ge(s.dir,t)):r?(s.len=Wr(e,i),be(s.dir,i,e),pe(s.dir,s.dir,1/s.len)):(be(s.dir,i,e),Re(s.dir,s.dir)),s}function dbt(t,e,i){const r=xe(t,i.dir),s=-Kr(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function pbt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!dbt(t[s],e,r))return!1;return!0}function fbt(t,e,i=lw){const r=yse(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=APe(e,i.interactionDirection,ybt(t,e,Math.sign(r),wbt),bbt),a=ge(xbt,e.viewForward),l=s.intersectInfiniteManifold(Td(e.eye,o),n,XG);return e.eye=b(l)?l:s.setAltitude(XG,n,e.eye),e.center=cbt(XG,e.eye,a,e.center),!0}function yse(t,e,i=lw){if(!mbt(t,i)||!t.state.constraints.altitude)return 0;const r=_bt(t.state.constraints.altitude,vbt);gbt(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Se(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function mbt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==Oi.TUMBLE||!eL(e.selection,vs.TILT))}function gbt(t,e,i){const r=e.interactionType;if(r===Oi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Oi.TUMBLE||r===Oi.ZOOM,c=yse(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,x9(c,h,l,a,.05*h,i)}function ybt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),pe(r,r,i),r}function _bt(t,e){return e.min=t.min,e.max=t.max,e}const vbt={min:0,max:0},bbt=$(),wbt=$(),xbt=$(),XG=$();function _se(t,e,i=lw){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;EF.min=0,EF.max=r,Sbt(t,i,EF);const s=vse(t,e),n=EF.max-s;return n>=-1e-6?0:n}function Tbt(t,e,i=lw){const r=_se(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=vse(t,e)+r,o=ge(Cbt,e.eye),a=APe(e,i.interactionDirection,Ebt(e,s.renderLocation,Obt),Abt);if(!xw(lOe(s.renderLocation,n),Td(e.eye,a),CF))return!1;e.eye=CF;const l=be(Mbt,e.eye,o);e.center=we(CF,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,CF);return b(h)&&(e.center=h),!0}function Sbt(t,e,i){const r=e.interactionType;if(r===Oi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Oi.ZOOM||r===Oi.PAN,c=_se(t,o),h=c===0?0:vse(t,o);i.min=s,i.max=n,x9(c,h,l,a,.05*h,i)}function vse(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Wr(e.eye,i.renderLocation):0}function Ebt(t,e,i){return Q_(i,t.eye,e)}const EF={min:0,max:0},Cbt=$(),Mbt=$(),Abt=$(),Obt=$(),CF=$();var Vs,Ga;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Vs||(Vs={}));let Rbt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ga.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ga||(Ga={}));let Pbt=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Ibt=class extends Pbt{constructor(e,i,r,s){super(e,i,r),this.center=b(s)?zr(s):null}},OPe=class{constructor(e){this.layerUid=e}},pz=class extends OPe{constructor(e,i){super(e),this.graphicUid=i}};function Vm(t){return b(t)&&b(t.dist)}function bfe(t){return(e,i,r)=>(En(wfe,e,i,r),!Ire(t,wfe))}function fz(t){return Vm(t)&&t.intersector===Vs.OBJECT&&!!t.target}function mz(t){return Vm(t)&&t.intersector===Vs.HUD&&!!t.target&&"center"in t.target&&b(t.target.center)}const wfe=$();let $bt=class{constructor(){this._transform=Ge(),this._transformInverse=new MF({value:this._transform},Va,Ge),this._transformInverseTranspose=new MF(this._transformInverse,hh,Ge),this._transformTranspose=new MF({value:this._transform},hh,Ge),this._transformInverseRotation=new MF({value:this._transform},h3e,Hs)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Bo(this._transform,e)}multiplyTransform(e){ln(this._transform,this._transform,e)}set(e){Bo(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},MF=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Lbt=class{constructor(e=0){this.offset=e,this.tmpVertex=$()}applyToVertex(e,i,r){const s=e+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)Nv[n]=e[0+n]+this.localOrigin[n],AF[n]=e[3+n]+this.localOrigin[n],dE[n]=Nv[n];const i=this.applyToVertex(Nv[0],Nv[1],Nv[2]);for(let n=0;n<3;++n)e[n]=i[n],e[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)dE[o]=n&1<<o?AF[o]:Nv[o];r(dE)}let s=0;for(let n=0;n<3;++n)Nv[n]*AF[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)s[o]?dE[o]=0:dE[o]=n&1<<o?Nv[o]:AF[o];r(dE)}}for(let n=0;n<3;++n)e[n+0]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const Nv=$(),AF=$(),dE=$();let Dbt=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=$(),this._mbs=to(),this._obb={center:$(),halfSize:ys(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,i,r){const s=e,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(e){const i=e[0],r=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),d=Math.sqrt(l*l+c*c+h*h);if(d<this._totalOffset)return e[0]-=i<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),g=Math.max(Math.abs(s),Math.abs(a)),y=Math.sqrt(f*f+m*m+g*g),v=this._totalOffset/y,x=this._totalOffset/d;return e[0]+=i*(i>0?v:x),e[1]+=r*(r>0?v:x),e[2]+=s*(s>0?v:x),e[3]+=n*(n<0?v:x),e[4]+=o*(o<0?v:x),e[5]+=a*(a<0?v:x),e}applyToMbs(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/i;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){const i=e.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,mm(this._obb.halfSize,e.halfSize,e.quaternion),we(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,be(this._obb.halfSize,this._obb.halfSize,e.center),sS(Efe,e.quaternion),mm(this._obb.halfSize,this._obb.halfSize,Efe),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},Nbt=class{constructor(e=0){this.offset=e,this.sphere=to(),this.tmpVertex=$()}applyToVertex(e,i,r){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*i+s[8]*r+s[12],o=s[1]*e+s[5]*i+s[9]*r+s[13],a=s[2]*e+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/i;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const xfe=new Nbt;function uK(t){return b(t)?(xfe.offset=t,xfe):null}const Tfe=new Dbt;function Fbt(t){return b(t)?(Tfe.offset=t,Tfe):null}const Sfe=new Lbt;function Ubt(t){return b(t)?(Sfe.offset=t,Sfe):null}const rb="terrain",Efe=Kp(),r3=1e-5;let kbt=class{constructor(e){this.options=new Rbt,this._results=new Vbt,this.transform=new $bt,this.tolerance=r3,this.verticalOffset=null,this._ray=ha(),this._rayEnd=$(),this._rayBeginTransformed=$(),this._rayEndTransformed=$(),this.viewingMode=e??it.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(Sgt(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&c9(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===it.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,we(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??r3;const o=uK(this.verticalOffset);if(b(e)&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();b(c)?(b(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.transformation,s=uK(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.shaderTransformation),at(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),at(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;b(s)&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,g)=>{if(c>=0){if(b(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=f?this._results.hud:this._results,v=f?x=>{const S=new Ibt(e,a,d,g);x.set(Vs.HUD,S,c,h,xd,m)}:x=>x.set(Vs.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((y.min.drapedLayerOrder==null||m>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==Ga.MIN&&(y.max.drapedLayerOrder==null||m<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===Ga.ALL)if(f){const x=new hK(this._ray);v(x),this._results.hud.all.push(x)}else{const x=new lA(this._ray);v(x),this._results.all.push(x)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?vt(i.dist,0)-vt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?vt(i.drapedLayerOrder,Number.MAX_VALUE)-vt(r.drapedLayerOrder,Number.MAX_VALUE):vt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-vt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function Wp(t){return new kbt(t)}let Vbt=class{constructor(){this.min=new lA(ha()),this.max=new lA(ha()),this.hud={min:new hK(ha()),max:new hK(ha()),all:new Array},this.ground=new lA(ha()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},lA=class{get ray(){return this._ray}get distanceInRenderSpace(){return b(this.dist)?(pe(OF,this.ray.direction,this.dist),ze(OF)):null}getIntersectionPoint(e){return!!Vm(this)&&(pe(OF,this.ray.direction,this.dist),we(e,this.ray.origin,OF),!0)}getTransformedNormal(e){return ge(WO,this.normal),WO[3]=0,ld(WO,WO,this.transformation),ge(e,WO),Re(e,e)}constructor(e){this.intersector=Vs.OBJECT,this.normal=$(),this.transformation=Ge(),this._ray=ha(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Vs.OBJECT,c9(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ge(this.normal,vt(s,Fwe)),Bo(this.transformation,vt(n,xd)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){c9(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ge(this.normal,e.normal),Bo(this.transformation,e.transformation)}},hK=class extends lA{constructor(){super(...arguments),this.intersector=Vs.HUD}};function bse(t){return new lA(t)}const OF=$(),WO=Ai();function RPe(t,e,i,r){return b(t.renderCoordsHelper.fromRenderCoords(e.eye,T9,r))&&Wxe(i,T9)}function gz(t,e){return t.elevationProvider?vt(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function PS(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),zbt(t,s.ray,Fv)||ge(Fv,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Eo(s.eye,Fv)<o){const a=n.collision.enabled;ge(jw,s.viewForward),pe(jw,jw,o),a?s.eye=be(T9,Fv,jw):we(Fv,s.eye,jw);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(be(jw,Fv,s.eye),s.eye=l.setAltitude(T9,h,s.eye),we(Fv,s.eye,jw))}return s.center=Fv,s}function Cfe(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=gz(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,Gbt),o=n*n;return Eo(e,i)>o}function zbt(t,e,i){let r=Mfe[t.viewingMode];r||(r=Wp(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Mfe[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Cfe(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Cfe(t,e.origin,i))||!!s&&Bbt(e,i,ur(t.spatialReference).radius)}function Bbt(t,e,i){const r=xe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return pe(e,t.direction,s/ze(t.direction)),we(e,e,t.origin),!0}const Mfe={},T9=$(),Fv=$(),jw=$(),Gbt={near:0,far:0};function J3(t,e,i=Ap.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=gz(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=ze(e.eye);if(be(RF,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(jbt,o,e.eye),i===Ap.EYE_AND_CENTER)e.center=we(RF,e.eye,RF);else if(i===Ap.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=pe(RF,e.center,l)}return!0}var Ap;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Ap||(Ap={}));const RF=$(),jbt=$();function cw(t,e,i){t.worldUpAtPosition(e,Afe),be(ZG,i,e);const r=ze(ZG);return r===0?0:Co(xe(ZG,Afe)/r)}const Afe=$(),ZG=$();function PPe(t,e,i=lw,r=!0){YO.eyeCenterDistance=0,YO.requiresTwoSteps=!1;const s=wse(t,e,i,void 0,YO);if(s===0)return!1;switch(vd(PF,-s,e.viewRight),i.tiltMode){case va.LOOK_AROUND:at(Uv,e.viewForward,PF),pe(Uv,Uv,YO.eyeCenterDistance),e.center=we(sb,e.eye,Uv);break;case va.TUMBLE:be(Uv,e.center,e.eye),at(Uv,Uv,PF),e.eye=be(sb,e.center,Uv);break;default:i.tiltMode}return e.up=at(sb,e.up,PF),!YO.requiresTwoSteps||!r||PPe(t,e,i,!1)}function wse(t,e,i=lw,r=lw,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,ewt);return Qbt(t,i,o),r.interactionType===Oi.TUMBLE&&eL(r.selection,vs.ALTITUDE)&&IPe(t,r.interactionStartCamera,o),i.tiltMode===va.LOOK_AROUND||r.tiltMode===va.LOOK_AROUND?qbt(t,e,o,s):Hbt(t,e,o)}function Hbt(t,e,i){const r=cw(t.renderCoordsHelper,e.center,e.eye),s=r-Se(r,i.min,i.max);return tL(s)?s:0}function qbt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return Ybt(t,e,i,r);case"local":return Wbt(t,e,i,r)}}function Wbt(t,e,i,r){const s=cw(t.renderCoordsHelper,e.center,e.eye),n=Se(s,i.min,i.max),o=s-n;if(!tL(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function Ybt(t,e,i,r){const s=Xbt(t,e,twt),n=Se(s.tiltAtCenter,i.min,i.max);if(!tL(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=Zbt(s),a=Jbt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Kbt(s,o)),r&&(r.eyeCenterDistance=dK(s,o)),a}function Xbt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+ur(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,sb);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,b(n)?(i.eyeCenterDistance=Wr(e.eye,n),i.tiltAtCenter=cw(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=cw(t.renderCoordsHelper,e.center,e.eye):(W3(qV(WV,s),e.ray,sb),i.eyeCenterDistance=Wr(e.eye,sb),i.tiltAtCenter=Co(-xe(e.viewForward,Re(sb,sb)))),i.radius=s,i.eyeRadius=ze(e.eye),i.constraints=t.state.constraints,i}function tL(t){return Math.abs(t)>1e-9}function Zbt(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=dK(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&tL(n-s);){const l=(s+n)/2,c=dK(t,l);tL(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function dK(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Se(e,0,Math.PI),r=Fp(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function Jbt(t,e){const i=Fp(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Fp(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function Kbt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Qbt(t,e,i){if(e.interactionType===Oi.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=wse(t,r,lw,e),l=a===0?0:cw(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===Oi.TUMBLE?(eL(e.selection,vs.ALTITUDE)&&IPe(t,r,i),x9(a,l,!0,s,Ofe,i)):x9(a,l,!1,s,Ofe,i)}function IPe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Ll(e.center),n=Math.sqrt(s),o=e.distance,a=ur(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Co(d),i.max)),i.max=Math.min(i.max,Math.PI-Co(h))}const Uv=$(),PF=Ge(),sb=$(),Ofe=ci(5),ewt={min:0,max:0},twt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},YO={eyeCenterDistance:0,requiresTwoSteps:!1};function iwt(t){return t}const yz=t=>t*t,xse=t=>1-yz(1-t),rwt=t=>t<.5?yz(2*t)/2:(xse(2*(t-.5))+1)/2,Tse=t=>t*t*t,$Pe=t=>1-Tse(1-t),LPe=t=>t<.5?Tse(2*t)/2:($Pe(2*(t-.5))+1)/2,Sse=t=>t*t*t*t,DPe=t=>1-Sse(1-t),swt=t=>t<.5?Sse(2*t)/2:(DPe(2*(t-.5))+1)/2,Ese=t=>t*t*t*t*t,NPe=t=>1-Ese(1-t),nwt=t=>t<.5?Ese(2*t)/2:(NPe(2*(t-.5))+1)/2,Cse=t=>1-Math.cos(t*Math.PI/2),FPe=t=>1-Cse(1-t),owt=t=>t<.5?Cse(2*t)/2:(FPe(2*(t-.5))+1)/2,Mse=t=>2**(10*(t-1)),OD=t=>1-Mse(1-t),awt=t=>t<.5?Mse(2*t)/2:(OD(2*(t-.5))+1)/2,Ase=t=>-(Math.sqrt(1-t*t)-1),UPe=t=>1-Ase(1-t),lwt=t=>t<.5?Ase(2*t)/2:(UPe(2*(t-.5))+1)/2;function ef(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function tf(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const cwt=tf(ef(1),1),uwt=tf(ef(1),0),kPe=tf(ef(1),.5),hwt=tf(ef(2),1),dwt=tf(ef(2),0),pwt=tf(ef(2),.5),fwt=tf(ef(3),1),mwt=tf(ef(3),0),gwt=tf(ef(3),.5),ywt=tf(ef(4),1),_wt=tf(ef(4),0),vwt=tf(ef(4),.5),bwt={linear:iwt,"in-quad":yz,"out-quad":xse,"in-out-quad":rwt,"in-coast-quad":cwt,"out-coast-quad":uwt,"in-out-coast-quad":kPe,"in-cubic":Tse,"out-cubic":$Pe,"in-out-cubic":LPe,"in-coast-cubic":hwt,"out-coast-cubic":dwt,"in-out-coast-cubic":pwt,"in-quart":Sse,"out-quart":DPe,"in-out-quart":swt,"in-coast-quart":fwt,"out-coast-quart":mwt,"in-out-coast-quart":gwt,"in-quint":Ese,"out-quint":NPe,"in-out-quint":nwt,"in-coast-quint":ywt,"out-coast-quint":_wt,"in-out-coast-quint":vwt,"in-sine":Cse,"out-sine":FPe,"in-out-sine":owt,"in-expo":Mse,"out-expo":OD,"in-out-expo":awt,"in-circ":Ase,"out-circ":UPe,"in-out-circ":lwt};function Dn(t,e,i=Swt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<Ewt;a++){let l=0;for(const c of Twt)if(eL(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=eL(i.selection,vs.COLLISION),o=wwt(i.interactionType,t);return n&&J3(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function wwt(t,e){switch(t){case Oi.PAN:return Ap.EYE_AND_CENTER;case Oi.ASCEND:return e.state.isGlobal?Ap.EYE_AND_CENTER_SCALE:Ap.EYE_AND_CENTER;default:return Ap.EYE}}function Kf(t){const e=Math.min(1,t/150);return LPe(e)}function xwt(t,e,i){return wse(t,e,i)*e.distance}const Twt=[{type:vs.TILT,error:xwt,apply:PPe},{type:vs.ALTITUDE,error:yse,apply:fbt},{type:vs.DISTANCE,error:_se,apply:Tbt}],Swt={selection:vs.ALL,interactionType:Oi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:va.TUMBLE},Ewt=5,Th=$(),vu=$(),kv=$(),wl=$(),Hw=$(),Cwt=$(),Sh={upward:Ve(0,0,1),forward:Ve(0,1,0),sideway:Ve(1,0,0)},Rfe=Hs();let Pfe=class{constructor(e=it.Global){this.viewingMode=e,this.center=$(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=zr(Sh.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===it.Global){const n=(ze(this.center)+ze(e.center))/2;i.pan=j6(this.center,e.center)*n}else i.pan=Wr(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===it.Global?Vgt(e.center,i.center,r.pan,this.center):En(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?ei(e.distance,i.distance,r.zoom):e.distance,this.pitch=ei(e.pitch,i.pitch,r.rotate);let s=e.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=ei(s,n,r.rotate)}copyFrom(e){ge(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ge(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,Rfe);ge(this.center,e.center),be(wl,e.center,e.eye),th(wl,wl,i),th(Hw,e.up,i),this.distance=ze(wl),this.distance!==0&&(wl[0]/=this.distance,wl[1]/=this.distance,wl[2]/=this.distance),this.pitch=this._eyeUpToPitch(wl),this.yaw=this._eyeUpToYaw(wl,Hw),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,Rfe);Hp(i,i),this._axisAngleVec3(Sh.sideway,this.pitch-Math.PI/2,Sh.forward,wl),this._axisAngleVec3(Sh.upward,this.yaw,wl),this._axisAngleVec3(Sh.sideway,this.pitch-Math.PI/2,Sh.upward,Hw),this._axisAngleVec3(Sh.upward,this.yaw,Hw),pe(wl,wl,this.distance),th(wl,wl,i),th(Hw,Hw,i),e.center=this.center,e.eye=be(wl,this.center,wl),e.up=Hw}_axisAngleVec3(e,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return pe(Th,r,n),Et(vu,e,r),pe(vu,vu,o),pe(kv,e,(1-n)*xe(e,r)),we(s,we(s,Th,vu),kv)}_lookAtOrientation(e,i=Hs()){return this._upAtLookAt(e,kv),Et(Th,this.lookAtDirection,kv),Re(Th,Th),Th[0]===0&&Th[1]===0&&Th[2]===0&&ge(Th,Sh.sideway),Et(vu,kv,Th),Re(vu,vu),i[0]=Th[0],i[1]=vu[0],i[2]=kv[0],i[3]=Th[1],i[4]=vu[1],i[5]=kv[1],i[6]=Th[2],i[7]=vu[2],i[8]=kv[2],i}_upAtLookAt(e,i){return this.viewingMode===it.Local?ge(i,Sh.upward):Re(i,e)}_eyeUpToPitch(e){return Math.PI-j6(Sh.upward,e)}_eyeUpToYaw(e,i){const r=Cwt;return Math.abs(i[2])<.5?(ge(r,i),e[2]>0&&pe(r,r,-1)):ge(r,e),Et(vu,r,Sh.upward),Re(vu,vu),j6(Sh.sideway,vu,Sh.upward)}};const S9={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Mwt=class VPe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:S9.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new VPe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:S9.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Awt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,n.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-h)/(d-h)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},JG=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}};function Owt(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Rwt(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function Pwt(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Iwt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function $wt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Lwt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Dwt(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Nwt(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Fwt(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Uwt(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function kwt(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function Vwt(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function zwt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Bwt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Gwt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function jwt(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-r):s*(e+r)}function Hwt(t,e){let i=qwt(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?Iwt:Owt,a=s?$wt:Rwt,l=s?Lwt:Pwt,c=n?zwt:Uwt,h=n?Bwt:kwt,d=n?Gwt:Vwt,f=C=>o(t,C,r)+Dwt(t,C,r)+c(t,C,r),m=C=>a(t,C,r)+Nwt(t,C,r)+h(t,C,r),g=C=>l(t,C,r)+Fwt(t,C,r)+d(t,C,r);let y=f(i);const v=jwt(t);let x;const S=e.maximumIterations||20,E=e.maximumDistance!=null?e.maximumDistance:1/0;for(x=0;x<S;x++){const R=(m(i)+1e-6)/g(i);if(isNaN(R)||i>=E&&R<0){if(!isFinite(E))return null;i=E,y=f(i);break}if(i-=R,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-y)/y<=.005)break;y=O}return y>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function qwt(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Wwt=class extends Awt{constructor(e,i){super(),this._preallocSegments=[new JG,new JG,new JG],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i&&i.apex&&(r=Hwt(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i==null?void 0:i.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=xse(r.zoom):e===this._descensionSegment&&(r.zoom=yz(r.zoom)),r}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Ywt={zoom:0,pan:0,rotate:0};let Xwt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Mwt(e),this.path=new Wwt}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(tbe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing?r.easing:this._time>=1e3?kPe:OD}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,Ywt);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const s=i.minDuration!=null?i.minDuration:S9.minDuration/r,n=i.maxDuration!=null?i.maxDuration:S9.maxDuration/r;return Math.min(Math.max(s,e),n)}};const Zwt=$();let Jwt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Xwt(()=>new Pfe(e)),this._current=new Pfe(e)}update(e,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=be(Zwt,i.center,e.center),a=ze(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ge(s.lookAtDirection,o),ge(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new jt,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+tbe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var Qs;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Qs||(Qs={}));let r_=class extends Ee{constructor(e){super(e),this.state=Qs.Ready}get active(){return this.state===Qs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Qs.Stopped,!0)}finishController(){this.state=Qs.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],r_.prototype,"view",void 0),u([p({readOnly:!0})],r_.prototype,"active",null),u([p()],r_.prototype,"state",void 0),u([p({readOnly:!0})],r_.prototype,"isInteractive",null),r_=u([N("esri.views.3d.state.controllers.CameraController")],r_);let iL=class extends r_{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(er()),this._asyncResult=null),this.state===Qs.Finished||this.state===Qs.Stopped?(DL(e),this.state===Qs.Finished?e.resolve():e.reject(er())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Qs.Running,b(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!b(this.viewAnimation)||this.state!==Qs.Ready&&this.state!==Qs.Running||(this.viewAnimation.state===j_.State.FINISHED?this.finish():this.viewAnimation.state===j_.State.STOPPED&&(this.state=Qs.Stopped))}onControllerEnd(){b(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Qs.Finished?this.viewAnimation.finish():this.state===Qs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Qs.Finished?this._asyncResult.resolve():this._asyncResult.reject(er()))}finish(){this.finishController()}};iL=u([N("esri.views.3d.state.controllers.AnimationController")],iL);let g_=class extends iL{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Jwt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new j_}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);IF.copyFrom(this.view.state.camera);const s=Wp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(IF.ray,s,Ife)&&(IF.center=Ife),this.animation.update(IF,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?bwt[e.easing]:e.easing}}};u([p({constructOnly:!0})],g_.prototype,"mode",void 0),u([p({readOnly:!0})],g_.prototype,"isInteractive",null),g_=u([N("esri.views.3d.state.controllers.PointToPointAnimationController")],g_);const IF=new jt,Ife=$();function _z(t=Qwt){return[t[0],t[1],t[2],t[3]]}function rL(t,e){return Kwt(t[0],t[1],t[2],e,Sre.get())}function Kwt(t,e,i,r,s=_z()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Ose(t,e,i){return Et(i,t,e),Re(i,i),i[3]=Mre(t,e),i}const Qwt=[0,0,1,0];function zPe(t,e,i){return ext(t,t.screenToRender(e,tt.get()),i)}function ext(t,e,i){const r=Ao(tt.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Ao(tt.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,tt.get());return A(n)?null:(be(i.direction,n,i.origin),i)}function K3(t,e,i){return Rse(t,t.screenToRender(e,tt.get()),i)}function Rse(t,e,i){ge(i.origin,t.eye);const r=fe(tt.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,tt.get());return A(s)?null:(be(i.direction,s,i.origin),i)}function Pse(t,e,i,r){const s=K3(e,i,txt);return xw(t,s,r)}const txt=ha();var s3;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(s3||(s3={}));const BPe=30,E9=[1,3e8],vz=80,GPe=8,jPe=200,HPe=1508e5,qPe=5,WPe=50,ixt=5,rxt=10,KG=90,IS={exclude:new Set([rb])};function w2(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function pK(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function uw(t,e,i){const r=vd(Ere.get(),i[3],i);A(r)||zTe(r,xd)||(be(Dr,t.eye,e),at(Dr,Dr,r),t.eye=we(Dr,Dr,e),be(Dr,t.center,e),at(Dr,Dr,r),t.center=we(Dr,Dr,e),t.up=at(Dr,t.up,r))}function sxt(t,e,i,r){return OS(t,zPe(e,i,Lse),r)}function fK(t,e,i,r){return OS(t,K3(e,i,Lse),r)}function Ise(t,e,i,r){const s=tt.get();let n=1-i;be(s,e,t.eye);const o=ze(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(pe(s,s,n),t.eye=we(Dr,t.eye,s),t.center=En(Dr,t.center,e,n))}function YPe(t,e,i){e.getScreenCenter($fe),Pse(t,e,$fe,Dr)&&(e.center=Dr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=pe(tt.get(),e.viewForward,s);e.eye=be(Dr,e.center,n)}const $fe=zs();function QG(t,e){fe(e,0,0,0);for(const i of t)we(e,e,i);pe(e,e,1/t.length)}function r8(t,e,i,r){return Math.sin(t/ze(e))*(i+r.radius)}function Lfe(t,e,i,r){return r8(Math.PI/2,e,i,r)+(t-Math.PI/2)}var da;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(da||(da={}));const Dfe={Elevation:3e4,Angle:ci(16)},$F={Pole:.95,Angle:ci(18),Tilt:45},XPe=ci(80);function ZPe(t,e,i,r,s,n){const o=$(),a=to();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=ze(o):(c=!1,e.aboveGround&&s!==s3.Ellipsoid?a[3]=Math.max(ze(e.center),.9*r.radius):a[3]=ze(e.eye)-e.relativeElevation,s===s3.Silhouette?sL(a,e,i,o):l=Pse(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function bz(t,e,i){return ze(t.eye)-i.radius>Dfe.Elevation?da.Horizontal:(K3(t,e,Gfe),-Math.sign(t.relativeElevation)*(.5*Math.PI+Mre(t.eye,Gfe.direction))<Dfe.Angle?da.Vertical:da.Horizontal)}function JPe(t,e,i){be(ej,i,e),t.eye=be(Dr,t.eye,ej),t.center=be(Dr,t.center,ej)}const ej=$();function sL(t,e,i,r){const s=K3(e,i,Lse);return!A(s)&&(W3(t,s,LF),xw(t,s,r)?!(Eo(LF,s.origin)<Eo(r,s.origin))||(ge(r,LF),!1):(be(pE,e.eye,e.center),Re(pE,pE),gOe(pE,-xe(Re(pE,pE),LF),Nfe),OS(Nfe,s,r),!1))}const LF=$(),pE=$(),Nfe=gr();function KPe(t,e,i,r,s,n){let o=0;if(Et(A9,t,e),be(UF,t,e),ze(t)<=s||!r.aboveGround){Et(i,UF,r.eye);const a=xe(t,e)/(ze(t)*ze(e));if(a<.9999)o=Co(a);else{const c=ze(Et($(),t,e))/(ze(t)*ze(e));o=Fp(c)}const l=Math.cos(Se(qb.normalize(ci(n)),0,XPe));o=-o-Math.max(0,ze(e)-s)/(l*s)}else be(Ffe,r.eye,r.center),Et(i,UF,Ffe),o=-ze(UF)/s;return Re(i,i),pe(i,i,ze(A9)),o}const Ffe=$();function Ufe(t,e,i,r){let s,n;const o=Math.cos(Se(qb.normalize(ci(r)),0,XPe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Co(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Co(t/i),(n-s)*i}function nxt(t,e,i,r,s,n,o,a,l,c){const h=Ufe(t[2],e[2],n[3],a),d=l?Ufe(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;Re(Dr,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-xe(i,Dr)**2)):f/n[3],y=m/Math.sqrt(Math.abs(n[3]**2-xe(i,r)**2));Vt(c,g,y)}function QPe(t,e,i,r,s,n,o,a,l,c){Et(A9,t,e),XZ(n.up,n.eye,DF,NF,FF),XZ([0,0,1],n.eye,C_,Lb,rIe),ge(i,Lb),ge(r,C_),Re(i,i),pe(i,i,ze(A9)),ape(t,Re(NF,NF),Re(FF,FF),Re(DF,DF),kfe),ape(e,NF,FF,DF,Vfe),nxt(kfe,Vfe,t,C_,Lb,o,a,l,c,s)}function oxt(t,e,i,r,s,n,o){vd(C9,s,r),vd(M9,o,n),ln(CM,C9,M9),be(e,t,i),at(e,e,CM),we(e,e,i)}function eIe(t,e,i,r,s,n){vd(C9,r,i),vd(M9,n,s),ln(CM,C9,M9),be(Dr,t.eye,e),at(Dr,Dr,CM),t.eye=we(Dr,Dr,e),be(Dr,t.center,e),at(Dr,Dr,CM),t.center=we(Dr,Dr,e),be(Dr,t.up,e),at(Dr,Dr,CM),t.up=we(Dr,Dr,e)}function $se(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-$F.Angle||Math.abs(r)<$F.Angle)&&(Math.abs(t[2])<i*$F.Pole||Math.abs(e)>i)&&n.aboveGround&&s<$F.Tilt}function tIe(t,e,i,r,s,n){if(n)Ose(i,r,zfe),uw(e,t,zfe);else{const o=KPe(i,r,Bfe,e,t[3],s);uw(e,t,rL(Bfe,o))}}function iIe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ge(qw,r),kF.copyFrom(e);for(let d=0;d<a&&Eo(i,qw)>l&&(c=Eo(i,qw),QPe(i,qw,Lb,C_,XO,kF,t,s,n,o),eIe(kF,t,C_,XO[1],Lb,XO[0]),oxt(qw,qw,t,C_,XO[1],Lb,XO[0]),h=Eo(i,qw),h<c||d===0);d++)e.copyFrom(kF)}function axt(t,e,i,r,s,n,o){$se(i,xe(e.up,i),t[3],-qb.normalize(ci(s)),n,e)?iIe(t,e,i,r,-qb.normalize(ci(s)),n,o):tIe(t,e,i,r,n,o)}function lxt(t,e,i,r,s,n){const{eye:o}=t;XZ([0,0,1],o,C_,Lb,rIe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-xe(t.center,C_)**2/ze(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(ih(r.pan.matrix,r.pan.matrix,h,C_),r.pan.enabled=!0,s.mode){case"pan":ih(r.pan.matrix,r.pan.matrix,d,Lb),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function cxt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=Et(tt.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(ih(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(ih(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function uxt(t,e,i,r,s,n,o,a,l){$se(t.center,xe(t.up,t.center),ze(t.center),-qb.normalize(ci(n)),o,e)?lxt(e,i,r,a,l,-qb.normalize(ci(s))):cxt(e,i,r,a,l)}const C_=$(),Lb=$(),rIe=$(),DF=$(),NF=$(),FF=$(),kfe=$(),Vfe=$(),XO=je(),zfe=_z(),C9=Ge(),M9=Ge(),CM=Ge(),qw=$(),Dr=$(),UF=$(),kF=new jt,A9=$(),Bfe=$(),Lse={origin:$(),direction:$()},Gfe={origin:$(),direction:$()},jfe=.6,tj=4,hxt=60;let O9=class extends g_{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new jt,this._tmpViewDir=$(),this._tmpRayDir={origin:$(),direction:$()},this._targetOnSphere=$(),this._tmpCenter=$(),this._constraintOptions={selection:vs.ALL_EXCEPT_COLLISION,interactionType:Oi.ZOOM,interactionFactor:null,interactionStartCamera:new jt,interactionDirection:null,tiltMode:va.TUMBLE},this._sphere=to()}initialize(){this._intersector=Wp(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?IS:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ge(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:OD}}_updateCamera(e,i,r,s,n){const o=ur(this.view.spatialReference),a=bz(e,s,o),l=Math.abs(this.view.camera.position.z);Re(zF,e.eye),pe(zF,zF,-1),K3(e,s,this._tmpRayDir),Re(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=Se(Math.min(GPe,1/Math.abs(xe(zF,this._tmpRayDir.direction)))*l,jPe,HPe);if(a===da.Horizontal){let h=jfe**i;this._sphere[3]=ze(r),be(this._tmpViewDir,e.center,e.eye);const d=Math.min(ze(this._tmpViewDir),c);let f=d*h;if(h<=1&&f<tj&&(f=tj,h=f/d),Math.abs(d-f)<1e-6)return;const m=ze(e.center);if(this._sphere[3]!==m){const g=this._sphere[3]+h*(m-this._sphere[3]);e.center=pe(VF,e.center,g/m)}pe(this._tmpViewDir,this._tmpViewDir,-h),e.eye=we(VF,e.center,this._tmpViewDir),Dn(this.view,e,this._constraintOptions),Eo(r,e.center)>1e-12&&Pse(this._sphere,e,s,this._targetOnSphere)&&axt(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=jfe**Math.abs(i);const d=i>0?1:-1;be(this._tmpViewDir,r,e.eye);const f=ze(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,hxt);let g=b(m)?m:c;g=n&&i>0?Math.min(g,f):g,pe(this._tmpRayDir.direction,this._tmpRayDir.direction,g),we(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=g*h;const v=Math.max(tj,1.01*e.nearFar[0]);if(i>0&&y<v&&(y=v,h=y/g),Math.abs(g-y)<1e-6)return;pe(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-h)),e.eye=we(VF,e.eye,this._tmpRayDir.direction),e.center=we(VF,e.center,this._tmpRayDir.direction)}J3(this.view,e)}};O9=u([N("esri.views.3d.state.controllers.global.ZoomStepController")],O9);const VF=$(),zF=$(),dxt=.6,pxt=4,fxt=60;let R9=class extends g_{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new jt,this._tmpRayDir=$(),this._tmpCenter=$(),this._constraintOptions={selection:vs.ALL,interactionType:Oi.ZOOM,interactionFactor:null,interactionStartCamera:new jt,interactionDirection:null,tiltMode:va.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(r.camera);const n=Wp(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?IS:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ge(this._zoomLocation,this._tmpCamera.center);const a=dxt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i[0],i[1],this.view.state.camera,fxt);be(BF,this._tmpCamera.eye,this._zoomLocation),Re(BF,BF);const c=Se(Math.min(GPe,1/Math.abs(xe(mxt,BF)))*Math.abs(this.view.camera.position.z),jPe,HPe);if(l=b(l)?l:c,l){const h=$();be(h,this._zoomLocation,this._tmpCamera.eye),(l<ze(h)||!o)&&(Re(h,h),we(this._zoomLocation,this._tmpCamera.eye,pe(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:OD}}_updateCamera(e,i,r){be(this._tmpRayDir,r,e.eye);const s=ze(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(pxt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(pe(this._tmpRayDir,this._tmpRayDir,i),e.eye=be(Hfe,r,this._tmpRayDir),e.center=En(Hfe,e.center,r,1-i),Dn(this.view,e,this._constraintOptions)))}};R9=u([N("esri.views.3d.state.controllers.local.ZoomStepController")],R9);const Hfe=$(),mxt=Ve(0,0,1),BF=$();let gxt=class extends Is{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(HV(i,"primary")){const r=this._view.state.isGlobal?new O9({view:this._view,mode:"animation"}):new R9({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),zs(i.x,i.y)),e.stopPropagation()}}};function yxt(t,e,i){return t===it.Global?new vxt(i):new _xt(e,i)}let _xt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=ur(i),this._unitInMeters=Ec(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var E;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(E=this._elevationProvider)==null?void 0:E.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=b(r)?r:new ti({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(h.x,h.y,h.z);be(Ww,i,e),fE[0]=Ww[0]>0?r.xmax:r.xmin,fE[1]=Ww[1]>0?r.ymax:r.ymin,fE[2]=Ww[2]>0?d/2:-d/2,be(fE,fE,e),Re(Ww,Ww);const f=1.1*xe(fE,Ww)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*xxt*this._unitInMeters,v=g*Txt*this._unitInMeters,x=Se((o-v)/(y-v),0,1)**3,S=Math.min(ei(m,f,x),m)*Math.max(Math.log(Math.abs(l)),1);return sIe(Math.min(S,Math.max(34064e4,d))/this._unitInMeters,bxt,this._unitInMeters,n)}},vxt=class{constructor(e){this._referenceEllipsoid=ur(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=ze(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return sIe(1.2*ei(d,f,kre(h)),Se(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function sIe(t,e,i,r){const s=wxt/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const bxt=2e4,wxt=2,xxt=.001,Txt=1e-4,fE=$(),Ww=$();let s8=class extends Ee{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;b(e.spatialReference)&&RPe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>J3(this.view,e,Ap.EYE_AND_CENTER))}};u([p({constructOnly:!0})],s8.prototype,"view",void 0),s8=u([N("esri.views.3d.state.ElevationCollisionConstraint")],s8);let XP=class extends Ee{constructor(e){super(e),this.nearFarHeuristic=yxt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ae(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ae(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ae(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Mi),ae(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Mi),ae(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),Mi),ae(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),Mi),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Mi),ae(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Mi)]),this.view.state.isLocal&&this.addHandles(ae(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),ii)),this._updateNearFar(),this.view.state.viewingMode!==it.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new s8({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,gz(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(vs.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==it.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(ci(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(Sc(r))}}_updateLocalSurfaceDistance(e){if(A(e))return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=vs.ALL){this.view.state.updateCamera(i=>Dn(this.view,i,{selection:e,interactionType:Oi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:va.TUMBLE}))}};u([p({constructOnly:!0})],XP.prototype,"view",void 0),u([p({readOnly:!0})],XP.prototype,"surfaceCollisionConstraint",void 0),XP=u([N("esri.views.3d.state.ConstraintsManager")],XP);let nb=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=J$(),this._points=MRe(),this.lines=new Array(12),this._origin=$(),this._direction=$(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:$(),endpoint:null}}update(e){ARe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ge(this._origin,e.eye),ge(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ge(this._points[i],e[i]);ORe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Tb(this.frustum,e)}intersectsRay(e){return y_t(this.frustum,e)}intersectsLineSegment(e,i){return __t(this.frustum,e,i)}intersectsPoint(e){return RRe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;ij(this.lines[i],e[i],e[r]),ij(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),ij(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function ij(t,e,i){t.origin=e,t.endpoint=i,Q_(t.direction,e,i)}nb.planePointIndices=v_t,nb.nearFarLineIndices=[[_t.NEAR_BOTTOM_LEFT,_t.FAR_BOTTOM_LEFT],[_t.NEAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_RIGHT],[_t.NEAR_TOP_RIGHT,_t.FAR_TOP_RIGHT],[_t.NEAR_TOP_LEFT,_t.FAR_TOP_LEFT]];let jI=class extends r_{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new ir}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Qs.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){b(e.spatialReference)&&!RPe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),J3(this.view,e,Ap.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Qs.Stopped)})}};u([p({constructOnly:!0})],jI.prototype,"desiredCamera",null),jI=u([N("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],jI);const Sxt=$(),GF=$();function Dse(){return{direction:$(),up:$()}}function nIe(t,e,i,r,s){let n=Re(Sxt,t),o=xe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(xe(e,r)),o<.99?(ge(n,e),a&&pe(n,n,-1)):n=null);let l=0;if(n){pe(GF,r,xe(r,n)),be(n,n,GF);const h=xe(n,s)/(ze(n)*ze(s));Et(GF,n,s),l=(xe(GF,r)>0?1:-1)*Sc(Co(h))}const c=Sc(Co(-xe(r,t)/ze(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const oIe=Ve(0,1,0),aIe=Ve(0,0,1),ZO=Ge(),s0=$(),n0=$();function lIe(t,e,i,r=Dse()){const{direction:s,up:n}=r;return LTe(ZO,-ci(e)),NA(ZO,ZO,ci(i)),at(s,aIe,ZO),pe(s,s,-1),at(n,oIe,ZO),r}function Ext(t,e,i,r){return nIe(e,i,r,aIe,oIe)}function Cxt(t,e,i,r){const s=lIe(t,i,r),n=$();return pe(n,s.direction,-e),we(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function Mxt(t){return Sc(t)}function Axt(t){return ci(t)}function cIe(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return ll(e,s0,n),ll(e,n0,n),s0[0]-=i/2,n0[0]+=i/2,s0[1]-=r/2,n0[1]+=r/2,_a(s0,n,s0,o),_a(n0,n,n0,o),s?(s.xmin=s0[0],s.ymin=s0[1],s.xmax=n0[0],s.ymax=n0[1],s.spatialReference=o):s=new ti(s0[0],s0[1],n0[0],n0[1],o),s}const Oxt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Ext,eyeForCenterWithHeadingTilt:Cxt,eyeTiltToLookAtTilt:Axt,headingTiltToDirectionUp:lIe,lookAtTiltToEyeTilt:Mxt,toExtent:cIe},Symbol.toStringTag,{value:"Module"})),uIe=Ve(0,0,1),hIe=Re($(),Ve(1,1,1)),Rxt=new Hb(-180,180),JO=Ge(),Z1=$(),mE=$();function dIe(t,e,i,r=Dse()){Et(Z1,t,uIe),xe(Z1,Z1)===0&&Et(Z1,t,hIe),vd(JO,-ci(e),t),ih(JO,JO,-ci(i),Z1);const{up:s,direction:n}=r;return Et(s,Z1,t),Re(s,s),at(s,s,JO),Re(n,t),Ul(n,n),at(n,n,JO),r}function Pxt(t,e,i,r){const s=Z1,n=mE;return Re(s,t),Et(mE,s,uIe),xe(mE,mE)===0&&Et(mE,s,hIe),Et(n,mE,s),nIe(e,i,r,s,n)}function Ixt(t,e,i,r){const s={eye:$(),up:null,tilt:r,heading:i},n=Z1;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=ci(i),l=ci(r),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=ze(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const Y=m/d,D=Fp(o/Y),V=Math.PI-l-D;g=Y*Math.sin(V)}const y=f*o,v=o*o*(d*d),x=h*h*v,S=g-y,E=S*S,C=x*(x+E-n[1]*n[1]);if(C<0)return pe(s.eye,n,g/m),s.tilt=0,jF(s,t);const R=Math.sqrt(C),O=n[1]*S,U=x+E;let L;if(L=h>0?-R+O:R+O,Math.abs(U)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):pe(s.eye,n,g/m),s.tilt=0,rj(s.eye),jF(s,t);s.eye[1]=L/U;const B=c*c*v,G=d*o,j=h*G*s.eye[1],q=s.eye[1]*s.eye[1],ie=1-q,ee=Math.sqrt(ie),K=x*q+B-2*j*ee*S+ie*E;return Math.abs(K)<1e-8?(pe(s.eye,n,g/m),s.tilt=0,rj(s.eye),jF(s,t)):(s.eye[0]=(ie*(g*n[0]-y*n[0])-G*ee*(n[0]*s.eye[1]*h+n[2]*c))/K,s.eye[2]=(ie*(g*n[2]-y*n[2])-G*ee*(n[2]*s.eye[1]*h-n[0]*c))/K,pe(s.eye,s.eye,g),rj(s.eye),jF(s,t))}function rj(t){const e=t[1];t[1]=-t[2],t[2]=e}function jF(t,e){const i=dIe(e,t.heading,t.tilt);return t.up=i.up,t}function $xt(t,e,i){const r=ze(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Fp(i/(s/Math.sin(t)));return Sc(t-n)}function Lxt(t,e,i){const r=ci(t),s=ze(e);return Fp(i/(s/Math.sin(r)))+r}function pIe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,h=ur(t.spatialReference).radius,d=e.longitude,f=j1t(c,i,h)/2;n=d-f,o=d+f;const m=ci(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(r/h/2),v=y*y;function x(E){const C=Math.PI/2;return(E=wJe.normalize(E,-C))>C&&(E=Math.PI-E),E}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+r/h,a=x(a),l=x(l),l<a){const E=l;l=a,a=E}if(a=Math.max(Sc(a),-90),l=Math.min(Sc(l),90),o=Rxt.monotonic(n,o),o-n>180){const E=(o-n-180)/2;n+=E,o-=E}const S=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ye.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new ti(n,a,o,l,S),t.spatialReference&&t.spatialReference.isWebMercator&&hy(s,!1,s),s}const Dxt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Pxt,eyeForCenterWithHeadingTilt:Ixt,eyeTiltToLookAtTilt:Lxt,headingTiltToDirectionUp:dIe,lookAtTiltToEyeTilt:$xt,toExtent:pIe},Symbol.toStringTag,{value:"Module"}));function P9(t){return t.type==="point"}let fIe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function mIe(t){return"array"in t}function iy(t,e,i="ground"){if(P9(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(mIe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,vt(e.spatialReference,t.spatialReference),i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function I9(t,e){return t!=null&&(e==null||(e===it.Local?!t.isGeographic||t.isWGS84||t.wkid===xp.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===xp.CGCS2000||t.wkid===xp.GCSMARS2000||t.wkid===xp.GCSMARS2000_SPHERE||t.wkid===xp.GCSMOON2000))}const gIe=le.getLogger("esri.views.3d.support.cameraUtils"),yIe=39.37,_Ie=96,mK=1,Nxt=8,Fxt=5,vIe=1,qfe=$(),Uxt={heading:0,tilt:0},ob=new st,kxt=new Hb(-20037508342788905e-9,20037508342788905e-9),Vxt=new Hb(-180,180);var rl;function RD(t){return t.spatialReference||Ye.WGS84}function Q3(t){return t.viewingMode==="global"?Dxt:Oxt}function zxt(t,e,i,r,s){return Q3(t).headingTiltToDirectionUp(e,i,r,s)}function Z0(t,e){if(A(e))return null;const i=t.renderSpatialReference,r=Q3(t).headingTiltToDirectionUp,s=$();if(!ll(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);pe(n.direction,n.direction,t.state.camera.distance),we(n.direction,n.direction,s);const o=PS(t,s,n.direction,n.up);return o.fov=ci(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(rl||(rl={}));const gE=$();function n3(t,e,i){const r=t.renderSpatialReference,s=wz(t,e.eye,e.viewForward,e.up,Uxt);let n=RD(t);return _a(e.eye,r,gE,n)||(n=Ye.WGS84,_a(e.eye,r,gE,n)),A(i)?new Vp(new st(gE,n),s.heading,s.tilt,Sc(e.fov)):(i.position.x=gE[0],i.position.y=gE[1],i.position.z=gE[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Sc(e.fov),i)}function Nse(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===it.Global&&i!=null&&(e*=Math.cos(ci(i))),e/=t.renderCoordsHelper.unitInMeters,s/(_Ie*yIe/e)/Math.tan(r.fovX/2)}function oS(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=_Ie*yIe/(n/s);return t.renderCoordsHelper.viewingMode===it.Global&&i!=null&&(o/=Math.cos(ci(i))),o*=t.renderCoordsHelper.unitInMeters,o}function bIe(t,e,i,r,s,n){return wIe(t,e,Nse(t,i,e.latitude),r,s,n)}function wIe(t,e,i,r,s,n){if(x2(n)){const a=new eO(n.signal);return nL(t,r.heading,r.tilt,e,i,s,a),void a.resolver.promise.then(l=>{const c=L9(t,l,r.fov);if(!A(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=nL(t,r.heading,r.tilt,e,i,s);return L9(t,o,r.fov,n)}function wz(t,e,i,r,s){return Q3(t).directionToHeadingTilt(e,i,r,s)}function Bxt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,ob,t.spatialReference)&&t.elevationProvider&&vt(iy(t.elevationProvider,ob),0)>(ob.z??0)-vIe)}async function Gxt(t,e,i){if(!t.renderCoordsHelper.fromRenderCoords(e,ob,t.spatialReference)||!t.elevationProvider)return!1;const r=ob.z??0,s=await t.elevationProvider.queryElevation(ob.x,ob.y,r,ob.spatialReference,"ground",i);return vt(s,0)>r-vIe}async function jxt(t,e,i){const r=$();if(e)if(e instanceof st){if(ll(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",i);return b(s)&&t.renderCoordsHelper.setAltitude(r,s),r}}else ge(r,e);else ge(r,t.state.camera.center);return r}function Hxt(t,e){const i=$();if(e&&e instanceof st){if(ll(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const r=iy(t.elevationProvider,e);b(r)&&t.renderCoordsHelper.setAltitude(i,r)}}else ge(i,e||t.state.camera.center);return i}function nL(t,e,i,r,s,n,o){const a=r&&r instanceof st?r:null;if(x2(o))return jxt(t,r,o.signal).then(c=>{gK(t,e,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Hxt(t,r);return gK(t,e,i,a,l,s,n,o)}function gK(t,e,i,r,s,n,o,a){if(A(r)){const d=t.renderSpatialReference;if(r=Jb(s,d,RD(t)),A(r))return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=Yxt(t,e,i,s,n,o),c=(0,Q3(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===rl.ADJUST&&t.viewingMode==="global"&&i>0){const d=()=>{const m=xIe(t,s,n,Zxt(t,n,i,s));return o=i-m<1?rl.LOCKED:rl.ADJUST,gK(t,e,m,r,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(Bxt(t,c.eye))return d();if(x2(a))return Gxt(t,c.eye,a.signal).then(m=>m?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:zr(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||x2(a)?{center:$(),eye:$(),up:$(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=zr(s),h.heading=c.heading,h.tilt=c.tilt,x2(a)&&a.resolver.resolve(h),h}function HI(t,e,i,r,s,n=null){let o,a,l;if(t.state.isGlobal){if(!I9(e.spatialReference,it.Global))return x2(n)&&n.resolver.reject(),null;const v=new st(e.xmin,e.ymin,e.spatialReference),x=new st(e.xmax,e.ymax,e.spatialReference),S=e.spatialReference.isGeographic?Vxt:kxt;o=new st({x:S.center(v.x,x.x),y:(x.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const E=ur(e.spatialReference),C=G1t(o,v,x);a=C.lon,l=C.lat,S.diff(v.x,x.x)>S.range/2&&(a+=E.halfCircumference),a=Math.min(a,E.halfCircumference),l=Math.min(l,E.halfCircumference)}else{const v=vt(t.renderSpatialReference,e.spatialReference);v.equals(e.spatialReference)||(e=bd(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const x=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new st({x:e.xmin+.5*a,y:e.ymin+.5*l,z:x,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,d=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),g=Math.max(.5*a*d,.5*l*f,.5*c*m)/mK;if(x2(n)){const v=new eO(n.signal);return nL(t,i,r,o,g,s,v),void v.resolver.promise.then(x=>{const S=L9(t,x,t.camera.fov);if(!A(S))return n.resolver.resolve(S);n.resolver.reject()},x=>n.resolver.reject(x))}const y=nL(t,i,r,o,g,s);return L9(t,y,t.camera.fov,n)}function qxt(t,e,i){const r=t.renderSpatialReference,s=Jb(i,r,RD(t));if(A(s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=WL(e.eye,i),l=2*a*n*mK,c=2*a*o*mK;return t.viewingMode==="global"?pIe(t,s,l,c):cIe(t,s,l,c)}function Wxt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>Nxt)return!0;const s=t.renderSpatialReference,n=RD(t),o=Jb(e,s,n),a=Jb(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(A(o)||A(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>Fxt}function Yxt(t,e,i,r,s,n){let o=0;return n===rl.ADJUST&&Wxt(t,r,s)?(e=0,o=Xxt(t,s,i,r)):o=Fse(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=xIe(t,r,s,o)}}const $9=.7;function Xxt(t,e,i,r){const s=Fse(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-$9)+n.max*$9;return Math.min(s,o)}function Zxt(t,e,i,r){let s=Fse(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-$9)+s*$9}function xIe(t,e,i,r){return Q3(t).lookAtTiltToEyeTilt(r,e,i)}function Fse(t,e,i,r){return Q3(t).eyeTiltToLookAtTilt(r,e,i)}function L9(t,e,i,r){if(A(e))return null;const s=t.renderSpatialReference,n=Jb(e.eye,s,RD(t));return A(n)?null:b(r)?(r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):new Vp(n,e.heading,e.tilt,i)}function Jxt(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);gIe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function TIe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);gIe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function SIe(t,e){return _a(e.center,t.renderSpatialReference,qfe,Ye.WGS84),oS(t,e.distance,qfe[1])}let eO=class{constructor(e){this.signal=e,this.resolver=zb()}};function x2(t){return t&&"resolver"in t}const Kxt=.66;function EIe(t){return 360-oV.normalize(t)}function xz(t){return oV.normalize(360-t)}function KO(t){return b(t)&&t.resolver&&t.resolver.reject(),null}function Qxt(t,e){return b(t)&&t.resolver&&t.resolver.resolve(e),e}function CIe(t,e,i,r=null){if(!e)return KO(r);const s=t.spatialReference||Ye.WGS84;if(b(e.camera)){const c=_S(e.camera.position,s);if(A(c))return KO(r);const h=e.camera.clone();return h.position=c,Qxt(r,h)}if(A(e.targetGeometry))return KO(r);const n=e.get("targetGeometry.spatialReference");if(n&&!uy(n,s))return KO(r);const o=n3(t,t.state.camera);let a=rl.ADJUST;if(e.rotation!=null&&(o.heading=EIe(e.rotation),a=rl.LOCKED),i!=null&&(o.tilt=i),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const d=e.targetGeometry.clone();return h=e.scale!=null?Nse(t,e.scale,c.latitude):t.state.camera.distance,wIe(t,d,h,o,a,r)}const l=e.targetGeometry.extent;return l?HI(t,l,o.heading,o.tilt,a,r):KO(r)}function eTt(t,e,i=null){return A(i)&&(i=new ya),Vse(t,null,e.clone(),i)}async function tTt(t,e,i){const r=hTt(t,e);if(!r)throw new J("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Vp({fov:t.camera.fov}),n=new ya({camera:s});if(r.target instanceof ya)return Yw(await sTt(t,r.target,r,i,n));if(r.target instanceof Vp)return Yw(AIe(t,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ti){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Yw(o||c?await yK(t,r,r.target.center,s,i,n):await lTt(t,r,r.target,s,i,n))}const a={boundingBox:ls(),hasZ:!1,screenSpaceObjects:[]},l=o?iTt(t,r):void 0;if(await MIe(t,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(rm(a.boundingBox,Ln),Zh.x=Ln[0],Zh.y=Ln[1],Zh.z=Ln[2],Zh.spatialReference=t.spatialReference,isFinite(Zh.z)&&a.hasZ?c=Ste(a.boundingBox):(Zh.z=void 0,c=DZe(Tte(a.boundingBox,pTt))),o||c)return Yw(await yK(t,r,Zh,s,i,n));const h=dTt(t,a.screenSpaceObjects);return Yw(await uTt(t,r,Zh,a.boundingBox,h,s,i,n))}return r.position?Yw(oTt(t,r,s,n)):Yw(await aTt(t,r,s,i,n))}function Use(t,e){return e.scale==null&&e.zoom!=null?TIe(t,e.zoom):e.scale}function iTt(t,e){const i=Use(t,e);return i?Eyt(i):void 0}function kse(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=EIe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Vse(t,e,i,r){const s=t.spatialReference||Ye.WGS84;return e=b(e)?e:Z0(t,i),A(e)||(r.targetGeometry=Jb(e.center,t.renderSpatialReference,s),r.scale=SIe(t,e),r.rotation=xz(i.heading),r.camera=i),r}function D9(t,e,i){var a,l;const r=()=>new J("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw r();if(!uy(e.spatialReference,t.spatialReference))throw new J("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&b(t.basemapTerrain.spatialReference)&&uy(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Ln[2]=vt(iy(t.elevationProvider,c),0):Ln[2]=0}(0,fTt[e.type])(e,c=>{s.push(c[0],c[1],c[2])},Ln);const n=s.length/3;if(n===0)throw r();const o=new Array(s.length);if(un(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(i.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Ln[0]=o[c+0],Ln[1]=o[c+1],Ln[2]=o[c+2]):(Ln[0]=o[c+0],Ln[1]=o[c+1]),Ey(i.boundingBox,Ln)}}async function rTt(t,e,i,r){const s=await Sm(t.whenViewForGraphic(e));if(s.ok===!1||A(s.value)||!("whenGraphicBounds"in s.value))return void D9(t,e.geometry,r);const n=s.value,o=await Sm(n.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1)return void D9(t,e.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;DA(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function MIe(t,e,i,r){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return Zh.x=n,Zh.y=o,Zh.z=void 0,Zh.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:Ye.WGS84,void D9(t,Zh,r)}e&&typeof e.map=="function"?await hu(e.map(n=>MIe(t,n,i,r))):e instanceof K_?D9(t,e,r):e instanceof Ho&&await rTt(t,e,i,r)}async function sTt(t,e,i,r,s){if(b(e.camera))return AIe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=b(e.targetGeometry)?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=xz(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Use(t,i);n!=null&&(s.scale=n);const o=new eO(r);return CIe(t,s,i.tilt,o),s.camera=await o.resolver.promise,s}function AIe(t,e,i){const r=t.spatialReference,s=_S(e.position,r);return A(s)?null:((e=e.clone()).fov=t.camera.fov,e.position=s,Vse(t,null,e,i))}function nTt(t,e,i,r,s,n){const o=t.renderSpatialReference;return ll(i,qF,o),ll(e,sj,o),n.targetGeometry=new st(e),s.position=new st(i),be(N9,sj,qF),wz(t,qF,N9,r.up,s),n.scale=oS(t,Wr(qF,sj),n.targetGeometry.latitude),n.rotation=xz(s.heading),n.camera=s,n}async function yK(t,e,i,r,s,n){if(A(i))throw new J("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=PS(t);if(e.position)return nTt(t,n.targetGeometry,e.position,o,r,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=pe(Ln,o.viewForward,-l);o.eye=we(Ln,o.center,c),n.scale=oS(t,l,i.latitude)}n3(t,o,r);const a=kse(r,e)?rl.LOCKED:rl.ADJUST;if(!e.zoomFactor){const l=Use(t,e);l==null?(ll(i,Ln,t.renderSpatialReference),RRe(o.frustum,Ln)?n.scale=oS(t,Wr(o.eye,Ln),i.latitude):n.scale=SIe(t,o)):n.scale=l;const c=new eO(s);bIe(t,n.targetGeometry,n.scale,r,a,c),n.camera=await c.resolver.promise}return n}function oTt(t,e,i,r){const s=PS(t);return ge(N9,s.viewForward),wz(t,s.eye,N9,s.up,nj),i.position=new st(e.position),i.heading=e.heading!=null?e.heading:nj.heading,i.tilt=e.tilt!=null?e.tilt:nj.tilt,Vse(t,null,i,r)}async function aTt(t,e,i,r,s){const n=PS(t);return yK(t,e,Jb(n.center,t.renderSpatialReference,t.spatialReference),i,r,s)}async function lTt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=PS(t);n3(t,o,r);const a=kse(r,e)?rl.LOCKED:rl.ADJUST,l=new eO(s);return HI(t,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function cTt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=iy(t.elevationProvider,i)),fe(Ln,i.x,i.y,n),Rm(t.spatialReference,Ln,Wfe,t.renderSpatialReference),jp(HF,Wfe),Hp(HF,HF),ls(QO);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=r[y[2]];isFinite(v)||(v=n),fe(Ln,r[y[0]],r[y[1]],v),_a(Ln,t.spatialReference,Ln,t.renderSpatialReference),Ey(QO,th(Ln,Ln,HF))}const a=wS(QO),l=bw(QO),c=xS(QO),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function uTt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=PS(t),c=cTt(t,l,i,r,s);n3(t,l,n);const h=kse(n,e)?rl.LOCKED:rl.ADJUST;a.scale=oS(t,c,a.targetGeometry.latitude);const d=new eO(o);return bIe(t,a.targetGeometry,a.scale,n,h,d),a.camera=await d.resolver.promise,a}function hTt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};if("declaredClass"in e||Array.isArray(e))i.target=e;else{for(const r in e)i[r]=e[r];e.center&&!i.target&&(i.target=e.center)}return i}function Yw(t){return t&&b(t.camera)&&(t.rotation=xz(t.camera.heading)),t}function dTt(t,e){const i=Kxt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}const Ln=$(),Wfe=Ge(),HF=Hs(),QO=Mo(),pTt=bi(),N9=$(),qF=$(),sj=$(),nj={heading:0,tilt:0},Zh=new st,fTt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(fe(i,t.xmin,t.ymin,t.zmin)),e(fe(i,t.xmax,t.ymin,t.zmin)),e(fe(i,t.xmin,t.ymax,t.zmin)),e(fe(i,t.xmax,t.ymax,t.zmin)),e(fe(i,t.xmin,t.ymin,t.zmax)),e(fe(i,t.xmax,t.ymin,t.zmax)),e(fe(i,t.xmin,t.ymax,t.zmax)),e(fe(i,t.xmax,t.ymax,t.zmax))):(e(fe(i,t.xmin,t.ymin,i[2])),e(fe(i,t.xmax,t.ymin,i[2])),e(fe(i,t.xmin,t.ymax,i[2])),e(fe(i,t.xmax,t.ymax,i[2])))},mesh(t,e,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)e(fe(i,r[s+0],r[s+1],r[s+2]))}};let mTt=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;b(this.options.signal)&&ol(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,i){return this._promise.then(e,i)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&b(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(er())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Wb(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,tTt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(!A(i))if(this.options.animate){if(A(this._animationController))return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const i=!!(this.target instanceof ya&&this.target.camera||this.target instanceof Vp),r=e.camera;if(A(r))return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new J("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=Z0(this.view,r);return A(s)?(this.reject(new J("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(A(r))return void this.reject(new J("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||A(i.viewAnimation)||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new jI({view:this.view,desiredCamera:e.camera}),J3(this.view,e.camera,Ap.EYE_AND_CENTER)):Dn(this.view,e.camera),i.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof g_&&b(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):b(i.viewAnimation)&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!A(this.view.state))switch(i.state){case Qs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Qs.Ready:case Qs.Rejected:case Qs.Running:case Qs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof g_&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new g_({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(b(i)&&i.stop(),this.reject(new J("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},co=class extends Ee{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=n3(this.view,this.view.state.camera,oj);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableElevationCache(!0),this.setStateCamera(Z0(this.view,e),{applyConstraints:!1})||le.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=n3(this.view,this.view.state.contentCamera,oj);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Z0(this.view,e);A(i)?this.view.state.contentCamera=null:(this._updateElevation(i),this.view.state.contentCamera=i)}installContentCameraReset(e){if(this.removeHandles(aj),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=Qc(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ae(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(aj),this.test.contentCameraResetState.clear())}),ae(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ae(()=>this.view.state.camera,o=>{const a=Eo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],aj),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():le.getLogger(this.declaredClass).error("#center=","Invalid center",e):le.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):le.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=qxt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return b(i)?i:this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||le.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):le.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):le.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return oS(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||le.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[$i.TOP]/r),o=Math.round(i[$i.RIGHT]/r),a=Math.round(i[$i.BOTTOM]/r),l=Math.round(i[$i.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,WF),this.view.state.updateCamera(i=>i.padding=WF))}_paddingToArray(e,i,r){e?Rr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Rr(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return xo((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?eTt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||le.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const r=b(e.camera)?e.camera.position:e.targetGeometry,s=b(r)&&r.spatialReference;le.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else le.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Jxt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||le.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return b(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return b(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(In.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(In.PhysicalPixelRendering,Ki.IDLE)||e.isFeatureEnabled(In.PhysicalPixelRendering,Ki.INTERACTING)||e.isFeatureEnabled(In.PhysicalPixelRendering,Ki.ANIMATING))}constructor(e){super(e),this._propertiesPool=new G_({frustum:nb},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(i){this.viewStateManager._updatingIgnoreRenderState=i},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||b(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Gs(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),Mi)]),wa(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([F_({prepare:()=>this._prepareFrame()}),ae(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(YF)}),Gs(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=He(this._propertiesPool)}init(){this.constraintsManager=new XP({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===it.Local&&this.addHandles(wa(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(YF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),YF)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(YF),this.constraintsManager=He(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return b(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new mTt(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(PS(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){b(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of yTt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(A(e)||this._cameraSetByUser)return;if(e instanceof Vp)return void this.setStateCamera(Z0(this.view,e),{applyConstraints:!1});if(e instanceof ya){if(e.targetGeometry instanceof ti){const n=HI(this.view,e.targetGeometry,0,.5,rl.LOCKED);return void(b(n)&&this.setStateCamera(Z0(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=HI(this.view,e,0,.5,rl.LOCKED);b(i)&&this.setStateCamera(Z0(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&gTt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!A(e)&&(e instanceof ya?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Vp?this.isCompatible(e.position):e.spatialReference&&uy(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=_Tt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=Vv){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=nL(this.view,s,n,e,i,rl.ADJUST);return A(o)?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=HI(this.view,e,i,r,rl.ADJUST,oj);return s?Z0(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude;if(s==null)return null;const n=Nse(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(TIe(this.view,e))}_viewpointToCamera(e){return Z0(this.view,CIe(this.view,e))}setStateCamera(e,i){return!(A(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&Dn(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new jI({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._pixelRatio,s=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(s!==0&&n!==0&&(i.width===s&&i.height===n||(i.width=s,i.height=n),this.view.state)){const o=this.view.state.camera;o.fullWidth===s&&o.fullHeight===n&&o.pixelRatio===r||(Vv.copyFrom(o),Vv.pixelRatio!==r&&(this._paddingToArray(this.padding,r,WF),Vv.padding=WF),Vv.fullWidth=s,Vv.fullHeight=n,Vv.pixelRatio=r,this.view.state.camera=Vv),this._updateViewState()}}_updateElevation(e){var n;const i=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=i?gz(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){b(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ki.ANIMATING:this.view.interacting?this.view.state.mode=Ki.INTERACTING:(this.view.state.mode===Ki.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=vTt?this.view.state.mode=Ki.INTERACTING:this.view.state.mode=Ki.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:Vp,dependsOn:["view.state.camera","ready"]})],co.prototype,"camera",null),u([p({type:Vp,dependsOn:["view.state.contentCamera","ready"]})],co.prototype,"contentCamera",null),u([p({type:st})],co.prototype,"center",null),u([p({type:ti})],co.prototype,"extent",null),u([p({readOnly:!0})],co.prototype,"frustum",null),u([p({readOnly:!0})],co.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],co.prototype,"ready",void 0),u([p({type:Number})],co.prototype,"scale",null),u([p()],co.prototype,"padding",null),u([p({readOnly:!0})],co.prototype,"screenCenter",null),u([p({constructOnly:!0})],co.prototype,"view",void 0),u([p({type:ya})],co.prototype,"viewpoint",null),u([p({type:Number})],co.prototype,"zoom",null),u([p({readOnly:!0})],co.prototype,"_pixelRatio",null),u([p({readOnly:!0})],co.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],co.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],co.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],co.prototype,"_windowDevicePixelRatio",void 0),u([p()],co.prototype,"_devicePixelRatioOverride",void 0),co=u([N("esri.views.3d.state.ViewStateManager")],co);const gTt=["camera","viewpoint","extent","scale","center","zoom"],yTt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],_Tt={heading:0,tilt:0},oj=new Vp,Vv=new jt,WF=Ai(),YF="pending-initial-view",aj="content-camera-reset",vTt=300,Yfe=100;let ry=class extends r_{constructor(){super(...arguments),this.startCamera=new jt,this.currentCamera=new jt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Yfe}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Qs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Yfe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],ry.prototype,"isInteractive",null),u([p()],ry.prototype,"_lastInteraction",void 0),ry=u([N("esri.views.3d.state.controllers.InteractiveController")],ry);var ju;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(ju||(ju={}));let qI=class extends ry{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=ju.CENTER,this._rotScale=0,this._lastPoint=je(),this._tmpWorldUp=$(),this._tmpViewDir=$(),this._tmpRotCurPoint=je(),this._tmpTransf=Ge(),this._tmpAxis=$(),this._tmpPivotPoint=$(),this._pivotPos=$(),this._constraintOptions={selection:vs.ALL,interactionType:Oi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:va.TUMBLE}}initialize(){this._rotScale=this.pivot===ju.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case ju.EYE:ge(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Oi.LOOK_AROUND,this._constraintOptions.tiltMode=va.LOOK_AROUND,this._constraintOptions.selection=vs.NONE;break;case ju.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?IS:{});i||ge(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Oi.TUMBLE,this._constraintOptions.tiltMode=va.TUMBLE,this._constraintOptions.selection=vs.ALL&~vs.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,w2(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=$();be(s,this._pivotPos,r.eye);const n=ze(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Xfe);let a=Math.max(Math.min(ixt,1/Math.abs(xe(Xfe,r.viewForward)))*o,rxt);i&&(a=Math.min(n,a));const l=ur(this.view.spatialReference),c=zs(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),h=bz(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*KG,KG),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,KG);(b(d)||b(f))&&(d=vt(d,f),f=A(f)||h===da.Horizontal?d:f,a=d>f?f:d,a=i?Math.min(a,n):a),Re(s,s),ge(this._pivotPos,we(this._tmpPivotPoint,r.eye,pe(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case ju.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case ju.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Dn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),w2(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;be(this._tmpViewDir,r,s);const a=ze(this._tmpViewDir),l=Co(xe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===ju.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=Se(n+l,Ka.min,Ka.max)-l,Et(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===ju.CENTER&&(o=-o),vd(this._tmpTransf,o,this._tmpWorldUp),ih(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),at(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=at(lj,e.up,this._tmpTransf),we(lj,s,this._tmpViewDir),Ao(this._lastPoint,this._tmpRotCurPoint),lj}};u([p()],qI.prototype,"pivot",void 0),qI=u([N("esri.views.3d.state.controllers.RotateController")],qI);const lj=$(),Xfe=$();let cj=class extends Is{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!vre(e.data,this.pointerAction))return;const r=zs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new qI({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},_K=class extends ry{constructor(){super(...arguments),this._pickPoint=$(),this._tmpP0=je(),this._panAxisAngle=_z(),this._tmpRayDir=$(),this._tmpRayDirPick=$(),this._targetOnSphere=$(),this._navMode=da.Horizontal,this._tmpRay={origin:$(),direction:$()},this.dragBeginPoint=zs(),this._normalizedAnchorPoint=je(),this._constraintOptions={selection:vs.ALL_EXCEPT_COLLISION,interactionType:Oi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:va.TUMBLE},this._sphere=to(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ao(this.dragBeginPoint,e),w2(this.startCamera,e,this._normalizedAnchorPoint);const i=ur(this.view.spatialReference),r=ZPe(this._intersectionHelper,this.startCamera,e,i,s3.Ellipsoid,this.view.map.ground.opacity===0?IS:{});if(this._navMode=bz(this.startCamera,e,i),this._navMode===da.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=vt(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let s;K3(this.startCamera,e,this._tmpRay),Re(this._tmpRay.direction,this._tmpRay.direction),b(r.scenePickPoint)&&(be(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=ze(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Zfe);let o=Se(Math.min(BPe,1/Math.abs(xe(Zfe,this._tmpRay.direction)))*n,E9[0],E9[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,vz);o=b(a)?a:o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,pe(this._tmpRay.direction,this._tmpRay.direction,o),we(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===da.Horizontal){be(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=ze(this._tmpRayDir);w2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/ze(this.currentCamera.center));this.currentCamera.center=pe(XF,this.currentCamera.center,o)}pe(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=we(XF,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Kf(Gp(this.dragBeginPoint,e)),Dn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(sL(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Ose(this._pickPoint,this._targetOnSphere,this._panAxisAngle),uw(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=ze(this._tmpRay.direction);w2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;pe(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=we(XF,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=we(XF,this.currentCamera.center,this._tmpRayDir)}J3(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};_K=u([N("esri.views.3d.state.controllers.global.ZoomController")],_K);const XF=$(),Zfe=$();let vK=class extends ry{constructor(){super(...arguments),this._tmpP=$(),this._tmpDir=$(),this._tmpN=$(),this._tmpP0=je(),this._tmpPoi=$(),this._tmpRayDir=$(),this.dragBeginPoint=zs(),this._normalizedAnchorPoint=je(),this._constraintOptions={selection:vs.ALL,interactionType:Oi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:$(),tiltMode:va.TUMBLE},this._plane=gr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ao(this.dragBeginPoint,e),w2(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?IS:{});be(this._tmpDir,this._tmpP,this.startCamera.eye);const r=ze(this._tmpDir);Re(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=Se(Math.min(BPe,1/Math.abs(xe(bTt,this._tmpDir)))*s,E9[0],E9[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,vz);n=b(o)?o:n,n=i?Math.min(n,r):n,pe(this._tmpDir,this._tmpDir,n),we(this._tmpP,this.startCamera.eye,this._tmpDir),be(this._tmpN,this.startCamera.eye,this.startCamera.center),Re(this._tmpN,this._tmpN),this._tmpN[1]<0&&Ul(this._tmpN,this._tmpN),xD(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;sxt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ge(this._tmpPoi,this.currentCamera.center),w2(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Ao(this._normalizedAnchorPoint,this._tmpP0),be(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=ze(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ge(this._constraintOptions.interactionDirection,this._tmpRayDir),pe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(pe(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=we(Xw,this.currentCamera.eye,this._tmpRayDir),En(Xw,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Xw[2]=Math.max(this.startCamera.center[2],Xw[2]):Xw[2]=Math.min(this.startCamera.center[2],Xw[2]),this.currentCamera.center=Xw,this._constraintOptions.interactionFactor=Kf(Gp(this.dragBeginPoint,e)),Dn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};vK=u([N("esri.views.3d.state.controllers.local.ZoomController")],vK);const Xw=$(),bTt=Ve(0,0,1);let wTt=class extends Is{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!vre(e.data,this.pointerAction))return;const r=zs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new _K({view:this._view}):this._cameraController=new vK({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},l2=class extends ry{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new jt,this._headingStart=0,this._constraintOptions={selection:vs.ALL,interactionType:Oi.NONE,interactionStartCamera:new jt,interactionFactor:0,interactionDirection:null,tiltMode:va.LOOK_AROUND}}handleEventGamepad(e){const i=kZ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||N6(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Pde(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Pde(this._keysButtonState,this._transformation);N6(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Zw),this._applyDisabledMovementTypes(Zw),this._applyPan(Zw.pan),this._applyRotate(Zw.rotate),this._applyZoom(Zw.zoom),this._applyAscend(Zw.ascend),this._constraintOptions.interactionType=Oi.NONE,this._constraintOptions.selection=vs.COLLISION,Dn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;be(Oc,i.center,i.eye),at(Oc,Oc,e.matrix),i.center=we(Oc,Oc,i.eye),i.up=at(Oc,i.up,e.matrix),this._constraintOptions.interactionType=Oi.LOOK_AROUND,this._constraintOptions.selection=vs.ALL_EXCEPT_COLLISION,Dn(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=at(Oc,i.eye,e.matrix),i.center=at(Oc,i.center,e.matrix),this.view.state.isGlobal&&(i.up=at(Oc,i.up,e.matrix)),this._constraintOptions.interactionType=Oi.PAN,this._constraintOptions.selection=vs.ALL,Dn(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=we(Oc,this.currentCamera.eye,pe(tt.get(),i,e)),ge(eR,i),Ul(eR,eR),this._constraintOptions.interactionDirection=eR,this._constraintOptions.interactionType=Oi.ZOOM,this._constraintOptions.selection=vs.ALL_EXCEPT_COLLISION,Dn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,tt.get());if(this._constraintOptions.interactionDirection=ge(eR,i),this.view.state.isGlobal){const r=ze(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=pe(Oc,this.currentCamera.eye,s),this.currentCamera.center=pe(Oc,this.currentCamera.center,s)}else{const r=pe(tt.get(),i,e);this.currentCamera.eye=we(Oc,this.currentCamera.eye,r),this.currentCamera.center=we(Oc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Oi.ASCEND,this._constraintOptions.selection=vs.COLLISION,Dn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=vs.ALL_EXCEPT_COLLISION,Dn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){ATt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Oc)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=fe(tt.get(),n[0],n[1],0);Re(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=pe(tt.get(),s,c);fu(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=pe(tt.get(),l,y);fu(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(ih(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,tt.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=cw(this.view.renderCoordsHelper,i.center,i.eye),g=Se(m+f,Ka.min,Ka.max)-m;g&&(ih(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=Et(tt.get(),n,s);Re(l,l),Ul(l,l),uxt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Zw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(ih(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(ih(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=ur(this.view.spatialReference),n=r8(Ka.min,i.origin,r,s);let o=0,a=0;const l=tt.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=cw(this.view.renderCoordsHelper,l,i.origin);o=r8(c,i.origin,r,s),a=r8(Ka.max,i.origin,r,s)}else{W3(qV(WV,r+s.radius),i,l);const c=Co(-xe(i.direction,Re(l,l)));o=Lfe(c,i.origin,r,s),a=Lfe(Ka.max,i.origin,r,s)}return Se(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=zxt(this.view,i,0,OIe,MTt),o=r.intersectManifoldClosestSilhouette(Td(i,n),e,tt.get()),a=Wr(i,o),l=r.intersectManifoldClosestSilhouette(Td(i,Q_(tt.get(),i,s.center)),e,tt.get()),c=Wr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,tt.get());if(n){const a=be(tt.get(),e,o),l=ze(a);pe(a,a,1/l);const c=Re(tt.get(),e),h=Co(xe(c,a));return l*Math.sin(Math.min(TTt,h))}{const a=ge(tt.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Wr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:STt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+ur(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=tt.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,h=Jfe*s.width,d=Jfe*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,g=f/this._computeHeadingRotateRadius(o),y=a-i;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*y-y),zoom:2**(h*e/c)*l-l,rotate:Se(g*d,ETt,CTt)*e}}_applyDisabledMovementTypes(e){!b(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&zp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&zp(e.rotate.matrix))}static activatesFor(e,i){const r=kZ(i,e.navigation.gamepad,xTt);return!(i.action==="end"||N6(r))}};u([p({constructOnly:!0})],l2.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],l2.prototype,"disableMovements",void 0),l2=u([N("esri.views.3d.state.controllers.GamepadKeyboardController")],l2);const xTt={translation:[0,0,0],heading:0,tilt:0,zoom:0},OIe=80,TTt=ci(OIe),Jfe=.75,STt=5,ETt=ci(30),CTt=ci(80),Zw={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ge()},rotate:{enabled:!1,matrix:Ge()}},Oc=$(),eR=$(),MTt=Dse();function ATt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,zp(t.pan.matrix),t.rotate.enabled=!1,zp(t.rotate.matrix)}let OTt=class extends Is{constructor(e){super(!0),this._view=e,this._watchHandles=new ir,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ae(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},ii),ae(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||l2.activatesFor(this._view,e.data)){if(!r){const s=new l2({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Uu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Uu||(Uu={}));let RTt=class extends Is{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:it.Local},this._keyToNumber={[i.left]:Uu.LEFT,[i.right]:Uu.RIGHT,[i.forward]:Uu.FORWARD,[i.backward]:Uu.BACKWARD,[i.up]:Uu.UP,[i.down]:Uu.DOWN,[i.headingLeft]:Uu.HEADINGLEFT,[i.headingRight]:Uu.HEADINGRIGHT,[i.tiltUp]:Uu.TILTUP,[i.tiltDown]:Uu.TILTDOWN,[i.zoomIn]:Uu.ZOOMIN,[i.zoomOut]:Uu.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new l2({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},PTt=class extends Is{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new O9({view:this._view,mode:"interaction"}):new R9({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,zs(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},F9=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},aS=class extends iL{constructor(){super(...arguments),this._beginCamera=new jt,this._elapsedTimeSec=0,this.constraintOptions={selection:vs.ALL,interactionType:Oi.PAN,interactionFactor:0,interactionStartCamera:new jt,interactionDirection:null,tiltMode:va.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new j_}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Dn(this.view,i,this.constraintOptions)}};aS=u([N("esri.views.3d.state.controllers.momentum.MomentumController")],aS);let WI=class extends aS{constructor(e){super(e),this.interactionType=Oi.PAN,this._tmpPan=$()}momentumStep(e,i){const r=this.momentum.value(e);pe(this._tmpPan,this.momentum.direction,r),i.eye=be(Kfe,i.eye,this._tmpPan),i.center=be(Kfe,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],WI.prototype,"momentum",void 0),WI=u([N("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],WI);const Kfe=$(),ITt=$(),ZF=$();let n8=class extends aS{constructor(e){super(e),this.interactionType=Oi.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ge(ZF,i.eye),Re(ZF,ZF),Et(this.momentum.axis2,ZF,this.momentum.axis1),eIe(i,ITt,this.momentum.axis1,r,this.momentum.axis2,s)}};u([p({constructOnly:!0})],n8.prototype,"momentum",void 0),n8=u([N("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],n8);let BT=class extends aS{set center(e){this._set("center",zr(e))}set axis(e){this._set("axis",zr(e))}constructor(e){super(e),this.interactionType=Oi.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);uw(i,this.center,rL(this.axis,r))}};u([p({constructOnly:!0})],BT.prototype,"momentum",void 0),u([p({constructOnly:!0})],BT.prototype,"center",null),u([p({constructOnly:!0})],BT.prototype,"axis",null),BT=u([N("esri.views.3d.state.controllers.momentum.MomentumController")],BT);let MM=class extends aS{set zoomCenter(e){this._set("zoomCenter",zr(e))}constructor(e){super(e),this.interactionType=Oi.ZOOM,this.constraintOptions.interactionDirection=$()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ge(r,i.eye);const s=this.momentum.valueDelta(0,e);Ise(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Q_(r,i.eye,r)}};u([p({constructOnly:!0})],MM.prototype,"momentum",void 0),u([p({constructOnly:!0})],MM.prototype,"zoomCenter",null),MM=u([N("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],MM);let dT=class extends aS{set screenCenter(e){this._set("screenCenter",zs(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",zr(e))}constructor(e){super(e),this.interactionType=Oi.ZOOM,this.radius=0,this._tmpSceneCenter=$(),this._tmpZoomAxisAngle=_z(),this._sphere=to()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);YPe(this._sphere,i,r),this.constraintOptions.interactionType=Oi.ZOOM,Dn(this.view,i,this.constraintOptions),sL(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Ose(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),uw(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Oi.PAN}};u([p({constructOnly:!0})],dT.prototype,"momentum",void 0),u([p({constructOnly:!0})],dT.prototype,"screenCenter",null),u([p({constructOnly:!0})],dT.prototype,"sceneCenter",null),u([p({constructOnly:!0})],dT.prototype,"radius",void 0),dT=u([N("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],dT);let Qf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Tz=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},$Tt=class extends Tz{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},RIe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Qf(.6),this._screen=[new Qf(.4),new Qf(.4)],this._scene=[new Qf(.6),new Qf(.6),new Qf(.6)],this._tmpDirection=$()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){fe(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=ze(this._tmpDirection);s>0&&pe(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new $Tt(e,i,r,n==null?0:s/n,this._tmpDirection)}},Qfe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const eme=1e-5;let LTt=class extends Tz{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},DTt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=$(),this._tmpAxis2=$(),this._tmpAngles=je(),this._time=new Qf(.3),this._screen=[new Qf(.4),new Qf(.4)],this._angle1=new Qfe(.6),this._angle2=new Qfe(.6),this._axis1=$(),this._axis2=$(),this._lastScene=$()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=KPe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Ll(this._tmpAxis2)<eme?a=0:Re(this._axis1,this._tmpAxis2),this._angle1.update(a),ge(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;QPe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Ll(this._tmpAxis2)<eme?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Re(this._axis1,this._tmpAxis1),Re(this._axis2,this._tmpAxis2)),ge(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new LTt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},PIe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Qf(.8),this.time=new Qf(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Se(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new Tz(e,i,r)}},IIe=class extends PIe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},NTt=class extends Tz{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},$Ie=class extends PIe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new NTt(e,i,r)}},bK=class extends ry{constructor(){super(...arguments),this._smoothRotation=new F9(.05),this._rotationAxis=$(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=gr(),this._beginRadius=0,this._smoothScaling=new F9(.05),this._zoomCenterScreen=zs(),this._zoomMomentumEstimator=new $Ie,this._rotationMomentumEstimator=new IIe,this._panSphericalMomentumEstimator=new DTt,this._panPlanarMomentumEstimator=new RIe,this._adjustedSphere=to(),this._tmp3d=$(),this._tmpScreenPointArray=zs(),this._beginScreenPoint=zs(),this._beginScenePoint=$(),this._screenPickPoint=zs(),this._scenePickPoint=$(),this._mode=da.Horizontal,this._sphere=to(),this._pointerCount=0,this._tmpInteractionDirection=$(),this._constraintOptions={selection:vs.ALL,interactionType:Oi.NONE,interactionFactor:0,interactionStartCamera:new jt,interactionDirection:null,tiltMode:va.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-qb.normalize(ci(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Yg(e.center,this._screenPickPoint),Ao(this._beginScreenPoint,this._screenPickPoint);const r=ur(this.view.spatialReference),s=ZPe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,s3.Silhouette,this.view.map.ground.opacity===0?IS:{});A(s.scenePickPoint)||(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,ge(this._beginScenePoint,this._scenePickPoint),this._mode=bz(this.startCamera,this._screenPickPoint,r),this._mode===da.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===da.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===da.Horizontal?new dT({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new MM({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new BT({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===da.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new n8({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new WI({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Ul(this._tmp3d,this.startCamera.viewForward);xD(this._scenePickPoint,r,this._panningPlane);const s=zs(this._screenPickPoint[0],0),n=$(),o=ze(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],sL(this._adjustedSphere,this.startCamera,s,n);const a=ma();this.startCamera.projectToRenderScreen(n,a);const l=$(),c=$(),h=$();be(l,this._scenePickPoint,this.currentCamera.eye);const d=ze(l);Re(l,l);const f=qPe*Math.max(Math.abs(this.view.camera.position.z),WPe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,vz);let g=b(m)?m:f;g=i?Math.min(g,d):g,ge(h,we(c,this.currentCamera.eye,pe(c,l,g))),this._panningPlane[3]=-xe(this._panningPlane,h),this.startCamera.center=we(c,this.startCamera.eye,pe(c,this.startCamera.viewForward,g));const y=Yg(e.center,this._tmpScreenPointArray);fK(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),YPe(this._sphere,this.currentCamera,this._smoothScaling.value),Yg(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Oi.ZOOM,this._constraintOptions.interactionFactor=Kf(e.radius-this._beginRadius),Dn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Yg(e.center,this._tmpScreenPointArray);sL(this._sphere,this.currentCamera,i,this._tmp3d),$se(this._beginScenePoint,xe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(iIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(tIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Oi.PAN,this._constraintOptions.interactionFactor=Kf(Gp(this._screenPickPoint,i)),Dn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Re(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Ul(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+pK(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),uw(this.currentCamera,this._sphere,rL(this._rotationAxis,n)),this._constraintOptions.interactionType=Oi.TUMBLE,this._constraintOptions.interactionFactor=Kf(e.radius*r),Dn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Yg(e.center,this._tmpScreenPointArray);fK(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(JPe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Oi.PAN,this._constraintOptions.interactionFactor=Kf(Gp(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Dn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Ise(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Oi.ZOOM,this._constraintOptions.interactionFactor=Kf(e.radius-this._beginRadius),Dn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ge(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Ul(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=pK(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),uw(this.currentCamera,this._sphere,rL(this._rotationAxis,o)),this._constraintOptions.interactionType=Oi.TUMBLE,this._constraintOptions.interactionFactor=Kf(e.radius*o),Dn(this.view,this.currentCamera,this._constraintOptions)}};bK=u([N("esri.views.3d.state.controllers.global.PinchAndPanController")],bK);const tme=Ve(0,0,1),FTt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let wK=class extends ry{constructor(){super(...arguments),this._rotationValueSmooth=new F9(.05),this._scalingValueSmooth=new F9(.05),this._planeHorizontal=gr(),this._planeVertical=gr(),this._rotationMomentumEstimator=new IIe,this._panMomentumEstimator=new RIe(300,12,.9),this._zoomMomentumEstimator=new $Ie,this._beginRadius=0,this._beginCenter=$(),this._beginAngle=0,this._tmpPoints=[],this._panMode=da.Horizontal,this._beginCenterScreen=zs(),this._tmpCentroid3d=$(),this._tmpCentroid2d=zs(),this._tmp2d=zs(),this._pointerCount=0,this._constraintOptions={selection:vs.ALL,interactionType:Oi.NONE,interactionFactor:0,interactionStartCamera:new jt,interactionDirection:null,tiltMode:va.TUMBLE}}begin(e){var g;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Yg(e.center,this._beginCenterScreen),gOe(tme,0,this._planeHorizontal);const r=$(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?IS:{}),n=$();Ul(n,this.startCamera.viewForward);const o=$();ge(o,tme);const a=xe(n,o),l=Fp(a<0?-a:a);this._panMode=l>=FTt.ANGLE_THRESHOLD?da.Horizontal:da.Vertical;const c=Math.min(qPe,1/Math.abs(xe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),WPe);qZ(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||WZ(this._planeHorizontal,this._planeHorizontal);const h=$(),d=$(),f=$();be(h,r,this.currentCamera.eye);const m=ze(h);if(Re(h,h),this._panMode===da.Vertical){pe(o,o,a),be(this._planeVertical,n,o),Re(this._planeVertical,this._planeVertical),qZ(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,vz);let v=b(y)?y:c;v=s?Math.min(v,m):v,ge(f,we(d,this.currentCamera.eye,pe(d,h,v))),this._planeVertical[3]=-xe(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),QG(this._tmpPoints,this._beginCenter)}else{const y=s?m:c;ge(f,we(d,this.currentCamera.eye,pe(d,h,y))),this._planeHorizontal[3]=-xe(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),QG(this._tmpPoints,this._beginCenter)}(g=this._constraintOptions.interactionStartCamera)==null||g.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===da.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),Ise(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Oi.ZOOM,this._constraintOptions.interactionFactor=Kf(Math.abs(e.radius-this._beginRadius)),Dn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),QG(this._tmpPoints,this._tmpCentroid3d),Yg(e.center,this._tmpCentroid2d),JPe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Oi.PAN,this._constraintOptions.interactionFactor=Kf(Gp(this._beginCenterScreen,this._tmpCentroid2d)),Dn(this.view,this.currentCamera,this._constraintOptions),i){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+pK(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),uw(this.currentCamera,o,rL(n,h)),this._constraintOptions.interactionType=Oi.TUMBLE,this._constraintOptions.interactionFactor=Kf(Math.abs(e.radius*h)),Dn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new MM({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new BT({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new WI({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=$()),fK(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};wK=u([N("esri.views.3d.state.controllers.local.PinchAndPanController")],wK);let ime=class extends Is{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!vre(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new bK({view:this._view}):new wK({view:this._view})}},UTt=class extends Is{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},LIe=class extends Is{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},kTt=class extends LIe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},VTt=class extends LIe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},zTt=class extends Is{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=zs(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new qI({view:this._view,pivot:ju.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}},BTt=class extends Is{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new wD({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:y,y:v}of i.pointers.values())r=Math.max(r,y),s=Math.min(s,y),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),h=Math.min(h,v);const d=r-s,f=n-o,m=a-l,g=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},If=class extends Ee{constructor(){super(...arguments),this._handles=new ir}destroy(){this._handles=He(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=He(this._inputManager)}connect(){const e=this.view;this._source=new bre(this.view.surface,e.input);const i=[new A3e,new O3e,new E3e,new C3e(this.view.navigation),new BTt],r=new zf({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new S3e],Es.INTERNAL),this._modeDragPan=new ime(e,"primary"),this._modeDragRotate=new cj(e,"secondary",ju.CENTER),this._modeDragZoom=new wTt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new UTt(e),new gxt(e),new OTt(e),new RTt(e,s.pan),new PTt(e),new VTt(e,s.resetTilt),new kTt(e,s.resetHeading),new cj(e,"primary",ju.EYE,[s.lookAround]),new cj(e,"secondary",ju.CENTER,[s.lookAround]),new ime(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new zTt(e)],Es.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(ae(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},ii))}_updateMode(){var s;const e=this.mode,i=this.primaryDragAction,r=(s=xK.get(e))==null?void 0:s.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([p()],If.prototype,"view",void 0),u([p({value:"pan"})],If.prototype,"primaryDragAction",null),u([p({value:"default"})],If.prototype,"mode",null),u([p({readOnly:!0})],If.prototype,"hasPendingInputs",null),u([p()],If.prototype,"latestPointerType",null),u([p()],If.prototype,"latestPointerLocation",null),u([p()],If.prototype,"multiTouchActive",null),u([p()],If.prototype,"_inputManager",void 0),If=u([N("esri.views.3d.input.SceneInputManager")],If);const xK=new Map,uj=new Map,hj=new Map;uj.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),uj.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),hj.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),hj.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),xK.set("default",uj),xK.set("pro",hj);const GTt=If;let Jh,cA,TK=!1,SK=!1,EK=!1,CK=!1,YI=null;function jTt(t,e){if(!SK||!cA)return;DIe();const i=cA;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),NIe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function HTt(t){EK=_r.DECONFLICTOR_SHOW_VISIBLE,CK=_r.DECONFLICTOR_SHOW_INVISIBLE,TK=EK||CK,SK=_r.DECONFLICTOR_SHOW_GRID,YI=null,TK||SK?YI=()=>qTt(t):Jh&&(Jh.parentElement.removeChild(Jh),Jh=null)}function DIe(){YI&&(YI(),YI=null)}function qTt(t){Jh==null&&(Jh=document.createElement("canvas"),Jh.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Jh));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;Jh.setAttribute("width",`${o}px`),Jh.setAttribute("height",`${a}px`),Jh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),cA=Jh.getContext("2d"),cA.clearRect(0,0,s,n),cA.font="12px Arial"}function NIe(t,e,i,r,s){DIe();const n=Jh.height,o=cA;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function WTt(t,e){TK&&(e&&EK||!e&&CK)&&NIe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Fa,Ju;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(Fa||(Fa={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(Ju||(Ju={}));function FIe(t,e){return new zIe(t,GIe,e)}function YTt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=GIe;return new zIe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:dj.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:dj.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:dj.minPixelSize},e)}function XTt(t){return Math.abs(t*t*t)}function UIe(t,e,i){const r=i.parameters,s=i.paddingPixelsOverride;return tR.scale=Math.min(r.divisor/(e-r.offset),1),tR.factor=XTt(t),tR.minPixelSize=r.minPixelSize,tR.paddingPixels=s,tR}function kIe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function zse(t,e){return Math.max(ei(t*e.scale,t,e.factor),kIe(t,e))}function ZTt(t,e,i){const r=UIe(t,e,i);return r.minPixelSize=0,r.paddingPixels=0,zse(1,r)}function rme(t,e,i,r){r.scale=ZTt(t,e,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function VIe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,kIe(t[1],e)/Math.max(1e-5,t[1])),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function JTt(t,e,i,r){return zse(t,UIe(e,i,r))}let zIe=class BIe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,i,r,s=KTt(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===it.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new BIe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,i),h=this._coverageCompensation(e,i,c),{tiltAngle:d,scaleFallOffFactor:f}=c,m=Math.sin(d)*l,g=.5*Math.PI-d-a*(.5-s*h),y=m/Math.cos(g),v=g+a*n*h,x=(y-f*(m/Math.cos(v)))/(1-f);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=x,r.divisor=y-x,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(e,i,r=sme){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=sme){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Se((o-a)/(l-a),0,1),[h,d]=[s.min,s.max];return r.tiltAngle=ei(h.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=ei(h.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const GIe={curvatureDependent:{min:{curvature:ci(10),tiltAngle:ci(12),scaleFallOffFactor:.5},max:{curvature:ci(70),tiltAngle:ci(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},dj={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function KTt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const tR={scale:0,factor:0,minPixelSize:0,paddingPixels:0},sme={tiltAngle:0,scaleFallOffFactor:0};function QTt(t){return t instanceof Float32Array&&t.length>=16}function e2t(t){return Array.isArray(t)&&t.length>=16}function t2t(t){return QTt(t)||e2t(t)}function Bse(t){t.vertex.code.add(T`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function i2t(t){t.uniforms.add(new Ni("screenSizePerspective",e=>jIe(e.screenSizePerspective)))}function Sz(t){t.uniforms.add(new Ni("screenSizePerspectiveAlignment",e=>jIe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function jIe(t){return Rr(r2t,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const r2t=Ai();let HIe=class extends dn{constructor(e,i){super(e,"mat4",Vr.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function $m(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Fl):t.uniforms.add(new gd("cameraPosition",(i,r)=>fe(qIe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function ah(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new Ps("proj",(r,s)=>s.camera.projectionMatrix),new HIe("view",(r,s)=>fu(nme,s.camera.viewMatrix,r.origin)),new gd("localOrigin",r=>r.origin)]);const i=r=>fe(qIe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new Ps("proj",(r,s)=>s.camera.projectionMatrix),new Ps("view",(r,s)=>fu(nme,s.camera.viewMatrix,i(s))),new fi("localOrigin",(r,s)=>i(s))])}const nme=nD(),qIe=$();function o3(t){t.uniforms.add(new Ps("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function WIe(t,e){const i=t.vertex;e.hasVerticalOffset?(YIe(i),e.hasScreenSizePerspective&&(t.include(Bse),Sz(i),$m(t.vertex,e)),i.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const s2t=Ai();function YIe(t){t.uniforms.add(new Ni("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Rr(s2t,n*a,o,r,s)}))}var qh;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(qh||(qh={}));var su;function XIe(t,e){t.include(Bse),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.NORMAL,"vec3"),t.attributes.add(P.AUXPOS1,"vec4");const i=t.vertex;ah(i,e),$m(i,e),i.uniforms.add([new Ni("viewport",(r,s)=>s.camera.fullViewport),new Be("polygonOffset",r=>r.shaderPolygonOffset),new Be("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new Be("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===qh.Occluded?1:s.renderTransparentlyOccludedHUD===qh.NotOccluded?0:.75),new Yt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),e.hasVerticalOffset&&YIe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(T`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||o3(i),e.isDraped||(i.uniforms.add(new Be("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(T`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===su.Screen&&i.uniforms.add(new Be("pixelRatio",(r,s)=>s.camera.pixelRatio)),e.hasScreenSizePerspective&&Sz(i),i.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===su.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==su.Screen?T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===su.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===su.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(T`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(su||(su={}));const JF=Mo();function ZIe(t,e,i,r,s,n){if(t.visible)if(t.boundingInfo){Rt(t.type===xn.Mesh);const o=e.tolerance;JIe(t.boundingInfo,i,r,o,s,n)}else{const o=t.indices.get(P.POSITION),a=t.vertexAttributes.get(P.POSITION);PD(i,r,0,o.length/3,o,a,void 0,s,n)}}const n2t=$();function JIe(t,e,i,r,s,n){if(A(t))return;const o=QIe(e,i,n2t);if(Zxe(JF,t.bbMin),Jxe(JF,t.bbMax),b(s)&&s.applyToAabb(JF),jse(JF,e,o,r)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>c2t){const d=t.getChildren();if(d!==void 0){for(const f of d)JIe(f,e,i,r,s,n);return}}PD(e,i,0,h,l,c,a,s,n)}}const KIe=$();function PD(t,e,i,r,s,n,o,a,l){if(o)return o2t(t,e,i,r,s,n,o,a,l);const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],g=e[0]-d,y=e[1]-f,v=e[2]-m;for(let x=i,S=3*i;x<r;++x){let E=h*s[S++],C=c[E++],R=c[E++],O=c[E];E=h*s[S++];let U=c[E++],L=c[E++],B=c[E];E=h*s[S++];let G=c[E++],j=c[E++],q=c[E];b(a)&&([C,R,O]=a.applyToVertex(C,R,O,x),[U,L,B]=a.applyToVertex(U,L,B,x),[G,j,q]=a.applyToVertex(G,j,q,x));const ie=U-C,ee=L-R,K=B-O,Y=G-C,D=j-R,V=q-O,k=y*V-D*v,Z=v*Y-V*g,Q=g*D-Y*y,ne=ie*k+ee*Z+K*Q;if(Math.abs(ne)<=Number.EPSILON)continue;const te=d-C,de=f-R,_e=m-O,Ce=te*k+de*Z+_e*Q;if(ne>0){if(Ce<0||Ce>ne)continue}else if(Ce>0||Ce<ne)continue;const Pe=de*K-ee*_e,Ze=_e*ie-K*te,Le=te*ee-ie*de,Me=g*Pe+y*Ze+v*Le;if(ne>0){if(Me<0||Ce+Me>ne)continue}else if(Me>0||Ce+Me<ne)continue;const qe=(Y*Pe+D*Ze+V*Le)/ne;qe>=0&&l(qe,Gse(ie,ee,K,Y,D,V,KIe),x,!1)}}function o2t(t,e,i,r,s,n,o,a,l){const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],g=e[0]-d,y=e[1]-f,v=e[2]-m;for(let x=i;x<r;++x){const S=o[x];let E=3*S,C=h*s[E++],R=c[C++],O=c[C++],U=c[C];C=h*s[E++];let L=c[C++],B=c[C++],G=c[C];C=h*s[E];let j=c[C++],q=c[C++],ie=c[C];b(a)&&([R,O,U]=a.applyToVertex(R,O,U,x),[L,B,G]=a.applyToVertex(L,B,G,x),[j,q,ie]=a.applyToVertex(j,q,ie,x));const ee=L-R,K=B-O,Y=G-U,D=j-R,V=q-O,k=ie-U,Z=y*k-V*v,Q=v*D-k*g,ne=g*V-D*y,te=ee*Z+K*Q+Y*ne;if(Math.abs(te)<=Number.EPSILON)continue;const de=d-R,_e=f-O,Ce=m-U,Pe=de*Z+_e*Q+Ce*ne;if(te>0){if(Pe<0||Pe>te)continue}else if(Pe>0||Pe<te)continue;const Ze=_e*Y-K*Ce,Le=Ce*ee-Y*de,Me=de*K-ee*_e,qe=g*Ze+y*Le+v*Me;if(te>0){if(qe<0||Pe+qe>te)continue}else if(qe>0||Pe+qe<te)continue;const We=(D*Ze+V*Le+k*Me)/te;We>=0&&l(We,Gse(ee,K,Y,D,V,k,KIe),S,!1)}}const ome=$(),ame=$();function Gse(t,e,i,r,s,n,o){return fe(ome,t,e,i),fe(ame,r,s,n),Et(o,ome,ame),Re(o,o),o}function QIe(t,e,i){return fe(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function jse(t,e,i,r){return Hse(t,e,i,r,1/0)}function Hse(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}function e$e(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;b(s)&&(n=JTt(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Se(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function t$e(t,e){const i=e?t$e(e):{};for(const r in t){let s=t[r];s&&s.forEach&&(s=l2t(s)),s==null&&r in i||(i[r]=s)}return i}function a2t(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):iee(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function l2t(t){const e=[];return t.forEach(i=>e.push(i)),e}const i$e={multiply:1,ignore:2,replace:3,tint:4},c2t=1e3;let Sw=class extends MD{constructor(e,i){super(),this.type=xn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=rr,this._pp0=Ve(0,0,1),this._pp1=Ve(0,0,0),this._parameters=t$e(e,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){a2t(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){b(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},r$e=class extends Vvt{constructor(e,i,r){super(i,r),this.camera=e}};var Ks;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ks||(Ks={}));let tO=class extends Br{constructor(){super(...arguments),this.renderOccluded=Ks.Occlude}},s$e=class{constructor(){this.factor=new lme,this.factorAlignment=new lme}},lme=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function IKt(t,e,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=e[t[l]],r+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function u2t(t,e,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=t.length;r*=n;for(let a=0;a<o;++a){const l=2*t[a];s[r]=e[l],s[r+1]=e[l+1],r+=n}}function n$e(t,e,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],r+=o}}function a3(t,e,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],n[r+3]=e[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],n[r+3]=e[c+3],r+=o}}function cme(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Ez(t,e,i,r,s,n=1){if(!i)return void n$e(t,e,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=t.length,c=i[0],h=i[1],d=i[2],f=i[4],m=i[5],g=i[6],y=i[8],v=i[9],x=i[10],S=i[12],E=i[13],C=i[14];s*=a;let R=0,O=0,U=0;const L=hV(i)?B=>{R=e[B]+S,O=e[B+1]+E,U=e[B+2]+C}:B=>{const G=e[B],j=e[B+1],q=e[B+2];R=c*G+f*j+y*q+S,O=h*G+m*j+v*q+E,U=d*G+g*j+x*q+C};if(n===1)for(let B=0;B<l;++B)L(3*t[B]),o[s]=R,o[s+1]=O,o[s+2]=U,s+=a;else for(let B=0;B<l;++B){L(3*t[B]);for(let G=0;G<n;++G)o[s]=R,o[s+1]=O,o[s+2]=U,s+=a}}function qse(t,e,i,r,s,n=1){if(!i)return void n$e(t,e,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],g=o[5],y=o[6],v=o[8],x=o[9],S=o[10],E=!Fte(o),C=1e-6,R=1-C;s*=l;let O=0,U=0,L=0;const B=hV(o)?G=>{O=e[G],U=e[G+1],L=e[G+2]}:G=>{const j=e[G],q=e[G+1],ie=e[G+2];O=h*j+m*q+v*ie,U=d*j+g*q+x*ie,L=f*j+y*q+S*ie};if(n===1)if(E)for(let G=0;G<c;++G){B(3*t[G]);const j=O*O+U*U+L*L;if(j<R&&j>C){const q=1/Math.sqrt(j);a[s]=O*q,a[s+1]=U*q,a[s+2]=L*q}else a[s]=O,a[s+1]=U,a[s+2]=L;s+=l}else for(let G=0;G<c;++G)B(3*t[G]),a[s]=O,a[s+1]=U,a[s+2]=L,s+=l;else for(let G=0;G<c;++G){if(B(3*t[G]),E){const j=O*O+U*U+L*L;if(j<R&&j>C){const q=1/Math.sqrt(j);O*=q,U*=q,L*=q}}for(let j=0;j<n;++j)a[s]=O,a[s+1]=U,a[s+2]=L,s+=l}}function h2t(t,e,i,r,s,n=1){if(!i)return void a3(t,e,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],g=o[5],y=o[6],v=o[8],x=o[9],S=o[10],E=!Fte(o),C=1e-6,R=1-C;if(s*=l,n===1)for(let O=0;O<c;++O){const U=4*t[O],L=e[U],B=e[U+1],G=e[U+2],j=e[U+3];let q=h*L+m*B+v*G,ie=d*L+g*B+x*G,ee=f*L+y*B+S*G;if(E){const K=q*q+ie*ie+ee*ee;if(K<R&&K>C){const Y=1/Math.sqrt(K);q*=Y,ie*=Y,ee*=Y}}a[s]=q,a[s+1]=ie,a[s+2]=ee,a[s+3]=j,s+=l}else for(let O=0;O<c;++O){const U=4*t[O],L=e[U],B=e[U+1],G=e[U+2],j=e[U+3];let q=h*L+m*B+v*G,ie=d*L+g*B+x*G,ee=f*L+y*B+S*G;if(E){const K=q*q+ie*ie+ee*ee;if(K<R&&K>C){const Y=1/Math.sqrt(K);q*=Y,ie*=Y,ee*=Y}}for(let K=0;K<n;++K)a[s]=q,a[s+1]=ie,a[s+2]=ee,a[s+3]=j,s+=l}}function Wse(t,e,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=t.length;if(s*=a,i!==e.length||i!==4)if(n!==1)if(i!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(i===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(r.typedBuffer.buffer,r.start),h=a/4,d=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=d,s+=h}}function o$e(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function a$e(t,e,i,r,s,n){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case P.POSITION:{Rt(a.size===3);const c=s.getField(o,cs);Rt(!!c,`No buffer view for ${o}`),c&&Ez(l,a.data,i,c,n);break}case P.NORMAL:{Rt(a.size===3);const c=s.getField(o,cs);Rt(!!c,`No buffer view for ${o}`),c&&qse(l,a.data,r,c,n);break}case P.UV0:{Rt(a.size===2);const c=s.getField(o,dv);Rt(!!c,`No buffer view for ${o}`),c&&u2t(l,a.data,c,n);break}case P.COLOR:case P.SYMBOLCOLOR:{Rt(a.size===3||a.size===4);const c=s.getField(o,Gl);Rt(!!c,`No buffer view for ${o}`),c&&Wse(l,a.data,a.size,c,n);break}case P.TANGENT:{Rt(a.size===4);const c=s.getField(o,ph);Rt(!!c,`No buffer view for ${o}`),c&&h2t(l,a.data,r,c,n);break}case P.PROFILERIGHT:case P.PROFILEUP:case P.PROFILEVERTEXANDNORMAL:case P.FEATUREVALUE:{Rt(a.size===4);const c=s.getField(o,ph);Rt(!!c,`No buffer view for ${o}`),c&&a3(l,a.data,c,n)}}else if(o===P.OBJECTANDLAYERIDCOLOR&&b(t.objectAndLayerIdColor)){const c=t.indices.get(P.POSITION);if(Rt(!!c,`No buffer view for ${o}`),c){const h=c.length,d=s.getField(o,Gl);o$e(t.objectAndLayerIdColor,d,h,n)}}}}function oL(t,e,i=0){const r=Se(t,0,f2t);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*m2t(r*d2t[s]))}function Yse(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*p2t[r];return i}const d2t=[1,256,65536,16777216],p2t=[1/256,1/65536,1/16777216,1/4294967296],f2t=Yse(new Uint8ClampedArray([255,255,255,255]));function m2t(t){return t-Math.floor(t)}async function Y_(t,e){const{data:i}=await tr(t,{responseType:"image",...e});return i}let Xse=class extends Br{constructor(){super(...arguments),this.color=di(1,1,1,1)}};function g2t(){const t=new ar;return t.include(Qp),t.fragment.uniforms.add([new Yt("tex",e=>e.texture),new Ni("uColor",e=>e.color)]),t.fragment.code.add(T`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const y2t=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Xse,build:g2t},Symbol.toStringTag,{value:"Module"}));function _2t(){if(A(pj)){const t=e=>Cr(`esri/libs/basisu/${e}`);pj=se(()=>import("./basis_transcoder-e0466ff6.js"),["assets/basis_transcoder-e0466ff6.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return pj}let pj;var GT;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(GT||(GT={}));let _m=null,KF=null;async function l$e(){return A(KF)&&(KF=_2t(),_m=await KF),KF}function v2t(t,e){if(A(_m))return t.byteLength;const i=new _m.BasisFile(new Uint8Array(t)),r=u$e(i)?c$e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function b2t(t,e){if(A(_m))return t.byteLength;const i=new _m.KTX2File(new Uint8Array(t)),r=h$e(i)?c$e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function c$e(t,e,i,r,s){const n=nRe(e?_n.COMPRESSED_RGBA8_ETC2_EAC:_n.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function u$e(t){return t.getNumImages()>=1&&!t.isUASTC()}function h$e(t){return t.getFaces()>=1&&t.isETC1S()}async function w2t(t,e,i){A(_m)&&(_m=await l$e());const r=new _m.BasisFile(new Uint8Array(i));if(!u$e(r))return null;r.startTranscoding();const s=d$e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function x2t(t,e,i){A(_m)&&(_m=await l$e());const r=new _m.KTX2File(new Uint8Array(i));if(!h$e(r))return null;r.startTranscoding();const s=d$e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function d$e(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?r?[GT.ETC2_RGBA,_n.COMPRESSED_RGBA8_ETC2_EAC]:[GT.ETC1_RGB,_n.COMPRESSED_RGB8_ETC2]:c?r?[GT.BC3_RGBA,_n.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[GT.BC1_RGB,_n.COMPRESSED_RGB_S3TC_DXT1_EXT]:[GT.RGBA32,Qe.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let x=0;x<f;x++)m.push(new Uint8Array(o(x,h))),a(x,h,m[x]);const g=m.length>1,y=g?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,v={...e,samplingMode:y,hasMipmap:g,internalFormat:d,width:s,height:n};return new At(t,v,{type:"compressed",levels:m})}const iR=le.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),T2t=542327876,S2t=131072,E2t=4;function Zse(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function C2t(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const M2t=Zse("DXT1"),A2t=Zse("DXT3"),O2t=Zse("DXT5"),R2t=31,P2t=0,I2t=1,$2t=2,L2t=3,D2t=4,N2t=7,F2t=20,U2t=21;function k2t(t,e,i){const{textureData:r,internalFormat:s,width:n,height:o}=Ol(V2t(i,e.hasMipmap??!1));return e.samplingMode=r.levels.length>1?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,e.hasMipmap=r.levels.length>1,e.internalFormat=s,e.width=n,e.height=o,new At(t,e,r)}function V2t(t,e){const i=new Int32Array(t,0,R2t);if(i[P2t]!==T2t)return iR.error("Invalid magic number in DDS header"),null;if(!(i[F2t]&E2t))return iR.error("Unsupported format, must contain a FourCC code"),null;const r=i[U2t];let s,n;switch(r){case M2t:s=8,n=_n.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case A2t:s=16,n=_n.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case O2t:s=16,n=_n.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return iR.error("Unsupported FourCC code:",C2t(r)),null}let o=1,a=i[D2t],l=i[L2t];!(3&a)&&!(3&l)||(iR.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;i[$2t]&S2t&&e!==!1&&(o=Math.max(1,i[N2t])),o===1||Cm(a)&&Cm(l)||(iR.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[I2t]+4;const g=[];for(let y=0;y<o;++y)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,f),g.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:h}}let $S=class o8 extends MD{constructor(e,i){super(),this._data=e,this.type=xn.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new ws,this._passParameters=new Xse,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:qt.REPEAT,t:qt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Ib.STRETCH,this.estimatedTexMemRequired=o8._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;A(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(SA(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){$y(e.src)||SA(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,i){if(A(e))return 0;if(_O(e)||MT(e))return i.encoding===c_.KTX2_ENCODING?b2t(e,!!i.mipmap):i.encoding===c_.BASIS_ENCODING?v2t(e,!!i.mipmap):e.byteLength;const{width:r,height:s}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?o8._getDataDimensions(e):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,i){if(b(this._glTexture))return this._glTexture;if(b(this._loadingPromise))return this._loadingPromise;const r=this._data;return A(r)?(this._glTexture=new At(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,i,r):r instanceof Image?this._loadFromImageElement(e,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r,i):(_O(r)||MT(r))&&this.params.encoding===c_.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(_O(r)||MT(r))&&this.params.encoding===c_.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(_O(r)||MT(r))&&this.params.encoding===c_.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):MT(r)?this._loadFromPixelData(e,r):_O(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,i,r){if(!(this._data instanceof HTMLVideoElement)||A(this._glTexture)||this._data.readyState<XI.HAVE_CURRENT_DATA||r===this._data.currentTime)return r;if(b(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,i){return this._glTexture=k2t(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>x2t(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>w2t(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){Rt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this.params.components===1?Qe.LUMINANCE:this.params.components===3?Qe.RGB:Qe.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new At(e,r,i),this._glTexture}_loadFromURL(e,i,r){return this._loadAsync(async s=>{const n=await Y_(r,{signal:s});return _i(s),this._loadFromImage(e,n,i)})}_loadFromImageElement(e,i,r){return r.complete?this._loadFromImage(e,r,i):this._loadAsync(async s=>{const n=await fwe(r,r.src,!1,s);return _i(s),this._loadFromImage(e,n,i)})}_loadFromVideoElement(e,i,r){return r.readyState>=XI.HAVE_CURRENT_DATA?this._loadFromImage(e,r,i):this._loadFromVideoElementAsync(e,i,r)}_loadFromVideoElementAsync(e,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),is(h)},l=()=>{r.readyState>=XI.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(e,r,i)))},c=d=>{a(),o(d||new J("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=ol(s,()=>c(er()))}))}_loadFromImage(e,i,r){const s=o8._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this.params.components===3?Qe.RGB:Qe.RGBA,!this._requiresPowerOfTwo(e,n)||Cm(s.width)&&Cm(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new At(e,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,i,s,n,r),this._glTexture)}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(e,i){const r=qt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return e.type===Ft.WEBGL1&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(e,i,r,s,n){const{width:o,height:a}=r,l=AA(o),c=AA(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Ib.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new At(e,s),h.updateData(0,0,0,o,a,i);break;case Ib.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,i,r,s){const n=new At(e,r),o=new Sn(e,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},n),a=new At(e,{target:Ut.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=ql(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),n}_drawStretchedTexture(e,i,r,s,n,o){this._passParameters.texture=n,e.bindFramebuffer(r);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(i,this._passParameters,null),e.bindVAO(s),e.drawArrays(Xt.TRIANGLE_STRIP,0,il(s,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(b(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(b(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),b(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var XI;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(XI||(XI={}));const aL=128,Jse=.5;function p$e(t,e=aL,i=e*Jse,r=0){const s=z2t(t,e,i,r);return new $S(s,{mipmap:!1,wrap:{s:qt.CLAMP_TO_EDGE,t:qt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function z2t(t,e=aL,i=e*Jse,r=0){switch(t){case"circle":default:return B2t(e,i);case"square":return G2t(e,i);case"cross":return H2t(e,i,r);case"x":return q2t(e,i,r);case"kite":return j2t(e,i);case"triangle":return W2t(e,i);case"arrow":return Y2t(e,i)}}function B2t(t,e){const i=t/2-.5;return ID(t,g$e(i,i,e/2))}function G2t(t,e){return f$e(t,e,!1)}function j2t(t,e){return f$e(t,e,!0)}function H2t(t,e,i=0){return m$e(t,e,!1,i)}function q2t(t,e,i=0){return m$e(t,e,!0,i)}function W2t(t,e){return ID(t,y$e(t/2,e,e/2))}function Y2t(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=g$e(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=y$e(s,i,r);return ID(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function f$e(t,e,i){return i&&(e/=Math.SQRT2),ID(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function m$e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return ID(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function g$e(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function y$e(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function ID(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,oL(o,i,4*n)}return i}let LKt=class extends Br{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function X2t(t,e){_$e(t,e,[new fi("slicePlaneOrigin",(i,r)=>x$e(e,i,r)),new fi("slicePlaneBasis1",(i,r)=>{var s;return U9(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new fi("slicePlaneBasis2",(i,r)=>{var s;return U9(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function Un(t,e){_$e(t,e,[new gd("slicePlaneOrigin",(i,r)=>x$e(e,i,r)),new gd("slicePlaneBasis1",(i,r)=>{var s;return U9(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new gd("slicePlaneBasis2",(i,r)=>{var s;return U9(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function _$e(t,e,i){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(i),t.fragment.uniforms.add(i);const r=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?T`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function v$e(t,e,i){return t.instancedDoublePrecision?fe(Z2t,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function b$e(t,e){return b(t)?be(k9,e.origin,t):e.origin}function w$e(t,e,i){return t.hasSliceTranslatedView?b(e)?fu(J2t,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function x$e(t,e,i){if(A(i.slicePlane))return Fl;const r=v$e(t,e,i),s=b$e(r,i.slicePlane),n=w$e(t,r,i);return b(n)?at(k9,s,n):s}function U9(t,e,i,r){if(A(r)||A(i.slicePlane))return Fl;const s=v$e(t,e,i),n=b$e(s,i.slicePlane),o=w$e(t,s,i);return b(o)?(we(rR,r,n),at(k9,n,o),at(rR,rR,o),be(rR,rR,k9)):r}const Z2t=$(),k9=$(),rR=$(),J2t=Ge();function Cz(t,e){const i=e.output===H.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(P.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(P.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${i?r?T`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${i?T`gl_FragColor = objectAndLayerIdColorVarying;`:T``} }`)}function K2t(t,e){const{vertex:i,fragment:r}=t;e.hasMultipassGeometry&&i.include(ERe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&r.include(Sd),e.hasMultipassTerrain&&r.uniforms.add([...ym("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?Ar.None:Ar.InvSize),new hr("nearFar",(s,n)=>n.camera.nearFar)]),r.include(_h),r.code.add(T`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?T`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${_c(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Q2t=di(1,1,0,1),T$e=di(1,0,1,1);function pv(t,e){t.fragment.uniforms.add(ym("depthTex",(i,r)=>r.highlightDepthTexture,e.hasWebGL2Context?Ar.None:Ar.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",Q2t).add("unoccludedHighlightFlag","vec4",T$e),t.fragment.code.add(T`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${_c(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let Mz=class extends dn{constructor(e,i,r){super(e,"vec4",Vr.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},Dl=class extends dn{constructor(e,i,r){super(e,"float",Vr.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},Kse=class extends tO{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ve(1,1,1),this.vvSizeMaxSize=Ve(100,100,100),this.vvSizeOffset=Ve(0,0,0),this.vvSizeFactor=Ve(1,1,1),this.vvSizeValue=Ve(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Hs()}};const vm=8;function uA(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(P.INSTANCEFEATUREATTRIBUTE,"vec4");const i=t.vertex;e.vvSize?(i.uniforms.add(new fi("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new fi("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new fi("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new fi("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new Vy("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new fi("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",vm),e.hasVvInstancing&&i.uniforms.add([new Dl("vvColorValues",r=>r.vvColorValues,vm),new Mz("vvColorColors",r=>r.vvColorColors,vm)]),i.code.add(T`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?T`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const V9=.1,sl=.001;function eSt(t){const e=new ar,i=t.signedDistanceFieldEnabled;if(e.include(dse),e.include(XIe,t),e.include(Un,t),t.occlusionPass)return e.include(K2t,t),e;const{vertex:r,fragment:s}=e;e.include(Bse),s.include(_h),s.include(ky),e.include(uA,t),e.include(Cz,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),r.uniforms.add([new Ni("viewport",(c,h)=>h.camera.fullViewport),new hr("screenOffset",(c,h)=>Vt(S$e,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new hr("anchorPosition",c=>z9(c)),new Ni("materialColor",c=>c.color),new Be("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new Ni("outlineColor",c=>c.outlineColor)),s.uniforms.add([new Ni("outlineColor",c=>ume(c)?c.outlineColor:fy),new Be("outlineSize",c=>ume(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(i2t(r),Sz(r)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(P.UV0,"vec2"),e.attributes.add(P.COLOR,"vec4"),e.attributes.add(P.SIZE,"vec2"),e.attributes.add(P.AUXPOS2,"vec4"),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;t.vvColor&&r.uniforms.add([new Mz("vvColorColors",c=>c.vvColorColors,vm),new Dl("vvColorValues",c=>c.vvColorValues,vm)]),r.uniforms.add(new hr("textureCoordinateScaleFactor",c=>b(c.texture)&&b(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:QAe)),r.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===H.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(sl)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(sl)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Yt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(V9)})`:T.float(V9),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?T`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${T.float(aL)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(sl)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===H.Alpha&&s.code.add(T`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===H.ObjectAndLayerIdColor&&s.code.add(T`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===H.Color&&s.code.add(T`
    void main() {
      ${l}
      ${t.transparencyPassType===zt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===H.Highlight&&(e.include(pv,t),s.code.add(T`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?T`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function ume(t){return t.outlineColor[3]>0&&t.outlineSize>0}function z9(t,e=S$e){return t.textureIsSignedDistanceField?tSt(t.anchorPosition,t.distanceFieldBoundingBox,e):Ao(e,t.anchorPosition),e}function tSt(t,e,i){b(e)?Vt(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Vt(i,0,0)}const S$e=je(),iSt=Object.freeze(Object.defineProperty({__proto__:null,build:eSt,calculateAnchorPosForRendering:z9},Symbol.toStringTag,{value:"Module"})),yd=qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),rSt=Um(Ne.ONE,Ne.ONE),E$e=Um(Ne.ZERO,Ne.ONE_MINUS_SRC_ALPHA);function fv(t){return t===zt.FrontFace?null:t===zt.Alpha?E$e:rSt}function Az(t){return t===zt.FrontFace?gu:null}const Oz=5e5,Rz={factor:-1,units:-2};function Pz(t){return t?Rz:null}function Ew(t,e=hs.LESS){return t===zt.NONE||t===zt.FrontFace?e:hs.LEQUAL}let C$e=class M$e extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global}initializeProgram(e){return new cr(e.rctx,M$e.shader.get().build(this.configuration),rr)}_setPipelineState(e){const i=this.configuration,r=e===zt.NONE,s=e===zt.FrontFace,n=this.configuration.hasPolygonOffset?sSt:null,o=(r||s)&&i.output!==H.Highlight&&(i.depthEnabled||i.occlusionPass)?gu:null;return si({blending:i.output===H.Color||i.output===H.Alpha||i.output===H.Highlight?r?nSt:fv(e):null,depthTest:{func:hs.LEQUAL},depthWrite:o,colorWrite:wi,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Xt.POINTS:Xt.TRIANGLES}};C$e.shader=new lr(iSt,()=>se(()=>import("./HUDMaterial.glsl-cb0f3f84.js"),[]));const sSt={factor:0,units:-4},nSt=Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA);let On=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.screenCenterOffsetUnitsEnabled=su.World,this.transparencyPassType=zt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([X({count:H.COUNT})],On.prototype,"output",void 0),u([X({count:su.COUNT})],On.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([X({count:zt.COUNT})],On.prototype,"transparencyPassType",void 0),u([X()],On.prototype,"spherical",void 0),u([X()],On.prototype,"occlusionTestEnabled",void 0),u([X()],On.prototype,"signedDistanceFieldEnabled",void 0),u([X()],On.prototype,"vvSize",void 0),u([X()],On.prototype,"vvColor",void 0),u([X()],On.prototype,"hasVerticalOffset",void 0),u([X()],On.prototype,"hasScreenSizePerspective",void 0),u([X()],On.prototype,"debugDrawLabelBorder",void 0),u([X()],On.prototype,"binaryHighlightOcclusionEnabled",void 0),u([X()],On.prototype,"hasSlicePlane",void 0),u([X()],On.prototype,"hasPolygonOffset",void 0),u([X()],On.prototype,"depthEnabled",void 0),u([X()],On.prototype,"pixelSnappingEnabled",void 0),u([X()],On.prototype,"isDraped",void 0),u([X()],On.prototype,"hasMultipassGeometry",void 0),u([X()],On.prototype,"hasMultipassTerrain",void 0),u([X()],On.prototype,"cullAboveGround",void 0),u([X()],On.prototype,"occlusionPass",void 0),u([X()],On.prototype,"objectAndLayerIdColorInstanced",void 0),u([X({constValue:!0})],On.prototype,"hasSliceInVertexProgram",void 0),u([X({constValue:!1})],On.prototype,"hasVvInstancing",void 0);let l3=class extends Sw{constructor(e){super(e,new mSt),this._configuration=new On}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?su.Screen:su.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=i.slot===Ie.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===H.Color||e===H.Alpha),e===H.Color&&(this._configuration.debugDrawLabelBorder=!!_r.LABELS_SHOW_BORDER),e===H.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(jp(mj,i),b(e.shaderTransformer)){const S=e.shaderTransformer(pme);l=S[0],c=S[5],lSt(mj)}const h=e.vertexAttributes.get(P.POSITION),d=e.vertexAttributes.get(P.SIZE),f=e.vertexAttributes.get(P.NORMAL),m=e.vertexAttributes.get(P.AUXPOS1);Rt(h.size>=3);const g=r.point,y=r.camera,v=z9(a);l*=y.pixelRatio,c*=y.pixelRatio;const x=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const E=S*h.size;fe(xl,h.data[E],h.data[E+1],h.data[E+2]),at(xl,xl,i);const C=S*d.size;zv[0]=d.data[C]*l,zv[1]=d.data[C+1]*c,at(xl,xl,y.viewMatrix);const R=S*m.size;if(fe(Eh,m.data[R+0],m.data[R+1],m.data[R+2]),!x&&(xl[0]+=Eh[0],xl[1]+=Eh[1],Eh[2]!==0)){const U=Eh[2];Re(Eh,xl),be(xl,xl,pe(Eh,Eh,U))}const O=S*f.size;if(fe(sR,f.data[O],f.data[O+1],f.data[O+2]),this._normalAndViewAngle(sR,mj,y,gj),this._applyVerticalOffsetTransformationView(xl,gj,y,fj),y.applyProjection(xl,Ql),Ql[0]>-1){Ql[0]=Math.floor(Ql[0]),Ql[1]=Math.floor(Ql[1]),x&&(Eh[0]||Eh[1])&&(Ql[0]+=Eh[0],Eh[1]!==0&&(Ql[1]+=zse(Eh[1],fj.factorAlignment)),y.unapplyProjection(Ql,xl)),Ql[0]+=this.parameters.screenOffset[0],Ql[1]+=this.parameters.screenOffset[1],VIe(zv,fj.factor,zv);const U=dSt*y.pixelRatio;let L=0;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*y.pixelRatio/2),g&&hme(g,Ql[0],Ql[1],zv,U,L,a,v)){const B=r.ray;if(at(dme,xl,Va(hSt,y.viewMatrix)),Ql[0]=g[0],Ql[1]=g[1],y.unprojectFromRenderScreen(Ql,xl)){const G=$();ge(G,B.direction);const j=1/ze(G);pe(G,G,j),o(Wr(B.origin,xl)*j,G,-1,!0,1,dme)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.vertexAttributes.get(P.POSITION),l=e.vertexAttributes.get(P.SIZE),c=this.parameters,h=z9(c);let d=1,f=1;if(b(e.shaderTransformer)){const g=e.shaderTransformer(pme);d=g[0],f=g[5]}d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=pSt*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],x=a.data[y+1],S=g*l.size;zv[0]=l.data[S]*d,zv[1]=l.data[S+1]*f;let E=0;c.textureIsSignedDistanceField&&(E=c.outlineSize*e.screenToWorldRatio/2),hme(s,v,x,zv,m,E,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new ySt(this)}_normalAndViewAngle(e,i,r,s){return t2t(i)&&(i=jp(uSt,i)),th(s.normal,e,i),at(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=xe(A$e,fSt),s}_updateScaleInfo(e,i,r){const s=this.parameters;b(s.screenSizePerspective)?rme(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),b(s.screenSizePerspectiveAlignment)?rme(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,gj);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),b(n)&&ge(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ge(n,e);const c=Se(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return pe(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=ze(e),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=pe(xl,i.normal,o*a);return we(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=ze(e);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=ze(e),a=vt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=e$e(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),pe(i.normal,i.normal,l),we(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ge(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Re(sR,r),we(r,r,pe(sR,sR,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ge(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ge(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,i){if(i===H.Color||i===H.Alpha||i===H.Highlight||i===H.ObjectAndLayerIdColor){if(e===Ie.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:s}=this.parameters;return e===(r?Ie.LABEL_MATERIAL:Ie.HUD_MATERIAL)||s&&e===Ie.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new oSt(e)}calculateRelativeScreenBounds(e,i,r=bi()){return aSt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},oSt=class extends Wre{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(C$e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function aSt(t,e,i,r=cSt){return Ao(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function lSt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function hme(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),d=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&b(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),d-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<d}const fj=new s$e,cSt=je(),xl=$(),sR=$(),Ql=Ai(),A$e=$(),dme=$(),mj=Hs(),uSt=Hs(),hSt=Ge(),Eh=$(),gj={normal:A$e,cosAngle:0},pme=Ge(),dSt=1,pSt=2,zv=[0,0],fSt=Ve(0,0,1);let mSt=class extends mRe{constructor(){super(...arguments),this.renderOccluded=Ks.Occlude,this.color=di(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=nr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=di(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const O$e=qs().vec3f(P.POSITION).vec3f(P.NORMAL).vec2f(P.UV0).vec4u8(P.COLOR).vec2f(P.SIZE).vec4f(P.AUXPOS1).vec4f(P.AUXPOS2),gSt=O$e.clone().vec4u8(P.OBJECTANDLAYERIDCOLOR);let ySt=class{constructor(e){this._material=e,this.vertexBufferLayout=me("enable-feature:objectAndLayerId-rendering")?gSt:O$e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(P.POSITION).length}write(e,i,r,s,n){Ez(r.indices.get(P.POSITION),r.vertexAttributes.get(P.POSITION).data,e,s.position,n,6),qse(r.indices.get(P.NORMAL),r.vertexAttributes.get(P.NORMAL).data,i,s.normal,n,6);const o=r.vertexAttributes.get(P.UV0).data;let a,l,c,h;if(o==null||o.length<4){const x=this._material.parameters;a=0,l=0,c=x.texCoordScale[0],h=x.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let d=r.indices.get(P.POSITION).length,f=n;const m=s.uv0;for(let x=0;x<d;++x)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Wse(r.indices.get(P.COLOR),r.vertexAttributes.get(P.COLOR).data,4,s.color,n,6);const g=r.indices.get(P.SIZE),y=r.vertexAttributes.get(P.SIZE).data;d=g.length;const v=s.size;f=n;for(let x=0;x<d;++x){const S=y[2*g[x]],E=y[2*g[x]+1];for(let C=0;C<6;++C)v.set(f,0,S),v.set(f,1,E),f+=1}if(r.indices.get(P.AUXPOS1)&&r.vertexAttributes.get(P.AUXPOS1)?a3(r.indices.get(P.AUXPOS1),r.vertexAttributes.get(P.AUXPOS1).data,s.auxpos1,n,6):cme(s.auxpos1,n,6*d),r.indices.get(P.AUXPOS2)&&r.vertexAttributes.get(P.AUXPOS2)?a3(r.indices.get(P.AUXPOS2),r.vertexAttributes.get(P.AUXPOS2).data,s.auxpos2,n,6):cme(s.auxpos2,n,6*d),b(r.objectAndLayerIdColor)&&r.indices.get(P.POSITION)){const x=r.indices.get(P.POSITION).length,S=s.getField(P.OBJECTANDLAYERIDCOLOR,Gl);o$e(r.objectAndLayerIdColor,S,x,n,6)}}};const Qm=$(),yE=Ai(),nR=Ai(),yj=$(),_St=Ge(),vSt=to(),_j=ha(),bSt=$(),wSt=bi();class xSt{constructor(){this.aabr=bi(),this.distance=0,this.culled=!1,this.visible=!1}}class TSt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var zu;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(zu||(zu={}));class R$e{constructor(){this.camera=new jt,this.slicePlane=sv(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),RS(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let AM=class extends Ee{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new R$e,this._state=zu.Idle,this._active=new Map,this._visible=new Map,this._iterators=new MSt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==zu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/zu.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case zu.Idle:this._startUpdate(),t.madeProgress();case zu.Process:if(this._state=zu.Process,!this._processActiveGraphics(t))return;case zu.Sort:if(this._state=zu.Sort,!this._sortVisibleGraphics(t))return;case zu.Deconflict:if(this._state=zu.Deconflict,!this._deconflictVisibleGraphics(t))return;default:jTt(this,this._visible),this._state=zu.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(A(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof l3}_startUpdate(){HTt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new xSt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),SSt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=C3(_St,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?vSt:null;let s=0;for(b(r)&&(at(r,Fl,this._runningViewState.camera.viewMatrix),r[3]=ur(this.view.spatialReference).radius,s=dOe(r,Fl));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Fa.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),WTt(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=fme(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=fme(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=ESt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Fa.GRAPHIC,Ju.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);kp(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(A(a)){if(a=RSt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Qm)||b(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!_r.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}A(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;at(Qm,a,r.viewMatrix);const l=n.vertexAttributes,c=l.get(P.NORMAL).data,h=l.get(P.AUXPOS1).data;o.applyShaderOffsetsView(Qm,c,s.transformation,h,r,i.scaleInfo,Qm),Rr(yE,Qm[0],Qm[1],Qm[2],1),ld(nR,yE,r.projectionMatrix),pe(i.positionNDC,nR,1/nR[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,yj),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(yj[2]),i.distance=yj[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Rr(nR,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),ld(yE,nR,e),b3(yE,yE,1/yE[3]),fe(i.positionView,Qm[0],Qm[1],Qm[2])}_isCulledByHorizon(t,e,i){return ge(_j.direction,t.positionView),fe(_j.origin,0,0,0),!!xw(e,_j,bSt)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Ire(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(ASt);VIe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=bU(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,wSt),ei(0,n.fullWidth,.5+.5*r[0]),ei(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(od(a),Om(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Mb(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this._accBinsSizeX);r<=Math.floor(i.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,Jk(l.aabr,i.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new vi)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(Ju.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===Fa.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function SSt(t,e){const i=t.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(Ju.DECONFLICTION,e)}function*fme(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*ESt(t,e,i){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.hasVisibilityFlag(Ju.DECONFLICTION,i),o.prio=s.info?s.info[i].distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([p({constructOnly:!0})],AM.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],AM.prototype,"updating",null),AM=u([N("esri.views.3d.layers.graphics.Deconflictor")],AM);class CSt{}class MSt{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new vi({allocator:s=>s||new CSt})}}const ASt=je();class OSt{constructor(){this.positionView=$(),this.positionNDC=$(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new s$e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const RSt=new OSt,PSt=2e3;let a8=class extends AM{constructor(e){super(e),this.visibilityGroup=Fa.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return al.YIELD;const i=performance.now();if(e.state!==Ki.IDLE&&i-this._lastDeconfliction<PSt)return al.YIELD;super.runTask(e),this.state===zu.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],a8.prototype,"parent",void 0),a8=u([N("esri.views.3d.layers.graphics.LabelDeconflictor")],a8);let MK=class extends AM{constructor(){super(...arguments),this._handles=new ir,this._contexts=new Map,this._viewState=new R$e,this.visibilityGroup=Fa.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ae(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),ae(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),ae(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},ii)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Nt.GRAPHICS_DECONFLICTOR,this),this._labels=new a8({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&vj(e));i.setVisibilityFlag(Ju.DECONFLICTION,r,Fa.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;b(e)&&MOe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=b(e)}_slicePlaneChanged(){ua(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new TSt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),vj(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=vj(e);r||ISt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i||!i.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function vj(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function ISt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.clearVisibilityFlag(Ju.DECONFLICTION))}MK=u([N("esri.views.3d.layers.graphics.GraphicsDeconflictor")],MK);const iO=(t,e,i)=>[e,i],Yp=(t,e,i)=>[e,i,t[2]],rO=(t,e,i)=>[e,i,t[2],t[3]];function mme(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:b(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function lL({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function cL({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function Qse(t,e,i){const r=[];let s,n,o,a;for(let l=0;l<i.length;l++){const c=i[l];l>0?(o=lL(t,c[0]),a=cL(t,c[1]),o===s&&a===n||(r.push(e(c,o-s,a-n)),s=o,n=a)):(s=lL(t,c[0]),n=cL(t,c[1]),r.push(e(c,s,n)))}return r.length>0?r:null}function $St(t,e,i,r){return Qse(t,i?r?rO:Yp:r?Yp:iO,e)}function LSt(t,e,i,r){const s=[],n=i?r?rO:Yp:r?Yp:iO;for(let o=0;o<e.length;o++){const a=Qse(t,n,e[o]);a&&a.length>=3&&s.push(a)}return s.length?s:null}function DSt(t,e,i,r){const s=[],n=i?r?rO:Yp:r?Yp:iO;for(let o=0;o<e.length;o++){const a=Qse(t,n,e[o]);a&&a.length>=2&&s.push(a)}return s.length?s:null}function P$e({scale:t,translate:e},i){return i*t[0]+e[0]}function I$e({scale:t,translate:e},i){return e[1]-i*t[1]}function $$e(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=t.scale;let o=P$e(t,i[0][0]),a=I$e(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=e(c,o,a)}return r}function L$e(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=$$e(t,e,i[s]);return r}function NSt(t,e,i,r){return $$e(t,i?r?rO:Yp:r?Yp:iO,e)}function FSt(t,e,i,r){return L$e(t,i?r?rO:Yp:r?Yp:iO,e)}function USt(t,e,i,r){return L$e(t,i?r?rO:Yp:r?Yp:iO,e)}function kSt(t,e,i,r,s){return e.xmin=lL(t,i.xmin),e.ymin=cL(t,i.ymin),e.xmax=lL(t,i.xmax),e.ymax=cL(t,i.ymax),e!==i&&(r&&(e.zmin=i.zmin,e.zmax=i.zmax),s&&(e.mmin=i.mmin,e.mmax=i.mmax)),e}function VSt(t,e,i,r,s){return e.points=$St(t,i.points,r,s)??[],e}function zSt(t,e,i,r,s){return e.x=lL(t,i.x),e.y=cL(t,i.y),e!==i&&(r&&(e.z=i.z),s&&(e.m=i.m)),e}function BSt(t,e,i,r,s){const n=LSt(t,i.rings,r,s);return n?(e.rings=n,e):null}function GSt(t,e,i,r,s){const n=DSt(t,i.paths,r,s);return n?(e.paths=n,e):null}function qKt(t,e){return t&&e?Bk(e)?zSt(t,{},e,!1,!1):ZL(e)?GSt(t,{},e,!1,!1):v_(e)?BSt(t,{},e,!1,!1):zk(e)?VSt(t,{},e,!1,!1):XL(e)?kSt(t,{},e,!1,!1):null:null}function D$e(t,e,i,r,s){return b(i)&&(e.points=NSt(t,i.points,r,s)),e}function N$e(t,e,i,r,s){return A(i)||(e.x=P$e(t,i.x),e.y=I$e(t,i.y),e!==i&&(r&&(e.z=i.z),s&&(e.m=i.m))),e}function F$e(t,e,i,r,s){return b(i)&&(e.rings=USt(t,i.rings,r,s)),e}function U$e(t,e,i,r,s){return b(i)&&(e.paths=FSt(t,i.paths,r,s)),e}let WKt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function XKt(t){return b(t.geometry)}let ZKt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function KKt(t){var n;const e=k2.fromJSON(t.geometryType),i=Ye.fromJSON(t.spatialReference),r=t.transform,s=t.features.map(o=>{const a=jSt(o,e,i,t.objectIdFieldName),l=a.geometry;if(b(l)&&r)switch(l.type){case"point":a.geometry=N$e(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=D$e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=F$e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=U$e(r,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:i,fields:((n=t.fields)==null?void 0:n.map(o=>R3.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function jSt(t,e,i,r){return{uid:nh(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:HSt(t.geometry,e,i),visible:!0}}function HSt(t,e,i){if(A(t))return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function bc(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function qSt(t){if(A(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=cN(t.vertexAttributes.position),e+=cN(t.vertexAttributes.normal),e+=cN(t.vertexAttributes.uv),e+=cN(t.vertexAttributes.tangent)}return e}function QKt(t){let e=32;return e+=mSe(t.attributes),e+=3,e+=8+qSt(t.geometry),e}function WSt(t){if(A(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function eQt(t){if(A(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function tQt(t,e){switch(ls(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)YB(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)YB(e,t.rings[i],!!t.hasZ);break;case"multipoint":YB(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function YSt(t,e){switch(kp(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)WB(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)WB(e,t.rings[i]);break;case"multipoint":WB(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function iQt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function k$e(t){return"declaredClass"in t}function gme(t){return"declaredClass"in t}function XSt(t){return"declaredClass"in t}function ZSt(t,e){return t?XSt(t)?t:new Ho({layer:e,sourceLayer:e,visible:t.visible,symbol:ue(t.symbol),attributes:ue(t.attributes),geometry:V$e(t.geometry)}):null}function V$e(t){return A(t)?null:k$e(t)?t:Mm(JSt(t))}function JSt(t){const{wkid:e,wkt:i,latestWkid:r}=t.spatialReference,s={wkid:e,wkt:i,latestWkid:r};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:yme(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:yme(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:g}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:g,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:B$e(n)?z$e(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function yme(t){return KSt(t)?t.map(e=>z$e(e)):t}function z$e(t){return t.map(e=>Array.from(e))}function KSt(t){for(const e of t)if(e.length!==0)return B$e(e);return!1}function B$e(t){return t.length>0&&(oee(t[0])||aee(t[0]))}function QSt(t,e){if(!t)return null;let i;if(gme(t)){if(e==null)return t.clone();if(gme(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=bc(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function rQt(t){const{wkid:e,wkt:i,latestWkid:r}=t,s={wkid:e,wkt:i,latestWkid:r};return Ye.fromJSON(s)}const bj=le.getLogger("esri.layers.support.labelFormatUtils"),wj={type:"simple",evaluate:()=>null},eEt={getAttribute:(t,e)=>t.field(e)};async function G$e(t,e,i){if(!t||!t.symbol||!e)return wj;const r=t.where,s=LV(t),n=r?await se(()=>Promise.resolve().then(()=>ooe),void 0):null;let o;if(s.type==="arcade"){const a=await EXe(s.expression,i,e);if(A(a))return wj;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{bj.error(new J("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>Zie(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[h.name]):d=a.field(h.name),d==null?"":j$e(d,h)})};if(r){let a;try{a=n.WhereClause.create(r,e)}catch(c){return bj.error(new J("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),wj}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:eEt;try{if(a.testFeature(c,h))return l(c)}catch(d){bj.error(new J("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:d}))}return null}}return o}function j$e(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+t,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=t;return e.type==="date"||e.type==="esriFieldTypeDate"?r=Ty(r,Hk("short-date")):jk(e)&&(r=_d(+r)),r||""}const sQt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:G$e,formatField:j$e},Symbol.toStringTag,{value:"Module"}));let H$e=class{constructor(e=null,i="center",r="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,d=0){this.verticalOffset=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=d}};function ene(t,e){if(t.type==="point")return Bv(t,e,!1);if(k$e(t))switch(t.type){case"extent":return Bv(t.center,e,!1);case"polygon":return Bv(t.centroid,e,!1);case"polyline":return Bv(_me(t),e,!0);case"mesh":return Bv(t.origin,e,!1)}else switch(t.type){case"extent":return Bv(tEt(t),e,!0);case"polygon":return Bv(iEt(t),e,!0);case"polyline":return Bv(_me(t),e,!0)}}function _me(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=Kwe(e,Jwe(e)/2);return bc(i[0],i[1],i[2],t.spatialReference)}function tEt(t){return bc(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function iEt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=ste(t.rings,!!t.hasZ);return bc(i[0],i[1],i[2],t.spatialReference)}function Bv(t,e,i){const r=i?t:QSt(t);return e&&t?AKe(t,r,e)?r:null:r}function oQt(t,e,i,r=0){if(t){e||(e=bi());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Rr(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function q$e(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(P.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[i]))}}function ZI(t,e){const i=uD(Tp);return b(t)&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),b(e)?i[3]=e:b(t)&&t.length>3&&(i[3]=t[3]),i}function aQt(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)b(t)&&t[o]!=null?n[o]=t[o]:b(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return b(e)?n[3]=e:b(r)?n[3]=r:n[3]=s[3],n}function vme(t=ey,e,i,r=1){const s=new Array(3);if(A(e)||A(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,d=a===0&&!n&&!h,f=i[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Qc(s)}function rEt(t){return t.isPrimitive!=null}function Iz(t){return B9(rEt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function B9(t){if(Array.isArray(t)){for(const e of t)if(!B9(e))return!1;return!0}return t==null||t>=0}function sEt(t,e,i,r=Ge()){const s=t||0,n=e||0,o=i||0;return s!==0&&FA(r,r,-s/180*Math.PI),n!==0&&NA(r,r,n/180*Math.PI),o!==0&&lV(r,r,o/180*Math.PI),r}function tne(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Ec(e),s=wS(t)*r,n=xS(t)*r,o=bw(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}function W$e(t,e,i,r,s,n,o,a,l,c,h){const d=dEt[h.mode];let f,m,g=0;if(un(t,e,i,r,l.spatialReference,s,a))return d.requiresAlignment(h)?(g=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),un(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function sO(t,e,i,r,s){const n=(P9(t)?t.z:mIe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=vt(iy(e,t,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=vt(iy(e,t,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=vt(iy(e,t,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=vt(iy(e,t,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function nEt(t,e,i,r){return sO(t,e,i,r,OM),OM.z}function $D(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?cn.UPDATE:t.onTheGroundChanged}function Xp(t){return t==="relative-to-ground"||t==="relative-to-scene"}function hw(t){return t!=="absolute-height"}function oEt(t,e,i,r,s){sO(e,i,s,r,OM),q$e(t,OM.verticalDistanceToGround);const n=OM.sampledElevation,o=Bo(pEt,t.transformation);return QF[0]=e.x,QF[1]=e.y,QF[2]=OM.z,Rm(e.spatialReference,QF,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function aEt(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e+0],h=t[e+1],d=t[e+2],f=vt(n.getElevation(c,h,d,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/s}function lEt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e+0],g=t[e+1],y=t[e+2],v=vt(n.getElevation(m,g,y,d,"ground"),0);l+=v,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?y+v+c:v+c,e+=3,r+=3}return l/s}function cEt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e+0],g=t[e+1],y=t[e+2],v=vt(n.getElevation(m,g,y,d,"scene"),0);l+=v,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?y+v+c:v+c,e+=3,r+=3}return l/s}function uEt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function hEt(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const d=t[e+0],f=t[e+1],m=t[e+2];i[r+0]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let LD=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var cn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(cn||(cn={}));const dEt={"absolute-height":{applyElevationAlignmentBuffer:hEt,requiresAlignment:uEt},"on-the-ground":{applyElevationAlignmentBuffer:aEt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:lEt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:cEt,requiresAlignment:()=>!0}},pEt=Ge(),OM=new LD,QF=$();function ine(t){return b(t.mapPositions)}function Y$e(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!ine(l))continue;const{update:c,averageGeometrySampledElevation:h}=Z$e(l,e,i,r,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function uL(t,e,i,r,s){var d;const n=t.stageObject,o=e.centerPointInElevationSR;let a=0;(d=n.metadata)!=null&&d.usesVerticalDistanceToGround?(r(o,iu),q$e(n,iu.verticalDistanceToGround),a=iu.sampledElevation):(r(o,iu),e.mode!=="absolute-height"&&(a=iu.sampledElevation));const l=Bo(fEt,n.transformation),c=fe(X$e,l[12],l[13],l[14]);_r.TESTS_DISABLE_OPTIMIZATIONS?(tu[0]=o.x,tu[1]=o.y,tu[2]=iu.z,Rm(o.spatialReference,tu,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(iu.z,l);const h=rne/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),a}const fEt=Ge();function mEt(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(A(n))return 0;const o=e.centerPointInElevationSR;r(o,iu);const a=e.mode!=="absolute-height"?iu.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=yEt;l.getGlobalTransform(c,h);const d=fe(X$e,h[12],h[13],h[14]);_r.TESTS_DISABLE_OPTIMIZATIONS?(tu[0]=o.x,tu[1]=o.y,tu[2]=iu.z,Rm(o.spatialReference,tu,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(iu.z,h);const f=rne/s.unitInMeters;return(_r.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function gEt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!ine(d))continue;const f=d.vertexAttributes.get(P.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=Z$e(d,e,i,r,s);c=g,l=f,h=m}h&&n.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const rne=.01,tu=$(),$d=$(),_E=$(),yEt=Ge(),X$e=$(),iu=new LD;function Z$e(t,e,i,r,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;$d[0]=o[12],$d[1]=o[13],$d[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(P.POSITION),c=l.data,h=l.size,d=c.length/h,f=new fIe(t.mapPositions,i);let m=0,g=0;for(let y=0;y<d;y++){if(_E[0]=c[m],_E[1]=c[m+1],_E[2]=c[m+2],r(f,iu),a&&(g+=iu.sampledElevation),_r.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=iu.z,un(c,i,m,c,s.spatialReference,m,1),c[m]-=$d[0],c[m+1]-=$d[1],c[m+2]-=$d[2],n=!0;else{tu[0]=c[m]+$d[0],tu[1]=c[m+1]+$d[1],tu[2]=c[m+2]+$d[2],s.setAltitude(tu,iu.z),c[m]=tu[0]-$d[0],c[m+1]=tu[1]-$d[1],c[m+2]=tu[2]-$d[2];const v=rne/s.unitInMeters;(Math.abs(_E[0]-c[m])>=v||Math.abs(_E[1]-c[m+1])>=v||Math.abs(_E[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}const _Et=le.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function vEt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function cQt(t){const e=t&&t.expression;if(typeof e=="string"){const i=Q$e(e);if(i!=null)return{cachedResult:i}}return null}async function uQt(t,e,i,r){const s=t&&t.expression;if(typeof s!="string")return null;const n=Q$e(s);if(n!=null)return{cachedResult:n};const o=await Am();_i(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function J$e(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function sne(t,e){if(t!=null&&!K$e(t)){if(!e||!t.arcade)return void _Et.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=V$e(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function bEt(t){if(t!=null){if(K$e(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function hQt(t,e=!1){let i=t&&t.featureExpressionInfo;const r=i&&i.expression;return e||r==="0"||(i=null),i??null}const wEt={cachedResult:0};function K$e(t){return t.cachedResult!=null}function Q$e(t){return t==="0"?0:null}let zm=class eLe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=SCe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=bEt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=bat(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=vt(e.offset,0)}updateFeatureExpressionInfoContext(e,i,r){if(A(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&b(i)&&b(r)?(this._featureExpressionInfoContext=vEt(e),sne(this._featureExpressionInfoContext,J$e(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new eLe;return b(e)&&i.setFromElevationInfo(e),i}},xEt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var Si;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Si||(Si={}));let TEt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},zy=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,i){this._stageLayer=i,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),b(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,i){if(A(this._edgeState))return;const r=bme(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){A(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),b(this._edgeState))){const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;b(r)&&sne(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>sO(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this._resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this._resetEdgeObject(r)}getCenterObjectSpace(e=$()){return ge(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Mo()){const i=this.stageObject.boundingVolumeObjectSpace;return Zxe(e,i.min),Jxe(e,i.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++}else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(o0)&&(at(o0,o0,this.stageObject.transformation),we(e.render.origin,e.render.origin,o0),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=SEt,l=Ste(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];Gv[0]=o[d[0]],Gv[1]=o[d[1]],Gv[2]=o[d[2]],at(Gv,Gv,this.stageObject.transformation),Jw[3*h+0]=Gv[0],Jw[3*h+1]=Gv[1],Jw[3*h+2]=Gv[2]}if(!e(Jw,0,l))return null;ls(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Jw[h+d]),o[d+3]=Math.max(o[d+3],Jw[h+d]);c&&r.push({location:Jw.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){rm(o,o0);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=vt(i.service.getElevation(o0[0],o0[1],h),0);else try{const f=tne(o,i.service.spatialReference,i);d=vt(await i.service.queryElevation(o0[0],o0[1],s,f,h),0)}catch{}Xxe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===q_.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===q_.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(A(this._edgeState))return;const i=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(A(r))return;const s=bme(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function bme(t){return t.isVisible()?t.parameters.transparent?Si.TRANSPARENT:Si.OPAQUE:Si.INVISIBLE}const Jw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Gv=$(),o0=$(),SEt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let tLe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=vt(e,0)}};var To;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})(To||(To={}));let nne=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=td.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===td.LOADED?(e&&e(),vt(this._loader,Promise.resolve())):this._loadStatus===td.FAILED?(i&&i(this._loadError),vt(this._loader,Promise.resolve())):(A(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=td.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=td.FAILED,!kn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){b(this._abortController)?this._abortController=lu(this._abortController):this._loadStatus===td.LOADING&&(this._loadStatus=td.FAILED),this._loader=null}};var td;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(td||(td={}));const iLe=3,AK=3,rLe=10;let sLe=class{constructor(e,i=null){this.geometry=e,this.textures=i}};function e4(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),NL(e)}function wme(t){const e=new Array;return t.levels.forEach(i=>{i.components.forEach(r=>{b(r.textures)&&e.push(...r.textures)})}),NL(e)}function nLe(t){const e=t.components.map(i=>i.geometry);return NL(e)}function xme(t){const e=[];return t.levels.forEach(i=>{i.components.forEach(r=>{e.push(r.geometry)})}),NL(e)}function EEt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function oLe(t,e){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&Ovt(a),{components:[new sLe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Evt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>gvt(e,1));case"cone":return i(xj,r=>Bpe(e,1,.5,r,!1),!0);case"inverted-cone":return i(xj,r=>Bpe(e,1,.5,r,!0),!0);case"cylinder":return i(xj,r=>Mvt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Svt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>bvt(e,1),!0);default:return}}const xj=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function CEt(t){return t.type==="fill"}function MEt(t){return t.type==="extrude"}function AEt(t){return t&&t.enabled&&(MEt(t)||CEt(t))&&b(t.edges)}function OEt(t){return t&&t.enabled&&t.edges||null}function aLe(t,e){return REt(OEt(t),e)}function REt(t,e){if(A(t))return null;const i=b(t.color)?Rie(et.toUnitRGBA(t.color)):di(0,0,0,0),r=ka(t.size),s=ka(t.extensionLength);switch(t.type){case"solid":return PEt({color:i,size:r,extensionLength:s,...e});case"sketch":return IEt({color:i,size:r,extensionLength:s,...e});default:return}}function PEt(t){return{...$Et,...t,type:"solid"}}function IEt(t){return{...LEt,...t,type:"sketch"}}const $Et={color:di(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Si.OPAQUE,hasSlicePlane:!1},LEt={color:di(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Si.OPAQUE,hasSlicePlane:!1},one={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function _Qt(t){return t.type==="web-style"?one:ane(t.symbolLayers.toArray().map(e=>lLe(t,e)))}function ane(t){let e=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)A(a)||(e+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function vQt(t){const e=ane(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const Tme={};function lLe(t,e){const i=cLe(t,e),r=AEt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:b(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...DEt(e.resource&&e.resource.primitive||oTe),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=rLe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=iLe;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(AK-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function cLe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Rc.EXTRUDE_EDGES:Rc.EXTRUDE;case"fill":return b(e.outline)&&e.outline.size>0?Rc.FILL_OUTLINE:Rc.FILL;case"water":return Rc.FILL;case"line":return e.join==="round"?Rc.LINE_ROUND:Rc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Rc.PATH_ROUND_CIRCLE;case"quad":return Rc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Rc.PATH_MITER_CIRCLE;case"quad":return Rc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Rc.OBJECT_POINT:Rc.OBJECT_POLYGON;case"icon":case"text":return i?Rc.ICON_POINT:Rc.ICON_POLYGON;default:return}}function DEt(t){let e=Tme[t];if(e)return e;const i=oLe(t,null);return e={primitivesPerFeature:nLe(i.levels[0]).reduce((r,s)=>r+s.indices.get(P.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Tme[t]=e,e}const Rc={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},vE=le.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let By=class extends nne{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=vE,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new zm,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Sme(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Sme(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&vE.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(vE.warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(vE.warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(b(i)&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return vE.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return NEt}_defaultElevationInfoZ(){return FEt}_updateElevationContext(){b(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=vt(this._elevationContext.meterUnitOffset,vt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?wEt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=Eme){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(b(e)?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=Eme){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return ZI(null,r);const s=b(e)?et.toUnitRGB(e):ey;return ZI(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=ZI(r,s);return b(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return lLe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==cn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,i,r){let s=cn.UPDATE;return e.forEach(n=>{const o=i(n);if(b(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=cn.RECREATE}),s}applyRendererDiff(e,i){return To.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?M_(i.size.field,e):0,s=i.color?M_(i.color.field,e):0,n=i.opacity?M_(i.opacity.field,e):0;return di(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&vE.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c,h,d,f,m;return{size:((s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)??null,color:((a=(o=(n=this._fastUpdates)==null?void 0:n.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((m=(f=(d=this._fastUpdates)==null?void 0:d.visualVariables)==null?void 0:f.rotation)==null?void 0:m.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function M_(t,e){const i=t!=null?e.attributes[t]:0;return i!=null&&isFinite(i)?i:0}function Sme(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const NEt={mode:"on-the-ground",offset:0,unit:"meters"},FEt={mode:"absolute-height",offset:0,unit:"meters"},Eme={hasIntrinsicColor:!1};let mv=class extends MD{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){Bo(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=xn.Object,this._geometries=new Array,this._transformation=Ge(),this._bvObjectSpace=new Cme,this._bvWorldSpace=new Cme,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new uLe);const i=e.geometries;b(i)&&(this._geometries=Array.from(i))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Rt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("objectGeometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new v9(q_.MaskOccludee);for(const i of this._geometries)i.occludees=rK(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=sK(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new v9(q_.Highlight);for(const i of this._geometries)i.highlights=rK(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=sK(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return ln(i,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return ln(Ge(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;b(n)&&(Mme(n,this._bvObjectSpace,s.shaderTransformation),Mme(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}En(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),En(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=$(),i=$(),r=K2(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(A(n))continue;const o=s.shaderTransformation,a=K2(o);at(e,n.center,o);const l=Wr(e,this._bvObjectSpace.bounds),c=n.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),at(i,e,this.transformation);const h=Wr(i,this._bvWorldSpace.bounds),d=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+d)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,b(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,i){b(this._parentLayer)&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},uLe=class{constructor(){this.min=Ve(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ve(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Cme=class extends uLe{constructor(){super(...arguments),this.bounds=to()}init(){fe(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),fe(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),cOe(this.bounds)}};function Mme(t,e,i){const r=t.bbMin,s=t.bbMax;if(hV(i)){const n=fe(UEt,i[12],i[13],i[14]);we(Ch,r,n),we(hf,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Ch[o]),e.max[o]=Math.max(e.max[o],hf[o])}else if(at(Ch,r,i),Ur(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Ch[n]),e.max[n]=Math.max(e.max[n],Ch[n]);else{at(hf,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Ch[n],hf[n]),e.max[n]=Math.max(e.max[n],Ch[n],hf[n]);for(let n=0;n<3;++n){ge(Ch,r),ge(hf,s),Ch[n]=s[n],hf[n]=r[n],at(Ch,Ch,i),at(hf,hf,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Ch[o],hf[o]),e.max[o]=Math.max(e.max[o],Ch[o],hf[o])}}}const UEt=$(),Ch=$(),hf=$();function lne(t,e,i,r,s,n){const o=t.clippingExtent;if(ll(e,Sb,t.elevationProvider.spatialReference),b(o)&&!xte(o,Sb))return null;ll(e,Sb,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(Sb),l=new mv({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return i.shaderTransformer=n,i.localOrigin=a,l.addGeometry(i),{object:l,sampledElevation:oEt(l,e,t.elevationProvider,t.renderCoordsHelper,r)}}function hL(t,e,i){const r=t.elevationContext,s=i.spatialReference;ll(e,Sb,s),r.centerPointInElevationSR=bc(Sb[0],Sb[1],e.hasZ?Sb[2]:0,b(s)?s:null)}function dL(t){switch(t.type){case"point":return t;case"polygon":case"extent":return ene(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=Kwe(e,Jwe(e)/2);return bc(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const Sb=$();function kEt(t){const e=new ar;e.include(dse),e.include(XIe,t),e.include(Un,t),e.attributes.add(P.UV0,"vec2");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Ni("viewport",(s,n)=>n.camera.fullViewport),new Be("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new hr("pixelToNDC",(s,n)=>Vt(Ome,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Be("borderSize",(s,n)=>b(s.borderColor)?n.camera.pixelRatio:0),new hr("screenOffset",(s,n)=>Vt(Ome,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&Sz(i),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new Ni("uColor",s=>Ame(s.color)),new Ni("borderColor",s=>Ame(s.borderColor))]),t.hasMultipassGeometry&&(r.include(ERe,t),r.uniforms.add(new hr("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(T`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Ame(t){return b(t)?t:fy}const Ome=je(),VEt=Object.freeze(Object.defineProperty({__proto__:null,build:kEt},Symbol.toStringTag,{value:"Module"}));let hLe=class dLe extends dr{initializeConfiguration(e,i){i.spherical=e.viewingMode===it.Global}initializeProgram(e){return new cr(e.rctx,dLe.shader.get().build(this.configuration),rr)}setPipelineState(e){const i=e?hs.ALWAYS:hs.LESS;return this.configuration.depthHudEnabled?si({depthTest:{func:i},depthWrite:gu}):si({blending:qo(Ne.ONE,Ne.SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:wi})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};hLe.shader=new lr(VEt,()=>se(()=>import("./LineCallout.glsl-247c40fe.js"),[]));let Qd=class extends ca{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=su.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([X({count:su.COUNT})],Qd.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([X()],Qd.prototype,"spherical",void 0),u([X()],Qd.prototype,"occlusionTestEnabled",void 0),u([X()],Qd.prototype,"hasVerticalOffset",void 0),u([X()],Qd.prototype,"hasScreenSizePerspective",void 0),u([X()],Qd.prototype,"depthHudEnabled",void 0),u([X()],Qd.prototype,"depthHudAlignStartEnabled",void 0),u([X()],Qd.prototype,"hasSlicePlane",void 0),u([X()],Qd.prototype,"hasMultipassGeometry",void 0),u([X({constValue:!0})],Qd.prototype,"hasSliceInVertexProgram",void 0),u([X({constValue:!1})],Qd.prototype,"isDraped",void 0);let t4=class OK extends Sw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new pLe),this._configuration=new Qd,this._uniqueMaterialIdentifier=OK.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Ie.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=b(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=b(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?su.Screen:su.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,i){if(i===H.Color)switch(e){case Ie.LINE_CALLOUTS:case Ie.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new zEt(e)}createBufferWriter(){return new GEt}validateParameters(e){const i=OK.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},zEt=class extends Tw{beginSlot(e){return this.ensureTechnique(hLe,e)}},pLe=class extends tO{constructor(){super(...arguments),this.screenOffset=mu,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const BEt=qs().vec3f(P.POSITION).vec3f(P.NORMAL).vec2f(P.UV0).vec4f(P.AUXPOS1),Rme=[yp(0,0),yp(1,0),yp(0,1),yp(1,0),yp(1,1),yp(0,1)];let GEt=class{constructor(){this.vertexBufferLayout=BEt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(P.POSITION).length}write(e,i,r,s,n){Ez(r.indices.get(P.POSITION),r.vertexAttributes.get(P.POSITION).data,e,s.position,n,6),qse(r.indices.get(P.NORMAL),r.vertexAttributes.get(P.NORMAL).data,i,s.normal,n,6),a3(r.indices.get(P.AUXPOS1),r.vertexAttributes.get(P.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Rme.length;++o)s.uv0.setVec(n+o,Rme[o])}},fLe=class mLe extends By{constructor(e,i){super(e,null,i,qEt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new t4(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.screenOffset=e.screenOffset||mu,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new pLe,i=this.symbol,r=i.callout;if(e.color=b(r.color)?et.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ka(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:ka(o),minWorldLength:a||0,maxWorldLength:b(l)?l:1/0}}e.borderColor=b(r.border)&&b(r.border.color)?et.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.getItemAt(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return HEt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new zm,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!dTe(l)))return null;const a=ene(r.geometry);return A(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){b(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=$D(mLe.elevationModeChangeTypes,r,s);return n!==cn.UPDATE||e.forEach(o=>{const a=i(o);b(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return A(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,i,r=0){const s=super.setGraphicElevationContext(e,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,b(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Xp(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:one.memory}}_createVertexData(e){const{translation:i,centerOffset:r}=e,s=new ct(i?[i[0],i[1],i[2]]:[0,0,0],3,!0),n=new ct(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[P.POSITION,s],[P.NORMAL,new ct([0,0,1],3,!0)],[P.AUXPOS1,n]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=t4.uniqueMaterialIdentifier(i);if(b(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(b(e.materialCollection)){let s=e.materialCollection.get(r);return A(s)&&(s=new t4(i),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new t4(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new qn(a.material,this._createVertexData(r),jEt,null,xn.Point,o),c=lne(this._context,e,l,i,s);if(A(c))return null;const h=new zy(this,c.object,[l],a.isUnique?[a.material]:null,null,uL,i);return h.metadata=new tLe(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Xp(i.mode),hL(h,e,this._context.elevationProvider),h}};fLe.elevationModeChangeTypes={definedChanged:cn.UPDATE,staysOnTheGround:cn.UPDATE,onTheGroundChanged:cn.RECREATE};const Tj=[0],jEt=[[P.POSITION,Tj],[P.NORMAL,Tj],[P.AUXPOS1,Tj]],HEt={mode:"relative-to-ground",offset:0},qEt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let WEt=class{constructor(e,i,r=$(),s=Ai(),n=je(),o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},YEt=class extends xEt{};const Pme=le.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function XEt(t,e){if(!Rte(t))return Pme.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=ZEt[t.callout.type];return i?new i(t,e):(Pme.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const ZEt={line:fLe},Ime=new pa(Array,t=>Kk(t,Kxe),null,10,5),JEt=bi();let KEt=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=QEt(Fa._COUNT,Ju._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?J$e(n,e,s):null;for(const o of r)b(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,i){this._layer=i,this._stage=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,i,r){this._labelLayers.push(e),e.initialize(i,r),e.setVisibility(this.isVisible(Fa.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Fa.GRAPHIC,i){for(let r=0;r<=e;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(e,i){return this._visibilityFlags[i][e]!=null}setVisibilityFlag(e,i,r){const s=this.isVisible(r);this._visibilityFlags[r][e]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===Fa.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Fa.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,i=Fa.GRAPHIC){return this.setVisibilityFlag(e,void 0,i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(A(i))return!1;this._extent=bi(),YSt(i,this._extent);const r=i.spatialReference;if(!us(r,e)&&!dV(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return b(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=kl.fromExtent(s.type==="mesh"?s.extent:s)),nnt(s,i,r)}get usedMemory(){let e=mSe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(A(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=WSt(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:$(),num:0},draped:{origin:je(),num:0}};for(const i of this.layers)A(i)||i.computeAttachmentOrigin(e);return e.render.num>1&&pe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&tl(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?ls(n.boundingBox):n.boundingBox=ls(),n.requiresDrapedElevation=!1,await $k(this.layers,async o=>{if(A(o))return;const a=o.type==="draped"?i:e,l=Ime.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&DA(n.boundingBox,l),Ime.release(l)}),UZe(n.boundingBox)||NW(Tte(n.boundingBox,JEt))?n:null}needsElevationUpdates(){for(const e of this.layers)if(b(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function QEt(t,e){const i=new Array(t);for(let r=0;r<i.length;r++)i[r]=new Array(e);return i}var $me,Lme,Dme,dw={},eCt={get exports(){return dw},set exports(t){dw=t}};$me=eCt,Lme=function(){function t(D,V,k){k=k||2;var Z,Q,ne,te,de,_e,Ce,Pe=V&&V.length,Ze=Pe?V[0]*k:D.length,Le=e(D,0,Ze,k,!0),Me=[];if(!Le||Le.next===Le.prev)return Me;if(Pe&&(Le=l(D,V,Le,k)),D.length>80*k){Z=ne=D[0],Q=te=D[1];for(var qe=k;qe<Ze;qe+=k)(de=D[qe])<Z&&(Z=de),(_e=D[qe+1])<Q&&(Q=_e),de>ne&&(ne=de),_e>te&&(te=_e);Ce=(Ce=Math.max(ne-Z,te-Q))!==0?1/Ce:0}return r(Le,Me,k,Z,Q,Ce),Me}function e(D,V,k,Z,Q){var ne,te;if(Q===Y(D,V,k,Z)>0)for(ne=V;ne<k;ne+=Z)te=ie(ne,D[ne],D[ne+1],te);else for(ne=k-Z;ne>=V;ne-=Z)te=ie(ne,D[ne],D[ne+1],te);if(te&&R(te,te.next)){var de=te.next;ee(te),te=de}return te}function i(D,V){if(!D)return D;V||(V=D);var k,Z=D;do if(k=!1,Z.steiner||!R(Z,Z.next)&&C(Z.prev,Z,Z.next)!==0)Z=Z.next;else{var Q=Z.prev;if(ee(Z),(Z=V=Q)===Z.next)break;k=!0}while(k||Z!==V);return V}function r(D,V,k,Z,Q,ne,te){if(D){!te&&ne&&g(D,Z,Q,ne);for(var de,_e,Ce=D;D.prev!==D.next;)if(de=D.prev,_e=D.next,ne?n(D,Z,Q,ne):s(D))V.push(de.i/k),V.push(D.i/k),V.push(_e.i/k),ee(D),D=_e.next,Ce=_e.next;else if((D=_e)===Ce){te?te===1?r(D=o(i(D),V,k),V,k,Z,Q,ne,2):te===2&&a(D,V,k,Z,Q,ne):r(i(D),V,k,Z,Q,ne,1);break}}}function s(D){var V=D.prev,k=D,Z=D.next;if(C(V,k,Z)>=0)return!1;for(var Q=D.next.next;Q!==D.prev;){if(S(V.x,V.y,k.x,k.y,Z.x,Z.y,Q.x,Q.y)&&C(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function n(D,V,k,Z){var Q=D.prev,ne=D,te=D.next;if(C(Q,ne,te)>=0)return!1;for(var de=Q.x<ne.x?Q.x<te.x?Q.x:te.x:ne.x<te.x?ne.x:te.x,_e=Q.y<ne.y?Q.y<te.y?Q.y:te.y:ne.y<te.y?ne.y:te.y,Ce=Q.x>ne.x?Q.x>te.x?Q.x:te.x:ne.x>te.x?ne.x:te.x,Pe=Q.y>ne.y?Q.y>te.y?Q.y:te.y:ne.y>te.y?ne.y:te.y,Ze=v(de,_e,V,k,Z),Le=v(Ce,Pe,V,k,Z),Me=D.prevZ,qe=D.nextZ;Me&&Me.z>=Ze&&qe&&qe.z<=Le;){if(Me!==D.prev&&Me!==D.next&&S(Q.x,Q.y,ne.x,ne.y,te.x,te.y,Me.x,Me.y)&&C(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,qe!==D.prev&&qe!==D.next&&S(Q.x,Q.y,ne.x,ne.y,te.x,te.y,qe.x,qe.y)&&C(qe.prev,qe,qe.next)>=0))return!1;qe=qe.nextZ}for(;Me&&Me.z>=Ze;){if(Me!==D.prev&&Me!==D.next&&S(Q.x,Q.y,ne.x,ne.y,te.x,te.y,Me.x,Me.y)&&C(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;qe&&qe.z<=Le;){if(qe!==D.prev&&qe!==D.next&&S(Q.x,Q.y,ne.x,ne.y,te.x,te.y,qe.x,qe.y)&&C(qe.prev,qe,qe.next)>=0)return!1;qe=qe.nextZ}return!0}function o(D,V,k){var Z=D;do{var Q=Z.prev,ne=Z.next.next;!R(Q,ne)&&O(Q,Z,Z.next,ne)&&G(Q,ne)&&G(ne,Q)&&(V.push(Q.i/k),V.push(Z.i/k),V.push(ne.i/k),ee(Z),ee(Z.next),Z=D=ne),Z=Z.next}while(Z!==D);return i(Z)}function a(D,V,k,Z,Q,ne){var te=D;do{for(var de=te.next.next;de!==te.prev;){if(te.i!==de.i&&E(te,de)){var _e=q(te,de);return te=i(te,te.next),_e=i(_e,_e.next),r(te,V,k,Z,Q,ne),void r(_e,V,k,Z,Q,ne)}de=de.next}te=te.next}while(te!==D)}function l(D,V,k,Z){var Q,ne,te,de=[];for(Q=0,ne=V.length;Q<ne;Q++)(te=e(D,V[Q]*Z,Q<ne-1?V[Q+1]*Z:D.length,Z,!1))===te.next&&(te.steiner=!0),de.push(x(te));for(de.sort(c),Q=0;Q<de.length;Q++)k=i(k=d(de[Q],k),k.next);return k}function c(D,V){return D.x-V.x}function h(D){if(D.next.prev===D)return D;let V=D;for(;;){const k=V.next;if(k.prev===V||k===V||k===D)break;V=k}return V}function d(D,V){var k=f(D,V);if(!k)return V;var Z=q(k,D),Q=i(k,k.next);let ne=h(Z);return i(ne,ne.next),Q=h(Q),h(V===k?Q:V)}function f(D,V){var k,Z=V,Q=D.x,ne=D.y,te=-1/0;do{if(ne<=Z.y&&ne>=Z.next.y&&Z.next.y!==Z.y){var de=Z.x+(ne-Z.y)*(Z.next.x-Z.x)/(Z.next.y-Z.y);if(de<=Q&&de>te){if(te=de,de===Q){if(ne===Z.y)return Z;if(ne===Z.next.y)return Z.next}k=Z.x<Z.next.x?Z:Z.next}}Z=Z.next}while(Z!==V);if(!k)return null;if(Q===te)return k;var _e,Ce=k,Pe=k.x,Ze=k.y,Le=1/0;Z=k;do Q>=Z.x&&Z.x>=Pe&&Q!==Z.x&&S(ne<Ze?Q:te,ne,Pe,Ze,ne<Ze?te:Q,ne,Z.x,Z.y)&&(_e=Math.abs(ne-Z.y)/(Q-Z.x),G(Z,D)&&(_e<Le||_e===Le&&(Z.x>k.x||Z.x===k.x&&m(k,Z)))&&(k=Z,Le=_e)),Z=Z.next;while(Z!==Ce);return k}function m(D,V){return C(D.prev,D,V.prev)<0&&C(V.next,D,D.next)<0}function g(D,V,k,Z){var Q=D;do Q.z===null&&(Q.z=v(Q.x,Q.y,V,k,Z)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==D);Q.prevZ.nextZ=null,Q.prevZ=null,y(Q)}function y(D){var V,k,Z,Q,ne,te,de,_e,Ce=1;do{for(k=D,D=null,ne=null,te=0;k;){for(te++,Z=k,de=0,V=0;V<Ce&&(de++,Z=Z.nextZ);V++);for(_e=Ce;de>0||_e>0&&Z;)de!==0&&(_e===0||!Z||k.z<=Z.z)?(Q=k,k=k.nextZ,de--):(Q=Z,Z=Z.nextZ,_e--),ne?ne.nextZ=Q:D=Q,Q.prevZ=ne,ne=Q;k=Z}ne.nextZ=null,Ce*=2}while(te>1);return D}function v(D,V,k,Z,Q){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-k)*Q)|D<<8))|D<<4))|D<<2))|D<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V=32767*(V-Z)*Q)|V<<8))|V<<4))|V<<2))|V<<1))<<1}function x(D){var V=D,k=D;do(V.x<k.x||V.x===k.x&&V.y<k.y)&&(k=V),V=V.next;while(V!==D);return k}function S(D,V,k,Z,Q,ne,te,de){return(Q-te)*(V-de)-(D-te)*(ne-de)>=0&&(D-te)*(Z-de)-(k-te)*(V-de)>=0&&(k-te)*(ne-de)-(Q-te)*(Z-de)>=0}function E(D,V){return D.next.i!==V.i&&D.prev.i!==V.i&&!B(D,V)&&(G(D,V)&&G(V,D)&&j(D,V)&&(C(D.prev,D,V.prev)||C(D,V.prev,V))||R(D,V)&&C(D.prev,D,D.next)>0&&C(V.prev,V,V.next)>0)}function C(D,V,k){return(V.y-D.y)*(k.x-V.x)-(V.x-D.x)*(k.y-V.y)}function R(D,V){return D.x===V.x&&D.y===V.y}function O(D,V,k,Z){var Q=L(C(D,V,k)),ne=L(C(D,V,Z)),te=L(C(k,Z,D)),de=L(C(k,Z,V));return Q!==ne&&te!==de||!(Q!==0||!U(D,k,V))||!(ne!==0||!U(D,Z,V))||!(te!==0||!U(k,D,Z))||!(de!==0||!U(k,V,Z))}function U(D,V,k){return V.x<=Math.max(D.x,k.x)&&V.x>=Math.min(D.x,k.x)&&V.y<=Math.max(D.y,k.y)&&V.y>=Math.min(D.y,k.y)}function L(D){return D>0?1:D<0?-1:0}function B(D,V){var k=D;do{if(k.i!==D.i&&k.next.i!==D.i&&k.i!==V.i&&k.next.i!==V.i&&O(k,k.next,D,V))return!0;k=k.next}while(k!==D);return!1}function G(D,V){return C(D.prev,D,D.next)<0?C(D,V,D.next)>=0&&C(D,D.prev,V)>=0:C(D,V,D.prev)<0||C(D,D.next,V)<0}function j(D,V){var k=D,Z=!1,Q=(D.x+V.x)/2,ne=(D.y+V.y)/2;do k.y>ne!=k.next.y>ne&&k.next.y!==k.y&&Q<(k.next.x-k.x)*(ne-k.y)/(k.next.y-k.y)+k.x&&(Z=!Z),k=k.next;while(k!==D);return Z}function q(D,V){var k=new K(D.i,D.x,D.y),Z=new K(V.i,V.x,V.y),Q=D.next,ne=V.prev;return D.next=V,V.prev=D,k.next=Q,Q.prev=k,Z.next=k,k.prev=Z,ne.next=Z,Z.prev=ne,Z}function ie(D,V,k,Z){var Q=new K(D,V,k);return Z?(Q.next=Z.next,Q.prev=Z,Z.next.prev=Q,Z.next=Q):(Q.prev=Q,Q.next=Q),Q}function ee(D){D.next.prev=D.prev,D.prev.next=D.next,D.prevZ&&(D.prevZ.nextZ=D.nextZ),D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function K(D,V,k){this.i=D,this.x=V,this.y=k,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Y(D,V,k,Z){for(var Q=0,ne=V,te=k-Z;ne<k;ne+=Z)Q+=(D[te]-D[ne])*(D[ne+1]+D[te+1]),te=ne;return Q}return t.deviation=function(D,V,k,Z){var Q=V&&V.length,ne=Q?V[0]*k:D.length,te=Math.abs(Y(D,0,ne,k));if(Q)for(var de=0,_e=V.length;de<_e;de++){var Ce=V[de]*k,Pe=de<_e-1?V[de+1]*k:D.length;te-=Math.abs(Y(D,Ce,Pe,k))}var Ze=0;for(de=0;de<Z.length;de+=3){var Le=Z[de]*k,Me=Z[de+1]*k,qe=Z[de+2]*k;Ze+=Math.abs((D[Le]-D[qe])*(D[Me+1]-D[Le+1])-(D[Le]-D[Me])*(D[qe+1]-D[Le+1]))}return te===0&&Ze===0?0:Math.abs((Ze-te)/te)},t.flatten=function(D){for(var V=D[0][0].length,k={vertices:[],holes:[],dimensions:V},Z=0,Q=0;Q<D.length;Q++){for(var ne=0;ne<D[Q].length;ne++)for(var te=0;te<V;te++)k.vertices.push(D[Q][ne][te]);Q>0&&(Z+=D[Q-1].length,k.holes.push(Z))}return k},t},(Dme=Lme())!==void 0&&($me.exports=Dme);const $z=le.getLogger("esri.views.3d.support.buffer.math");function DD(t,e,i){if(t.count!==e.count)return void $z.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],d=i[9],f=i[10],m=i[12],g=i[13],y=i[14],v=t.typedBuffer,x=t.typedBufferStride,S=e.typedBuffer,E=e.typedBufferStride;for(let C=0;C<r;C++){const R=C*x,O=C*E,U=S[O],L=S[O+1],B=S[O+2];v[R]=s*U+a*L+h*B+m,v[R+1]=n*U+l*L+d*B+g,v[R+2]=o*U+c*L+f*B+y}}function pw(t,e,i){if(t.count!==e.count)return void $z.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],d=i[7],f=i[8],m=t.typedBuffer,g=t.typedBufferStride,y=e.typedBuffer,v=e.typedBufferStride;for(let x=0;x<r;x++){const S=x*g,E=x*v,C=y[E],R=y[E+1],O=y[E+2];m[S]=s*C+a*R+h*O,m[S+1]=n*C+l*R+d*O,m[S+2]=o*C+c*R+f*O}}function RK(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function cne(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],d=n[c+1],f=n[c+2],m=h*h+d*d+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*d,r[l+2]=g*f}}}function tCt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:cne,scale:RK,shiftRight:tCt,transformMat3:pw,transformMat4:DD},Symbol.toStringTag,{value:"Module"}));function gLe(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function PK(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}function Lz(t,e){if(!t||t.symbol)return null;const i=e&&e.renderer;return t&&b(i)&&i.getObservationRenderer?i.getObservationRenderer(t):i}function iCt(t,e){if(b(t.symbol))return t.symbol;const i=Lz(t,e);return b(i)&&i.type!=="dot-density"?i.getSymbol(t,e):null}function PQt(t,e){const i=Lz(t,e),r=iCt(t,e);if(A(r))return null;const s={renderer:i,symbol:r};if(A(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=Cie(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function rCt(t,e){if(b(t.symbol))return t.symbol;const i=Lz(t,e);return b(i)?i.getSymbolAsync(t,e):null}async function IQt(t,e){const i=Lz(t,e),r=await rCt(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=Cie(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=et.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function sCt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function nCt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Nme(t){const e=[[P.POSITION,t.indices]],i=[[P.POSITION,new ct(t.attributeData.position,3,!0)]];return b(t.attributeData.color)&&(i.push([P.COLOR,new ct(t.attributeData.color,4,!0)]),e.push([P.COLOR,new Array(t.indices.length).fill(0)])),b(t.attributeData.uvMapSpace)&&(i.push([P.UVMAPSPACE,new ct(t.attributeData.uvMapSpace,4,!0)]),e.push([P.UVMAPSPACE,t.indices])),b(t.attributeData.boundingRect)&&(i.push([P.BOUNDINGRECT,new ct(t.attributeData.boundingRect,9,!0)]),e.push([P.BOUNDINGRECT,t.indices])),new qn(t.material,i,e,t.mapPositions,xn.Mesh,t.attributeData.objectAndLayerIdColor)}function Fme(t){const e=[[P.POSITION,t.indices],[P.UV0,t.indices]],i=[[P.POSITION,new ct(t.attributeData.position,3,!0)],[P.UV0,new ct(t.attributeData.uv0,2,!0)]];return new qn(t.material,i,e,t.mapPositions)}function pL(t){switch(t.type){case"extent":if(t instanceof ti)return kl.fromExtent(t);break;case"polygon":return t}return null}let Dz=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function IK(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let O=0;O<c.length-1;O++){const U=c[O+1]-c[O];U>h&&(h=U)}else h=s;const d=Math.floor(1.1*h)+1;(eg==null||eg.length<2*d)&&(eg=new Uint32Array(AA(2*d)));for(let O=0;O<2*d;O++)eg[O]=0;let f=0;const m=!!c&&!!a,g=m?l:s;let y=uPe(s/3);const v=new Uint32Array(l),x=1.96;let S=o!==0?Math.ceil(4*x*x/(o*o)*o*(1-o)):g,E=1,C=c?c[1]:g;for(let O=0;O<g;O++){if(O===S){const q=1-f/O;if(q+x*Math.sqrt(q*(1-q)/O)<o)return null;S*=2}if(O===C){for(let q=0;q<2*d;q++)eg[q]=0;if(a)for(let q=c[E-1];q<c[E];q++)v[q]=y[a[q]];C=c[++E]}const U=m?a[O]:O,L=U*e,B=lCt(n,L,e);let G=B%d,j=f;for(;eg[2*G+1]!==0;){if(eg[2*G]===B){const q=eg[2*G+1]-1;if(oCt(n,L,q*e,e)){j=y[q];break}}G++,G>=d&&(G-=d)}j===f&&(eg[2*G]=B,eg[2*G+1]=U+1,f++),y[U]=j}if(o!==0&&1-f/s<o)return null;if(m){for(let O=c[E-1];O<v.length;O++)v[O]=y[a[O]];y=iA(v)}const R=r?new Array(f):new Uint32Array(f*e);f=0;for(let O=0;O<g;O++)y[O]===f&&(aCt(n,(m?a[O]:O)*e,R,f*e,e),f++);if(a&&!m){const O=new Uint32Array(l);for(let U=0;U<O.length;U++)O[U]=y[a[U]];y=iA(O)}return{buffer:Array.isArray(R)?R:R.buffer,indices:y,uniqueCount:f}}function oCt(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function aCt(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function lCt(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let eg=null;function LQt(t){const e=ND(t.rings,t.hasZ,Ry.CCW_IS_HOLE),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Ip(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=new Uint32Array(dw(h,d,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=cCt(i,r,s),o=Array.isArray(n.position)?IK(n.position,3,{originalIndices:n.faces}):IK(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function cCt(t,e,i){if(t.length===1)return t[0];const r=fh(e),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function ND(t,e,i){const r=t.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=t[m].length;const d=fh(3*h);let f=0;for(let m=r-1;m>=0;m--){const g=t[m],y=i===Ry.CCW_IS_HOLE&&uCt(g);if(y&&r!==1)s[a++]=g;else{let v=g.length;for(let S=0;S<a;++S)v+=s[S].length;const x={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};x.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=y?i4(g,g.length-1,-1,d,f,g.length,e):i4(g,0,1,d,f,g.length,e);for(let S=0;S<a;++S){const E=s[S];x.holeIndices[S]=f,x.pathLengths[S+1]=E.length,E.length>0&&(o[c++]={index:f,count:E.length}),f=i4(E,0,1,d,f,E.length,e)}a=0,x.count>0&&(n[l++]=x)}}for(let m=0;m<a;++m){const g=s[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=i4(g,0,1,d,f,g.length,e)}return n.length=l,o.length=c,{position:d,polygons:n,outlines:o}}function i4(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function uCt(t){return!rte(t,!1,!1)}var Ry;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ry||(Ry={}));var JI,G9,$K;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(JI||(JI={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(G9||(G9={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}($K||($K={}));var ks,_p,Ht,KI,an,go,Rl;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(ks||(ks={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(_p||(_p={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(Ht||(Ht={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(KI||(KI={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(an||(an={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(go||(go={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(Rl||(Rl={}));let hCt=class{constructor(e,i){this.vec3=e,this.id=i}};function QI(t,e,i,r){return new hCt(Ve(t,e,i),r)}var Kc;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Kc||(Kc={}));let Ume=class{get extent(){return this._extent}constructor(e,i){this.index=e,this.renderTargets=i,this._extent=bi(),this.resolution=0,this.renderLocalOrigin=QI(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new dCt,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const i=e===Kc.ColorAndWater?this.renderTargets.getTarget(an.Color):e===Kc.Highlight?this.renderTargets.getTarget(an.Highlight):e===Kc.ObjectAndLayerIdColor?this.renderTargets.getTarget(an.ObjectAndLayerIdColor):this.renderTargets.getTarget(an.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(an.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(an.Color):null}getNormalTexture(e){const i=e===Kc.ColorAndWater?this.renderTargets.getTarget(an.Water):null;return i?i.getTexture():null}draw(e,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==an.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?e3.CHANGED:e3.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[an.Color]|+e[an.ColorNoRasterImage]<<1|+e[an.Highlight]<<2|+e[an.Water]<<3|+e[an.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];bU(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];bU(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,z_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===ks.INNER?0:this.resolution,0,this.resolution,this.resolution)}},dCt=class{constructor(){this.extents=[bi(),bi(),bi()],this.numViews=0}},yLe=class{constructor(e,i){this._size=_re(),this._fbo=null,this._fbo=new Sn(e,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=dt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,i){this._size[0]=e,this._size[1]=i,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},bE=class{constructor(e,i,r,s=!0){this.output=i,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new yLe(e,s)}},pCt=class{constructor(e){this.renderTargets=[new bE(e,H.Color,an.Color),new bE(e,H.Color,an.ColorNoRasterImage),new bE(e,H.Highlight,an.Highlight,!1),new bE(e,H.Normal,an.Water),new bE(e,H.Color,an.Occluded)],me("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new bE(e,H.ObjectAndLayerIdColor,an.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,i,r){if(e)i.lastUsed=r;else if(r-i.lastUsed>fCt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,i)=>e+i.fbo.gpuMemoryUsage,0)}};const fCt=1e3;let _Le=class{constructor(e){this._context=e,this._perConstructorInstances=new Z3,this._frameCounter=0,this._keepAliveFrameCount=kme}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=gCt){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(A(s)){const n=new e(this._context,i,()=>this.release(n));s=new mCt(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(b(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(A(e)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);A(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==kme&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},mCt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const kme=-1,gCt=new Hl;let vLe=class{constructor(e,i,r,s){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new Z3}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.requiresSlot(i,r))return null;let s=this._id2glMaterialRef.get(r,e.id);if(A(s)){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});s=new yCt(n),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);b(r)&&(r.unref(),r.referenced||(dt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){b(e.repository)&&e.repository!==this&&le.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},yCt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Rt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const _Ct={orderedRepackingEnabled:!1},vCt={rootOrigin:null},bCt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let LK=class DK{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ra,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),ra.clearPool(),NK[0]=null,Kw.prune(),pT.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=ra.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}ra.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=ra.acquire();for(const s of e){const n=b(i)?i:KA(this._objectToBoundingSphere(s),ECt);ZP(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}ra.release(r),this._shrink()}update(e,i){if(!ZP(i[3])&&this._isDegenerate(e))return;const r=SCt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=Td(e,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=Td(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Sj(e,i),h=d=>{if(--n,!s(d))return;const f=this._objectToBoundingSphere(d);if(!Tb(r,f))return;const m=J1(e,i,f),g=m-f[3],y=m+f[3];g<o&&(o=g,a=y,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!Tb(r,d.bounds)||(pe(Ld,c,d.halfSize),we(Ld,Ld,d.bounds),J1(e,i,Ld)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:y=>{r===DK.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};h.setRange(s);const d=J1(i,r,e),f=Sj(i,r),m=Sj(i,-r),g=y=>{if(!a(y))return;const v=this._objectToBoundingSphere(y),x=v,S=J1(i,r,x)-d,E=S-v[3],C=S+v[3];E>c||C<l||!Tb(o,v)||n(y,h)};this._forEachNodeDepthOrdered(this._root,y=>{if(!Tb(o,y.bounds)||(pe(Ld,f,y.halfSize),we(Ld,Ld,y.bounds),J1(i,r,Ld)-d>c)||(pe(Ld,m,y.halfSize),we(Ld,Ld,y.bounds),J1(i,r,Ld)-d<l))return!1;const v=y.node;return v.terminals.forAll(x=>g(x)),v.residents!==null&&v.residents.forAll(x=>g(x)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize))}forEachNeighbor(e,i){const r=T_(i),s=i,n=l=>{const c=this._objectToBoundingSphere(l),h=T_(c),d=r+h;return!(Eo(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=T_(l.bounds),h=r+c;if(Eo(l.bounds,s)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return r4(i.bounds,2*-i.halfSize,Kh),r4(i.bounds,2*i.halfSize,Qh),Upe(e.origin,e.direction,Kh,Qh)}_intersectsNodeWithOffset(e,i,r){return r4(i.bounds,2*-i.halfSize,Kh),r4(i.bounds,2*i.halfSize,Qh),r.applyToMinMax(Kh,Qh),Upe(e.origin,e.direction,Kh,Qh)}_intersectsObject(e,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||jZ(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||jZ(r.applyToBoundingSphere(s),e)}_forEachNode(e,i){let r=ra.acquire().init(e);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(ra.acquire().init(r).advance(n));ra.release(r)}}_forEachNodeDepthOrdered(e,i,r,s=DK.DepthOrder.FRONT_TO_BACK){let n=ra.acquire().init(e);const o=[n];for(TCt(r,s,Bme);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Bme[a];n.node.children[l]&&o.push(ra.acquire().init(n).advance(l))}ra.release(n)}}_remove(e,i,r){Kw.clear();const s=r.advanceTo(i,(n,o)=>{Kw.push(n.node),Kw.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=Kw.length-2;n>=0;n-=2){const o=Kw.data[n],a=Kw.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new vi({shrink:!0})),!0)}_add(e,i){i.advanceTo(this._objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=ra.acquire().init(e);this._add(i.getItemAt(r),s),ra.release(s)}}_grow(e,i){if(i!==0&&(Vme(e,i,r=>this._objectToBoundingSphere(r),a0),ZP(a0[3])&&!this._fitsInsideTree(a0)))if(this._nodeIsEmpty(this._root.node))KA(a0,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(a0);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(a0,r):this._growRootAsSubNode(r),ra.release(r)}}_rebuildTree(e,i){ge(Cj,i.bounds),Cj[3]=i.halfSize,Vme([e,Cj],2,s=>s,Mj);const r=ra.acquire().init(this._root);this._root.initFrom(null,Mj,Mj[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),ra.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),h=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),s4[l].min=d,s4[l].max=f}for(let l=0;l<3;l++){let c=s4[l].min,h=s4[l].max;const d=(s-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=n[l]-o-c*o*2;Ej[l]=f+(h+c)*o}const a=s*o;return Ej[3]=a*wLe,ra.acquire().initFrom(null,Ej,a,0)}_growRootAsSubNode(e){const i=this._root.node;ge(a0,this._root.bounds),a0[3]=this._root.halfSize,this._root.init(e),e.advanceTo(a0,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!ZP(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}},ra=class JC{constructor(){this.bounds=to(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=b(e)?e:JC.createEmptyNode(),b(i)&&KA(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*wLe}advance(e){let i=this.node.children[e];i||(i=JC.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=bLe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new vi({shrink:!0}),residents:new vi({shrink:!0})}}static acquire(){return JC._pool.acquire()}static release(e){JC._pool.release(e)}static clearPool(){JC._pool.prune()}};function wCt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function xCt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function r4(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Vme(t,e,i,r){if(e===1){const s=i(t[0]);KA(s,r)}else{Kh[0]=1/0,Kh[1]=1/0,Kh[2]=1/0,Qh[0]=-1/0,Qh[1]=-1/0,Qh[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);ZP(n[3])&&(wCt(Kh,n),xCt(Qh,n))}En(r,Kh,Qh,.5),r[3]=Math.max(Qh[0]-Kh[0],Qh[1]-Kh[1],Qh[2]-Kh[2])/2}}function TCt(t,e,i){if(!pT.length)for(let r=0;r<8;++r)pT.push({index:0,distance:0});for(let r=0;r<8;++r){const s=bLe[r];pT.data[r].index=r,pT.data[r].distance=J1(t,e,s)}pT.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=pT.data[r].index}function Sj(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=J1(t,e,zme[s]);n<r&&(r=n,i=zme[s])}return i}function J1(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function ZP(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}ra._pool=new pa(ra),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(LK||(LK={}));const bLe=[Ve(-1,-1,-1),Ve(1,-1,-1),Ve(-1,1,-1),Ve(1,1,-1),Ve(-1,-1,1),Ve(1,-1,1),Ve(-1,1,1),Ve(1,1,1)],zme=[Ve(-1,-1,-1),Ve(-1,-1,1),Ve(-1,1,-1),Ve(-1,1,1),Ve(1,-1,-1),Ve(1,-1,1),Ve(1,1,-1),Ve(1,1,1)],wLe=Math.sqrt(3),NK=[null];function SCt(t){return NK[0]=t,NK}const Ej=to(),Ld=$(),Kh=$(),Qh=$(),Kw=new vi,ECt=to(),a0=to(),Cj=to(),Mj=to(),s4=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],pT=new vi,Bme=[0,0,0,0,0,0,0,0],lm=LK;var Db;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Db||(Db={}));let xLe=class extends MD{get objects(){return this._objects}constructor(e,i=""){super(),this.apiLayerUid=i,this.type=xn.Layer,this.events=new ws,this.sliceable=!1,this._objects=new vi,this._objectsAdded=new vi,this._stageHandles=new ir,this.apiLayerUid=i,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??Db.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const i of bCt)this._stageHandles.add(this.events.on(i,r=>e.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),b(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),b(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),b(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),b(this._octree)){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){b(this._stage)&&this.updatePolicy!==Db.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){b(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,i)}getSpatialQueryAccelerator(){return A(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new lm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):b(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=He(this._octree),this._objectsAdded.clear()}};function j9(t){return b(t)&&t.type===xn.Layer}var $p,lS;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})($p||($p={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(lS||(lS={}));let Ia=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.transparencyPassType=zt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=$p.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=lS.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([X({count:H.COUNT})],Ia.prototype,"output",void 0),u([X({count:zt.COUNT})],Ia.prototype,"transparencyPassType",void 0),u([X()],Ia.prototype,"occluder",void 0),u([X()],Ia.prototype,"hasSlicePlane",void 0),u([X()],Ia.prototype,"writeDepth",void 0),u([X({count:$p.COUNT})],Ia.prototype,"space",void 0),u([X()],Ia.prototype,"hideOnShortSegments",void 0),u([X()],Ia.prototype,"hasCap",void 0),u([X({count:lS.COUNT})],Ia.prototype,"anchor",void 0),u([X()],Ia.prototype,"hasTip",void 0),u([X()],Ia.prototype,"vvSize",void 0),u([X()],Ia.prototype,"vvColor",void 0),u([X()],Ia.prototype,"vvOpacity",void 0),u([X()],Ia.prototype,"hasOccludees",void 0),u([X()],Ia.prototype,"hasMultipassTerrain",void 0),u([X()],Ia.prototype,"cullAboveGround",void 0),u([X({constValue:!0})],Ia.prototype,"hasVvInstancing",void 0),u([X({constValue:!0})],Ia.prototype,"hasSliceTranslatedView",void 0);const Gme=8;function TLe(t,e){const i=t.vertex;i.uniforms.add(new Be("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(P.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new fi("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new fi("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new fi("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new fi("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(P.SIZE,"float"),i.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(P.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new Dl("vvOpacityValues",r=>r.vvOpacityValues,Gme),new Dl("vvOpacityOpacities",r=>r.vvOpacityOpacities,Gme)]),i.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(P.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",vm),i.uniforms.add(new Dl("vvColorValues",r=>r.vvColorValues,vm)),i.uniforms.add(new Mz("vvColorColors",r=>r.vvColorColors,vm)),i.code.add(T`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(P.COLOR,"vec4"),i.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function X_(t,e){switch(t.fragment.include(_h),e.output){case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case H.Depth:t.fragment.code.add(T`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let SLe=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>dt(e.stippleTexture)),this._cache.clear()}_acquire(e){if(A(e))return null;const i=this._patternId(e),r=this._cache.get(i);if(r)return r.refCount++,r;const{encodedData:s,paddedPixels:n}=MCt(e),o=new CCt(new At(this._rctx,{width:n,height:1,internalFormat:Qe.RGBA,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE},s));return this._cache.set(i,o),o}release(e){if(A(e))return;const i=this._patternId(e),r=this._cache.get(i);r&&(r.refCount--,r.refCount===0&&(b(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(i)))}swap(e,i){const r=this._acquire(i);return this.release(e),r}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},CCt=class extends Br{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function MCt(t){const e=une(t),i=1/t.pixelRatio,r=ELe(t),s=CLe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const m of e){for(let g=0;g<m;g++){const y=a*(Math.min(g,m-1-g)+.5)*i/n*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=r+MLe,d=new Uint8Array(4*h);let f=4;for(const m of c)oL(m,d,f),f+=4;return d.copyWithin(0,f-4,f),d.copyWithin(f,4,8),{encodedData:d,paddedPixels:h}}function une(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function ELe(t){if(A(t))return 1;const e=une(t);return Math.floor(e.reduce((i,r)=>i+r))}function CLe(t){return une(t).reduce((e,i)=>Math.max(e,i))}const MLe=2;function ACt(t){return A(t)?fy:t.length===4?t:Rr(OCt,t[0],t[1],t[2],1)}const OCt=Ai();function ALe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?RCt(t,e):PCt(t)}function RCt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(_h),e.draped||($m(r,e),r.uniforms.add(new Be("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),r.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${$Ct};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(T`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new Be("pixelRatio",(o,a)=>a.camera.pixelRatio)),r.code.add(T`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?T`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",MLe);const n=e.hasWebGL2Context?Ar.None:Ar.Size;s.uniforms.add(ym("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new Be("stipplePatternSDFNormalizer",o=>ICt(o.stipplePattern)),new Be("stipplePatternPixelSizeInv",o=>1/hne(o))]),s.code.add(T`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Pp(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(T`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?T`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:T`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?T`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?T`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:T`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?T`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:T`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new Ni("stippleOffColor",o=>ACt(o.stippleOffColor))),s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function PCt(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function ICt(t){return b(t)?(Math.floor(.5*(CLe(t)-1))+.5)/t.pixelRatio:1}function hne(t){const e=t.stipplePattern;return b(e)?ELe(t.stipplePattern)/e.pixelRatio:1}const $Ct=T.float(.4),fL=64,dne=fL/2,OLe=dne/5,LCt=fL/OLe,DCt=.25;function NCt(t,e){return t.fromData(`${e}-marker`,()=>p$e(e,fL,dne,OLe))}function RLe(t,e){const i=t.vertex;t.constants.add("markerSizePerLineWidth","float",LCt),i.uniforms.add(new Be("pixelRatio",(r,s)=>s.camera.pixelRatio)),A(i.uniforms.get("markerScale"))&&i.constants.add("markerScale","float",1),i.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===$p.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Be("perRenderPixelRatio",(r,s)=>s.camera.perRenderPixelRatio)),i.code.add(T`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Lp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Lp||(Lp={}));let Ns=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.capType=Lp.BUTT,this.transparencyPassType=zt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([X({count:H.COUNT})],Ns.prototype,"output",void 0),u([X({count:Lp.COUNT})],Ns.prototype,"capType",void 0),u([X({count:zt.COUNT})],Ns.prototype,"transparencyPassType",void 0),u([X()],Ns.prototype,"occluder",void 0),u([X()],Ns.prototype,"hasSlicePlane",void 0),u([X()],Ns.prototype,"hasPolygonOffset",void 0),u([X()],Ns.prototype,"writeDepth",void 0),u([X()],Ns.prototype,"draped",void 0),u([X()],Ns.prototype,"stippleEnabled",void 0),u([X()],Ns.prototype,"stippleOffColorEnabled",void 0),u([X()],Ns.prototype,"stippleScaleWithLineWidth",void 0),u([X()],Ns.prototype,"stipplePreferContinuous",void 0),u([X()],Ns.prototype,"roundJoins",void 0),u([X()],Ns.prototype,"applyMarkerOffset",void 0),u([X()],Ns.prototype,"vvSize",void 0),u([X()],Ns.prototype,"vvColor",void 0),u([X()],Ns.prototype,"vvOpacity",void 0),u([X()],Ns.prototype,"falloffEnabled",void 0),u([X()],Ns.prototype,"innerColorEnabled",void 0),u([X()],Ns.prototype,"hasOccludees",void 0),u([X()],Ns.prototype,"hasMultipassTerrain",void 0),u([X()],Ns.prototype,"cullAboveGround",void 0),u([X()],Ns.prototype,"wireframe",void 0),u([X({constValue:!0})],Ns.prototype,"stippleRequiresClamp",void 0),u([X({constValue:!0})],Ns.prototype,"stippleRequiresStretchMeasure",void 0),u([X({constValue:!0})],Ns.prototype,"hasVvInstancing",void 0),u([X({constValue:!0})],Ns.prototype,"hasSliceTranslatedView",void 0),u([X()],Ns.prototype,"objectAndLayerIdColorInstanced",void 0);const H9=1;function FCt(t){const e=new ar,{vertex:i,fragment:r}=e,s=t.hasMultipassTerrain&&(t.output===H.Color||t.output===H.Alpha);e.include(SD),e.include(TLe,t),e.include(ALe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(i.uniforms.add(new Be("markerScale",m=>m.markerScale)),e.include(RLe,{space:$p.World})),t.output===H.Depth&&e.include(X_,t),e.include(Cz,t),ah(i,t),i.uniforms.add([new Ps("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new hr("nearFar",(m,g)=>g.camera.nearFar),new Be("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Ni("viewport",(m,g)=>g.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.SUBDIVISIONFACTOR,"float"),e.attributes.add(P.UV0,"vec2"),e.attributes.add(P.AUXPOS1,"vec3"),e.attributes.add(P.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),ow(e),s&&e.varyings.add("depth","float");const o=t.capType===Lp.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&o,d=t.falloffEnabled||h;d&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),nz(e),i.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new Be("pixelRatio",(m,g)=>g.camera.pixelRatio)),i.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?T`vLineWidth = lineWidth;`:""}
      ${l?T`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&i.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&i.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((H9+2)/(H9+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Lp.BUTT;return i.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?T`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?T`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&i.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new Be("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Be("stipplePatternPixelSize",m=>hne(m))),i.code.add(T`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Ed,t),e.include(Un,t),r.include(ky),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?r.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&r.code.add(T`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${T.float(sl)}) {
        discard;
      }
    `),h?r.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(sl)}, stippleCoverage);
      `):r.code.add(T`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new Ni("intrinsicColor",m=>m.color)),t.output!==H.ObjectAndLayerIdColor&&r.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new Ni("innerColor",m=>vt(m.innerColor,m.color))),r.uniforms.add(new Be("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),r.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new Be("falloff",m=>m.falloff)),r.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(T`
    ${t.output===H.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(sl)}) {
      discard;
    }

    ${t.output===H.Alpha?T`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===H.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===H.Color&&t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===H.Highlight?T`gl_FragColor = vec4(1.0);`:""}
    ${t.output===H.Depth?T`outputDepth(linearDepth);`:""}
    ${t.output===H.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const UCt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:H9,build:FCt},Symbol.toStringTag,{value:"Module"})),pne={func:hs.LESS},q9={func:hs.ALWAYS},Py={mask:255},PLe={mask:0},kCt=t=>({function:{func:hs.NOTEQUAL,ref:t,mask:t},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.KEEP}}),VCt=t=>({function:{func:hs.ALWAYS,ref:t,mask:t},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.REPLACE}}),Cw={function:{func:hs.ALWAYS,ref:uu.OutlineVisualElementMask,mask:uu.OutlineVisualElementMask},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.ZERO}},fw={function:{func:hs.ALWAYS,ref:uu.OutlineVisualElementMask,mask:uu.OutlineVisualElementMask},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.REPLACE}},ILe={function:{func:hs.EQUAL,ref:uu.OutlineVisualElementMask,mask:uu.OutlineVisualElementMask},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.KEEP}},$Le={function:{func:hs.NOTEQUAL,ref:uu.OutlineVisualElementMask,mask:uu.OutlineVisualElementMask},operation:{fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.KEEP}},LLe=new Map([[P.POSITION,0],[P.SUBDIVISIONFACTOR,1],[P.UV0,2],[P.AUXPOS1,3],[P.AUXPOS2,4],[P.COLOR,5],[P.COLORFEATUREATTRIBUTE,5],[P.SIZE,6],[P.SIZEFEATUREATTRIBUTE,6],[P.OPACITYFEATUREATTRIBUTE,7],[P.OBJECTANDLAYERIDCOLOR,8]]);let DLe=class NLe extends dr{initializeProgram(e){return new cr(e.rctx,NLe.shader.get().build(this.configuration),LLe)}_makePipelineState(e,i){const r=this.configuration,s=e===zt.NONE,n=e===zt.FrontFace;return si({blending:r.output===H.Color||r.output===H.Alpha?s?yd:fv(e):null,depthTest:{func:Ew(e)},depthWrite:s?r.writeDepth?gu:null:Az(e),colorWrite:wi,stencilWrite:r.hasOccludees?Py:null,stencilTest:r.hasOccludees?i?fw:Cw:null,polygonOffset:s||n?r.hasPolygonOffset?jme:null:Rz})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?jme:null;this._occluderPipelineTransparent=si({blending:yd,polygonOffset:i,depthTest:q9,depthWrite:null,colorWrite:wi,stencilWrite:null,stencilTest:$Le}),this._occluderPipelineOpaque=si({blending:yd,polygonOffset:i,depthTest:q9,depthWrite:null,colorWrite:wi,stencilWrite:PLe,stencilTest:ILe}),this._occluderPipelineMaskWrite=si({blending:null,polygonOffset:i,depthTest:pne,depthWrite:null,colorWrite:null,stencilWrite:Py,stencilTest:fw})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Xt.LINES:Xt.TRIANGLE_STRIP}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Ie.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ie.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};DLe.shader=new lr(UCt,()=>se(()=>import("./RibbonLine.glsl-59590771.js"),[]));const jme={factor:0,units:-4};var ku;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(ku||(ku={}));let RM=class extends Sw{constructor(e){super(e,new BCt),this._configuration=new Ns,this._vertexAttributeLocations=LLe,this._layout=this.createLayout()}isClosed(e,i){return ULe(this.parameters,e,i)}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Ie.DRAPED_MATERIAL;const r=b(this.parameters.stipplePattern)&&e!==H.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&b(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!b(this.parameters.markerParameters)&&jCt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&b(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ks.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(P.POSITION).data,l=e.vertexAttributes.get(P.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=e.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0];c*=Se(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],d=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],x=a[y+1],S=h-v,E=d-x,C=a[y+3]-v,R=a[y+4]-x,O=Se((C*S+R*E)/(C*C+R*R),0,1),U=C*O-S,L=R*O-E,B=U*U+L*L;B<m&&(m=B,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!aPe(i))return void le.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(P.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const S=a.get(P.SIZEFEATUREATTRIBUTE).data[0];c*=Se(this.parameters.vvSizeOffset[0]+S*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(P.SIZE)&&(c*=a.get(P.SIZE).data[0]);const h=r.camera,d=HCt;Ao(d,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;fe(oR[0],d[0]-f,d[1]+f,0),fe(oR[1],d[0]+f,d[1]+f,0),fe(oR[2],d[0]+f,d[1]-f,0),fe(oR[3],d[0]-f,d[1]-f,0);for(let S=0;S<4;S++)if(!h.unprojectFromRenderScreen(oR[S],l0[S]))return;Il(h.eye,l0[0],l0[1],Oj),Il(h.eye,l0[1],l0[2],Rj),Il(h.eye,l0[2],l0[3],Pj),Il(h.eye,l0[3],l0[0],Ij);let m=Number.MAX_VALUE,g=0;const y=FLe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let S=0;S<y;S+=3){Pc[0]=l[S]+i[12],Pc[1]=l[S+1]+i[13],Pc[2]=l[S+2]+i[14];const E=(S+3)%l.length;if(Ic[0]=l[E]+i[12],Ic[1]=l[E+1]+i[13],Ic[2]=l[E+2]+i[14],Kr(Oj,Pc)<0&&Kr(Oj,Ic)<0||Kr(Rj,Pc)<0&&Kr(Rj,Ic)<0||Kr(Pj,Pc)<0&&Kr(Pj,Ic)<0||Kr(Ij,Pc)<0&&Kr(Ij,Ic)<0)continue;if(h.projectToRenderScreen(Pc,ex),h.projectToRenderScreen(Ic,tx),ex[2]<0&&tx[2]>0){be(tg,Pc,Ic);const R=h.frustum,O=-Kr(R[Jr.NEAR],Pc)/xe(tg,R[Jr.NEAR]);pe(tg,tg,O),we(Pc,Pc,tg),h.projectToRenderScreen(Pc,ex)}else if(ex[2]>0&&tx[2]<0){be(tg,Ic,Pc);const R=h.frustum,O=-Kr(R[Jr.NEAR],Ic)/xe(tg,R[Jr.NEAR]);pe(tg,tg,O),we(Ic,Ic,tg),h.projectToRenderScreen(Ic,tx)}else if(ex[2]<0&&tx[2]<0)continue;ex[2]=0,tx[2]=0;const C=Cre(b2(ex,tx,Wme),d);C<m&&(m=C,ge(Hme,Pc),ge(qme,Ic),g=S/3)}const v=r.rayBegin,x=r.rayEnd;if(m<f*f){let S=Number.MAX_VALUE;if(sOe(b2(Hme,qme,Wme),b2(v,x,qCt),Qw)){be(Qw,Qw,v);const E=ze(Qw);pe(Qw,Qw,1/E),S=E/Wr(v,x)}o(S,Qw,g,!1)}}createLayout(){const e=qs().vec3f(P.POSITION).f32(P.SUBDIVISIONFACTOR).vec2f(P.UV0).vec3f(P.AUXPOS1).vec3f(P.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(P.SIZEFEATUREATTRIBUTE):e.f32(P.SIZE),this.parameters.vvColorEnabled?e.f32(P.COLORFEATUREATTRIBUTE):e.vec4f(P.COLOR),this.parameters.vvOpacityEnabled&&e.f32(P.OPACITYFEATUREATTRIBUTE),me("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(P.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new GCt(this._layout,this.parameters)}requiresSlot(e,i){return i===H.Color||i===H.Alpha||i===H.Highlight||i===H.Depth||i===H.ObjectAndLayerIdColor?e===Ie.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ks.OccludeAndTransparentStencil?e===Ie.OPAQUE_MATERIAL||e===Ie.OCCLUDER_MATERIAL||e===Ie.TRANSPARENT_OCCLUDER_MATERIAL:i===H.Color||i===H.Alpha?e===(this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ie.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new zCt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),b(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},zCt=class extends Tw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==H.Color&&this._output!==H.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(DLe,e)}},BCt=class extends Kse{constructor(){super(...arguments),this.width=0,this.color=Tp,this.join="miter",this.cap=Lp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},GCt=class{constructor(e,i){this._parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=H9+r}}_isClosed(e){return FLe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.indices.get(P.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){var K;const o=WCt,a=YCt,l=XCt,c=r.vertexAttributes.get(P.POSITION).data,h=r.indices&&r.indices.get(P.POSITION),d=(K=r.vertexAttributes.get(P.DISTANCETOSTART))==null?void 0:K.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=r.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(P.SIZE)&&(f=r.vertexAttributes.get(P.SIZE).data[0]);let g=[1,1,1,1],y=0;this._parameters.vvColorEnabled?y=r.vertexAttributes.get(P.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(P.COLOR)&&(g=r.vertexAttributes.get(P.COLOR).data);const v=me("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let x=0;this._parameters.vvOpacityEnabled&&(x=r.vertexAttributes.get(P.OPACITYFEATUREATTRIBUTE).data[0]);const S=c.length/3,E=new Float32Array(s.buffer),C=me("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,R=this.vertexBufferLayout.stride/4;let O=n*R;const U=O;let L=0;const B=d?(Y,D,V)=>L=d[V]:(Y,D,V)=>L+=Wr(Y,D),G=me("enable-feature:objectAndLayerId-rendering"),j=(Y,D,V,k,Z,Q,ne)=>{if(E[O++]=D[0],E[O++]=D[1],E[O++]=D[2],E[O++]=k,E[O++]=ne,E[O++]=Z,E[O++]=Y[0],E[O++]=Y[1],E[O++]=Y[2],E[O++]=V[0],E[O++]=V[1],E[O++]=V[2],this._parameters.vvSizeEnabled?E[O++]=m:E[O++]=f,this._parameters.vvColorEnabled)E[O++]=y;else{const te=Math.min(4*Q,g.length-4);E[O++]=g[te],E[O++]=g[te+1],E[O++]=g[te+2],E[O++]=g[te+3]}this._parameters.vvOpacityEnabled&&(E[O++]=x),G&&(b(v)&&(C[4*O]=v[0],C[4*O+1]=v[1],C[4*O+2]=v[2],C[4*O+3]=v[3]),O++)};O+=R,fe(a,c[0],c[1],c[2]),e&&at(a,a,e);const q=this._isClosed(r);if(q){const Y=c.length-3;fe(o,c[Y],c[Y+1],c[Y+2]),e&&at(o,o,e)}else fe(l,c[3],c[4],c[5]),e&&at(l,l,e),j(a,a,l,1,ku.LEFT_CAP_START,0,0),j(a,a,l,1,ku.RIGHT_CAP_START,0,0),ge(o,a),ge(a,l);const ie=q?0:1,ee=q?S:S-1;for(let Y=ie;Y<ee;Y++){const D=(Y+1)%S*3;fe(l,c[D],c[D+1],c[D+2]),e&&at(l,l,e),B(o,a,Y),j(o,a,l,0,ku.LEFT_JOIN_END,Y,L),j(o,a,l,0,ku.RIGHT_JOIN_END,Y,L);const V=this.numJoinSubdivisions;for(let k=0;k<V;++k){const Z=(k+1)/(V+1);j(o,a,l,Z,ku.LEFT_JOIN_END,Y,L),j(o,a,l,Z,ku.RIGHT_JOIN_END,Y,L)}j(o,a,l,1,ku.LEFT_JOIN_START,Y,L),j(o,a,l,1,ku.RIGHT_JOIN_START,Y,L),ge(o,a),ge(a,l)}q?(fe(l,c[3],c[4],c[5]),e&&at(l,l,e),L=B(o,a,ee),j(o,a,l,0,ku.LEFT_JOIN_END,ie,L),j(o,a,l,0,ku.RIGHT_JOIN_END,ie,L)):(L=B(o,a,ee),j(o,a,a,0,ku.LEFT_CAP_END,ee,L),j(o,a,a,0,ku.RIGHT_CAP_END,ee,L)),Aj(E,U+R,E,U,R),O=Aj(E,O-R,E,O,R),this._parameters.wireframe&&this._addWireframeVertices(s,U,O,R)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Aj(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function Aj(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function FLe(t,e,i){return ULe(t,e.get(P.POSITION).data,i?i.get(P.POSITION):null)}function ULe(t,e,i){return!!t.isClosed&&(i?i.length>2:e.length>6)}function jCt(t){return t.anchor===lS.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Pc=$(),Ic=$(),tg=$(),Qw=$(),HCt=$(),ex=ma(),tx=ma(),Hme=$(),qme=$(),Wme=Fm(),qCt=Fm(),WCt=$(),YCt=$(),XCt=$(),oR=[ma(),ma(),ma(),ma()],l0=[$(),$(),$(),$()],Oj=gr(),Rj=gr(),Pj=gr(),Ij=gr();let fne=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+nh()}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=vCt.rootOrigin;if(b(h))return this._origins.set(this._rootOriginId,QI(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const d=QI(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,d),d}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(be(xa,e,i.vec3),xa[0]=Math.abs(xa[0]),xa[1]=Math.abs(xa[1]),xa[2]=Math.abs(xa[2]),xa[0]<c&&xa[1]<c&&xa[2]<c){if(l){const h=Math.max(...xa);if(be(xa,e,l.vec3),xa[0]=Math.abs(xa[0]),xa[1]=Math.abs(xa[1]),xa[2]=Math.abs(xa[2]),Math.max(...xa)<h)return l}return i}return l||(l=QI(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=di(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new RM({width:2,color:i}),s.add(this._material);const m=new xLe({pickable:!1}),g=new mv({castShadow:!1});s.add(g),m.add(g),s.add(m),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);un(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new qn(this._material,[[P.POSITION,new ct(c,3,!0)]],[[P.POSITION,h]],null,xn.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const xa=$();let kLe=class{constructor(e,i,r,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new jt,this.output=H.Color,this.renderOccludedMask=Yme,this.bindParameters=new sz(i,r,b(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=Yme}},ZCt=class extends kLe{constructor(e,i,r,s,n){super(e,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}};const Yme=Ks.Occlude|Ks.OccludeAndTransparent|Ks.OccludeAndTransparentStencil;let JP=class extends jt{constructor(){super(...arguments),this._projectionMatrix=Ge()}get projectionMatrix(){return this._projectionMatrix}};u([p()],JP.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],JP.prototype,"projectionMatrix",null),JP=u([N("esri.views.3d.webgl-engine.lib.CascadeCamera")],JP);var c3;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(c3||(c3={}));let n4=class{constructor(){this.camera=new JP,this.lightMat=Ge()}},mne=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Rr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._rctx=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=Ge(),this._projectionViewInverse=Ge(),this._modelViewLight=Ge(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Ai(),this._cascades=[new n4,new n4,new n4,new n4],this._lastOrigin=null,this._maxTextureSize=Math.min(me("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=Se(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&b(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Lj[e]=this._cascades[e];return Lj.length=this._numCascades,Lj}start(e,i,r){Rt(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(e,i);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,i);this._lastOrigin=null,this.clear()}finish(e){Rt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!Ur(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||$(),ge(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){fu(ege,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)tge[16*i+r]=ege[r]}}return tge}takeCascadeSnapshotTo(e,i){Rt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this._rctx,n=s.bindTexture(r,At.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Ut.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,At.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(_s.COLOR_BUFFER_BIT|_s.DEPTH_BUFFER_BIT)}_computeTextureSize(e,i){const r=.5*Math.log(e*e+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(b(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new At(this._rctx,e),this._fbo=new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let i=this._snapshots[e];if(b(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(e);const r={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new At(this._rctx,r),this._snapshots[e]=i,i}_discardDepthTexture(){this._fbo=dt(this._fbo),this._depthTexture=dt(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=dt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Rt(l<c);for(let m=0;m<8;++m){Rr(Xme,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=hp[m];ld(g,Xme,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Ul($j,hp[0]),n.camera.viewMatrix=fu(JCt,this._modelViewLight,$j);for(let m=0;m<8;++m)at(hp[m],hp[m],n.camera.viewMatrix);let h=hp[0][2],d=hp[0][2];for(let m=1;m<8;++m)h=Math.min(h,hp[m][2]),d=Math.max(d,hp[m][2]);h-=200,d+=200,n.camera.near=-d,n.camera.far=-h,tMt(r,s,h,d,n.camera),ln(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/2;n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,i){ln(this._projectionView,e.projectionMatrix,e.viewMatrix),Va(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===it.Global?e.eye:fe($j,0,0,1);uV(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i){this._numCascades=Math.min(1+Math.floor(tvt(e/i,4)),this._maxNumCascades);const r=(e-i)/this._numCascades,s=(e/i)**(1/this._numCascades);let n=i,o=i;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=ei(n,o,this._splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var e;return this._snapshots.reduce((i,r)=>i+tS(r),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){e._splitSchemeLambda=i},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const JCt=Ge(),Xme=Ai(),hp=[];for(let t=0;t<8;++t)hp.push(Ai());const Zme=je(),Jme=je(),KCt=je(),Kme=je(),Qme=je(),$j=$(),Lj=[],ege=Ge(),tge=new Float32Array(64),Mh=je(),wE=je(),ix=[je(),je(),je(),je()],Po=je(),Dj=je(),jv=je(),aR=je(),xE=je(),TE=je(),o4=je();function QCt(t,e,i,r,s,n,o,a){Vt(Mh,0,0);for(let R=0;R<4;++R)ed(Mh,Mh,t[R]);tl(Mh,Mh,.25),Vt(wE,0,0);for(let R=4;R<8;++R)ed(wE,wE,t[R]);tl(wE,wE,.25),NT(ix[0],t[4],t[5],.5),NT(ix[1],t[5],t[6],.5),NT(ix[2],t[6],t[7],.5),NT(ix[3],t[7],t[4],.5);let l=0,c=wd(ix[0],Mh);for(let R=1;R<4;++R){const O=wd(ix[R],Mh);O<c&&(c=O,l=R)}Bs(Po,ix[l],t[l+4]);const h=Po[0];let d,f;Po[0]=-Po[1],Po[1]=h,Bs(Dj,wE,Mh),Us(Dj,Po)<0&&are(Po,Po),NT(Po,Po,Dj,i),iw(Po,Po),d=f=Us(Bs(jv,t[0],Mh),Po);for(let R=1;R<8;++R){const O=Us(Bs(jv,t[R],Mh),Po);O<d?d=O:O>f&&(f=O)}Ao(r,Mh),tl(jv,Po,d-e),ed(r,r,jv);let m=-1,g=1,y=0,v=0;for(let R=0;R<8;++R){Bs(aR,t[R],r),iw(aR,aR);const O=Po[0]*aR[1]-Po[1]*aR[0];O>0?O>m&&(m=O,y=R):O<g&&(g=O,v=R)}sE(m>0,"leftArea"),sE(g<0,"rightArea"),tl(xE,Po,d),ed(xE,xE,Mh),tl(TE,Po,f),ed(TE,TE,Mh),o4[0]=-Po[1],o4[1]=Po[0];const x=vF(r,t[v],TE,ed(jv,TE,o4),1,s),S=vF(r,t[y],TE,jv,1,n),E=vF(r,t[y],xE,ed(jv,xE,o4),1,o),C=vF(r,t[v],xE,jv,1,a);sE(x,"rayRay"),sE(S,"rayRay"),sE(E,"rayRay"),sE(C,"rayRay")}function Qi(t,e){return 3*e+t}const ige=je();function bu(t,e){return Vt(ige,t[e],t[e+3]),ige}const $c=je(),yt=Hs();function eMt(t,e,i,r,s){Bs($c,i,r),tl($c,$c,.5),yt[0]=$c[0],yt[1]=$c[1],yt[2]=0,yt[3]=$c[1],yt[4]=-$c[0],yt[5]=0,yt[6]=$c[0]*$c[0]+$c[1]*$c[1],yt[7]=$c[0]*$c[1]-$c[1]*$c[0],yt[8]=1,yt[Qi(0,2)]=-Us(bu(yt,0),t),yt[Qi(1,2)]=-Us(bu(yt,1),t);let n=Us(bu(yt,0),i)+yt[Qi(0,2)],o=Us(bu(yt,1),i)+yt[Qi(1,2)],a=Us(bu(yt,0),r)+yt[Qi(0,2)],l=Us(bu(yt,1),r)+yt[Qi(1,2)];n=-(n+a)/(o+l),yt[Qi(0,0)]+=yt[Qi(1,0)]*n,yt[Qi(0,1)]+=yt[Qi(1,1)]*n,yt[Qi(0,2)]+=yt[Qi(1,2)]*n,n=1/(Us(bu(yt,0),i)+yt[Qi(0,2)]),o=1/(Us(bu(yt,1),i)+yt[Qi(1,2)]),yt[Qi(0,0)]*=n,yt[Qi(0,1)]*=n,yt[Qi(0,2)]*=n,yt[Qi(1,0)]*=o,yt[Qi(1,1)]*=o,yt[Qi(1,2)]*=o,yt[Qi(2,0)]=yt[Qi(1,0)],yt[Qi(2,1)]=yt[Qi(1,1)],yt[Qi(2,2)]=yt[Qi(1,2)],yt[Qi(1,2)]+=1,n=Us(bu(yt,1),e)+yt[Qi(1,2)],o=Us(bu(yt,2),e)+yt[Qi(2,2)],a=Us(bu(yt,1),i)+yt[Qi(1,2)],l=Us(bu(yt,2),i)+yt[Qi(2,2)],n=-.5*(n/o+a/l),yt[Qi(1,0)]+=yt[Qi(2,0)]*n,yt[Qi(1,1)]+=yt[Qi(2,1)]*n,yt[Qi(1,2)]+=yt[Qi(2,2)]*n,n=Us(bu(yt,1),e)+yt[Qi(1,2)],o=Us(bu(yt,2),e)+yt[Qi(2,2)],a=-o/n,yt[Qi(1,0)]*=a,yt[Qi(1,1)]*=a,yt[Qi(1,2)]*=a,s[0]=yt[0],s[1]=yt[1],s[2]=0,s[3]=yt[2],s[4]=yt[3],s[5]=yt[4],s[6]=0,s[7]=yt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=yt[6],s[13]=yt[7],s[14]=0,s[15]=yt[8]}function tMt(t,e,i,r,s){const n=1/hp[0][3],o=1/hp[4][3];Rt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Co(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,QCt(hp,a,l,Zme,Jme,KCt,Kme,Qme),eMt(Zme,Jme,Kme,Qme,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function iMt(t){return Vm(t)&&t.intersector===Vs.TERRAIN&&!!t.target}let rMt=class extends pz{constructor(e,i,r){super(e,i),this.triangleNr=r}};function VLe(t){return Vm(t)&&t.intersector===Vs.OVERLAY&&!!t.target}let FK=class{constructor(){this.adds=new vi,this.removes=new vi,this.updates=new vi({allocator:e=>e||new sMt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},sMt=class{},nMt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Js,Fo;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Js||(Js={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Fo||(Fo={}));function zLe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new nMt,e.set(r,s)),s};return t.removes.forAll(r=>{Nj(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Nj(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Nj(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Nj(t){return t.geometry.indexCount>=1}let oMt=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}_createIndexbuffer(){return yr.createIndex(this._rctx,or.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Wt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Xt.POINTS,1,Mt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},BLe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}destroy(){this._map.forEach((e,i)=>{b(e)&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.requiresSlot(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const s=this._map.get(r);if(b(s)){if(s.ensureResources(e)===S_.LOADED)return s;this._repository.requestRender()}return null}};function aMt(t){const e=T`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function FD(t,e){switch(e.normalType){case Pr.CompressedAttribute:t.include(aMt),t.attributes.add(P.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case Pr.Attribute:t.attributes.add(P.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case Pr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Pr.COUNT:case Pr.Ground:}}var Pr;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Pr||(Pr={}));function Nz(t,e){switch(e.normalType){case Pr.Attribute:case Pr.CompressedAttribute:t.include(FD,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new Z$("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Vy("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Pr.Ground:t.include(tA,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Pr.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case Pr.COUNT:}}let GLe=class extends zRe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Hs()}},jLe=class extends BRe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Hs(),this.toMapSpace=Ai()}},UK=class extends jLe{constructor(e=$()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},nO=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(P.POSITION).length}write(e,i,r,s,n){a$e(r,this.vertexBufferLayout,e,i,s,n)}};const lMt=qs().vec3f(P.POSITION),cMt=qs().vec3f(P.POSITION).vec2f(P.UV0),HLe=qs().vec3f(P.POSITION).vec4u8(P.COLOR);qs().vec3f(P.POSITION).vec4u8(P.OBJECTANDLAYERIDCOLOR);qs().vec3f(P.POSITION).vec2f(P.UV0).vec4u8(P.OBJECTANDLAYERIDCOLOR);const uMt=qs().vec3f(P.POSITION).vec4u8(P.COLOR).vec4u8(P.OBJECTANDLAYERIDCOLOR);let gne=class extends Sw{intersect(e,i,r,s,n,o){return ZIe(e,r,s,n,void 0,o)}};function hMt(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function dMt(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function rge(t){t.fragment.uniforms.add(new Yt("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new Yt("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new Ni("waveParams",e=>Rr(pMt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new hr("waveDirection",e=>Vt(fMt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(hMt),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const pMt=Ai(),fMt=je();function mL(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let UD=class extends dn{constructor(e,i){super(e,"int",Vr.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}},mMt=class extends dn{constructor(e,i,r){super(e,"mat4",Vr.Draw,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},gMt=class extends dn{constructor(e,i,r){super(e,"mat4",Vr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},qLe=class extends Br{constructor(){super(...arguments),this.origin=$()}};function Fz(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new gMt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),WLe(t,e))}function cS(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new mMt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),WLe(t,e))}function WLe(t,e){const i=t.fragment;i.include(_h),i.uniforms.add([...ym("shadowMapTex",(r,s)=>s.shadowMap.depthTexture,e.hasWebGL2Context?Ar.None:Ar.Size),new UD("numCascades",(r,s)=>s.shadowMap.numCascades),new Ni("cascadeDistances",(r,s)=>s.shadowMap.cascadeDistances)]),i.code.add(T`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Pp(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function yMt(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function yne(t,e){const i=t.fragment.code;t.include(SD),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic&&e.pbrMode!==Ot.Terrain&&e.pbrMode!==Ot.TerrainWithWater||(i.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||(t.include(yMt),i.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function _Mt(t,e){const i=t.fragment.code;t.include(SD),i.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function YLe(t,e){t.include(_Mt,e),t.include(ez),t.include(dMt),e.hasCloudsReflections&&t.include(gRe,e),e.hasScreenSpaceReflections&&t.include(p_t,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new Be("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Be("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add([new Ps("view",(r,s)=>s.ssr.camera.viewMatrix),new Yt("lastFrameColorTexture",(r,s)=>s.ssr.lastFrameColorTexture),new Be("fadeFactor",(r,s)=>s.ssr.fadeFactor)]),i.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor;
}`)}function vMt(t){const e=new ar,{vertex:i,fragment:r}=e;ah(i,t),e.include(au,t),e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.UV0,"vec2");const s=new Ni("waterColor",n=>n.color);if(t.output===H.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(sl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(T`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==H.Color&&t.output!==H.Alpha||(e.include(mL,t),e.include(X3,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(sl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===H.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Ed,t),t.output){case H.Alpha:e.include(Un,t),r.uniforms.add(s),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case H.Color:e.include(d9,t),e.include(Xre,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(rge),e.include(Un,t),e.include(cS,t),e.include(YLe,t),r.uniforms.add([s,new Be("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")]),$m(r,t),r.include(ky),nv(r),Uy(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case H.Normal:e.include(mL,t),e.include(rge,t),e.include(Un,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(sl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Be("timeElapsed",n=>n.timeElapsed)),r.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case H.Highlight:e.include(pv,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(sl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Un,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const bMt=Object.freeze(Object.defineProperty({__proto__:null,build:vMt},Symbol.toStringTag,{value:"Module"}));let XLe=class ZLe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new cr(e.rctx,ZLe.shader.get().build(this.configuration),rr)}_setPipelineState(e){const i=this.configuration,r=e===zt.NONE,s=e===zt.FrontFace;return si({blending:i.output!==H.Normal&&i.output!==H.Highlight&&i.transparent?r?yd:fv(e):null,depthTest:{func:Ew(e)},depthWrite:r?i.writeDepth?gu:null:Az(e),colorWrite:wi,polygonOffset:r||s?null:Pz(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};XLe.shader=new lr(bMt,()=>se(()=>import("./WaterSurface.glsl-5240abb1.js"),[]));let $a=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.transparencyPassType=zt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([X({count:H.COUNT})],$a.prototype,"output",void 0),u([X({count:zt.COUNT})],$a.prototype,"transparencyPassType",void 0),u([X()],$a.prototype,"spherical",void 0),u([X()],$a.prototype,"receiveShadows",void 0),u([X()],$a.prototype,"hasSlicePlane",void 0),u([X()],$a.prototype,"transparent",void 0),u([X()],$a.prototype,"enableOffset",void 0),u([X()],$a.prototype,"writeDepth",void 0),u([X()],$a.prototype,"hasScreenSpaceReflections",void 0),u([X()],$a.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X()],$a.prototype,"hasCloudsReflections",void 0),u([X()],$a.prototype,"isDraped",void 0),u([X()],$a.prototype,"hasMultipassTerrain",void 0),u([X()],$a.prototype,"cullAboveGround",void 0),u([X({constValue:Ot.Water})],$a.prototype,"pbrMode",void 0),u([X({constValue:!0})],$a.prototype,"useCustomDTRExponentForWater",void 0),u([X({constValue:!0})],$a.prototype,"highStepCount",void 0),u([X({constValue:!1})],$a.prototype,"useFillLights",void 0);let wMt=class extends Tw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const i=b(e.cloudsFade.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(XLe,e)}},JLe=class extends gne{constructor(e){super(e,new KLe),this._configuration=new $a,this.animation=new gPe}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<Oz,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<xMt;const r=this.animation.advance(e);return this.setParameters({timeElapsed:pee(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,i){switch(i){case H.Normal:return e===Ie.DRAPED_WATER;case H.Color:if(this.parameters.isDraped)return e===Ie.DRAPED_MATERIAL;break;case H.Alpha:break;case H.Highlight:return e===Ie.OPAQUE_MATERIAL||e===Ie.DRAPED_MATERIAL;default:return!1}let r=Ie.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new wMt(e)}createBufferWriter(){return new nO(cMt)}},KLe=class extends tO{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=nr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=di(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const xMt=35e3;let _ne=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function sge(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const s=e.get(r.to);s&&(r.to=s.to,e.delete(s.from),t.removeUnordered(s),i=!0)})}let nge=class extends _ne{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return b(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return b(this.geometry.occludees)}},TMt=class{constructor(){this.first=0,this.count=0}},SMt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new vi({allocator:e=>e||new _ne,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=a4(),this.drawCommandsHighlight=a4(),this.drawCommandsOccludees=a4(),this.drawCommandsShadowHighlightRest=a4()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return b(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(oge(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),oge(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function EMt(t){return b(t.vao)}function a4(){return new vi({allocator:t=>t||new TMt,deallocator:t=>t})}function oge(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(CMt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function CMt(t,e){return t.first+t.count>=e.from}let MMt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const AMt=o6+1;let OMt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=e.newCache(`VaoCache ${nh()}`,RMt)}dispose(){this._cache.destroy()}newVao(e){const i=e.toString(),r=this._cache.pop(i);if(b(r)){const n=r.pop();return r.length>0&&this._cache.put(i,r,e*r.length,AMt),n}const s=new km(this._rctx,this._locations,{geometry:this._layout},{geometry:yr.createVertex(this._rctx,or.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(A(e))return null;const i=e.size,r=i.toString(),s=this._cache.pop(r);return b(s)?(s.push(e),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[e],i,-1),null}};function RMt(t,e){if(e===t_.ALL)return void t.forEach(s=>s.dispose());const i=t.pop(),r=t.length*i.size;return i.dispose(),r}let QLe=class{constructor(e,i,r){this._rctx=e,this._materialRepository=i,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new BLe(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new OMt(e,r.vertexAttributeLocations,vh(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new oMt(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(i=>i.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof JLe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ks.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var s;const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const n of e){const o=n.renderGeometry,a=(s=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:s.findBuffer(o.id);if(A(a))return;const l=a.instances.get(o.id);if(n.updateType&(Fo.GEOMETRY|Fo.TRANSFORMATION)){const c=h4(i.elementCount(l.geometry.geometry)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(Fo.HIGHLIGHT|Fo.OCCLUDEE|Fo.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){var s;const r=new Z3;for(const n of e){const o=n.localOrigin;if(A(o))continue;let a=r.get(o.id,null);A(a)&&(a=new age(o.vec3),r.set(o.id,null,a)),a.changes.push(n)}for(const n of i){const o=n.localOrigin;if(A(o))continue;const a=(s=this._dataByOrigin.get(o.id))==null?void 0:s.findBuffer(n.id);if(A(a))continue;let l=r.get(o.id,a);A(l)&&(l=new age(o.vec3),r.set(o.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=b(c)?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),A(m))return void Rt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),g$(d.buffers,m),void(d.buffers.length===0&&h.length===0&&s.delete(l));const g=m.numElements,y=m.vao.size/4,v=h.reduce((C,R)=>C+r.elementCount(R.geometry),0),x=f.changes.reduce((C,R)=>C+r.elementCount(R.geometry),0),S=Math.min((g+v-x)*n,u4),E=S>y;S>W9&&S<y/2?(f.changes.forEach(({id:C})=>m.deleteInstance(C)),m.instances.forEach(({geometry:C})=>h.push(C)),this._vaoCache.deleteVao(m.vao),g$(d.buffers,m)):E?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(A(d)&&(d=new MMt(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new SMt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,ua(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(b(r))for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(u4/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),y=s.elementCount(g.geometry);if(l+y>a&&l>0){i.push(g);break}l+=y;const v=new nge(g,0,0);Rt(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,h=h4(c),d=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,d,f);const v=f;f+=s.elementCount(g.geometry.geometry),e.updateInstance(y,v,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(cge(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.size/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=ig.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=ig.pushNew();d.from=c.from,d.to=c.to}sge(ig);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=ig.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=h4(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;ig.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(ig.data,ig.length),ig.forAll((a,l)=>ig.data[l]=null),ig.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0)return;if(!EMt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((x,S)=>x+r.elementCount(S.geometry),0),a=Math.min((n+o)*s,u4),l=4*a;if(e.vao.size<cge(u4-W9)&&l>e.vao.size)return void this._applyAndRebuild(e,i,null);sge(e.holes);const c=new Array;for(const x of i){const S=r.elementCount(x.geometry),E=PMt(e.holes,S);c.push(E)}const h=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const g=h4(a),y=r.vertexBufferLayout.createView(g.buffer);i.forEach((x,S)=>{const E=c[S];if(A(E))return;if(m!==E){const O=m-f;O>0&&h.setSubData(g,f*s,0,O*s),f=E,d=0}const C=r.elementCount(x.geometry);this._writeGeometry(x,y,d),d+=C,m=E+C;const R=new nge(x,E,E+C);Rt(e.instances.get(x.id)==null),e.addInstance(x.id,R),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(g,f*s,0,v*s),$Ge(i,(x,S)=>A(c[S]))}_writeGeometry(e,i,r){const s=e.localOrigin.vec3;ivt(lge,-s[0],-s[1],-s[2]);const n=ln(IMt,lge,e.transformation);Va(l4,n),hh(l4,l4),this._bufferWriter.write(n,l4,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,i){return this.material.requiresSlot(e,i)}render(e,i){var c;if(!this.requiresSlot(i.slot,e))return!1;const r=e===H.Highlight||e===H.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const s=e===H.ShadowExcludeHighlight,n=!(r||s),o=this._rctx;let a;const l=()=>{if(b(a))return a;const h=this._glMaterials.load(o,i.slot,e);return A(h)?null:(a=h.beginSlot(i),A(a)?null:(o.bindTechnique(a,this.material.parameters,i),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const d of h.buffers){if(r&&!d.hasHighlights)continue;const f=(r?d.drawCommandsHighlight:s&&d.needsMultipleCommands()?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,m=n&&d.drawCommandsOccludees||null;if(f!=null&&f.length||m!=null&&m.length){const g=l();if(A(g))return!1;g.program.bindDraw(new UK(h.origin),i,this.material.parameters),g.ensureAttributeLocations(d.vao),o.bindVAO(d.vao),f!=null&&f.length&&(g.bindPipelineState(o,i.slot,!1),f.forAll(y=>o.drawArrays(g.primitiveType,y.first,y.count))),m!=null&&m.length&&(g.bindPipelineState(o,i.slot,!0),m.forAll(y=>o.drawArrays(g.primitiveType,y.first,y.count)))}}return b(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},age=class{constructor(e){this.origin=e,this.changes=new Array}};function PMt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const lge=Ge(),IMt=Ge(),l4=Ge(),ig=new vi({allocator:t=>t||new _ne,deallocator:null}),W9=65536,c4=4*W9,eDe=16777216,u4=eDe/4;let Fj=new Float32Array(W9);function h4(t){return Fj.length<t&&(Fj=new Float32Array(t)),Fj}function cge(t){const e=4*t;return e<c4?c4:Math.max(Math.min(Math.ceil(1.5*e/c4)*c4,eDe),e)}let Bh=class extends Ee{constructor(e){super(e),this._pending=new $Mt,this._changes=new FK,this._materialRenderers=new Map,this._sortedMaterialRenderers=new vi,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return ua(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=zLe(this._changes);let i=!1,r=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new QLe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),i=!0,r=!0,s=!0),!a)return;const l=r||a.hasHighlights,c=s||a.hasWater;a.modify(n),r=r||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=ua(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=ua(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===Js.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===Js.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Fo.TRANSFORMATION:case Fo.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Fo.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}render(e){this._sortedMaterialRenderers.forAll(i=>{i.material.shouldRender(e)&&i.render(e.output,e.bindParameters)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((i,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(i)}),this._sortedMaterialRenderers.sort((i,r)=>{const s=r.material.renderPriority-i.material.renderPriority;return s!==0?s:i.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],Uj[0]=r[0]-s,Uj[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Uj,(l,c,h)=>{LMt(i,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(A(this.drapeSource.notifyGraphicGeometryChanged))return;let i;for(const r of e){const s=r.graphicUid;b(s)&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(A(this.drapeSource.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const s=r.graphicUid;b(s)&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return A(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([p()],Bh.prototype,"drapeSource",void 0),u([p()],Bh.prototype,"updating",null),u([p()],Bh.prototype,"rctx",null),u([p()],Bh.prototype,"rendererContext",void 0),u([p()],Bh.prototype,"_materialRepository",null),u([p()],Bh.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],Bh.prototype,"isEmpty",null),u([p()],Bh.prototype,"_materialRenderers",void 0),u([p()],Bh.prototype,"_geometries",void 0),Bh=u([N("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Bh);let $Mt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function LMt(t,e,i,r,s,n,o){const a=new rMt(n,o,e),l=c=>{c.set(Vs.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Ga.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Ga.ALL){const c=bse(s.ray);l(c),s.results.all.push(c)}}const Uj=je(),kj=4;function DMt(){const t=new ar,e=t.fragment;t.include(Qp);const i=(kj+1)/2,r=1/(2*i*i);return e.include(Sd),e.uniforms.add([new Yt("depthMap",s=>s.depthTexture),new TD("tex",s=>s.colorTexture),new X$("blurSize",s=>s.blurSize),new Be("projScale",(s,n)=>{const o=Wr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new hr("nearFar",(s,n)=>n.camera.nearFar)]),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(kj)}; r <= ${T.int(kj)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const NMt=Object.freeze(Object.defineProperty({__proto__:null,build:DMt},Symbol.toStringTag,{value:"Module"}));let tDe=class iDe extends dr{initializeProgram(e){return new cr(e.rctx,iDe.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};tDe.shader=new lr(NMt,()=>se(()=>import("./SSAOBlur.glsl-494472b3.js"),[]));const FMt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function Uz(t){t.fragment.uniforms.add(new Ni("projInfo",(e,i)=>UMt(i))),t.fragment.uniforms.add(new hr("zScale",(e,i)=>rDe(i))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function UMt(t){const e=t.camera.projectionMatrix;return e[11]===0?Rr(uge,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Rr(uge,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const uge=Ai();function rDe(t){return t.camera.projectionMatrix[11]===0?Vt(hge,0,1):Vt(hge,1,0)}const hge=je(),dge=16;function kMt(){const t=new ar,e=t.fragment;return t.include(Qp),e.include(Sd),t.include(Uz),e.uniforms.add(new Be("radius",(i,r)=>vne(r.camera))),e.code.add(T`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new hr("nearFar",(i,r)=>r.camera.nearFar),new Yt("normalMap",i=>i.normalTexture),new Yt("depthMap",i=>i.depthTexture),new hr("zScale",(i,r)=>rDe(r)),new Be("projScale",i=>i.projScale),new Yt("rnm",i=>i.noiseTexture),new hr("rnmScale",(i,r)=>Vt(pge,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Be("intensity",i=>i.intensity),new hr("screenSize",(i,r)=>Vt(pge,r.camera.fullWidth,r.camera.fullHeight))]),e.code.add(T`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(dge)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(dge)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function vne(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const pge=je(),VMt=Object.freeze(Object.defineProperty({__proto__:null,build:kMt,getRadius:vne},Symbol.toStringTag,{value:"Module"}));let sDe=class nDe extends dr{initializeProgram(e){return new cr(e.rctx,nDe.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};sDe.shader=new lr(VMt,()=>se(()=>import("./SSAO.glsl-a433f855.js"),[]));let zMt=class extends Br{constructor(){super(...arguments),this.projScale=1}},BMt=class extends zMt{constructor(){super(...arguments),this.intensity=1}},GMt=class extends Br{},jMt=class extends GMt{constructor(){super(...arguments),this.blurSize=je()}};const KP=2;let oDe=class{constructor(e,i,r,s){this._view=e,this._techniqueRepository=i,this._rctx=r,this._requestRender=s,this._quadVAO=null,this._passParameters=new BMt,this._drawParameters=new jMt}dispose(){this.enabled=!1,this._quadVAO=dt(this._quadVAO)}disposeOffscreenBuffers(){fa(this._ssaoFBO,e=>e.resize(0,0)),fa(this._blur0FBO,e=>e.resize(0,0)),fa(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return b(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return b(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,i,r,s){if(A(this._enableTime)||A(r)||A(s)||A(this._ssaoFBO)||A(this._blur0FBO)||A(this._blur1FBO))return;if(!this.active)return this._enableTime=i,void this._requestRender();this._enableTime===0&&(this._enableTime=i);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,i-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=r,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*HMt/vne(o)**6*l;const c=o.fullViewport,h=c[2],d=c[3],f=h/KP,m=d/KP;this._ssaoFBO.resize(h,d),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),A(this._quadVAO)&&(this._quadVAO=ql(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,d),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const g=il(this._quadVAO,"geometry");n.drawArrays(Xt.TRIANGLE_STRIP,0,g);const y=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,Vt(this._drawParameters.blurSize,0,KP/d),y.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(Xt.TRIANGLE_STRIP,0,g),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,Vt(this._drawParameters.blurSize,KP/h,0),y.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(Xt.TRIANGLE_STRIP,0,g),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(b(this._enableTime))return;const e={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE};this._ssaoFBO=new Sn(this._rctx,i,e),this._blur0FBO=new Sn(this._rctx,i,e),this._blur1FBO=new Sn(this._rctx,i,e);const r=Uint8Array.from(atob(FMt),s=>s.charCodeAt(0));this._passParameters.noiseTexture=new At(this._rctx,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGB,dataType:Zt.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},r),A(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(sDe)),A(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(tDe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=dt(this._passParameters.noiseTexture),this._blur1FBO=dt(this._blur1FBO),this._blur0FBO=dt(this._blur0FBO),this._ssaoFBO=dt(this._ssaoFBO)}get gpuMemoryUsage(){return(b(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(b(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(b(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const HMt=.5;let bne=class aDe extends dr{initializeProgram(e){return new cr(e.rctx,aDe.shader.get().build(),rr)}initializePipeline(){return this.configuration.hasAlpha?si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi}):si({colorWrite:wi})}};bne.shader=new lr(y2t,()=>se(()=>import("./TextureOnly.glsl-825443f5.js"),[]));let wne=class extends Hl{constructor(){super(...arguments),this.hasAlpha=!1}};u([X()],wne.prototype,"hasAlpha",void 0);let $f=class extends Ee{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new ir,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new vi,this._passParameters=new Xse,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new jt,this.worldToPCSRatio=1,this.events=new ws,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const i=e.waterTextureRepository;this._stippleTextureRepository=new SLe(e.renderingContext),this._shaderTechniqueRepository=new _Le({rctx:this._rctx,viewingMode:it.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:i}),this._renderContext=new kLe(this._rctx,new mne(this._rctx,this.view.state.viewingMode),new oDe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ae(()=>i.updating,()=>this.events.emit("content-changed"),Tr),ae(()=>this.spatialReference,r=>this._localOriginFactory=new fne(r),Tr),Gs(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new vLe(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&Y9)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ie.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=lRe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=zt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Jre(Ve(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Nt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Os(this._debugTextureTechnique),this._passParameters.texture=dt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=dt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=He(this._shaderTechniqueRepository),this._temporaryFBO=dt(this._temporaryFBO),this._quadVAO=dt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||ua(this._renderers,e=>e.updating)}get hasOverlays(){return b(this._overlays)&&b(this._overlayRenderTarget)}get gpuMemoryUsage(){return b(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Bh)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);b(s)&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ae(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(A(e))return;const i=this._renderers.get(e);A(i)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),i.destroy())}collectUnusedRenderTargetMemory(e){let i=!1;if(b(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[s,n]=this.overlays,o=s.validTargets[r.type]||!n.validTargets[r.type];i=this._overlayRenderTarget.validateUsageForTarget(o,r,e)||i}return i}get overlays(){return vt(this._overlays,[])}ensureDrapeTargets(e){b(this._overlays)&&this._overlays.forEach(i=>i.hasTargetWithoutRasterImage=A5(e,r=>r.drapeTargetType===$K.WithoutRasterImage))}ensureDrapeSources(e){b(this._overlays)&&this._overlays.forEach(i=>{i.hasDrapedFeatureSource=A5(e,r=>r.drapeSourceType===JI.Features),i.hasDrapedRasterSource=A5(e,r=>r.drapeSourceType===JI.RasterImage)})}ensureOverlays(e,i){A(this._overlays)&&(this._overlayRenderTarget=new pCt(this._rctx),this._overlays=[new Ume(ks.INNER,this._overlayRenderTarget),new Ume(ks.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=dt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(b(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(gc,e=>e.updatePolicy===Db.SYNC)}get isEmpty(){return!_r.OVERLAY_DRAW_DEBUG_TEXTURE&&!ua(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,i,r){const s=e.canvasGeometries;if(s.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=i.output;if(this.isEmpty||n===H.Highlight&&!this.hasHighlights||n===H.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=i.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===H.Normal?Ie.DRAPED_WATER:Ie.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===ks.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(_s.COLOR_BUFFER_BIT)),i.type===an.Occluded&&(this._renderContext.renderOccludedMask=Y9),_r.OVERLAY_DRAW_DEBUG_TEXTURE&&i.type!==an.Occluded)for(let h=0;h<s.numViews;h++)this._setViewParameters(s.extents[h],e),this._drawDebugTexture(e.resolution,WMt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:d})=>{if(i.type===an.ColorNoRasterImage&&h.drapeSourceType===JI.RasterImage)return;const{fullOpacity:f}=h,m=b(f)&&f<1&&n===H.Color;m&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(_s.COLOR_BUFFER_BIT));for(let g=0;g<s.numViews;g++)this._setViewParameters(s.extents[g],e),d.render(this._renderContext);m&&b(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),f,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,i,r){A(this._temporaryFBO)&&(this._temporaryFBO=new yLe(e,!1)),this._temporaryFBO.resize(i,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const s=e.indexOf(r.layer),n=s>=0,o=this._renderers.size*(r.renderGroup??(n?G9.MapLayer:G9.ViewLayer))+(n?s:0);this._sortedRenderers.push(new qMt(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],UTe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),cV(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ua(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=ua(this._renderers,i=>i.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=ua(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,i){this._ensureDebugPatternResources(e,e,i);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(Xt.TRIANGLE_STRIP,0,il(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,i,r){if(fe(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const s=new Uint8Array(e*i*4);let n=0;for(let a=0;a<i;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>i-20?(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=255):(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}this._passParameters.texture=new At(this._rctx,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:e,height:i},s);const o=new wne;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(bne,o),this._quadVAO=ql(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([p()],$f.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({autoDestroy:!0})],$f.prototype,"_shaderTechniqueRepository",void 0),u([p({autoDestroy:!0})],$f.prototype,"_stippleTextureRepository",void 0),u([p({constructOnly:!0})],$f.prototype,"view",void 0),u([p()],$f.prototype,"worldToPCSRatio",void 0),u([p()],$f.prototype,"spatialReference",void 0),u([p({type:Boolean,readOnly:!0})],$f.prototype,"updating",null),u([p()],$f.prototype,"isEmpty",null),$f=u([N("esri.views.3d.terrain.OverlayRenderer")],$f);let qMt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const WMt=[[1,.5,.5],[.5,.5,1]],xne=-2,Y9=Ks.OccludeAndTransparent;function Tne(t,e,i,r){const s=ND(t.rings,!!t.hasZ,Ry.CCW_IS_HOLE),n=fh(s.position.length),o=W$e(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new ZMt(s.position,n,uDe(s.polygons,s.position,n),cDe(s.outlines,s.position,n),a,o)}function lDe(t,e){const i=ND(t.rings,!1,Ry.CCW_IS_HOLE),r=un(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=xne;return{position:i.position,polygons:uDe(i.polygons,i.position),outlines:cDe(i.outlines,i.position),projectionSuccess:r}}function cDe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return b(i)?new hDe(r,s,Ip(e,n,o),Ip(i,n,o)):new Sne(r,s,Ip(e,n,o))})}function uDe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),d=b(i)?new YMt(s,n,Ip(e,3*s,3*n),Ip(i,l,c),h,a):new XMt(s,n,Ip(e,3*s,3*n),h,a);r.push(d)}return r}let Sne=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},hDe=class extends Sne{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},YMt=class extends hDe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},XMt=class extends Sne{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},ZMt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function dDe(t,e){const i=t.fragment;switch(i.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case tn.None:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case tn.View:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case tn.WindingOrder:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case tn.COUNT:}}var tn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(tn||(tn={}));function pDe(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let JMt=class extends Hl{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function fDe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(P.MODELORIGINHI,"vec3"),t.attributes.add(P.MODELORIGINLO,"vec3"),t.attributes.add(P.MODEL,"mat3"),t.attributes.add(P.MODELNORMAL,"mat3"));const i=t.vertex;e.instancedDoublePrecision&&(i.include(y9,e),i.uniforms.add(new gd("viewOriginHi",(r,s)=>lvt(fe(d4,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),d4))),i.uniforms.add(new gd("viewOriginLo",(r,s)=>cvt(fe(d4,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),d4)))),i.code.add(T`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(T`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?T`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===H.Normal&&(o3(i),i.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&i.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([X()],JMt.prototype,"instancedDoublePrecision",void 0);const d4=$();var vo;function KMt(t){switch(t){case"multiply":default:return vo.Multiply;case"ignore":return vo.Ignore;case"replace":return vo.Replace;case"tint":return vo.Tint}}function mDe(t,e,i){if(A(t)||e===vo.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Se(Math.round(t[3]*X9),0,X9),s=r===0||e===vo.Tint?0:e===vo.Replace?QMt:eAt;i[0]=Se(Math.round(t[0]*SE),0,SE),i[1]=Se(Math.round(t[1]*SE),0,SE),i[2]=Se(Math.round(t[2]*SE),0,SE),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(vo||(vo={}));const SE=255,X9=85,QMt=X9,eAt=2*X9;function gDe(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(vo.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(vo.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(vo.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(vo.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function yDe(t,e){e.hasSymbolColors?(t.include(gDe),t.attributes.add(P.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new UD("colorMixMode",i=>i$e[i.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function LS(t,e){e.hasVertexColors?(t.attributes.add(P.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function tAt(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(sl)}) { discard; } }
  `)}let T2=class extends dn{constructor(e,i){super(e,"float",Vr.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function S2(t,e){_De(t,e,new Be("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function iAt(t,e){_De(t,e,new T2("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function _De(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Nr.Mask&&e.alphaDiscardMode!==Nr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Nr.Blend:return t.include(tAt);case Nr.Opaque:r.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Nr.Mask:r.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Nr.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function vDe(t,e){const{vertex:i,fragment:r}=t,s=e.hasModelTransformation;s&&i.uniforms.add(new Ps("model",o=>b(o.modelTransformation)?o.modelTransformation:xd));const n=e.hasColorTexture&&e.alphaDiscardMode!==Nr.Opaque;switch(e.output){case H.Depth:case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:case H.ObjectAndLayerIdColor:ah(i,e),t.include(au,e),t.include(gy,e),t.include(uA,e),t.include(X_,e),t.include(Un,e),t.include(Cz,e),rS(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new Yt("tex",o=>o.texture)),i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(S2,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===H.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case H.Normal:ah(i,e),t.include(au,e),t.include(FD,e),t.include(Nz,e),t.include(gy,e),t.include(uA,e),n&&r.uniforms.add(new Yt("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===Pr.Attribute?T`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Un,e),t.include(S2,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Pr.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case H.Highlight:ah(i,e),t.include(au,e),t.include(gy,e),t.include(uA,e),n&&r.uniforms.add(new Yt("tex",o=>o.texture)),i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Un,e),t.include(S2,e),t.include(pv,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function bDe(t,e){const i=t.fragment;if(e.hasVertexTangents?(t.attributes.add(P.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===tn.WindingOrder?i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==Nn.None){t.include(qre,e);const r=e.supportsTextureAtlas?e.hasWebGL2Context?Ar.None:Ar.Size:Ar.None;i.uniforms.add(e.pbrTextureBindType===Vr.Pass?ym("normalTexture",s=>s.textureNormal,r):$b("normalTexture",s=>s.textureNormal,r)),i.code.add(T`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?T`vtc.size = ${Pp(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function kD(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(ym("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture,e.hasWebGL2Context?Ar.None:Ar.InvSize)),i.constants.add("blurSizePixelsInverse","float",1/KP),i.code.add(T`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Pp(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):i.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function VD(t){t.constants.add("ambientBoostFactor","float",FRe)}function oO(t){t.uniforms.add(new Be("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function uS(t,e){const i=t.fragment;switch(t.include(kD,e),e.pbrMode!==Ot.Disabled&&t.include(yne,e),t.include(Xre,e),t.include(SD),i.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),VD(i),oO(i),nv(i),i.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Uy(i),i.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Ot.Disabled:case Ot.WaterOnIntegratedMesh:case Ot.Water:t.include(d9,e),i.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Ot.Normal:case Ot.Schematic:i.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new E_("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new Be("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Be("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Ot.Schematic?T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Ot.Terrain:case Ot.TerrainWithWater:t.include(d9,e),i.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Ot.COUNT:}}function rAt(t){t.vertex.uniforms.add(new Vy("colorTextureTransformMatrix",e=>b(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:cu())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function sAt(t){t.vertex.uniforms.add(new Vy("normalTextureTransformMatrix",e=>b(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:cu())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function nAt(t){t.vertex.uniforms.add(new Vy("emissiveTextureTransformMatrix",e=>b(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:cu())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function oAt(t){t.vertex.uniforms.add(new Vy("occlusionTextureTransformMatrix",e=>b(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:cu())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function aAt(t){t.vertex.uniforms.add(new Vy("metallicRoughnessTextureTransformMatrix",e=>b(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:cu())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function gL(t){t.include(ky),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(vo.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(vo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(vo.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(vo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(vo.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function lAt(t){const e=new ar,{vertex:i,fragment:r,varyings:s}=e;return ah(i,t),e.include(ED),s.add("vpos","vec3"),e.include(uA,t),e.include(fDe,t),e.include(WIe,t),t.hasColorTextureTransform&&e.include(rAt),t.output!==H.Color&&t.output!==H.Alpha||(t.hasNormalTextureTransform&&e.include(sAt),t.hasEmissionTextureTransform&&e.include(nAt),t.hasOcclusionTextureTransform&&e.include(oAt),t.hasMetallicRoughnessTextureTransform&&e.include(aAt),$m(i,t),e.include(FD,t),e.include(au,t),t.normalType===Pr.Attribute&&t.offsetBackfaces&&e.include(pDe),e.include(bDe,t),e.include(Nz,t),t.instancedColor&&e.attributes.add(P.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),e.include(gy,t),e.include(X3,t),e.include(yDe,t),e.include(LS,t),i.uniforms.add(new Ni("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float"),t.hasModelTransformation&&i.uniforms.add(new Ps("model",n=>b(n.modelTransformation)?n.modelTransformation:xd)),i.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(sl)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===Pr.Attribute?T`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===Pr.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?T`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?T`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?T`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?T`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?T`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===H.Alpha&&(e.include(Un,t),e.include(S2,t),e.include(Ed,t),r.uniforms.add([new Be("opacity",n=>n.opacity),new Be("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Yt("tex",n=>n.texture)),r.include(gL),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===H.Color&&(e.include(Un,t),e.include(uS,t),e.include(kD,t),e.include(S2,t),e.include(t.instancedDoublePrecision?Fz:cS,t),e.include(Ed,t),$m(r,t),r.uniforms.add([i.uniforms.get("localOrigin"),new fi("ambient",n=>n.ambient),new fi("diffuse",n=>n.diffuse),new Be("opacity",n=>n.opacity),new Be("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Yt("tex",n=>n.texture)),e.include(Yre,t),e.include(yne,t),r.include(gL),e.include(dDe,t),VD(r),oO(r),Uy(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Pr.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(localvpos);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===zt.Color?T`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include(vDe,t),e}const cAt=Object.freeze(Object.defineProperty({__proto__:null,build:lAt},Symbol.toStringTag,{value:"Module"}));let uAt=class extends GLe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ve(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ts.Back,this.emissiveFactor=Ve(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Pr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ve(.2,.2,.2),this.diffuse=Ve(.8,.8,.8),this.externalColor=di(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Hs(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Q2.Less,this.textureAlphaMode=Nr.Blend,this.textureAlphaCutoff=V9,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ks.Occlude}},hAt=class extends jLe{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}},Ene=class wDe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Nn.Default:Nn.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,wDe.shader)}_initializeProgram(e,i){return new cr(e.rctx,i.get().build(this.configuration),rr)}_convertDepthTestFunction(e){return e===Q2.Lequal?hs.LEQUAL:hs.LESS}_makePipeline(e,i){const r=this.configuration,s=e===zt.NONE,n=e===zt.FrontFace;return si({blending:r.output!==H.Color&&r.output!==H.Alpha||!r.transparent?null:s?yd:fv(e),culling:dAt(r)?iz(r.cullFace):null,depthTest:{func:Ew(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?gu:null,colorWrite:wi,stencilWrite:r.hasOccludees?Py:null,stencilTest:r.hasOccludees?i?fw:Cw:null,polygonOffset:s||n?null:Pz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};function dAt(t){return t.cullFace!==ts.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Ene.shader=new lr(cAt,()=>se(()=>import("./DefaultMaterial.glsl-4e85a08c.js"),[]));let gi=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.alphaDiscardMode=Nr.Opaque,this.doubleSidedMode=tn.None,this.pbrMode=Ot.Disabled,this.cullFace=ts.None,this.transparencyPassType=zt.NONE,this.normalType=Pr.Attribute,this.textureCoordinateType=Nn.None,this.customDepthTest=Q2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([X({count:H.COUNT})],gi.prototype,"output",void 0),u([X({count:Nr.COUNT})],gi.prototype,"alphaDiscardMode",void 0),u([X({count:tn.COUNT})],gi.prototype,"doubleSidedMode",void 0),u([X({count:Ot.COUNT})],gi.prototype,"pbrMode",void 0),u([X({count:ts.COUNT})],gi.prototype,"cullFace",void 0),u([X({count:zt.COUNT})],gi.prototype,"transparencyPassType",void 0),u([X({count:Pr.COUNT})],gi.prototype,"normalType",void 0),u([X({count:Nn.COUNT})],gi.prototype,"textureCoordinateType",void 0),u([X({count:Q2.COUNT})],gi.prototype,"customDepthTest",void 0),u([X()],gi.prototype,"spherical",void 0),u([X()],gi.prototype,"hasVertexColors",void 0),u([X()],gi.prototype,"hasSymbolColors",void 0),u([X()],gi.prototype,"hasVerticalOffset",void 0),u([X()],gi.prototype,"hasSlicePlane",void 0),u([X()],gi.prototype,"hasSliceHighlight",void 0),u([X()],gi.prototype,"hasColorTexture",void 0),u([X()],gi.prototype,"hasMetallicRoughnessTexture",void 0),u([X()],gi.prototype,"hasEmissionTexture",void 0),u([X()],gi.prototype,"hasOcclusionTexture",void 0),u([X()],gi.prototype,"hasNormalTexture",void 0),u([X()],gi.prototype,"hasScreenSizePerspective",void 0),u([X()],gi.prototype,"hasVertexTangents",void 0),u([X()],gi.prototype,"hasOccludees",void 0),u([X()],gi.prototype,"hasMultipassTerrain",void 0),u([X()],gi.prototype,"hasModelTransformation",void 0),u([X()],gi.prototype,"offsetBackfaces",void 0),u([X()],gi.prototype,"vvSize",void 0),u([X()],gi.prototype,"vvColor",void 0),u([X()],gi.prototype,"receiveShadows",void 0),u([X()],gi.prototype,"receiveAmbientOcclusion",void 0),u([X()],gi.prototype,"textureAlphaPremultiplied",void 0),u([X()],gi.prototype,"instanced",void 0),u([X()],gi.prototype,"instancedColor",void 0),u([X()],gi.prototype,"objectAndLayerIdColorInstanced",void 0),u([X()],gi.prototype,"instancedDoublePrecision",void 0),u([X()],gi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X()],gi.prototype,"writeDepth",void 0),u([X()],gi.prototype,"transparent",void 0),u([X()],gi.prototype,"enableOffset",void 0),u([X()],gi.prototype,"cullAboveGround",void 0),u([X()],gi.prototype,"snowCover",void 0),u([X()],gi.prototype,"hasColorTextureTransform",void 0),u([X()],gi.prototype,"hasEmissionTextureTransform",void 0),u([X()],gi.prototype,"hasNormalTextureTransform",void 0),u([X()],gi.prototype,"hasOcclusionTextureTransform",void 0),u([X()],gi.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([X({constValue:!0})],gi.prototype,"hasVvInstancing",void 0),u([X({constValue:!1})],gi.prototype,"useCustomDTRExponentForWater",void 0),u([X({constValue:!1})],gi.prototype,"supportsTextureAtlas",void 0),u([X({constValue:!0})],gi.prototype,"useFillLights",void 0);function pAt(t){const e=new ar,{vertex:i,fragment:r,varyings:s}=e;return ah(i,t),e.include(ED),s.add("vpos","vec3"),e.include(uA,t),e.include(fDe,t),e.include(WIe,t),t.output!==H.Color&&t.output!==H.Alpha||($m(e.vertex,t),e.include(FD,t),e.include(au,t),t.offsetBackfaces&&e.include(pDe),t.instancedColor&&e.attributes.add(P.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(gy,t),e.include(X3,t),e.include(yDe,t),e.include(LS,t),i.uniforms.add(new Ni("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(sl)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===H.Alpha&&(e.include(Un,t),e.include(S2,t),e.include(Ed,t),r.uniforms.add([new Be("opacity",n=>n.opacity),new Be("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Yt("tex",n=>n.texture)),r.include(gL),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===H.Color&&(e.include(Un,t),e.include(uS,t),e.include(kD,t),e.include(S2,t),e.include(t.instancedDoublePrecision?Fz:cS,t),e.include(Ed,t),$m(e.fragment,t),nv(r),VD(r),oO(r),r.uniforms.add([i.uniforms.get("localOrigin"),i.uniforms.get("view"),new fi("ambient",n=>n.ambient),new fi("diffuse",n=>n.diffuse),new Be("opacity",n=>n.opacity),new Be("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Yt("tex",n=>n.texture)),e.include(Yre,t),e.include(yne,t),r.include(gL),e.extensions.add("GL_OES_standard_derivatives"),Uy(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===zt.Color?T`gl_FragColor = premultiplyAlpha(gl_FragColor);`:T``}
      }
    `)),e.include(vDe,t),e}const fAt=Object.freeze(Object.defineProperty({__proto__:null,build:pAt},Symbol.toStringTag,{value:"Module"}));let xDe=class TDe extends Ene{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Pr.Attribute,i.doubleSidedMode=tn.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,TDe.shader)}};xDe.shader=new lr(fAt,()=>se(()=>import("./RealisticTree.glsl-22e125d4.js"),[]));let Z_=class extends Sw{constructor(e){super(e,yAt),this.supportsEdges=!0,this._configuration=new gi,this._vertexBufferLayout=_At(this.parameters)}isVisibleForOutput(e){return e!==H.Shadow&&e!==H.ShadowExcludeHighlight&&e!==H.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=e,o=b(i)&&i.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=b(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=b(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,b(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?ts.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=b(this.parameters.modelTransformation),e!==H.Color&&e!==H.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=tn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?tn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?tn.WindingOrder:tn.None,this._configuration.instancedColor=b(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ot.Schematic:Ot.Normal:Ot.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<Oz,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return b(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(b(this.parameters.verticalOffset)){const a=r.camera;fe(zj,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case it.Global:l=Re(fge,zj);break;case it.Local:l=ge(fge,wAt)}let c=0;const h=be(xAt,zj,a.eye),d=ze(h),f=pe(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=xe(l,f)),c+=e$e(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),pe(l,l,c),th(Vj,l,r.transform.inverseRotation),s=be(vAt,s,Vj),n=be(bAt,n,Vj)}ZIe(e,r,s,n,uK(r.verticalOffset),o)}requiresSlot(e,i){return i===H.Color||i===H.Alpha||i===H.Depth||i===H.Normal||i===H.Shadow||i===H.ShadowHighlight||i===H.ShadowExcludeHighlight||i===H.Highlight||i===H.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ie.OPAQUE_MATERIAL)||e===Ie.DRAPED_MATERIAL:!1}createGLMaterial(e){return new mAt(e)}createBufferWriter(){return new nO(this._vertexBufferLayout)}},mAt=class extends Wre{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==H.Color&&this._output!==H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return fe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?xDe:Ene,e)}},gAt=class extends uAt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const yAt=new gAt;function _At(t){const e=qs().vec3f(P.POSITION).vec3f(P.NORMAL),i=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(P.TANGENT),i&&e.vec2f(P.UV0),t.hasVertexColors&&e.vec4u8(P.COLOR),t.hasSymbolColors&&e.vec4u8(P.SYMBOLCOLOR),me("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(P.OBJECTANDLAYERIDCOLOR),e}const vAt=$(),bAt=$(),wAt=Ve(0,0,1),fge=$(),Vj=$(),zj=$(),xAt=$(),TAt=["polygon","extent"];let SAt=class extends By{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=Iz(this._getSymbolSize());if(a)throw new J("graphics3dextrudesymbollayer:invalid-size",a)}const e=Hn(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e),r=Qc(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?ts.None:ts.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Z_(o),this._bottomMaterial=new Z_({...o,cullFace:ts.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,TAt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i,new zm);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){const r=Hn(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);b(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,hw)}slicePlaneEnabledChanged(e,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=i(r);b(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?sCt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?To.Recreate_Symbol:To.Recreate_Graphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/L2(i),{objectId:o,target:a}=e,l=ue(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,d=ue(c),f=ue(h);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[PK(o,l,1/0,d,f)]}case"vertex":return[gLe(o,l,1/0),PK(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=pL(e.geometry);if(A(o))return null;if(o.rings.length===0||!o.rings.some(ie=>ie.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Tne(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=ene(o);if(A(l))return null;const c=new Array,h=Mo(),d=Ge(),f=$(),m=this._context.renderCoordsHelper.viewingMode===it.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Rm(o.spatialReference,[l.x,l.y,0],d,this._context.renderCoordsHelper.spatialReference);const g=Ge();Va(g,d);const y=Hs();XA(y,g);const{polygons:v,mapPositions:x,position:S}=a,E=S.length/3,C=new Float64Array(3*E*6),R=new Float64Array(3*E*6),O=new Float64Array(3*E*6),U=new Float64Array(1*E*6);let L=0;for(let ie=0;ie<v.length;++ie){const ee=v[ie],K=ee.count;if(this._context.clippingExtent&&(ls(h),ud(h,ee.mapPositions),!sm(h,this._context.clippingExtent)))continue;const Y=dw(ee.mapPositions,ee.holeIndices,3);if(Y.length===0)continue;const D=3*K*2+Y.length,V=new Array(D),k=new Array(Y.length),Z=6*K,Q=3*C.BYTES_PER_ELEMENT,ne=new Bl(C.buffer,L*Q,Q,(L+Z)*Q),te=3*R.BYTES_PER_ELEMENT,de=new Bl(R.buffer,L*te,te,(L+Z)*te),_e=new Float64Array(O.buffer,3*L*O.BYTES_PER_ELEMENT,3*Z),Ce=new Float64Array(U.buffer,1*L*U.BYTES_PER_ELEMENT,1*Z),Pe=this._getExtrusionSize(i);EAt(S,x,Y,ee,ne.typedBuffer,_e,de.typedBuffer,Ce,V,k,Pe,f,m),DD(ne,ne,g),pw(de,de,y),L+=6*K;const Ze=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Le=new RAt(ne.typedBuffer,_e,de.typedBuffer,Ce);c.push(mge(this._material,V,V.length-k.length,Le,r,Ze)),c.push(mge(this._bottomMaterial,k,0,Le,r,Ze))}if(c.length===0)return null;const B=new mv({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});B.transformation=d;const G=aLe(this.symbolLayer,{opacity:this._getLayerOpacity()}),j=b(G)?{baseMaterial:this._material,edgeMaterials:[G],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,q=new zy(this,B,c,null,null,AAt,s,j);return q.alignedSampledElevation=a.sampledElevation,q.needsElevationUpdates=hw(s.mode),q}};function mge(t,e,i,r,s,n){const o=new Array(e.length).fill(0),a=[[P.POSITION,new ct(r.positions,3,!0)],[P.NORMAL,new ct(r.normals,3,!0)],[P.COLOR,new ct(s,4,!0)],[P.SIZE,new ct(r.heights,1,!0)]],l=[[P.POSITION,e],[P.NORMAL,e],[P.COLOR,o]];return new qn(t,a,l,r.elevation,xn.Mesh,n,i)}function EAt(t,e,i,r,s,n,o,a,l,c,h,d,f){const m=i.length/3;let g=0,y=2*r.count;CAt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,y,h,d,f);let v=2*r.count;y=0,gge(s,n,a,o,g,r.pathLengths[0],r.count,v,l,y,h),v+=4*r.pathLengths[0],y+=2*r.pathLengths[0],g+=r.pathLengths[0];for(let x=1;x<r.pathLengths.length;++x)gge(s,n,a,o,g,r.pathLengths[x],r.count,v,l,y,h),v+=4*r.pathLengths[x],y+=2*r.pathLengths[x],g+=r.pathLengths[x]}function CAt(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,y,v){ge(Lc,y);const x=g>0?1:-1;let S=3*i,E=0,C=3*E,R=r,O=3*R;for(let B=0;B<r;++B)v&&(Lc[0]=t[S+0],Lc[1]=t[S+1],Lc[2]=t[S+2],Re(Lc,Lc)),a[C+0]=t[S+0],a[C+1]=t[S+1],a[C+2]=t[S+2],l[C+0]=e[S+0],l[C+1]=e[S+1],l[C+2]=e[S+2],c[C+0]=-x*Lc[0],c[C+1]=-x*Lc[1],c[C+2]=-x*Lc[2],h[E]=0,a[O+0]=t[S+0]+g*Lc[0],a[O+1]=t[S+1]+g*Lc[1],a[O+2]=t[S+2]+g*Lc[2],l[O+0]=e[S+0],l[O+1]=e[S+1],l[O+2]=e[S+2],c[O+0]=x*Lc[0],c[O+1]=x*Lc[1],c[O+2]=x*Lc[2],h[R]=g,C+=3,O+=3,S+=3,E+=1,R+=1;S=3*n,C=0,O=3*m;const U=g<0?xge:wge,L=g<0?wge:xge;for(let B=0;B<o;++B)f[C+0]=s[S+U[0]],f[C+1]=s[S+U[1]],f[C+2]=s[S+U[2]],d[O+0]=s[S+L[0]]+r,d[O+1]=s[S+L[1]]+r,d[O+2]=s[S+L[2]]+r,C+=3,O+=3,S+=3}function p4(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[(n*=3)+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const lR=$();function gge(t,e,i,r,s,n,o,a,l,c,h){let d=s,f=s+1,m=s+o,g=s+o+1,y=a,v=a+1,x=a+2*n,S=a+2*n+1;h<0&&(d=s+o+1,g=s),c*=3;for(let E=0;E<n;++E)E===n-1&&(h>0?(f=s,g=s+o):(f=s,d=s+o)),MAt(t,d,f,m,lR),p4(t,e,r,i,lR,y,d),p4(t,e,r,i,lR,v,f),p4(t,e,r,i,lR,x,m),p4(t,e,r,i,lR,S,g),l[c++]=y,l[c++]=x,l[c++]=S,l[c++]=y,l[c++]=S,l[c++]=v,d++,f++,m++,g++,y+=2,v+=2,x+=2,S+=2}const Bj=$(),yge=$(),_ge=$(),vge=$(),bge=$();function MAt(t,e,i,r,s){e*=3,i*=3,r*=3,fe(Bj,t[e++],t[e++],t[e++]),fe(yge,t[i++],t[i++],t[i++]),fe(_ge,t[r++],t[r++],t[r++]),be(vge,yge,Bj),be(bge,_ge,Bj),Et(s,bge,vge),Re(s,s)}const EE=$();function AAt(t,e,i,r,s){const n=t.stageObject,o=n.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const h=n.transformation,d=C3(Ge(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!ine(m))continue;const g=m.getMutableAttribute(P.POSITION).data,y=m.vertexAttributes.get(P.SIZE).data,v=new fIe(m.mapPositions),x=g.length/3;let S=0,E=!1,C=0;for(let R=0;R<x;R++){EE[0]=g[S],EE[1]=g[S+1],EE[2]=g[S+2],r(v,f4),l&&(C+=f4.sampledElevation),_r.TESTS_DISABLE_OPTIMIZATIONS?(fe(wu,v.array[v.offset+0],v.array[v.offset+1],f4.z+y[S/3]),b(i)&&s.toRenderCoords(wu,i,wu),at(wu,wu,d)):(fe(wu,g[S+0],g[S+1],g[S+2]),at(wu,wu,h),s.setAltitude(wu,f4.z+y[S/3]),at(wu,wu,d)),g[S]=wu[0],g[S+1]=wu[1],g[S+2]=wu[2];const O=OAt/s.unitInMeters;(Math.abs(EE[0]-g[S])>=O||Math.abs(EE[1]-g[S+1])>=O||Math.abs(EE[2]-g[S+2])>=O)&&(E=!0),v.offset+=3,S+=3}E&&(m.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f+1])),c+=C/x}return c/a}const wu=$(),Lc=$(),f4=new LD,wge=[0,2,1],xge=[0,1,2],OAt=.01;let RAt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}};function PAt(t,e,i,r,s){if(A(t))return null;const n=t.referencesGeometry()&&s?IAt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o})}catch(a){return le.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Gj=new Map;function IAt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;Gj.has(e)||Gj.set(e,$At(e));const o=Gj.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function $At(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>N$e(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>F$e(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>U$e(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>D$e(r,e,i,s,n);default:return le.getLogger("esri.views.2d.support.arcadeOnDemand").error(new J("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const sti=1.2,LAt=fy;let kz=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Js.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Fo.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Js.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=$()){return fe(e,0,0,0)}getBoundingBoxObjectSpace(e=Mo()){return ls(e)}addObjectState(e,i){e===q_.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Fo.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Fo.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(CE)&&(e.draped.origin[0]+=CE[0],e.draped.origin[1]+=CE[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){ls(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Tge,r),FZe(n,Tge)}if(i){let o;rm(n,CE);const a=tne(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(CE[0],CE[1],s,a,"ground")}catch{}b(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)Kk(rg,this.boundingBox);else{const n=e.boundingSphere,o=n[3];rg[0]=n[0]-o,rg[1]=n[1]-o,rg[2]=n[2]-o,rg[3]=n[0]+o,rg[4]=n[1]+o,rg[5]=n[2]+o}return i(rg,0,2),this.calculateRelativeScreenBounds&&s.push({location:rm(rg),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Tte(rg,r)}};const Tge=bi(),rg=Mo(),CE=$();let SDe=class{constructor(e,i,r,s=2048){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),i=this._lineHeight;return Math.ceil(e+i+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(A(this._metricsCached)){const e=kK(Sge,m4,m4).getContext("2d");this._setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((g,y)=>{const v=e.measureText(g),x=v.width,S=x+i;this._textWidths.push(x),this._lineWidths.push(S),o=Math.max(o,S),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),y===0&&(s=v),y===this._lines.length-1&&(n=v)});const c=e.font;let h=Cge.get(c);if(!h){const g=e.measureText(NAt);h=new UAt(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),Cge.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const d=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new FAt(a-f,l-m,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*DAt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(A(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Nb.Left:return this._backgroundHorizontalPadding;case Nb.Center:return(this.displayWidth-this._lineWidths[e])/2;case Nb.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,i=0,r=0){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;i+=o,r+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(_r.TEXT_SHOW_BASELINE){e.strokeStyle=Ege,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const d=c+this._baselinePosition;this._drawLine(e,[s,d],[s+this.displayWidth,d]),c+=this._lineSpacing}}if(_r.TEXT_SHOW_BORDER&&(e.strokeStyle=Ege,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Se(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=kK(Sge,Math.max(o,m4),Math.max(a,m4)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of EDe)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}_setFontProperties(e,i){e.font=this._parameters.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const EDe=[];for(let e=0;e<360;e+=360/16)EDe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Nb;function kK(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Nb||(Nb={}));const Sge={canvas:null},DAt=.2,m4=512,Ege="rgb(255, 0, 255, 0.5)",NAt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let FAt=class{constructor(e,i,r,s,n){this.paddingTop=e,this.paddingBottom=i,this.lineHeight=r,this.displayWidth=s,this.baselinePosition=n}},UAt=class{constructor(e,i){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=i}};const Cge=new Map,kAt=Object.freeze({left:0,center:.5,right:1}),l8=Object.freeze({"bottom-left":nr(0,0),bottom:nr(.5,0),"bottom-right":nr(1,0),left:nr(0,.5),center:nr(.5,.5),right:nr(1,.5),"top-left":nr(0,1),top:nr(.5,1),"top-right":nr(1,1)});function CDe(t){switch(t){case"left":return Nb.Left;case"right":return Nb.Right;default:return Nb.Center}}function Mge(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function VAt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function zAt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function BAt(t){return t==="middle"?"center":t}var $l,Age;function cR(t){return t!=null}function ME(t){return typeof t=="number"}function Vz(t){return typeof t=="string"}function GAt(t){return t==null||Vz(t)}function bo(t,e){t&&t.push(e)}function jAt(t,e,i,r=Ge()){const s=t||0,n=e||0,o=i||0;return s!==0&&FA(r,r,-s/180*Math.PI),n!==0&&NA(r,r,n/180*Math.PI),o!==0&&lV(r,r,o/180*Math.PI),r}function Hv(t,e,i,r,s){const n=t.minSize,o=t.maxSize;if(t.expression)return bo(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=$l.DefinedSize,!0}if(cR(t.field))return cR(t.stops)?t.stops.length===2&&ME(t.stops[0].size)&&ME(t.stops[1].size)?(Oge(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=$l.DefinedSize,!0):(bo(s,"Could not convert size info: stops only supported with 2 elements"),!1):ME(n)&&ME(o)&&cR(t.minDataValue)&&cR(t.maxDataValue)?(Oge(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=$l.DefinedSize,!0):BA[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/BA[t.valueUnit],e.type[i]=$l.DefinedSize,!0):t.valueUnit==="unknown"?(bo(s,"Could not convert size info: proportional size not supported"),!1):(bo(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!cR(t.field)){if(t.stops&&t.stops[0]&&ME(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=$l.DefinedSize,!0;if(ME(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=$l.DefinedSize,!0}return bo(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Oge(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function HAt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return bo(r,"Could not convert size info: unsupported property"),null;if(!GAt(t.field))return bo(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return bo(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[$l.Undefined,$l.Undefined,$l.Undefined]};let s;switch(t.axis){case"width":return s=Hv(t,e.size,0,i,r),s?e:null;case"height":return s=Hv(t,e.size,2,i,r),s?e:null;case"depth":return s=Hv(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=Hv(t,e.size,0,i,r),s&&Hv(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=Hv(t,e.size,0,i,r),s=s&&Hv(t,e.size,1,i,r),s=s&&Hv(t,e.size,2,i,r),s?e:null;default:return bo(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function qAt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===$l.DefinedSize&&(n*=e.modelSize[s],t.type[s]=$l.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==$l.Undefined)r=0;else if(t.type[1]!==$l.Undefined)r=1;else{if(t.type[2]===$l.Undefined)return bo(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===$l.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function Rge(t,e,i){t[4*e+0]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function WAt(t,e,i){if(t.normalizationField)return bo(i,"Could not convert color info: unsupported property"),null;if(Vz(t.field)){if(!t.stops)return bo(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return bo(i,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,Rge(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return bo(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,Rge(e.color.colors,s,r)}}return e}function YAt(t,e,i){if(t.normalizationField)return bo(i,"Could not convert opacity info: unsupported property"),null;if(Vz(t.field)){if(!t.stops)return bo(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return bo(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return bo(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function jj(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function XAt(t,e,i){if(!Vz(t.field))return bo(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return bo(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return jj(t,e.rotation,0),e;case"roll":return jj(t,e.rotation,1),e;case null:case void 0:case"heading":return jj(t,e.rotation,2),e;default:return bo(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function MDe(t,e,i){if(!t)return null;const r=!e.supportedTypes||!!e.supportedTypes.size,s=!e.supportedTypes||!!e.supportedTypes.color,n=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return bo(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?HAt(c,l,e,i):l;case"color":return s?WAt(c,l,i):l;case"opacity":return o?YAt(c,l,i):null;case"rotation":return n?XAt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!qAt(a.size,e,i)?null:a:null}function Cne(t){return t&&t.size!=null}function yL(t,e){if(!t)return{enabled:!1};if(_r.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=MDe(t.visualVariables,e);return i?{enabled:!0,visualVariables:i,materialParameters:ADe(i,e),requiresShaderTransformation:Cne(i)}:{enabled:!1}}function _L(t,e,i){if(!e||!t.enabled)return!1;const r=t.visualVariables,s=MDe(e.visualVariables,i);return!!s&&!!(g4(r.size,s.size,"size")&&g4(r.color,s.color,"color")&&g4(r.rotation,s.rotation,"rotation")&&g4(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=ADe(s,i),t.requiresShaderTransformation=Cne(s),!0)}function g4(t,e,i){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function ADe(t,e){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=Cne(t);return t&&t.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=t.size.minSize,i.vvSizeMaxSize=t.size.maxSize,i.vvSizeOffset=t.size.offset,i.vvSizeFactor=t.size.factor):t&&r&&(i.vvSizeValue=e.transformation.scale),t&&r&&(i.vvSymbolAnchor=e.transformation.anchor,i.vvSymbolRotationMatrix=Hs(),zp(e$),jAt(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],e$),jp(i.vvSymbolRotationMatrix,e$)),t&&t.color&&(i.vvColorEnabled=!0,i.vvColorValues=t.color.values,i.vvColorColors=t.color.colors),t&&t.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=t.opacity.values,i.vvOpacityOpacities=t.opacity.opacityValues),i}function VK(t,e,i){if(!t.vvSizeEnabled)return i;Bo(qv,i);const r=t.vvSymbolRotationMatrix;Fy(e$,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),ln(qv,qv,e$);for(let s=0;s<3;++s){const n=t.vvSizeOffset[s]+e[0]*t.vvSizeFactor[s];Pge[s]=Se(n,t.vvSizeMinSize[s],t.vvSizeMaxSize[s])}return aV(qv,qv,Pge),fu(qv,qv,t.vvSymbolAnchor),qv}function ZAt(t,e,i){if(!e.vvSizeEnabled)return fe(t,1,1,1);for(let r=0;r<3;++r){const s=e.vvSizeOffset[r]+i[0]*e.vvSizeFactor[r];t[r]=Se(s,e.vvSizeMinSize[r],e.vvSizeMaxSize[r])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})($l||($l={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Age||(Age={}));const qv=Ge(),Pge=$(),e$=Ge();let u3=class{constructor(e,i={}){this.geometry=e,this.boundingSphere=Ai(),this.screenToWorldRatio=1,this._transformation=Ge(),this._shaderTransformationDirty=!0,this.id=nh(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.boundingInfo=i.boundingInfo,this.shaderTransformer=i.shaderTransformer,this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,i,r=K2(e)){A(this.boundingInfo)||(at(i,this.boundingInfo.center,e),i[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return b(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return A(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ge()),Bo(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const JAt=Ge(),Ige=Ve(0,0,1),KAt=16,QAt=1.5,c2=Jse,e3t=[c2/2,c2/2,1-c2/2,1-c2/2],t3t=[aL*c2,aL*c2];let zK=class ODe extends By{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(b(r))this._prepareResourcesPrimitive(i,r);else{const s=Rrt(this.symbolLayer),n=HL(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Iz(this._getIconSize());if(e)throw new J("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?ka(e.size):KAt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Ib.PAD};r=new $S(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(e,i){const r=e.width/e.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(i3t(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:ka(r),minWorldLength:s||0,maxWorldLength:b(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(Hj(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,b(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>p$e(i));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=e3t;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/c2,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(b(this._context.sharedResources.textures)){const o=await Sm(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw Pl(o.error),new J("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const s=new x3({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await se(()=>import("./CIMSymbolRasterizer-c25a95e1.js"),["assets/CIMSymbolRasterizer-c25a95e1.js","assets/cimAnalyzer-263bafa1.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/utils-35d9b505.js","assets/alignmentUtils-ae955d28.js","assets/definitions-19bfb61c.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/CIMResourceManager-e389f275.js","assets/Rasterizer-fef7f176.js","assets/_commonjsHelpers-2f3e7994.js","assets/rasterizingUtils-da353a58.js","assets/imageutils-6de27084.js","assets/cimSymbolUtils-d0609087.js"])).CIMSymbolRasterizer;_i(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const d=h.scaleExpression,f=await CXe(d,this._context.layer.spatialReference,n);a=(m,g,y)=>{const v=PAt(f,m,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];_i(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||rJe}_getOutlineSize(){let e=0;const i=this.symbolLayer;return b(i.outline)&&i.outline.size!=null?Math.max(ka(i.outline.size),0):(e=Hj(this._getPrimitive())?QAt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=Hn(i,"outline","color");if(b(r)){const s=et.toUnitRGB(r),n=r.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(Hj(this._getPrimitive()))return LAt;const e=A(this._getPrimitive()),i=Hn(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?nr((i.x||0)+.5,.5-(i.y||0)):e in l8?l8[e]:l8.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=yL(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=b(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new l3(e),this._cimSymbolMaterials.set(vt(e.textureId,0),r),i.add(r)),r}return this._material=new l3(e),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Os(this._releaseTexture)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=ka(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(i),f={textureId:d.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(f,this._context.stage),s=[d.params.width,d.params.height]}else s=this._size,r=this._material;const n=dL(i.geometry);if(A(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const d=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=nr(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(i,new zm);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,h,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=$D(ODe.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=Xp(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!_L(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return To.Recreate_Symbol;b(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return To.Fast_Update}_defaultElevationInfoNoZ(){return r3t}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l?y=>VK(this._fastUpdates.materialParameters,l,y):void 0,h=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=nK(r,Ige,null,s,n,s3t,null,l,d),m=lne(this._context,i,f,o,a,c);if(A(m))return null;const g=new zy(this,m.object,[f],null,null,uL,o);return g.alignedSampledElevation=m.sampledElevation,g.needsElevationUpdates=Xp(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(n,c),g.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,y),hL(g,i,this._context.elevationProvider),g}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=Ai();ll(i,a,this._context.overlaySR),a[2]=xne;const l=this._context.clippingExtent;if(b(l)&&!xte(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c?y=>VK(this._fastUpdates.materialParameters,c,y):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=nK(r,Ige,a,s,n,null,null,c,d),m=new u3(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h});a[3]=0,im(m.boundingSphere,a);const g=new kz(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,h),g.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,y),g}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=je())=>{const a=i(JAt);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=je())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ve(e,e,e),r=Up(1),s=e*r;return{modelSize:i,symbolSize:Ve(s,s,s),unitInMeters:r,transformation:{anchor:Fl,scale:ey,rotation:Fl}}}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){b(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function i3t(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Hj(t){return!A(t)&&(t==="cross"||t==="x")}zK.PRIMITIVE_SIZE=t3t,zK.elevationModeChangeTypes={definedChanged:cn.UPDATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const r3t={mode:"relative-to-ground",offset:0},s3t=di(0,0,0,1);function BK(t){switch(t){case"butt":return Lp.BUTT;case"square":return Lp.SQUARE;case"round":return Lp.ROUND;default:return null}}function n3t(t){return t==="diamond"?"kite":t}function GK(t,e,i=null){const r=[],s=[],n=e.mapPositions;o3t(e,s,r);const o=s[0][1].data,a=r[0][1].length,l=new Array(a).fill(0);return a3t(e,s,r,l),u3t(e,s,r,l),l3t(e,s,r,l),c3t(e,s,r,l),h3t(e,s,r,l),d3t(e,s,r,l),p3t(e,s,r,o),new qn(t,s,r,n,xn.Line,i)}function o3t(t,e,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=t,n=f3t(r)&&s,o=r.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?r.slice(0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([P.POSITION,new ct(l,3,n)]),i.push([P.POSITION,a])}function a3t(t,e,i,r){if(b(t.attributeData.colorFeature))return;const s=t.attributeData.color;e.push([P.COLOR,new ct(vt(s,Tp),4)]),i.push([P.COLOR,r])}function l3t(t,e,i,r){if(!b(t.attributeData.normal))return;const s=t.attributeData.normal;e.push([P.NORMAL,new ct(s,3)]),i.push([P.NORMAL,r])}function c3t(t,e,i,r){const s=t.attributeData.colorFeature;A(s)||(e.push([P.COLORFEATUREATTRIBUTE,new ct([s],1,!0)]),i.push([P.COLOR,r]))}function u3t(t,e,i,r){if(b(t.attributeData.sizeFeature))return;const s=t.attributeData.size;e.push([P.SIZE,new ct([vt(s,1)],1,!0)]),i.push([P.SIZE,r])}function h3t(t,e,i,r){const s=t.attributeData.sizeFeature;A(s)||(e.push([P.SIZEFEATUREATTRIBUTE,new ct([s],1,!0)]),i.push([P.SIZEFEATUREATTRIBUTE,r]))}function d3t(t,e,i,r){const s=t.attributeData.opacityFeature;A(s)||(e.push([P.OPACITYFEATUREATTRIBUTE,new ct([s],1,!0)]),i.push([P.OPACITYFEATUREATTRIBUTE,r]))}function p3t(t,e,i,r){if(A(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==it.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=fh(r.length),n=ur(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)zte(r,f,s,f,n);const o=r.length/3,a=Fn(o+1);let l=m3t,c=g3t,h=0,d=0;fe(l,s[d++],s[d++],s[d++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(d=0),fe(c,s[d++],s[d++],s[d++]),h+=qAe(l,c),a[f]=h,[l,c]=[c,l];e.push([P.DISTANCETOSTART,new ct(a,1,!0)]),i.push([P.DISTANCETOSTART,i[0][1]])}function f3t(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const m3t=$(),g3t=$();function uti(t,e){if(A(t)||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=fh(3*s);r.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function y3t(t,e,i,r){const s=t.type==="polygon"?Ry.CCW_IS_HOLE:Ry.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=ND(n,!!t.hasZ,s),l=fh(o.length),c=W$e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),h=c!=null;return{lines:h?RDe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function _3t(t,e){const i=t.type==="polygon"?Ry.CCW_IS_HOLE:Ry.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=ND(r,!1,i),o=un(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=xne;return{lines:o?RDe(n,s):[],projectionSuccess:o}}function RDe(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:Ip(e,3*s,3*n),mapPositions:b(i)?Ip(i,o,a):void 0})}return r}function v3t(t){const e=new ar,i=t.hasMultipassTerrain&&(t.output===H.Color||t.output===H.Alpha),r=t.space===$p.World;t.hasTip&&r&&e.extensions.add("GL_OES_standard_derivatives"),e.include(TLe,t),e.include(RLe,t),t.output===H.Depth&&e.include(X_,t);const{vertex:s,fragment:n}=e;return n.include(_h),ah(s,t),e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.UV0,"vec2"),e.attributes.add(P.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),ow(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add([new hr("nearFar",(o,a)=>a.camera.nearFar),new Ni("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(P.NORMAL,"vec3"),o3(s),s.constants.add("tiltThreshold","float",.7),s.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(T`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===lS.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===$p.Screen&&(s.uniforms.add(new Ps("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Be("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new Be("pixelRatio",(o,a)=>a.camera.pixelRatio)),nz(e),s.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===$p.Screen&&s.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(T`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Ed,t),e.include(Un,t),n.uniforms.add([new Ni("intrinsicColor",o=>o.color),new Yt("tex",o=>o.texture)]),n.include(ky),e.constants.add("texelSize","float",1/fL),n.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",dne/fL),e.constants.add("relativeTipLineWidth","float",DCt),n.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",sl),n.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===H.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===H.Alpha?T`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===H.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===H.Color&&t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===H.Highlight?T`gl_FragColor = vec4(1.0);`:""}
    ${t.output===H.Depth?T`outputDepth(linearDepth);`:""}
  }
  `),e}const b3t=Object.freeze(Object.defineProperty({__proto__:null,build:v3t},Symbol.toStringTag,{value:"Module"})),PDe=new Map([[P.POSITION,0],[P.UV0,2],[P.AUXPOS1,3],[P.NORMAL,4],[P.COLOR,5],[P.COLORFEATUREATTRIBUTE,5],[P.SIZE,6],[P.SIZEFEATUREATTRIBUTE,6],[P.OPACITYFEATUREATTRIBUTE,7]]);let IDe=class $De extends dr{initializeProgram(e){return new cr(e.rctx,$De.shader.get().build(this.configuration),PDe)}_makePipelineState(e,i){const r=this.configuration,s=e===zt.NONE;return si({blending:r.output===H.Color||r.output===H.Alpha?s?yd:fv(e):null,depthTest:{func:Ew(e)},depthWrite:s?r.writeDepth?gu:null:Az(e),colorWrite:wi,stencilWrite:r.hasOccludees?Py:null,stencilTest:r.hasOccludees?i?fw:Cw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=si({blending:yd,depthTest:q9,depthWrite:null,colorWrite:wi,stencilWrite:null,stencilTest:$Le}),this._occluderPipelineOpaque=si({blending:yd,depthTest:q9,depthWrite:null,colorWrite:wi,stencilWrite:PLe,stencilTest:ILe}),this._occluderPipelineMaskWrite=si({blending:null,depthTest:pne,depthWrite:null,colorWrite:null,stencilWrite:Py,stencilTest:fw})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Ie.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ie.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};IDe.shader=new lr(b3t,()=>se(()=>import("./LineMarker.glsl-629adfdf.js"),[]));let w3t=class extends Sw{constructor(e){super(e,new T3t),this._vertexAttributeLocations=PDe,this._configuration=new Ia,this._layout=this.createLayout()}dispose(){}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Ie.DRAPED_MATERIAL?$p.Draped:this.parameters.worldSpace?$p.World:$p.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Lp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===Ks.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=qs().vec3f(P.POSITION).vec2f(P.UV0).vec3f(P.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(P.NORMAL),this.parameters.vvSizeEnabled?e.f32(P.SIZEFEATUREATTRIBUTE):e.f32(P.SIZE),this.parameters.vvColorEnabled?e.f32(P.COLORFEATUREATTRIBUTE):e.vec4f(P.COLOR),this.parameters.vvOpacityEnabled&&e.f32(P.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new S3t(this._layout,this.parameters)}requiresSlot(e,i){return i===H.Color||i===H.Alpha||i===H.Highlight||i===H.Depth?e===Ie.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ks.OccludeAndTransparentStencil?e===Ie.OPAQUE_MATERIAL||e===Ie.OCCLUDER_MATERIAL||e===Ie.TRANSPARENT_OCCLUDER_MATERIAL:i===H.Color||i===H.Alpha?e===(this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ie.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new x3t(e)}},x3t=class extends Wre{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(IDe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==H.Color&&this._output!==H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},T3t=class extends Kse{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Lp.BUTT,this.anchor=lS.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},S3t=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.vertexAttributes.get(P.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(P.NORMAL);this._parameters.worldSpace&&b(c)&&(l=c.data);let h=1,d=0;this._parameters.vvSizeEnabled?d=r.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(P.SIZE)&&(h=r.vertexAttributes.get(P.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=r.vertexAttributes.get(P.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(P.COLOR)&&(f=r.vertexAttributes.get(P.COLOR).data);let g=0;this._parameters.vvOpacityEnabled&&(g=r.vertexAttributes.get(P.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const x=(R,O,U,L)=>{if(y[v++]=R[0],y[v++]=R[1],y[v++]=R[2],y[v++]=U[0],y[v++]=U[1],y[v++]=O[0],y[v++]=O[1],y[v++]=O[2],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSizeEnabled?y[v++]=d:y[v++]=h,this._parameters.vvColorEnabled)y[v++]=m;else{const B=Math.min(4*L,f.length-4);y[v++]=f[B+0],y[v++]=f[B+1],y[v++]=f[B+2],y[v++]=f[B+3]}this._parameters.vvOpacityEnabled&&(y[v++]=g)};let S;(function(R){R[R.ASCENDING=1]="ASCENDING",R[R.DESCENDING=-1]="DESCENDING"})(S||(S={}));const E=(R,O)=>{const U=fe(E3t,o[3*R],o[3*R+1],o[3*R+2]),L=C3t;let B=R+O;do fe(L,o[3*B],o[3*B+1],o[3*B+2]),B+=O;while(Bb(U,L)&&B>=0&&B<a);e&&(at(U,U,e),at(L,L,e)),x(U,L,[-1,-1],R),x(U,L,[1,-1],R),x(U,L,[1,1],R),x(U,L,[-1,-1],R),x(U,L,[1,1],R),x(U,L,[-1,1],R)},C=this._parameters.placement;C!=="begin"&&C!=="begin-end"||E(0,S.ASCENDING),C!=="end"&&C!=="begin-end"||E(a-1,S.DESCENDING)}};const E3t=$(),C3t=$(),Tl={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},M3t={dash:Tl.dash,"dash-dot":[...Tl.dash,...Tl.dot],dot:Tl.dot,"long-dash":Tl["long-dash"],"long-dash-dot":[...Tl["long-dash"],...Tl.dot],"long-dash-dot-dot":[...Tl["long-dash"],...Tl.dot,...Tl.dot],none:null,"short-dash":Tl["short-dash"],"short-dash-dot":[...Tl["short-dash"],...Tl["short-dot"]],"short-dash-dot-dot":[...Tl["short-dash"],...Tl["short-dot"],...Tl["short-dot"]],"short-dot":Tl["short-dot"],solid:null},A3t=8;function O3t(t,e=2){return A(t)?t:{pattern:t.slice(),pixelRatio:e}}function mti(t,e=2){return{pattern:[t,t],pixelRatio:e}}function LDe(t){return b(t)&&t.type==="style"?R3t(t.style):null}function R3t(t){return b(t)?O3t(M3t[t],A3t):null}const P3t=["polyline","polygon","extent"];let DDe=class NDe extends By{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=yL(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Up(1))<0)throw new J("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=b(this.symbolLayer.marker)&&b(this._context.sharedResources.textures)?NCt(this._context.sharedResources.textures,n3t(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:BK(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:LDe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return fa(this.symbolLayer.material,e=>e.color)}get _markerColor(){return fa(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return A(this._lineMaterialCached)&&(this._lineMaterialCached=new RM(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return A(this._ringMaterialCached)&&(this._ringMaterialCached=new RM(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return A(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new RM({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return A(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new RM({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return A(this._markerMaterialCached)&&b(this.symbolLayer.marker)&&b(this._markerTexture)&&(this._markerMaterialCached=new w3t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=Os(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ka(nCt(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?M_(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const i=di(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?M_(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?M_(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,P3t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new zm);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!_L(this._fastUpdates,i,this._vvConvertOptions))return To.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return To.Fast_Update}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=BK(vt(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i))}_forEachMaterial(e){b(this._lineMaterialCached)&&e(this._lineMaterialCached),b(this._ringMaterialCached)&&e(this._ringMaterialCached),b(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),b(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),b(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,i=!1){const r=e.parameters.color,s=Hn(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=di(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=$D(NDe.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=Xp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ti)return kl.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Mo(),c=y3t(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const g=c.lines[m],y=g.position,v=g.mapPositions;if(b(this._context.clippingExtent)&&(ls(l),ud(l,v),!sm(l,this._context.clippingExtent)))continue;const x=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,y,v,n.type,t$.ELEVATED,r);a.push(x),_r.LINE_WIREFRAMES&&a.push(x.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),b(this._markerMaterial)&&a.push(x.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new mv({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),f=new zy(this,d,a,null,null,gEt,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Xp(i.mode),f}_createGeometry(e,i,r,s,n,o,a){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return GK(e,{overlayInfo:o===t$.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:c?null:this._getDrivenColor(i.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(i.graphic),colorFeature:this._getColorFeatureAttributeData(i.graphic),opacityFeature:this._getOpacityFeatureAttributeData(i.graphic)}},d)}_createAsOverlay(e,i){const r=e.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=_r.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;b(a)&&(a.renderPriority=this._renderPriority-.001),b(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Mo(),d=ls(),f=_3t(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(ls(h),ud(h,g.position),!sm(h,this._context.clippingExtent))continue;DA(d,h);const y=x=>{const S=this._createGeometry(x,e,g.position,void 0,s.type,t$.DRAPED,r.uid),E=new u3(S,{layerUid:i,graphicUid:r.uid});return c.push(E),E};if(b(l)){const x=y(l),S=this.symbolLayer.marker.placement;S!=="begin"&&S!=="begin-end"||ud(h,g.position,0,1),S!=="end"&&S!=="begin-end"||ud(h,g.position,g.position.length-3,1),this._updateBoundingSphere(x,h)}const v=y(o);if(this._updateBoundingSphere(v,h),_r.LINE_WIREFRAMES){const x=y(a);this._updateBoundingSphere(x,h)}}return new kz(this,c,d,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,i){Rr(e.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return b(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=vt(e,Up(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ka(1):1:ka(e)}_prepareMaterialPatch(e,i,r){var a;const s=i.material;if(A(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?fa(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(uD(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker;if(A(r)||r.type!=="partial"||b(r.diff.style)||b(r.diff.placement)||b(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:A(this._markerColor)};const s=r.diff.color;if(A(s))return delete i.marker,{changed:!1,useMaterialColor:A(this._markerColor)};const n=s.newValue;return A(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,i,r){A(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var t$;DDe.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(t$||(t$={}));var KC;const qj=new WeakMap;let I3t=0,Pg=KC=class extends Ae{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:z2(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[i]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:z2(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(qj.has(this.data)||qj.set(this.data,++I3t),e(qj.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new KC(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return _mt(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new KC({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new KC({data:t}):U_(KC,t)}};u([p({type:String,json:{write:jb}})],Pg.prototype,"url",null),u([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],Pg.prototype,"data",null),u([Xe("data")],Pg.prototype,"writeData",null),u([De("data")],Pg.prototype,"readData",null),u([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Pg.prototype,"transparent",null),u([p({json:{write:!0}})],Pg.prototype,"wrap",void 0),u([p({readOnly:!0})],Pg.prototype,"contentHash",null),Pg=KC=u([N("esri.geometry.support.MeshTexture")],Pg);const i$=Pg;var jK;let Lf=jK=class extends Ae{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=b(t)?t.get(this):null;if(i)return i;const r=new jK(this.clonePropertiesWithDeduplication(e));return b(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:b(this.color)?this.color.clone():null,colorTexture:b(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:b(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:b(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:b(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([p({type:et,json:{write:!0}})],Lf.prototype,"color",void 0),u([p({type:i$,json:{write:!0}})],Lf.prototype,"colorTexture",void 0),u([p({type:i$,json:{write:!0}})],Lf.prototype,"normalTexture",void 0),u([p({nonNullable:!0,json:{write:!0}})],Lf.prototype,"alphaMode",void 0),u([p({nonNullable:!0,json:{write:!0}})],Lf.prototype,"alphaCutoff",void 0),u([p({nonNullable:!0,json:{write:!0}})],Lf.prototype,"doubleSided",void 0),u([p()],Lf.prototype,"colorTextureTransform",void 0),u([p()],Lf.prototype,"normalTextureTransform",void 0),Lf=jK=u([N("esri.geometry.support.MeshMaterial")],Lf);const Mne=Lf;var HK;let ep=HK=class extends Mne{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=b(t)?t.get(this):null;if(i)return i;const r=new HK(this.clonePropertiesWithDeduplication(e));return b(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:b(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:b(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:b(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:b(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:b(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:b(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:b(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([p({type:et,json:{write:!0}})],ep.prototype,"emissiveColor",void 0),u([p({type:i$,json:{write:!0}})],ep.prototype,"emissiveTexture",void 0),u([p({type:i$,json:{write:!0}})],ep.prototype,"occlusionTexture",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ep.prototype,"metallic",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ep.prototype,"roughness",void 0),u([p({type:i$,json:{write:!0}})],ep.prototype,"metallicRoughnessTexture",void 0),u([p()],ep.prototype,"occlusionTextureTransform",void 0),u([p()],ep.prototype,"emissiveTextureTransform",void 0),u([p()],ep.prototype,"metallicRoughnessTextureTransform",void 0),ep=HK=u([N("esri.geometry.support.MeshMaterialMetallicRoughness")],ep);const FDe=ep;var c8;const UDe="esri.geometry.support.MeshVertexAttributes",AE=le.getLogger(UDe);let Dd=c8=class extends Ae{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return QC(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},AE)}castPosition(t){return t&&t instanceof Float32Array&&AE.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),QC(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},AE)}castUv(t){return QC(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},AE)}castNormal(t){return QC(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},AE)}castTangent(t){return QC(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},AE)}clone(){const t={position:ue(this.position),uv:ue(this.uv),normal:ue(this.normal),tangent:ue(this.tangent),color:ue(this.color)};return new c8(t)}clonePositional(){const t={position:ue(this.position),normal:ue(this.normal),tangent:ue(this.tangent),uv:this.uv,color:this.color};return new c8(t)}};function Wj(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function QC(t,e,i,r,s){if(!t)return t;if(t instanceof e)return Wj(t,r,e,s);for(const n of i)if(t instanceof n)return Wj(new e(t),r,e,s);if(Array.isArray(t))return Wj(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function uR(t,e,i){e[i]=$3t(t)}function $3t(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}u([p({json:{write:uR}})],Dd.prototype,"color",void 0),u([pi("color")],Dd.prototype,"castColor",null),u([p({nonNullable:!0,json:{write:uR}})],Dd.prototype,"position",void 0),u([pi("position")],Dd.prototype,"castPosition",null),u([p({json:{write:uR}})],Dd.prototype,"uv",void 0),u([pi("uv")],Dd.prototype,"castUv",null),u([p({json:{write:uR}})],Dd.prototype,"normal",void 0),u([pi("normal")],Dd.prototype,"castNormal",null),u([p({json:{write:uR}})],Dd.prototype,"tangent",void 0),u([pi("tangent")],Dd.prototype,"castTangent",null),Dd=c8=u([N(UDe)],Dd);var QP;const kDe="esri.geometry.support.MeshComponent",L3t=le.getLogger(kDe);let V0=QP=class extends Ae{static from(t){return U_(QP,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return QC(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},L3t)}castMaterial(t){return U_(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?FDe:Mne,t)}clone(){return new QP({faces:ue(this.faces),shading:this.shading,material:ue(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const i={faces:ue(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new QP(i)}};u([p({json:{write:!0}})],V0.prototype,"faces",void 0),u([pi("faces")],V0.prototype,"castFaces",null),u([p({type:Mne,json:{write:!0}})],V0.prototype,"material",void 0),u([pi("material")],V0.prototype,"castMaterial",null),u([p({type:String,json:{write:!0}})],V0.prototype,"shading",void 0),u([p({type:Boolean})],V0.prototype,"trustSourceNormals",void 0),V0=QP=u([N(kDe)],V0);const D3t=V0,zz=le.getLogger("esri.geometry.support.meshUtils.normalProjection");function N3t(t,e,i,r,s){return Gz(r)?(Bz(A_.TO_PCPF,cs.fromTypedArray(t),Bl.fromTypedArray(e),Bl.fromTypedArray(i),r,cs.fromTypedArray(s)),s):(zz.error("Cannot convert spatial reference to PCPF"),s)}function gti(t,e,i,r,s){return Gz(r)?(Bz(A_.FROM_PCPF,cs.fromTypedArray(t),Bl.fromTypedArray(e),Bl.fromTypedArray(i),r,cs.fromTypedArray(s)),s):(zz.error("Cannot convert to spatial reference from PCPF"),s)}function yti(t,e,i){return un(t,e,0,i,KV(e),0,t.length/3),i}function _ti(t,e,i){return un(t,KV(i),0,e,i,0,t.length/3),e}function F3t(t,e,i){if(A(t))return e;const r=Bl.fromTypedArray(t),s=Bl.fromTypedArray(e);return DD(s,r,i),e}function U3t(t,e,i){if(A(t))return e;XA(sa,i);const r=cs.fromTypedArray(t),s=cs.fromTypedArray(e);return pw(s,r,sa),yre(sa)||cne(s,s),e}function k3t(t,e,i){if(A(t))return e;XA(sa,i);const r=cs.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),s=cs.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(pw(s,r,sa),yre(sa)||cne(s,s),t!==e)for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function V3t(t,e,i,r,s){if(!Gz(r))return zz.error("Cannot convert spatial reference to PCPF"),s;Bz(A_.TO_PCPF,cs.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Bl.fromTypedArray(e),Bl.fromTypedArray(i),r,cs.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function vti(t,e,i,r,s){if(!Gz(r))return zz.error("Cannot convert to spatial reference from PCPF"),s;Bz(A_.FROM_PCPF,cs.fromTypedArray(t,16),Bl.fromTypedArray(e),Bl.fromTypedArray(i),r,cs.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function Bz(t,e,i,r,s,n){if(!e)return;const o=i.count,a=KV(s);if(VDe(s))for(let l=0;l<o;l++)r.getVec(l,y4),e.getVec(l,sg),Rm(a,y4,_4,a),jp(sa,_4),t===A_.FROM_PCPF&&Hp(sa,sa),th(sg,sg,sa),n.setVec(l,sg);else for(let l=0;l<o;l++){r.getVec(l,y4),e.getVec(l,sg),Rm(a,y4,_4,a),jp(sa,_4);const c=lU(i.get(l,1));let h=Math.cos(c);t===A_.TO_PCPF&&(h=1/h),sa[0]*=h,sa[1]*=h,sa[2]*=h,sa[3]*=h,sa[4]*=h,sa[5]*=h,t===A_.FROM_PCPF&&Hp(sa,sa),th(sg,sg,sa),Re(sg,sg),n.setVec(l,sg)}return n}function Gz(t){return VDe(t)||z3t(t)}function VDe(t){return t.isWGS84||Kbe(t)||Ly(t)||Dy(t)}function z3t(t){return t.isWebMercator}var A_;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(A_||(A_={}));const y4=$(),sg=$(),_4=Ge(),sa=Hs();let zDe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=c_.KTX2_ENCODING}};function E2(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function B3t(t){return new Promise((e,i)=>{const r=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function G3t(t,e){return e===c_.KTX2_ENCODING?new zDe(t):new Promise((i,r)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)).then(c):(i(o),c())},l=h=>{URL.revokeObjectURL(n),r(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function Jg(t){if(A(t))return null;const e=b(t.offset)?t.offset:_3e,i=b(t.rotation)?t.rotation:0,r=b(t.scale)?t.scale:v3e,s=D6(1,0,0,0,1,0,e[0],e[1],1),n=D6(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=D6(r[0],0,0,0,r[1],0,0,0,1),a=cu();return YA(a,n,o),YA(a,s,a),a}function j3t(t){const e=new ar,{vertex:i,fragment:r}=e;return e.include(au,t),e.include(LS,t),e.include(ALe,t),ah(i,t),t.stippleEnabled&&(e.attributes.add(P.UV0,"vec2"),e.attributes.add(P.AUXPOS1,"vec3"),i.uniforms.add(new Ni("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(P.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(i.code.add(T`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?i.uniforms.add(new Be("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?i.code.add(T`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(T`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Be("stipplePatternPixelSize",s=>hne(s))),i.code.add(T`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(T`}`),t.output===H.Highlight&&e.include(pv,t),e.include(Un,t),r.uniforms.add(new Be("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new Ni("constantColor",s=>s.color)),r.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===H.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(sl)}) {
      discard;
    }

    ${t.output===H.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===H.Highlight?T`outputHighlight();`:""}
  }
  `),e}const H3t=Object.freeze(Object.defineProperty({__proto__:null,build:j3t},Symbol.toStringTag,{value:"Module"}));let BDe=class GDe extends dr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==H.Highlight}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,GDe.shader.get().build(this.configuration),rr)}initializePipeline(){const e=this.configuration,i=qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>si({blending:n,depthTest:pne,depthWrite:o,colorWrite:wi,stencilWrite:e.hasOccludees?Py:null,stencilTest:e.hasOccludees?s?fw:Cw:null});return e.output===H.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?i:null,gu),r(!1,e.transparent||this._stippleEnabled?i:null,gu)):r(!1)}get primitiveType(){return Xt.LINES}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};BDe.shader=new lr(H3t,()=>se(()=>import("./NativeLine.glsl-14575a07.js"),[]));let Nh=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([X({count:H.COUNT})],Nh.prototype,"output",void 0),u([X()],Nh.prototype,"hasSlicePlane",void 0),u([X()],Nh.prototype,"hasVertexColors",void 0),u([X()],Nh.prototype,"transparent",void 0),u([X()],Nh.prototype,"draped",void 0),u([X()],Nh.prototype,"stippleEnabled",void 0),u([X()],Nh.prototype,"stippleOffColorEnabled",void 0),u([X()],Nh.prototype,"stipplePreferContinuous",void 0),u([X()],Nh.prototype,"hasOccludees",void 0),u([X({constValue:!1})],Nh.prototype,"stippleRequiresClamp",void 0),u([X({constValue:!1})],Nh.prototype,"stippleScaleWithLineWidth",void 0),u([X({constValue:!1})],Nh.prototype,"stippleRequiresStretchMeasure",void 0);var Z9;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(Z9||(Z9={}));let $ge=class extends Sw{constructor(e){super(e,new Y3t),this._configuration=new Nh}getConfiguration(e,i){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=i.slot===Ie.DRAPED_MATERIAL;const r=b(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&b(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!aPe(i))return void le.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(P.POSITION).data,l=r.camera,c=Z3t;Ao(c,r.point);const h=2;fe(hR[0],c[0]-h,c[1]+h,0),fe(hR[1],c[0]+h,c[1]+h,0),fe(hR[2],c[0]+h,c[1]-h,0),fe(hR[3],c[0]-h,c[1]-h,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(hR[y],c0[y]))return;Il(l.eye,c0[0],c0[1],Yj),Il(l.eye,c0[1],c0[2],Xj),Il(l.eye,c0[2],c0[3],Zj),Il(l.eye,c0[3],c0[0],Jj);let d=Number.MAX_VALUE,f=0;for(let y=0;y<a.length-5;y+=3){if(oc[0]=a[y]+i[12],oc[1]=a[y+1]+i[13],oc[2]=a[y+2]+i[14],ac[0]=a[y+3]+i[12],ac[1]=a[y+4]+i[13],ac[2]=a[y+5]+i[14],Kr(Yj,oc)<0&&Kr(Yj,ac)<0||Kr(Xj,oc)<0&&Kr(Xj,ac)<0||Kr(Zj,oc)<0&&Kr(Zj,ac)<0||Kr(Jj,oc)<0&&Kr(Jj,ac)<0)continue;if(l.projectToRenderScreen(oc,sx),l.projectToRenderScreen(ac,nx),sx[2]<0&&nx[2]>0){be(ng,oc,ac);const x=l.frustum,S=-Kr(x[Jr.NEAR],oc)/xe(ng,x[Jr.NEAR]);pe(ng,ng,S),we(oc,oc,ng),l.projectToRenderScreen(oc,sx)}else if(sx[2]>0&&nx[2]<0){be(ng,ac,oc);const x=l.frustum,S=-Kr(x[Jr.NEAR],ac)/xe(ng,x[Jr.NEAR]);pe(ng,ng,S),we(ac,ac,ng),l.projectToRenderScreen(ac,nx)}else if(sx[2]<0&&nx[2]<0)continue;sx[2]=0,nx[2]=0;const v=Cre(b2(sx,nx,Nge),c);v<d&&(d=v,ge(Lge,oc),ge(Dge,ac),f=y/3)}const m=r.rayBegin,g=r.rayEnd;if(d<h*h){let y=Number.MAX_VALUE;if(sOe(b2(Lge,Dge,Nge),b2(m,g,X3t),rx)){be(rx,rx,m);const v=ze(rx);pe(rx,rx,1/v),y=v/Wr(m,g)}o(y,rx,f,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(P.POSITION).data,l=e.vertexAttributes.get(P.SIZE),c=l?l.data[0]:0,h=s[0],d=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],x=a[y+1],S=h-v,E=d-x,C=a[y+3]-v,R=a[y+4]-x,O=Se((C*S+R*E)/(C*C+R*R),0,1),U=C*O-S,L=R*O-E,B=U*U+L*L;B<m&&(m=B,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}requiresSlot(e,i){return!(i!==H.Color&&i!==H.Highlight&&i!==H.ObjectAndLayerIdColor||e!==Ie.OPAQUE_MATERIAL&&e!==Ie.DRAPED_MATERIAL)}createGLMaterial(e){return new q3t(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?HLe:lMt;return A(this.parameters.stipplePattern)?new nO(e):new W3t(e.clone().vec3f(P.AUXPOS1).vec2f(P.UV0))}},q3t=class extends Tw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===H.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(BDe,e)}},W3t=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(P.POSITION).length}write(e,i,r,s,n){a$e(r,this.vertexBufferLayout,e,i,s,n),this._writeAuxpos1(e,r,s,n),this._writeUV0(e,r,s,n)}_writeAuxpos1(e,i,r,s){const n=r.getField(P.AUXPOS1,cs),o=i.indices.get(P.POSITION),a=i.vertexAttributes.get(P.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let d=0;d<o.length-1;d+=2)for(const f of[1,0]){const m=3*o[d+f],g=a[m],y=a[m+1],v=a[m+2],x=l[0]*g+l[4]*y+l[8]*v+l[12],S=l[1]*g+l[5]*y+l[9]*v+l[13],E=l[2]*g+l[6]*y+l[10]*v+l[14];h[s]=x,h[s+1]=S,h[s+2]=E,s+=c}}_writeUV0(e,i,r,s){var E;const n=r.getField(P.UV0,dv),o=i.indices.get(P.POSITION),a=i.vertexAttributes.get(P.POSITION).data,l=(E=i.vertexAttributes.get(P.DISTANCETOSTART))==null?void 0:E.data,c=n.typedBufferStride,h=n.typedBuffer;let d=0;h[s*=c]=Z9.START,h[s+1]=d,s+=c;const f=3*o[0],m=fe(oc,a[f],a[f+1],a[f+2]);e&&at(m,m,e);const g=ac,y=o.length-1;let v=1;const x=l?(C,R,O)=>d=l[O]:(C,R,O)=>d+=Wr(C,R);for(let C=1;C<y;C+=2){const R=3*o[C];fe(g,a[R],a[R+1],a[R+2]),e&&at(g,g,e),x(m,g,v++);for(let O=0;O<2;++O)h[s]=1-O,h[s+1]=d,s+=c;ge(m,g)}const S=3*o[y];fe(g,a[S],a[S+1],a[S+2]),e&&at(g,g,e),x(m,g,v),h[s]=Z9.END,h[s+1]=d}},Y3t=class extends tO{constructor(){super(...arguments),this.color=Tp,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const oc=$(),ac=$(),ng=$(),rx=$(),sx=ma(),nx=ma(),Lge=$(),Dge=$(),Nge=Fm(),X3t=Fm(),Z3t=$(),hR=[ma(),ma(),ma(),ma()],c0=[$(),$(),$(),$()],Yj=gr(),Xj=gr(),Zj=gr(),Jj=gr(),J3t=["mesh"];class K3t extends By{constructor(e,i,r,s){super(e,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){_r.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new $ge({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new $ge({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,J3t,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new zm),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=i(s);b(n)&&n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,hw)}slicePlaneEnabledChanged(e,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{const s=i(r);b(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return A(e)?"-":e instanceof et?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,d=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${d},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof FDe){const{metallic:g,roughness:y,metallicRoughnessTexture:v,emissiveColor:x,emissiveTexture:S,occlusionTexture:E}=i.material,C=this._colorOrTextureUid(v),R=this._colorOrTextureUid(x),O=this._colorOrTextureUid(S),U=this._colorOrTextureUid(E);s.metallic=g,s.roughness=y,s.metallicRoughnessTexture=v,s.emissiveColor=x,s.emissiveTexture=S,s.occlusionTexture=E,s.colorTextureTransform=i.material.colorTextureTransform,s.normalTextureTransform=i.material.normalTextureTransform,s.emissiveTextureTransform=i.material.emissiveTextureTransform,s.occlusionTextureTransform=i.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=i.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${g},mrr:${y},mrt:${C},emuid:${R},etmuid:${O},otmuid:${U}`}return s}_setInternalColorValueParameters(e,i){i.diffuse=et.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const i=this._getInternalTexture(e,Nr.Opaque);return b(i)?i.id:null}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new $S(E2(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!E2(r)&&i!==Nr.Opaque,encoding:E2(r)&&b(r.encoding)?r.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return qt.CLAMP_TO_EDGE;case"mirror":return qt.MIRRORED_REPEAT;default:return qt.REPEAT}}_setInternalMaterialParameters(e,i){if(b(e.color)&&this._setInternalColorValueParameters(e.color,i),b(e.colorTexture)){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);b(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}b(e.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),b(e.emissiveColor)&&(i.emissiveFactor=et.toUnitRGB(e.emissiveColor)),b(e.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),b(e.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),b(e.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Jg(e.colorTextureTransform),i.normalTextureTransformMatrix=Jg(e.normalTextureTransform),i.occlusionTextureTransformMatrix=Jg(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Jg(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Jg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=b(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)e.externalColor=Tp;else{const s=b(this.symbolLayer.material)?this.symbolLayer.material.color:null;b(s)?e.externalColor=et.toUnitRGBA(s):(r=null,e.externalColor=Tp)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(A(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){var g,y,v;const r=(g=i.material)==null?void 0:g.color,s=(y=i.material)==null?void 0:y.colorTexture,n=(v=i.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||b(r)&&r.a<1||b(s)&&s.transparent||o),l=this._materialProperties(e,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Fl,diffuse:ey,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ts.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};d||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?ts.None:ts.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Z_(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Nr.MaskBlend:Nr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Nr.Opaque:i.alphaMode==="mask"?Nr.Mask:Nr.Blend}_addDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const g=i[m],y=g.vertexAttributes.get(P.POSITION),v=g.vertexAttributes.get(P.NORMAL),x=g.indices.get(P.POSITION),S=g.indices.get(P.NORMAL),E=y.data,C=v.data;for(let R=0;R<x.length;R++){const O=3*x[R],U=3*S[R];for(let L=0;L<3;L++)o.push(E[O+L]);for(let L=0;L<3;L++)o.push(E[O+L]+C[U+L]*n);if(a.push(a.length),a.push(a.length),R%3==0){this._calculateFaceNormal(E,x,R,PE),this._getFaceVertices(E,x,R,Wa,OE,RE),we(Wa,Wa,OE),we(Wa,Wa,RE),pe(Wa,Wa,1/3);for(let L=0;L<3;L++)l.push(Wa[L]);for(let L=0;L<3;L++)l.push(Wa[L]+PE[L]*n);c.push(c.length),c.push(c.length)}}}const h=i[0].transformation,d=new qn(this._debugVertexNormalMaterial,[[P.POSITION,new ct(o,3,!0)]],[[P.POSITION,a]],null,xn.Line);i.push(d),d.transformation=h;const f=new qn(this._debugFaceNormalMaterial,[[P.POSITION,new ct(l,3,!0)]],[[P.POSITION,c]],null,xn.Line);f.transformation=h,i.push(f)}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(A(o))return null;const{geometries:a,objectTransformation:l}=o;_r.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new mv({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=aLe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=b(h)?new TEt(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new zy(this,c,a,null,null,uL,r,d);f.needsElevationUpdates=hw(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:g}=this._context,y=(v,x)=>sO(v,m,r,g,x);return f.alignedSampledElevation=uL(f,r,m.spatialReference,y,g),f}_getCenterPointInElevationSR(e){const i=bc(0,0,0,b(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return ZTe([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,s){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,i,r,s){if(A(i))return this._createComponentNormalsFlat(e,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,PE);for(let a=0;a<3;a++){const l=3*s[o+a];Wa[0]=i[l+0],Wa[1]=i[l+1],Wa[2]=i[l+2],xe(PE,Wa)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return new Kj(i,s,n)}_createComponentNormalsFlat(e,i){const r=Fn(i.length),s=new Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(e,i,n,PE);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return new Kj(r,s,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,PE);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:$(),count:0},r[c]=h),we(h.normal,h.normal,a),h.count++}}const s=Fn(3*i.length),n=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(Re(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new Kj(s,n,!1)}_getFaceVertices(e,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=e[a+0],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l+0],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,s){return this._getFaceVertices(e,i,r,Wa,OE,RE),be(OE,OE,Wa),be(RE,RE,Wa),Et(Wa,OE,RE),Re(s,Wa),s}_getOrCreateComponents(e){return vt(e.components,Q3t)}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const s=i.reprojection===Gh.ECEF?i.transformBeforeProject:null;if(b(s)&&(r=F3t(r,new Float64Array(r.length),s)),i.reprojection===Gh.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=b(s)?r:new Float64Array(r.length);return un(r,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(e,i,r){let s=e.vertexAttributes.normal;if(A(s))return null;const n=r.reprojection===Gh.ECEF?r.transformBeforeProject:null;if(b(n)&&(s=U3t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Gh.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=b(n)?s:new Float32Array(s.length);return N3t(s,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let s=e.vertexAttributes.tangent;if(A(s))return null;const n=r.reprojection===Gh.ECEF?r.transformBeforeProject:null;if(b(n)&&(s=k3t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Gh.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=b(n)?s:new Float32Array(s.length);return V3t(s,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=KMt(Hn(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return mDe(i,r,s),s}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(b(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(b(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(b(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(i),d=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Gh.NONE&&b(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,d,f),geometryTransformation:a.reprojection===Gh.NONE&&b(a.geometryTransformation)?a.geometryTransformation:Ge()}}_computeReprojectionInfo(e){const i=b(e.transform),r=i&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===it.Local?Gh.NONE:Gh.ECEF;if(i){if(r===Gh.NONE){const n=Ge();return Rm(e.spatialReference,e.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:JA(e.transform.localMatrix),needsBufferCopy:!1}}const s=cV(Ge(),e.transform.origin);return ln(s,s,e.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;v4[0]=o.x,v4[1]=o.y,v4[2]=o.z;const a=Ge();Rm(e.spatialReference,v4,a,n);const l=Bl.fromTypedArray(i);if(Va(Fge,a),DD(l,l,Fge),b(r)||b(s)){if(jp(dR,a),Hp(dR,dR),b(r)){const c=cs.fromTypedArray(r);pw(c,c,dR)}if(b(s)){const c=cs.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);pw(c,c,dR)}}return a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces?i.faces:i3(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return b(r)&&!e.spatialReference.equals(r)?(s=new Float64Array(i.length),un(e.vertexAttributes.position,e.spatialReference,0,s,r,0,n)):s=i,ls(Qj),ud(Qj,s,0,n),!sm(Qj,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Bp(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(A(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:d,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),g=new Array;let y=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const x=this._getOrCreateFaces(e,v);if(x.length===0)continue;const S=this._createComponentNormals(n,c,v,x);S.didFlipNormals&&(y=!0);const E=[[P.POSITION,new ct(n,3,!0)],[P.NORMAL,new ct(S.normals,3,!0)]],C=[[P.POSITION,x],[P.NORMAL,S.indices]];b(a)&&(E.push([P.COLOR,new ct(a,4,!0)]),C.push([P.COLOR,x])),b(l)&&(E.push([P.SYMBOLCOLOR,new ct(l,4,!0)]),C.push([P.SYMBOLCOLOR,new Array(x.length).fill(0)])),b(o)&&(E.push([P.UV0,new ct(o,2,!0)]),C.push([P.UV0,x])),b(h)&&(E.push([P.TANGENT,new ct(h,4,!0)]),C.push([P.TANGENT,x]));const R=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,v),U=new qn(O,E,C,null,xn.Mesh,R);U.transformation=f,g.push(U)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:d}}}let Kj=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};const v4=$(),Wa=$(),OE=$(),RE=$(),PE=$(),Fge=Ge(),dR=Hs(),Qj=Mo(),Q3t=[new D3t];var Gh;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Gh||(Gh={}));let eOt=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){sne(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>sO(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);b(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=$()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,og),at(e,this._lodRenderer.baseBoundingSphere.center,og)}getBoundingBoxObjectSpace(e=Mo()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,og);const i=this._lodRenderer.baseBoundingBox;ls(e);for(let r=0;r<8;++r)fe(Nd,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),at(Nd,Nd,og),Ey(e,Nd);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,og),e.render.origin[0]+=og[12],e.render.origin[1]+=og[13],e.render.origin[2]+=og[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=tOt,l=Ste(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,og);for(let h=0;h<l;h++){const d=a[h];Nd[0]=o[d[0]],Nd[1]=o[d[1]],Nd[2]=o[d[2]],at(Nd,Nd,og),ox[3*h+0]=Nd[0],ox[3*h+1]=Nd[1],ox[3*h+2]=Nd[2]}if(!e(ox,0,l))return null;ls(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],ox[h+d]),o[d+3]=Math.max(o[d+3],ox[h+d]);c&&r.push({location:ox.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(rm(o,eH),this.elevationContext.mode!=="absolute-height")){let h;const d=tne(o,i.service.spatialReference,i);try{h=await i.service.queryElevation(eH[0],eH[1],s,d,"ground")}catch{}b(h)&&Xxe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){if(e===q_.Highlight){const r=new v9(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const ox=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Nd=$(),eH=$(),tOt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],og=Ge();function iOt(t){const e=new Array;return t.stageResources.geometries.forEach(i=>{const r=t.stageResources.textures;e.push(new sLe(i,r))}),{components:e,minScreenSpaceRadius:vt(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function rOt(t){return{levels:t.map(e=>iOt(e))}}function sOt(t,e,i){if(t.count!==e.count)return void $z.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],d=i[7],f=i[8],m=i[9],g=i[10],y=i[11],v=i[12],x=i[13],S=i[14],E=i[15],C=t.typedBuffer,R=t.typedBufferStride,O=e.typedBuffer,U=e.typedBufferStride;for(let L=0;L<r;L++){const B=L*R,G=L*U,j=O[G],q=O[G+1],ie=O[G+2],ee=O[G+3];C[B]=s*j+l*q+f*ie+v*ee,C[B+1]=n*j+c*q+m*ie+x*ee,C[B+2]=o*j+h*q+g*ie+S*ee,C[B+3]=a*j+d*q+y*ie+E*ee}}function jDe(t,e,i){if(t.count!==e.count)return void $z.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],d=i[7],f=i[8],m=t.typedBuffer,g=t.typedBufferStride,y=e.typedBuffer,v=e.typedBufferStride;for(let x=0;x<r;x++){const S=x*g,E=x*v,C=y[E],R=y[E+1],O=y[E+2],U=y[E+3];m[S]=s*C+a*R+h*O,m[S+1]=n*C+l*R+d*O,m[S+2]=o*C+c*R+f*O,m[S+3]=U}}function nOt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],d=n[c+1],f=n[c+2],m=h*h+d*d+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*d,r[l+2]=g*f}}}function qK(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function oOt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:nOt,scale:qK,shiftRight:oOt,transformMat3:jDe,transformMat4:sOt},Symbol.toStringTag,{value:"Module"}));function aOt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let d=0;d<9;++d)r[l+d]=n[c+d];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:aOt},Symbol.toStringTag,{value:"Module"}));function lOt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let d=0;d<16;++d)r[l+d]=n[c+d];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:lOt},Symbol.toStringTag,{value:"Module"}));function cOt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function u8(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:cOt,makeDense:u8},Symbol.toStringTag,{value:"Module"}));function HDe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function qDe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(X_t(e.elementType)){const h=Z_t(e.elementType);if(Y_t(e.elementType))for(let d=0;d<a;++d)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let d=0;d<a;++d)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else HDe(t,e,i);return t}function uOt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:HDe,fill:uOt,normalizeIntegerBuffer:qDe},Symbol.toStringTag,{value:"Module"}));function jz(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function hOt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:jz,fill:hOt},Symbol.toStringTag,{value:"Module"}));function WDe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function YDe(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:WDe,fill:YDe},Symbol.toStringTag,{value:"Module"}));function jT(t,e){return new t(new ArrayBuffer(e*t.ElementCount*sPe(t.ElementType)))}let XDe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return $y(e)?(_i(i),Aee(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(A(this._streamDataRequester))return(await tr(i,{responseType:dOt[e]})).data;const s=await Sm(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw Pl(s.error),new J("",`Request for resource failed: ${s.error}`)}};const dOt={image:"image",binary:"array-buffer",json:"json"};function pOt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function fOt(t,e={}){return{data:t,parameters:{wrap:{s:qt.REPEAT,t:qt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let hS=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new J(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new hS(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new J((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!s.match(n))throw new J((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new hS(o,a,i)}},Uge=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var r$,kge;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(r$||(r$={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(kge||(kge={}));const ZDe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},mOt={pbrMetallicRoughness:ZDe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},gOt={ESRI_externalColorMixMode:"tint"},Vge=(t={})=>{const e={...ZDe,...t.pbrMetallicRoughness},i=yOt({...gOt,...t.extras});return{...mOt,...t,pbrMetallicRoughness:e,extras:i}};function yOt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const _Ot={magFilter:mt.LINEAR,minFilter:mt.LINEAR_MIPMAP_LINEAR,wrapS:qt.REPEAT,wrapT:qt.REPEAT},vOt=t=>({..._Ot,...t});function bOt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const b4={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let wOt=class k1{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=bOt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new J("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new J("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new J("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if($y(i)){const o=HL(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new k1(e,i,l)}catch{}const a=Aee(i);if(k1._isGLBData(a))return this._fromGLBData(e,i,a)}if(i.endsWith(".gltf")){const o=await e.loadJSON(i,r);return new k1(e,i,o)}const s=await e.loadBinary(i,r);if(k1._isGLBData(s))return this._fromGLBData(e,i,s);const n=await e.loadJSON(i,r);return new k1(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new Uge(e);return i.remainingBytes()>=4&&i.readUint32()===b4.MAGIC}static async _fromGLBData(e,i,r){const s=await k1._parseGLBData(r);return new k1(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new Uge(e);if(i.remainingBytes()<12)throw new J("gltf-loader-error","GLB binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==b4.MAGIC)throw new J("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new J("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new J("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),h=i.readUint32();if(l===0){if(h!==b4.CHUNK_TYPE_JSON)throw new J("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new J("gltf-loader-error","No JSON data found.");o=await B3t(i.readUint8Array(c))}else if(l===1){if(h!==b4.CHUNK_TYPE_BIN)throw new J("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=i.readUint8Array(c)}else le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new J("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new J("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new J("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new J("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new J("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[r$.MAT2,r$.MAT3,r$.MAT4])throw new J("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=SOt[r.type],a=EOt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Mt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Mt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Mt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Mt.UNSIGNED_BYTE:return u8(this._wrapAccessor(t3,r));case Mt.UNSIGNED_SHORT:return u8(this._wrapAccessor(lz,r));case Mt.UNSIGNED_INT:return u8(this._wrapAccessor(uz,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new J("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Mt.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Mt[r.componentType]);if(r.componentCount!==3)throw new J("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(cs,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new J("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Mt.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Mt[r.componentType]);if(r.componentCount!==3)throw new J("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(cs,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new J("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Mt.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Mt[r.componentType]);if(r.componentCount!==4)throw new J("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new ph(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new J("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new J("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Mt.FLOAT)return this._wrapAccessor(dv,r);if(!r.normalized)throw new J("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return COt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new J("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new J("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Mt.FLOAT)return this._wrapAccessor(ph,r);if(r.componentType===Mt.UNSIGNED_BYTE)return this._wrapAccessor(Gl,r);if(r.componentType===Mt.UNSIGNED_SHORT)return this._wrapAccessor(CD,r)}else if(r.componentCount===3){if(r.componentType===Mt.FLOAT)return this._wrapAccessor(cs,r);if(r.componentType===Mt.UNSIGNED_BYTE)return this._wrapAccessor(Q$,r);if(r.componentType===Mt.UNSIGNED_SHORT)return this._wrapAccessor(cz,r)}throw new J("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Mt[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var n,o,a,l,c,h,d,f,m,g;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const y=e.material!=null?Vge(this.json.materials[e.material]):Vge(),v=y.pbrMetallicRoughness,x=this.hasVertexColors(e),S=this.getTexture(v.baseColorTexture,i),E=this.getTexture(y.normalTexture,i),C=r?this.getTexture(y.occlusionTexture,i):void 0,R=r?this.getTexture(y.emissiveTexture,i):void 0,O=r?this.getTexture(v.metallicRoughnessTexture,i):void 0,U=e.material!=null?e.material:-1;s={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:v.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await S,normalTexture:await E,name:y.name,id:U,occlusionTexture:await C,emissiveTexture:await R,emissiveFactor:y.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await O,hasVertexColors:x,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(d=y.emissiveTexture)==null?void 0:d.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new J("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=vOt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return fee(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,h=d=>{throw new J("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return xOt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=ln(Ge(),r,s.matrix):s.translation||s.rotation||s.scale?(i=JA(r),s.translation&&fu(i,i,s.translation),s.rotation&&(w4[3]=pse(w4,s.rotation),ih(i,i,w4[3],w4)),s.scale&&aV(i,i,s.scale)):i=JA(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return nd(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=hS.parse(this.json.asset.version,"glTF");TOt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new J("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new J("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new zDe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new J("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new J("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new J("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return G3t(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await W8(Array.from(this._bufferLoaders.values())),i=await W8(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+((s==null?void 0:s.byteLength)??0),0)+i.reduce((r,s)=>r+(s?E2(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const xOt=$Te(Ge(),Math.PI/2),TOt=new hS(2,0,"glTF"),w4=Kp(),SOt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},EOt={[Mt.BYTE]:1,[Mt.UNSIGNED_BYTE]:1,[Mt.SHORT]:2,[Mt.UNSIGNED_SHORT]:2,[Mt.FLOAT]:4,[Mt.UNSIGNED_INT]:4};function COt(t){switch(t.componentType){case Mt.BYTE:return new hz(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Mt.UNSIGNED_BYTE:return new az(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Mt.SHORT:return new dz(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Mt.UNSIGNED_SHORT:return new cse(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Mt.UNSIGNED_INT:return new use(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Mt.FLOAT:return new dv(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let MOt=0;async function JDe(t,e,i={},r=!0){const s=await wOt.load(t,e,i),n="gltf_"+MOt++,o={lods:[],materials:new Map,textures:new Map,meta:AOt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await OOt(s,async(h,d,f,m)=>{const g=l.get(f)??0;l.set(f,g+1);const y=h.mode!==void 0?h.mode:Xt.TRIANGLES,v=y===Xt.TRIANGLES||y===Xt.TRIANGLE_STRIP||y===Xt.TRIANGLE_FAN?y:null;if(A(v))return void le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Xt[y]+"). Skipping primitive.");if(!s.hasPositions(h))return void le.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const x=s.getPositionData(h,i),S=s.getMaterial(h,i,r),E=s.hasNormals(h)?s.getNormalData(h,i):null,C=s.hasTangents(h)?s.getTangentData(h,i):null,R=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,i):null,O=s.hasVertexColors(h)?s.getVertexColors(h,i):null,U=s.getIndexData(h,i),L={transform:JA(d),attributes:{position:await x,normal:E?await E:null,texCoord0:R?await R:null,color:O?await O:null,tangent:C?await C:null},indices:await U,primitiveType:v,material:POt(o,await S,n)};let B=null;b(o.meta)&&b(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(B=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:B},o.lods[f].parts[g]=L});for(const h of o.lods)h.parts=h.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function AOt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;b(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function OOt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),ROt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const f of d.primitives)n.push(e(f,h,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function ROt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function POt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=fOt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:IOt.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=pOt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const IOt=[mt.LINEAR_MIPMAP_LINEAR,mt.LINEAR_MIPMAP_NEAREST];function $Ot(t,e=i3){return typeof t=="number"?e(t):see(t)||MT(t)?new Uint32Array(t):t}function LOt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=uPe(i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=t[n],a=t[n+1],l=t[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=t[n+1],a=t[n],l=t[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function DOt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}let NOt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},FOt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new NOt,this.numberOfVertices=0}};const z0=le.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function KDe(t,e){const i=await UOt(t,e),r=await GOt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+gSe(i)}}async function UOt(t,e){const i=b(e)&&e.streamDataRequester;if(i)return kOt(t,i,e);const r=await Sm(tr(t,e));if(r.ok===!0)return r.value.data;Pl(r.error),QDe(r.error)}async function kOt(t,e,i){const r=await Sm(e.request(t,"json",i));if(r.ok===!0)return r.value;Pl(r.error),QDe(r.error.details.url)}function QDe(t){throw new J("",`Request for object resource failed: ${t}`)}function VOt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(z0.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(z0.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(z0.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(z0.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else z0.warn("Indexed geometries must specify faces"),r=!1;break}default:z0.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(z0.warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(z0.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function zOt(t,e){const i=new Array,r=new Array,s=new Array,n=new Z3,o=t.resource,a=hS.parse(o.version||"1.0","wosr");HOt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const y=c[g];if(!VOt(y))continue;const v=jOt(y),x=y.params.vertexAttributes,S=[];for(const j in x){const q=x[j],ie=q.values;S.push([j,new ct(ie,q.valuesPerElement,!0)])}const E=[];if(y.params.topology!=="PerAttributeArray"){const j=y.params.faces;for(const q in j)E.push([q,j[q].values])}const C=v.texture,R=d&&d[C];if(R&&!m.has(C)){const{image:j,params:q}=R,ie=new $S(j,q);r.push(ie),m.set(C,ie)}const O=m.get(C),U=O?O.id:void 0,L=v.material;let B=n.get(L,C);if(A(B)){const j=h[L.substring(L.lastIndexOf("/")+1)].params;j.transparency===1&&(j.transparency=0);const q=R&&R.alphaChannelUsage,ie=j.transparency>0||q==="transparency"||q==="maskAndTransparency",ee=R?eNe(R.alphaChannelUsage):void 0,K={ambient:Qc(j.diffuse),diffuse:Qc(j.diffuse),opacity:1-(j.transparency||0),transparent:ie,textureAlphaMode:ee,textureAlphaCutoff:.33,textureId:U,initTextureTransparent:!0,doubleSided:!0,cullFace:ts.None,colorMixMode:j.externalColorMixMode||"tint",textureAlphaPremultiplied:!!R&&!!R.params.preMultiplyAlpha};b(e)&&e.materialParamsMixin&&Object.assign(K,e.materialParamsMixin),B=new Z_(K),n.set(L,C,B)}s.push(B);const G=new qn(B,S,E);f+=E.position?E.position.length:0,i.push(G)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:BOt(i)}}function BOt(t){const e=ls();return t.forEach(i=>{const r=i.boundingInfo;b(r)&&(Ey(e,r.bbMin),Ey(e,r.bbMax))}),e}async function GOt(t,e){const i=[];for(const n in t){const o=t[n],a=o.images[0].data;if(!a){z0.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:qt.REPEAT,t:qt.REPEAT},preMultiplyAlpha:eNe(h)!==Nr.Opaque},f=b(e)&&e.disableTextures?Promise.resolve(null):Y_(l,e);i.push(f.then(m=>({refId:c,image:m,params:d,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function eNe(t){switch(t){case"mask":return Nr.Mask;case"maskAndTransparency":return Nr.MaskBlend;case"none":return Nr.Opaque;default:return Nr.Blend}}function jOt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const HOt=new hS(1,2,"wosr"),IE=2.1;async function tNe(t,e){const i=iNe(pdt(t));if(i.fileType==="wosr"){const d=await(e.cache?e.cache.loadWOSR(i.url,e):KDe(i.url,e)),{engineResources:f,referenceBoundingBox:m}=zOt(d,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):JDe(new XDe(e.streamDataRequester),i.url,e,e.usePBR)),s=Hn(r.model.meta,"ESRI_proxyEllipsoid"),n=r.meta.isEsriSymbolResource&&b(s)&&r.meta.uri.includes("/RealisticTrees/");n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,ZOt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=rNe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function iNe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function rNe(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=ls();return s.lods.forEach((h,d)=>{const f=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(f&&d!==0)return;const m=new FOt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(g=>{const y=f?new Z_({}):qOt(s,g,m,e,i,o,a),{geometry:v,vertexCount:x}=WOt(g,b(y)?y:new Z_({})),S=v.boundingInfo;b(S)&&d===0&&(Ey(c,S.bbMin),Ey(c,S.bbMax)),b(y)&&(m.stageResources.geometries.push(v),m.numberOfVertices+=x)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function qOt(t,e,i,r,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=b(e.attributes.texCoord0),h=b(e.attributes.normal);if(A(l))return null;const d=YOt(l.alphaMode);if(!n.has(a)){if(c){const C=(R,O=!1)=>{if(b(R)&&!o.has(R)){const U=t.textures.get(R);if(b(U)){const L=U.data;o.set(R,new $S(E2(L)?L.data:L,{...U.parameters,preMultiplyAlpha:!E2(L)&&O,encoding:E2(L)&&b(L.encoding)?L.encoding:void 0}))}}};C(l.textureColor,d!==Nr.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const m=l.color[0]**(1/IE),g=l.color[1]**(1/IE),y=l.color[2]**(1/IE),v=l.emissiveFactor[0]**(1/IE),x=l.emissiveFactor[1]**(1/IE),S=l.emissiveFactor[2]**(1/IE),E=b(l.textureColor)&&c?o.get(l.textureColor):null;n.set(a,new Z_({...r,transparent:d===Nr.Blend,customDepthTest:Q2.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,g,y],ambient:[m,g,y],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?ts.None:ts.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Pr.Attribute:Pr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:b(E)?E.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:b(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:b(E)&&!!E.params.preMultiplyAlpha,occlusionTextureId:b(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:b(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:b(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,x,S],mrrFactors:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:Jg(l.colorTextureTransform),normalTextureTransformMatrix:Jg(l.normalTextureTransform),occlusionTextureTransformMatrix:Jg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Jg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Jg(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(i.stageResources.materials.push(f),c){const m=g=>{b(g)&&i.stageResources.textures.push(o.get(g))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function WOt(t,e){const i=t.attributes.position.count,r=XOt(t.indices||i,t.primitiveType),s=jT(cs,i);DD(s,t.attributes.position,t.transform);const n=[[P.POSITION,new ct(s.typedBuffer,s.elementCount,!0)]],o=[[P.POSITION,r]];if(b(t.attributes.normal)){const a=jT(cs,i);XA(x4,t.transform),pw(a,t.attributes.normal,x4),n.push([P.NORMAL,new ct(a.typedBuffer,a.elementCount,!0)]),o.push([P.NORMAL,r])}if(b(t.attributes.tangent)){const a=jT(ph,i);XA(x4,t.transform),jDe(a,t.attributes.tangent,x4),n.push([P.TANGENT,new ct(a.typedBuffer,a.elementCount,!0)]),o.push([P.TANGENT,r])}if(b(t.attributes.texCoord0)){const a=jT(dv,i);qDe(a,t.attributes.texCoord0),n.push([P.UV0,new ct(a.typedBuffer,a.elementCount,!0)]),o.push([P.UV0,r])}if(b(t.attributes.color)){const a=jT(Gl,i);if(t.attributes.color.elementCount===4)t.attributes.color instanceof ph?qK(a,t.attributes.color,255):t.attributes.color instanceof Gl?WDe(a,t.attributes.color):t.attributes.color instanceof CD&&qK(a,t.attributes.color,1/256);else{YDe(a,255,255,255,255);const l=new Q$(a.buffer,0,4);t.attributes.color instanceof cs?RK(l,t.attributes.color,255):t.attributes.color instanceof Q$?jz(l,t.attributes.color):t.attributes.color instanceof cz&&RK(l,t.attributes.color,1/256)}n.push([P.COLOR,new ct(a.typedBuffer,a.elementCount,!0)]),o.push([P.COLOR,r])}return{geometry:new qn(e,n,o),vertexCount:i}}const x4=Hs();function YOt(t){switch(t){case"BLEND":return Nr.Blend;case"MASK":return Nr.Mask;case"OPAQUE":case null:case void 0:return Nr.Opaque}}function XOt(t,e){switch(e){case Xt.TRIANGLES:return $Ot(t);case Xt.TRIANGLE_STRIP:return LOt(t);case Xt.TRIANGLE_FAN:return DOt(t)}}function ZOt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(A(n))return;const o=s.attributes.position,a=o.count,l=$(),c=$(),h=$(),d=jT(Gl,a),f=jT(cs,a),m=Va(Ge(),s.transform);for(let g=0;g<a;g++){o.getVec(g,c),n.getVec(g,l),at(c,c,s.transform),be(h,c,e.center),dU(h,h,e.radius);const y=h[2],v=ze(h),x=Math.min(.45+.55*v*v,1);dU(h,h,e.radius),m!==null&&at(h,h,m),Re(h,h),i+1!==t.model.lods.length&&t.model.lods.length>1&&En(h,h,l,y>-1?.2:Math.min(-4*y-3.8,1)),f.setVec(g,h),d.set(g,0,255*x),d.set(g,1,255*x),d.set(g,2,255*x),d.set(g,3,255)}s.attributes.normal=f,s.attributes.color=d}}}const $ti=Object.freeze(Object.defineProperty({__proto__:null,fetch:tNe,gltfToEngineResources:rNe,parseUrl:iNe},Symbol.toStringTag,{value:"Module"}));var Cs;function JOt(t){let e=qs().mat4f64(P.LOCALTRANSFORM).mat4f64(P.GLOBALTRANSFORM).vec4f64(P.BOUNDINGSPHERE).vec3f64(P.MODELORIGIN).mat3f(P.MODEL).mat3f(P.MODELNORMAL).vec2f(P.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(P.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(P.FEATUREATTRIBUTE)),e=e.u8(P.STATE).u8(P.LODLEVEL),t.includes(P.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(P.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Cs||(Cs={}));let KOt=class{constructor(e){this.localTransform=e.getField(P.LOCALTRANSFORM,K$),this.globalTransform=e.getField(P.GLOBALTRANSFORM,K$),this.modelOrigin=e.getField(P.MODELORIGIN,Bl),this.model=e.getField(P.MODEL,aw),this.modelNormal=e.getField(P.MODELNORMAL,aw),this.modelScaleFactors=e.getField(P.MODELSCALEFACTORS,dv),this.boundingSphere=e.getField(P.BOUNDINGSPHERE,oz),this.color=e.getField(P.COLOR,ph),this.featureAttribute=e.getField(P.FEATUREATTRIBUTE,ph),this.state=e.getField(P.STATE,t3),this.lodLevel=e.getField(P.LODLEVEL,t3),this.objectAndLayerIdColor=e.getField(P.OBJECTANDLAYERIDCOLOR,Gl)}},eM=class extends Ee{constructor(e,i){super(e),this.events=new ws,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=JOt(i)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Cs.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;Rt(e>=0&&e<this._capacity&&(i.get(e)&Cs.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Cs.ACTIVE)?this._setStateFlags(e,Cs.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;Rt(e>=0&&e<this._capacity&&(i.get(e)&Cs.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Wv,s=df;i.localTransform.getMat(e,zge),i.globalTransform.getMat(e,tH);const n=ln(tH,tH,zge);fe(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),jp(s,n),i.model.setMat(e,s);const o=Ugt(Wv,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),AS(s,s),Hp(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,Cs.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,df),r.modelOrigin.getVec(e,Wv),i[0]=df[0],i[1]=df[1],i[2]=df[2],i[3]=0,i[4]=df[3],i[5]=df[4],i[6]=df[5],i[7]=0,i[8]=df[6],i[9]=df[7],i[10]=df[8],i[11]=0,i[12]=Wv[0],i[13]=Wv[1],i[14]=Wv[2],i[15]=1}applyShaderTransformation(e,i){b(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),b(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){return this._view.localTransform.getMat(e,i),b(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);if(b(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Wv,this,e);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);if(b(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Wv,this,e);i*=QOt(r[0],r[1],r[2])}return i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}getColor(e,i){this._view.color.getVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Cs.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Cs.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Cs.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Cs.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){const e=Math.max(eRt,Math.floor(this._capacity*tRt)),i=this._layout.createBuffer(e);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=e,this._buffer=i,this._view=new KOt(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Cs.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function QOt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}u([p({constructOnly:!0})],eM.prototype,"shaderTransformation",void 0),u([p()],eM.prototype,"_size",void 0),u([p({readOnly:!0})],eM.prototype,"size",null),eM=u([N("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],eM);const eRt=1024,tRt=2,Wv=$(),df=Hs(),zge=Ge(),tH=Ge();let iRt=class extends lm{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=to(),this._tmpMat4=Ge(),this._instanceData=e,this._boundingSphere=i}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);at(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*K2(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},rRt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},sRt=class extends pz{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function Ane(t){return Vm(t)&&t.intersector===Vs.LOD&&!!t.target}let nRt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new BLe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=yr.createVertex(r,or.STATIC_DRAW,l.buffer),this.vao=new km(r,rr,{geometry:vh(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(h,d,f,m,g)=>{if(h>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,h))return;const y=new sRt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Vs.LOD,y,h,d,e.transform.transform,g),e.options.store!==Ga.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Vs.LOD,y,h,d,e.transform.transform,g),e.options.store===Ga.ALL){const v=bse(e.results.min.ray);v.set(Vs.LOD,y,h,d,e.transform.transform,g),e.results.all.push(v)}}})}},oRt=class sNe{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new nRt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(b);if(yo(r)||n.length!==s.length){n.forEach(o=>o.destroy()),_i(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new sNe(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(A(this._boundingBox)){const e=ls();this.components.forEach(i=>{b(i.boundingInfo)&&(Ey(e,i.boundingInfo.bbMin),Ey(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(A(this._boundingSphere)){const e=this.boundingBox,i=$();rm(e,i),this._boundingSphere={center:i,radius:.5*Yxe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}},aRt=class{constructor(e,i,r){this._elementSize=i,this._buffer=yr.createVertex(e,or.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},lRt=class{constructor(e){this.modelOriginHi=e.getField(P.MODELORIGINHI,cs),this.modelOriginLo=e.getField(P.MODELORIGINLO,cs),this.model=e.getField(P.MODEL,aw),this.modelNormal=e.getField(P.MODELNORMAL,aw),this.color=e.getField(P.INSTANCECOLOR,ph),this.featureAttribute=e.getField(P.INSTANCEFEATUREATTRIBUTE,ph),this.objectAndLayerIdColor=e.getField(P.OBJECTANDLAYERIDCOLOR_INSTANCED,Gl)}},Bge=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Rt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Rt(this._updating,"not updating"),this.size<uRt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Rt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Rt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Rt(this._updating,"not updating"),Rt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Gge,Math.floor(this._capacity*cRt));this._resize(e)}_shrink(){const e=Math.max(Gge,Math.floor(this._capacity*hRt));this._resize(e)}_resize(e){if(Rt(this._updating,"not updating"),e===this._capacity)return;const i=new aRt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);Rt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new lRt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const Gge=1024,cRt=2,uRt=.3,hRt=.5,dRt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new rRt(e,i)};let tp=class extends Ee{constructor(e,i){super(e),this.type=Vs.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new jt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ie.OPAQUE_MATERIAL,Ie.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new eM({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=i.registerTask(Nt.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=fRt(this.optionalFields),this._glInstanceBufferLayout=vh(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new Bge(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Bge(r,this._instanceBufferLayout)),oRt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(b);if(yo(i)||n.length!==s.length){n.forEach(o=>o.destroy()),_i(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=dRt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(i=>i.material.requiresSlot(Ie.TRANSPARENT_MATERIAL,H.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!_r.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(gc),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==H.Highlight&&e.output!==H.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==H.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||A(this._octree))return;const n=$();be(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,qge),e.transform.set(qge),at(Wge,r,e.transform.inverse),at(Yge,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;Rt((l&Cs.ACTIVE)!=0,"invalid instance state"),Rt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,i,Wge,Yge,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(A(this._octreeCached)){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new iRt(i,this.baseBoundingSphere);for(let s=0;s<i.capacity;++s)r.get(s)&Cs.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=He(this._octreeCached)}_queryDepthRangeOctree(e){if(A(this._octree))return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,lm.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,lm.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,ag),be(ag,ag,n);const a=xe(ag,i)-ag[3];o.boundingSphere.getVec(s,ag),be(ag,ag,n);const l=xe(ag,i)+ag[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let f=0;if(!(d&Cs.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(d&Cs.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),d&Cs.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),d&Cs.REMOVE)n.freeInstance(c);else if(d&Cs.VISIBLE){let g=0;i&&(o.modelOrigin.getVec(c,Hge),g=s.selectLevel(Hge,n.getCombinedMedianScaleFactor(c),r)),f=d&~(Cs.ACTIVE|Cs.TRANSFORM_CHANGED),g>=0&&(d&Cs.HIGHLIGHT?(jge(this._highlightRenderInstanceData[g],o,c),f|=Cs.HIGHLIGHT_ACTIVE):(jge(this._defaultRenderInstanceData[g],o,c),f|=Cs.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=d&~(Cs.ACTIVE|Cs.TRANSFORM_CHANGED),o.state.set(c,f);if(b(this._octreeCached)){const g=!!(d&Cs.ACTIVE),y=!!(f&Cs.ACTIVE);!g&&y?this._octreeCached.addInstance(c):g&&!y?this._octreeCached.removeInstance(c):g&&y&&d&Cs.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,i){this.levels.forEach((r,s)=>{const n=r.components.map(o=>this._beginComponent(e,i[s],o));r.components.forEach((o,a)=>this._renderComponent(e,n[a],i[s],o,s))})}_beginComponent(e,i,r){const{bindParameters:s,rctx:n,output:o}=e;if(i.size===0||!r.material.requiresSlot(s.slot,e.output))return null;const a=r.glMaterials.load(n,s.slot,o);return b(a)?a.beginSlot(s):null}_renderComponent(e,i,r,s,n){if(A(i))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(i,s.material.parameters,o);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),l.bindDraw(mRt,o,s.material.parameters),_r.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===H.Color&&(l.setUniform4fv("externalColor",Xge[Math.min(n,Xge.length-1)]),l.setUniform1i("colorMixMode",i$e.replace));const c=a.capabilities.instancing,h=r.capacity,d=r.headIndex,f=r.tailIndex,m=r.firstIndex,g=this._glInstanceBufferLayout,y=(v,x)=>{Gre(a,rr,r.buffer,g,v),c.drawArraysInstanced(i.primitiveType,0,s.vertexCount,x-v),jre(a,rr,r.buffer,g)};s.material.parameters.transparent&&m!=null?d>f?(Rt(m>=f&&m<=d,"invalid firstIndex"),y(m,d),y(f,m)):d<f&&(m<=d?(Rt(m>=0&&m<=d,"invalid firstIndex"),y(m,d),y(f,h),y(0,m)):(Rt(m>=f&&m<=h,"invalid firstIndex"),y(m,h),y(0,d),y(f,m))):d>f?y(f,d):d<f&&(y(0,d),y(f,h)),a.bindVAO(null)}};function jge(t,e,i){const r=t.allocateHead();pRt(e,i,t.view,r)}function pRt(t,e,i,r){uvt(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function fRt(t){let e=qs().vec3f(P.MODELORIGINHI).vec3f(P.MODELORIGINLO).mat3f(P.MODEL).mat3f(P.MODELNORMAL);return b(t)&&t.includes("color")&&(e=e.vec4f(P.INSTANCECOLOR)),b(t)&&t.includes("featureAttribute")&&(e=e.vec4f(P.INSTANCEFEATUREATTRIBUTE)),b(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(P.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}u([p({constructOnly:!0})],tp.prototype,"symbol",void 0),u([p({constructOnly:!0})],tp.prototype,"optionalFields",void 0),u([p({constructOnly:!0})],tp.prototype,"metadata",void 0),u([p({constructOnly:!0})],tp.prototype,"shaderTransformation",void 0),u([p()],tp.prototype,"_instanceData",void 0),u([p()],tp.prototype,"_cycleStartIndex",void 0),u([p({readOnly:!0})],tp.prototype,"_enableLevelSelection",null),u([p()],tp.prototype,"_updateCyclesWithStaticCamera",void 0),u([p({readOnly:!0})],tp.prototype,"running",null),tp=u([N("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],tp);const Hge=$(),ag=Ai(),qge=Ge(),Wge=$(),Yge=$(),Xge=[di(1,0,1,1),di(0,0,1,1),di(0,1,0,1),di(1,1,0,1),di(1,0,0,1)],mRt=new hAt;let Zge=class{constructor(e,i,r,s,n,o,a,l,c,h,d,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},gRt=class extends By{getCachedSize(){const[e,i,r]=b(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&Iz(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this._isPrimitive){const r=i.resource?i.resource.primitive:oTe;this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(i.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return b(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return b(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,i=Hn(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=r,e.cullFace=s?ts.None:ts.Back,e}async _createResourcesForPrimitive(e,i){if(!EEt(e))throw new Error(`Unknown object symbol primitive: ${e}`);const r=this.symbolLayer,s=Mo(qZe(e)),n=Qc(bN(s)),o=Qc(XB(n,r)),a=ze(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:ey,diffuse:ey,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:S,minWorldLength:E,maxWorldLength:C}=f.verticalOffset;h.verticalOffset={screenLength:ka(S),minWorldLength:E||0,maxWorldLength:b(C)?C:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Tp;else{const S=b(r.material)?r.material.color:null,E=b(S)?et.toUnitRGBA(S):Tp;h.externalColor=E}this._fastUpdates=yL(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,vx)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),me("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new Z_(h),g=oLe(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=e4(g).map(S=>({opacity:1,transparent:S.parameters.transparent})),v=await this._createStageResources(g,d,i),x=await this._createLodRenderer(g,i);return new Zge(g,x,v,y,n,l,c,s,o,a,d,vx)}async _createResourcesForUrl(e,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=yL(this._context.renderer,this._fastVisualVariableConvertOptions(vx,vx,vx,vx)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color")),me("enable-feature:objectAndLayerId-rendering")&&(r.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:G,minWorldLength:j,maxWorldLength:q}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:ka(G),minWorldLength:j||0,maxWorldLength:b(q)?q:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await tNe(e,s),l=a.isEsriSymbolResource,c=a.isWosr,h=rOt(a.lods);h.levels.sort((G,j)=>G.minScreenSpaceRadius-j.minScreenSpaceRadius);const d=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=Hn(this.symbolLayer,"material","color"),y=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),v=this.needsDrivenTransparentPass,x=e4(h),S=e4(h).map(G=>({opacity:G.parameters.opacity||1,transparent:G.parameters.transparent}));x.forEach(G=>{const j=G.parameters;G.setParameters(m);const q=j.opacity*y,ie=q<1||v||j.transparent;G.setParameters({opacity:q,transparent:ie}),d.screenSizePerspectiveEnabled&&G.setParameters({screenSizePerspective:d.sharedResources.screenSizePerspectiveSettings})});const E=a.referenceBoundingBox,C=Qc(bN(E)),R=Qc(h.levels[0].pivotOffset),O=Qc(XB(C,this.symbolLayer)),U=ze(O);_L(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(E,O,C,R))&&x.forEach(G=>G.setParameters(this._fastUpdates.materialParameters));const L=await this._createStageResources(h,o,i),B=await this._createLodRenderer(h,i);return new Zge(h,B,L,S,C,l,c,E,O,U,o,R)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=e4(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=wme(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,r),_i(r);const a=xme(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,T4),Bo(c,VK(this._fastUpdates.materialParameters,T4,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,T4),ZAt(a,this._fastUpdates.materialParameters,T4))}:null,o=new tp({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o),o.destroy()}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Tp:b(e)&&b(e.color)?i.externalColor=et.toUnitRGBA(e.color):(i.externalColor=Tp,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=dL(i.geometry);if(A(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new zm),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(A(this._resources))return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=Hn(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?ts.None:ts.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,hw)}slicePlaneEnabledChanged(){if(A(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(A(this._resources))return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,i){if(A(this._resources))return To.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!_L(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return To.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return To.Fast_Update}computeComplexity(){if(A(this._resources))return super.computeComplexity();const e=this._resources.lodResources,i=nLe(e.levels[0]).reduce((n,o)=>n+o.indices.get(P.POSITION).length,0)/3,r=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=wme(e).reduce((n,o)=>n+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+xme(e).reduce((n,o)=>n+r(o),0);return{primitivesPerFeature:i,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...cLe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return b(this._resources)}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||A(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?ZI(r.color,r.opacity):null,c=this._context.clippingExtent;if(ll(i,$E,this._context.elevationProvider.spatialReference),b(c)&&!xte(c,$E))return null;const h=this._requiresTerrainElevation(s),d=this._computeGlobalTransform(i,s,iH,S4),f=this._computeLocalTransform(this._resources,this.symbolLayer,r,Jge),m=this._resources.lodRenderer.instanceData,g=m.addInstance();this._instanceIndexToGraphicUid.set(g,n),m.setLocalTransform(g,f,!1),m.setGlobalTransform(g,d),a&&m.setFeatureAttribute(g,a),l&&m.setColor(g,l),b(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new eOt(this,g,mEt,s);return h&&(y.alignedSampledElevation=S4.sampledElevation),y.needsElevationUpdates=hw(s.mode),hL(y,i,this._context.elevationProvider),y}_computeGlobalTransform(e,i,r,s){return sO(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),$E[0]=e.x,$E[1]=e.y,$E[2]=s.z,Rm(e.spatialReference,$E,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return zp(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=vme(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||aV(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(A(this._resources))return!0;const r=i&&dL(i);if(A(r))return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,iH,S4),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=S4.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,iH,!0),hL(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||A(this._resources))return;const r=(g,y,v)=>vt(g!=null&&g.type==="complete"?g.newValue:y,v),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:d},m=this._resources;this.loadStatus===td.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Qc(XB(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(m,f,y,Jge),x=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(x,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=b(s)?et.toUnitRGBA(s):Tp;delete r.color;const o=this._resources;A(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return sEt(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const s=$();switch(r.anchor){case"center":ge(s,rm(e)),Ul(s,s);break;case"top":{const n=rm(e);fe(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=rm(e);fe(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=rm(e),o=bN(e),a=r.anchorPosition,l=a?Ve(a.x,a.y,a.z):Fl;Uk(s,o,l),we(s,s,n),Ul(s,s);break}default:b(i)?Ul(s,i):ge(s,Fl)}return s}_applyAnchor(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);s&&fu(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=b(e)?Qc(bN(e)):ey,o=b(e)?this._computeAnchor(e,s,this.symbolLayer):Fl,a=this._context.renderCoordsHelper.unitInMeters,l=vme(b(i)?i:void 0,i,r,a),c=Ve(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:b(i)?i:ey,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const $E=$(),Jge=Ge(),iH=Ge(),T4=Ai(),S4=new LD;function yRt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function _Rt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function WK(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function vRt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function bRt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function wRt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function xRt(t){return t[0]*t[3]-t[2]*t[1]}function nNe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*h,t[3]=s*c+o*h,t}function TRt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function SRt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function ERt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function CRt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function MRt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ARt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function ORt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function RRt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function oNe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function PRt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function IRt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=ul();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function $Rt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function LRt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const DRt=nNe,NRt=oNe;Object.freeze(Object.defineProperty({__proto__:null,LDU:ORt,add:RRt,adjoint:wRt,copy:yRt,determinant:xRt,equals:IRt,exactEquals:PRt,frob:ARt,fromRotation:ERt,fromScaling:CRt,identity:_Rt,invert:bRt,mul:DRt,multiply:nNe,multiplyScalar:$Rt,multiplyScalarAndAdd:LRt,rotate:TRt,scale:SRt,set:WK,str:MRt,sub:NRt,subtract:oNe,transpose:vRt},Symbol.toStringTag,{value:"Module"}));let FRt=class extends qn{constructor(e,i,r,s,n,o,a,l){super(e,i,r,null,xn.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=o,this.stencilWidth=a}};var Fb;function aNe(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Fb||(Fb={}));function lNe(){return[1,0,0,1]}function URt(t){return[t[0],t[1],t[2],t[3]]}function kRt(t,e,i,r){return[t,e,i,r]}function VRt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:URt,create:lNe,createView:VRt,fromValues:kRt},Symbol.toStringTag,{value:"Module"}));function cNe(){return{up:$(),right:$()}}function zRt(t,e,i){at(t.up,e.up,i),at(t.right,e.right,i)}function BRt(t,e,i){Vt(t,xe(i,e.right),xe(i,e.up))}let GRt=class{constructor(){this.pos=$(),this.posES=$(),this.vLeft=$(),this.vRight=$(),this.vMinSiblingLength=0,this.frame=cNe(),this.rotationFrameUp=$(),this.rotationRight=je(),this.rotationAngle=0,this.miterStretch=lNe(),this.maxStretchDistance=0}setFrameFromUpVector(e){ge(this.frame.up,e),we(tM,this.vLeft,this.vRight),Re(tM,tM),pe(YK,this.frame.up,xe(tM,this.frame.up)),be(C4,tM,YK),Re(C4,C4),Et(this.frame.right,C4,this.frame.up)}},uNe=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,i){return this.vertices.push(bM(e)),this.vertexNormals.push(bM(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:bM(e),normal:i?bM(i):null}),this.poles.length-1}addSegment(e,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}};function jRt(t=20){const i=new uNe,r={v0:0,v1:0};i.addPole(nr(0,0));for(let n=0;n<t;++n){const o=2*n*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=nr(a*.5,l*.5),h=nr(a,l);i.addVertex(c,h)}for(let n=0;n<t-1;++n){const o={v0:n,v1:n+1};i.addSegment(o,r)}const s={v0:t-1,v1:0};return i.addSegment(s,r),i}function HRt(){const i=new uNe,r=nr(.5*-1,.5*-1),s=nr(.5*1,.5*-1),n=nr(.5*1,.5*1),o=nr(.5*-1,.5*1),a=nr(0,-1),l=nr(1,0),c=nr(0,1),h=nr(-1,0);return i.addPole(nr(0,.5*1),c),i.addPole(nr(0,.5*1)),i.addPole(nr(0,.5*-1)),i.addPole(nr(0,.5*-1),a),i.addVertex(r,a),i.addVertex(s,a),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(o,h),i.addVertex(r,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),i}let qRt=class{constructor(e){this.vertices=e,this.offset=$(),this.xform=Ge();const i=Math.floor((e.length-1)/2);ge(this.offset,this.vertices[i].pos);for(const r of this.vertices)be(r.pos,r.pos,this.offset);fu(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];i.index=0,i.vLeft=$(),be(i.vRight,this.vertices[1].pos,i.pos);let r=ze(i.vRight);i.vMinSiblingLength=r,Re(i.vRight,i.vRight);let s=i;for(let n=1;n<e;++n){const o=this.vertices[n];if(o.index=n,o.vLeft=s.vRight,n<e-1){be(o.vRight,this.vertices[n+1].pos,o.pos);const a=ze(o.vRight);o.vMinSiblingLength=Math.min(r,a),r=a,Re(o.vRight,o.vRight)}else ge(o.vRight,o.vLeft),o.vMinSiblingLength=r;s=o}}};function WRt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=$(),o=$(),a=$(),l=$(),c=$(),h=$(),d=gr();let f=t.vertices[0];ge(o,e),fe(n,0,1,0),b9(f.vRight,o,n,n,a,o,s),ge(f.frame.up,o),ge(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=t.vertices[m],we(c,f.vLeft,f.vRight);let g=ze(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),we(h,i.pos,i.frame.up),xD(f.pos,c,d),OS(d,Td(h,f.vLeft),l)?(be(l,l,f.pos),Re(o,l),Et(a,c,o),Re(a,a)):b9(c,i.frame.up,i.frame.right,n,a,o,s),ge(f.frame.up,o),ge(f.frame.right,a),i=f}}let YRt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],!1)}},rH=class{constructor(e=.8*Math.PI,i=1){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=tPt;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){vd(eye,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),zRt(s,e.frame,eye);for(let o=0;o<i.vertices.length;++o)Us(i.vertices[o],e.rotationRight)*e.rotationAngle>=0?r(e.index,s,i.vertices[o],i.vertexNormals[o],!1):(RZ(u2,i.vertices[o],e.miterStretch),r(e.index,e.frame,u2,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Us(i.vertices[o],e.rotationRight)*e.rotationAngle>=0;RZ(u2,i.vertices[o],e.miterStretch),r(e.index,e.frame,u2,i.vertexNormals[o],!a)}}},One=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],0,0)}},Kge=class extends One{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},E4=class extends One{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(e,i){const r=Rne;Vt(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(e,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}},Qge=class extends One{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=e.frame,s=.5*this.sign,n=u2,o=Rne;Vt(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(e.index,r,l.position,l.normal,s,0):i(e.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(e.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let d=0;d<this.profile.vertices.length;++d){const f=this.profile.poles[this.profile.poleIndices[d]];Bs(n,this.profile.vertices[d],f.position),tl(n,n,c),f.normal?(ed(n,n,f.position),i(e.index,r,n,f.normal,s*h,0)):(iw(o,n),tl(o,o,c),ed(n,n,f.position),i(e.index,r,n,o,s*h,this.sign*h))}}}buildTopology(e,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,d=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,g=s+f*this.profile.vertices.length+a;this.flip?(i(m,d,h),i(d,m,g)):(i(h,d,m),i(g,m,d)),h=m,d=g}this.flip?(i(l,d,h),l!==c&&i(l,c,d)):(i(h,d,l),l!==c&&i(d,c,l))}}},XRt=class{constructor(e,i,r,s,n,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=i,this.path=e,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=Fn(1*this.numVerticesTotal),this.profileRightAxisData=Fn(4*this.numVerticesTotal),this.profileUpAxisData=Fn(4*this.numVerticesTotal),this.profileVertexAndNormalData=Fn(4*this.numVerticesTotal),this.originData=Fn(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,d)=>{n.push(c),n.push(h),n.push(d),o.push(c),o.push(h),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const h=this.profile.vertexIndices[2*c],d=this.profile.vertexIndices[2*c+1];for(let f=0;f<r;++f){const m=f*e+h,g=(f+1)*e+d,y=f*e+d;l(m,(f+1)*e+h,g),l(m,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=iA(n),this.normalIndices=iA(o),this.pathVertexIndices=iA(a)}onPathChanged(){this._rebuildGeometry()}},hNe=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},dNe=class extends hNe{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=Fn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=Fn(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=JRt;fe(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=YK,l=u2,c=tM,h=QRt,d=ePt;let f=0,m=0;if(fe(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),fe(d,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),Vt(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),s)Et(c,d,h),f=this.builder.profileRightAxisData[o+3]*e[0],m=this.builder.profileUpAxisData[o+3];else{const y=Rne,v=KRt;Vt(y,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const x=J2(y);iw(y,y);const S=Us(l,y);if(Math.abs(S)>x){Vt(v,-y[1],y[0]);const E=Us(l,v);tl(y,y,x*Math.sign(S)),tl(v,v,E),ed(l,y,v)}fe(c,0,0,0)}fe(a,h[0]*l[0]+d[0]*l[1],h[1]*l[0]+d[1]*l[1],h[2]*l[0]+d[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const g=u2;Vt(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*g[0]+d[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*g[0]+d[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*g[0]+d[2]*g[1]+c[2]*m}}createGeometryData(){const e=[[P.POSITION,this.builder.vertexIndices],[P.NORMAL,this.builder.normalIndices]],i=[[P.POSITION,new ct(this.vertexAttributePosition,3,!0)],[P.NORMAL,new ct(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push([P.COLOR,new Array(r).fill(0)]),i.push([P.COLOR,new ct(this.vertexAttributeColor,4)])}return{vertexAttributes:i,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,i,r){const s=this.builder.vertexIndices,n=new ct(this.vertexAttributePosition,3),o=s.length/3;PD(e,i,0,o,s,n,void 0,void 0,r)}},ZRt=class extends hNe{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new dNe(e),this.vvData=Fn(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[P.POSITION,new ct(this.builder.originData,3,!0)],[P.PROFILERIGHT,new ct(this.builder.profileRightAxisData,4,!0)],[P.PROFILEUP,new ct(this.builder.profileUpAxisData,4,!0)],[P.PROFILEVERTEXANDNORMAL,new ct(this.builder.profileVertexAndNormalData,4,!0)],[P.FEATUREVALUE,new ct(this.vvData,4,!0)]],indices:[[P.POSITION,this.builder.pathVertexIndices],[P.PROFILERIGHT,this.builder.vertexIndices],[P.PROFILEUP,this.builder.vertexIndices],[P.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[P.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const JRt=$(),u2=je(),Rne=je(),KRt=je(),YK=$(),tM=$(),QRt=$(),ePt=$(),C4=$(),tPt=cNe(),eye=Ge(),sH=8;function iPt(t,e){const i=P.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(T`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new hr("size",s=>s.size)),e.vvSize?(r.uniforms.add(new fi("vvSizeMinSize",s=>s.vvSizeMinSize)),r.uniforms.add(new fi("vvSizeMaxSize",s=>s.vvSizeMaxSize)),r.uniforms.add(new fi("vvSizeOffset",s=>s.vvSizeOffset)),r.uniforms.add(new fi("vvSizeFactor",s=>s.vvSizeFactor)),r.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",sH),r.uniforms.add([new Dl("vvOpacityValues",s=>s.vvOpacityValues,sH),new Dl("vvOpacityOpacities",s=>s.vvOpacityOpacities,sH)]),r.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",vm),r.uniforms.add([new Dl("vvColorValues",s=>s.vvColorValues,vm),new Mz("vvColorColors",s=>s.vvColorColors,vm)]),r.code.add(T`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(ED),t.attributes.add(P.PROFILERIGHT,"vec4"),t.attributes.add(P.PROFILEUP,"vec4"),t.attributes.add(P.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let rPt=class extends Kse{constructor(){super(...arguments),this.size=nr(1,1)}};function sPt(t){const e=new ar,{vertex:i,fragment:r}=e;switch(ah(i,t),e.varyings.add("vpos","vec3"),e.include(iPt,t),t.output!==H.Color&&t.output!==H.Alpha||(e.include(au,t),e.include(cS,t),e.include(X3,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===H.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Ed,t),t.output){case H.Alpha:e.include(Un,t),r.uniforms.add(new Be("opacity",s=>s.opacity)),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case H.Color:e.include(Un,t),e.include(uS,t),e.include(kD,t),e.include(cS,t),e.include(dDe,t),$m(r,t),VD(r),oO(r),r.uniforms.add([i.uniforms.get("localOrigin"),new fi("ambient",s=>s.ambient),new fi("diffuse",s=>s.diffuse),new fi("specular",s=>s.specular),new Be("opacity",s=>s.opacity)]),r.include(ky),Uy(r),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case H.Depth:case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:e.include(au,t),rS(e),e.varyings.add("depth","float"),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Un,t),e.include(X_,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case H.Normal:e.include(au,t),e.include(mL,t),o3(i),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Un,t),r.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case H.Highlight:e.include(au,t),e.include(mL,t),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Un,t),e.include(pv,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const nPt=Object.freeze(Object.defineProperty({__proto__:null,build:sPt},Symbol.toStringTag,{value:"Module"})),pNe=new Map([[P.POSITION,0],[P.PROFILERIGHT,1],[P.PROFILEUP,2],[P.PROFILEVERTEXANDNORMAL,3],[P.FEATUREVALUE,4]]);let oPt=class extends rPt{constructor(){super(...arguments),this.ambient=Ve(.2,.2,.2),this.diffuse=Ve(.8,.8,.8),this.specular=Ve(0,0,0),this.opacity=1}},fNe=class mNe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new cr(e.rctx,mNe.shader.get().build(this.configuration),pNe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===zt.NONE,s=e===zt.FrontFace;return si({blending:i.output!==H.Color&&i.output!==H.Alpha||!i.transparent?null:r?yd:fv(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==tn.None?YOe:null,depthTest:{func:Ew(e)},depthWrite:r||s?gu:null,colorWrite:wi,stencilWrite:i.hasOccludees?Py:null,stencilTest:i.hasOccludees?Cw:null,polygonOffset:r||s?null:Rz})}};fNe.shader=new lr(nPt,()=>se(()=>import("./Path.glsl-87486499.js"),[]));let ta=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.doubleSidedMode=tn.None,this.transparencyPassType=zt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([X({count:H.COUNT})],ta.prototype,"output",void 0),u([X({count:tn.COUNT})],ta.prototype,"doubleSidedMode",void 0),u([X({count:zt.COUNT})],ta.prototype,"transparencyPassType",void 0),u([X()],ta.prototype,"spherical",void 0),u([X()],ta.prototype,"receiveShadows",void 0),u([X()],ta.prototype,"receiveAmbientOcclusion",void 0),u([X()],ta.prototype,"vvSize",void 0),u([X()],ta.prototype,"vvColor",void 0),u([X()],ta.prototype,"vvOpacity",void 0),u([X()],ta.prototype,"hasSlicePlane",void 0),u([X()],ta.prototype,"transparent",void 0),u([X()],ta.prototype,"hasOccludees",void 0),u([X()],ta.prototype,"hasMultipassTerrain",void 0),u([X()],ta.prototype,"cullAboveGround",void 0),u([X()],ta.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X({constValue:Ot.Disabled})],ta.prototype,"pbrMode",void 0),u([X({constValue:!0})],ta.prototype,"hasVvInstancing",void 0),u([X({constValue:!1})],ta.prototype,"useCustomDTRExponentForWater",void 0),u([X({constValue:!1})],ta.prototype,"useFillLights",void 0);let aPt=class gNe extends Sw{constructor(e){super(e,new cPt),this.supportsEdges=!0,this._vertexAttributeLocations=pNe,this._configuration=new ta,this._vertexBufferLayout=gNe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==H.Color&&e!==H.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?tn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?tn.WindingOrder:tn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==H.Shadow&&e!==H.ShadowExcludeHighlight&&e!==H.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!aNe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const v=this.parameters.vvSizeOffset,x=this.parameters.vvSizeFactor,S=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=l.sizeAttributeValue;c[0]*=Se(v[0]+C*x[0],S[0],E[0]),c[1]*=Se(v[2]+C*x[2],S[2],E[2])}const h=Math.max(c[0],c[1]),d=e.boundingInfo;if(A(d))return void this._intersectTriangles(l,c,s,n,o);const f=V2(d.bbMin[0]-h,d.bbMin[1]-h,d.bbMin[2]-h,d.bbMax[0]+h,d.bbMax[1]+h,d.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),y=[g/m[0],g/m[1],g/m[2]];jse(f,s,y,r.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,i,r,s,n){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,s,n)}createBufferWriter(){return new nO(this._vertexBufferLayout)}requiresSlot(e,i){switch(i){case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case H.Color:case H.Alpha:case H.Depth:case H.Normal:case H.Highlight:case H.ObjectAndLayerIdColor:return e===(this.parameters.transparent?Ie.TRANSPARENT_MATERIAL:Ie.OPAQUE_MATERIAL)||e===Ie.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new lPt(e)}static getVertexBufferLayout(){return qs().vec3f(P.POSITION).vec4f(P.PROFILERIGHT).vec4f(P.PROFILEUP).vec4f(P.PROFILEVERTEXANDNORMAL).vec4f(P.FEATUREVALUE)}},lPt=class extends Tw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(A(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==H.Color&&this._output!==H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(fNe,e)}},cPt=class extends oPt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const uPt=["polyline"];let hPt=class extends By{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=nr(1,1),this._upVectorAlignment=Fb.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=b(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=b(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=yL(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Fb.World:Fb.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=jRt(rLe);break;case"quad":this._profile=HRt()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new rH(0,iLe);break;case"bevel":this._extruder=new rH(0,1);break;case"miter":this._extruder=new rH(.8*Math.PI,1);break;default:this._extruder=new YRt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Kge,this._endCap=new Kge;break;case"butt":default:this._startCap=new E4(this._profile,0),this._endCap=new E4(this._profile,0,!0);break;case"square":this._startCap=new E4(this._profile,-.5),this._endCap=new E4(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Qge({profile:this._profile,flip:!1,breakNormals:m,subdivisions:AK}),this._endCap=new Qge({profile:this._profile,flip:!0,breakNormals:m,subdivisions:AK});break}}const a=Hn(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Qc(l),h=l[3],d=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:d,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:d||o==="none"?ts.None:ts.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Vt(this._intrinsicSize,e,i),!B9(this._intrinsicSize[0])||!B9(this._intrinsicSize[1])))throw new J("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||tl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:WAe(this._intrinsicSize)};this._material=new aPt(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Z_(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,uPt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new zm),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const e=Hn(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,hw)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!_L(this._fastUpdates,i,this._vvConvertOptions))return To.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return To.Fast_Update}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of r)i+=f.length;const l=fh(3*i),c=fh(3*i);let h=0;for(const f of r){s.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=e.hasZ?m[2]:0}let d=!0;return b(o)&&!n.equals(o)&&(d=un(l,n,0,l,o,0,i)),b(o)&&!o.equals(a)?un(l,o,0,c,a,0,i):this._copyVertices(l,0,c,0,i),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:d,terrainElevation:0}}_copyVertices(e,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=e[i++],r[s++]=e[i++],r[s++]=e[i++]}_createAs3DShape(e,i,r,s){const n=e.geometry,o=new Array,a=n.spatialReference,l=Mo(),c=this._context.renderCoordsHelper;_Ne.spatialReference=a;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const g of h.pathVertexDataInfos){const y=g.index,v=g.numVertices;if(v<2||b(this._context.clippingExtent)&&(ls(l),ud(l,h.vertexDataES,3*y,v),!sm(l,this._context.clippingExtent)))continue;const x=[];for(let B=y;B<y+3*v;){const G=B++,j=B++,q=B++,ie=new GRt;fe(ie.posES,h.vertexDataES[G],h.vertexDataES[j],h.vertexDataES[q]);const ee=nEt(ie.posES,this._context.elevationProvider,r,c);fe(Ss,h.vertexDataRS[G],h.vertexDataRS[j],h.vertexDataRS[q]),c.setAltitude(Ss,ee),ge(ie.pos,Ss),x.push(ie)}const S=new qRt(x);yNe(S,this._upVectorAlignment,this._context.renderCoordsHelper);const E=new XRt(S,this._profile,this._extruder,this._startCap,this._endCap);let C=null;if(this._fastUpdates.enabled){const B=this._fastUpdates.visualVariables,G=B.size?M_(B.size.field,e):0,j=B.color?M_(B.color.field,e):0,q=B.opacity?M_(B.opacity.field,e):0;C=new ZRt(E,G,j,q)}else{const B=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const q=i.size;B[0]*=tye(q[0],q[2]==="symbol-value"?this.symbolLayer.height||0:q[2],this.symbolLayer.width||0),B[1]*=tye(q[2],q[0]==="symbol-value"?this.symbolLayer.width||0:q[0],this.symbolLayer.height||0)}let G;this._drivenProperties.color&&(G=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(G=G?[G[0],G[1],G[2],i.opacity]:[1,1,1,i.opacity]);const j=new dNe(E);j.bake(B),G&&j.bakeVertexColors(G),C=j}const{vertexAttributes:R,indices:O}=C.createGeometryData(),U=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),L=new FRt(this._material,R,O,C,a,this._upVectorAlignment,this._stencilWidth,U);L.transformation=C.xform,o.push(L)}if(o.length===0)return null;const d={layerUid:this._context.layer.uid,graphicUid:s},f=new mv({geometries:o,metadata:d}),m=new zy(this,f,o,null,null,pPt,r);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=hw(r.mode),m}};function yNe(t,e,i){switch(e){default:case Fb.World:for(const r of t.vertices){we(Ss,r.pos,t.offset),i.worldUpAtPosition(Ss,Ss),r.setFrameFromUpVector(Ss),r.rotationFrameUp=r.frame.up,Vt(r.rotationRight,1,0),pe(Ss,r.frame.up,xe(r.frame.up,r.vLeft)),be(Ss,r.vLeft,Ss),Ul(Ss,Ss),Re(Ss,Ss),pe(Yv,r.frame.up,xe(r.frame.up,r.vRight)),be(Yv,r.vRight,Yv),Re(Yv,Yv),Et(iye,r.rotationFrameUp,r.vLeft);const s=Math.sign(xe(iye,r.vRight));if(r.rotationAngle=s*(Math.PI-Co(xe(Ss,Yv))),Math.abs(r.rotationAngle)>0){const o=zB(Math.cos(.5*r.rotationAngle));WK(r.miterStretch,o-1+1,0,0,1)}const n=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength/Math.cos(.5*n))}break;case Fb.Path:we(Ss,t.vertices[0].pos,t.offset),i.worldUpAtPosition(Ss,Ss),WRt(t,Ss);for(const r of t.vertices){const s=Math.sign(xe(r.frame.right,r.vRight));Et(r.rotationFrameUp,r.vRight,r.vLeft),pe(r.rotationFrameUp,r.rotationFrameUp,s),Re(r.rotationFrameUp,r.rotationFrameUp);const n=xe(r.rotationFrameUp,r.frame.up),o=xe(r.rotationFrameUp,r.frame.right);if(pe(Ss,r.frame.up,-o),pe(Yv,r.frame.right,n),we(Ss,Ss,Yv),Re(Ss,Ss),BRt(r.rotationRight,r.frame,Ss),Ul(Ss,r.vLeft),r.rotationAngle=-s*(Math.PI-Co(xe(Ss,r.vRight))),Math.abs(r.rotationAngle)>0){const l=zB(Math.cos(.5*r.rotationAngle));WK(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength*zB(Math.cos(.5*a)))}}}function tye(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function dPt(t,e,i,r){let s=0;for(const n of t.vertices)i(n.posES,nH),s+=nH.sampledElevation,we(Ss,n.pos,t.offset),r.setAltitude(Ss,nH.z),be(n.pos,Ss,t.offset);return t.updatePathVertexInformation(),s/t.vertices.length}function pPt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;fPt.spatialReference=s.spatialReference;for(const l of o){if(!aNe(l))continue;const c=l.path,h=c.builder.path,d=l.geometrySR;_Ne.spatialReference=d,a+=dPt(h,e,r,s),l.upVectorAlignment!==Fb.World&&yNe(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const fPt=bc(0,0,0,null),_Ne=bc(0,0,0,null),Ss=$(),Yv=$(),iye=$(),nH=new LD;function mPt(t,e,i,r,s=1){if(i.isGeographic&&r===it.Global){const c=fh(e.length),h=e.length,d=ur(i);for(let f=0;f<h;f+=3)zte(e,f,c,f,d);e=c}Vt(mo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)mo[0]=Math.min(mo[0],e[c]),mo[1]=Math.min(mo[1],e[c+1]);const n=mo[0]%s,o=mo[1]%s,a=mo[0]-n,l=mo[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function vNe(t,e,i,r,s=1){fe(ax,1,0,0),fe(lx,0,1,0),fe(DE,0,0,1),_Pt(oH,i),gPt(i,rye)&&yPt(rye,ax,lx,DE,r,oH),Vt(mo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Vt(cx,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<i.length;h+=3){fe(LE,i[h],i[h+1],i[h+2]);const d=xe(ax,LE),f=xe(lx,LE);mo[0]=Math.min(mo[0],d),mo[1]=Math.min(mo[1],f),cx[0]=Math.max(cx[0],d),cx[1]=Math.max(cx[1],f)}const n=xe(DE,oH);lH(Xv,mo[0],mo[1],n,ax,lx,DE),lH(ux,cx[0],mo[1],n,ax,lx,DE),lH(hx,mo[0],cx[1],n,ax,lx,DE),be(ux,ux,Xv),pe(ux,ux,.5),be(hx,hx,Xv),pe(hx,hx,.5),we(Xv,Xv,ux),we(Xv,Xv,hx);const o=mo[0]%s,a=mo[1]%s,l=mo[0]-o,c=mo[1]-a;for(let h=0;h<i.length;h+=3){fe(LE,i[h],i[h+1],i[h+2]);const d=h/3,f=4*d;t[f]=(xe(ax,LE)-l)/s,t[f+1]=(xe(lx,LE)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*d;for(let g=0;g<3;g++)e[m+g]=Xv[g],e[m+g+3]=ux[g],e[m+g+6]=hx[g]}}const oH=$(),LE=$(),rye=gr(),ax=$(),lx=$(),DE=$(),mo=je(),cx=je(),Xv=$(),ux=$(),hx=$();function gPt(t,e){const i=t.length/3-1;return yOe(t,e,0,Math.floor(i/3),Math.floor(i*(2/3)))}function yPt(t,e,i,r,s,n){b(s)?(s.basisMatrixAtPosition(n,lg),fe(M4,lg[0],lg[1],lg[2]),fe(A4,lg[4],lg[5],lg[6]),fe(aH,lg[8],lg[9],lg[10])):(fe(M4,1,0,0),fe(A4,0,1,0),fe(aH,0,0,1));const o=t;xe(o,aH)<0&&pe(o,o,-1),ge(r,o);const a=xe(o,A4),l=xe(o,M4);Math.abs(a)<Math.abs(l)?(eh(e,M4,o,-l),Re(e,e),Et(i,e,o),Re(i,i),pe(i,i,-1)):(eh(i,A4,o,-a),Re(i,i),Et(e,i,o),Re(e,e))}const lg=Ge(),M4=$(),A4=$(),aH=$();function _Pt(t,e){fe(pR,0,0,0);for(let i=0;i<e.length-3;i+=3)pR[0]+=e[i],pR[1]+=e[i+1],pR[2]+=e[i+2];pe(t,pR,1/(e.length/3-1))}const pR=$();function lH(t,e,i,r,s,n,o){fe(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}function vPt(t){const e=new ar,{vertex:i,fragment:r}=e,s=t.output===H.Depth,n=t.hasMultipassTerrain&&(t.output===H.Color||t.output===H.Alpha);return ah(i,t),e.include(au,t),e.include(LS,t),e.include(Cz,t),e.attributes.add(P.POSITION,"vec3"),e.varyings.add("vpos","vec3"),n&&e.varyings.add("depth","float"),s&&(e.include(X_,t),rS(e),ow(e)),i.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Un,t),n&&e.include(Ed,t),r.include(ky),r.uniforms.add(new Ni("eColor",o=>o.color)),t.output===H.Highlight&&e.include(pv,t),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===H.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(sl)}) {
      discard;
    }

    ${t.output===H.Alpha?T`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===H.Color?T`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===H.Highlight?T`outputHighlight();`:""};
    ${t.output===H.Depth?T`outputDepth(linearDepth);`:""};
    ${t.output===H.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const bPt=Object.freeze(Object.defineProperty({__proto__:null,build:vPt},Symbol.toStringTag,{value:"Module"}));let bNe=class wNe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,wNe.shader.get().build(this.configuration),rr)}_createPipeline(e,i){const r=this.configuration,s=e===zt.NONE,n=e===zt.FrontFace;return si({blending:r.output!==H.Color&&r.output!==H.Alpha||!r.transparent?null:s?yd:fv(e),culling:iz(r.cullFace),depthTest:{func:Ew(e)},depthWrite:(s||n)&&r.writeDepth?gu:null,colorWrite:wi,stencilWrite:r.hasOccludees?Py:null,stencilTest:r.hasOccludees?i?fw:Cw:null,polygonOffset:s||n?r.polygonOffset?wPt:null:Pz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};bNe.shader=new lr(bPt,()=>se(()=>import("./ColorMaterial.glsl-6f956d34.js"),[]));const wPt={factor:1,units:1};let Lu=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.cullFace=ts.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=zt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};u([X({count:H.COUNT})],Lu.prototype,"output",void 0),u([X({count:ts.COUNT})],Lu.prototype,"cullFace",void 0),u([X()],Lu.prototype,"hasSlicePlane",void 0),u([X()],Lu.prototype,"hasVertexColors",void 0),u([X()],Lu.prototype,"transparent",void 0),u([X()],Lu.prototype,"polygonOffset",void 0),u([X()],Lu.prototype,"enableOffset",void 0),u([X()],Lu.prototype,"writeDepth",void 0),u([X()],Lu.prototype,"hasOccludees",void 0),u([X({count:zt.COUNT})],Lu.prototype,"transparencyPassType",void 0),u([X()],Lu.prototype,"hasMultipassTerrain",void 0),u([X()],Lu.prototype,"cullAboveGround",void 0),u([X()],Lu.prototype,"objectAndLayerIdColorInstanced",void 0);let sye=class extends gne{constructor(e){super(e,new TPt),this.supportsEdges=!0,this._configuration=new Lu}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<Oz,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===H.Color||i===H.Alpha||i===H.Highlight||i===H.Depth&&this.parameters.writeLinearDepth||i===H.ObjectAndLayerIdColor?e===Ie.DRAPED_MATERIAL?!0:i===H.Highlight?e===Ie.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ie.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new xPt(e)}createBufferWriter(){return new nO(me("enable-feature:objectAndLayerId-rendering")?uMt:HLe)}},xPt=class extends Tw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==H.Color&&this._output!==H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(bNe,e)}},TPt=class extends tO{constructor(){super(...arguments),this.color=fy,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ts.None,this.hasOccludees=!1}};var Ua;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Ua||(Ua={}));const XK=.70710678118,nye=XK,SPt=.08715574274;function EPt(t){const e=new ar,i=t.hasMultipassTerrain&&(t.output===H.Color||t.output===H.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:r,fragment:s}=e;ah(r,t),e.include(au,t),e.include(LS,t),t.draped?r.uniforms.add(new Be("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(P.BOUNDINGRECT,"mat3"),e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i&&e.varyings.add("depth","float");const n=t.style===Ua.ForwardDiagonal||t.style===Ua.BackwardDiagonal||t.style===Ua.DiagonalCross;n&&r.code.add(T`
      const mat2 rotate45 = mat2(${T.float(XK)}, ${T.float(-nye)},
                                 ${T.float(nye)}, ${T.float(XK)});
    `),t.draped||($m(r,t),r.uniforms.add(new Be("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),r.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(SPt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===H.Depth;return o&&(e.include(X_,t),rS(e),ow(e)),r.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Un,t),s.include(ky),t.draped&&s.uniforms.add(new Be("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===H.Highlight&&e.include(pv,t),i&&e.include(Ed,t),t.output!==H.Highlight&&(s.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(T`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new Ni("uColor",a=>a.color)),s.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==H.Highlight?T`color.a *= ${CPt(t)};`:""}

      ${t.output===H.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(sl)}) {
        discard;
      }

      ${t.output===H.Alpha?T`gl_FragColor = vec4(color.a);`:""}

      ${t.output===H.Color?T`gl_FragColor = color; ${t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===H.Highlight?T`outputHighlight();`:""}
      ${t.output===H.Depth?T`outputDepth(linearDepth);`:""};
    }
  `),e}function CPt(t){function e(i){return t.draped?T`coverage(vuv.${i}, texelSize)`:T`sample(vuv.${i})`}switch(t.style){case Ua.ForwardDiagonal:case Ua.Horizontal:return e("y");case Ua.BackwardDiagonal:case Ua.Vertical:return e("x");case Ua.DiagonalCross:case Ua.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const MPt=Object.freeze(Object.defineProperty({__proto__:null,build:EPt},Symbol.toStringTag,{value:"Module"}));let xNe=class TNe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,TNe.shader.get().build(this.configuration),SNe)}_setPipelineState(e,i){const r=this.configuration,s=e===zt.NONE,n=e===zt.FrontFace;return si({blending:r.output===H.Color||r.output===H.Alpha?s?yd:fv(e):null,culling:iz(r.cullFace),depthTest:{func:Ew(e)},depthWrite:s?r.writeDepth?gu:null:Az(e),colorWrite:wi,stencilWrite:r.hasOccludees?Py:null,stencilTest:r.hasOccludees?i?fw:Cw:null,polygonOffset:s||n?r.polygonOffset?APt:null:Pz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};xNe.shader=new lr(MPt,()=>se(()=>import("./Pattern.glsl-a2c76bb2.js"),[]));const APt={factor:1,units:1};let lc=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.cullFace=ts.None,this.transparencyPassType=zt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([X({count:H.COUNT})],lc.prototype,"output",void 0),u([X({count:ts.COUNT})],lc.prototype,"cullFace",void 0),u([X({count:Ua.COUNT})],lc.prototype,"style",void 0),u([X({count:zt.COUNT})],lc.prototype,"transparencyPassType",void 0),u([X()],lc.prototype,"hasSlicePlane",void 0),u([X()],lc.prototype,"hasVertexColors",void 0),u([X()],lc.prototype,"polygonOffset",void 0),u([X()],lc.prototype,"writeDepth",void 0),u([X()],lc.prototype,"hasOccludees",void 0),u([X()],lc.prototype,"patternSpacing",void 0),u([X()],lc.prototype,"lineWidth",void 0),u([X()],lc.prototype,"enableOffset",void 0),u([X()],lc.prototype,"draped",void 0),u([X()],lc.prototype,"hasMultipassTerrain",void 0),u([X()],lc.prototype,"cullAboveGround",void 0);const SNe=new Map([[P.POSITION,0],[P.COLOR,3],[P.UVMAPSPACE,4],[P.BOUNDINGRECT,5]]);let Pne=class extends gne{constructor(e){super(e,new PPt),this.supportsEdges=!0,this._vertexAttributeLocations=SNe,this._configuration=new lc}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<Oz,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===H.Color||i===H.Alpha||i===H.Highlight||i===H.Depth&&this.parameters.writeLinearDepth?e===Ie.DRAPED_MATERIAL?!0:i===H.Highlight?e===Ie.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Ie.TRANSPARENT_MATERIAL:Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new OPt(e)}createBufferWriter(){const e=qs().vec3f(P.POSITION).vec4u8(P.COLOR).vec4f(P.UVMAPSPACE);return this.parameters.draped||e.mat3f(P.BOUNDINGRECT),new RPt(e)}},OPt=class extends Tw{_updateParameters(e){return this.ensureTechnique(xNe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==H.Color&&this._output!==H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},RPt=class extends nO{write(e,i,r,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=r.vertexAttributes.get(o),l=r.indices.get(o);if(a&&l)switch(o){case P.POSITION:{Rt(a.size===3);const c=s.getField(o,cs);c&&Ez(l,a.data,e,c,n);break}case P.COLOR:{Rt(a.size===3||a.size===4);const c=s.getField(o,Gl);c&&Wse(l,a.data,a.size,c,n);break}case P.UVMAPSPACE:{Rt(a.size===4);const c=s.getField(o,ph);c&&a3(l,a.data,c,n);break}case P.BOUNDINGRECT:{Rt(a.size===9);const c=s.getField(o,aw);c&&this.writeBoundingRect(l,a.data,e,c,n);break}}}}writeBoundingRect(e,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const d=9*e[h],f=i[d],m=i[d+1],g=i[d+2];a[n]=o[0]*f+o[4]*m+o[8]*g+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[n+y]=i[d+y];n+=l}}},PPt=class extends tO{constructor(){super(...arguments),this.color=di(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ts.None,this.hasOccludees=!1,this.style=Ua.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function IPt(t,e,i){return LPt($Pt(t),e,i)}function $Pt(t){return t&&t.pattern||null}function LPt(t,e,i){return b(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=di(0,0,0,0),e.transparent=!0),new sye(e)):(e.style=DPt(t.style),e.draped=i.isDraped,new Pne(e)):new sye(e)}function DPt(t){switch(t){case"horizontal":return Ua.Horizontal;case"vertical":return Ua.Vertical;case"cross":return Ua.Cross;case"forward-diagonal":return Ua.ForwardDiagonal;case"backward-diagonal":return Ua.BackwardDiagonal;case"diagonal-cross":return Ua.DiagonalCross;default:return}}function NPt(t){return t.material instanceof Pne&&!t.material.parameters.draped}function FPt(t,e){if(NPt(t)){const i=t.vertexAttributes.get(P.POSITION).data,r=t.getMutableAttribute(P.UVMAPSPACE).data,s=t.getMutableAttribute(P.BOUNDINGRECT).data;vNe(r,s,i,e)}}function UPt(t,e,i,r,s){const n=Y$e(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)FPt(a,s);return n}const kPt=["polyline","polygon","extent"];let ENe=class CNe extends By{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(b(this._material))return;const e=Hn(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e);this._material=IPt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Pne,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(b(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const i=r=>{const s=LDe(e.pattern);return new RM({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:BK(e.patternCap||"butt")})};this._outlineMaterial=i(ka(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return b(e)&&e.size!=null&&e.size>0&&b(e.color)&&(A(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,kPt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i,new zm);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(b(this._material)){const e=this._material.parameters.color,i=Hn(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(b(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=$D(CNe.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=Xp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(b(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),b(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){var h;const s=pL(e.geometry);if(A(s))return null;const n=Tne(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new VPt(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Fn(4*a,!0),o.boundingRect=fh(9*a,!0),vNe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new mv({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new zy(this,l,o.outGeometries,null,null,UPt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Xp(r.mode),c}_createAs3DShapeFill(e){const i=e.renderData.polygons;for(const{position:r,mapPositions:s,holeIndices:n,index:o,count:a}of i){if(b(this._context.clippingExtent)&&(ls(Fd),ud(Fd,s),!sm(Fd,this._context.clippingExtent)))continue;const l=dw(s,n,3);if(l.length===0)continue;const c=Nme({material:this._material,indices:l,mapPositions:s,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?Fpe(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?Ip(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPositions:s,position:n}=i[r];if(b(this._context.clippingExtent)&&(ls(Fd),ud(Fd,s),!sm(Fd,this._context.clippingExtent)))continue;const o=GK(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(P.POSITION);a.data===n&&(a.data=K_t(n)),e.outGeometries.push(o)}}_createAsOverlay(e,i){var a;const r=pL(e.geometry);if(A(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,b(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=lDe(r,this._context.overlaySR),n=new zPt(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Fn(4*o,!0),mPt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=ls(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new kz(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const i=e.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){const a=ls(Fd);if(ud(a,r),!sm(a,this._context.clippingExtent))continue;const l=dw(r,s,3);if(l.length===0)continue;DA(e.outBoundingBox,a);const c=Nme({material:this._material,indices:l,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?Fpe(e.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new u3(c,e);Rr(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(ls(Fd),ud(Fd,s),!sm(Fd,this._context.clippingExtent))continue;DA(e.outBoundingBox,Fd);const n=GK(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor),o=new u3(n,e),a=Fd;Rr(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=Hn(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(b(e)?e.a:0)}_getOutlineColor(){const e=Hn(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return ZI(b(e)?et.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};ENe.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const Fd=Mo();let VPt=class extends Dz{constructor(e,i,r,s){super(e,r,s),this.color=i}},zPt=class extends Dz{constructor(e,i,r,s){super(e,r,s),this.color=i}},MNe=class ANe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=Hn(e,"material","color"),s=id(r,fy,et.toUnitRGBA),n=id(e.size,12,ka),o=e.lineHeight,a=b(e.background)?et.toUnitRGBA(e.background.color):fy,l={family:id(e.font,"sans-serif",m=>m.family),decoration:id(e.font,"none",m=>m.decoration),weight:id(e.font,"normal",m=>m.weight),style:id(e.font,"normal",m=>m.style)},c=e.halo,h=b(c)&&b(c.color)&&c.size>0?{size:ka(c.size),color:et.toUnitRGBA(c.color)}:{size:0,color:fy},d=new ANe({color:s,size:n,background:{color:a,padding:b(e.background)?[.65*n,.5*n]:[0,0],borderRadius:b(e.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=d.fontString(n);try{await document.fonts.load(f)}catch{le.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return d}},BPt=class{constructor(e,i,r){this._renderer=new SDe(e,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=kK(GPt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new $S(e,{wrap:{s:qt.CLAMP_TO_EDGE,t:qt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Ib.PAD})}};const GPt={canvas:null},jPt=[0,0,1];let HPt=class extends By{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Iz(this.symbolLayer.size);if(e)throw new J("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await MNe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=dL(i.geometry);if(A(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(A(s)||s==="")return null;const n=Rte(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(b(n)&&!dTe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new H$e(n,this.symbolLayer.horizontalAlignment,BAt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(i,r,s,o)}createLabel(e,i,r,s){const n=e.graphic,o=dL(n.geometry);if(A(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(e,i,r=0){const s=super.setGraphicElevationContext(e,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return oye(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),cn.UPDATE}slicePlaneEnabledChanged(e,i){return oye(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,b(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Xp(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return WPt}_createAs3DShape(e,i,r,s,n,o){const a=this.setGraphicElevationContext(e,new zm,s.elevationOffset),l=Hn(e.geometry,"type")==="polyline",c=e.uid;let h=null,d=null;if(A(o)){const L=CDe(s.horizontalPlacement);h=new BPt(r,L,this._textRenderParameters);let B=null;if(b(this._context.sharedResources.textures)){d=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{b(B)&&B.release()});const G=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(A(G)||gh(G))return d.release(),null;B=G}}const f=qPt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(b(o)?m.textureId=o.id:b(d)&&(m.textureId=d.texture.id),b(s.verticalOffset)){const{screenLength:L,minWorldLength:B,maxWorldLength:G}=s.verticalOffset;m.verticalOffset={screenLength:ka(L),minWorldLength:B||0,maxWorldLength:b(G)?G:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:L,screenSizePerspectiveSettingsLabels:B}=this._context.sharedResources;m.screenSizePerspective=B.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=L}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,b(n)){const L=JSON.stringify(m);g=n.get(L),A(g)&&(g=new l3(m),n.add(L,g))}else g=new l3(m);const y=s.translation,v=b(h)?nr(h.displayWidth,h.displayHeight):mu,x=s.centerOffset,S=nK(g,jPt,y,null,v,x,[0,0],null),E=lne(this._context,i,S,a,c);if(A(E))return null;const C=new zy(this,E.object,[S],A(n)?[g]:null,d,uL,a);C.alignedSampledElevation=E.sampledElevation,C.needsElevationUpdates=Xp(a.mode)||a.mode==="absolute-height";const{displayWidth:R,displayHeight:O}=b(h)?h:s;C.getScreenSize=(L=je())=>(L[0]=R,L[1]=O,L);const U=new tLe(s.elevationOffset,r);return C.metadata=U,hL(C,i,this._context.elevationProvider),C}};function oye(t,e,i){t&&t.forEach(r=>{const s=e(r);b(s)&&i(s,r.graphic)})}function qPt(t,e){if(e.verticalPlacement==="baseline"){const r=kAt[e.horizontalPlacement],s=b(t)?t.baselineAnchorY:0;return nr(r,s)}const i=zAt(e.horizontalPlacement,e.verticalPlacement);return l8[i]}const WPt={mode:"relative-to-ground",offset:0},YPt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},XPt=["polyline","polygon","extent"];let ZK=class fT extends By{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,XPt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new zm);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(b(this._material))return;const e=new KLe,i=this.symbolLayer.color;b(i)&&(e.color=et.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=b(this.symbolLayer.waveDirection)?fT.headingVectorFromAngle(this.symbolLayer.waveDirection):nr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=YPt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new JLe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(A(this._material))return;const e=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=$D(fT.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=Xp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return b(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){const s=pL(e.geometry);if(A(s))return null;const n=Tne(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=fh(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new ZPt(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new mv({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),h=new zy(this,c,l.outGeometries,null,null,Y$e,i);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Xp(i.mode),h}_createUVCoordsFromVertices(e,i,r,s){const n=Ec(s);kp(Zv);for(let l=0;l<r;l++)Vt(aye,i[3*l],i[3*l+1]),bte(Zv,aye);b3(Zv,Zv,n);const o=Zv[0]%fT.unitSizeOfTexture,a=Zv[1]%fT.unitSizeOfTexture;O4[0]=Zv[0]-o,O4[1]=Zv[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*n-O4[0])/fT.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*n-O4[1])/fT.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(b(this._context.clippingExtent)&&(ls(Jv),ud(Jv,a),!sm(Jv,this._context.clippingExtent)))continue;const c=dw(a,l,3);if(c.length===0)continue;const h=Ip(r,2*n,2*s),d=Fme({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});e.outGeometries.push(d)}}_createAsOverlay(e){const i=pL(e.geometry);if(A(i))return null;this._material.renderPriority=this._renderPriority;const r=lDe(i,this._context.overlaySR),s=r.position.length/3,n=fh(2*s);this._createUVCoordsFromVertices(n,r.position,s,this._context.overlaySR);const o=new JPt(r,n,this._context.layer.uid,e.uid);return o.outBoundingBox=ls(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new kz(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(ls(Jv),ud(Jv,s),!sm(Jv,this._context.clippingExtent))continue;DA(e.outBoundingBox,Jv);const l=dw(s,n,3);if(l.length===0)continue;const c=Ip(i,2*o,2*a),h=Fme({material:this._material,indices:l,attributeData:{position:s,uv0:c}}),d=new u3(h,e),f=Jv;Rr(d.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),e.outGeometries.push(d)}}static headingVectorFromAngle(e){const i=je(),r=Fk(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};ZK.unitSizeOfTexture=100,ZK.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const O4=je(),Zv=bi(),aye=je(),Jv=Mo();let ZPt=class extends Dz{constructor(e,i){super(e,null,null),this.uvCoords=i}},JPt=class extends Dz{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function KPt(t,e,i,r){const s=lye[t.type]&&lye[t.type][e.type]||QPt[e.type];return s?new s(t,e,i,r):(le.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const QPt={icon:zK,object:gRt,line:DDe,path:hPt,fill:ENe,extrude:SAt,text:HPt,water:ZK},lye={"mesh-3d":{fill:K3t}};let eIt=class extends nne{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];b(s)&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;R4.renderPriority=1-(1+n)/r,R4.renderPriorityStep=1/r,R4.ignoreDrivers=o._ignoreDrivers;const a=KPt(this.symbol,o,this._context,R4),l=Ak(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await $k(this.symbolLayers,async(n,o)=>{if(b(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),_i(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return b(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>b(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=b(a)?a.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new KEt(r,i||this,s,e.layer,n)}get complexity(){return ane(this.symbolLayers.map(e=>Hn(e,"complexity")))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof zy?l:null};if(b(n)&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==td.LOADED?To.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==To.Recreate_Symbol&&b(s)?Math.min(r,s.applyRendererDiff(e,i)):r,To.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===td.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(A(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];b(h)&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(A(s))continue;const n=e.layers[r];if(A(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(A(r))continue;const s=e.layers[i];b(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{A(s)||(s.loadStatus===td.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(b).filter(a=>b(a.queryForSnapping)).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return _i(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)b(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const R4={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let tIt=class extends nne{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return b(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),b(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return b(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:one}globalPropertyChanged(e,i){return!!b(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return b(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,i):To.Recreate_Symbol}prepareSymbolPatch(e){b(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return!!b(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,i)}onRemoveGraphic(){}getFastUpdateStatus(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){b(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Ine(t){return t instanceof tIt?t.graphics3DSymbol:t instanceof eIt?t:null}const vL=le.getLogger("esri.views.3d.layers.graphics.labelPlacement");function iIt(t){const e=hIt(t);if(A(e))return null;const i=rIt(t,e);if(A(i))return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset;return nIt({anchor:r,verticalOffset:e.verticalOffset,screenOffset:je(),centerOffset:di(0,0,0,-1),centerOffsetUnits:"world",translation:$(),elevationOffset:0,hasLabelVerticalOffset:s},i,t)}function rIt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=cm[i],s=r||J9(t);return i&&!r&&vL.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),sIt(s,t)}function $ne(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Ine(e);return b(i)?i.symbol.symbolLayers.getItemAt(0):null}function sIt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(A(i))return null;if(b(e.disablePlacement))return e.labelClass.labelPlacement?(vL.warnOncePerTick(cye(t.placement,e.disablePlacement.logEntityDescription)),J9(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return vL.warnOncePerTick(cye(t.placement,`'${r}' geometries`)),J9(e);break;case"point":case"mesh":return t}return t}function cye(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function J9(t){const e=t.graphics3DGraphic.graphic.geometry;if(A(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=$ne(t);return b(i)&&i.type==="extrude"?cm["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return cm["above-center"];default:return}}function nIt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(A(r))return null;switch(r.type){case"point":aIt(t,e,i);break;case"polygon":oIt(t,e,i);break;case"mesh":Lne(t,e,i.graphics3DGraphic.layers[0])}return t}function oIt(t,e,i){const r=$ne(i);if(!A(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];b(s)?(s.getBoundingBoxObjectSpace(s$),rm(s$,t.translation),t.translation[2]=bw(s$)/2):fe(t.translation,0,0,0),Lne(t,e,s);break}}}function aIt(t,e,i){const r=$ne(i);if(A(r))return;const s=i.graphics3DGraphic.layers[0];switch(b(s)?s.getCenterObjectSpace(t.translation):fe(t.translation,0,0,0),r.type){case"icon":case"text":lIt(t,e,i,s);break;case"object":Lne(t,e,s)}}function lIt(t,e,i,r){const{graphics3DGraphic:s}=i,n=b(r)?r.getScreenSize():null;if(!s.isDraped&&b(n)){const o=cIt(i);fR[0]=n[0]/2*(e.normalizedOffset[0]-o[0]),fR[1]=n[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=fR[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=fR[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=fR[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(cm[i.labelClass.labelPlacement]&&vL.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function cIt(t,e=dIt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=b(r)?r.stageObject.geometries[0].material:null;if(s&&s instanceof l3){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function Lne(t,e,i){const r=b(i)?i.getBoundingBoxObjectSpace(s$):s$,s=Ve(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=ze(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function uIt(t){return t==="above-center"}function hIt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=Ine(r.graphics3DSymbol),n=fa(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=cm[e]||J9(t);return b(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:uye(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(A(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?uIt(o.placement)?{placement:"above-center",verticalOffset:uye(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(vL.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function uye(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const cm={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},hye={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in hye){const e=hye[t],i=cm[t];e.forEach(r=>{cm[r]=i})}Object.freeze&&(Object.freeze(cm),Object.keys(cm).forEach(t=>{Object.freeze(cm[t]),Object.freeze(cm[t].normalizedOffset)}));const fR=[0,0],dIt=[0,0],s$=Mo();let dye=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const cH=512,uH=4096,pIt=.85,fIt=.95;let mIt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Ai()}},gIt=class{constructor(e,i){this.textId=e,this.textRenderer=i,this.placement=new mIt,this.rendered=!1}},eI=class extends Ee{constructor(e){super(e),this.type=xn.Texture,this.id=nh(),this.events=new ws,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=dt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,flipped:!0,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return b(this._glTexture)||(this._glTexture=new At(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Nt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=is(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=dt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",cH.toString()),e.setAttribute("height",cH.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=cH){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,i){let r=Math.max(e,i);return r+=256,r=AA(r),r=Math.min(r,uH),r}_resizeAtlas(e,i){i=i||e;const r=this._atlas;r.size.width=e,r.size.height=i,b(this._glTexture)&&this._glTexture.resize(e,i),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=mR,e.cursor.y=mR+pye,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,i=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+i-e)}_addAtlasElement(e,i,r,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,Rr(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=r,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(i,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const i=e.placement.offset;this._ctx.clearRect(i.x,i.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r&&r.delete(i)&&(i.geometries[0].vertexAttributes.get(P.SIZE).data=[0,0],i.geometryVertexAttrsUpdated(i.geometries[0]))}_processAddition(e,i){const r=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+mR,l=o+mR+pye;if(r.cursor.x+a<r.size.width&&r.cursor.y+l<r.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(r.cursor.y+l+r.lineHeight<r.size.height)){const c=this._getExpectedAtlasUsage(),h=c>pIt&&r.size.width<uH;return h&&this._resizeAtlas(2*r.size.width,2*r.size.height),!i||!h&&c>fIt&&r.size.width===uH?(this._processRemovals(),PM.OK):(this._repack(),PM.REPACK)}r.cursor.x=mR,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return PM.OK}_processRemovals(){this._elementsToRemove.forEach((e,i)=>{const r=this._stageObjects.get(i);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(i)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,i)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(i,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const i=this._stageObjects.get(e.textId);i&&i.forEach(r=>{r.geometries[0].vertexAttributes.get(P.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(P.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,i=!0){if(A(this._glTexture))return al.YIELD;let r=!1;if(ua(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,d=this._elements.get(o);h.get(P.UV0).data=d.placement.uvMinMax,h.get(P.SIZE).data=[d.textRenderer.displayWidth,d.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),i)===PM.REPACK&&(r=!0,!0)}),r)return this.runTask(gc,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),ua(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&_Ct.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,i){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new gIt(r,e)),this._addStageObject(r,i),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,i){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,i)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,s)=>e.push({element:r,key:s}));let i=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){i=!1;break}if(!i||this._elementsToRemove.size){e.sort((r,s)=>r.key.localeCompare(s.key)),this._elements.clear();for(const{element:r,key:s}of e)this._elements.set(s,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:i,_elementsToRemove:r,_atlas:s}=this,n=this;return{elements:e,stageObjects:i,elementsToRemove:r,atlas:s,resizeAtlas:(o,a)=>n._resizeAtlas(o,a),run:(o,a)=>n.runTask(o,a)}}};u([p({constructOnly:!0})],eI.prototype,"view",void 0),u([p({type:Boolean})],eI.prototype,"updating",void 0),eI=u([N("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],eI);const mR=2,pye=2;var PM;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(PM||(PM={}));let fye=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},yIt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},_It=class{constructor(e,i,r,s,n,o,a){this.layer=e,this.graphics3DCore=i,this.scaleVisibility=r,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new xLe({pickable:!0,disableOctree:!0},e.uid)}},mT=class extends Ee{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new ir,this._handles.add([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Nt.LABELER,this)]),this._textTextureAtlas=new eI({view:this.view}),this._hudMaterialCollection=new dye(this.view._stage),this._calloutMaterialCollection=new dye(this.view._stage)}dispose(){this._handles=He(this._handles),this._textTextureAtlas=dt(this._textTextureAtlas),this._hudMaterialCollection=dt(this._hudMaterialCollection),this._calloutMaterialCollection=dt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new fye(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(Ju.USER_SETTING,!0,Fa.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Ju.USER_SETTING,!1,Fa.LABEL),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];b(r)&&this._textTextureAtlas.addTextTexture(r,i.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];b(r)&&this._textTextureAtlas.removeTextTexture(r,i.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),al.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(!mye(i)){if(vIt(i)){this._deactivateLabelingContext(i);continue}if(this._createLabelClassContext(i),hH(i)){this._dirty=!0;continue}if(!mye(i))continue}ua(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(i=>this._removeLabelTextureFromAtlas(i)),this._labelsToAdd.forEach(i=>this._addLabelTextureToAtlas(i)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),_i(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await $k(n,async(c,h)=>{const d=c.symbol,f=Ine(r.getOrCreateGraphics3DSymbol(d));if(A(f))return void le.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await f.load(),_i(i);let m=null;Rte(d)&&d.hasVisibleCallout()&&(m=XEt(d,r.symbolCreationContext),await m.load(),_i(i));const g=await Sm(G$e(c,e.layer.fieldsIndex,this.view.spatialReference));if(_i(i),g.ok===!0){const y=await this._createTextRenderParameters(f.symbol);_i(i),e.labelClassContexts[h]=new yIt(c,f,m,y,g.value)}else le.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${g.error}`)}),_i(i))}async _createLabelClassContext(e){return A(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(kn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.getItemAt(0);return i&&i.type==="text"?MNe.fromSymbol(i,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,lu(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n){const o=new H$e(r.verticalOffset,Mge(r.anchor),VAt(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return Kv.graphic=i,Kv.renderingInfo=null,Kv.layer=s,n.createLabel(Kv,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,i,r,s,n){return Kv.graphic=e,Kv.layer=n,Kv.renderingInfo=new WEt(null,i,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Kv)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=P4(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const d=e.textRenderers[h],f=e.textLabelPlacements[h];if(A(d)||A(f))continue;const m=s[h],g=m.graphics3DSymbol,y=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,v=g.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(r.elevationInfoOverride);const x=this._createTextSymbolGraphic(d,o,f,a,v);if(A(x))return!1;x._labelClass=m.labelClass,x._labelIndex=h,i.addLabelGraphic(x,c,r.stageLayer),i.setVisibilityFlag(Ju.USER_SETTING,l,Fa.LABEL),i.clearVisibilityFlag(Ju.SCALE_RANGE,Fa.LABEL),i.setVisibilityFlag(Ju.DECONFLICTION,!1,Fa.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const E=this._createLineCalloutGraphic(o,y,S,f,a);b(E)&&(m.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(E,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const S=l.needsHydrationToEvaluate()?ZSt(s,i.layer):s;c=l.evaluate(S)}catch{c=null}else c=l.evaluate(s);if(A(c)||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,d=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=i.disablePlacement,y=iIt({graphics3DGraphic:f,labelSymbol:d,labelClass:m,disablePlacement:g});if(A(y))continue;const v=Mge(y.anchor),x=CDe(v);e.textRenderers[o]=new SDe(c,x,a.textRenderParameters),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new fye(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.has(i)&&(this._labels.delete(i),this._labelsToAdd.delete(i),this._labelsToRemove.delete(i)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=P4(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r&&r.emptySymbolLabelSupported||!1,n=r&&r.elevationInfoOverride||null,o=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new _It(a,e,i,s,n,o,P4(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>P4(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),this.view._stage.remove(i.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.rendered?(this._labelsToAdd.set(r,s),this._labelsToRemove.delete(r),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.rendered&&(this._labelsToRemove.set(r,s),this._labelsToAdd.delete(r)),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>hH(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(hH(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function hH(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function mye(t){return t.labelClassContexts&&t.labelClassContexts.length}function vIt(t){return t.labelClassContexts===null}function P4(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}u([p({constructOnly:!0})],mT.prototype,"view",void 0),u([p({constructOnly:!0})],mT.prototype,"deconflictor",void 0),u([p()],mT.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],mT.prototype,"updating",null),mT=u([N("esri.views.3d.layers.graphics.Labeler")],mT);const Kv=new YEt(null,null,null);let tI=class iM{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=bi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Al.VISIBLE_ON_SURFACE,screenRect:bi(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=iM.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new iM(i,r,s,this.tilingScheme),new iM(i,r+1,s,this.tilingScheme),new iM(i,r,s+1,this.tilingScheme),new iM(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,z_(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Al;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Al||(Al={}));const ONe=.5*Math.PI,bIt=ONe/Math.PI*180;let wIt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:$(),direction:$()};for(let i=0;i<4;i++)this._extent[i]={origin:$(),direction:$(),cap:{next:null,direction:$()}},this._planes[i]=gr();this._planes[Jr.NEAR]=gr(),this._planes[Jr.FAR]=gr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),we(this._center.origin,n[0].origin,n[2].origin),pe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||pe(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Q_(a.cap.direction,a.origin,l.origin),H$(a.direction,a.cap.direction,a.origin,this._planes[o]),s||pe(a.direction,a.direction,-1)}H$(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Jr.NEAR]),s?WZ(this._planes[Jr.NEAR],this._planes[Jr.FAR]):(YV(this._planes[Jr.FAR],this._planes[Jr.NEAR]),WZ(this._planes[Jr.NEAR],this._planes[Jr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*ur(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===it.Global){const n=this._maxSpanSpatialReference.isGeographic?bIt:ONe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(Td(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(Td(o.origin,o.direction))||e.intersectsLineSegment(b2(o.origin,o.cap.next,TIt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(lbt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){wte(e,pf),pf[2]=r,Rm(i,pf,dH,this._renderCoordsHelper.spatialReference),Va(gye,dH),ls(xu);for(const{x0:n,x1:o,y0:a,y1:l}of xIt)for(let c=0;c<5;c++){const h=c/4;pf[0]=ei(e[n],e[o],h),pf[1]=ei(e[a],e[l],h),pf[2]=r,_a(pf,i,pf,this._renderCoordsHelper.spatialReference),at(pf,pf,gye),Ey(xu,pf)}fe(this._extent[0].origin,xu[0],xu[1],xu[2]),fe(this._extent[1].origin,xu[3],xu[1],xu[2]),fe(this._extent[2].origin,xu[3],xu[4],xu[2]),fe(this._extent[3].origin,xu[0],xu[4],xu[2]);for(let n=0;n<4;++n)at(this._extent[n].origin,this._extent[n].origin,dH)}_toRenderBoundingExtentLocal(e,i,r){dV(e,i,u0,this._renderCoordsHelper.spatialReference),fe(this._extent[0].origin,u0[0],u0[1],r),fe(this._extent[1].origin,u0[2],u0[1],r),fe(this._extent[2].origin,u0[2],u0[3],r),fe(this._extent[3].origin,u0[0],u0[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case it.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case it.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Kr(e.planes[Jr.NEAR],this._center.origin)<0&&xe(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Kr(e.planes[Jr.NEAR],r.origin)<0&&xe(r.direction,e.direction)<0)return!0}return!1}};const xIt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],pf=$(),dH=Ge(),gye=Ge(),xu=Mo(),u0=bi(),TIt=Fm();let SIt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new nb(e),this._extendedFrustum=new nb(e),this._intersector=new wIt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Al.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===it.Global&&e.lij[0]>=EIt&&e.lij[0]<CIt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Al.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=nb.nearFarLineIndices,r=e.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];be(Ah,l,a),pe(Ah,Ah,AIt),we(r[o],a,Ah)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=Al.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=bye.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Al.INVISIBLE&&(i=o,o===Al.VISIBLE_ON_SURFACE))break}return bye.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===it.Global&&e.lij[0]<MIt?this._calculateSingleTileVisibilitySided(e,!1)===Al.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=ur(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?Al.VISIBLE_ON_SURFACE:Al.VISIBLE_WHEN_EXTENDED:Al.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,Ah);this._aboveGround||Ul(i,i);const r=Co(-xe(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Ah),a){case _t.FAR_BOTTOM_LEFT:case _t.FAR_TOP_LEFT:case _t.NEAR_BOTTOM_LEFT:case _t.NEAR_TOP_LEFT:YZ(this._extendedFrustum.planes[Jr.LEFT],Ah,Ah);break;case _t.FAR_BOTTOM_RIGHT:case _t.FAR_TOP_RIGHT:case _t.NEAR_BOTTOM_RIGHT:case _t.NEAR_TOP_RIGHT:YZ(this._extendedFrustum.planes[Jr.RIGHT],Ah,Ah)}pe(Ah,Ah,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Td(l,Ah),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Il(n[_t.NEAR_BOTTOM_LEFT],n[_t.NEAR_BOTTOM_RIGHT],n[_t.NEAR_TOP_RIGHT],_ye),Il(n[_t.NEAR_BOTTOM_RIGHT],n[_t.NEAR_TOP_RIGHT],n[_t.NEAR_TOP_LEFT],vye),xe(_ye,vye)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[_t.NEAR_BOTTOM_LEFT],o[_t.NEAR_BOTTOM_RIGHT]]=[o[_t.NEAR_BOTTOM_RIGHT],o[_t.NEAR_BOTTOM_LEFT]]:[o[_t.NEAR_TOP_LEFT],o[_t.NEAR_TOP_RIGHT]]=[o[_t.NEAR_TOP_RIGHT],o[_t.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-yye;return{zWithMargin:e,pointIndices:nb.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+yye;return{zWithMargin:e,pointIndices:nb.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const EIt=2,CIt=6,MIt=12,AIt=.95,yye=1,Ah=$(),_ye=gr(),vye=gr(),bye=new pa(Array,t=>{t.length!==4&&(t[0]=new tI,t[1]=new tI,t[2]=new tI,t[3]=new tI)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let OIt=class{constructor(e){this._camera=new jt,this._focusOnMap=[0,0],this._screenRect=bi(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new SIt(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,vte(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=LZe(e.extent,this._focusOnMap),e.measures.visibility!==Al.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=RIt,r=1<<i,s=e.measures.screenRect;kp(s);let n=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),h=c*c;for(let d=0;d<r;d++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(e,o,a+d,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Al.VISIBLE_WHEN_EXTENDED?this._tileSize*PIt:this._tileSize}_computeScreenArea(e,i,r,s,n){const o=e.measures.visibility===Al.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,Qv),kp(pH);for(let a=0;a<4;a++)bte(pH,Qv[a]);return Mb(n,pH,n),Vpe(Qv[0],Qv[1],Qv[2])+Vpe(Qv[0],Qv[2],Qv[3])}_projectToScreen(e,i,r,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,gR),this._toRenderCoords(gR,0,3,e1[0]),this._toRenderCoords(gR,2,3,e1[1]),this._toRenderCoords(gR,2,1,e1[2]),this._toRenderCoords(gR,0,1,e1[3]),s&&(this._projectToPlane(e1,this._camera.frustum[Jr.NEAR]),this._projectToPlane(e1,this._camera.frustum[Jr.TOP]),this._projectToPlane(e1,this._camera.frustum[Jr.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(e1[o],wye),this._camera.renderToScreen(wye,n[o])}_projectToPlane(e,i){for(let s=0;s<4;s++)_R[s]=Kr(i,e[s]);const r=Math.max(_R[0],_R[1],_R[2],_R[3]);if(r>0){const s=pe(yR,i,-r);for(let n=0;n<4;n++)we(e[n],e[n],s)}}_toRenderCoords(e,i,r,s){return yR[0]=e[i],yR[1]=e[r],yR[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(yR,this._tilingScheme.spatialReference,s),s}};const pH=bi(),RIt=2,PIt=5,Qv=[zs(),zs(),zs(),zs()],gR=bi(),yR=$(),e1=[$(),$(),$(),$()],_R=[0,0,0,0],wye=ma();function Vii(t,e,i){if(A(t)||A(i))return!1;let r=!0;return fo[0]=t.xmin!=null?t.xmin:0,fo[1]=t.ymin!=null?t.ymin:0,fo[2]=t.zmin!=null?t.zmin:0,r=r&&un(fo,t.spatialReference,0,e,i,0,1),fo[0]=t.xmax!=null?t.xmax:0,fo[1]=t.ymax!=null?t.ymax:0,fo[2]=t.zmax!=null?t.zmax:0,r=r&&un(fo,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function RNe(t,e,i){if(A(t)||A(i))return!1;let r=!0;return fo[0]=t.xmin!=null?t.xmin:0,fo[1]=t.ymin!=null?t.ymin:0,fo[2]=t.zmin!=null?t.zmin:0,r=r&&un(fo,t.spatialReference,0,fo,i,0,1),e[0]=fo[0],e[1]=fo[1],fo[0]=t.xmax!=null?t.xmax:0,fo[1]=t.ymax!=null?t.ymax:0,fo[2]=t.zmax!=null?t.zmax:0,r=r&&un(fo,t.spatialReference,0,fo,i,0,1),e[2]=fo[0],e[3]=fo[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const fo=$();let Da=class extends Ee{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(b(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void le.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||b(i)&&e&&i.equals(e))return;const r=b(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(A(this.filterExtent))return null;const e=bi();return RNe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new xt,this.tileSize=512,this._idToTile=new Map,this._handles=new ir,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new vi}initialize(){this._handles.add([ae(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Mi),ae(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Tr)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Nt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=is(this._frameWorker),this._handles=He(this._handles)}addClient(){const e=$It();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(gc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),b(this._frameWorker)&&(this._frameWorker.priority=Nt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&b(this._frameWorker)&&(this._frameWorker.priority=Nt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new OIt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new tI(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),kp(I4);for(let i=0;i<e.length;i++)if(Mb(I4,e.data[i].measures.screenRect,I4),Om(I4)>LIt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!Jk(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Al.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Al.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};u([p({constructOnly:!0})],Da.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Da.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],Da.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],Da.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],Da.prototype,"focus",void 0),u([p({constructOnly:!0})],Da.prototype,"viewState",void 0),u([p({constructOnly:!0})],Da.prototype,"terrain",void 0),u([p()],Da.prototype,"tiles",void 0),u([p()],Da.prototype,"tileSize",void 0),u([p({readOnly:!0})],Da.prototype,"tilingScheme",null),u([p()],Da.prototype,"filterExtent",null),u([p({readOnly:!0})],Da.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],Da.prototype,"_rootTileIds",null),u([p({value:!1})],Da.prototype,"suspended",null),u([p({readOnly:!0})],Da.prototype,"updating",null),Da=u([N("esri.views.3d.layers.support.FeatureTileTree3D")],Da);let IIt=0;function $It(){return IIt++}const I4=bi(),LIt=10;let uo=class extends Ee{constructor(){super(...arguments),this._propertiesPool=new G_({camera:jt},this),this._lastSeenCameraProjectionValues=new jt,this.mode=Ki.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new ws,this.viewingMode=it.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new U0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new G_({camera:jt},this)}createInitialCamera(){if(this.viewingMode===it.Global){const e=ur(this.spatialReference).radius;this.camera=new jt({eye:Ve(4*e,0,0),center:Ve(e,0,0),up:Ve(0,0,1)})}else this.camera=new jt({eye:Ve(0,0,100),center:Ve(0,0,0),up:Ve(0,1,0)})}get animation(){return this.cameraController instanceof iL&&b(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Ud&&Ud.copyFrom(e),Ud.computeUp(this.viewingMode),this.events.emit("before-camera-change",Ud);const i=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Ud)&&(this._lastSeenCameraProjectionValues.copyFrom(Ud),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!i||!i.equals(Ud))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Ud)),this._cameraChanged=!i||!i.almostEquals(Ud),this._cameraChanged)){const r=ube(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return vt(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=b(e)?e.clone():null}get fixedContentCamera(){return b(this._contentCamera)}get isGlobal(){return this.viewingMode===it.Global}get isLocal(){return this.viewingMode===it.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(xye),this.addHandles(wa(()=>e.state===Qs.Finished||e.state===Qs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),xye),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Qs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Qs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Ud.copyFrom(this._get("camera")),e(Ud),this.camera=Ud,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[$i.TOP]!==i.padding[$i.TOP]||e.padding[$i.RIGHT]!==i.padding[$i.RIGHT]||e.padding[$i.BOTTOM]!==i.padding[$i.BOTTOM]||e.padding[$i.LEFT]!==i.padding[$i.LEFT]}};u([p()],uo.prototype,"mode",void 0),u([p({readOnly:!0,type:j_})],uo.prototype,"animation",null),u([p({type:jt})],uo.prototype,"camera",null),u([p({readOnly:!0})],uo.prototype,"pixelRatio",null),u([p()],uo.prototype,"rasterPixelRatio",void 0),u([p()],uo.prototype,"contentPixelRatio",void 0),u([p({})],uo.prototype,"_contentCamera",void 0),u([p({type:jt})],uo.prototype,"contentCamera",null),u([p({readOnly:!0})],uo.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],uo.prototype,"constraints",void 0),u([p({readOnly:!0})],uo.prototype,"events",void 0),u([p({readOnly:!0})],uo.prototype,"isGlobal",null),u([p({readOnly:!0})],uo.prototype,"isLocal",null),u([p({readOnly:!0})],uo.prototype,"viewingMode",void 0),u([p({readOnly:!0})],uo.prototype,"spatialReference",void 0),u([p()],uo.prototype,"navigating",null),u([p()],uo.prototype,"stationary",null),u([p()],uo.prototype,"_cameraChanged",void 0),u([p()],uo.prototype,"cameraController",null),uo=u([N("esri.views.3d.state.ViewState")],uo);const DIt=uo,Ud=new jt,xye="ViewStateHandles";let NIt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new vi,this._tolerance=r3,this._tmpRay=ha(),this._tmpRegion=bi(),this._validateHUDIntersector=Wp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Tye(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Tye(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Ga.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(D4,r,s),D4[0]+=.0466,D4[1]-=.0123,Rse(e,D4,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Vm(s)&&s.intersector!==Vs.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=r3){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Vs.TERRAIN?1:r.type===Vs.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Vs.TERRAIN?1:r.type===Vs.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return zPe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==it.Local||A(e)||we(i,e.origin,Re(tt.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(A(e))return null;const n=b(i)?i.mode:"absolute-height",o=b(i)?vt(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,L4)){const S=this._view.computeMapPointFromVec3d(L4);return S.z??(S.z=0),S.z-=o,S}return null}const c=this._view.state.camera,h=tt.get();c.projectToRenderScreen(e.origin,h);const d=new Sye(null,this._forEachLayer),f=this._view.slicePlane,m=b(f)?bfe(f):null,g=Wp(this.viewingMode);g.options.store=Ga.MIN,g.options.verticalOffset=l;const y=e.origin,v=we(tt.get(),y,e.direction);g.reset(y,v,c),g.point=h;const x=b(s)?"type"in s&&s.type==="graphics"?S=>{var E;return((E=S.metadata)==null?void 0:E.layerUid)!==s.uid}:S=>{var E;return((E=S.metadata)==null?void 0:E.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const S=E=>{var C;return(A(x)||x(E))&&!!((C=E.metadata)!=null&&C.isElevationSource)};g.intersect(d.layers,h,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(E=>{if(E.type===Vs.I3S||E.type===Vs.TERRAIN){const C=E.slicePlaneEnabled?m:null;E.intersect(g,C,g.rayBegin,g.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const E=S.slicePlaneEnabled?m:null;S.intersect(g,E,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(L4)){const S=this._view.computeMapPointFromVec3d(L4);return S.z=r,S}return null}computeIntersection(e,i,r){var g;if(A(e))return;const s=this._view.state.camera,n=tt.get();s.projectToRenderScreen(e.origin,n);const o=new Sye(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=we(tt.get(),e.origin,e.direction);i.reset(a,l,s),i.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=b(c)?bfe(c):null;i.intersect(o.sliceableLayers,n,this._tolerance,h);const d=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const v=y.layerUid,x=Array.isArray(v),S=x?v:[v];x&&(i.options.filteredLayerUids=[]);let E=!1;for(const C of S)o.filterLayerUid(C)?E=!0:x&&i.options.filteredLayerUids.push(C);if(i.options.isFiltered=!E,y.isGround&&d||!i.options.isFiltered){const C=y.slicePlaneEnabled?h:null;y.intersect(i,C,a,l,n)}});const f=tt.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&b(m.spatialReference)&&i.results.ground.getIntersectionPoint(f)){const y=m.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,x=tt.get();this._view.renderCoordsHelper.fromRenderCoords(f,x,m.spatialReference),x[2]=vt((g=this._view.elevationProvider)==null?void 0:g.getElevation(f[0],f[1],f[2],v,"ground"),0),y.intersect(i,x,i.results.ground,S=>o.filterRenderGeometry(S))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;z_(this._tmpRegion,VW);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=x=>{const S=new UIt(x);r.projectToRenderScreen(x.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),bte(n,S.screenPoint)};e.sortResults(i.all),b(i.min.dist)&&o(i.min);for(const x of i.all)i.min.target.object!==x.target.object&&i.max.target.object!==x.target.object&&o(x);if(b(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-iI),h=Math.max(0,n[1]-iI),d=Math.min(od(n)+2*iI,a-c),f=Math.min(Om(n)+2*iI,l-h),m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let g=!0;const y=A(e.results.max.dist);let v=0;for(const x of s)for(const S of FIt)if(m[4*(Math.min(x.screenPoint[0]+S[0],a)-n[0]+(Math.min(x.screenPoint[1]+S[1],l)-n[1])*d)]){g&&(e.results.min.copy(x.result),g=!1),y&&e.results.max.copy(x.result),e.options.store===Ga.ALL&&e.results.all.splice(v++,0,x.result);break}}};const iI=1,FIt=(()=>{const t=[],e=iI;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let UIt=class{constructor(e){this.result=e,this.screenPoint=ma()}},$4;function Tye(t){return $4&&$4.viewingMode===t||($4=Wp(t)),$4}let Sye=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return A(e)?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Eye(t){return typeof t=="object"&&"intersect"in t}const L4=$(),D4=ma();let qii=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},kIt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Nt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,i,r,s=0){return new Promise((n,o)=>{const a={x:e,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),ol(r,()=>{ree(this._queries,a),o(er())})})}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new YL({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=b(a)?a.signal:i[0].signal;if(b(a)){let h=0;i.forEach(d=>ol(d.signal,()=>{h++,d.result.reject(er()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((d,f)=>{b(d.signal)&&d.signal.aborted?d.result.reject(er()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(gc)}}},rI=class extends ws.EventedMixin(Ee){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=He(this._elevationQueryCached)}get _elevationQuery(){return A(this._elevationQueryCached)&&(this._elevationQueryCached=new kIt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&us(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=N4(o,this._im,e,i,r,s,n),A(o)&&(o=N4(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=N4(o,this._scene,e,i,r,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}queryElevation(e,i,r,s,n,o=null,a=0){const l=zb();return this._elevationQuery.queryElevation(e,i,o,a).then(c=>{n==="scene"&&(c=N4(c,this._scene,e,i,r,s,n)),l.resolve(c)}).catch(c=>{kn(c)?l.reject(c):l.resolve(this.getElevation(e,i,r,s,n))}),l.promise}register(e,i){this._handles.set(i,i.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(i)}unregister(e){var i;this._handles.has(e)&&((i=this._handles.get(e))==null||i.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const s=r.indexOf(e);s>-1&&r.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function N4(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);b(l)&&(t=b(t)?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],rI.prototype,"view",void 0),u([p()],rI.prototype,"spatialReference",null),rI=u([N("esri.views.3d.support.CombinedElevationProvider")],rI);let sI=class JK{static isValidProfile(e){return e in JK.profiles}static getDefaultProfile(){return me("esri-iPhone")?"low":"medium"}static apply(e,i){const r=JK.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};function Cye(){const t=!!me("esri-mobile"),e=!!me("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!me("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!me("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}sI.test={reset(){const t=Cye();for(const e in t)sI.profiles[e]=t[e]}},function(t){t.profiles=Cye()}(sI||(sI={}));const h8=sI;function PNe(){return new Float32Array(4)}function VIt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Lm(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function zIt(t,e){return new Float32Array(t,e,4)}function INe(){return PNe()}function $Ne(){return Lm(1,1,1,1)}function LNe(){return Lm(1,0,0,0)}function DNe(){return Lm(0,1,0,0)}function NNe(){return Lm(0,0,1,0)}function FNe(){return Lm(0,0,0,1)}const BIt=INe(),GIt=$Ne(),jIt=LNe(),HIt=DNe(),qIt=NNe(),WIt=FNe();Object.freeze(Object.defineProperty({__proto__:null,ONES:GIt,UNIT_W:WIt,UNIT_X:jIt,UNIT_Y:HIt,UNIT_Z:qIt,ZEROS:BIt,clone:VIt,create:PNe,createView:zIt,fromValues:Lm,ones:$Ne,unitW:FNe,unitX:LNe,unitY:DNe,unitZ:NNe,zeros:INe},Symbol.toStringTag,{value:"Module"}));const Mye=new et([0,255,255]),Aye=new et([0,0,0]),Oye=1,Rye=.25,Pye=.4,Iye=.2;let Ig=class extends Ee{constructor(){super(...arguments),this.color=Mye.clone(),this.haloColor=null,this.haloOpacity=Oye,this.fillOpacity=Rye,this.shadowOpacity=Pye,this.shadowColor=Aye.clone(),this.shadowDifference=Iye}static toEngineOptions(e){const i=et.toUnitRGBA(e.color??Mye),r=b(e.haloColor)?et.toUnitRGBA(e.haloColor):i,s=et.toUnitRGBA(e.shadowColor??Aye),n=e.haloOpacity??Oye,o=e.fillOpacity??Rye,a=e.shadowOpacity??Pye,l=e.shadowDifference??Iye;return{color:Lm(i[0],i[1],i[2],i[3]),haloColor:Lm(r[0],r[1],r[2],r[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:di(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([p({type:et})],Ig.prototype,"color",void 0),u([p({type:et})],Ig.prototype,"haloColor",void 0),u([p()],Ig.prototype,"haloOpacity",void 0),u([p()],Ig.prototype,"fillOpacity",void 0),u([p()],Ig.prototype,"shadowOpacity",void 0),u([p({type:et})],Ig.prototype,"shadowColor",void 0),u([p()],Ig.prototype,"shadowDifference",void 0),Ig=u([N("esri.views.3d.support.HighlightOptions")],Ig);const KK=Ig;let gT=class extends Ae{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:vS(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([p()],gT.prototype,"geometries",void 0),u([p({json:{read:{source:"outSR"}}})],gT.prototype,"outSpatialReference",void 0),u([p()],gT.prototype,"transformation",void 0),u([p()],gT.prototype,"transformForward",void 0),gT=u([N("esri.rest.support.ProjectParameters")],gT);const Dne=gT,YIt=Vn(Dne);async function UNe(t,e,i){e=YIt(e);const r=tv(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=vS(e.geometries[0]),a=rEe(s,i);return tr(r.path+"/project",a).then(({data:{geometries:l}})=>oEe(l,o,n))}async function Nne(t=null,e){var s,n;if(Mr.geometryServiceUrl)return Mr.geometryServiceUrl;if(!t)throw new J("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||du.getDefault():t,await i.load({signal:e});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new J("internal:geometry-service-url-not-configured");return r}async function XIt(t,e,i=null,r){const s=await Nne(i,r),n=new Dne;n.geometries=[t],n.outSpatialReference=e;const o=await UNe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new J("internal:geometry-service-projection-failed")}const ZIt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Nne,projectGeometry:XIt},Symbol.toStringTag,{value:"Module"}));let JIt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=Ec(this.spatialReference,ur(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Nne(e&&e.get("portalItem")).catch(()=>{throw new J("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof st?l:new st(l,this.spatialReference)),o=new Dne({geometries:n,outSpatialReference:Ye.WGS84}),a=(await UNe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},Gf=class extends Ee{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([p()],Gf.prototype,"minTotalNumberOfFeatures",void 0),u([p()],Gf.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],Gf.prototype,"maxTotalNumberOfPrimitives",void 0),u([p()],Gf.prototype,"snapshotAvailable",void 0),u([p()],Gf.prototype,"polygonLodFactor",void 0),u([p()],Gf.prototype,"polylineLodFactor",void 0),u([p()],Gf.prototype,"skipHighSymbolLods",void 0),Gf=u([N("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Gf);let yy=class extends Ee{constructor(){super(...arguments),this.lodFactor=1}};u([p()],yy.prototype,"lodFactor",void 0),yy=u([N("esri.views.3d.support.QualitySettings.LoDFactorSettings")],yy);let K9=class extends yy{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};K9=u([N("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],K9);let J0=class extends Ee{constructor(){super(...arguments),this.object=new K9,this.point=new yy,this.integratedMesh=new yy,this.pointCloud=new yy,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:K9})],J0.prototype,"object",void 0),u([p({type:yy})],J0.prototype,"point",void 0),u([p({type:yy})],J0.prototype,"integratedMesh",void 0),u([p({type:yy})],J0.prototype,"pointCloud",void 0),u([p()],J0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),J0=u([N("esri.views.3d.support.QualitySettings.SceneServiceSettings")],J0);let K1=class extends Ee{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([p()],K1.prototype,"lodBias",void 0),u([p()],K1.prototype,"angledSplitBias",void 0),u([p()],K1.prototype,"reduceTileLevelDifferences",void 0),u([p()],K1.prototype,"textureFadeDuration",void 0),K1=u([N("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],K1);let IM=class extends Ee{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],IM.prototype,"pixelRatio",void 0),u([p()],IM.prototype,"maxTotalNumberOfFeatures",void 0),IM=u([N("esri.views.3d.support.QualitySettings.HeatmapSettings")],IM);let jc=class extends Ee{constructor(){super(...arguments),this.graphics3D=new Gf,this.sceneService=new J0,this.tiledSurface=new K1,this.heatmap=new IM,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:Gf})],jc.prototype,"graphics3D",void 0),u([p({type:J0})],jc.prototype,"sceneService",void 0),u([p({type:K1})],jc.prototype,"tiledSurface",void 0),u([p({type:IM})],jc.prototype,"heatmap",void 0),u([p()],jc.prototype,"fadeDuration",void 0),u([p()],jc.prototype,"antialiasingEnabled",void 0),u([p()],jc.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],jc.prototype,"highQualityTransparency",void 0),u([p()],jc.prototype,"memoryLimit",void 0),u([p()],jc.prototype,"additionalCacheMemory",void 0),u([p()],jc.prototype,"frameRate",void 0),u([p()],jc.prototype,"maximumPixelRatio",void 0),jc=u([N("esri.views.3d.support.QualitySettings.QualitySettings")],jc);const $ye=jc;function KIt(t){return oee(t)&&t.length>=3}function QIt(t){return(aee(t)||Array.isArray(t))&&t.length>=3}function e$t(t){return KIt(t)||QIt(t)}let t$t=class QK{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=pyt(s)}set extent(e){e&&fyt(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return xyt(this._coordinateSystem,e)}setAltitude(e,i,r=e){return IOe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Tyt(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return _yt(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return vyt(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,rh.X,tt.get()),s=this.worldBasisAtPosition(e,rh.Y,tt.get()),n=this.worldBasisAtPosition(e,rh.Z,tt.get());return Fy(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,tt.get()),s=this.worldBasisAtPosition(e,rh.Y,tt.get()),n=aOe(i,s,r);return Sc(n)}intersectManifoldClosestSilhouette(e,i,r){return TG(this._coordinateSystem,i,this._tmpCoordinateSystem),wyt(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){TG(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=tt.get();return byt(this._tmpCoordinateSystem,e,s)?ge(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===it.Global)return this.intersectManifold(e,i,r);TG(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=tt.get();return OS(s.plane,e,n)?ge(r,n):null}toRenderCoords(e,i,r){return P9(e)?ll(e,i,this.spatialReference):_a(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return P9(i)?(b(r)&&(i.spatialReference=r),ZTe(e,this.spatialReference,i)):e$t(i)?_a(e,this.spatialReference,i,r)?i:null:Jb(e,this.spatialReference,i)}static create(e,i){switch(e){case it.Local:return new QK(it.Local,i,Ec(i),yyt());case it.Global:return new QK(it.Global,i,1,gyt(i))}}static renderUnitScaleFactor(e,i){return Lye(e)/Lye(i)}};function Lye(t){if(I9(t,it.Global))return 1;const e=$Oe(!1,t);return Ec(e)}var Kg;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Kg||(Kg={}));const i$t=(()=>{const t=new Array;return t[Kg.ELEVATION]=10,t[Kg.BASEMAP]=10,t[Kg.I3S_INDEX]=10,t[Kg.I3S_DATA]=10,t[Kg.SYMBOLOGY]=5,t})(),r$t=30;function kNe(t){return typeof t.getUsedMemory=="function"}function s$t(t){return new Hc({view:t})}const F4=1,fH=1,n$t=.75,o$t=.6,Dye=1.3;let Hc=class extends Ee{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new die,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(F4),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,i){return new Art(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<o$t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(F4);else if(e)(this._memoryPredicted>1.1*fH||this._memoryUsed>fH)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Dye),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>fH)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Dye),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<n$t&&this._quality<F4){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),F4))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,i=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;b(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(kNe(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,i+=a.getUnloadedMemory()*l}});const s=A(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);le.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};u([p({constructOnly:!0})],Hc.prototype,"view",void 0),u([p()],Hc.prototype,"maxMemory",null),u([p()],Hc.prototype,"additionalCacheMemory",null),u([p()],Hc.prototype,"memoryFactor",null),u([p()],Hc.prototype,"updating",null),u([p()],Hc.prototype,"usedMemory",null),u([p()],Hc.prototype,"_quality",void 0),u([p()],Hc.prototype,"_memoryUsed",void 0),u([p()],Hc.prototype,"_updating",void 0),u([p()],Hc.prototype,"_stableQuality",void 0),u([p()],Hc.prototype,"_maxMemory",void 0),u([p()],Hc.prototype,"_additionalCacheMemory",void 0),Hc=u([N("esri.views.3d.support.MemoryController")],Hc);let a$t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},l$t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new c$t}},c$t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},u$t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new l$t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Rt(i.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},d8=class extends Ee{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new u$t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(Nt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=is(this._frameTask),this._tasks.forEach(e=>lu(e.abortController)),this._loadQueue=He(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=zb();n.__signal=b(s)?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return ol(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new p$t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;g$(e.resolvers,i),i.reject(er()),e.resolvers.length===0&&(e.status===op.DOWNLOADING&&(e.status=op.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=op.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=f$t(b(s)&&s.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(Rt(e.status===op.DOWNLOADING),e.status=op.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();_i(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==op.DOWNLOADED&&(i.err=i.err||er()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!kn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)kn(i)?s.reject(i):s.reject(new J("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r<=0?e.result:ue(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===op.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=op.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=tr(e.url,{...e.options,responseType:s,timeout:r,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===op.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,d=d$t(h);if(s="image",e.size=h.byteLength,d==="unknown")return e.request=tr(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(g=>a(g.data),l);const f=new Blob([h],{type:d}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=tr(m,{responseType:s,timeout:r,signal:n}),e.request.then(g=>a(new Hz(g.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([p({readOnly:!0})],d8.prototype,"updating",void 0),d8=u([N("esri.views.3d.support.StreamDataLoader")],d8);const h$t={numRetries:0};function d$t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Hz=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}},p$t=class extends a$t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=op.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=h$t.numRetries}};function f$t(t,e,i){return`${t}:${e}:${i}`}var op;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(op||(op={}));let p8=class extends Ee{constructor(){super(...arguments),this.updating=!1}};function m$t(t){return new $g({view:t})}u([p({readOnly:!0})],p8.prototype,"updating",void 0),p8=u([N("esri.views.3d.support.ResourceControllerMain")],p8);let $g=class extends p8{constructor(){super(...arguments),this._immediateTask=WA,this._normalTask=WA,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=zdt(),this._memoryController=s$t(this.view),this._streamDataLoader=new d8,this._streamDataLoader.setup(r$t,i$t,this._scheduler),this.addHandles([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Mi),ae(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=F_({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Nt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Nt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=is(this._frameTask),this._streamDataLoader=He(this._streamDataLoader),this._memoryController=He(this._memoryController),this._scheduler=He(this._scheduler)}get updating(){var e,i,r;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(pee(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([p({constructOnly:!0})],$g.prototype,"view",void 0),u([p()],$g.prototype,"_scheduler",void 0),u([p()],$g.prototype,"_memoryController",void 0),u([p()],$g.prototype,"_streamDataLoader",void 0),u([p()],$g.prototype,"_immediateTask",void 0),u([p()],$g.prototype,"_normalTask",void 0),u([p({readOnly:!0})],$g.prototype,"updating",null),$g=u([N("esri.views.3d.support.ResourceControllerImpl")],$g);function g$t(t){return"performanceInfo"in t}const NE=$(),y$t=$(),h0=$(),d0=$();function _$t(t,e,i=0){const r=t.extent;if(A(r))return!1;if(i===0)return Wxe(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return $Ze(r,e,i*s)}function U4(t,e,i,r){ge(NE,i),NE[r]=e[r];const s=be(NE,NE,e),n=be(y$t,t,e),o=xe(n,s),a=xe(s,s);let l;l=o<=0?e:a<=o?i:we(NE,e,pe(s,s,o/a));const c=be(NE,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function v$t(t,e,i){const r=t.extent;if(A(r))return 0;h0[0]=r[0],h0[1]=r[1],h0[2]=i,d0[0]=r[2],d0[1]=r[3],d0[2]=i;let s=1/0,n=1/0;return e[0]<h0[0]?s=U4(e,h0,d0,0):e[0]>d0[0]&&(s=U4(e,d0,h0,0)),e[1]<h0[1]?n=U4(e,h0,d0,1):e[1]>d0[1]&&(n=U4(e,d0,h0,1)),Math.min(s,n)}function b$t(t,e,i){if(A(t))return Ure();if(t.spatialReference.isGeographic&&!j2(t.spatialReference))return new J("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Zu.checkUnsupported(t);if(b(r))return r;if(A(i))return new J("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=w$t(t,i);if(s)return s;const n=t.spatialReference;return b(e)&&!(n.equals(e)||e.isWGS84&&n.isWebMercator)?new J("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function w$t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=Hxe(e),a=bi();Zu.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>xM){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new J("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:xM})}return null}const x$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:b$t,isInsideExtent:_$t,tiltToExtentEdge:v$t},Symbol.toStringTag,{value:"Module"}));function T$t(){return!0}function S$t(){return 0}function E$t(t,e){if(A(t))return Ure();const i=t.lods.length-1,r=t.spatialReference,s=j2(r)||Ly(r)||Dy(r);if(r.isWebMercator){if(!Zu.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new J("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new J("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Zu.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new J("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new J("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return b(e)&&!t.spatialReference.equals(e)?new J("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const C$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:E$t,isInsideExtent:T$t,tiltToExtentEdge:S$t},Symbol.toStringTag,{value:"Module"})),M$t={[it.Global]:C$t,[it.Local]:x$t};function jg(t,e){t||console.warn("Terrain: "+e)}let So=!1,Q9=!1;function A$t(t){Q9=t,So=So||t}function O$t(t){So=t}function ke(t,e){var i;if(So&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function eQ(t){return qz(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function ek(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function qz(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function Fne(t){return(t==null?void 0:t.type)==="tile-3d"}function bL(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function VNe(t){return(t==null?void 0:t.type)==="wmts-3d"}function tQ(t){return(t==null?void 0:t.type)==="elevation-3d"}function vR(t){return(t==null?void 0:t.type)==="group"}function tk(t){return t&&(Fne(t)||VNe(t)||qz(t)||bL(t))}function iQ(t){return t&&(Fne(t)||qz(t)||bL(t)||VNe(t))}function wL(t){return iQ(t)||tQ(t)}function R$t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return b(e)&&"type"in e&&e.type==="raster-tile"}function P$t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return b(e)&&"type"in e&&e.type==="vector-tile"}function I$t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return b(e)&&"type"in e&&e.type==="tile-texture"}function $$t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e instanceof HTMLImageElement||e instanceof Hz||e instanceof HTMLCanvasElement||e instanceof ImageData}function hA(t){return b(t)&&"release"in t&&t.release(),null}function Nye(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Une(t,e,i,r){return M$t[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function Wz(t,e,i){let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=L$t(t,e,i);r=n.tileInfo,s=n.fullExtent}else{s=ek(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=i===it.Local;if(ek(t))r=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!D$t(e)||N$t.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return b(r)&&b(s)&&Une(r,s,e,i)==null?{tileInfo:r,fullExtent:s}:null}function L$t(t,e,i){const r=UWe(t);if(b(r)){if(!xt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>Une(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function D$t(t){return t.isWGS84||t.isWebMercator||Kbe(t)||!w$(t)}const N$t={force512VTL:!1};function Fye(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function p0(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function vp(t,e,i=k$t){return Math.abs(t-e)<i}function rQ(t){return t===Ht.NORTH_EAST?Ht.SOUTH_WEST:t===Ht.NORTH_WEST?Ht.SOUTH_EAST:t===Ht.SOUTH_WEST?Ht.NORTH_EAST:Ht.NORTH_WEST}function ik(t){return t===Ht.NORTH?Ht.SOUTH:t===Ht.EAST?Ht.WEST:t===Ht.SOUTH?Ht.NORTH:Ht.EAST}function F$t(t){return t===Ht.NORTH_WEST||t===Ht.SOUTH_WEST}function U$t(t){return t===Ht.NORTH_WEST||t===Ht.NORTH_EAST}function Uye(t){return t===Ht.NORTH_WEST||t===Ht.WEST||t===Ht.SOUTH_WEST}function kye(t){return t===Ht.NORTH_EAST||t===Ht.EAST||t===Ht.SOUTH_EAST}function Vye(t){return t===Ht.SOUTH_EAST||t===Ht.SOUTH||t===Ht.SOUTH_WEST}function zye(t){return t===Ht.NORTH_EAST||t===Ht.NORTH||t===Ht.NORTH_WEST}const sy=[Ht.NORTH,Ht.EAST,Ht.SOUTH,Ht.WEST],rk=[Ht.NORTH_EAST,Ht.SOUTH_EAST,Ht.SOUTH_WEST,Ht.NORTH_WEST],k$t=1e-5;let V$t=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=wL(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),g$t(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},z$t=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,b(e.resourceController)){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*VA.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.getUsedMemory())??0;const i=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=b(i)?i.usedMemory:0,e.allLayerViews.items.forEach(s=>{(kNe(s)||wL(s))&&this.layerPerformanceInfos.push(new V$t(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},B$t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return b(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>JDe(new XDe(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return b(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,n=>KDe(e,n),i)}async _loadOnce(e,i,r,s,n){_i(n);const o=ol(n,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),_i(n),l}finally{is(o)}}_abortLoad(e,i){const r=e.get(i);b(r)&&--r.refCount>0||(e.delete(i),b(r)&&r.abortController.abort())}},G$t=class extends vM{constructor(e,i,r,s){super(i,s),this._streamDataRequester=e,this._parameters=r}async fromUrl(e,i,r){_i(r);const s=b(r)?r.signal:null,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,i);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await lp(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={...this._parameters,powerOfTwoResizeMode:Ib.PAD};if(Wbe(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new $S(i,s)}},j$t=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Kg.SYMBOLOGY),this.objectResourceCache=new B$t((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new G$t(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:qt.CLAMP_TO_EDGE,t:qt.CLAMP_TO_EDGE}},e.resourceController.scheduler);const i=ur(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=FIe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=YTt(e.viewingMode,i)}destroy(){He(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Dp();this._graphicsOwners.push(e);const i=ae(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Dp(()=>{i.remove(),g$(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new ir;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ae(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Mi),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=He(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;k4.distance=e.centerOnSurfaceInfrequent.distance,k4.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(k4),this.screenSizePerspectiveSettingsLabels.update(k4),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const k4={distance:0,fovY:0};let rM=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new fb({symbolLayers:[new pb({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new TS({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(e,i){if(A(i))return;this.hide();const r=new st({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new Ho({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){b(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},ab=class extends Ee{constructor(e){super(e),this.handles=new ir}destroy(){this.handles.destroy()}};u([p({constructOnly:!0})],ab.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],ab.prototype,"surface",void 0),u([p({constructOnly:!0})],ab.prototype,"state",void 0),ab=u([N("esri.views.3d.support.PointOfInterest")],ab);const H$t=Array;let Df=class extends ab{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new G_({location:st,renderLocation:H$t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=$(),this._tmpPoint=new st}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Gs(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=He(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=Wr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return oS(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),al.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>q$t&&this.renderCoordsHelper.viewingMode===it.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?W$t:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{kn(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,al.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(mH,this._estimatedSurfaceAltitude,this._camera.eye),Ur(this._get("renderLocation"),mH)||(this._set("renderLocation",ge(this._propertiesPool.get("renderLocation"),mH)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],Df.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Df.prototype,"cache",void 0),u([p({constructOnly:!0})],Df.prototype,"task",void 0),u([p({readOnly:!0})],Df.prototype,"location",null),u([p({constructOnly:!0})],Df.prototype,"map",void 0),u([p({readOnly:!0})],Df.prototype,"renderLocation",void 0),u([p({readOnly:!0})],Df.prototype,"scale",null),u([p({readOnly:!0})],Df.prototype,"updating",null),Df=u([N("esri.views.3d.support.CameraOnSurface")],Df);const mH=$(),q$t=1e5,W$t=1e6,Y$t=Array;let ap=class extends ab{constructor(e){super(e),this._propertiesPool=new G_({location:st,renderLocation:Y$t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=$(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=is(this._frameWorker),this._propertiesPool=He(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,al.YIELD}_updateRenderLocation(){const e=Z$t;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=J$t;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ge(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Wr(this._camera.eye,e):(pe(e,this._camera.viewForward,this._get("distance")),we(e,e,this._camera.eye)),Ur(this._get("renderLocation"),e)||this._set("renderLocation",ge(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=ur(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Ll(r.eye),c=l<a*a,h=Wr(r.eye,i);if(c&&h>o/4){const d=a-Math.sqrt(l);return pe(i,r.viewForward,d),we(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;b(o)&&dV(o,(n=this.surface)==null?void 0:n.spatialReference,bR,this.renderCoordsHelper.spatialReference)&&(i[0]=Se(i[0],bR[0],bR[2]),i[1]=Se(i[1],bR[1],bR[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(_r.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Wr(r,e),n=Wr(r,i);if(Math.abs(n-s)/s>X$t)return!0}return!1}};u([p({constructOnly:!0})],ap.prototype,"scheduler",void 0),u([p({constructOnly:!0})],ap.prototype,"task",void 0),u([p()],ap.prototype,"distance",void 0),u([p({constructOnly:!0})],ap.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],ap.prototype,"location",null),u([p({readOnly:!0})],ap.prototype,"renderLocation",void 0),u([p()],ap.prototype,"updating",void 0),ap=u([N("esri.views.3d.support.CenterOnSurface")],ap);const X$t=.05,Z$t=$(),J$t=$(),bR=bi();let K$t=class{constructor(e){this._handles=new ir,this.events=new ws,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=He(this._handles)}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Q$t)}};const Q$t={},eLt=Array;let Lg=class extends ab{constructor(e){super(e),this._propertiesPool=new G_({location:st,renderLocation:eLt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ae(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ae(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Nt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=He(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Bye);const n=Math.max(0,(Math.acos(xe(Bye,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Bb(e,i)){const c=this._propertiesPool.get("renderLocation");ge(c,i),this._set("renderLocation",c)}return al.YIELD}const o=1-Se(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Gye);const l=this._propertiesPool.get("renderLocation");return En(l,i,Gye,a),e&&Bb(e,l)||this._set("renderLocation",l),al.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(ma());if(r[1]=i.aboveGround?i.padding[$i.BOTTOM]:i.fullHeight-i.padding[$i.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,wR)){be(wR,wR,i.eye);const n=Re(wR,wR);if(this.renderCoordsHelper.intersectManifold(Td(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],Lg.prototype,"_dirty",void 0),u([p({constructOnly:!0})],Lg.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Lg.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],Lg.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p({readOnly:!0})],Lg.prototype,"updating",null),u([p({readOnly:!0})],Lg.prototype,"location",null),u([p({readOnly:!0})],Lg.prototype,"renderLocation",void 0),Lg=u([N("esri.views.3d.support.pointsOfInterest.Focus")],Lg);const Bye=$(),wR=$(),Gye=$();let B0=class extends Ee{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=$();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new ir}initialize(){this.view.state.isLocal&&(this._handles.add([ae(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),Gs(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||A(this.surfaceView.extent)||A(this.surfaceView.spatialReference))return void this._set("location",null);const e=wte(this.surfaceView.extent),i=new st({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{kn(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};u([p({constructOnly:!0})],B0.prototype,"view",void 0),u([p({constructOnly:!0})],B0.prototype,"cache",void 0),u([p()],B0.prototype,"surface",null),u([p()],B0.prototype,"surfaceView",null),u([p({readOnly:!0})],B0.prototype,"location",void 0),u([p({readOnly:!0})],B0.prototype,"renderLocation",null),B0=u([N("esri.views.3d.terrain.StableSurfaceCenter")],B0);let G0=class extends Ee{constructor(e){super(e),this._tileGeometryUpdateExtent=kp(),this._tileGeometryUpdateSpatialReference=null,this.events=new ws,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Nt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",tLt),kp(this._tileGeometryUpdateExtent),this._set("updating",!1)),al.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Mb(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=iLt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,dx,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,px,i),dx[0]<px[0]?(s[0]=dx[0],s[2]=px[0]):(s[0]=px[0],s[2]=dx[0]),dx[1]<px[1]?(s[1]=dx[1],s[3]=px[1]):(s[1]=px[1],s[3]=dx[1]),Jk(s,e)}};u([p({constructOnly:!0})],G0.prototype,"state",void 0),u([p({constructOnly:!0})],G0.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],G0.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],G0.prototype,"scheduler",void 0),u([p({constructOnly:!0})],G0.prototype,"surface",void 0),u([p({readOnly:!0})],G0.prototype,"updating",void 0),G0=u([N("esri.views.3d.support.SurfaceGeometryUpdates")],G0);const tLt={},dx=$(),px=$(),iLt=kp();let Yc=class extends Ee{constructor(e){super(e),this._handles=new ir,this._tmpRay=ha(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new G_({renderPointOfView:rLt},this),this.renderPointOfView=$(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=Wp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ga.MIN,this._contentIntersector=Wp(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new ap({...l,task:Nt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new ap({...l,task:Nt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new ap({...l,task:Nt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Df({...l,cache:a,task:Nt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new G0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new K$t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new B0({cache:a,view:this.view})),this._set("focus",new Lg({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(d,f)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new rM(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new rM(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new rM(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new rM(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new rM(c,"green","Focus")),this._handles.add([ae(()=>e.contentCamera,d=>this._cameraChanged(d),Mi),ae(()=>i.extent,()=>this._updateCenterPointsOfInterest()),wa(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Mi),Gs(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Gs(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),wa(()=>_r.SHOW_POI,d=>this._setDebug(d),ii)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return A(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,FE,nLt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(FE):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(A(e))return this._surfaceAltitudeAtCenter;const i=e.origin,r=we(FE,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(FE)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(FE)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Rse(i,e,sLt);if(A(s))return null;const n=s.origin,o=we(FE,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Ur(this.renderPointOfView,i)||this._set("renderPointOfView",ge(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(ae(()=>i.renderLocation,r=>{var s;return(s=this._debugCenters.get(i))==null?void 0:s.show(r,i.renderCoordsHelper.spatialReference)},ii),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([p({readOnly:!0})],Yc.prototype,"centerOnContent",void 0),u([p({readOnly:!0})],Yc.prototype,"centerOnSurfaceFrequent",void 0),u([p({readOnly:!0})],Yc.prototype,"centerOnSurfaceInfrequent",void 0),u([p({readOnly:!0})],Yc.prototype,"cameraOnSurface",void 0),u([p({readOnly:!0})],Yc.prototype,"focus",void 0),u([p({readOnly:!0})],Yc.prototype,"renderPointOfView",void 0),u([p({readOnly:!0})],Yc.prototype,"surfaceOrigin",void 0),u([p({readOnly:!0})],Yc.prototype,"contentGeometryUpdates",void 0),u([p({readOnly:!0})],Yc.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],Yc.prototype,"view",void 0),u([p({readOnly:!0})],Yc.prototype,"updating",null),Yc=u([N("esri.views.3d.support.PointsOfInterest")],Yc);const rLt=Array,FE=$(),sLt=ha(),nLt={exclude:new Set([rb])};let oLt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},aLt=class{constructor(e,i,r,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=s)}get hasNoDataValues(){if(A(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(b(this._minValue))return;const{noDataValue:e,values:i}=this;let r=1/0,s=-1/0,n=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=s>-3e38?s:0)}},zNe=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=Dte(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>le.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Dp(()=>{r.removed=!0,ree(this._listeners,r),this._thread&&b(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const s=this._transferLists[e],n=s?s(i):[];return this._thread.invoke(e,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(_i(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},jye=class extends zNe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(n$.forEach((e,i)=>{e===this&&n$.delete(i)}),this.destroy())}};const n$=new Map;function lLt(t=null){let e=n$.get(t);return e||(b(t)?(e=new jye(i=>t.immediate.schedule(i)),n$.set(t,e)):(e=new jye,n$.set(null,e))),++e.ref,e}var Xu,Hye,qye;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Xu||(Xu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Hye||(Hye={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(qye||(qye={}));let cLt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},Dri=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function Fri(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let Uri=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function uLt(t,e,i,r,s,n){const o=e[r++];for(let a=0;a<o;a++){const l=new cLt(n);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let f=0;f<c;f++){const m=e[r++],g=e[r++],y=e[r++],v=e[r++],x=!!e[r++],S=e[r++],E=i[r++],C=i[r++],R=e[r++],O=e[r++];l.colliders.push({xTile:m,yTile:g,dxPixels:y,dyPixels:v,hard:x,partIndex:S,width:R,height:O,minLod:E,maxLod:C})}const h=t[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[r++],t[r++]]);const d=t[r++];for(let f=0;f<d;f++)l.iconVertexRanges.push([t[r++],t[r++]]);s.push(l)}return r}function Vri(t,e,i){for(const[r,s]of t.symbols)hLt(t,e,i,s,r)}function hLt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===Xu.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let Yz=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return A(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){A(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},dLt=class extends Yz{constructor(e,i){super(e,i),this.type=Xu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){b(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),b(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),b(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new qp(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},pLt=class extends Yz{constructor(e,i){super(e,i),this.type=Xu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){b(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),b(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),b(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,b(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),b(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),b(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,d=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new qp(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new qp(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},fLt=class extends Yz{constructor(e,i,r){super(e,i),this.type=Xu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],g=s[a++],y=s[a++];this.iconPerPageElementsMap.set(m,[g,y])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],g=s[a++],y=s[a++];this.glyphPerPageElementsMap.set(m,[g,y])}const h=s[a++],d=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(d),a=uLt(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){b(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),b(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),b(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),b(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,b(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),b(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),b(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),b(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconOpacityBuffer;e.length>0&&e.byteLength===i.size&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=yr.createVertex(e,or.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=yr.createVertex(e,or.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,d=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new qp(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new qp(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},mLt=class extends Yz{constructor(e,i){super(e,i),this.type=Xu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){b(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),b(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),b(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=yr.createVertex(e,or.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=yr.createIndex(e,or.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new qp(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const qri=!0,Wri=32,Yri=1.5,Wye=200,gLt=1/me("mapview-transitions-duration");let yLt=class extends ws{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return A(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=zb(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=zb(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=e*gLt;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},_Lt=class extends yLt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new rw(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;dre(r,o,0,0,0,a,0,s,n,1),YA(this.transforms.dvs,e.displayViewMat3,r)}},gH=class BNe extends _Lt{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Wye}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Wye)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Xu.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}b(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(GNe.delete(this),BNe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Xu.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;b(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Xu.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;pre(o),s9(o,o,n),fre(o,o,Math.PI*e.rotation/180),mre(o,o,[r,s,1])}_createTransforms(){return{dvs:cu(),tileMat3:cu(),tileUnitsToPixels:cu()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;e.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case Xu.FILL:r=new pLt(e,this.styleRepository);break;case Xu.LINE:r=new dLt(e,this.styleRepository);break;case Xu.SYMBOL:r=new fLt(e,this.styleRepository,this);break;case Xu.CIRCLE:r=new mLt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e),this.layerCount--}};const GNe=new Map;function vLt(){GNe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const Jri={value:.5,readOnly:!0},bLt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let $M=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},wLt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},xLt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new wLt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*q$;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const y=Math.floor(m),v=Math.floor(g),x=y+v*c,S=h[x],E=h[x+1],C=h[x+c],R=h[x+c+1];if(S+E+C+R<d){const O=m-y,U=g-v,L=dF(S,E,C,R,O,U),B=dF(S,E,C,R,O+f,U),G=dF(S,E,C,R,O,U+f),j=dF(S,E,C,R,O+f,U+f);return s.min=Math.min(L,B,G,j),s.max=Math.max(L,B,G,j),s}m=y,g=v,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let y=m;y<=m+f;y++)for(let v=g;v<=g+f;v++){const x=h[y+v*c];x<d?(a=Math.min(a,x),l=Math.max(l,x)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const TLt=.5*q$;function Rs(t,e,i){if(A(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Se(r.dy*(r.y1-e),0,s),o=Se(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,h=a*c+l,d=r.data.values,f=d[h],m=d[h+1],g=h+c,y=d[g],v=d[g+1];if(f+y+m+v<TLt){n-=a,o-=l;const x=f+(m-f)*o;return x+(y+(v-y)*o-x)*n}}return null}let sp=class extends Ee{constructor(e){super(e),this._handles=new ir}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=He(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=jNe(r.fullExtent,this.viewSpatialReference);b(s)&&e.push(Hxe(s))}}),e}};function SLt(t,e){return t===it.Global?new sQ(e):new nQ(e)}u([p({readOnly:!0})],sp.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],sp.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],sp.prototype,"stencilEnabledExtents",null),u([p()],sp.prototype,"viewSpatialReference",void 0),u([p()],sp.prototype,"tilingScheme",void 0),u([p()],sp.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],sp.prototype,"layers",void 0),u([p({constructOnly:!0})],sp.prototype,"layerViews",void 0),sp=u([N("esri.views.3d.terrain.ExtentHelper")],sp);let sQ=class extends sp{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?UOe:$yt}};sQ=u([N("esri.views.3d.terrain.ExtentHelperGlobal")],sQ);let nQ=class extends sp{_computeLayerViewsExtent(){const e=kp(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=jNe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);Mb(e,a,e)}});const r=NW(e)?e:null,s=this._get("layerViewsExtent");return p2(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=kp();this.layers.forEach(o=>{if(o.loaded&&xI(o)){const a=Wz(o,i,it.Local);if(A(a))return;const{tileInfo:l,fullExtent:c}=a;b(l)&&b(c)&&(ek(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Mb(r,c,r)}}),Mb(r,this.defaultTiledLayersExtent,r);const s=NW(r)?r:null,n=this._get("tiledLayersExtent");return p2(s,n)?n:s}};function jNe(t,e){return b(t)&&!t.spatialReference.equals(e)?WTe(t,t.spatialReference,e):t}nQ=u([N("esri.views.3d.terrain.ExtentHelperLocal")],nQ);var Di;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Di||(Di={}));const yT=[Di.ELEVATION,Di.MAP];function HNe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const ELt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let t1,qc=class extends Ee{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||_r.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return b(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?ur(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new ir,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=me("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var i;const e=this._view;this.renderer=new $f({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Wp(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ae(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),ae(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),Mi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Nt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(gc,r,vn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,vn.BACKGROUND,r.pixelRatio)})]),(i=e._stage)==null||i.renderer.setParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,vn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=He(this._handles),b(t1)&&(t1.hide(),t1=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this._view.renderSpatialReference;b(e)&&b(i)?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Hb(-20037508342787e-6,20037508342787e-6):new Hb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Bh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&b(e.setDrapingExtent)&&b(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,vn.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return al.YIELD;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,f0);const n=od(f0.inner)/od(f0.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(ks.INNER,f0.inner,s,1*f0.pixelRatioAdjustment,f0.mapUnitsPerPixel),a=this._updateOverlay(ks.OUTER,f0.outer,s,n*f0.pixelRatioAdjustment,f0.mapUnitsPerPixel);o!==zg.EXTENT&&a!==zg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),o===zg.NONE&&a===zg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this._view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i;return Math.min(AA(Math.max(r,s)+256),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return zg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,CLt(i,o.extent)&&r===o.resolution)return a===n?zg.NONE:zg.RERENDER_ONLY;z_(o.extent,i),o.resolution=r;const l=wte(o.extent);return o.renderLocalOrigin=QI(l[0],l[1],0,"OV_"+this._latestOriginId++),zg.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[ks.INNER],s=this.renderer.overlays[ks.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,ks.INNER,i),this._setTileOverlayData(n,ks.OUTER,i)):(this._clearTileOverlayData(ks.INNER,i),this._clearTileOverlayData(ks.OUTER,i))}else this._clearTileOverlayData(ks.INNER,i),this._clearTileOverlayData(ks.OUTER,i)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const i=this.renderer.overlays[ks.INNER],r=this.renderer.overlays[ks.OUTER],s=this._pointIsInExtent(e,i.extent)?i:r;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=od(s),o=Om(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,od(e)/n,Om(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){HNe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(gc)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||b(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new r$e(this._view.state.camera,r,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,OLt,i,r);if(A(n))return!1;const o=n.origin,a=we(V4,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Se(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=V4;W3(qV(WV,ur(this._view.spatialReference).radius+l),Td(e.eye,e.viewForward),h),be(h,h,e.eye);const d=qb.normalize(aOe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;r=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=di(0,d,1,0),m=ld(f,f,e.projectionMatrix)[1],g=Se(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&Jee(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const s=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=$();this._findHorizonBasedPointOfInterest(e,n)||ge(n,s);const o=Math.max(.1,Wr(e.eye,n)),a=cw(this._view.renderCoordsHelper,s,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);_r.OVERLAY_SHOW_CENTER?(A(t1)&&(t1=new rM(this._view.graphics,"red")),t1.show(n,this._renderSR)):b(t1)&&t1.hide(),this._overlaySREqualsRenderSR||_a(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&b(this._spatialReference)&&this._spatialReference.isGeographic,d=h&&b(this._spatialReference)?1/ur(this._spatialReference).metersPerDegree:1,f=this._view.state.contentPixelRatio,m=e.perScreenPixelRatio/f*o*d;r.mapUnitsPerPixel=m/this._worldToPCSRatio;let g=i*m/2,y=!1,v=h?90:1/0;this._isSpherical&&b(c)&&b(this._spatialReference)&&(this._spatialReference.isWebMercator?(g/=Math.cos(lU(n[1])),v=c[3]):(y=!0,g/=ur(this._spatialReference).metersPerDegree,v=90),g>=v&&(g=v,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let x=1;y&&(x=1/Math.max(.2,Math.cos(Math.abs(ci(n[1])))),g*x>180&&(x=180/g),r.mapUnitsPerPixel*=x);const S=Math.log(2)/12;g=Math.exp(Math.round(Math.log(g)/S)*S);const E=g*x,C=32,R=.5*i/(C*E),O=.5*i/(C*g);n[0]=Math.round(n[0]*R)/R,n[1]=Math.round(n[1]*O)/O;const U=r.inner;U[0]=n[0]-E,U[1]=n[1]-g,U[2]=n[0]+E,U[3]=n[1]+g,this._isSpherical&&this._shiftExtentToFitBounds(U,1/0,v);const L=r.outer;if(6*E>od(c))z_(L,c);else if(l<=.25*Math.PI)L[0]=U[0]-E,L[1]=U[1]-g,L[2]=U[2]+E,L[3]=U[3]+g;else{_a(e.eye,this._renderSR,V4,this._spatialReference),Bs(fx,n,V4);let G=-Math.atan2(fx[1],fx[0])+.125*Math.PI;G<0&&(G+=2*Math.PI);const j=Math.floor(G/(.25*Math.PI));b3(fx,ELt[j],2*g),fx[0]*=x,fx[2]*=x,Kee(L,U,fx)}if(this._isSpherical)L[0]=this._longitudeCyclical.clamp(L[0]),L[2]=this._longitudeCyclical.clamp(L[2]),L[1]=Math.max(L[1],-v),L[3]=Math.min(L[3],v);else{const G=UW(U,c,MLt),j=UW(L,c,ALt);FW(G,j)&&(L[2]=L[0],L[3]=L[1])}const B=Math.abs(U[2]-U[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,B),r.pixelRatioAdjustment=r.mapUnitsPerPixel/B}_drawOverlayTextures(e,i,r=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[ks.INNER],r),o=this._drawOverlay(e[ks.OUTER],r);n!==e3.CHANGED&&o!==e3.CHANGED||this.surface.updateTileOverlayParams(vn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(i),i===vn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(vn.BACKGROUND)}_drawOverlay(e,i){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,i)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,i){return!A(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):Jk(e,i))}_rectInsideRect(e,i){return!A(i)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:FW(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),bU(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(gc)}}};function CLt(t,e){const r=_r.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([p()],qc.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],qc.prototype,"running",null),u([p()],qc.prototype,"_placementDirty",void 0),u([p()],qc.prototype,"_contentUpdated",void 0),u([p()],qc.prototype,"_isSpherical",null),u([p()],qc.prototype,"_worldToPCSRatio",null),u([p({autoDestroy:!0})],qc.prototype,"renderer",void 0),u([p({constructOnly:!0})],qc.prototype,"surface",void 0),u([p()],qc.prototype,"suspended",null),u([p()],qc.prototype,"updating",null),u([p({type:Boolean})],qc.prototype,"hasHighlights",null),u([p({type:Boolean})],qc.prototype,"rendersOccluded",null),qc=u([N("esri.views.3d.terrain.OverlayManager")],qc);const fx=Ai(),V4=$(),f0={inner:bi(),outer:bi(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},MLt=bi(),ALt=bi(),OLt=ha();var zg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(zg||(zg={}));let qNe=class oQ{constructor(e,i){this._factoryCallback=e,this._lengthCallback=i,this._pool=new Map}acquire(e){if(!oQ.test.disabled){const i=this._pool.get(e);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(e)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+i+s),i}}release(e){if(oQ.test.disabled)return;const i=this._lengthCallback(e);let r=this._pool.get(i);r||(r=new vi({shrink:!0}),this._pool.set(i,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};qNe.test={disabled:!1};let RLt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=ls(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},Yye=class{constructor(e,i,r,s,n){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return ke(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}_getNormalRaw(e,i){this.attributes.normalCompressed.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),we(e,e,this.localOrigin)}getNormal(e,i){const r=je();this._getNormalRaw(this.getAttributeIndex(i),r),LLt(e,r)}_setNormal(e,i,r,s){xL(this.attributes.normalCompressed,e,i,r,s)}_setUV(e,i,r){lh(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,s){this._setNormal(this.getAttributeIndex(e),i,r,s)}setVertexFromValuesRawPositionUV(e,i,r,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,i,r,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const PLt=qs().vec3f(P.POSITION).vec2i16(P.UV0).vec2i16(P.NORMALCOMPRESSED,{glNormalized:!0}),kne=new qNe(t=>PLt.createBuffer(t),t=>t.count);function ILt(){kne.clear()}function WNe(t){return kne.acquire(t)}function $Lt(t){kne.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function xL(t,e,i,r,s){const n=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),o=i*n,a=r*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,Zye(l),Zye(c))}function LLt(t,e){const i=Jye(e[0]),r=Jye(e[1]),s=1-Math.abs(i)-Math.abs(r);t[2]=s,s<0?(t[0]=(i>=0?1:-1)*(1-Math.abs(r)),t[1]=(r>=0?1:-1)*(1-Math.abs(i))):(t[0]=i,t[1]=r),Re(t,t)}const Xye=16384;function lh(t,e,i,r){t.setValues(e,i*Xye,r*Xye)}function Zye(t){return Se(Math.round(32767*t),-32767,32767)}function Jye(t){return Se(t/32767,-1,1)}function wc(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let DLt=class{constructor(){this.sinLonLUT=new Array(DP+1),this.cosLonLUT=new Array(DP+1),this.sinLatLUT=new Array(DP+1),this.cosLatLUT=new Array(DP+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},z4=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},NLt=class{constructor(){this.cornerNeighborData=[new z4,new z4,new z4,new z4],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},FLt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new NLt}},YNe=class f8{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=He(this._current),this._next=He(this._next),this._waiting=He(this._waiting),this._delayed=He(this._delayed)}get current(){if(A(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=f8.test.fadeMoment;if(b(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,O_.Immediate),this._delayed=null)),b(this._next)){e=e||performance.now();const i=this._fadeDuration,r=b(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==go.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(He(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(A(this._next))return 1;const e=f8.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return b(this._next)||b(this._delayed)}push(e,i=O_.Immediate){this._delayed=He(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),A(this._current))return void(this._current=e);const r=f8.test.fadeMoment||performance.now();return i!==O_.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):A(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(A(e)||(He(this._waiting),this._waiting=e))}get _fadeDuration(){return A(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var O_;YNe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(O_||(O_={}));var h3;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(h3||(h3={}));let XNe=class{constructor(){this._queue=new vi,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),b(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},ULt=class{constructor(){this._q=new vi}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!A(e)){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function o$(t,e,i){if(A(e)||A(e.fullExtent))return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function R_(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function ZNe(t,e,i=null){A(i)||i.length===0?t===h3.BACK_TO_FRONT?e.sort(kLt):e.sort(VLt):e.sort((r,s)=>zLt(r,s,t,i))}function kLt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function VLt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function JNe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:R_(t,e)}function zLt(t,e,i,r){return Kye(t,r)===Kye(e,r)?JNe(t,e,i):t?i:-i}function Kye(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function BLt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function GLt(t,e){const i=t.length;for(let r=0;r<i;++r)t.getItemAt(r).updateDistanceToPOI(e);t.sort(BLt)}function jLt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function HLt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function psi(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let Vne=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,go.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return b(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=eQ(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?o$:()=>!0;let h=this.tile;const d=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=b(m)?m.tile.level:-1,y=!!b(m)&&g-d>=a,v=Hn(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const x=h.level,S=d-x,E=h.layerInfo[i][e];if(E.data&&S>=a){(!y||x>g)&&this._setUpsampleTile(h),E.dataInvalidated&&(f=h);break}if((A(v)||v.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&x<=o&&!E.data&&!E.dataMissing&&((A(f)||h.level===n||x%FOe==0||d-f.level<a)&&(f=h),S>=l))break;h=h.parent}return b(f)&&d-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const e=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,go.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},qLt=class extends Vne{get _desiredMinLevelDelta(){throw Qye}get _progressiveLevelModulo(){throw Qye}dispose(){}};const Qye=new Error("Abstract method called on TileAgent"),Tu=new qLt;let KNe=class extends Vne{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return ZZ(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},QNe=class extends Vne{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return FOe}};var C2,dS;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(C2||(C2={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(dS||(dS={}));function WLt(t,e){t.fragment.uniforms.add([new Yt("u_colormap",i=>i.u_colormap),new Be("u_colormapOffset",i=>i.colormap.u_colormapOffset),new Be("u_colormapMaxIndex",i=>i.colormap.u_colormapMaxIndex),new Be("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(T`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${_c(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function YLt(t,e){t.fragment.uniforms.add(ym("u_transformGrid",i=>i.u_transformGrid,e.hasWebGL2Context?Ar.None:Ar.InvSize)),t.fragment.uniforms.add(new hr("u_transformSpacing",i=>i.common.u_transformSpacing)),t.fragment.uniforms.add(new hr("u_targetImageSize",i=>i.common.u_targetImageSize)),t.fragment.code.add(T`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${_c(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${_c(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${_c(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${_c(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let eFe=class extends Br{constructor(){super(...arguments),this.scale=1,this.offset=mu}};function tFe(t){t.attributes.add(P.POSITION,"vec2"),t.attributes.add(P.UV0,"vec2"),t.vertex.uniforms.add(new Be("scale",e=>e.scale)),t.vertex.uniforms.add(new hr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let XLt=class extends eFe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function ZLt(t,e){t.include(YLt,e),t.fragment.uniforms.add([new Yt("u_image",i=>i.u_image),new E_("u_flipY",i=>i.common.u_flipY),new E_("u_applyTransform",i=>i.common.u_applyTransform)]),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Je;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Je||(Je={}));const aQ={normal:Je.Normal,average:Je.Average,lighten:Je.Lighten,lighter:Je.Lighter,screen:Je.Screen,plus:Je.Plus,"color-dodge":Je.ColorDodge,darken:Je.Darken,multiply:Je.Multiply,"color-burn":Je.ColorBurn,overlay:Je.Overlay,"soft-light":Je.SoftLight,"hard-light":Je.HardLight,"vivid-light":Je.VividLight,hue:Je.Hue,saturation:Je.Saturation,luminosity:Je.Luminosity,color:Je.Color,difference:Je.Difference,exclusion:Je.Exclusion,minus:Je.Minus,invert:Je.Invert,reflect:Je.Reflect,"destination-over":Je.DestinationOver,"destination-atop":Je.DestinationAtop,"destination-in":Je.DestinationIn,"destination-out":Je.DestinationOut,"source-atop":Je.SourceAtop,"source-in":Je.SourceIn,"source-out":Je.SourceOut,xor:Je.Xor};function JLt(t){return t===Je.DestinationOver||t===Je.DestinationAtop||t===Je.DestinationIn||t===Je.DestinationOut||t===Je.SourceAtop||t===Je.SourceIn||t===Je.SourceOut||t===Je.Xor}function zne(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function KLt(t,e){const i=e.blendMode;i!==Je.Normal&&(i===Je.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Je.ColorDodge&&i!==Je.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Je.ColorBurn&&i!==Je.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Je.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Je.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Je.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Je.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Je.Hue&&i!==Je.Saturation&&i!==Je.Color&&i!==Je.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Je.Hue&&i!==Je.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Je.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:i===Je.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Je.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Je.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Je.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Je.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Je.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Je.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Je.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Je.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Je.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:i===Je.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:i===Je.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}var Uo,um,Xf;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Uo||(Uo={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(um||(um={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Xf||(Xf={}));function iFe(t,e){const i=e.output===Uo.GridComposite,r=e.output===Uo.ColorComposite,s=e.output===Uo.GroupBackgroundComposite,n=e.output===Uo.Composite;i&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(zne)),r&&t.fragment.uniforms.add(new fi("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===um.Required;if(o&&t.fragment.uniforms.add(new Be("baseOpacity",c=>c.baseOpacity)),n){const c=e.hasWebGL2Context?Ar.None:Ar.InvSize;t.fragment.uniforms.add(ym("fboColor",h=>h.fboTexture,c))}const a=e.blendMode!==Je.Normal,l=e.premultipliedSource===Xf.On;t.fragment.include(KLt,e),t.fragment.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${s?T`vec4(0.0, 0.0, 0.0, 0.0)`:r?T`vec4(backgroundColor, 1.0)`:i?T`vec4(gridColor(uv), 1.0)`:T`${_c(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?T`colorLayer * opacity;`:T`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let Xz=class extends XLt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Fl,this.fboTexture=null,this.baseOpacity=1}},QLt=class extends Xz{},eDt=class extends Xz{};function tDt(t){const e=new ar;return e.include(tFe),e.include(ZLt,t),e.include(WLt,t),e.include(iFe,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===C2.Stretch?rDt(e,t):t.colorizerType===C2.Lut?iDt(e):t.colorizerType===C2.Hillshade&&sDt(e,t),e}function iDt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function rDt(t,e){t.fragment.uniforms.add([new UD("u_bandCount",r=>r.symbolizer.u_bandCount),new Dl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Dl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Dl("u_factor",r=>r.symbolizer.u_factor,3),new Be("u_minOutput",r=>r.symbolizer.u_minOutput),new Be("u_maxOutput",r=>r.symbolizer.u_maxOutput),new E_("u_useGamma",r=>r.symbolizer.u_useGamma),new Dl("u_gamma",r=>r.symbolizer.u_gamma,3),new Dl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Be("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?T`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===dS.Noop?T`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function sDt(t,e){const i=t.fragment;i.uniforms.add([new Yt("u_image",s=>s.u_image),new UD("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Dl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Dl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Dl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Dl("u_weights",s=>s.symbolizer.u_weights,6),new hr("u_factor",s=>s.symbolizer.u_factor),new Be("u_minValue",s=>s.symbolizer.u_minValue),new Be("u_maxValue",s=>s.symbolizer.u_maxValue),new hr("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(ky),i.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?T`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const nDt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:eDt,ColorizerStretchUniforms:QLt,ColorizerUniforms:Xz,build:tDt},Symbol.toStringTag,{value:"Module"}));function oDt(t,e,i="nearest",r=!1){var c;const s=!(r&&e.pixelType==="u8"),n=s?Zt.FLOAT:Zt.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:t.type===Ft.WEBGL2&&s?Bt.RGBA32F:Qe.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?mt.NEAREST:mt.LINEAR,dataType:n,wrapMode:qt.CLAMP_TO_EDGE,flipped:!1};return new At(t,l,o)}function aDt(t,e){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=e,a=i[0]>1,l={width:a?4*n:n,height:o,target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:t.type===Ft.WEBGL2?Bt.RGBA32F:Qe.RGBA,dataType:Zt.FLOAT,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a&&s!=null)for(let h=0,d=0;h<s.length;h++)c[d++]=s[h],h%3==2&&(c[d++]=1);else for(let h=0;h<o;h++)for(let d=0;d<n;d++){const f=4*(h*n+d),m=2*(d*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new At(t,l,c)}function e0e(t,e){const i={width:e.length/4,height:1,target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,flipped:!1};return new At(t,i,e)}function lDt(t,e,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:mu,u_transformGridSize:t?t.size:mu,u_targetImageSize:e,u_srcImageSize:i}}function cDt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Tsi(t,e){return{u_scale:t,u_offset:e}}function uDt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function hDt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}function Ssi(t,e){const i=t.gl,r=e.glName,s=new Map;if(A(r))return s;const n=i.getProgramParameter(r,i.ACTIVE_UNIFORMS);let o;for(let a=0;a<n;a++)o=i.getActiveUniform(r,a),o&&s.set(o.name,{location:i.getUniformLocation(r,o.name),info:o});return s}function Esi(t,e,i){Object.keys(i).forEach(r=>{const s=e.get(r)||e.get(r+"[0]");s&&dDt(t,r,i[r],s)})}function Csi(t,e,i,r){i.length===r.length&&(r.some(s=>s==null)||i.some(s=>s==null)||i.forEach((s,n)=>{e.setUniform1i(s,n),t.bindTexture(r[n],n)}))}function dDt(t,e,i,r){if(r===null||i==null)return!1;const{info:s}=r;switch(s.type){case cc.FLOAT:s.size>1?t.setUniform1fv(e,i):t.setUniform1f(e,i);break;case cc.FLOAT_VEC2:t.setUniform2fv(e,i);break;case cc.FLOAT_VEC3:t.setUniform3fv(e,i);break;case cc.FLOAT_VEC4:t.setUniform4fv(e,i);break;case cc.FLOAT_MAT3:t.setUniformMatrix3fv(e,i);break;case cc.FLOAT_MAT4:t.setUniformMatrix4fv(e,i);break;case cc.INT:s.size>1?t.setUniform1iv(e,i):t.setUniform1i(e,i);break;case cc.BOOL:t.setUniform1i(e,i?1:0);break;case cc.INT_VEC2:case cc.BOOL_VEC2:t.setUniform2iv(e,i);break;case cc.INT_VEC3:case cc.BOOL_VEC3:t.setUniform3iv(e,i);break;case cc.INT_VEC4:case cc.BOOL_VEC4:t.setUniform4iv(e,i);break;default:return!1}return!0}const t0e={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let pDt=class{constructor(e,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=dt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...t0e,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||t0e}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){b(e)&&e.length>0?this._bandIds&&e.every((i,r)=>{var s;return!!((s=this._bandIds)!=null&&s[r])&&i===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,b(this._rasterTexture)){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?mt.LINEAR:mt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=dt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((A(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),b(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&A(this._transformGridTexture)&&(this._transformGridTexture=aDt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:s,opacity:n}=this,o=lDt(i,[r,s],[this.source.width,this.source.height],n),a=cDt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?uDt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?hDt(this.symbolizerParameters):null;return new Xz(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(A(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>b(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=dt(this._rasterTexture),this._transformGridTexture=dt(this._transformGridTexture),this._colormapTexture=dt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=dt(this._rasterTexture));const s=A(i)&&A(this.bandIds)||b(i)&&b(this.bandIds)&&i.join("")===this.bandIds.join("");if(b(this._rasterTexture)&&s)return;this._rasterTexture=dt(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=oDt(e,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=dt(this._colormapTexture),this._colormapTexture=e0e(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=e0e(e,r),void(this._colormap=r)):(this._colormapTexture=dt(this._colormapTexture),void(this._colormap=null))}},m8=class{constructor(){this.waitingAgents=new vi,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=yH.acquire();return i._init(e),i}release(){this.dispose(),g8.delete(this),yH.release(this)}dispose(){this.loadingAgent=dt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=hA(this._data)}static prune(){yH.prune(0)}_init(e){this.waitingAgents.clear(),this._data=hA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=lu(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){b(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e===i||A(i))this._unsetUpsampleInfo();else{if(A(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),jLt(e,i,this._upsampleInfo)}}get data(){return this._data}set data(e){hA(this._data),this._data=e}};const yH=new pa(m8,null,()=>{}),g8=new Map;function fDt(){g8.size>0&&(console.log(`${g8.size} live TilePerLayerInfo allocations:`),g8.forEach(t=>console.log(t,`
`)))}let sM=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var Gt;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(Gt||(Gt={}));const _H=$(),UE=$(),Ta=$(),mDt=.1;let Bne=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=bi(),this._elevationBounds=je(),this.layerInfo=[[],[]],this.extentInRadians=bi(),this.centerAtSeaLevel=$(),this._center=[$(),to(),$()],this.up=Xee(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=$()}static prune(){Gne.prune(0),jne.prune(0),m8.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[jn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var r;this._dirty=!1;const e=((r=this.parent)==null?void 0:r.frustumVisibility)??Rl.INTERSECTS;this._frustumVisibility=e===Rl.INSIDE?Rl.INSIDE:e===Rl.OUTSIDE?Rl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Rl.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(b(e)){const i=this.level-e;if(i===0)return!0;if(i===1)return!1}return this.isLeaf}init(e,i,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=ur(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[jn.MIDDLE][3]=0,this.vlevel=e?e[0]:0,i&&i.elevationBounds?Ao(this._elevationBounds,i.elevationBounds):Vt(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of yT){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=m8.acquire(this._surface.upsampleInfoPool),s===Di.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,DP)}release(){jg(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of yT){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Di.MAP].reduce((e,i)=>e+(i instanceof gH?i.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(b(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[Di.MAP])r instanceof gH?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[Di.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=tS(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===Di.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Di.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof sM?tS(e.texture):e instanceof HTMLImageElement||e instanceof Hz?this._cpuImageMemorySize:e instanceof gH||e instanceof pDt?e.memoryUsage:0}updateScreenDepth(e){const i=this._center[jn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||b(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Rl.OUTSIDE))return Gt.NONE;const s=this.level;be(_H,this._center[jn.MIDDLE],i);let n=Ll(_H),o=jn.MIDDLE;be(UE,this._center[jn.TOP],i);const a=Ll(UE);a<n&&(n=a,o=jn.TOP),be(UE,this._center[jn.BOTTOM],i);const l=Ll(UE);if(l<n&&(n=l,o=jn.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return Gt.SPLIT;const c=Math.sqrt(n),h=e.fovX*c*2,d=this._edgeLen/h,f=()=>{const v=s+Math.ceil(-Math.log2(e.relativeWidthLimit/d));return v!==this.vlevel?(this.vlevel=v,Gt.VSPLITMERGE):Gt.NONE_HIT_MAXLOD};if(b(r)&&r-s===1)return s>=e.maxLod?f():Gt.SPLIT;const m=xe(this.up,_H),g=this._elevationBounds[1]-this._elevationBounds[0],y=g/this.edgeLen;if(e.aboveGround&&m>0&&y<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-y>0)return Gt.NONE;if(d<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Gt.VSPLITMERGE):Gt.NONE;if(s>=e.maxLod)return f();if(s>6){be(UE,this._center[o],i),pe(Ta,this.up,m),be(Ta,Ta,UE);const v=Ll(Ta);if(v>this.radius*this.radius){pe(Ta,Ta,this.radius/Math.sqrt(v)),we(Ta,Ta,this._center[o]),be(Ta,i,Ta);const x=Math.min(1,(Math.abs(xe(Ta,this.up))+.5*g+this._curvatureHeight)/ze(Ta)),S=mDt/e.angledSplitBias,E=e.fovY*c*2;if(x*(this._edgeLen/E)<S*e.relativeHeightLimit)return Gt.NONE}}return Gt.SPLIT}setChildren(e,i,r,s){jg(!!(e&&i&&r&&s),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of yT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of yT){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Tu&&(B4(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Gt.GEOMETRY),this.resetPendingUpdate(Gt.TEXTURE_NOFADING),this.resetPendingUpdate(Gt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Di.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Tu&&(B4(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(p2(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;b(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Gt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of yT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Tu&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Gt.SPLIT)||e!==Di.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Gt.SPLIT||e===Gt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),r.dataArrived(this),!0;if(s.requestPromise)return!0;lu(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Ll(be(Ta,this._center[jn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;jg(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const s=this.layerInfo[i][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i){switch(e){case Di.MAP:return this._updateTexture(i);case Di.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===go.FADING?Gt.TEXTURE_NOFADING:Gt.TEXTURE_FADING),this.setPendingUpdate(e===go.FADING?Gt.TEXTURE_FADING:Gt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Gt.GEOMETRY);for(const e of this.layerInfo[Di.ELEVATION])e.pendingUpdates|=Gt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];Vt(e,1/0,-1/0);const s=this.layerInfo[Di.ELEVATION];let n=!0;for(const o of s)b(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;pe(Ta,this.up,i),we(r[jn.MIDDLE],this.centerAtSeaLevel,Ta),pe(Ta,this.up,e[0]),we(r[jn.TOP],this.centerAtSeaLevel,Ta),pe(Ta,this.up,e[1]),we(r[jn.BOTTOM],this.centerAtSeaLevel,Ta)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Di.ELEVATION][e],s=ZZ(this.level),n=Math.max(this.vlevel-s,0),o=r.elevationBounds;if(b(o)&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Di.ELEVATION),l=eQ(a);if(!o$(this,l,!1))return;const c=yDt;let h=!1;const d=r.data;if(d&&d.level<=n){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,g=0;for(let y=this._parent;y&&(!m||g<s)&&(g=this.vlevel-y.level,f=m||f,m=y.layerInfo[Di.ELEVATION][e].data,!(!m&&f&&y.level<=n));y=y.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(A(r.elevationBounds)&&(r.elevationBounds=new $M),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Tu&&(B4(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:m8.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,go.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Tu&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of yT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Tu&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Tu&&this.updateRenderData(e,go.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Tu&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Tu,!r.data&&A(r.upsampleInfo)&&this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||CA(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(tk(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||CA((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=eQ(l);if(o.loadingAgent?o$(this,c,!1)?(o.loadingAgent!==Tu&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Tu&&(a=o.loadingAgent.update())):o.dispose():o$(this,c,!1)&&(o.loadingAgent=gDt(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Tu&&this.setPendingUpdate(Gt.GEOMETRY):(B4(o.loadingAgent),o.loadingAgent=Tu)),o.loadingAgent===Tu&&this.updateRenderData(i,go.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.vlevel-this.level,r=Math.max(this.level-e,ZZ(this.level)-i),s=Se(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(b(r)){for(const s of r)if(_Dt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this.lij,s=this.getNeighborLIJ(r,e);return s?vDt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===Ht.NORTH_EAST?1:e===Ht.NORTH_WEST?0:e===Ht.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(rQ(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Ht.NORTH?[0,1]:e===Ht.NORTH_EAST?[1]:e===Ht.EAST?[1,3]:e===Ht.SOUTH_EAST?[3]:e===Ht.SOUTH?[2,3]:e===Ht.SOUTH_WEST?[2]:e===Ht.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){rk.forEach(i=>this.findNeighborCornerTileExact(i,e)),sy.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||e(s)))==null?void 0:r.forAllSubtreeOnSide(ik(i),e)})}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(ke(!So||r>=0),r===0)return 0;const s=2**r,n=(1&e)==1,o=n?0:1,a=i.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return So&&(ke(a<=l&&l<a+s),ke(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;sy.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(ik(s),o=>!!o.isLoaded&&(e(o,s),!0))}),rk.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(rQ(s),a=>a.isLoaded);ke(!n||lQ(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=zye(i)?-1:Vye(i)?1:0,s=Uye(i)?-1:kye(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+ul()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;Q9&&(ke(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(zye(e)&&i[3]+s>=r[3]||Vye(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Uye(e)&&i[0]-s<=r[0])&&!(!n&&kye(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ge(this._lastPOI,e);const r=this._center[jn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}};function gDt(t,e,i,r){const s=i===Di.ELEVATION?jne.acquire():Gne.acquire();return s.init(t,e,i,r),s}function B4(t){t.dispose(),t instanceof KNe?jne.release(t):t instanceof QNe&&Gne.release(t)}const Gne=new pa(QNe),jne=new pa(KNe),yDt=new $M;var jn;function _Dt(t,e){const i=t.level,r=e[0];if(i>r)return!1;const s=r-i,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function vDt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function bDt(t,e,i){if(A(t)||A(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Ht.EAST||t.isWestEnd&&e.isEastEnd&&i===Ht.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Ht.NORTH:return vp(t.extent[3],e.extent[1],r);case Ht.SOUTH:return vp(t.extent[1],e.extent[3],r);case Ht.EAST:return vp(t.extent[2],e.extent[0],r)||vp(t.extent[2],-e.extent[0],r);case Ht.WEST:return vp(t.extent[0],e.extent[2],r)||vp(t.extent[0],-e.extent[2],r)}}function lQ(t,e,i){return!A(t)&&!A(e)&&e!==t&&(t.level>=e.level?i0e(t,e,i):i0e(e,t,rQ(i)))}function i0e(t,e,i){ke(t.level>=e.level);const r=F$t(i),s=U$t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=vp(a[0],l[0],c)||t.surface.isGlobal&&vp(a[0],-l[0],c),d=vp(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return ke(!1),!1;const f=h?r0e(o[1],o[3],n[1],n[3],c):r0e(o[0],o[2],n[0],n[2],c);return ke(f),f}function r0e(t,e,i,r,s=ul()){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(jn||(jn={}));let wDt=class{constructor(){this._scales=di(-1,-1,-1,-1),this._offsets=di(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function xDt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Hne=class extends GLe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=$(),this.origin=this.slicePlaneLocalOrigin}};var Ku;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Ku||(Ku={}));let TDt=class extends Hne{constructor(){super(...arguments),this.identifier=Ku.Material,this.output=H.Color,this.transparent=!1,this.integratedMesh=!1}},SDt=class extends Hne{constructor(){super(...arguments),this.identifier=Ku.ShadowMap}},EDt=class extends Hne{constructor(){super(...arguments),this.identifier=Ku.Highlight}},sk=class extends dn{constructor(e,i){super(e,"vec4",Vr.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}};var P_;function CDt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add([new sk("overlayTexOffset",(s,n)=>MDt(s,n)),new sk("overlayTexScale",(s,n)=>ADt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Yt("ovColorTex",(s,n)=>cQ(s,n))),rFe(t,e)}function rFe(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==Ot.Water&&e.pbrMode!==Ot.WaterOnIntegratedMesh&&e.pbrMode!==Ot.TerrainWithWater||t.include(YLe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(T`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Pp(e,"ovColorTex")};

          vec4 color0 = ${_c(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${_c(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==Ot.Water&&e.pbrMode!==Ot.WaterOnIntegratedMesh&&e.pbrMode!==Ot.TerrainWithWater||(nv(r),Uy(r),r.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function cQ(t,e){return e.overlays.length===0?null:t.identifier===Ku.Material&&t.output===H.Color?e.overlays[ks.INNER].getColorTextureNoRasterImage():t.identifier===Ku.Material&&t.output===H.ObjectAndLayerIdColor?e.overlays[ks.INNER].getColorTexture(Kc.ObjectAndLayerIdColor):t.identifier===Ku.Highlight?e.overlays[ks.INNER].getValidTexture(an.Highlight):null}function MDt(t,e){for(const i of e.overlays){const{index:r,extent:s}=i;qxe(s)>0&&(dA[2*r]=t.toMapSpace[0]/od(s)-s[0]/od(s),dA[2*r+1]=t.toMapSpace[1]/Om(s)-s[1]/Om(s))}return dA}function ADt(t,e){for(const i of e.overlays){const{index:r,extent:s}=i;qxe(s)>0&&(dA[2*r]=t.toMapSpace[2]/od(s),dA[2*r+1]=t.toMapSpace[3]/Om(s))}return dA}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(P_||(P_={}));const dA=Ai();var ny;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(ny||(ny={}));let ODt=class extends Br{constructor(){super(...arguments),this.overlayOpacity=1}};function xR(t,e){t.vertex.uniforms.add([new nk("overlayTexOffset"),new nk("overlayTexScale")]),t.fragment.uniforms.add([new Be("overlayOpacity",i=>i.overlayOpacity),new Yt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[ks.INNER].getColorTexture(i.overlaySource))]),rFe(t,e)}function RDt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new nk("texOffsetAndScale")),r.uniforms.add(new s0e("tex")),r.uniforms.add(new vH("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new nk("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new s0e("texNext")),r.uniforms.add(new vH("nextTexOpacities")),r.uniforms.add(new PDt("fadeFactor")));const o=e.tileBlendInput===ny.ColorComposite,a=e.tileBlendInput===ny.GridComposite;a&&r.include(zne),o&&r.uniforms.add(new vH("backgroundColor")),i.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),r.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),n?r.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(T`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let PDt=class extends dn{constructor(e){super(e,"float")}},vH=class extends dn{constructor(e){super(e,"vec3")}},nk=class extends dn{constructor(e){super(e,"vec4")}},s0e=class extends dn{constructor(e){super(e,"sampler2D")}},sFe=class extends ODt{};function IDt(t){const e=new ar,{vertex:i,fragment:r,varyings:s}=e;e.include(ED),e.include(FD,t),e.include(gy,t);const n=()=>{e.include(mL,t),i.code.add(T`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?T`decodeNormalTerrain(normalCompressed)`:T`getLocalUp(position, localOrigin)`};
      }
  `)};ah(i,t),e.include(au,t);const o=t.overlayMode!==P_.Disabled;switch(t.output){case H.Color:{e.include(RDt,t),e.include(uS,t),o&&e.include(xR,{...t,pbrMode:t.pbrMode===Ot.Terrain?Ot.TerrainWithWater:Ot.Water});const a=t.overlayMode===P_.EnabledWithWater;a&&e.include(xDt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(t.atmosphere||t.screenSizePerspective)&&o3(i);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(X3,t),t.atmosphere&&s.add("wnormal","vec3"),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?T`forwardVertexTangent(vnormal);`:T``}

          ${t.atmosphere?T`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?T`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(Un,t),e.include(uS,t),e.include(kD,t),e.include(cS,t),$m(r,t),VD(r),oO(r),r.uniforms.add([i.uniforms.get("localOrigin"),new fi("viewDirection",(c,h)=>Re(n0e,fe(n0e,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&r.uniforms.add([new Yt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[ks.INNER].getNormalTexture(c.overlaySource)),new HIe("view",(c,h)=>fu($Dt,h.camera.viewMatrix,c.origin))]),r.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),nv(r),Uy(r),r.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?T`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?T`atm + tileColor.rgb;`:T`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Ot.Terrain||t.pbrMode===Ot.TerrainWithWater?T`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case H.Depth:o&&e.include(xR,t),e.include(X_,t),ow(e),rS(e),i.code.add(T`
              void main(void) {
                ${o?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(T`
              void main() {
                ${o&&t.invisible?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case H.Shadow:case H.ShadowHighlight:case H.ShadowExcludeHighlight:e.include(X_,t),ow(e),rS(e),i.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case H.Normal:o&&e.include(xR,t),s.add("vnormal","vec3"),o3(i),n(),i.code.add(T`
            void main(void) {
              ${o?T`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(T`
            void main() {
              ${o&&t.invisible?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case H.Highlight:o&&e.include(xR,t),i.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(pv,t),r.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===H.ObjectAndLayerIdColor&&(e.include(xR,{...t,pbrMode:Ot.Disabled}),i.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(T`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const $Dt=Ge(),n0e=$(),LDt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:sFe,build:IDt},Symbol.toStringTag,{value:"Module"}));let nFe=class oFe extends dr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global}initializeProgram(e){return new cr(e.rctx,oFe.shader.get().build(this.configuration),aFe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return si({blending:i.renderOccluded?Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA):null,culling:r?zre:null,depthTest:i.renderOccluded?null:{func:hs.LESS},depthWrite:i.renderOccluded?null:gu,colorWrite:wi,stencilTest:e?kCt(uu.IntegratedMeshMaskExcluded):null})}getPipelineState(e,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,i)}};nFe.shader=new lr(LDt,()=>se(()=>import("./Terrain.glsl-4e2ae601.js"),[]));const aFe=new Map([[P.POSITION,0],[P.UV0,1],[P.NORMALCOMPRESSED,2]]);let DDt=class{constructor(){this.geometryInfo=new RLt,this.intersectionData=null,this.geometryState=null,this._textureRef=new YNe(()=>this.tile.surface.textureFadeDuration),this.overlay=new wDt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,ls(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new FLt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),So&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)ke(this.geometryInfo.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(b(c)&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=sy[e];if(!i)return ke(A((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,h=c.renderData.geometryState,d=n-c.level;if(ke(d>=0),d===0){const g=h.numVerticesPerSide-1;return Math.max(g,s)}const f=2**d,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}ke(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(ik(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(ke(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(sy[l],r),h=HT(e,c),d=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=s[l],m=h!==HT(e,f),g=n[l]!==d;s[l]=c,(m||g)&&(n[l]=d,this._markEdgeDirty(l));const y=i.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);ke(Cm(v)),ke(v>=1),i.edgeResolutions[l]=v,y!==v&&this._markEdgeResolutionDirty(l)}const o=i.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(rk[l],r);o[l]=c;const h=HT(e,s[l]),d=HT(e,s[(l+1)%4]),f=HT(e,c);ff[l]=f,ff[(l+1)%4]=d,ff[(l+2)%4]=e,ff[(l+3)%4]=h,ke(ff.some(v=>(v==null?void 0:v.isLoaded)||v===e));const m=ff.reduce((v,x)=>Math.min(v,(x==null?void 0:x.level)??1/0),1/0);ff.forEach((v,x)=>{v&&(v==null?void 0:v.level)>m&&(ff[x]=null)}),ke(ff.some(v=>(v==null?void 0:v.isLoaded)||v===e));const g=i.cornerNeighborData[l].cornerTiles,y=i.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const x=ff[v],S=(x==null?void 0:x.renderData.geometryState.samplerDataVersion)??-1,E=g[v]!==x,C=!E&&y[v]!==S;(E||C)&&(g[v]=x,y[v]=S,this._markCornerDirty(l))}ke(g.some(v=>(v==null?void 0:v.isLoaded)||v===e))}So&&ke(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)ff[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;So&&ke(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,s=this.geometryInfo.vertexAttributes,n=!r||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,$Lt(this.geometryInfo),!0)}ensureTexture(e,i){return b(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),A(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){b(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._dirtyEdges|=i}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),L_(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=i.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=e.gl;this._vao=new km(e,aFe,{geometry:vh(i.layout)},{geometry:yr.createVertex(e,s.STATIC_DRAW,i.buffer)},yr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=O_.Immediate){b(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Di.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let h=0;h<r;h++){const d=i[h];if(b(d.upsampleInfo)){const f=d.upsampleInfo.tile,m=f.layerInfo[Di.ELEVATION][h].data,g=m&&m.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(h,Di.ELEVATION);if(o$(this.tile,f.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}b(e)&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r;const e=id(this.intersectionData,0,s=>s.estimatedMemoryUsage);return(((i=this.geometryInfo.indices)==null?void 0:i.byteLength)??0)+(((r=this.geometryInfo.vertexAttributes)==null?void 0:r.byteLength)??0)+e}get textureDescriptor(){return b(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!So)return;const e=this.tile;if(ke(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const i=e.renderData;if(e.level===0)return;const r=e.surface.extent;if(b(r)&&!e.intersectsExtent(r))return;const s=sy.map((l,c)=>!!b(r)&&(c<2?-1:1)*(e.extent[3-c]-r[3-c])<0),n=e.level;ke(this._dirtyCorners===0),ke(this._dirtyEdges===0),ke(this._dirtyEdgeResolutions===0),ke(!this._numVerticesPerSideChanged),ke(!this._samplerDataChanged),ke(!this._clippingAreaChanged),ke(!this._wireframeChanged);const o=rk.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];ke(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}sy.forEach((l,c)=>{if(s[c])return;const h=e.findNeighborTile(l,V=>(V.level===n||(V==null?void 0:V.isLoaded))&&(V==null?void 0:V.intersectsClippingArea));if(!h){const V=!e.surface.updatingRootTiles&&b(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void ke(!V)}ke(h.isLoaded||h.level===e.level),ke(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const d=n-h.level;if(!h.isLoaded)return ke(!h.isLeaf),void ke(d===0);const f=h.renderData;ke(bDt(e,h,l)),ke(d>=0);const m=2**d;if(d<0)return void ke(!1);const g=i.geometryInfo,y=g.outerEdges[c],v=g.numVerticesPerSide-1,x=f.geometryInfo;if(!x)return void ke(!1);{const V=this.geometryState.neighborData.edgePeerNeighbors[c];if(V!=null&&V.isLoaded){const k=V.renderData;ke(V==V),ke(i.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===k.geometryState.samplerDataVersion),ke(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===k.geometryState.samplerDataVersion)}}const S=(c+2)%4,E=x.outerEdges[S],C=y.count-1,R=E.count-1;ke(C*m===R,`Tile[${e.lij}]:e${c},res=${C} edgeRes mismatch with Neighbor[${h.lij}]:e${S},res=${R} (expected:${C*m})`);const O=e.extent,U=l===Ht.NORTH||l===Ht.SOUTH,L=E.count-1,B=L/2**d,G=y.count-1;if(B<1)return void ke(G===1);ke(B===G),ke(Cm(B));const j=x.numVerticesPerSide-1;ke(d>0||B===Math.max(j,v));const q=e.getNeighborEdgeStartVertexIndex(c,h);ke(0<=q&&q<m);const ie=q*B;ke(0<=ie&&ie<=L-B);let ee=0,K=ie;y.getVertexPos(cg,0),y.getVertexPos(ug,y.count-1);const Y=Wr(cg,ug),D=Math.max(NDt,1e-4*Y);for(let V=0;V<=B;++V){y.getVertexPos(cg,ee),E.getVertexPos(ug,K);const k=V/B,Z=U?O[0]+k*(O[2]-O[0]):l===Ht.WEST?O[0]:O[2],Q=U?l===Ht.SOUTH?O[1]:O[3]:O[1]+k*(O[3]-O[1]),ne=e.surface.extent;if(A(ne)||Zk(ne,Z,Q)){const te=WL(cg,ug),de=Bu(cg)-zi.radius,_e=Bu(ug)-zi.radius,Ce=te<D;if(!Ce){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${ee}/${y.count}] and [${h.lij}].edge${S}[${K}/${E.count}]`),b(ne)&&console.warn("  surface extent= ",ne," x,y=",Z,",",Q);const Pe=$();be(Pe,i.localOrigin,f.localOrigin),Bu(Pe)>0&&console.warn(`   localOrigins: ${i.localOrigin} vs ${f.localOrigin} d=${Bu(Pe)} [${Pe}]`),(()=>{const Ze=zr(cg),Le=zr(ug);e.updateEdgeElevations(),h.updateEdgeElevations(),y.getVertexPos(cg,ee),E.getVertexPos(ug,K);const Me=$();as(Me,cg,Ze),Bu(Me)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ze} vs ${cg} d=${Bu(Me)} [${Me}]`),as(Me,ug,Le),Bu(Me)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${Le} vs ${ug} d=${Bu(Me)} [${Me}]`)})(),ke(Ce,`Mismatch in tile [${e.lij}].edge[${c}][${ee}/${y.count}] vs neighbor [${h.lij}].edge[${S}][${K}/${E.count}] ${p0(cg)} vs ${p0(ug)}  dist=${te} h(t|n|d)=${de}|${_e}|${_e-de}`)}if(e.surface.shading){y.getNormal(kE,ee),E.getNormal(VE,K),Re(o0e,kE),Re(a0e,VE);const Pe=xe(o0e,a0e),Ze=1-Pe<.01||!1||e===h;if(!Ze){const Le=$();as(Le,kE,VE);const Me=()=>`Mismatch in tile edge normal ${Fye(e.lij)} (${ee}/${y.count-1}) edge ${c} vs neighbor ${Fye(h.lij)}  (${K}/${E.count-1}) nedge ${S} :${p0(kE)} vs ${p0(VE)}  dot = ${Pe} : ${p0(Le)}`;console.warn("Mismatch in tile edge normal: ",Me());{e.updateEdgeElevations(),h.updateEdgeElevations();const qe=$(),We=$();y.getNormal(qe,ee),E.getNormal(We,K),Bb(kE,qe)||console.warn("Missing update in tile normal: ",p0(kE)," => ",p0(qe)),Bb(VE,We)||console.warn("Missing update in neighbor normal: ",p0(VE)," => ",p0(We))}ke(Ze,Me())}}}ee+=1,K+=1}})}};const cg=$(),ug=$(),kE=$(),VE=$(),o0e=$(),a0e=$(),NDt=1,ff=[null,null,null,null];function HT(t,e){return e!=null&&e.isLoaded||e===t?e:null}const FDt=65536;function UDt(t,e){const i=t.tile,{extent:r,extentInRadians:s,surface:n}=i,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=n.shading||pS,h=a.numVerticesPerSide,d=h-1,f=(h-2)**2,m=l&&(e===_p.HAS_SOUTH_POLE||e===_p.HAS_BOTH_POLES),g=l&&(e===_p.HAS_NORTH_POLE||e===_p.HAS_BOTH_POLES),y=6,v=((m?1:0)+(g?1:0))*y*(d+1),x=a.neighborData,S=x.edgeResolutions.reduce((L,B)=>L+B+1,0),E=WNe(f+v+S),C=t.geometryInfo;C.numVerticesPerSide=a.numVerticesPerSide,C.vertexAttributes=E;const R=C.boundingBox;ls(R);const O=qne(t);Qn.update(d,s,O),kDt(t),gFe(t,f),lFe(t);const U=[];if((()=>{let L=f+S;const B=o[0],G=o[1],j=o[2],q=i.ellipsoid.radius,ie=r[1],ee=r[3],K=(Y,D)=>{const V=D*h;wc(-B,-G,Y*q-j,R),U.push({connectedRowOffset:V,connectedOuterEdgeOffset:Y===1?0:2,rowOffset:L,latitudeResolution:y});const k=hFe(Y===-1?ie:ee,q),Z=Y*Math.PI/2-k,Q=.99*(Y===1?1:-1),ne=q+0,te=E.position,de=E.uv0,_e=E.normalCompressed;for(let Ce=1;Ce<=y;++Ce){const Pe=k+Z*(Ce/y),Ze=Math.cos(Pe),Le=Math.sin(Pe);for(let Me=0;Me<=d;Me++){const qe=Me/d,We=Qn.sinLonLUT[Me],$t=Qn.cosLonLUT[Me]*Ze,ut=We*Ze,Qt=Le,ai=$t*ne-B,ui=ut*ne-G,li=Qt*ne-j;wc(ai,ui,li,R),te.setValues(L,ai,ui,li),lh(de,L,qe,Q),c&&xL(_e,L,$t,ut,Qt),++L}}};m&&K(-1,0),g&&K(1,d)})(),mFe(C,a.numVerticesPerSide,U,[0,h-1],[0,h-1],a.wireframe),t.intersectionData=null,So)for(let L=0;L<4;++L)ke(C.outerEdges[L].count===x.edgeResolutions[L]+1)}function kDt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||pS?zDt(t):VDt(t))}function VDt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,s=i-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,h=c.extent,d=h[0],f=h[2],m=h[1],g=h[3],y=c.ellipsoid.radius,v=e.samplerData,x=t.localOrigin,S=x[0],E=x[1],C=x[2],R=n.boundingBox,O=a.typedBuffer,U=a.typedBufferStride;let L=0;for(let B=1;B<=r;B++){const G=B/s,j=m*(1-G)+g*G,q=Qn.sinLatLUT[B],ie=Qn.cosLatLUT[B];for(let ee=1;ee<=r;ee++){const K=ee/s,Y=d*(1-K)+f*K,D=Qn.sinLonLUT[ee],V=Qn.cosLonLUT[ee],k=y+Rs(Y,j,v),Z=V*ie*k-S,Q=D*ie*k-E,ne=q*k-C;wc(Z,Q,ne,R);const te=L*U;O[te]=Z,O[te+1]=Q,O[te+2]=ne,lh(l,L,K,G),++L}}}function zDt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,s=i-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=t.tile,d=h.extent,f=d[0],m=d[2],g=d[1],y=d[3],v=h.ellipsoid.radius,x=e.samplerData,S=t.localOrigin,E=S[0],C=S[1],R=S[2],O=a.typedBuffer,U=a.typedBufferStride,L=1/s,B=n.boundingBox;let G=0;if(1<=r){const j=L,q=g*(1-j)+y*j,ie=Qn.sinLatLUT[1],ee=Qn.cosLatLUT[1];for(let K=1;K<=r;K++){const Y=K*L,D=f*(1-Y)+m*Y,V=Qn.sinLonLUT[K],k=Qn.cosLonLUT[K],Z=v+Rs(D,q,x),Q=Z*k*ee-E,ne=Z*V*ee-C,te=Z*ie-R;wc(Q,ne,te,B);const de=(K-1)*U;O[de]=Q,O[de+1]=ne,O[de+2]=te,lh(l,K-1,Y,j)}}for(let j=1;j<=r;j++){const q=j*L,ie=g*(1-q)+y*q,ee=Qn.sinLatLUT[j],K=Qn.cosLatLUT[j],Y=j+1,D=Y*L,V=g*(1-D)+y*D,k=Qn.sinLatLUT[Y],Z=Qn.cosLatLUT[Y],Q=Qn.sinLonLUT[0],ne=Qn.cosLonLUT[0],te=v+Rs(f,ie,x);let de=ne*K*te-E,_e=Q*K*te-C,Ce=ee*te-R;const Pe=G*U;let Ze=O[Pe],Le=O[Pe+1],Me=O[Pe+2];for(let qe=1;qe<=r;qe++){const We=qe*L,$t=f*(1-We)+m*We,ut=Qn.sinLonLUT[qe],Qt=Qn.cosLonLUT[qe];let ai=Qt*K,ui=ut*K,li=ee,Ri=0,pr=0,Gi=0;{let pt=0,lt=0,wt=0;if(qe<r){const qi=(G+1)*U;pt=O[qi],lt=O[qi+1],wt=O[qi+2]}else{const qi=Qn.sinLonLUT[s],Wi=Qn.cosLonLUT[s],Yi=v+Rs(m,ie,x);pt=Wi*K*Yi-E,lt=qi*K*Yi-C,wt=ee*Yi-R}const Tt=de,Lt=_e,oi=Ce;de=Ze,_e=Le,Ce=Me,Ze=pt,Le=lt,Me=wt,Ri=pt-Tt,pr=lt-Lt,Gi=wt-oi}{let pt=0,lt=0,wt=0;if(j>1){const Tt=(G-r)*U;pt=O[Tt],lt=O[Tt+1],wt=O[Tt+2]}else{const Tt=Qn.sinLatLUT[0],Lt=Qn.cosLatLUT[0],oi=v+Rs($t,g,x);pt=Qt*Lt*oi-E,lt=ut*Lt*oi-C,wt=Tt*oi-R}{const Tt=v+Rs($t,V,x),Lt=Qt*Z*Tt-E,oi=ut*Z*Tt-C,qi=k*Tt-R;if(j<r){const Gr=G+r,mi=Gr*U;O[mi]=Lt,O[mi+1]=oi,O[mi+2]=qi,wc(Lt,oi,qi,B),lh(l,Gr,We,D)}const Wi=pt-Lt,Yi=lt-oi,Xi=wt-qi;li*li<.999&&(ai=Gi*Yi-pr*Xi,ui=Ri*Xi-Gi*Wi,li=pr*Wi-Ri*Yi)}}const Fi=1/Math.sqrt(ai*ai+ui*ui+li*li);xL(c,G,ai*Fi,ui*Fi,li*Fi),++G}}}function BDt(t){t.tile.intersectsClippingArea&&(lFe(t),Zz(t))}function GDt(t){t.tile.intersectsClippingArea&&(uFe(t),cFe(t,!0),Zz(t))}function lFe(t){t.tile.intersectsClippingArea&&(uFe(t),cFe(t))}function cFe(t,e=!1){const i=t.geometryState,r=t.geometryInfo,s=i.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],d=c[2],f=c[1],m=c[3],g=i.samplerData,y=a[0],v=a[2],x=a[1],S=a[3],E=qne(t),C=r.boundingBox,R=t.localOrigin,O=R[0],U=R[1],L=R[2],B=n.surface.shading||pS,G=r.vertexAttributes,j=G.position,q=j.typedBuffer,ie=j.typedBufferStride,ee=G.uv0;for(let K=0;K<4;++K){const Y=K===1||K===3,D=s.edgeResolutions[K];ke(Cm(D));const V=D+1,k=HT(n,s.edgePeerNeighbors[K]);if(vFe(n,k,K)){yFe(t,K,k);continue}const Z=b(k);ke(!Z||k.level===n.level),ke(!Z||R_(n,k)<=0);const Q=k==null?void 0:k.renderData,ne=Q==null?void 0:Q.geometryState;if(So){const lt=n.surface;if(!k&&lt&&!lt.updatingRootTiles){const wt=sy[K],Tt=n.findNeighborTile(wt,Lt=>Lt.isLoaded||Lt.isLeaf||Lt.level===n.level);Tt?Tt.intersectsClippingArea&&(ke(!Tt.isLoaded),ke(!Tt.isLeaf),ke(Tt.level===o)):ke(A(lt==null?void 0:lt.rootTiles)||!n.shouldHaveNeighbor(wt))}}const te=K===1?a[2]:a[0],de=k==null?void 0:k.extent,_e=de&&Y?K===1?de[0]:de[2]:te,Ce=K===0?a[3]:a[1],Pe=K===1?1:0,Ze=K===0?1:0,Le=K===1?d:h,Me=K===0?m:f,qe=Math.sin(Le),We=Math.cos(Le),$t=Math.sin(Me),ut=Math.cos(Me),Qt=ne==null?void 0:ne.samplerData,ai=Z?(lt,wt,Tt)=>.5*(Rs(lt,wt,g)+Rs(Tt,wt,Qt)):(lt,wt,Tt)=>Rs(lt,wt,g),ui=r.outerEdges[K],li=e&&V>3?V-3:1,Ri=b(g)&&g.some(lt=>lt!=null),pr=b(Qt)&&Qt.some(lt=>lt!=null),Gi=Ri||pr,Fi=1/D,pt=ui.index0;B?(ke(!de||vp(de[2]-de[0],a[2]-a[0])),(()=>{const lt=K===1?-1:K===3?1:0,wt=K===0?-1:K===2?1:0,Tt=(a[2]-a[0])*Fi,Lt=lt*Tt,oi=wt*Tt,qi=Y?lt*((d-h)*Fi):0,Wi=Y?0:wt*Fi,Yi=Ze,Xi=Y?Le+qi:Le,Gr=Y?Math.sin(Xi):qe,mi=Y?Math.cos(Xi):We,Li=Y?Le-qi:Le,Pi=Y?Math.sin(Li):qe,Ws=Y?Math.cos(Li):We,vr=Y?Me:E(Yi+Wi),ds=Y?$t:Math.sin(vr),jr=Y?ut:Math.cos(vr),rs=Y?Me:E(Yi-Wi),xs=Y?$t:Math.sin(rs),rn=Y?ut:Math.cos(rs);let Oo=0,ro=0,Ys=0;{const Sr=0*Fi,Wo=Y?te:y*(1-Sr)+v*Sr,dl=Y?_e:Wo,ve=Y?x*(1-Sr)+S*Sr:Ce,Ir=Y?Le:h*(1-Sr)+d*Sr,bh=Y?qe:Math.sin(Ir),Ro=Y?We:Math.cos(Ir),pl=Y?E(Sr):Me,St=Y?Math.sin(pl):$t,Wl=Y?Math.cos(pl):ut,Ts=l+ai(Wo,ve,dl);Oo=Ro*Wl*Ts,ro=bh*Wl*Ts,Ys=St*Ts}let ss=0,ps=0,$s=0;{const Sr=1*Fi,Wo=Y?te:y*(1-Sr)+v*Sr,dl=Y?_e:Wo,ve=Y?x*(1-Sr)+S*Sr:Ce,Ir=Y?Le:h*(1-Sr)+d*Sr,bh=Y?qe:Math.sin(Ir),Ro=Y?We:Math.cos(Ir),pl=Y?E(Sr):Me,St=Y?Math.sin(pl):$t,Wl=Y?Math.cos(pl):ut,Ts=l+ai(Wo,ve,dl);ss=Ro*Wl*Ts,ps=bh*Wl*Ts,$s=St*Ts}for(let Sr=1;Sr<V-1;Sr+=li){let Wo=0,dl=0,ve=0;{const Yo=(Sr+1)*Fi,yu=Y?te:y*(1-Yo)+v*Yo,_u=Y?_e:yu,Er=Y?x*(1-Yo)+S*Yo:Ce,Ad=Y?Le:h*(1-Yo)+d*Yo,rf=Y?qe:Math.sin(Ad),yv=Y?We:Math.cos(Ad),Hy=Y?E(Yo):Me,_v=Y?Math.sin(Hy):$t,qy=Y?Math.cos(Hy):ut,Hm=l+ai(yu,Er,_u);Wo=yv*qy*Hm,dl=rf*qy*Hm,ve=_v*Hm}const Ir=Wo,bh=dl,Ro=ve,pl=ss,St=ps,Wl=$s;ss=Ir,ps=bh,$s=Ro;{const Yo=pt+Sr,yu=Yo*ie,_u=pl-O,Er=St-U,Ad=Wl-L;q[yu]=_u,q[yu+1]=Er,q[yu+2]=Ad,wc(_u,Er,Ad,C);const rf=Sr*Fi;lh(ee,Yo,Y?Pe:rf,Y?rf:Ze)}const Ts=Oo,jy=ro,dO=Ys;Oo=pl,ro=St,Ys=Wl;const fl=pl,Bm=St,Cd=Wl,hi=1/Math.sqrt(fl*fl+Bm*Bm+Cd*Cd),Mw=Cd*hi;let Md=0,Gm=0,jm=0;if(Gi&&Mw*Mw<.999){let Yo=0,yu=0,_u=0;{const Er=K===0?-1:1;Yo=Er*(Ir-Ts),yu=Er*(bh-jy),_u=Er*(Ro-dO)}{const Er=Sr*Fi,Ad=Y?te:y*(1-Er)+v*Er,rf=Y?_e:Ad,yv=Y?x*(1-Er)+S*Er:Ce,Hy=Y?Le:h*(1-Er)+d*Er,_v=Y?qe:Math.sin(Hy),qy=Y?We:Math.cos(Hy),Hm=Y?E(Er):Me,ml=Y?Math.sin(Hm):$t,US=Y?Math.cos(Hm):ut;let Aw=fl,re=Bm,Oe=Cd;if(Z){const Fe=l+Rs(rf-Lt,yv-oi,Qt),Ei=Y?US:rn;Aw=(Y?Ws:qy)*Ei*Fe,re=(Y?Pi:_v)*Ei*Fe,Oe=(Y?ml:xs)*Fe}{const Fe=l+Rs(Ad+Lt,yv+oi,g),Ei=Y?US:jr,so=(Y?mi:qy)*Ei*Fe,Xs=(Y?Gr:_v)*Ei*Fe,gl=(Y?ml:ds)*Fe;Z||(Aw=2*fl-so,re=2*Bm-Xs,Oe=2*Cd-gl);const qm=K===3?-1:1,WD=qm*(Aw-so),YD=qm*(re-Xs),XD=qm*(Oe-gl);Md=_u*YD-yu*XD,Gm=Yo*XD-_u*WD,jm=yu*WD-Yo*YD;const pO=1/Math.sqrt(Md*Md+Gm*Gm+jm*jm);Md*=pO,Gm*=pO,jm*=pO}}}else Md=fl*hi,Gm=Bm*hi,jm=Cd*hi;ui.setNormalFromValues(Sr,Md,Gm,jm)}})()):(()=>{for(let lt=1;lt<V-1;lt+=li){const wt=lt*Fi,Tt=Y?Pe:wt,Lt=Y?wt:Ze,oi=Y?te:y*(1-wt)+v*wt,qi=Y?x*(1-wt)+S*wt:Ce,Wi=Y?_e:oi,Yi=Y?Le:h*(1-wt)+d*wt,Xi=Y?qe:Math.sin(Yi),Gr=Y?We:Math.cos(Yi),mi=Y?E(wt):Me,Li=Y?Math.sin(mi):$t,Pi=Y?Math.cos(mi):ut,Ws=ai(oi,qi,Wi),vr=l+Ws,ds=Gr*Pi*vr-O,jr=Xi*Pi*vr-U,rs=Li*vr-L;wc(ds,jr,rs,C);const xs=pt+lt,rn=xs*ie;q[rn]=ds,q[rn+1]=jr,q[rn+2]=rs,lh(ee,xs,Tt,Lt)}})()}}function uFe(t){_Fe(t)}function hFe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function jDt(t,e,i,r){return hFe(t*(1-r)+e*r,i)}function HDt(t,e,i){return t*(1-i)+e*i}function qne(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>jDt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>HDt(i[1],i[3],r)}function qDt(t,e){const i=t.tile.extent,r=t.geometryState,s=i[0],n=i[1],o=i[2]-s,a=i[3]-n,l=r.clippingArea,c=b(l)?Math.max(0,(l[0]-s)/o):0,h=b(l)?Math.max(0,(l[1]-n)/a):0,d=b(l)?Math.min(1,(l[2]-s)/o):1,f=b(l)?Math.min(1,(l[3]-n)/a):1,m=r.numVerticesPerSide,g=(m-2)**2,y=r.neighborData.edgeResolutions.reduce((E,C)=>E+C+1,0),v=WNe(g+y),x=t.geometryInfo,S=x.boundingBox;ls(S),x.numVerticesPerSide=r.numVerticesPerSide,x.vertexAttributes=v,Rr(x.uvRange,c,h,d,f),WDt(t),gFe(t,g),dFe(t),mFe(x,r.numVerticesPerSide,[],[0,m-1],[0,m-1],r.wireframe),t.intersectionData=null}function WDt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?XDt(t):YDt(t))}function YDt(t){const e=t.geometryState,i=e.samplerData,r=t.tile,s=r.surface,n=t.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=b(a)?a:Jz,c=r.extent,h=c[0],d=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),y=Math.min(f,l[2]),v=Math.max(d,l[1]),x=Math.min(m,l[3]),S=n[0],E=n[1],C=n[2],R=r.ellipsoid.radius,O=r.horizontalScale,U=Wne(o,R,O),L=e.numVerticesPerSide,B=L-1,G=L-2,j=t.geometryInfo,q=j.uvRange,ie=q[0],ee=q[1],K=q[2],Y=q[3],D=j.boundingBox,V=j.vertexAttributes,k=V.position,Z=V.uv0;let Q=0;for(let ne=1;ne<=G;ne++){const te=ne/B,de=Se(d*(1-te)+m*te,v,x),_e=Se(te,ee,Y),Ce=U(de)-E;for(let Pe=1;Pe<=G;Pe++){const Ze=Pe/B,Le=Se(h*(1-Ze)+f*Ze,g,y),Me=Se(Ze,ie,K),qe=Le*O-S,We=Rs(Le,de,i)-C;wc(qe,Ce,We,D),k.setValues(Q,qe,Ce,We),lh(Z,Q,Me,_e),++Q}}}function XDt(t){const e=t.tile,i=e.surface;if(!(i.shading||pS))return;const r=t.geometryState,s=r.samplerData,n=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=b(a)?a:Jz,c=e.extent,h=c[0],d=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),y=Math.min(f,l[2]),v=Math.max(d,l[1]),x=Math.min(m,l[3]),S=e.ellipsoid.radius,E=e.horizontalScale,C=r.numVerticesPerSide,R=C-1,O=C-2,U=t.geometryInfo,L=U.vertexAttributes,B=L.position,G=L.uv0,j=L.normalCompressed,q=U.uvRange,ie=q[0],ee=q[1],K=q[2],Y=q[3],D=U.boundingBox,V=n[0],k=n[1],Z=n[2],Q=B.typedBuffer,ne=B.typedBufferStride;let te=0;const de=Se(d,v,x),_e=o?(Math.PI/2-2*Math.atan(Math.exp(-de/S)))*S:de*E,Ce=1/R,Pe=Se(d*(1-Ce)+m*Ce,v,x);let Ze=_e,Le=o?(Math.PI/2-2*Math.atan(Math.exp(-Pe/S)))*S:Pe*E;for(let Me=1;Me<=O;Me++){const qe=Me/R,We=Se(d*(1-qe)+m*qe,v,x),$t=Se(qe,ee,Y),ut=Le,Qt=(Me-1)/R,ai=Se(d*(1-Qt)+m*Qt,v,x),ui=Ze,li=(Me+1)/R,Ri=Se(d*(1-li)+m*li,v,x),pr=o?(Math.PI/2-2*Math.atan(Math.exp(-Ri/S)))*S:Ri*E,Gi=Se(li,ee,Y);Ze=Le,Le=pr;const Fi=Se(h,g,y);let pt=Fi*E,lt=Rs(Fi,We,s);const wt=1/R,Tt=Se(wt,ie,K),Lt=Se(h*(1-Tt)+f*Tt,g,y);let oi=Tt,qi=Lt,Wi=Lt*E,Yi=Rs(Lt,We,s);if(Me===1){const Xi=Wi-V,Gr=Ze-k,mi=Yi-Z,Li=0*ne;Q[Li]=Xi,Q[Li+1]=Gr,Q[Li+2]=mi,wc(Xi,Gr,mi,D);const Pi=Se(wt,ie,K);lh(G,te,Pi,$t)}for(let Xi=1;Xi<=O;Xi++){const Gr=Wi,mi=Yi,Li=(Xi+1)/R,Pi=Se(Li,ie,K),Ws=Se(h*(1-Li)+f*Li,g,y),vr=qi;qi=Ws;{const Ys=te+1,ss=Ys*ne;if(Me===1||Xi===O){const ps=Ws*E,$s=Rs(Ws,We,s);if(Me===1&&Xi<O){const Sr=ps-V,Wo=ut-k,dl=$s-Z;Q[ss]=Sr,Q[ss+1]=Wo,Q[ss+2]=dl,wc(Sr,Wo,dl,D),lh(G,Ys,Pi,$t)}Wi=ps,Yi=$s}else Wi=Q[ss]+V,Yi=Q[ss+2]+Z}const ds=Wi,jr=Yi,rs=pt,xs=lt;pt=Gr,lt=mi;const rn=(te-O)*ne,Oo=Me===1?Rs(vr,ai,s):Q[rn+2]+Z,ro=Rs(vr,Ri,s);if(Me<O){const Ys=te+O,ss=Ys*ne,ps=Gr-V,$s=pr-k,Sr=ro-Z;Q[ss]=ps,Q[ss+1]=$s,Q[ss+2]=Sr,wc(ps,$s,Sr,D);const Wo=oi;oi=Pi,lh(G,Ys,Wo,Gi)}{const Ys=ds-rs,ss=ui-pr,ps=ss*(jr-xs),$s=Ys*(Oo-ro),Sr=-ss*Ys,Wo=ps*ps+$s*$s+Sr*Sr;if(Wo===0)xL(j,te,0,0,1);else{const dl=1/Math.sqrt(Wo);xL(j,te,ps*dl,$s*dl,Sr*dl)}}++te}}}function ZDt(t,e){t.tile.intersectsClippingArea&&(fFe(t),pFe(t,!0),Zz(t))}function JDt(t,e){t.tile.intersectsClippingArea&&(dFe(t),Zz(t))}function dFe(t,e){t.tile.intersectsClippingArea&&(fFe(t),pFe(t,!1))}function pFe(t,e){const i=t.geometryState,r=i.neighborData,s=t.tile,n=s.surface,o=n.shading||pS,a=s.extent,l=i.clippingArea,c=b(l)?l:Jz,h=a[0],d=a[2],f=a[1],m=a[3],g=[m>c[3],d>c[2],f<c[1],h<c[0]],y=t.geometryInfo,v=s.horizontalScale,x=Wne(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,v),S=y.boundingBox,E=y.uvRange[0],C=y.uvRange[1],R=y.uvRange[2],O=y.uvRange[3],U=Math.max(h,c[0]),L=Math.min(d,c[2]),B=Math.max(f,c[1]),G=Math.min(m,c[3]),j=t.localOrigin,q=j[0],ie=j[1],ee=j[2],K=i.samplerData;for(let Y=0;Y<4;++Y){const D=Y===1||Y===3,V=r.edgeResolutions[Y];ke(Cm(V));const k=V+1,Z=g[Y],Q=HT(s,r.edgePeerNeighbors[Y]);if(!Z&&vFe(s,Q,Y)){yFe(t,Y,Q);continue}const ne=b(Q)&&!Z,te=Q==null?void 0:Q.renderData,de=te==null?void 0:te.geometryState;if(So&&(ke(!ne||Q.level===s.level),ke(!ne||R_(s,Q)<=0),s&&!Q&&!n.updatingRootTiles)){const $t=sy[Y],ut=s.findNeighborTile($t,Qt=>Qt.isLoaded||Qt.isLeaf||Qt.level===s.level);n.updatingRootTiles||(ut?ut.intersectsClippingArea&&(ke(!ut.isLoaded),ke(!ut.isLeaf),ke(ut.level===s.level)):ke(A(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor($t)))}const _e=Se(Y===1?d:h,U,L),Ce=Se(Y===0?m:f,B,G),Pe=de==null?void 0:de.samplerData,Ze=y.outerEdges[Y],Le=e&&k>3?k-3:1,Me=Se(Y===1?1:0,E,R),qe=Se(Y===0?1:0,C,O),We=ne?($t,ut)=>.5*(Rs($t,ut,Pe)+Rs($t,ut,K)):($t,ut)=>Rs($t,ut,K);if(o){const $t=(d-h)/V,ut=D?Y===1?$t:-$t:0,Qt=D?0:Y===0?$t:-$t,ai=-ut,ui=-Qt;let li=0,Ri=0,pr=0;{const lt=0/V,wt=D?_e:Se(h*(1-lt)+d*lt,U,L),Tt=D?Se(f*(1-lt)+m*lt,B,G):Ce,Lt=We(wt,Tt);li=wt*v,Ri=x(Tt),pr=Lt}let Gi=0,Fi=0,pt=0;{const lt=1/V,wt=D?_e:Se(h*(1-lt)+d*lt,U,L),Tt=D?Se(f*(1-lt)+m*lt,B,G):Ce,Lt=We(wt,Tt);Gi=wt*v,Fi=x(Tt),pt=Lt}for(let lt=1;lt<k-1;lt+=Le){const wt=lt/V,Tt=Gi,Lt=Fi,oi=pt;{const vr=D?Me:Se(wt,E,R),ds=D?Se(wt,C,O):qe,jr=Tt-q,rs=Lt-ie,xs=oi-ee;wc(Tt,rs,xs,S),Ze.setVertexFromValuesRawPositionUV(lt,jr,rs,xs,vr,ds)}{const vr=(lt+1)/V,ds=D?_e:Se(h*(1-vr)+d*vr,U,L),jr=D?Se(f*(1-vr)+m*vr,B,G):Ce,rs=We(ds,jr);Gi=ds*v,Fi=x(jr),pt=rs}const qi=Gi,Wi=pt,Yi=li,Xi=Ri,Gr=pr;li=Tt,Ri=Lt,pr=oi;let mi=0,Li=0,Pi=0;if(D){const vr=Fi-Lt,ds=Wi-oi,jr=Xi-Lt,rs=Gr-oi,xs=Se(f*(1-wt)+m*wt,B,G),rn=_e+ai,Oo=rn*v-Tt,ro=Rs(rn,xs,K)-oi,Ys=Y===3?-1:1;if(mi=Ys*(-jr+vr)*ro,Li=Ys*Oo*(-rs+ds),Pi=-Ys*Oo*(-jr+vr),ne){const ss=_e+ut,ps=ss*v-Tt;mi=(-jr+vr)*(ro-(Rs(ss,xs,Pe)-oi)),Li=(Oo-ps)*(-rs+ds),Pi=-(Oo-ps)*(-jr+vr)}}else{const vr=qi-Tt,ds=Wi-oi,jr=Yi-Tt,rs=Gr-oi,xs=Se(h*(1-wt)+d*wt,U,L),rn=Ce+ui,Oo=Rs(xs,rn,K)-oi,ro=x(rn)-Lt,Ys=Y===2?-1:1;if(mi=Ys*ro*(-rs+ds),Li=Ys*(-jr+vr)*Oo,Pi=-Ys*ro*(-jr+vr),ne){const ss=xs,ps=Ce+Qt,$s=x(ps)-Lt;mi=(-ro+$s)*(-rs+ds),Li=(-jr+vr)*(-Oo+(Rs(ss,ps,Pe)-oi)),Pi=-(-ro+$s)*(-jr+vr)}}const Ws=1/Math.sqrt(mi*mi+Li*Li+Pi*Pi);Ze.setNormalFromValues(lt,mi*Ws,Li*Ws,Pi*Ws)}}else for(let $t=1;$t<k-1;$t+=Le){const ut=$t/V,Qt=D?_e:Se(h*(1-ut)+d*ut,U,L),ai=D?Se(f*(1-ut)+m*ut,B,G):Ce,ui=D?Me:Se(ut,E,R),li=D?Se(ut,C,O):qe,Ri=We(Qt,ai),pr=Qt*v-q,Gi=x(ai)-ie,Fi=Ri-ee;wc(pr,Gi,Fi,S),Ze.setVertexFromValuesRawPositionUV($t,pr,Gi,Fi,ui,li)}}}function fFe(t,e){_Fe(t)}function KDt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function QDt(t,e){return t*e}function Wne(t,e,i){return t?r=>KDt(r,e):r=>QDt(r,i)}function mFe(t,e,i,r,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=sy.map((E,C)=>C===0&&s[1]<e-2||C===1&&r[1]<e-2||C===2&&s[0]>1||C===3&&r[0]>1),h=t.outerEdges.reduce((E,C,R)=>E+(c[R]?0:o-2+C.count-1),0),d=i.reduce((E,C)=>E+o*(2*(C.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+d)*f,g=a>=FDt?new Uint32Array(m):new Uint16Array(m);let y=0;const v=e-2,x=o-2;ke(x>=0);const S=(E,C,R,O,U,L)=>{const B=E*U,G=L[B],j=L[B+1],q=L[B+2],ie=C*U,ee=L[ie],K=L[ie+1],Y=L[ie+2],D=R*U,V=L[D],k=L[D+1],Z=L[D+2],Q=O*U,ne=L[Q],te=L[Q+1],de=L[Q+2];return(ee-ne)*(ee-ne)+(K-te)*(K-te)+(Y-de)*(Y-de)>(G-V)*(G-V)+(j-k)*(j-k)+(q-Z)*(q-Z)};if(n){const E=(R,O,U)=>{g[y++]=R,g[y++]=O,g[y++]=O,g[y++]=U,g[y++]=U,g[y++]=R,So&&(ke(R<a),ke(O<a),ke(U<a),ke(y<=m))};(()=>{for(let R=Math.max(s[0],1)-1;R<Math.min(s[1],e-2)-1;++R){const O=R*v;for(let U=Math.max(r[0],1)-1;U<Math.min(r[1],e-2)-1;++U){const L=R*v+U,B=L+1,G=B+v,j=G-1,q=O+U,ie=q+1,ee=ie+v,K=ee-1,Y=t.vertexAttributes.position.typedBuffer,D=t.vertexAttributes.position.typedBufferStride;S(q,ie,ee,K,D,Y)?(E(L,B,G),E(G,j,L)):(E(L,B,j),E(j,G,B))}}})(),ke(y===3*l*f),(()=>{for(let R=0;R<4;++R){const O=y;if(c[R])continue;const U=t.outerEdges[R],L=t.innerEdges[R];let B=0,G=0;const j=U.count,q=L.count;ke(q===o-1);let ie=0;const ee=R===1||R===2?(K,Y,D)=>E(K,Y,D):(K,Y,D)=>E(K,D,Y);for(;B<j-1||G<q-1;){const K=L.getVertexIndex(G),Y=U.getVertexIndex(B),D=B<j-1,V=G<q-1;D&&(!V||(D?0+o*(B+.5)/(j-1):0)<=(V?1+x*(G+.5)/(q-1):0))?(++B,So&&ke(B<j),ee(K,Y,U.getVertexIndex(B)),ie++):(++G,So&&ke(G<q),ee(K,Y,L.getVertexIndex(G)),ie++)}So&&(ke(B===j-1),ke(G===q-1),ke(ie===j+q-2),ke(ie===o-2+U.count-1),ke(y===O+3*ie*f))}})(),ke(y===3*(l+h)*f);const C=R=>{const O=t.outerEdges[R.connectedOuterEdgeOffset];let U=O.getVertexIndex(0),L=O.stride;for(let B=0;B<R.latitudeResolution;++B){const G=B===0?R.rowOffset:U+e;for(let j=0;j<o;j++)E(U,U+1,G+j),B<R.latitudeResolution-1&&E(U+1,G+j+1,G+j),U+=L;U=G,L=1}};i.forEach(C)}else{(()=>{const C=Math.max(s[0],1)-1,R=Math.min(s[1],e-2)-1,O=Math.max(r[0],1)-1,U=Math.min(r[1],e-2)-1;for(let L=C;L<R;++L){const B=L*v;for(let G=O;G<U;++G){const j=B+G,q=j+1,ie=q+v,ee=ie-1,K=t.vertexAttributes.position.typedBuffer,Y=t.vertexAttributes.position.typedBufferStride;S(j,q,ie,ee,Y,K)?(g[y]=j,g[y+1]=q,g[y+2]=ie,g[y+3]=ie,g[y+4]=ee,g[y+5]=j):(g[y]=j,g[y+1]=q,g[y+2]=ee,g[y+3]=ee,g[y+4]=q,g[y+5]=ie),y+=6}}})(),ke(y===3*l*f),(()=>{for(let C=0;C<4;++C){if(c[C])continue;const R=t.outerEdges[C],O=t.innerEdges[C];let U=0,L=0;const B=R.count,G=O.count;ke(G===o-1);const j=C===1||C===2,q=j?1:2,ie=j?2:1,ee=R.index0,K=R.stride,Y=O.index0,D=O.stride;for(;U<B-1||L<G-1;){const V=Y+L*D,k=ee+U*K,Z=U<B-1,Q=L<G-1,ne=Z&&(!Q||(Z?0+o*(U+.5)/(B-1):0)<=(Q?1+x*(L+.5)/(G-1):0));ne?++U:++L;const te=ne?k+K:V+D;g[y]=V,g[y+q]=k,g[y+ie]=te,y+=3}}})(),ke(y===3*(l+h)*f);const E=C=>{const R=t.outerEdges[C.connectedOuterEdgeOffset];let O=R.getVertexIndex(0),U=R.stride;for(let L=0;L<C.latitudeResolution;++L){const B=L===0?C.rowOffset:O+e;for(let G=0;G<o;G++){const j=B+G;g[y]=O,g[y+1]=O+1,g[y+2]=j,L<C.latitudeResolution-1?(g[y+3]=O+1,g[y+4]=j+1,g[y+5]=j,y+=6):y+=3,O+=U}O=B,U=1}};i.forEach(E)}ke(y===m),t.indices=g,t.indexCount=m}function gFe(t,e){const i=t.localOrigin,r=t.geometryInfo,s=t.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new Yye(o,i,h,d,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new Yye(o,i,c,1,h),a+=h}}}function yFe(t,e,i){const r=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];ke(Cm(c));const h=c+1,d=t.geometryInfo,f=d.boundingBox,m=d.outerEdges[e],g=d.uvRange[0],y=d.uvRange[1],v=d.uvRange[2],x=d.uvRange[3],S=Se(e===1?1:0,g,v),E=Se(e===0?1:0,y,x),C=i.renderData,R=C.geometryState,O=C.geometryInfo.outerEdges[r],U=n.getNeighborEdgeStartVertexIndex(e,i)*c,L=c*2**a;ke(R.neighborData.edgeResolutions[r]===L),ke(O.count-1===L);const B=C.localOrigin[0]-t.localOrigin[0],G=C.localOrigin[1]-t.localOrigin[1],j=C.localOrigin[2]-t.localOrigin[2],q=m.attributes,ie=m.index0,ee=m.stride,K=q.position.typedBuffer,Y=q.position.typedBufferStride,D=q.normalCompressed.typedBuffer,V=q.normalCompressed.typedBufferStride,k=q.uv0,Z=O.attributes,Q=O.index0,ne=O.stride,te=Z.position.typedBuffer,de=Z.position.typedBufferStride,_e=Z.normalCompressed.typedBuffer,Ce=Z.normalCompressed.typedBufferStride;for(let Pe=1;Pe<h-1;++Pe){const Ze=ie+ee*Pe,Le=Q+ne*(U+Pe),Me=Ze*Y,qe=Le*de,We=te[qe]+B,$t=te[qe+1]+G,ut=te[qe+2]+j;K[Me]=We,K[Me+1]=$t,K[Me+2]=ut,wc(We,$t,ut,f);const Qt=Ze*V,ai=Le*Ce;D[Qt]=_e[ai],D[Qt+1]=_e[ai+1];const ui=Pe/c,li=l?S:Se(ui,g,v),Ri=l?Se(ui,y,x):E;lh(k,Ze,li,Ri)}}function _Fe(t){var qe;const e=t.geometryState,i=e.neighborData,r=t.localOrigin,s=i.cornerNeighborData,n=t.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((qe=t.tile.surface.view)==null?void 0:qe.viewingMode)==="local",h=l.ellipsoid.radius,d=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,y=0;const v=(We,$t,ut)=>{const Qt=d[$t===0?1:3],ai=d[We===0?0:2],ui=Math.cos(Qt),li=Math.sin(Qt),Ri=Math.sin(ai),pr=Math.cos(ai),Gi=h+ut;m=pr*ui*Gi,g=Ri*ui*Gi,y=li*Gi},x=c?(()=>{const We=t.geometryState.clippingArea,$t=l.extent,ut=b(We)&&($t[3]>We[3]||$t[2]>We[2]||$t[1]<We[1]||$t[0]<We[0]),Qt=Wne(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(ai,ui,li)=>{const Ri=ai===0?ie[0]:ie[2],pr=ui===0?ie[1]:ie[3],Gi=ut?Se(Ri,We[0],We[2]):Ri,Fi=ut?Se(pr,We[1],We[3]):pr,pt=li;m=Gi*f,g=Qt(Fi),y=pt}})():v;let S=0,E=0,C=0,R=0,O=0,U=0,L=0,B=0,G=0;const j=c&&t.tile.surface.isWebMercatorOnPlateeCarree,q=(We,$t,ut,Qt,ai)=>{let ui=0,li=0,Ri=0;if(c){const pr=$t*f,Gi=j?(Math.PI/2-2*Math.atan(Math.exp(-ut/h)))*h:ut*f;ui=pr-m,li=Gi-g,Ri=Qt-y}else{const pr=qne(We),Gi=We.tile,Fi=Gi.extent,pt=Gi.extentInRadians,lt=($t-Fi[0])/(Fi[2]-Fi[0]),wt=(ut-Fi[1])/(Fi[3]-Fi[1]),Tt=pt[0]*(1-lt)+pt[2]*lt,Lt=pr(wt),oi=Math.cos(Lt),qi=Math.sin(Lt),Wi=Math.sin(Tt),Yi=Math.cos(Tt),Xi=h+Qt;ui=Yi*oi*Xi-m,li=Wi*oi*Xi-g,Ri=qi*Xi-y}switch(ai){case 0:L+=ui,B+=li,G+=Ri;break;case 1:R-=ui,O-=li,U-=Ri;break;case 2:L-=ui,B-=li,G-=Ri;break;case 3:R+=ui,O+=li,U+=Ri}},ie=l.extent,ee=e.clippingArea,K=b(ee)?ee:Jz,Y=ie[0],D=ie[2],V=ie[1],k=ie[3],Z=[k>K[3],D>K[2],V<K[1],Y<K[0]],Q=Math.max(Y,K[0]),ne=Math.min(D,K[2]),te=Math.max(V,K[1]),de=Math.min(k,K[3]),_e=n.uvRange[0],Ce=n.uvRange[1],Pe=n.uvRange[2],Ze=n.uvRange[3],Le=l.surface.shading||pS,Me=We=>{var Fi;const $t=s[We].cornerTiles;S=0,E=0,C=1;let ut=1/0;for(let pt=0;pt<4;++pt)ut=Math.min(ut,((Fi=$t[pt])==null?void 0:Fi.level)??1/0);for(let pt=0;pt<4;++pt){const lt=$t[pt];TR[pt]=(lt==null?void 0:lt.level)===ut?lt:null}let Qt=1,ai=0;for(let pt=0;pt<4;++pt){const lt=TR[pt];lt&&(Qt=Math.max(Qt,lt==null?void 0:lt.renderData.geometryState.numVerticesPerSide),ai=lt.extent[2]-lt.extent[0])}const ui=ai,li=Qt;ke(li>1);const Ri=ui/li;for(let pt=0;pt<4;++pt){const lt=TR[(pt+3)%4],wt=TR[pt%4];if(!lt&&!wt)continue;const Tt=pt===0?1:pt===1?2:pt===2?3:0,Lt=pt===0?2:pt===1?3:pt===2?0:1;if(lt&&wt){const oi=bH[pt][0]*Ri,qi=bH[pt][1]*Ri,Wi=lt.extent,Yi=Wi[Tt===0||Tt===1?2:0]+oi,Xi=Wi[Tt===0||Tt===3?3:1]+qi,Gr=wt.extent,mi=Gr[Lt===0||Lt===1?2:0]+oi,Li=Gr[Lt===0||Lt===3?3:1]+qi,Pi=lt.renderData,Ws=wt.renderData,vr=Rs(Yi,Xi,Pi.geometryState.samplerData),ds=Rs(mi,Li,Ws.geometryState.samplerData);q(Pi,Yi,Xi,.5*(vr+ds),pt)}else{const oi=lt??wt,qi=lt?Tt:Lt,Wi=oi.extent,Yi=bH[pt],Xi=Wi[qi===0||qi===1?2:0]+Yi[0]*Ri,Gr=Wi[qi===0||qi===3?3:1]+Yi[1]*Ri,mi=oi.renderData,Li=Rs(Xi,Gr,mi.geometryState.samplerData);q(mi,Xi,Gr,Li,pt)}}if(!c){const pt=Math.sqrt(m*m+g*g+y*y);S=m/pt,E=g/pt,C=y/pt}const pr=Math.sqrt(R*R+O*O+U*U);R/=pr,O/=pr,U/=pr;const Gi=Math.sqrt(L*L+B*B+G*G);if(L/=Gi,B/=Gi,G/=Gi,c||C*C<.999){S=U*B-O*G,E=R*G-U*L,C=O*L-R*B;const pt=1/Math.sqrt(S*S+E*E+C*C);S*=pt,E*=pt,C*=pt}};for(let We=0;We<4;++We){const $t=We,ut=(We+1)%4,Qt=We===0||We===1?1:0,ai=We===0||We===3?1:0,ui=Se(Qt,_e,Pe),li=Se(ai,Ce,Ze),Ri=o[$t],pr=We===0||We===3?Ri.count-1:0,Gi=o[ut],Fi=We===0||We===1?Gi.count-1:0,pt=s[We].cornerTiles;let lt=-1;for(let Lt=0;Lt<4;++Lt){const oi=pt[Lt];oi&&(lt===-1||R_(pt[lt],oi)>0)&&(lt=Lt)}const wt=lt,Tt=pt[wt];if(S=0,E=0,C=1,Tt!==l){const Lt=l.level-Tt.level,oi=2**Lt,qi=[Tt.lij[0]+Lt,Tt.lij[1]*oi,Tt.lij[2]*oi],Wi=[qi[1]+oi===l.lij[1],We===0&&(wt===1||wt===0&&Tt!==pt[3])||We===1&&(wt===0||wt===1&&Tt!==pt[2]),qi[1]===l.lij[1]+1,We===2&&(wt===3||wt===2&&Tt!==pt[1])||We===3&&(wt===2||wt===3&&Tt!==pt[0])],Yi=Wi.reduce((Pi,Ws)=>Pi+(Ws?1:0),0);ke(Yi===1||Yi===2);let Xi=-1,Gr=-1;const mi=Tt.renderData;if(Yi===1){const Pi=Wi.findIndex(vr=>vr);ke(0<=Pi&&Pi<=3),Xi=(Pi+2)%4;const Ws=t.geometryState.neighborData.edgeResolutions[Pi];Gr=l.getNeighborEdgeStartVertexIndex(Pi,Tt)*Ws+Ws*(Pi===0&&We===0||Pi===1&&We===0||Pi===2&&We===1||Pi===3&&We===3?1:0)}else{ke(Wi[1]||Wi[3]),Xi=Wi[1]?3:1;const Pi=mi.geometryState.neighborData.edgeResolutions[Xi];Gr=We===0||We===3?0:Pi}const Li=mi.geometryInfo.outerEdges[Xi];{const Pi=Ri.index0+pr*Ri.stride,Ws=Gi.index0+Fi*Gi.stride,vr=Li.index0+Gr*Li.stride;{const ds=Li.attributes.position,jr=ds.typedBuffer,rs=vr*ds.typedBufferStride,xs=t.localOrigin,rn=Li.localOrigin,Oo=jr[rs]+rn[0]-xs[0],ro=jr[rs+1]+rn[1]-xs[1],Ys=jr[rs+2]+rn[2]-xs[2];wc(Oo,ro,Ys,a);{const ss=Ri.attributes.position,ps=ss.typedBuffer,$s=Pi*ss.typedBufferStride;ps[$s]=Oo,ps[$s+1]=ro,ps[$s+2]=Ys}{const ss=Gi.attributes.position,ps=ss.typedBuffer,$s=Ws*ss.typedBufferStride;ps[$s]=Oo,ps[$s+1]=ro,ps[$s+2]=Ys}}lh(Ri.attributes.uv0,Pi,ui,li),lh(Gi.attributes.uv0,Ws,ui,li);{const ds=Li.attributes.normalCompressed.typedBuffer,jr=vr*Li.attributes.normalCompressed.typedBufferStride;{const rs=Ri.attributes.normalCompressed,xs=rs.typedBuffer,rn=Pi*rs.typedBufferStride;xs[rn]=ds[jr],xs[rn+1]=ds[jr+1]}{const rs=Gi.attributes.normalCompressed,xs=rs.typedBuffer,rn=Ws*rs.typedBufferStride;xs[rn]=ds[jr],xs[rn+1]=ds[jr+1]}}}}else{const Lt=Z[$t],oi=Z[ut];let qi;if(Lt||oi){const Gr=Se(Y*(1-Qt)+D*Qt,Q,ne),mi=Se(V*(1-ai)+k*ai,te,de),Li=e.samplerData;qi=Rs(Gr,mi,Li)}else qi=eNt(pt);x(Qt,ai,qi),(Le||pS)&&Me(We);const Wi=m-r[0],Yi=g-r[1],Xi=y-r[2];wc(Wi,Yi,Xi,a),Ri.setVertexFromValuesRawPositionUVNormal(pr,Wi,Yi,Xi,ui,li,S,E,C),Gi.setVertexFromValuesRawPositionUVNormal(Fi,Wi,Yi,Xi,ui,li,S,E,C)}}for(let We=0;We<4;++We)TR[We]=null}function eNt(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);So&&(ke(!t[0]||!t[2]||lQ(t[0],t[2],Ht.SOUTH_WEST)),ke(!t[1]||!t[3]||lQ(t[1],t[3],Ht.NORTH_WEST)));let i=0,r=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,d=l.extent,f=d[c?0:2],m=d[h?1:3],g=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;r+=Rs(f,m,g),i++}}const s=i?r/i:0;return ke(s!=null),s}function Zz(t){const e=t.vao,i=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const bH=[[0,1],[1,0],[0,-1],[-1,0]],Qn=new DLt,Jz=vte(-1/0,-1/0,1/0,1/0),TR=[null,null,null,null];function vFe(t,e,i){if(!e)return!1;const r=R_(t,e);return r>0||r===0&&i>=2}const pS=!0;let tNt=class extends Bne{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,i,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=bi(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=b(s)&&Iee(s)&&b(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Ve(c[0],c[1],0);_a(h,Ye.WebMercator,h,Ye.PlateCarree);const d=Ve(c[2],c[3],0);_a(d,Ye.WebMercator,d,Ye.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=d[0],l[3]=d[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[jn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],g=d[2],y=d[3];if(f*(f>0?r:o)+m*(m>0?s:a)+g*(g>0?n:l)+y>=0)return Rl.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+g*(g<0?n:l)+y<=0}return c?Rl.INSIDE:Rl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return zZe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,s){return G4[0]=1/i[0],G4[1]=1/i[1],G4[2]=1/i[2],Hse(this._aabb(),e,G4,r,s)}createGeometry(){qDt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){ZDt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){JDt(this.renderData,this._horizontalScaleFactor)}};const G4=$();let iNt=class{constructor(){this.extent=Ai(),this.minLevel=0,this.maxLevel=0,this.callback=null}},y8=class extends Ee{constructor(){super(...arguments),this._queries=new vi({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new vi({initialSize:30}),this._queryPool=new pa(iNt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();im(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([p()],y8.prototype,"updating",null),y8=u([N("esri.views.3d.terrain.ScaleRangeQueries")],y8);let rNt=class extends Bne{get convexHull(){return this._convexHull}constructor(e,i,r){super(),this._convexHull=new Array(24),this._boundingSphere=to(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=ei(o,l,.5),d=ei(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),zKe(this.centerAtSeaLevel,d,h,this.ellipsoid.radius);const m=Qc(this.centerAtSeaLevel);Re(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)fe(e[jn.MIDDLE],0,0,0),fe(e[jn.TOP],0,0,0),fe(e[jn.BOTTOM],0,0,0),e[jn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[jn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,sNt(i,r,3*n));e[jn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!Tb(e,this._boundingSphere))return Rl.OUTSIDE;if(this.lij[0]<10)return Rl.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<nw.NUM;n++){const o=n===Jr.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g+0]+c*i[g+1]+h*i[g+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return Rl.OUTSIDE}return s?Rl.INSIDE:Rl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){UDt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),So&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,s=this.ellipsoid.radius,n=r[1];if(this.level===0)fe(i,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];mx(u0e,a,l,s),mx(h0e,a,c,s),we(i,u0e,h0e);const h=.5*(r[0]+r[1]);pe(i,i,(s+h)/Bu(i));const d=this.convexHull;let f=0;const m=(y,v)=>{const x=y[0]-d[3*v+0],S=y[1]-d[3*v+1],E=y[2]-d[3*v+2];return Math.sqrt(x*x+S*S+E*E)};for(let y=0;y<8;++y){const v=m(i,y);f=Math.max(f,v)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===_p.HAS_NORTH_POLE,a=n&&s===_p.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],d=e[2],f=a?-c:e[1],m=o?c:e[3],g=.5*(h+d),y=r[0],v=i+(l?Math.min(0,y-1):y),x=(Y,D,V)=>mx(Y,D,V,v),S=$(),E=$(),C=$(),R=$();x(S,h,f),x(E,h,m),x(C,d,m),x(R,d,f);const O=(Y,D)=>{for(let V=0;V<3;++V)this._convexHull[3*D+V]=Y[V]};O(S,0),O(E,1),O(C,2),O(R,3);const U=r[1],L=i+(l?Math.max(0,U+1):U),B=$(),G=$(),j=$();mx(G,g,m,v),mx(j,g,f,v),we(B,G,j),Re(B,B);const q=$(),ie=$(),ee=(Y,D)=>{as(ie,Y,D),Re(ie,ie);const V=-xe(Y,q)/xe(ie,q);ke(V>=0),pe(ie,ie,V),we(Y,Y,ie)};if(2**this.lij[0]>2*this.lij[1]){const Y=j,D=$();Et(D,c0e,Y),Re(D,D),Et(q,Y,D),Re(q,q),ke(vp(xe(q,Y)/Bu(Y),0)),ee(S,E),ee(R,C),O(S,0),O(R,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Y=G,D=$();Et(D,c0e,Y),Re(D,D),Et(q,D,Y),Re(q,q),ee(E,S),ee(C,R),O(E,1),O(C,2)}const K=(Y,D)=>{const V=L/xe(D,B);for(let k=0;k<3;++k)this._convexHull[3*Y+k]=D[k]*V};K(4,S),K(5,E),K(6,C),K(7,R)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?_p.HAS_BOTH_POLES:_p.HAS_NORTH_POLE:r?_p.HAS_SOUTH_POLE:_p.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],d=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,g=i[2]*d-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<l0e.length?l0e[this.level]+1:2}updateCornerElevations(){GDt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){BDt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var de;if(!So||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=$(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[jn.MIDDLE][3],d=this.convexHull,f=(_e,Ce)=>{for(let Pe=0;Pe<3;++Pe)_e[Pe]=d[3*Ce+Pe]};{const _e=$(),Ce=$(),Pe=$(),Ze=$(),Le=$(),Me=(qe,We,$t,ut)=>{f(Ce,qe),f(Pe,We),f(Ze,$t),as(Ce,Ce,Pe),as(Ze,Ze,Pe),Et(_e,Ce,Ze),Re(_e,_e);const Qt=xe(_e,Pe);f(Le,ut);const ai=xe(_e,Le),ui=Math.abs(ai-Qt);ke(vp(ui,0),`Non coplanar ${qe},${We},${$t},${ut} diff = ${ui}`)};Me(0,1,2,3),Me(4,5,6,7),Me(0,1,4,5),Me(1,2,5,6),Me(2,3,6,7),Me(3,0,7,4)}const m=fh(24),g=(_e,Ce,Pe)=>{const Ze=4*_e;for(let Le=0;Le<3;++Le)m[Ze+Le]=Ce[Le];m[Ze+3]=Pe},y=$(),v=$(),x=$(),S=$(),E=(_e,Ce,Pe,Ze)=>{f(y,Ce),f(v,Pe),f(x,Ze),as(y,y,v),Re(y,y),as(x,x,v),Re(x,x),Et(S,y,x),Re(S,S);const Le=xe(S,v);g(_e,S,Le)};E(0,0,1,2),E(1,1,0,4),E(2,1,5,2),E(3,3,2,6),E(4,4,0,3),E(5,4,6,5);const C=1,R=(_e,Ce,Pe,Ze)=>{const Le=4*_e;return m[Le+0]*Ce+m[Le+1]*Pe+m[Le+2]*Ze-m[Le+3]},O=(_e,Ce,Pe,Ze)=>R(_e,Ce,Pe,Ze)>=-C,U=(_e,Ce)=>O(_e,Ce[0],Ce[1],Ce[2]),L=2**this.lij[0]>2*this.lij[1],B=(_e,Ce,Pe)=>Math.sqrt(bFe(_e,Ce,Pe,r[0],r[1],r[2]))<i,G=_e=>B(_e[0],_e[1],_e[2]),j=(_e,Ce)=>B(_e[Ce+0],_e[Ce+1],_e[Ce+2]),q=this.extentInRadians,ie=.5*(q[0]+q[2]),ee=q[1],K=q[3],Y=$(),D=$();mx(Y,ie,K,a),mx(D,ie,ee,a);const V=L?"Upper":"Lower";let k=!0;for(let _e=0;_e<6;++_e){for(let Ce=0;Ce<8;++Ce){const Pe=3*Ce,Ze=O(_e,d[Pe+0],d[Pe+1],d[Pe+2]);k&&(k=Ze),ke(Ze,`Tile[${this.lij}] Convex hull point ${Ce} outside of plane ${_e}`)}ke(U(_e,D),`Tile[${this.lij}] (${V}) bottom mid outside of plane ${_e}`),ke(U(_e,Y),`Tile[${this.lij}] (${V}) top mid outside of plane ${_e}`)}ke(k,"Not all convex hull points are inside  convex hull polyhedron"),ke(G(D),`Tile[${this.lij}] (${V}) bottom mid outside of bounding sphere`),ke(G(Y),`Tile[${this.lij}] (${V}) top mid outside of bounding sphere`);for(let _e=0;_e<8;++_e){const Ce=j(d,3*_e);ke(Ce,`Tile[${this.lij}] Convex hull point ${_e} outside of bounding sphere`)}for(let _e=0;_e<6;++_e)for(let Ce=0;Ce<8;++Ce){const Pe=3*Ce;O(_e,d[Pe+0],d[Pe+1],d[Pe+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ce} outside of plane ${_e}`)}const Z=this.extentInRadians,Q=Math.max(Z[2]-Z[0],Z[3]-Z[1]),ne=Math.round(Q*n),te=this.renderData;if(te){const _e=te.geometryInfo,Ce=te.localOrigin,Pe=(de=_e.vertexAttributes)==null?void 0:de.position;if(!Pe)return;const Ze=Pe.count,Le=$(),Me=_e.numVerticesPerSide-2,qe=Me*Me,We=te.geometryState.neighborData,$t=We.edgeResolutions.reduce((ut,Qt)=>ut+Qt+1,0);for(let ut=0;ut<Ze;++ut){const Qt=ut<qe,ai=!Qt&&ut<qe+$t;let ui=!1,li=-1;if(ai){let mi=qe;for(let Li=0;Li<4;++Li){const Pi=We.edgeResolutions[Li];if(ut===mi||ut===mi+Pi-1){ui=!0;break}if(mi+=Pi,ut<mi){li=Li;break}}}const Ri=li,pr=ui,Gi=ai&&!pr,Fi=ai?We.edgePeerNeighbors[Ri]:null,pt=ai&&Fi&&R_(this,Fi)>0,lt=Qt?"internal":Gi?"edge":pr?"corner":"pole";Pe.getVec(ut,s),we(Le,s,Ce);const wt=Bu(Le)-n;let Tt=0,Lt=!1;const oi=o[0]-wt,qi=wt-o[1],Wi=oi>l,Yi=qi>l,Xi=Wi||Yi,Gr=`Tile[${this.lij}].vertex[${ut}]:${lt}`+(Wi?"(below)":Yi?"(above)":"")+(pt?"(Neighbor)":"");{const mi=WL(Le,r);if(mi>=i+c){const Li=mi-i;Xi||(console.error(`${Gr} is out of the bounding sphere by ${Li.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${wt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Li/i).toFixed(0)})`),Lt=!0)}}for(let mi=0;mi<6;++mi)if(!O(mi,Le[0],Le[1],Le[2])){const Li=R(mi,Le[0],Le[1],Le[2]),Pi=ut%Me,Ws=(ut-Pi)/Me;mi===0&&oi||mi===5&&qi||(console.error(`${Gr} (${Pi},${Ws})|${Me}] is out of the bounding trapezoid plane ${mi} h=${Math.round(wt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Li)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${ne}`),++Tt)}if(Lt||Tt>0)break}}}};const l0e=[128,64,64,32,16,8,8,4];function sNt(t,e,i){return bFe(t[0],t[1],t[2],e[i+0],e[i+1],e[i+2])}function bFe(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const mx=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},c0e=[0,0,1],u0e=$(),h0e=$();let nNt=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},wFe=class extends Hl{constructor(){super(...arguments),this.blendMode=Je.Normal}};u([X({count:Je.COUNT})],wFe.prototype,"blendMode",void 0);let LM=class extends wFe{constructor(){super(...arguments),this.output=Uo.Composite,this.baseOpacityMode=um.NotRequired,this.premultipliedSource=Xf.Off,this.hasWebGL2Context=!1}};u([X({count:Uo.COUNT})],LM.prototype,"output",void 0),u([X({count:um.COUNT})],LM.prototype,"baseOpacityMode",void 0),u([X()],LM.prototype,"premultipliedSource",void 0),u([X()],LM.prototype,"hasWebGL2Context",void 0);var fS;function oNt(t){const e=new ar;if(e.include(tFe),t.background===fS.Only){const i=t.output===Uo.ColorComposite;return i?e.fragment.uniforms.add(new fi("backgroundColor",r=>r.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(zne)),e.fragment.code.add(T`
    void main() {
      gl_FragColor = vec4(${i?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(iFe,t),e.fragment.uniforms.add(new Yt("tex",i=>i.texture)),e.fragment.uniforms.add(new Be("opacity",i=>i.opacity)),e.fragment.code.add(T`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(fS||(fS={}));const aNt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return fS},build:oNt},Symbol.toStringTag,{value:"Module"}));let lNt=class extends eFe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Fl}},xFe=class TFe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,TFe.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}};xFe.shader=new lr(aNt,()=>se(()=>import("./BlendLayers.glsl-ea02b47a.js"),[]));let SFe=class extends LM{constructor(){super(...arguments),this.background=fS.BelowLayer}};u([X()],SFe.prototype,"background",void 0);let wH=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=di(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ve(s,n,o)}destroy(){this.texture.release()}};const cNt=.125;let uNt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new NZ({viewpoint:new ya({targetGeometry:new st(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,i,r,s,n,o,a,l,c,h){const d=o.adjustLevel(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=d,f.requiredLevel=d;const m=o.getScale(i[0]),[g,y]=o.getShift(i,a*m),v=cNt*a*m/c,x=r.transforms.dvs;x[0]=v,x[4]=-v,x[6]=-1-g-l[0]*a*2,x[7]=1+y+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(e),r.triangleCount=0,s.drawTile(f,r,n)}},EFe=class CFe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,CFe.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}};EFe.shader=new lr(nDt,()=>se(()=>import("./RasterColorizer.glsl-e5dbcbd5.js"),[]));let _8=class extends LM{constructor(){super(...arguments),this.colorizerType=C2.Stretch,this.stretchType=dS.Noop,this.applyColormap=!0}};u([X({count:C2.COUNT})],_8.prototype,"colorizerType",void 0),u([X({count:dS.COUNT})],_8.prototype,"stretchType",void 0),u([X()],_8.prototype,"applyColormap",void 0);let d0e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,r),r}};const hNt=le.getLogger("esri.views.3d.terrain");let dNt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new uNt,this._bindParameters=new sz(null,null,null),this._blendLayersTechniqueConfig=new SFe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=ql(this._rctx,Y3)}dispose(){this._fbos.forEach(dt),this._fbos=null,this._vtFBO=dt(this._vtFBO),this._vaoQuad=dt(this._vaoQuad),this._vectorTileHelper=dt(this._vectorTileHelper),this._backgroundTechnique=Os(this._backgroundTechnique),this._applyOpacityTechnique=Os(this._applyOpacityTechnique),this._blendLayersTechnique=Os(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,s=Xf.Off,n=fS.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(xFe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Je.Normal,i?Uo.ColorComposite:Uo.GridComposite,um.NotRequired,Xf.Off,fS.Only),s=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Xt.TRIANGLE_STRIP,0,il(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n,o=Xf.On){i===Uo.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,s,n,o=Xf.Off){if(A(e.texture))return;e.fboTexture=i===Uo.GroupBackgroundComposite||s===Je.Normal&&n===um.NotRequired&&o===Xf.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Di.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Je.Normal&&n===um.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return A(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new _8,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?dS.Noop:dS.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(EFe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l,c){const h=this._rctx,d=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,Di.MAP),m=n===um.Required||e.opacity<1||s!==Je.Normal||i!==Uo.Composite,g=m?Xf.On:Xf.Off;this._getBlendLayersTechnique(s,i,n,g).bindPipelineState(h);let y=null,v=null;m?(v=this.currentFBO(r),A(this._vtFBO)&&(this._vtFBO=new d0e(this._rctx)),y=this._vtFBO.get(r),h.bindFramebuffer(y),this._clearCurrentFBO()):c&&h.clearSafe(_s.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,d,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(x){hNt.warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return!b(y)||(h.bindFramebuffer(v),e.texture=y.colorTexture,e.offset=mu,e.scale=1,this.drawRasterData(e,i,r,s,n,g),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,At.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(Ut.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,At.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(_s.COLOR_BUFFER_BIT|_s.DEPTH_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new d0e(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},pNt=class{constructor(e,i,r,s){this.start=e,this.end=i,this.blendMode=r,this.opacity=s}},fNt=class{constructor(e,i,r){this._rctx=e,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new lNt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new dNt(this._rctx,this._techniqueRepository),this._blackTex=new sM(G0t(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=dt(this._composition),this._backgroundTexture=Os(this._backgroundTexture),this._blackTex=Os(this._blackTex)}get backgroundIsGrid(){return A(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let h=!1;ok.clear(),zE.length=0;const d=e.layerInfo[Di.MAP];let f=d.length,m=0;for(;m<d.length;m++){const v=r.layerViewByIndex(m,Di.MAP),x=v.layer.opacity;p0e[m]=x;const S=v.fullOpacity;if(f0e[m]=S,Mwe(v.layer)&&f>=d.length&&(f=m),tk(v)){m0e[m]=v.layer.blendMode;let C=v.layer.blendMode!=="normal";if(CA(v.layer.parent)){const R=uQ(v.layer.parent);b(R)&&R!==""&&(C=MFe(v.layer.parent)||C)}C&&(h=C,l=!1)}if(x===0&&!h){d[m].pendingUpdates&=~(Gt.TEXTURE_NOFADING&Gt.TEXTURE_FADING);continue}++o;const E=xH(e,m);if(E){if(d[m].pendingUpdates&=~(Gt.TEXTURE_NOFADING&Gt.TEXTURE_FADING),CA(v.layer.parent)){const C=uQ(v.layer.parent);b(C)&&C!==""&&AFe(v.layer.parent,m)}bL(v)?a=Math.max(a,this.tileSize*c):s===1&&S===1&&(v.isOpaque||this._dataToTexture(E)&&E.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===Ft.WEBGL1&&(a=mNt(a));const g=a/this.tileSize,y=m-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(e,y,f,f0e[y])||this._composeMapLayers(e,i,y,f,p0e,m0e,a,g,!l||h,ok,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){A(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=mu,this._passParameters.scale=1,this._passParameters.opacity=1,b(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,b(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,i){let r=O_.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(r=O_.Delayed);const s=e.renderData;this._backgroundTexture&&A(s.textureReference)&&(r=O_.Immediate),s.setTextureReference(b(this._backgroundTexture)?new wH(this._backgroundTexture,go.FADING,g0e,e.surface.baseOpacity,0,1):null,r)}_useLayerTexture(e,i,r,s){const n=i<r,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=xH(e,i);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new wH(l.sourceLayerInfo.data,go.FADING,l,o,a,s)),!0)}_composeMapLayers(e,i,r,s,n,o,a,l,c,h,d){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,g=mt.LINEAR_MIPMAP_LINEAR,y=!1,v=0;for(let E=r;E>=0;E--){const C=xH(e,E);if(!C||n[E]===0&&!d)continue;const R=E<s&&f<1&&!m;this._passParameters.baseOpacity=R?f:1;const O=this._passParameters.baseOpacity<1?um.Required:um.NotRequired;R&&(m=!0);let U=!1;h.forEach(j=>{j.start===E&&(zE.push(j),this._composition.openGroup(a),U=!0)});const L=v===0,B=U?Uo.GroupBackgroundComposite:c&&L?this.backgroundIsGrid?Uo.GridComposite:Uo.ColorComposite:Uo.Composite,G=aQ[o[E]];for(P$t(C)?(this._passParameters.opacity=n[E],y=this._composition.drawVectorData(this._passParameters,B,a,G,O,C,l,this.tileSize,y)):R$t(C)?(this._passParameters.opacity=n[E],this._composition.drawImageryTileData(this._passParameters,B,a,G,O,C),this._hasNearestInterpolation(C)&&(g=mt.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._passParameters.opacity=n[E],this._composition.drawRasterData(this._passParameters,B,a,G,O));zE.length>0&&zE[zE.length-1].end===E;){const j=zE.pop();this._passParameters.opacity=j.opacity,this._passParameters.offset=mu,this._passParameters.scale=1;const q=c&&L?this.backgroundIsGrid?Uo.GridComposite:Uo.ColorComposite:Uo.Composite;this._composition.drawGroup(this._passParameters,q,a,aQ[j.blendMode],O)}v++}const x=e.renderData,S=x.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(S),this._composition.unbind(),x.setTextureReference(new wH(S,i,g0e,m?1:f,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if($$t(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data),e.tile.setMemoryDirty()}return I$t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i=mt.LINEAR_MIPMAP_LINEAR){if(A(e))return null;const r={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof e=="number")r.width=r.height=e,n=new sM(new At(s,r));else if(e instanceof Hz)r.isOpaque=e.isOpaque,n=new sM(new At(s,r,e.image)),e.release();else try{r.width=e.width,r.height=e.height,n=new sM(new At(s,r,e))}catch{n=new sM(aRe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,At.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,At.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function mNt(t){const e=AA(t),i=e*e,r=t*t;if(i===r)return t;const s=e/2;return i-r<r-s*s?e:s}function xH(t,e){Oh.layerIndex=e;const i=t.layerInfo[Di.MAP][e];if(b(i.data))return Vt(Oh.offset,0,0),Oh.tile=t,Oh.scale=1,Oh.sourceLod=t.lij,Oh.sourceLayerInfo=i,Oh;const r=i.upsampleInfo;if(b(r)){const s=r.tile.layerInfo[Di.MAP][e];return Oh.tile=r.tile,Ao(Oh.offset,r.offset),Oh.scale=r.scale,Oh.sourceLod=r.tile.lij,Oh.sourceLayerInfo=s,Oh}return null}function uQ(t){return t.get("uid")}function MFe(t){let e=t.blendMode!=="normal";return CA(t.parent)&&(e=MFe(t.parent)||e),e}function AFe(t,e){CA(t.parent)&&AFe(t.parent,e);const i=uQ(t);if(b(i)&&i!==""){const r=ok.get(i);r?r.start=e:ok.set(i,new pNt(e,e,t.blendMode,t.opacity))}}const p0e=new Array,f0e=new Array,m0e=new Array,ok=new Map,zE=new Array,Oh={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},g0e={offset:[0,0],scale:1},OFe=200,TH=40,gNt=.8,yNt=10,nI=1e-6;function _Nt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=nI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-nI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-nI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=nI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let y0e=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},Yne=class hQ{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positionAttribute=s,this._rayDirection=$(),this.bspNodeTree=new Array;const n=r-i,o=n<=RFe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=TNt(e,i,r,s.data,s.stride),l=Se(Math.log2(n/TH),2,yNt),c=(h,d,f)=>{const m=wNt(o,a,h,d),g=d-h;if(g<=TH){const C=new y0e(m,void 0,0,h,d);return this.bspNodeTree.push(C),C}const{axis:y,midValue:v}=xNt(m),x=bNt(o,a,h,d,y,v),S=(C,R)=>{if(f>l)return;const O=R-C;return O<TH||O>=gNt*g?void 0:c(C,R,f+1)},E=new y0e(m,y,v,x.next,x.mid);return this.bspNodeTree.push(E),E.leftNode=S(h,x.next),E.rightNode=S(x.mid,d),E};c(0,n,0),this.triangleVertexIndices=SNt(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,d=h[0],f=h[1],m=h[2];for(let g=e,y=3*e;g<i;++g){let v=r[y++]*n;const x=s[v++],S=s[v++],E=s[v];v=r[y++]*n;const C=s[v++],R=s[v++],O=s[v];v=r[y++]*n;const U=C-x,L=R-S,B=O-E,G=s[v++]-x,j=s[v++]-S,q=s[v]-E,ie=f*q-j*m,ee=m*G-q*d,K=d*j-G*f,Y=U*ie+L*ee+B*K;if(Math.abs(Y)<=Number.EPSILON)continue;const D=a-x,V=l-S,k=c-E,Z=D*ie+V*ee+k*K;if(Y>0){if(Z<0||Z>Y)continue}else if(Z>0||Z<Y)continue;const Q=V*B-L*k,ne=k*U-B*D,te=D*L-U*V,de=d*Q+f*ne+m*te;if(Y>0){if(de<0||Z+de>Y)continue}else if(de>0||Z+de<Y)continue;const _e=(G*Q+j*ne+q*te)/Y;if(_e>=0){const Ce=this.indices[g]+this.firstTriangleIndex,Pe=Gse(U,L,B,G,j,q,vNt);this._callback(_e,Pe,Ce,!1)}}}hQ.numFacesTested+=i-e}intersectRay(e,i){hQ.numFacesTested=0;const r=Ve(e.r0[0],e.r0[1],e.r0[2]),s=Ve(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<nI)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,i,r){const s=this._rayOrigin,n=this._rayDirection;if(!_Nt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Yne.numFacesTested=0;const vNt=$(),BE=[1/0,1/0,1/0],GE=[-1/0,-1/0,-1/0];function bNt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function wNt(t,e,i,r){if(r<=i)return V2(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)BE[n]=e[s+0+n],GE[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)BE[o]=Math.min(BE[o],e[n+0+o]),GE[o]=Math.max(GE[o],e[n+3+o])}return V2(BE[0],BE[1],BE[2],GE[0],GE[1],GE[2])}function xNt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function TNt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l+0]*s,h=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],g=r[h+f],y=r[d+f];o[6*a+f]=Math.min(m,g,y),o[6*a+3+f]=Math.max(m,g,y)}}return o}function SNt(t,e,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=RFe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const RFe=65535;let Zs=class extends ca{constructor(){super(...arguments),this.output=H.Color,this.overlayMode=P_.Disabled,this.tileBlendInput=ny.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!_r.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=_r.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Ot.Terrain}};u([X({count:H.COUNT})],Zs.prototype,"output",void 0),u([X({count:P_.COUNT})],Zs.prototype,"overlayMode",void 0),u([X({count:ny.COUNT})],Zs.prototype,"tileBlendInput",void 0),u([X()],Zs.prototype,"spherical",void 0),u([X()],Zs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X()],Zs.prototype,"atmosphere",void 0),u([X()],Zs.prototype,"receiveShadows",void 0),u([X()],Zs.prototype,"hasSlicePlane",void 0),u([X()],Zs.prototype,"backfaceCullingEnabled",void 0),u([X()],Zs.prototype,"stencilEnabled",void 0),u([X()],Zs.prototype,"textureFadingEnabled",void 0),u([X()],Zs.prototype,"renderOccluded",void 0),u([X()],Zs.prototype,"hasScreenSpaceReflections",void 0),u([X()],Zs.prototype,"hasCloudsReflections",void 0),u([X()],Zs.prototype,"shading",void 0),u([X()],Zs.prototype,"useLegacyTerrainShading",void 0),u([X()],Zs.prototype,"invisible",void 0),u([X()],Zs.prototype,"tileBorders",void 0),u([X()],Zs.prototype,"visualizeNormals",void 0),u([X()],Zs.prototype,"screenSizePerspective",void 0),u([X()],Zs.prototype,"receiveAmbientOcclusion",void 0),u([X({count:Ot.COUNT})],Zs.prototype,"pbrMode",void 0),u([X({constValue:Pr.CompressedAttribute})],Zs.prototype,"normalType",void 0),u([X({constValue:Nn.Compressed})],Zs.prototype,"textureCoordinateType",void 0),u([X({constValue:!1})],Zs.prototype,"highStepCount",void 0),u([X({constValue:!1})],Zs.prototype,"useCustomDTRExponentForWater",void 0),u([X({constValue:!1})],Zs.prototype,"useFillLights",void 0);const SH=7,ENt=10,EH=Mo();var Lo;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(Lo||(Lo={}));let Du=class extends Ee{get _isGlobal(){return this._stage.viewingMode===it.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=Vs.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Zs,this._passParameters=new sFe,this._rctx=null,this._renderDataPool=new pa(DDt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new XNe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Lo.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ks.Occlude}initialize(){const e=[Ie.OPAQUE_TERRAIN,Ie.TRANSPARENT_TERRAIN,Ie.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),ILt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===Lo.TransparentWithDraped||e===Lo.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return rb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Y9:Ks.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,b(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Gt.TEXTURE_FADING)}updateTileTexture(e,i){b(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,i===Gt.TEXTURE_FADING?go.FADING:go.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Di.ELEVATION])r.pendingUpdates&=~Gt.GEOMETRY;e.resetPendingUpdate(Gt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=ENt-SH,r=Math.max(0,Math.floor((e.level-i)/SH)*SH);if(this._isGlobal&&r===0)return Fl;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=vn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=vn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=vn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new fNt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=aRe(this._rctx)}uninitializeRenderContext(){this._emptyTex=dt(this._emptyTex),this._tileRenderer=dt(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Lo.Opaque)return;const n=CNt,o=MNt;be(n,s,r),fe(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Ga.MIN,d=!!e.results.ground.target,f=Ubt(e.verticalOffset),m=e.tolerance;let g,y=h&&b(a.dist)?a.dist:1/0;const v=S=>{const E=S.renderData;if(!(E!=null&&E.vao))return;const C=E.geometryInfo;Kk(EH,C.boundingBox);const R=E.localOrigin;b(f)&&(f.localOrigin=R,f.applyToAabb(EH));const O=EH;if(jE[0]=r[0]-R[0],jE[1]=r[1]-R[1],jE[2]=r[2]-R[2],!Hse(O,jE,o,m,y))return;const U=(K,Y,D)=>{K.set(this.type,S,Y,D,xd),y=h&&b(a.dist)?a.dist:1/0},L=(K,Y)=>{if(b(Y)&&K>=0&&(e.options.backfacesTerrain||xe(Y,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,s,K))){if((c.dist==null||K<c.dist)&&U(c,K,Y),e.options.isFiltered)return;e.options.store===Ga.ALL&&(A(g)?(g=bse(e.ray),U(g,K,Y),e.results.all.push(g)):K<g.dist&&U(g,K,Y)),(a.dist==null||K<a.dist)&&U(a,K,Y),e.options.store!==Ga.MIN&&(l.dist==null||K>l.dist)&&U(l,K,Y)}},B=ANt;be(B,s,R);const G=C.indices,j=C.vertexAttributes,q=j.getField(P.POSITION,cs),ie=new ct(q.typedBuffer,3,!1,j.stride/4),ee=C.indexCount/3;if(A(f)&&ee>OFe){const K=S.renderData;A(K.intersectionData)&&(K.intersectionData=new Yne(G,0,ee,ie)),K.intersectionData.intersectRay({r0:jE,r1:B},L)}else PD(jE,B,0,ee,G,ie,null,f,L)},x=this._rootTiles;b(x)&&(()=>{const S=this._tileIterator;S.reset(x);const E=e.options.invisibleTerrain;for(let C=S.next();C;C=S.next())!(C.visible||E&&C.intersectsClippingArea)||!b(f)&&!C.intersectsRay(r,n,m,y)||d&&this._useStencilForTile(C)?S.skipSubtree():v(C)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)b((r=n.renderData)==null?void 0:r.textureReference)&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Ie.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&Y9))return null}else{const i=this.transparency===Lo.Opaque?Ie.OPAQUE_TERRAIN:Ie.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}switch(e.output){case H.Color:return this.transparency===Lo.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=b(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?P_.Disabled:this._overlayRenderer.hasWater?P_.EnabledWithWater:P_.Enabled,this._updateTechnique(H.Color,e.bindParameters.slot===Ie.OCCLUDED_TERRAIN));case H.Shadow:case H.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(H.Shadow,!1)):null;case H.Depth:return this.transparency===Lo.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(H.Depth,!1));case H.Normal:return this.transparency===Lo.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(H.Normal,!1));case H.ObjectAndLayerIdColor:return this.transparency===Lo.Empty?null:this._updateTechnique(H.ObjectAndLayerIdColor,!1);case H.Highlight:return this.transparency!==Lo.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(H.Highlight,!1)):null}return null}render(e,i){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case H.Color:{const s=e.bindParameters.slot===Ie.OCCLUDED_TERRAIN?Kc.Occluded:Kc.ColorAndWater;this.transparency===Lo.Opaque?this._renderMaterialPass(e,i,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,i,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case H.Depth:case H.Normal:this._renderAuxiliaryPass(e,i,Kc.None);break;case H.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,i,Kc.Highlight);break;case H.Shadow:case H.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,i,Kc.None);break;case H.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,Kc.ObjectAndLayerIdColor)}}_renderMaterialPass(e,i,r){const{rctx:s}=e;this._passParameters.overlaySource=r,s.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,i,r)}_renderAuxiliaryPass(e,i,r){const s=e.rctx;this._passParameters.overlaySource=r,s.bindTechnique(i,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,i,r)}updateTileBackground(e=null){if(A(this._tileRenderer))return;const i=this._tileRenderer;let r=null;if(b(e)){const s=et.toUnitRGBA(e);r=Ve(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,go.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?ny.GridComposite:b(i.backgroundColor)?ny.ColorComposite:ny.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==h3.NONE){const e=Array.from(this._patchGroups.values()),i=this._stencilEnabledLayerExtents;for(const r of e)ZNe(this.renderOrder,r,i);e.sort((r,s)=>JNe(r[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(!A(e)){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderPatchGroupsAuxiliary(e,i,r){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;i.program.bindDraw(new UK(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,i,n[a],Xt.TRIANGLES,s,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,i,r){const s=e.bindParameters.camera,n=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=FIe(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=r===Kc.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Fl),n.setUniform4fv("texOffsetAndScale",fy));const l=b(this._tileRenderer)&&b(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Fl;this._techniqueConfiguration.tileBlendInput===ny.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Xt.LINES:Xt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const d of h.values()){const f=d[0].renderData.localOrigin;i.program.bindDraw(new UK(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of d){const g=m.renderData,y=g.textureReference;if(!A(y)){if(!a){n.setUniform4fv("texOffsetAndScale",y.offsetAndScale),n.bindTexture("tex",y.texture.texture);const v=g.textureFadeFactor,x=v<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b(x)&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),n.setUniform3fv("nextTexOpacities",x.opacities),n.bindTexture("texNext",x.texture.texture)):n.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,i,m,c,o,r),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l.indexBuffer;if(A(c))return void(So&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o===Kc.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),i.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,e===H.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=i,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(nFe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([p({constructOnly:!0})],Du.prototype,"_overlayRenderer",void 0),u([p({constructOnly:!0})],Du.prototype,"_stage",void 0),u([p({readOnly:!0})],Du.prototype,"_isGlobal",null),u([p({constructOnly:!0})],Du.prototype,"_allTiles",void 0),u([p({constructOnly:!0})],Du.prototype,"_ellipsoidRadius",void 0),u([p({value:!1})],Du.prototype,"renderingDisabled",null),u([p()],Du.prototype,"renderPatchBorders",null),u([p()],Du.prototype,"visualizeNormals",null),u([p()],Du.prototype,"cullBackFaces",null),u([p({value:h3.FRONT_TO_BACK})],Du.prototype,"renderOrder",null),u([p()],Du.prototype,"wireframe",null),Du=u([N("esri.views.3d.terrain.TerrainRenderer")],Du);const CNt=$(),MNt=$(),jE=$(),ANt=$();let ONt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Dg=class extends Ee{constructor(e){super(e),this._handles=new ir}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ae(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=He(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!xI(i)||i.isRejected())&&!(i.isFulfilled()&&!RNt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||ek(i)))),e)if(e.isResolved()){const i=Wz(e,this.viewSpatialReference,this.viewingMode);if(b(i)){const r=new Zu(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===it.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=Zu.makeWebMercatorAuxiliarySphere(i):j2(e.spatialReference)&&(e=Zu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ae(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===it.Global){const e=this.extentHelper.viewSpatialReference,i=j2(e)||Ly(e)||Dy(e);e.isWebMercator?this.tilingScheme=Zu.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=Zu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;b(e)&&!p2(e,this.extent)&&(this.tilingScheme=Zu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function RNt(t,e,i){return b(Wz(t,e,i))}u([p()],Dg.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Dg.prototype,"extent",void 0),u([p({value:!1})],Dg.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],Dg.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],Dg.prototype,"layers",void 0),u([p({constructOnly:!0})],Dg.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],Dg.prototype,"viewingMode",void 0),Dg=u([N("esri.views.3d.terrain.TilingSchemeLogic")],Dg);let PNt=class{constructor(){this.offset=je(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},xi=class extends ws.EventedMixin(Ee){constructor(e){var i,r;super(e),this._scaleRangeQueries=new y8,this._iteratorPool=new pa(XNe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new ULt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new ONt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=$(),this._eyePosSurfaceSR=$(),this._splitLimits=new nNt,this._frustum=J$(),this._viewProjectionMatrix=Ge(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new ir,this._watchUpdatingTracking=new dy,this._frameTask=WA,this._allTiles=new vi,this._upsampleInfoPool=new pa(PNt),this._rootTilesExtent=bi(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ye.WebMercator,this.visibleElevationBounds=new $M(1/0,-1/0),this.rootTileElevationBounds=new $M(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((r=(i=e.view)==null?void 0:i.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=lLt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new pa(tNt):new pa(rNt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new oLt(e.newCache("elevation-query")),this._set("overlayManager",new qc({surface:this})),this._handles.add([ae(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ae(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ae(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Du({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:ur(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ae(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?go.UNFADED:go.IMMEDIATE)},Tr),ae(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?go.UNFADED:go.IMMEDIATE),Tr),ae(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Mi),ae(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Tr),ae(()=>this.snapLevel,()=>this._viewChanged=!0,Mi),ae(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ae(()=>_r.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?se(()=>import("./TerrainTileTree3DDebugger-75349929.js"),["assets/TerrainTileTree3DDebugger-75349929.js","assets/TileTreeDebugger-6f984adc.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&_r.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=He(this._treeDebugger))},ii)]);const{spatialReference:i}=this.view;this._extentHelper=SLt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:i});const r=new Gb({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Dg({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:i});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Kg.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Kg.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(Nt.TERRAIN_SURFACE,this),this._handles.add([ae(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),ii),ae(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Mi),ae(()=>this.extent,()=>this._updateRootTiles(),ii),this.view.on("resize",()=>this._viewChangeUpdate()),ae(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Tr),ae(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,ii),ae(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Ot.Terrain:Ot.Disabled,ii),ae(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Mi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([ae(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Os(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=He(this._upsampleMapCache),this._elevationQueryCache=He(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",He(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((i,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",He(this.overlayManager)),this._tilePool=He(this._tilePool),Bne.prune(),this._treeDebugger=He(this._treeDebugger),this._renderer=He(this._renderer),this._iteratorPool=He(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=He(this._upsampleInfoPool),vLt(),fDt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,i;if(this.lodSnapping===KI.ON){const r=this.view,s=this.tilingScheme,n=(i=(e=r.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:i.scale;if(n&&s){const o=r.state.contentCamera;let a=wz(r,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?KI.ON:KI.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:i}=this.view;if(A(i)||A(e))return null;const r=bi(),s=RNe(i,r,e)?r:null,n=this._get("extent");return p2(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=UW(this.groundExtent,this._userClippingExtent,bi()),i=this._get("extent");return p2(e,i)?i:e}get groundExtent(){return b(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return b(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===Lo.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,i,r,s){this._renderer.intersect(e,i,r,s)}getElevation(e,i,r,s){const n=this._rootTiles;if(A(n)||!n.length||n[0].layerInfo[Di.ELEVATION].length===0)return null;const o=Dc;return o[0]=e,o[1]=i,o[2]=r,_a(o,s,o,this._spatialReference)?v0e(n,o[0],o[1]):(le.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,i,r){const s=this._rootTiles,n=s?s[0].layerInfo[Di.ELEVATION].length:0;if(!A(s)&&s.length&&n!==0)for(let o=0;o<i;++o){const a=3*o;r(o,v0e(s,e[a+0],e[a+1]))}else for(let o=0;o<i;++o)r(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!ll(e,Dc,this.spatialReference))return le.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(b(i)){for(const r of i)if(r!=null&&r.containsPoint(Dc)){let s=r;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;Dc[0]>n[2]&&(o+=1),Dc[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,i,r,s,n){var h;if(Dc[0]=e,Dc[1]=i,Dc[2]=r,Dc[3]=s,!_a(Dc,n,Dc,(h=this.tilingScheme)==null?void 0:h.spatialReference))return le.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=d=>{if(d&&Ule(d.extent,Dc))if(d.isLeaf||d.rendered)o=Math.min(o,d.elevationBounds[0]),a=Math.max(a,d.elevationBounds[1]);else for(const f of d.children)l(f)},c=this._rootTiles;if(b(c))for(const d of c)l(d);return{min:o,max:a}}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!ll(e,Dc,this.spatialReference))return le.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Dc[3]=i;let r=null;const s=o=>{if(o&&Ule(o.extent,Dc)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);r=r==null?l:Math.min(r,l)}}},n=this._rootTiles;if(b(n))for(const o of n)s(o);return r}queryVisibleScaleRange(e,i,r,s){const n=i?this.tilingScheme.levelAtScale(i):0,o=r?this.tilingScheme.levelAtScale(r):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?i?Lo.Empty:Lo.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Lo.Opaque:Lo.Semitransparent,n=r!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var r,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;jg(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(r=this.view)==null?void 0:r.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const i=(e==null?void 0:e.spatialReference)??Ye.WebMercator;this._spatialReference=i,this._isWebMercator=!!(i!=null&&i.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&Iee((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,i,r,s){const n=this._tilePool.acquire();return j4[0]=e,j4[1]=i,j4[2]=r,n.init(j4,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=LNt;let s=i.rootTilesInExtent(e,r,5*xM);if(b(this._rootTiles)){if(s.length>xM)return void le.getLogger(this.declaredClass).warn(Lyt);const n=this._rootTiles.map(a=>a.lij),o=MGe(n,s,_0e);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>_0e(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>xM&&(le.getLogger(this.declaredClass).warn(Dyt),s=i.rootTilesInExtent(e,r,xM)),this._setRootTiles(s.map(n=>this._newRootTile(n)));p2(r,this._rootTilesExtent)||(this._rootTilesExtent=bi(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.isLoaded&&i.intersectsClippingArea);e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(R_);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Gt.SPLIT}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(Gt.SPLIT),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),b(e)){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Gt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(A(e))return;const i=HLt(e),r=this.visibleElevationBounds;let s=i?r.min:1/0,n=i?r.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(Gt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(Gt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(r.min!==s||r.max!==n)&&(this.visibleElevationBounds=new $M(s,n))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;b(r)&&r.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),i=Math.max(i,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===i||(this.rootTileElevationBounds=new $M(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),s=Math.tan(.5*i.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(A(this._splitLimits.frustum)&&(this._splitLimits.frustum=J$()),m9(this._splitLimits.frustum,i.frustum)):this._splitLimits.frustum=null,m9(this._frustum,e.frustum),ln(this._viewProjectionMatrix,i.projectionMatrix,i.viewMatrix),ge(this._eyePosRenderSR,i.eye),_a(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(PFe(e)?this._loadChildren(e):$Nt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const i=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(Gt.TEXTURE_FADING)?Gt.TEXTURE_FADING:!!e.resetPendingUpdate(Gt.TEXTURE_NOFADING)&&Gt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){const e=MH.extent;kp(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>Mb(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),MH.spatialReference=this.spatialReference,this.emit("elevation-change",MH)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=this._iteratorPool.acquire();i.reset(this._rootTiles);const r=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!i.done;){const o=i.next(),a=o.shouldSplit(s,n,r);if(a!==Gt.SPLIT){if(o.resetPendingUpdate(Gt.SPLIT)&&o.updateAgentSuspension(),a===Gt.VSPLITMERGE&&o.updateAgents(Di.ELEVATION),i.skipSubtree(),!o.isLeaf){o.setPendingUpdate(Gt.MERGE),o.resetPendingUpdate(Gt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(Gt.MERGE),o.isLeaf&&(o.setPendingUpdate(Gt.SPLIT),i.skipSubtree()),o.rendered&&o.setPendingUpdate(Gt.RENDERDATA)}i.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(GLt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){ke(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const i=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),r=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),i.push(o),o.renderData.updateNeighborData())};i.sort(R_);const s=i.length;for(let n=0;n<s;++n){const o=i[n];ke(o.isLoaded),ke(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let h=0;h<4;++h)if(l&1<<h){const d=a.geometryState.neighborData.edgePeerNeighbors[h];d&&(d==null?void 0:d.level)>=o.level&&d.forAllSubtreeOnSide(ik(sy[h]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(ke(e.has(f)||R_(o,f)<0),r(o,f),!0)),r(o,c.cornerPeerNeighbors[h]),r(o,c.cornerPeerNeighbors[(h+1)%4])}}e.clear(),this._updateTilesGeometries(i),So&&Q9&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!r&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(Gt.MERGE)){if(!i)return l.setPendingUpdate(Gt.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(Gt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(Gt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(Gt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!r){r=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(Gt.GEOMETRY)&&(this._updateTileGeometryState(i),this._updateTileTexture(i,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(vn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Iyt}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=Se(e-this._lodBias,0,i.length-1),s=r-Math.floor(r);return i[Math.floor(r)].scale*(1-s)+i[Math.ceil(r)].scale*s}_removeAllTiles(){b(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let i=!1;for(let r=0;r<4;++r)i=this._purgeTile(e.children[r])||i;return e.unsetChildren(),i}_purgeTile(e){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),i}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){jg(e.isLeaf,"tile that is already split should not be split again!");const i=e.level+1,r=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(i,r,s,e),this._createTile(i,r,s+1,e),this._createTile(i,r+1,s,e),this._createTile(i,r+1,s+1,e)),e.setPendingUpdate(Gt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){H4.spatialReference=this.spatialReference,H4.extent=e.extent,H4.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",H4)}_createTile(e,i,r,s){jg(!!s,"_createTile sanity check");const n=this._acquireTile(e,i,r,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(Gt.SPLIT),n}get shortBatches(){return this.view.state.mode!==Ki.IDLE}_mergeTile(e){jg(!e.hasPendingUpdate(Gt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(jg(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){jg(e.rendered,"parent should be rendered"),this._unloadTile(e);const i=e.children;i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const i=e.parent;this._unloadChildren(i),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i,i.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const i=e.children;if(i[0])for(let r=0;r<4;++r){const s=i[r];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(Gt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,i,r){const s=new xLt(e.lij,e.extent,r);e.dataArrived(i,Di.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(i,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=gc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(r.add(n.uid),wL(n)||vR(n))if(this._basemapLayerViewHandles.has(n.uid)&&!vR(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);b(a)&&((a<s||A(s))&&(i=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(i=!0);this._basemapLayerViewHandles.forEach((n,o)=>{r.has(o)||(this._unregisterTiledLayerView(o),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var i,r;let e=((r=(i=this.view.map)==null?void 0:i.ground)==null?void 0:r.opacity)===0;for(const s of this.view.allLayerViews.items)if(iQ(s)&&!Mwe(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((tk(e)||vR(e))&&JLt(aQ[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return tQ(e)?Di.ELEVATION:Di.MAP}_registerTiledLayerView(e){const i=[];if((tk(e)||vR(e))&&i.push(ae(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(go.UNFADED)})),vR(e))return;const r=this._layerClassFromLayerView(e);i.push(ae(()=>e.suspended,()=>this._updateTiledLayers())),i.push(ae(()=>e.fullOpacity,()=>this._updateTileTextures(go.UNFADED))),i.push(ae(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.on("data-changed",()=>{const s=this._getLayerIdxByUID(r,e.uid);b(s)&&this._invalidateLayerData(s,r)}),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(let r=0;r<i.length;r++)i[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(s=>{if(!s.layer||s.suspended||!wL(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===Di.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(r===null||o>r)&&(r=o)}i[n].push(s)});for(const s of yT){const n=this._layerViews[s],o=i[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let d=0;d<a;d++){const f=o[d].uid;this._layerIndexByUid[s].set(f,d);const m=n.indexOf(o[d]);c[d]=m,d!==m&&(l=!0),m>-1&&(h[m]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===Di.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(Di.MAP),e===go.IMMEDIATE?this.renderer.updateTileTexture(i,Gt.TEXTURE_NOFADING):i.updateRenderData(Di.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=vn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,s){const n=this.layerViewByIndex(i,r),o=n.layer;return!o.tilemapCache||bL(n)?this._requestTileData(e,r,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,_i(s),kn(a)||this._dataMissing(e,r,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,n,s),s.signal)))}_requestTileData(e,i,r,s){return i===Di.ELEVATION?tQ(r)?this._requestElevationTileData(e,r,s):Promise.reject():iQ(r)?this._requestMapTileData(e,r,s):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const s=a=>{if(yo(r))return;const l=this._layerIndexByUid[Di.ELEVATION].get(i.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):le.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",Di.ELEVATION,e.lij.toString())},n=a=>{kn(a)||(this._dataMissing(e,Di.ELEVATION,i,a),this.requestUpdate())};if(Nye(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:q$,signal:r.signal}).then(a=>{if(!yo(r))return this._frameTask.schedule(()=>s(a),r.signal,n);le.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",r).then(a=>this._lercDecoder.decode(a,{noDataValue:q$},r.signal)).then(a=>{a?s(new aLt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,i,r){++this._asyncWorkItems;const s=(h,d)=>{--this._asyncWorkItems,hA(d),yo(r)||(this._dataMissing(e,Di.MAP,i,h),this.requestUpdate())},n=h=>d=>s(d,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),yo(r)?hA(h):this._mapTileDataArrived(e,i,h)},r.signal,n(h)).catch(n(h)),a=(h,d=null)=>this._frameTask.schedule(()=>s(h,d));if(bL(i)){const h=i.schemaHelper.getLevelRowColumn(e.lij);return i.fetchTile(h[0],h[1],h[2],r).then(o,a)}if(qz(i))return i.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(o,a);if(Fne(i)&&Nye(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(h=>{if(yo(r))return le.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(er());o(h)},a);let l=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);iht(i.layer)&&i.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${i.layer.refreshTimestamp}`);const c=i.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,r).then(o,a)}_mapTileDataArrived(e,i,r){const s=this._getLayerIdxByUID(Di.MAP,i.uid);b(s)?e.dataArrived(s,Di.MAP,r):(hA(r),le.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,i){return this._layerIndexByUid[e].get(i)}_dataMissing(e,i,r,s){const n=this._getLayerIdxByUID(i,r.uid);b(n)?e.dataMissing(n,i,s):le.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(i=>{i.renderData&&this.overlayManager.setTileParameters(i)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.isLeaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(A(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),b(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,i)=>e+i.usedMemory,0):null}getUsedMemoryForLayerView(e){let i=0;const r=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(r,e.uid);return b(s)&&this._allTiles.forAll(n=>i+=n.getUsedMemoryForLayer(r,s)),i}getTile(e){if(A(e)||A(this._rootTiles))return null;const i=e.split("/").map(a=>+a);if(i[0]===0)return this._rootTiles.find(a=>a.lij[1]===i[1]&&a.lij[2]===i[2]);const r=2**i[0],s=Math.floor(i[1]/r),n=Math.floor(i[2]/r);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<i[0]-1;for(;o.lij[0]<i[0];){let l=i[1]&a?2:0;if((i[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return jg(o.lij[0]===i[0]&&o.lij[1]===i[1]&&o.lij[2]===i[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{b(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){CH.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&CH.push(r)});const i=CH.toArray();return ZNe(e.renderOrder,i),i},lockTilingScheme(i,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(i)}}}checkAllTilesWaterproofness(){if(!Q9)return;const e=this._rootTiles;if(A(e))return;const i=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},r=(o,a)=>{i(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),i(o)){o.checkGeometryWaterproofness();for(const c of o.children)r(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const d of o.children)n(d)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var i,r,s;((s=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:s.shading)!==this._shading&&this._updateShading()}_updateShading(){var i,r,s;const e=(s=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:s.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(b(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this.isGlobal)return null;const s=(r+(r<0?i:0))%i;return[e[0],e[1],s]}enableInternalChecks(e){O$t(e)}enableWaterproofnessChecks(e){A$t(e)}};u([p()],xi.prototype,"_renderer",void 0),u([p({constructOnly:!0})],xi.prototype,"_scaleRangeQueries",void 0),u([p()],xi.prototype,"_hasPendingUpdates",void 0),u([p()],xi.prototype,"_asyncWorkItems",void 0),u([p()],xi.prototype,"_allTilesDirty",void 0),u([p()],xi.prototype,"_allTilesSorted",void 0),u([p()],xi.prototype,"_viewChanged",void 0),u([p({readOnly:!0})],xi.prototype,"_watchUpdatingTracking",void 0),u([p()],xi.prototype,"_frameTask",void 0),u([p({readOnly:!0})],xi.prototype,"snapLevel",null),u([p({readOnly:!0})],xi.prototype,"lodSnapping",null),u([p({constructOnly:!0})],xi.prototype,"view",void 0),u([p()],xi.prototype,"_userClippingExtent",null),u([p()],xi.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],xi.prototype,"extent",null),u([p({readOnly:!0})],xi.prototype,"groundExtent",null),u([p({readOnly:!0})],xi.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],xi.prototype,"updating",null),u([p({readOnly:!0})],xi.prototype,"running",null),u([p(bLt)],xi.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],xi.prototype,"updatingProgressValue",null),u([p()],xi.prototype,"_maxNumUpdating",void 0),u([p()],xi.prototype,"baseOpacity",null),u([p()],xi.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],xi.prototype,"overlayManager",void 0),u([p({readOnly:!0})],xi.prototype,"viewingMode",null),u([p()],xi.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],xi.prototype,"ready",null),u([p({value:h3.FRONT_TO_BACK})],xi.prototype,"renderOrder",null),u([p({readOnly:!0})],xi.prototype,"rootTiles",null),u([p()],xi.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],xi.prototype,"spatialReference",null),u([p({type:et})],xi.prototype,"backgroundColor",null),u([p({value:!1})],xi.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],xi.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],xi.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],xi.prototype,"tilingSchemeLogic",void 0),u([p({value:!0})],xi.prototype,"velvetOverground",null),u([p()],xi.prototype,"wireframe",null),u([p({value:!1})],xi.prototype,"suspended",null),u([p()],xi.prototype,"textureFadeDuration",null),u([p()],xi.prototype,"visibleElevationBounds",void 0),u([p()],xi.prototype,"rootTileElevationBounds",void 0),u([p()],xi.prototype,"_layerViewsDirty",void 0),u([p()],xi.prototype,"renderPatchBorders",null),u([p()],xi.prototype,"visualizeNormals",null),u([p()],xi.prototype,"renderingDisabled",null),xi=u([N("esri.views.3d.terrain.TerrainSurface")],xi);const INt=xi;function _0e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function PFe(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(PFe(i))return!0;return!1}function $Nt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const Dc=Ai(),LNt=bi(),j4=[0,0,0],CH=new vi,MH={spatialReference:null,extent:bi(),context:"ground"},H4={spatialReference:null,extent:null,scale:0};function v0e(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return Rs(e,i,o)}return null}let DNt=class{constructor(e,i,r){this.operation=e,this.geometry=i,this.states=r}},oI=class extends Ee{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let d=!1;if(l===Js.UPDATE){const f=o.get(h);if(f){if(c&Fo.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||i.updates.push({renderGeometry:f,updateType:c})}else Rt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Js.REMOVE||d){const f=o.get(h);f?(i.removes.push(f),o.delete(h)):l===Js.REMOVE&&Rt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Js.ADD||d){const f=this.model.getObject(n);if(b(f)){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,Js.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Fo.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Fo.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Fo.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Js.UPDATE,Fo.GEOMETRY)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._objectGeometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._objectGeometryRemoved(i,s,r)}shaderTransformationChanged(e){const i=this._residentGeomRecords.get(e.id);i&&i.forEach((r,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&r.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,Js.UPDATE,Fo.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Js.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Js.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Fo.NONE){r=vt(r,this._getParentLayerId(e));const o=e.id,a=i.id,l=this._ensureDirtyRecord(r,o),c=l.get(a);if(c){const h=c.operation;h===Js.REMOVE&&s===Js.ADD&&c.states!==Fo.NONE?c.operation=Js.UPDATE:h===Js.REMOVE&&s===Js.ADD||h===Js.ADD&&s===Js.REMOVE?l.delete(a):h!==Js.UPDATE||s!==Js.REMOVE&&s!==Js.UPDATE?(Rt((h===Js.REMOVE||h===Js.ADD)&&s===Js.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new DNt(s,i,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){return ua(this._dirtyGeomRecords,e=>ua(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return b(e.parentLayer)?e.parentLayer.id:Sje}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,s)=>e.commitLayer(s,i))}}};u([p({constructOnly:!0})],oI.prototype,"model",void 0),u([p()],oI.prototype,"dirty",void 0),oI=u([N("esri.views.3d.webgl-engine.lib.ModelDirtySet")],oI);const NNt=oI;let v8=class extends Ee{constructor(){super(...arguments),this.dirtySet=new NNt({model:this}),this._content=new Map,this._originFactory=new fne(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;Rt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),j9(e)&&this.dirtySet.layerAdded(e)}remove(e){Rt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),j9(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const i of e)b(i)&&(Rt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)Rt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id),i.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const{shaderTransformer:r,localOrigin:s}=i,n=new u3(i,{boundingInfo:i.boundingInfo,shaderTransformer:r,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(i,o)),n.localOrigin=b(s)?s:this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,i,r){if(A(e))return!1;r.updateTransformation(n=>e.getCombinedStaticTransformation(i,n));const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<xn.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([p({constructOnly:!0})],v8.prototype,"dirtySet",void 0),v8=u([N("esri.views.3d.webgl-engine.parts.Model")],v8);function FNt(){const t=new Float32Array(4);return t[3]=1,t}function IFe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function UNt(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function $Fe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:IFe,create:FNt,createView:$Fe,fromValues:UNt},Symbol.toStringTag,{value:"Module"}));const d3=1e-6,SR=[0,0,0],q4=[0,0,0];function kNt(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new YNt(t);b8(SR,n.minProj,n.maxProj),qT(SR,SR,.5),bp(q4,n.maxProj,n.minProj);const o=dQ(q4),a=new XNt;a.quality=o,s<14&&(t=new ct(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(VNt(n,t,g,l,c,h,d,f,m,a)){case 1:return void T0e(SR,q4,e);case 2:return void WNt(t,d,e)}zNt(t,g,l,c,h,d,f,m,a),LFe(t,a.b0,a.b1,a.b2,fA,mA);const y=[0,0,0];bp(y,mA,fA),a.quality=dQ(y),a.quality<o?DFe(a.b0,a.b1,a.b2,fA,mA,y,e):T0e(SR,q4,e)}function VNt(t,e,i,r,s,n,o,a,l,c){return BNt(t,r,s),pQ(r,s)<d3?1:(bp(o,r,s),Za(o,o),GNt(e,r,o,n)<d3?2:(bp(a,s,n),Za(a,a),bp(l,n,r),Za(l,l),wp(i,a,o),Za(i,i),_T(e,i,o,a,l,c),0))}const ER=[0,0,0],CR=[0,0,0],kd=[0,0,0],Vd=[0,0,0],zd=[0,0,0],i1=[0,0,0],r1=[0,0,0],s1=[0,0,0];function zNt(t,e,i,r,s,n,o,a,l){jNt(t,e,i,ER,CR),ER[0]!==void 0&&(bp(kd,ER,i),Za(kd,kd),bp(Vd,ER,r),Za(Vd,Vd),bp(zd,ER,s),Za(zd,zd),wp(i1,Vd,n),Za(i1,i1),wp(r1,zd,o),Za(r1,r1),wp(s1,kd,a),Za(s1,s1),_T(t,i1,n,Vd,kd,l),_T(t,r1,o,zd,Vd,l),_T(t,s1,a,kd,zd,l)),CR[0]!==void 0&&(bp(kd,CR,i),Za(kd,kd),bp(Vd,CR,r),Za(Vd,Vd),bp(zd,CR,s),Za(zd,zd),wp(i1,Vd,n),Za(i1,i1),wp(r1,zd,o),Za(r1,r1),wp(s1,kd,a),Za(s1,s1),_T(t,i1,n,Vd,kd,l),_T(t,r1,o,zd,Vd,l),_T(t,s1,a,kd,zd,l))}function BNt(t,e,i){let r=pQ(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=pQ(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}sh(e,t.minVert[s]),sh(i,t.maxVert[s])}const Bd=[0,0,0];function GNt(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Bd[0]=s[l]-e[0],Bd[1]=s[l+1]-e[1],Bd[2]=s[l+2]-e[2];const c=i[0]*Bd[0]+i[1]*Bd[1]+i[2]*Bd[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=Bd[0]*Bd[0]+Bd[1]*Bd[1]+Bd[2]*Bd[2]-c*c/h;d>o&&(o=d,a=l)}return sh(r,s,a),o}const Do=[0,0];function jNt(t,e,i,r,s){qNt(t,e,Do,s,r);const n=FFe(i,e);Do[1]-d3<=n&&(r[0]=void 0),Do[0]+d3>=n&&(s[0]=void 0)}const b0e=[0,0,0],w0e=[0,0,0],x0e=[0,0,0],HE=[0,0,0],qE=[0,0,0],W4=[0,0,0];function _T(t,e,i,r,s,n){if(NFe(e)<d3)return;wp(b0e,i,e),wp(w0e,r,e),wp(x0e,s,e),pA(t,e,Do),qE[1]=Do[0],HE[1]=Do[1],W4[1]=HE[1]-qE[1];const o=[i,r,s],a=[b0e,w0e,x0e];for(let l=0;l<3;++l){pA(t,o[l],Do),qE[0]=Do[0],HE[0]=Do[1],pA(t,a[l],Do),qE[2]=Do[0],HE[2]=Do[1],W4[0]=HE[0]-qE[0],W4[2]=HE[2]-qE[2];const c=dQ(W4);c<n.quality&&(sh(n.b0,o[l]),sh(n.b1,e),sh(n.b2,a[l]),n.quality=c)}}const HNt=[0,0,0];function pA(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function qNt(t,e,i,r,s){const{data:n,size:o}=t;sh(r,n),sh(s,r),i[0]=FFe(HNt,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,sh(r,n,a)),l>i[1]&&(i[1]=l,sh(s,n,a))}}function T0e(t,e,i){sh(i.center,t),qT(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const m0=[0,0,0],WE=[0,0,0],MR=[0,0,0],fA=[0,0,0],mA=[0,0,0],S0e=[0,0,0];function WNt(t,e,i){sh(m0,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?m0[0]=0:Math.abs(e[1])>Math.abs(e[2])?m0[1]=0:m0[2]=0,NFe(m0)<d3&&(m0[0]=m0[1]=m0[2]=1),wp(WE,e,m0),Za(WE,WE),wp(MR,e,WE),Za(MR,MR),LFe(t,e,WE,MR,fA,mA),bp(S0e,mA,fA),DFe(e,WE,MR,fA,mA,S0e,i)}function LFe(t,e,i,r,s,n){pA(t,e,Do),s[0]=Do[0],n[0]=Do[1],pA(t,i,Do),s[1]=Do[0],n[1]=Do[1],pA(t,r,Do),s[2]=Do[0],n[2]=Do[1]}const Y4=[0,0,0],hg=[1,0,0,0,1,0,0,0,1],YE=[0,0,0];function DFe(t,e,i,r,s,n,o){hg[0]=t[0],hg[1]=t[1],hg[2]=t[2],hg[3]=e[0],hg[4]=e[1],hg[5]=e[2],hg[6]=i[0],hg[7]=i[1],hg[8]=i[2],ZNt(o.quaternion,hg),b8(YE,r,s),qT(YE,YE,.5),qT(o.center,t,YE[0]),qT(Y4,e,YE[1]),b8(o.center,o.center,Y4),qT(Y4,i,YE[2]),b8(o.center,o.center,Y4),qT(o.halfSize,n,.5)}const Rh=7;let YNt=class{constructor(e){this.minVert=new Array(Rh),this.maxVert=new Array(Rh);const i=64*Rh;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Rh),r+=8*Rh,this.maxProj=new Float64Array(this.buffer,r,Rh),r+=8*Rh;for(let l=0;l<Rh;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Rh;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Rh;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Rh),n=new Array(Rh),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Rh;++l){let c=s[l];sh(this.minVert[l],o,c),c=n[l],sh(this.maxVert[l],o,c)}}},XNt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function dQ(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function b8(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function bp(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function qT(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function sh(t,e,i=0){t[0]=e[i+0],t[1]=e[i+1],t[2]=e[i+2]}function wp(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function Za(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function NFe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function pQ(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function FFe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ZNt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}}const a$=Kp(),h2=$(),JNt=$(),KNt=Hs();let _ni=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Yee(this.buffer,56*a+0),halfSize:cRe(this.buffer,56*a+24),quaternion:$Fe(this.buffer,56*a+36)}}};function UFe(t=[0,0,0],e=[-1,-1,-1],i=Kp()){return{center:zr(t),halfSize:f9(e),quaternion:IFe(i)}}function E0e(t){return UFe(t.center,t.halfSize,t.quaternion)}function bni(t,e){ge(e.center,t.center),ge(e.halfSize,t.halfSize),mse(e.quaternion,t.quaternion)}function wni(t,e){return e=e||UFe(),kNt(t,e),e}function vT(t,e){const i=Kr(e,t.center),r=Kz(t,e);return i>r?1:i<-r?-1:0}function xni(t,e){e||(e=Mo());const i=gre(KNt,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),s=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),n=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+r,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function Tni(t,e){return Kr(e,t.center)-Kz(t,e)}function Sni(t,e){return Kr(e,t.center)+Kz(t,e)}function Eni(t,e){return vT(t,e[0])<=0&&vT(t,e[1])<=0&&vT(t,e[2])<=0&&vT(t,e[3])<=0&&vT(t,e[4])<=0&&vT(t,e[5])<=0}function Cni(t,e,i,r=0){sS(a$,t.quaternion),be(h2,e,t.center);const s=mm(h2,h2,a$),n=mm(JNt,i,a$);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+t.halfSize[l]-s[l])/n[l],h=(-r-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+r||s[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function Kz(t,e){sS(a$,t.quaternion),mm(h2,e,a$);const i=t.halfSize;return Math.abs(h2[0]*i[0])+Math.abs(h2[1]*i[1])+Math.abs(h2[2]*i[2])}function Mni(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],mm(r,r,t.quaternion),we(r,r,t.center)}}function QNt(t){return Bu(t.halfSize)}function eFt(t,e,i,r,s){if(mse(s.quaternion,t.quaternion),r===it.Global){sS(X4,t.quaternion),mm(n1,t.center,X4),Hq(XE,n1),Vwe(ZE,XE,t.halfSize),as(ZE,XE,ZE);const n=ze(ZE);we(ZE,XE,t.halfSize);const o=ze(ZE);if(n<i)ge(s.center,t.center),fe(n1,i,i,i),we(s.halfSize,t.halfSize,n1);else{const a=o>0?1+e/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;pe(s.halfSize,XE,h),eh(s.halfSize,s.halfSize,t.halfSize,c),pe(s.center,XE,c),eh(s.center,s.center,t.halfSize,h),kwe(n1,n1),Uk(s.center,s.center,n1),mm(s.center,s.center,s.quaternion)}}else{const n=fe(n1,0,0,1);eh(s.center,t.center,n,(i+e)/2),sS(X4,t.quaternion),mm(n,n,X4),Hq(n,n),eh(s.halfSize,t.halfSize,n,(i-e)/2)}return s}const n1=$(),XE=$(),ZE=$(),X4=Kp();let tFt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=iFt(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function iFt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let rFt=class{constructor(e,i){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=i.slice();const r=this.count;this.visibility=new tFt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return A(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return A(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return A(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((A(this.cachedHighlightRanges)||A(this.cachedDefaultRanges))&&b(this.highlightCounts)){const{highlightRanges:e,defaultRanges:i}=sFt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function sFt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let aI=class extends Ee{constructor(){super(...arguments),this.visible=gA.Hidden}};var gA;u([p({autoDestroy:!0})],aI.prototype,"renderable",void 0),u([p({autoDestroy:!0})],aI.prototype,"components",void 0),aI=u([N("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],aI),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(gA||(gA={}));function nFt(t,e,i,r){if(i>=e)return t;t==null&&(t=oFt());const s=t.isVisibleBit;let n=t.data;const o=VFe(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=n,d=r===s;if(!(i<h.length*o)&&d){const m=a+1,g=Math.ceil(h.length*1.5),y=c+1;let v=Math.max(m,g);v=Math.min(v,y),n=new Uint32Array(v),n.set(h)}return a<n.length&&(n[a]=lFt(n[a],l,d)),t.data=n,t}function kFe(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=VFe(r);return e<r.length*s?aFt(i,r,e,s):!t.isVisibleBit}function oFt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function aFt(t,e,i,r){const s=i/r|0,n=i-s*r;return cFt(e[s],n)===t}function VFe(t){return t.BYTES_PER_ELEMENT*8}function lFt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function cFt(t,e){return(t&1<<e)!=0}let uFt=class{constructor(e,i){this._indices=b(e.indices)?e.indices:i3(e.positions.length/3),this._positions=new cs(e.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(e,i){if(b(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(e,i)}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a){const l=new ct(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,d=QIe(e,i,hFt),f=e[2],m=i[2];this._components.visibility.forEachComponent(g=>{if(!kFe(this._components.pickability,g))return!0;const y=this.getComponentAabb(g,dFt);if(b(o)){const C=o[g];b(n)?n.componentOffset=C:(e[2]=f-C,i[2]=m-C)}if(b(n)&&n.applyToAabb(y),!jse(y,e,d,r))return!0;const v=h[g]/3,x=h[g+1]/3,S=x-v,E=(C,R,O)=>a(g,C,th(R,R,s),O);return A(n)&&S>OFe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new Yne(this._indices,v,x,l)),this._componentIntersectionData[g].intersectRay({r0:e,r1:i},E)):PD(e,i,v,x,c,l,void 0,n,E),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,d=1/0,f=1/0,m=-1/0,g=-1/0,y=-1/0;for(let v=l;v<c;v++){const x=i[v]*s,S=r[x],E=r[x+1],C=r[x+2];h=Math.min(h,S),d=Math.min(d,E),f=Math.min(f,C),m=Math.max(m,S),g=Math.max(g,E),y=Math.max(y,C)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=d,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=y}}get positions(){return this._positions}get indices(){return this._indices}};const hFt=$(),dFt=Mo();let pFt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},fFt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},mFt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function gFt(t,e){return{near:t,far:e}}function zD(t){return t?TL(t,1/0,-1/0):gFt(1/0,-1/0)}function TL(t,e,i){return t.near=e,t.far=i,t}function p3(t,e,i=t){return e!=null&&(i.near=Math.min(t.near,e.near),i.far=Math.max(t.far,e.far)),i}function Z4(t,e){return t.near<=e&&e<=t.far}const fQ={near:0,far:0};function yFt(t,e){const i=zD(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=b(o.offsetObb)?o.offsetObb:o.obb,l=xe(as(Fh,a.center,r),n),c=Kz(a,n);if(Z4(i,l-c)&&Z4(i,l+c))return;const h=xFt(a,s);if(h===-1)return;if(h===0)return g0.far=l+c,g0.near=l-c,void p3(i,g0);const d=J4.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<J4.length;o++){const a=J4.data[o];if(Z4(i,a.near)&&Z4(i,a.far))continue;g0.far=a.far,g0.near=1/0,wFt(b(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,_Ft,c=>{let h=vFt;for(let d=0;d<zFe&&c.length>0;d++){if(!(a.mask&1<<d))continue;bFt(s[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){fe(Xc,c.data[d+0],c.data[d+1],c.data[d+2]);const f=xe(as(Xc,Xc,r),n);g0.near=Math.min(g0.near,f)}})===0&&(g0.near=0),p3(i,g0)}return J4.length=0,i}const J4=new vi({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=O2(t.object),t)}),g0=zD(),Xc=$(),gx=$(),_Ft=new vi({deallocator:null}),vFt=new vi({deallocator:null});function bFt(t,e,i){i.length=0;const r=e.length-3;AH(Xc,e,r);const s=Kr(t,Xc);s<=0&&(i.push(Xc[0]),i.push(Xc[1]),i.push(Xc[2]));let n=0,o=s;for(;n<r;n+=3){AH(gx,e,n);const a=Kr(t,gx);o*a<0&&(En(Xc,gx,Xc,a/(a-o)),Zc(i,Xc)),a<=0&&Zc(i,gx),o=a,ge(Xc,gx)}o*s<0&&(AH(gx,e,r),En(Xc,gx,Xc,s/(s-o)),Zc(i,Xc))}function AH(t,e,i){return fe(t,e.data[i+0],e.data[i+1],e.data[i+2])}function Zc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function wFt(t,e,i,r){sS(M0e,t.quaternion),as(Fh,e,t.center),mm(Fh,Fh,M0e);const s=8*((Fh[0]<-t.halfSize[0]?-1:Fh[0]>t.halfSize[0]?1:0)+3*(Fh[1]<-t.halfSize[1]?-1:Fh[1]>t.halfSize[1]?1:0)+9*(Fh[2]<-t.halfSize[2]?-1:Fh[2]>t.halfSize[2]?1:0)+13),n=C0e[s];if(n===0)return n;gre(K4,t.quaternion),mre(K4,K4,t.halfSize);const o=(a,l)=>{const c=C0e[s+l+1];return fe(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),th(a,a,K4),we(a,t.center,a)};return i.length=0,Zc(i,o(OH,0)),Zc(i,o(A0e,1)),Zc(i,o(Fh,2)),Zc(i,o(O0e,3)),r(i),n===1||(i.length=0,Zc(i,OH),Zc(i,O0e),Zc(i,o(Fh,4)),Zc(i,o(R0e,5)),r(i),n===2||(i.length=0,Zc(i,OH),Zc(i,R0e),Zc(i,o(Fh,6)),Zc(i,A0e),r(i))),n}const C0e=(()=>{const t=new Int8Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),zFe=4;function xFt(t,e){let i=0;for(let r=0;r<zFe;r++){const s=vT(t,e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const K4=Hs(),M0e=Kp(),Fh=$(),OH=$(),A0e=$(),O0e=$(),R0e=$();let TFt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?yFt(e,this._objects.visibleObjects):null}};function SFt(t){const e=qs().vec3f(P.POSITION);return t.normals&&e.vec2i16(P.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Nn.Default?e.vec2f(P.UV0):t.textureCoordinates===Nn.Atlas&&(e.vec2f(P.UV0),e.vec4u16(P.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(P.COLOR,{glNormalized:!0}),e.alignTo(4)}let EFt=class{constructor(){this.externalColor=Ai(),this.externalColorMixMode=vo.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},CFt=class extends dn{constructor(e,i){super(e,"int",Vr.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var _y;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(_y||(_y={}));const Xne=429496.7296;function BFe(t,e){oL(t/Xne*.5+.5,e)}function MFt(t,e){switch(e.componentData){case _y.Varying:return AFt(t,e);case _y.Uniform:return OFt(t);case _y.COUNT:return;default:e.componentData}}function AFt(t,e){const{vertex:i,fragment:r}=t;i.include(_h),i.uniforms.add($b("componentColorTex",n=>n.componentParameters.texture.texture,e.hasWebGL2Context?Ar.None:Ar.Size)),t.attributes.add(P.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===H.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(gDe),i.constants.add("elevationScale","float",2*Xne),i.constants.add("stride","float",me("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(T`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Pp(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),i.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${_c(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${_c(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${_c(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?T`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function OFt(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new sk("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new CFt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(T`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Sp;function RFt(t,e){const i=t.vertex;switch(i.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Sp.None:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Sp.Opaque:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Sp.Transparent:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Sp||(Sp={}));var vy;function Uni(t){return t&&Ly(t)?vy.Mars:t&&Dy(t)?vy.Moon:vy.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(vy||(vy={}));var sd;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(sd||(sd={}));let ki=class extends Hl{constructor(){super(...arguments),this.output=H.Color,this.textureCoordinateType=Nn.None,this.componentData=_y.Uniform,this.cullFace=ts.Back,this.vertexDiscardMode=Sp.None,this.doubleSidedMode=tn.WindingOrder,this.alphaDiscardMode=Nr.Opaque,this.integratedMeshMode=sd.None,this.transparencyPassType=zt.NONE,this.ellipsoidMode=vy.Earth,this.pbrMode=Ot.Disabled,this.normalType=Pr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};u([X({count:H.COUNT})],ki.prototype,"output",void 0),u([X({count:Nn.COUNT})],ki.prototype,"textureCoordinateType",void 0),u([X({count:_y.COUNT})],ki.prototype,"componentData",void 0),u([X({count:ts.COUNT})],ki.prototype,"cullFace",void 0),u([X({count:Sp.COUNT})],ki.prototype,"vertexDiscardMode",void 0),u([X({count:tn.COUNT})],ki.prototype,"doubleSidedMode",void 0),u([X({count:Nr.COUNT})],ki.prototype,"alphaDiscardMode",void 0),u([X({count:sd.COUNT})],ki.prototype,"integratedMeshMode",void 0),u([X({count:zt.COUNT})],ki.prototype,"transparencyPassType",void 0),u([X({count:vy.COUNT})],ki.prototype,"ellipsoidMode",void 0),u([X({count:Ot.COUNT})],ki.prototype,"pbrMode",void 0),u([X({count:Pr.COUNT})],ki.prototype,"normalType",void 0),u([X()],ki.prototype,"spherical",void 0),u([X()],ki.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X()],ki.prototype,"hasVertexColors",void 0),u([X()],ki.prototype,"hasNormals",void 0),u([X()],ki.prototype,"hasSlicePlane",void 0),u([X()],ki.prototype,"hasBaseColorTexture",void 0),u([X()],ki.prototype,"receiveAmbientOcclusion",void 0),u([X()],ki.prototype,"receiveShadows",void 0),u([X()],ki.prototype,"blendingEnabled",void 0),u([X()],ki.prototype,"hasScreenSpaceReflections",void 0),u([X()],ki.prototype,"hasPolygonOffset",void 0),u([X()],ki.prototype,"hasMetallicRoughnessTexture",void 0),u([X()],ki.prototype,"hasEmissionTexture",void 0),u([X()],ki.prototype,"hasOcclusionTexture",void 0),u([X()],ki.prototype,"hasNormalTexture",void 0),u([X()],ki.prototype,"hasOccludees",void 0),u([X()],ki.prototype,"hasMultipassTerrain",void 0),u([X()],ki.prototype,"cullAboveGround",void 0),u([X()],ki.prototype,"useLegacyTerrainShading",void 0),u([X()],ki.prototype,"hasCloudsReflections",void 0),u([X()],ki.prototype,"snowCover",void 0),u([X()],ki.prototype,"objectAndLayerIdColor",void 0),u([X()],ki.prototype,"hasWebGL2Context",void 0),u([X({constValue:Vr.Draw})],ki.prototype,"pbrTextureBindType",void 0),u([X({constValue:!0})],ki.prototype,"hasSliceHighlight",void 0),u([X({constValue:!1})],ki.prototype,"hasSliceInVertexProgram",void 0),u([X({constValue:!1})],ki.prototype,"useCustomDTRExponentForWater",void 0),u([X({constValue:!1})],ki.prototype,"hasVertexTangents",void 0),u([X({constValue:!0})],ki.prototype,"supportsTextureAtlas",void 0),u([X({constValue:!1})],ki.prototype,"highStepCount",void 0),u([X({constValue:!1})],ki.prototype,"instancedDoublePrecision",void 0),u([X({constValue:!0})],ki.prototype,"useFillLights",void 0),u([X({constValue:!1})],ki.prototype,"objectAndLayerIdColorInstanced",void 0);function P0e(t,e){t.include(LS,e),t.fragment.include(gL);const i=t.fragment;i.uniforms.add(new sk("baseColor",r=>r.baseColor)),i.uniforms.add(new T2("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function I0e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case tn.None:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case tn.View:t.include(tA,e),i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case tn.WindingOrder:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case tn.COUNT:}switch(e.normalType){case Pr.Attribute:case Pr.CompressedAttribute:t.include(Nz,e),i.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Pr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(tA,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Pr.Ground:e.spherical?(t.include(tA,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),i.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Pr.COUNT:}}function PFt(t,e){const i=t.fragment;if(e.hasBaseColorTexture&&(e.output===H.Color||e.alphaDiscardMode!==Nr.Opaque)){t.include(qre,e);const r=e.textureCoordinateType===Nn.Atlas;i.uniforms.add($b("baseColorTexture",s=>s.texture,r?e.hasWebGL2Context?Ar.None:Ar.Size:Ar.None)),r?(t.include(fRe),i.code.add(T`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Pp(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):i.code.add(T`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function IFt(t){const e=new ar;e.include(tA,t),e.include(Nz,t),e.include(LS,t),e.include(gy,t),e.include(X3,t),e.include(MFt,t),e.include(iAt,t),e.include(X2t,t),e.include(PFt,t),e.include(RFt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(e.include(Yre,t),t.hasNormalTexture&&e.include(bDe,t));const s=t.output===H.Shadow||t.output===H.ShadowHighlight||t.output===H.ShadowExcludeHighlight;s&&t.componentData===_y.Varying?i.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(T`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===sd.ColorOverlay||t.integratedMeshMode===sd.ColorOverlayWithWater,o=n&&t.output===H.Color&&t.pbrMode===Ot.WaterOnIntegratedMesh;return n&&(e.include(uS,t),e.include(CDt,t),t.spherical?i.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===vy.Earth?zi.radius:t.ellipsoidMode===vy.Mars?cy.radius:k_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===H.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(sl)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===H.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===H.Alpha&&(r.include(Sd),e.include(Ed,t),e.include(P0e,t),n&&r.uniforms.add(new Yt("ovColorTex",(a,l)=>cQ(a,l))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?T`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===H.Color&&(r.include(Sd),e.include(Ed,t),e.include(P0e,t),e.include(I0e,t),e.include(uS,t),t.receiveShadows?(e.include(Fz,t),r.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(T`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new Yt("ovColorTex",(a,l)=>cQ(a,l))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?(Uy(r),r.code.add(T`
        ${t.pbrMode===Ot.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(T`vec3 shadingNormal = normalVertex;`),r.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(T`float shadow = evaluateShadow();`):t.spherical?(oO(r),r.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(T`float shadow = 0.0;`),o&&r.uniforms.add(new Yt("ovNormalTex",(a,l)=>Zne(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(T`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===zt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===H.Depth||s)&&(e.include(X_,t),r.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===H.Normal&&(e.include(I0e,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Pr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===H.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===H.Highlight&&(e.include(pv,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function Zne(t){return t.overlays.length===0?null:t.overlays[ks.INNER].getValidTexture(an.Water)}const $Ft=Object.freeze(Object.defineProperty({__proto__:null,build:IFt,getOverlayNormalTexture:Zne},Symbol.toStringTag,{value:"Module"}));let GFe=class jFe extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2,i.spherical=e.viewingMode===it.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new cr(e.rctx,jFe.shader.get().build(this.configuration),HFe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==sd.None,s=e===zt.NONE,n=e===zt.FrontFace;return si({blending:i.output!==H.Color&&i.output!==H.Alpha||!i.blendingEnabled?null:s?yd:fv(e),culling:iz(i.cullFace),depthTest:{func:Ew(e)},depthWrite:s||n?gu:null,colorWrite:wi,stencilWrite:r||i.hasOccludees?Py:null,stencilTest:r?VCt(uu.IntegratedMeshMaskExcluded):i.hasOccludees?Cw:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:Rz})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};GFe.shader=new lr($Ft,()=>se(()=>import("./ComponentShader.glsl-89ebf974.js"),[]));const HFe=new Map([[P.POSITION,0],[P.NORMAL,1],[P.NORMALCOMPRESSED,1],[P.COLOR,2],[P.UV0,3],[P.UVREGION,4],[P.COMPONENTINDEX,5]]);let LFt=class extends Br{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Jne=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function nn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function $0e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let Qz=class{constructor(e){this._low=ys(),this._high=ys(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const i=this._low,r=this._high;ge(i,e),as(r,e,i)}setElements(e,i,r){fe(L0e,e,i,r),this.set(L0e)}get(e){return we(e,this._low,this._high)}getLowScaled(e){return pe(e,this._low,1)}};const L0e=$();let ia=class extends LFt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Lm(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=wr(1,1,.5),this.emissiveFactor=wr(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new w8,this.componentParameters=new l$,this.textureAlphaCutoff=V9,this.alphaDiscardMode=Nr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=vy.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ki;const r=new Qz(e.position),s=p3e(e.rotationScale);AS(s,s),this.transformNormalGlobalFromModel=Hp(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Os(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return b(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return b(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return b(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return b(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return b(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=b(this.metallicRoughnessTexture),n.hasEmissionTexture=b(this.emissionTexture),n.hasOcclusionTexture=b(this.occlusionTexture),n.hasNormalTexture=b(this.normalTexture),n.transparencyPassType=i.identifier===Ku.Material&&r.transparencyPassType!=null?r.transparencyPassType:zt.NONE,n.hasMultipassTerrain=i.identifier===Ku.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Ku.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?tn.View:tn.None,n.hasBaseColorTexture=b(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===uc.Transparent||o===uc.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?NFt(r)?Zne(r)?sd.ColorOverlayWithWater:sd.ColorOverlay:sd.NoOverlay:sd.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&_r.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&A(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===sd.ColorOverlayWithWater?Ot.WaterOnIntegratedMesh:this.usePBR?a?Ot.Schematic:Ot.Normal:Ot.Disabled,n.normalType=n.integratedMeshMode===sd.None?n.hasNormals?Pr.CompressedAttribute:Pr.ScreenDerivative:Pr.Ground,n.hasSlicePlane=b(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Ku.ShadowMap)n.output=H.Shadow,n.vertexDiscardMode=Sp.None;else if(i.identifier===Ku.Highlight)n.output=H.Highlight,n.vertexDiscardMode=Sp.None;else{switch(this._computeWhichMaterialPass()===uc.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Sp.Opaque:Sp.Transparent:n.vertexDiscardMode=Sp.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case H.Color:n.receiveAmbientOcclusion=r.ssaoHelper.active,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=b(r.cloudsFade.data);break;case H.Alpha:n.hasOccludees=r.hasOccludees;break;case H.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(GFe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return b(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case uc.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case uc.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case uc.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case uc.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),DFt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==ko.None;h&&e.shadowMap.submitDraw(this,s,a,o),b(l)&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&b(c)&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?uc.IntegratedMesh:this.objectOpacity<1?uc.Transparent:this.componentParameters.opaqueOverride===ko.All?uc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Nr.Blend||this.alphaDiscardMode===Nr.MaskBlend?uc.Transparent:this.componentParameters.transparent===ko.None?uc.Opaque:this.componentParameters.transparent===ko.All?uc.Transparent:uc.OpaqueAndTransparent}};var uc,ko;u([nn({vectorOps:Ywe})],ia.prototype,"baseColor",void 0),u([nn()],ia.prototype,"usePBR",void 0),u([nn()],ia.prototype,"hasParametersFromSource",void 0),u([nn({vectorOps:Tle})],ia.prototype,"mrrFactors",void 0),u([nn({vectorOps:Tle})],ia.prototype,"emissiveFactor",void 0),u([nn({dispose:!0})],ia.prototype,"baseColorTexture",void 0),u([nn({dispose:!0})],ia.prototype,"metallicRoughnessTexture",void 0),u([nn({dispose:!0})],ia.prototype,"emissionTexture",void 0),u([nn({dispose:!0})],ia.prototype,"occlusionTexture",void 0),u([nn({dispose:!0})],ia.prototype,"normalTexture",void 0),u([nn()],ia.prototype,"objectOpacity",void 0),u([$0e()],ia.prototype,"commonMaterialParameters",void 0),u([$0e()],ia.prototype,"componentParameters",void 0),u([nn()],ia.prototype,"textureAlphaCutoff",void 0),u([nn()],ia.prototype,"alphaDiscardMode",void 0),u([nn()],ia.prototype,"isIntegratedMesh",void 0),u([nn()],ia.prototype,"polygonOffsetEnabled",void 0),u([nn()],ia.prototype,"ellipsoidMode",void 0),u([nn()],ia.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(uc||(uc={}));let w8=class extends Jne{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ts.Back,this.hasSlicePlane=!0}};u([nn()],w8.prototype,"doubleSided",void 0),u([nn()],w8.prototype,"cullFace",void 0),u([nn()],w8.prototype,"hasSlicePlane",void 0);let l$=class extends Jne{constructor(){super(...arguments),this.externalColor=di(1,1,1,1),this.externalColorMixMode=vo.Multiply,this.castShadows=ko.All}get transparent(){return this.externalColor[3]<1?ko.All:ko.None}get opaqueOverride(){return this.externalColorMixMode===vo.Replace&&this.externalColor[3]===1?ko.All:ko.None}get visible(){return this.externalColor[3]>0?ko.All:ko.None}get type(){return _y.Uniform}};u([nn({vectorOps:Ywe})],l$.prototype,"externalColor",void 0),u([nn()],l$.prototype,"externalColorMixMode",void 0),u([nn()],l$.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(ko||(ko={}));let lI=class extends Jne{constructor(){super(...arguments),this.texture=null,this.transparent=ko.None,this.opaqueOverride=ko.None,this.castShadows=ko.None}get type(){return _y.Varying}};function DFt(t){return t.overlays.length!==0&&b(t.overlays[ks.INNER].getValidTexture(an.Highlight))}function NFt(t){return t.overlays.length!==0&&b(t.overlays[ks.INNER].getColorTextureNoRasterImage())}u([nn()],lI.prototype,"texture",void 0),u([nn()],lI.prototype,"transparent",void 0),u([nn()],lI.prototype,"opaqueOverride",void 0),u([nn()],lI.prototype,"castShadows",void 0);const ak=qs().vec3f(P.POSITION).u16(P.COMPONENTINDEX).u16(P.U16PADDING),qFe=qs().vec2u8(P.SIDENESS),FFt=vh(qFe),WFe=qs().vec3f(P.POSITION0).vec3f(P.POSITION1).u16(P.COMPONENTINDEX).u8(P.VARIANTOFFSET,{glNormalized:!0}).u8(P.VARIANTSTROKE).u8(P.VARIANTEXTENSION,{glNormalized:!0}).u8(P.U8PADDING,{glPadding:!0}).u16(P.U16PADDING,{glPadding:!0}),mQ=WFe.clone().vec3f(P.NORMAL),gQ=WFe.clone().vec3f(P.NORMALA).vec3f(P.NORMALB),YFe=new Map([[P.POSITION0,0],[P.POSITION1,1],[P.COMPONENTINDEX,2],[P.VARIANTOFFSET,3],[P.VARIANTSTROKE,4],[P.VARIANTEXTENSION,5],[P.NORMAL,6],[P.NORMALA,6],[P.NORMALB,7],[P.SIDENESS,8]]);function D0e(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(x,S)=>{x<S?s[x+1]++:n[S+1]++};for(let x=0;x<r;x++){const S=t[3*x],E=t[3*x+1],C=t[3*x+2];o(S,E),o(E,C),o(C,S)}let a=0,l=0;for(let x=0;x<i;x++){const S=s[x+1],E=n[x+1];s[x+1]=a,n[x+1]=l,a+=S,l+=E}const c=new Uint32Array(6*r),h=s[i],d=(x,S,E)=>{if(x<S){const C=s[x+1]++;c[2*C]=S,c[2*C+1]=E}else{const C=n[S+1]++;c[2*h+2*C]=x,c[2*h+2*C+1]=E}};for(let x=0;x<r;x++){const S=t[3*x],E=t[3*x+1],C=t[3*x+2];d(S,E,x),d(E,C,x),d(C,S,x)}const f=(x,S)=>{const E=2*x,C=S-x;for(let R=1;R<C;R++){const O=c[E+2*R],U=c[E+2*R+1];let L=R-1;for(;L>=0&&c[E+2*L]>O;L--)c[E+2*L+2]=c[E+2*L],c[E+2*L+3]=c[E+2*L+1];c[E+2*L+2]=O,c[E+2*L+3]=U}};for(let x=0;x<i;x++)f(s[x],s[x+1]),f(h+n[x],h+n[x+1]);const m=new Int32Array(3*r),g=(x,S)=>x===t[3*S]?0:x===t[3*S+1]?1:x===t[3*S+2]?2:-1,y=(x,S)=>{const E=g(x,S);m[3*S+E]=-1},v=(x,S,E,C)=>{const R=g(x,S);m[3*S+R]=C;const O=g(E,C);m[3*C+O]=S};for(let x=0;x<i;x++){let S=s[x];const E=s[x+1];let C=n[x];const R=n[x+1];for(;S<E&&C<R;){const O=c[2*S],U=c[2*h+2*C];O===U?(v(x,c[2*S+1],U,c[2*h+2*C+1]),S++,C++):O<U?(y(x,c[2*S+1]),S++):(y(U,c[2*h+2*C+1]),C++)}for(;S<E;)y(x,c[2*S+1]),S++;for(;C<R;)y(c[2*h+2*C],c[2*h+2*C+1]),C++}return m}let XFe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?kFt:UFt}write(e,i,r){const s=this._edgeHashFunction(r);e5.seed=s;const n=e5.getIntRange(0,255),o=e5.getIntRange(0,this.settings.variants-1),a=.7,l=e5.getFloat(),c=255*(.5*VFt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,n),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const Kne=new Float32Array(6),lk=new Uint32Array(Kne.buffer),Eb=new Uint32Array(1);function UFt(t){const e=Kne;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Eb[0]=5381;for(let i=0;i<lk.length;i++)Eb[0]=31*Eb[0]+lk[i];return Eb[0]}function kFt(t){const e=Kne;e[0]=JE(t.position0[0]),e[1]=JE(t.position0[1]),e[2]=JE(t.position0[2]),e[3]=JE(t.position1[0]),e[4]=JE(t.position1[1]),e[5]=JE(t.position1[2]),Eb[0]=5381;for(let i=0;i<lk.length;i++)Eb[0]=31*Eb[0]+lk[i];return Eb[0]}const N0e=1e4;function JE(t){return Math.round(t*N0e)/N0e}function VFt(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let ck=class{constructor(){this._commonWriter=new XFe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return mQ.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),we(Q4,r.faceNormal0,r.faceNormal1),Re(Q4,Q4),e.normal.setVec(i,Q4)}trim(e,i){return this._commonWriter.trim(e,i)}};ck.Layout=mQ,ck.glLayout=vh(mQ,1);let uk=class{constructor(){this._commonWriter=new XFe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return gQ.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};uk.Layout=gQ,uk.glLayout=vh(gQ,1);const Q4=$(),e5=new gI,bT=-1;var hk;function zFt(t,e,i,r=WFt){const s=t.vertices.position,n=t.vertices.componentIndex,o=ci(r.anglePlanar),a=ci(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=yQ.edge,d=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,y=qFt(t),v=HFt(t),x=v.length/4,S=e.allocate(x);let E=0;const C=x,R=i.allocate(C);let O=0,U=0,L=0;const B=RGe(0,x),G=new Float32Array(x);G.forEach((K,Y,D)=>{s.getVec(v[4*Y+0],d),s.getVec(v[4*Y+1],f),D[Y]=Wr(d,f)}),B.sort((K,Y)=>G[Y]-G[K]);const j=new Array,q=new Array;for(let K=0;K<x;K++){const Y=B[K],D=G[Y],V=v[4*Y+0],k=v[4*Y+1],Z=v[4*Y+2],Q=v[4*Y+3],ne=Q===bT;if(s.getVec(V,d),s.getVec(k,f),ne)fe(m,y[3*Z+0],y[3*Z+1],y[3*Z+2]),ge(g,m),h.componentIndex=n.get(V),h.cosAngle=xe(m,g);else{if(fe(m,y[3*Z+0],y[3*Z+1],y[3*Z+2]),fe(g,y[3*Q+0],y[3*Q+1],y[3*Q+2]),h.componentIndex=n.get(V),h.cosAngle=xe(m,g),GFt(h,c))continue;h.cosAngle<-.9999&&ge(g,m)}U+=D,L++,ne||BFt(h,l)?(e.write(S,E++,h),j.push(D)):jFt(h,o)&&(i.write(R,O++,h),q.push(D))}const ie=new Float32Array(j.reverse()),ee=new Float32Array(q.reverse());return{regular:{instancesData:e.trim(S,E),lodInfo:{lengths:ie}},silhouette:{instancesData:i.trim(R,O),lodInfo:{lengths:ee}},averageEdgeLength:U/L}}function BFt(t,e){return t.cosAngle<e}function GFt(t,e){return t.cosAngle>e}function jFt(t,e){const i=Co(t.cosAngle),r=yQ.fwd,s=yQ.ortho;return Q_(r,t.position1,t.position0),i*(xe(Et(s,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function HFt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],d=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===bT||d<f?1:0,s+=c===bT||f<m?1:0,s+=h===bT||m<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],d=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===bT||d<f)&&(n[o++]=d,n[o++]=f,n[o++]=a,n[o++]=l),(c===bT||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===bT||m<d)&&(n[o++]=m,n[o++]=d,n[o++]=a,n[o++]=h)}return n}function qFt(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,s=RH.v0,n=RH.v1,o=RH.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l+0],h=r[3*l+1],d=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(d,o),be(n,n,s),be(o,o,s),Et(s,n,o),Re(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(hk||(hk={}));const yQ={edge:{position0:$(),position1:$(),faceNormal0:$(),faceNormal1:$(),componentIndex:0,cosAngle:0},ortho:$(),fwd:$()},RH={v0:$(),v1:$(),v2:$()},WFt={anglePlanar:4,angleSignificantEdge:35};function YFt(t){const e=XFt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return F0e.updateSettings(t.writerSettings),U0e.updateSettings(t.writerSettings),zFt(e,F0e,U0e)}function XFt(t,e,i,r){if(e){const o=D0e(i,r,t.count);return new ZFt(i,r,o,t)}const s=IK(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=D0e(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:ak.createView(s.buffer)}}let ZFt=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const F0e=new ck,U0e=new uk,Jni=qs().vec3f(P.POSITION0).vec3f(P.POSITION1),JFt=qs().vec3f(P.POSITION0).vec3f(P.POSITION1).u16(P.COMPONENTINDEX).u16(P.U16PADDING,{glPadding:!0});let KFt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},QFt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0,this._texture=new At(this._rctx,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new Gl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}resizeToFit(e){const i=e*this._fieldCount;if(i>=this._data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new Gl(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const ZFe=65536;let e4t=class{constructor(e,i=1){this.textureBuffer=new QFt(e,i),this._indexManager=new KFt(ZFe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},JFe=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>ZFe)return null;const i=new e4t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const k0e=le.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let t4t=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new vi,new vi],this._renderSubmit=new TFt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=me("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new JFe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Rt(this._objects[gA.Hidden].length===0&&this._objects[gA.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const i=new aI;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=E0e(e.obb),i.components=new rFt(this._componentBufferManager,e.geometry.componentOffsets),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new uFt(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Eo(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new EFt,c=o.textureBuffer,h=new Uint8Array(4),d=new Uint32Array(h.buffer);let f=0,m=0,g=0,y=n.verticalOffsets,v=1/0,x=-1/0,S=!1,E=!1,C=0;for(let R=0;R<n.count;R++){i(R,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===vo.Replace&&l.externalColor[3]===1),g+=+l.castShadows,mDe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[R],0,h[0],h[1],h[2],h[3]),S||(S=R>0&&C!==d[0]),C=d[0],E||(E=l.elevationOffset!==0),E&&A(y)&&(y=new Array(R).fill(0)),b(y)&&(y[R]=l.elevationOffset),v=Math.min(v,l.elevationOffset),x=Math.max(x,l.elevationOffset),BFe(l.elevationOffset,h),c.setData(a[R],1,h[0],h[1],h[2],h[3]);const O=l.objectAndLayerIdColor;b(O)&&c.setData(a[R],2,O[0],O[1],O[2],O[3]),l.pickable!==kFe(n.pickability,R)&&(n.pickability=nFt(n.pickability,n.count,R,l.pickable))}n.verticalOffsets=E?y:null,r.offsetObb=E?eFt(r.obb,v,x,this._viewingMode,b(r.offsetObb)?r.offsetObb:E0e(r.obb)):null,S||E||this._hasObjectAndLayerId?(s.componentParameters=new lI,s.componentParameters.castShadows=PH(g,n.count),s.componentParameters.transparent=PH(f,n.count),s.componentParameters.opaqueOverride=PH(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new l$,s.componentParameters.castShadows=l.castShadows?ko.All:ko.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||A(o))return r;const a=o[i];if(this._viewingMode===it.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Fbt(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,s,n,o){const a=e;b(n)&&(n.localOrigin=a.transform.position);const l=AS(V0e,a.transform.rotationScale);as(t5,i,a.transform.position),as(i5,r,a.transform.position),th(t5,t5,l),th(i5,i5,l);const c=Hp(V0e,l);return a.intersectionGeometry.intersect(t5,i5,s,c,n,a.components.verticalOffsets,o)}addEdges(e,i,r,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(e,n.transform,{center:n.obb.center,radius:QNt(n.obb)},a,o,l,r,s)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:JFt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=ak.createBuffer(a.count);jz(c.position,a),pw(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,d=this._computeVisibilityIndices(o,n,l,h);return{origin:zr(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=Array.isArray(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],d=r[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;A(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(A(r.highlightCounts))return void k0e.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else k0e.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;b(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[gA.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=yr.createVertex(r,or.STATIC_DRAW,s.vertices.data),a=fa(s.indices,y=>yr.createIndex(r,or.STATIC_DRAW,y)),l=vh(SFt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const v=i.offsets[y],x=i.offsets[y+1],S=i.materialDataIndices[y];if(b(s.indices))for(let E=v;E<x;E++)c[s.indices[E]]=S;else for(let E=v;E<x;E++)c[E]=S}const h=yr.createVertex(r,or.STATIC_DRAW,c.buffer),d=new ia(e.transform,e.toMapSpace),f=new qp(r,HFe,{data:l,componentIndices:i4t},{data:o,componentIndices:h},a),m=new fFt(f,Xt.TRIANGLES,n,b(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(b(a)?a.byteSize:0)};return new pFt(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const i4t=vh(qs().u16(P.COMPONENTINDEX));function PH(t,e){return t===e?ko.All:t===0?ko.None:ko.Some}const V0e=cu(),t5=$(),i5=$();let KFe=class extends Br{constructor(){super(...arguments),this.opacity=1}};function r4t(t){const e=new ar;return e.include(Qp),e.fragment.uniforms.add(new Yt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Be("opacity",i=>i.opacity)),e.fragment.code.add(T`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const s4t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:KFe,build:r4t},Symbol.toStringTag,{value:"Module"}));var Nl;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Nl||(Nl={}));let _Q=class extends Hl{constructor(){super(...arguments),this.alphaMode=Nl.None,this.hasOpacityFactor=!1}};u([X({count:Nl.COUNT})],_Q.prototype,"alphaMode",void 0),u([X()],_Q.prototype,"hasOpacityFactor",void 0);let QFe=class e4e extends dr{initializeProgram(e){return new cr(e.rctx,e4e.shader.get().build(this.configuration),rr)}initializePipeline(){switch(this.configuration.alphaMode){case Nl.None:return si({colorWrite:wi});case Nl.Alpha:return si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi});case Nl.PremultipliedAlpha:case Nl.COUNT:return si({blending:Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}}};QFe.shader=new lr(s4t,()=>se(()=>import("./Compositing.glsl-97b485ca.js"),[]));let t4e=class extends Br{};function n4t(){const t=new ar;return t.include(Qp),t.fragment.uniforms.add(new Yt("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const o4t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:t4e,build:n4t},Symbol.toStringTag,{value:"Module"}));let i4e=class r4e extends dr{initializeProgram(e){return new cr(e.rctx,r4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};i4e.shader=new lr(o4t,()=>se(()=>import("./HUDCompositing.glsl-01b38b05.js"),[]));let s4e=class extends Br{};function a4t(){const t=new ar;return t.include(Qp),t.fragment.uniforms.add([new Yt("colorTexture",e=>e.colorTexture),new Yt("alphaTexture",e=>e.alphaTexture),new Yt("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(T`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const l4t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:s4e,build:a4t},Symbol.toStringTag,{value:"Module"}));let n4e=class o4e extends dr{initializeProgram(e){return new cr(e.rctx,o4e.shader.get().build(),rr)}initializePipeline(){return si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}};n4e.shader=new lr(l4t,()=>se(()=>import("./OITCompositing.glsl-98c2ba85.js"),[]));let a4e=class extends Br{constructor(){super(...arguments),this.overlayIndex=ks.INNER,this.opacity=1}};function c4t(){const t=new ar;return t.include(Qp),t.fragment.uniforms.add(new Yt("tex",e=>e.texture)),t.fragment.uniforms.add(new UD("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Be("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const u4t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:a4e,build:c4t},Symbol.toStringTag,{value:"Module"}));let l4e=class c4e extends dr{initializeProgram(e){return new cr(e.rctx,c4e.shader.get().build(),rr)}initializePipeline(){return si({blending:Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}};l4e.shader=new lr(u4t,()=>se(()=>import("./OverlayCompositing.glsl-4b5f9631.js"),[]));let h4t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new _Q,this._passParameters=new KFe,this._oitParameters=new s4e,this._hudParameters=new t4e,this._overlayParameters=new a4e}destroy(){this._vao=dt(this._vao)}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(n4e);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Xt.TRIANGLE_STRIP,0,il(a,"geometry")),o.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._rctx,s=this._techniqueRepository.acquire(i4e);r.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();r.bindVAO(n),r.drawArrays(Xt.TRIANGLE_STRIP,0,il(n,"geometry")),s.release()}compositeOverlay(e,i,r,s){this._overlayParameters.texture=i,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(l4e);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Xt.TRIANGLE_STRIP,0,il(a,"geometry")),o.release()}composite(e,i,r=Nl.None,s=1){const n=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(QFe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Xt.TRIANGLE_STRIP,0,il(a,"geometry")),o.release()}_ensureVAO(){return A(this._vao)&&(this._vao=ql(this._rctx)),this._vao}};const d4t=1e4,vQ=100,p4t=500,f4t=500,m4t=.1;function g4t(t,e,i){return Yse(e,t)*(i[1]-i[0])+i[0]}function y4t(t,e,i){let r=0;if(!e.some(n=>(r+=n.numGeometries,r>=d4t)))return E4t.compute(t,e);const s=zD();return i.forAll(n=>{n.visible&&p3(s,_4t(t,n))}),s}function _4t(t,e){if(!e.visible)return;const i=zD(),r=e.getSpatialQueryAccelerator();return b(r)?v4t(i,t,r):b4t(i,t,e.objects),i}function v4t(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<p4t)TL(dp,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,lm.DepthOrder.FRONT_TO_BACK,dp,(l,c)=>{bQ(t,e,l),dp.far=t.near,c.setRange(dp)},n,o),TL(dp,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,lm.DepthOrder.BACK_TO_FRONT,dp,(l,c)=>{bQ(t,e,l),dp.near=t.far,c.setRange(dp)},n,o);else{const l=Math.max(Math.min(a,f4t),Math.ceil(a*m4t)),c=i.findClosest(s,lm.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,lm.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(z0e(t,e,c.boundingVolumeWorldSpace.bounds),z0e(t,e,h.boundingVolumeWorldSpace.bounds))}}function b4t(t,e,i){KE.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&KE.add(r)}),KE.empty||(KE.sort(e),TL(dp,e.near,Math.min(t.near,e.far)),KE.forEachInDepthRange(dp,lm.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&bQ(t,e,r)}),TL(dp,Math.max(t.far,e.near),e.far),KE.forEachInDepthRange(dp,lm.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function bQ(t,e,i){if(!i.visible||!Tb(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=S4t;i.geometries.forEach(n=>{ln(s,r,n.shaderTransformation);const o=K2(s);u4e(t,e,n.boundingInfo,s,o)})}function u4e(t,e,i,r,s){if(A(i))return;at(Ja,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Ja[0]-n[0])+o[1]*(Ja[1]-n[1])+o[2]*(Ja[2]-n[2]);if(Ja[3]=i.radius*s,!(a-Ja[3]>t.near&&a+Ja[3]<t.far)&&Tb(e.frustum,Ja))if(i.radius>vQ&&i.getChildren())for(const l of i.getChildren())u4e(t,e,l,r,s);else wQ.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function z0e(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let w4t=class{constructor(){this._items=new vi({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===lm.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}}},x4t=class{constructor(){this._view=Ge(),this._viewProj=Ge(),this._frustum=J$(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Bo(this._view,e.viewMatrix),ln(this._viewProj,e.projectionMatrix,this._view),m9(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,Ja,1),g=Ja):g=m.boundingSphere;const y=s*g[0]+n*g[1]+o*g[2]+a,v=y-g[3],x=y+g[3];this._geometries.push(m),this._near.push(-x),this._far.push(-v)}));const l=new mFt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(A(e))return;const s=e.center;at(Ja,s,i);const n=K2(i),o=Ja[0],a=Ja[1],l=Ja[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>vQ){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,i,r);return}}wQ.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(A(e))return;let s=e.radius;const n=e.center;at(Ja,n,i);const o=K2(i),a=Ja[0],l=Ja[1],c=Ja[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(s>vQ){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}wQ.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},T4t=class{constructor(){this._modelViewProj=Ge(),this._clipPosition=[Ai(),Ai(),Ai(),Ai(),Ai(),Ai(),Ai(),Ai()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;ln(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[IH[l][0]],h=this._clipPosition[IH[l][1]],d=this._clipPosition[IH[l][2]],f=this._clipTriangle(c,h,d);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const y=f[g][3];Number.isFinite(y)&&(e.near=Math.min(y,e.near),e.far=Math.max(y,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void Rt(!1)}_intersect(e,i,r){let s=0;return r===0?s=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?s=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?s=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(s=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),kk(Ai(),e,i,s)}_clipTriangle(e,i,r){let s=[e,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const IH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ja=to(),S4t=Ge(),dp=zD(),KE=new w4t,E4t=new x4t,wQ=new T4t;let C4t=class{},M4t=class extends Br{constructor(){super(...arguments),this.textures=new C4t}};function A4t(){const t=new ar;return t.attributes.add(P.POSITION,"vec2"),t.vertex.uniforms.add(new Ni("drawPosition",(e,i)=>O4t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Yt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Yt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Yt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new E_("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new E_("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function O4t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;Yg(t.magnifier.position,B0e);const n=e.camera.screenToRender(B0e,R4t),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Rr(P4t,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const B0e=zs(),R4t=Nxe(),P4t=Ai();async function I4t(t){const e=se(()=>import("./mask-svg-023bbc42.js"),[]),i=se(()=>import("./overlay-svg-d62383f3.js"),[]),r=Y_((await e).default,{signal:t}),s=Y_((await i).default,{signal:t}),n={mask:await r,overlay:await s};return _i(t),n}let nM=class extends Ee{constructor(){super(...arguments),this._handles=new ir,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new M4t,this.events=new ws,this.attributeLocations=new Map([[P.POSITION,0]]),this._tmpScreenPoint=zs(),this._tmpRenderPoint=Nxe()}get updating(){return A(this._imageSources)&&b(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};b(this._magnifier)&&this._handles.add(ae(()=>fa(this._magnifier,r=>r.version),i)),i()}get enabled(){return b(this._validMagnifier)}get _validMagnifier(){return b(this._magnifier)&&this._magnifier.visible&&b(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return b(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),b(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(A(r))return;const s=i.camera.pixelRatio,n=Math.ceil(s*r.size);if(this._updateResources(e,n),A(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),Yg(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,h=i.camera.fullHeight,d=.5*a,f=.5*a;l[0]=Se(l[0],d,c-d-1),l[1]=Se(l[1],f,h-f-1);const m=Math.floor(l[0]-d),g=Math.floor(l[1]-f),y=this._resources.program;y.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0),this._passParameters.magnifier=r,e.useProgram(y),y.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Xt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(A(e))return;const i=e.maskUrl,r=e.overlayUrl;!b(this._imageLoadTask)||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),b(this._imageSources)||b(this._imageLoadTask)||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:jL(async s=>{const n=A(i)||A(r)?I4t(s):null,o=b(i)?Y_(i,{signal:s}):n.then(l=>l.mask),a=b(r)?Y_(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(b(this._resources)){if(this._passParameters.textures.size!==i){const s=this._createTextureResources(e,i);if(A(s))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const r=this._createTextureResources(e,i);A(r)||(this._resources={program:this._createProgram(e),vao:ql(e,Bre,this.attributeLocations,0,1),pipelineState:si({blending:Um(Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:wi})},this._passParameters.textures=r)}_disposeResources(){A(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(A(this._imageSources))return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new At(e,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0,preMultiplyAlpha:!Wbe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),s=new At(e,{target:Ut.TEXTURE_2D,pixelFormat:Qe.ALPHA,internalFormat:Qe.ALPHA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new At(e,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!1}),mask:s,overlay:r,size:i}}_createProgram(e){return new cr(e,A4t(),this.attributeLocations)}};u([p()],nM.prototype,"_imageSources",void 0),u([p()],nM.prototype,"_imageLoadTask",void 0),u([p({readOnly:!0})],nM.prototype,"updating",null),nM=u([N("esri/views/3d/webgl-engine/lib/MagnifierHelper")],nM);let $4t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Gl(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){if(!(e&&i&&r&&s)||(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return di(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return le.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let s=r.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Gl(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let n=null;s?(n=s.get(r.graphicUid),n||le.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):le.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||le.getLogger(this.declaredClass).warn("no layerId found for uid "+r.layerUid),n&&o&&e.set(i,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var SL;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(SL||(SL={}));let o1=class{constructor(e,i,r=SL.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new vi({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}dispatch(e,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===zt.NONE||(r.bindTechnique(l,e,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=x8.get(c.indexType);for(let g=0;g<f;g+=2){const y=d[g],v=d[g+1];r.drawElements(h.primitiveType,v,c.indexType,y*m)}}else for(let m=0;m<f;m+=2){const g=d[m],y=d[m+1];r.drawArrays(h.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===SL.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}};const x8=new Map;x8.set(Mt.UNSIGNED_BYTE,1),x8.set(Mt.UNSIGNED_SHORT,2),x8.set(Mt.UNSIGNED_INT,4);let L4t=class{constructor(e,i){this.rctx=e,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new TDt,this._shadowPassParameters=new SDt,this._highlightPassParameters=new EDt,this._systems=new Set,this._passes={materialOpaque:new o1(e,i),materialTransparent:new o1(e,i,SL.BackToFront),materialIntegratedMesh:new o1(e,i),shadowMap:new o1(e,i),highlight:new o1(e,i),highlightIntegratedMesh:new o1(e,i),highlightShadowMap:new o1(e,i),defaultShadowMap:new o1(e,i)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case Ie.OPAQUE_MATERIAL:switch(e.output){case H.Color:case H.Depth:case H.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case H.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case H.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case H.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case H.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case H.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ie.TRANSPARENT_MATERIAL:switch(e.output){case H.Color:case H.Alpha:case H.Depth:case H.Normal:case H.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ie.INTEGRATED_MESH:switch(e.output){case H.Color:case H.Depth:case H.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case H.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case H.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ie.OPAQUE_MATERIAL,Ie.TRANSPARENT_MATERIAL,Ie.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(e);b(s)&&p3(i,s,i)}),i}_configure(e){const i=e.output===H.Shadow||e.output===H.ShadowHighlight||e.output===H.ShadowExcludeHighlight?this._shadowPassParameters:e.output===H.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,i)}_updateParameters(e,i){const r=e.bindParameters.camera,s=r.viewInverseTransposeMatrix;fe($H,s[3],s[7],s[11]),LH.set($H),ge(i.transformWorldFromViewTH,LH.high),ge(i.transformWorldFromViewTL,LH.low),ge(i.slicePlaneLocalOrigin,$H),jp(i.transformViewFromCameraRelativeRS,r.viewMatrix),Bo(i.transformProjFromView,r.projectionMatrix),i.identifier===Ku.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===Ie.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===Ie.INTEGRATED_MESH,Hp(G0e,i.transformViewFromCameraRelativeRS),AS(i.transformNormalViewFromGlobal,G0e))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const $H=$(),G0e=Hs(),LH=new Qz;let D4t=class{constructor(){this._step=q0e,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,me("enable-feature:high-quality-idle")){const s=i?performance.now()-this._firstIdleTime:0;if(s>=j0e+F4t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=j0e?U4t:1}else this._dilation=1;const r=Se(e/N4t,q0e,V4t);this._step===1/0?this._step=r:this._step=this._step*H0e+r*(1-H0e)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const N4t=.5,j0e=6e4,F4t=5e3,U4t=10,H0e=.9,k4t=30,q0e=1e3/1,V4t=1e3/k4t,z4t=8.6,B4t=.4;function G4t(){const t=new ar,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(P.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(P.UV0,"vec2"),e.uniforms.add(new Yt("coverageTex",n=>n.coverageTexture)),r.add(T`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Yt("tex",n=>n.blurColorTexture)),i.uniforms.add(new Yt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new Ni("uColor",n=>n.color)),i.uniforms.add(new Ni("haloColor",n=>n.haloColor)),i.uniforms.add(new Ni("opacities",n=>Rr(j4t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",z4t),i.constants.add("blurSize","float",B4t),s.add(T`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const j4t=Ai(),H4t=Object.freeze(Object.defineProperty({__proto__:null,build:G4t},Symbol.toStringTag,{value:"Module"}));let h4e=class d4e extends dr{initializeProgram(e){return new cr(e.rctx,d4e.shader.get().build(),rr)}initializePipeline(){return si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}};h4e.shader=new lr(H4t,()=>se(()=>import("./HighlightApply.glsl-635433da.js"),[]));let p4e=class extends Br{constructor(){super(...arguments),this.blurSize=je()}};function q4t(){const t=new ar,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(P.POSITION,"vec2"),t.attributes.add(P.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Yt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new X$("blurSize",n=>n.blurSize)),r.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new TD("tex",n=>n.blurInputTexture)),s.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const W4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:p4e,build:q4t},Symbol.toStringTag,{value:"Module"}));let f4e=class m4e extends dr{initializeProgram(e){return new cr(e.rctx,m4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};f4e.shader=new lr(W4t,()=>se(()=>import("./HighlightBlur.glsl-398d6e60.js"),[]));let g4e=class extends Br{constructor(){super(...arguments),this.invFramebufferDim=je()}};function Y4t(){const t=new ar,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(P.POSITION,"vec2"),r.add(T`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new TD("tex",n=>n.inputTexture)),i.uniforms.add(new X$("invFramebufferDim",n=>n.invFramebufferDim)),s.add(T`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const X4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:g4e,build:Y4t},Symbol.toStringTag,{value:"Module"}));let y4e=class _4e extends dr{initializeProgram(e){return new cr(e.rctx,_4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};y4e.shader=new lr(X4t,()=>se(()=>import("./HighlightDownsample.glsl-5d8660e9.js"),[]));let W0e=class extends Br{constructor(){super(...arguments),this.color=Lm(1,0,1,1),this.haloColor=Lm(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=di(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Z4t=32;let J4t=class{constructor(e,i){this._techniqueRep=e,this._rctx=i,this._viewportToRestore=Ai(),this._passParameters=new W0e,this._downsampleDrawParameters=new g4e,this._blurDrawParameters=new p4e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=ql(this._rctx);const e={colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE,width:0,height:0},i={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Sn(this._rctx,e,i),this._blur1Fbo=new Sn(this._rctx,e,i),this._blurTechnique=this._techniqueRep.acquire(f4e),this._downsampleTechnique=this._techniqueRep.acquire(y4e),this._applyTechnique=this._techniqueRep.acquire(h4e)}dispose(){if(this._blurTechnique=Os(this._blurTechnique),this._downsampleTechnique=Os(this._downsampleTechnique),this._applyTechnique=Os(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=dt(this._blur0Fbo),this._blur1Fbo=dt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new W0e,...e}}render(e,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=e.camera;im(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(i,Z4t),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(d),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(_s.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,Vt(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,il(d,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(_s.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,Vt(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,il(d,"geometry")),h.bindFramebuffer(r),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,il(d,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGB,dataType:Zt.UNSIGNED_SHORT_5_6_5,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},d={colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Sn(r,d,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,d=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let y=0;for(let v=0;v<l;v++)for(let x=0;x<c;x++)g[y+0]=(x-.5)*d*2-1,g[y+1]=(v-.5)*h*2-1,g[y+2]=x*d,g[y+3]=v*h,g[y+4]=(x+.5)*d*2-1,g[y+5]=(v-.5)*h*2-1,g[y+6]=x*d,g[y+7]=v*h,g[y+8]=(x-.5)*d*2-1,g[y+9]=(v+.5)*h*2-1,g[y+10]=x*d,g[y+11]=v*h,g[y+12]=(x-.5)*d*2-1,g[y+13]=(v+.5)*h*2-1,g[y+14]=x*d,g[y+15]=v*h,g[y+16]=(x+.5)*d*2-1,g[y+17]=(v-.5)*h*2-1,g[y+18]=x*d,g[y+19]=v*h,g[y+20]=(x+.5)*d*2-1,g[y+21]=(v+.5)*h*2-1,g[y+22]=x*d,g[y+23]=v*h,y+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new km(r,rr,{geometry:Y3},{geometry:yr.createVertex(r,or.STATIC_DRAW,g)})}}_gridComputeMipmap(e){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,e);i.bindVAO(this._quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,Vt(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),i.setViewport(0,0,o,a),i.drawArrays(Xt.TRIANGLE_STRIP,0,il(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(b(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(b(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)e+=i.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const K4t={dataType:Zt.UNSIGNED_BYTE,internalFormat:Qe.RGBA},Q4t={};let e5t=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const i=e.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(e,i){const r=e.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),e.delete(i))}getDepthTexture(e,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(e.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=O2()),r||(r=new At(this._rctx,{target:Ut.TEXTURE_2D,pixelFormat:Qe.DEPTH_STENCIL,dataType:Zt.UNSIGNED_INT_24_8,samplingMode:mt.NEAREST,wrapMode:qt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new XC(this._rctx,{internalFormat:pc.DEPTH_STENCIL,...i}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,i){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=O2())),r||(r=new At(this._rctx,{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:nh(),...Q4t,...e}}registerColorTarget(e={}){return{id:nh(),...K4t,...e}}getFramebuffer(e,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,e);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=b(r)?new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.DEPTH_STENCIL_TEXTURE},o,l):new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:r?sr.DEPTH_STENCIL_RENDER_BUFFER:sr.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(e,i){return`${e.id}_${i?i.id:"X"}_${e.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let e=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),e+=tS(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}},t5t=class{constructor(e,i){this._rctx=e,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const r=e.type===Ft.WEBGL2;this._renderTargetHelper=new e5t(e);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Zt.FLOAT,internalFormat:r?Bt.RGBA32F:Qe.RGBA,samplingMode:mt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:mt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Bt.RGBA4:Qe.RGBA,dataType:Zt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Bt.RGBA4:Qe.RGBA,dataType:Zt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const i=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(_s.COLOR_BUFFER_BIT|_s.DEPTH_BUFFER_BIT|_s.STENCIL_BUFFER_BIT)}composite(e){b(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,Nl.None)}renderTmpAndCompositeToMain(e,i,r,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,i5t),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(e,i=!1){this.renderToTargets(e,this.hudVisibility,i?this.tmpDepth:this.mainDepth,r5t)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,i,r){let s,n;switch(i){case zt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case zt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case zt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Nl.PremultipliedAlpha)}compositeOccludedOntoMain(e,i){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Nl.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(e,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(_s.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,i,r=!1,s=!1){const n=this._rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);n.setClearColor(i[0],i[1],i[2],l),o|=_s.COLOR_BUFFER_BIT}r&&(o|=_s.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=_s.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,i,r,s,n=!1,o=!1){const a=this.bindTarget(i,r);return this.renderToFBO(e,s,n,o),a}bindTarget(e,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,e,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const i5t=[0,0,0,0],r5t=[0,1,0,1];let s5t=class{constructor(e){this._context=e,this._renderPlugins=new vi,this._slots=[];for(let i=0;i<Ie.MAX_SLOTS;++i)this._slots[i]=[]}add(e,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),er();this._renderPlugins.push(i);for(const o of e)this._slots[o].push(i);this._context.requestRender()},n=i.initializeRenderContext(this._context,r);if(gh(n))return n.then(s);s()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],i=new Array;e.filter(r=>{if(!r.canRender)return!1;if(n5t(r)){const s=r.prepareTechnique(this._context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this._context.renderContext,i[s]))}queryDepthRange(e){const i=o5t;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(e);s&&p3(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[Ie.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,0)}};function n5t(t){return"prepareTechnique"in t}const o5t={near:0,far:0};let v4e=class extends qLe{};const eB=255,a5t=1/eB;function l5t(t){const e=new ar,i=e.fragment;return i.include(_h),i.include(Sd),e.include(Uz),e.include(Qp),e.include(Fz,t),i.uniforms.add([new Yt("depthMap",r=>r.linearDepthTexture),new Ps("inverseViewMatrix",(r,s)=>Va(Y0e,fu(Y0e,s.camera.viewMatrix,s.camera.center))),new hr("nearFar",(r,s)=>s.camera.nearFar)]),i.constants.add("sampleValue","float",a5t),i.code.add(T`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Y0e=Ge(),c5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:v4e,ShadowCastMaxSamples:eB,build:l5t},Symbol.toStringTag,{value:"Module"}));var mS;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(mS||(mS={}));let xQ=class extends Hl{constructor(){super(...arguments),this.visualization=mS.Gradient,this.bandsEnabled=!1}};u([X({count:mS.COUNT})],xQ.prototype,"visualization",void 0),u([X()],xQ.prototype,"bandsEnabled",void 0);let b4e=class extends Br{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=uD(u5t),this.bandSize=.1,this.threshold=.5}};const u5t=di(.01,0,.25,1);function h5t(t){const e=new ar,i=e.fragment;i.include(_h),i.include(Sd),e.include(Uz),e.include(Qp);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",eB),i.uniforms.add([new Yt("shadowCastMap",a=>a.shadowCastMap),new Be("sampleScale",a=>a.sampleScale),new Be("opacityFromElevation",a=>a.opacityFromElevation),new Ni("uColor",a=>a.color)]);const n=r===mS.Gradient,o=r===mS.Threshold;return n&&s?i.uniforms.add(new Be("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Be("threshold",a=>a.threshold)),i.code.add(T`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?T`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?T`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?T`* strength`:""});
      }
    `),e}const d5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:b4e,build:h5t},Symbol.toStringTag,{value:"Module"}));let w4e=class x4e extends dr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new cr(e.rctx,x4e.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:yd,colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Xt.TRIANGLE_STRIP}};w4e.shader=new lr(d5t,()=>se(()=>import("./ShadowCastVisualize.glsl-701f5b18.js"),[]));const p5t=4e4,f5t=5e4,T4e=1/512;let T8=class extends Ee{constructor(e,i,r,s){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new b4e(this._data.shadowCastTexture),this._techniqueConfig=new xQ,this._enabled=!1,this._vao=ql(i),this._techniqueConfig.visualization=mS.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=dt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(w4e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,il(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>T4e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;HM(e,i)||(im(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],T8.prototype,"opacityFromElevation",null),T8=u([N("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],T8);let dk=class extends Hl{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};u([X()],dk.prototype,"receiveShadows",void 0),u([X()],dk.prototype,"hasWebGL2Context",void 0);let S4e=class E4e extends dr{constructor(e){super(e,new dk,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,E4e.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:qo(Ne.ONE,Ne.ONE,Ne.ONE,Ne.ONE),colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Xt.TRIANGLE_STRIP}};S4e.shader=new lr(c5t,()=>se(()=>import("./ShadowCastAccumulate.glsl-b8c037f5.js"),[]));let Wc=class extends Ee{constructor(e,i,r,s,n,o){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new v4e,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=fQ,this._previewing=!1,this._handles=new ir,this._cameraForcedForScreenshot=!1,this._bindParameters=new sz(new mne(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=ql(e);const a={colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE,width:0,height:0},l={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Sn(e,a,l),this._accumulationRenderer=new T8(i,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(Nt.SHADOW_ACCUMULATOR,this),ae(()=>r.renderView,h=>{this._handles.remove(X0e),b(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),X0e)},Tr),ae(()=>this._previewing,()=>this._requestRenderIfEnabled(),Mi)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(A(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new S4e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==fQ&&this._opacityFromElevation>T4e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(L_(i,e,Bb))return;const r=Math.min(eB,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ge(i[s]??$(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(m5t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=dt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=dt(this._fbo),this._vao=dt(this._vao),this._accumulationTechniqueCached=Os(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||i<0||i>this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Qe.RGBA,Zt.UNSIGNED_BYTE,Z0e),Z0e[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(_s.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,il(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*g5t%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-OA(p5t,f5t,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([p()],Wc.prototype,"_progress",void 0),u([p()],Wc.prototype,"_sampleCount",void 0),u([p()],Wc.prototype,"_enabledInternal",void 0),u([p()],Wc.prototype,"_depthRange",void 0),u([p()],Wc.prototype,"_previewing",void 0),u([p()],Wc.prototype,"_accumulationRenderer",void 0),u([p()],Wc.prototype,"_isRefining",null),u([p()],Wc.prototype,"_isActive",null),u([p()],Wc.prototype,"canAccumulate",null),u([p()],Wc.prototype,"_isDoneAccumulating",null),u([p()],Wc.prototype,"_opacityFromElevation",null),u([p()],Wc.prototype,"running",null),Wc=u([N("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Wc);const m5t=6,X0e="renderView",g5t=104729,Z0e=new Uint8Array(4),J0e={highlightedThreshold:.99999,selfShadowThreshold:.025};function y5t(t){const e=new ar;e.include(cS,t);const i=e.fragment;return i.include(_h),i.include(Sd),e.include(Uz),e.include(Qp),i.uniforms.add([new Yt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(c3.Default)),new Yt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(c3.Highlight)),new Yt("depthMap",(r,s)=>s.linearDepthTexture),new Yt("highlightMap",(r,s)=>s.highlightColorTexture),new Ni("uColor",r=>r.shadowColor),new hr("nearFar",(r,s)=>s.camera.nearFar),new Be("opacity",r=>r.shadowOpacity),new Be("occludedOpacity",r=>r.occludedShadowOpacity),new Be("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new fi("lightingMainDirectionView",(r,s)=>Re(Q0e,at(Q0e,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new hr("texelSize",(r,s)=>b(s.linearDepthTexture)?Vt(_5t,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):mu),new Ps("inverseViewMatrix",(r,s)=>Va(K0e,fu(K0e,s.camera.viewMatrix,s.camera.center)))]),i.constants.add("unoccludedHighlightFlag","vec4",T$e).add("highlightedThreshold","float",J0e.highlightedThreshold).add("selfShadowThreshold","float",J0e.selfShadowThreshold),i.code.add(T`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),i.code.add(T`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const K0e=Ge(),Q0e=$(),_5t=je(),v5t=Object.freeze(Object.defineProperty({__proto__:null,build:y5t},Symbol.toStringTag,{value:"Module"}));let b5t=class extends Br{constructor(){super(...arguments),this.shadowColor=di(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},C4e=class M4e extends dr{constructor(e){super(e,new dk,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,M4e.shader.get().build(this.configuration),rr)}initializePipeline(){return si({blending:qo(Ne.SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Xt.TRIANGLE_STRIP}};C4e.shader=new lr(v5t,()=>se(()=>import("./ShadowHighlight.glsl-fb1382a0.js"),[]));const w5t=.001953125,x5t=4e4,T5t=5e4;let S5t=class{constructor(e,i){this._rctx=e,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new b5t,this._drawParameters=new qLe,this._vao=ql(this._rctx)}get _technique(){return A(this._techniqueCached)&&(this._techniqueCached=new C4e({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,i){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,il(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,i){this._passParameters.opacityElevation=1-OA(x5t,T5t,e.relativeElevation);const r=this._viewingMode===it.Global?Re(e_e,e.center):fe(e_e,0,0,1),s=xe(r,i);this._passParameters.dayNightTerminator=OA(0,1,Se(30*s,0,1))}dispose(){this._vao=dt(this._vao),this._techniqueCached=Os(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=w5t}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const e_e=$(),t_e=sv();let E5t=class{constructor(){this._plane=sv()}get isEnabled(){return!COe(this.plane,t_e)}get plane(){return this._plane}set plane(e){RS(e||t_e,this._plane)}},C5t=class extends Br{};function EL(t){t.uniforms.add(new Ni("resolution",e=>{const{descriptor:i}=e.colorTexture,r=i.width,s=i.height;return Rr(M5t,1/r,1/s,r,s)}))}const M5t=Ai(),QE={maxSearchSteps:8,maxDistanceAreaTex:16};function A5t(){const t=new ar,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(P.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),i.add("maxOffset","vec4"),i.add("pixelCoord","vec2"),EL(r),r.code.add(T`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(QE.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Yt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Yt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Yt("searchTexture",n=>n.searchTexture)),EL(s),s.code.add(T`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(QE.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(QE.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(QE.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(QE.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${T.int(QE.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const O5t=Object.freeze(Object.defineProperty({__proto__:null,build:A5t},Symbol.toStringTag,{value:"Module"}));let A4e=class O4e extends dr{initializeProgram(e){return new cr(e.rctx,O4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};A4e.shader=new lr(O5t,()=>se(()=>import("./BlendWeights.glsl-ec0fc418.js"),[]));function R5t(){const t=new ar,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(P.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),EL(r),r.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Yt("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new Yt("colorTexture",n=>n.colorTexture)),EL(s),s.code.add(T`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const P5t=Object.freeze(Object.defineProperty({__proto__:null,build:R5t},Symbol.toStringTag,{value:"Module"}));let R4e=class P4e extends dr{initializeProgram(e){return new cr(e.rctx,P4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};R4e.shader=new lr(P5t,()=>se(()=>import("./Blur.glsl-9cf38abe.js"),[]));const i_e={threshold:.05,localConstrastAdaption:2};function I5t(){const t=new ar,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(P.POSITION,"vec2"),EL(r),i.add("uv","vec2"),i.add("offsets[3]","vec4"),r.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Yt("colorTexture",n=>n.colorTexture)),s.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(i_e.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${T.float(i_e.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const $5t=Object.freeze(Object.defineProperty({__proto__:null,build:I5t},Symbol.toStringTag,{value:"Module"}));let I4e=class $4e extends dr{initializeProgram(e){return new cr(e.rctx,$4e.shader.get().build(),rr)}initializePipeline(){return si({colorWrite:wi})}};I4e.shader=new lr($5t,()=>se(()=>import("./EdgeDetect.glsl-b136afb3.js"),[]));let cI=class extends Ee{constructor(e,i){super({}),this._rctx=e,this._techniqueRep=i,this._passParameters=new C5t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=lu(this._abortController),this.disable()}_loadResources(e){if(b(this._abortController))return!1;if(b(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const i=this._abortController.signal;return se(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(r=>this._loadTextures(r,i)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,i){return _i(i),Promise.all([this._loadTextureFromBase64(e.areaTexture,mt.LINEAR,Qe.RGB),this._loadTextureFromBase64(e.searchTexure,mt.NEAREST,Qe.LUMINANCE)]).then(([r,s])=>{yo(i)?(r.dispose(),s.dispose(),_i(i)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=s)})}get updating(){return b(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const i=new Hl;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(I4e,i,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(A4e,i,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(R4e,i,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=B0t(this._rctx),this._passParameters.edges=new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGB,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Sn(this._rctx,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:qt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=dt(this._vao),this._passParameters.areaTexture=dt(this._passParameters.areaTexture),this._passParameters.searchTexture=dt(this._passParameters.searchTexture),this._passParameters.blend=dt(this._passParameters.blend),this._passParameters.edges=dt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const i=this._validPassParameters;if(A(i))return;i.colorTexture=e;const r=this._rctx,s=r.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,n,o),i.edges.resize(n,o),r.bindFramebuffer(i.edges),r.setClearColor(0,0,0,1),r.clear(_s.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,i,null),r.drawArrays(Xt.TRIANGLES,0,3),i.blend.resize(n,o),r.bindFramebuffer(i.blend),r.setClearColor(0,0,1,1),r.clear(_s.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,i,null),r.drawArrays(Xt.TRIANGLES,0,3),r.bindFramebuffer(s),r.setClearColor(0,1,0,1),r.clear(_s.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,i,null),r.drawArrays(Xt.TRIANGLES,0,3)}_loadTextureFromBase64(e,i,r){return Y_(e).then(s=>new At(this._rctx,{pixelFormat:r,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.CLAMP_TO_EDGE,width:s.width,height:s.height,samplingMode:i},s))}};u([p()],cI.prototype,"_abortController",void 0),u([p({readOnly:!0})],cI.prototype,"updating",null),cI=u([N("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],cI);function L5t(t,e){const i=-t[0],r=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*i,e[1]+=n*r,e[2]+=n*s,e[4]+=o*i,e[5]+=o*r,e[6]+=o*s,e[8]+=a*i,e[9]+=a*r,e[10]+=a*s,e[12]+=l*i,e[13]+=l*r,e[14]+=l*s}function D5t(t,e){const i=t[0],r=t[1],s=t[2];e[12]+=i*e[0]+r*e[4]+s*e[8],e[13]+=i*e[1]+r*e[5]+s*e[9],e[14]+=i*e[2]+r*e[6]+s*e[10],e[14]+=i*e[3]+r*e[7]+s*e[11]}let N5t=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new F5t(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{Bo(i.viewMatrix,e),D5t(i.origin.vec3,i.viewMatrix)})}},F5t=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=Ge()}},U5t=class extends zRe{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=Hs()}},k5t=class extends BRe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Hs(),this.slicePlaneLocalOrigin=$(),this.transformNormalGlobalFromModel=Hs()}};function V5t(t){const e=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const z5t=nr(.5,-4e-4);function B5t(t,e){const i=t.vertex;i.include(V5t),i.constants.add("depthBias","vec2",z5t),i.uniforms.add(new hr("inverseViewport",(r,s)=>s.inverseViewport)),e.legacy?(i.uniforms.add(new Ps("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new Vy("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Ps("transformProjFromView",r=>r.transformProjFromView)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function G5t(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(T`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function j5t(t,e){const i=t.vertex;e.silhouette?(i.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function H5t(t,e){const i=t.vertex;i.include(_h),i.uniforms.add(new Be("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add($b("componentDataTex",r=>r.componentDataTexture,e.hasWebGL2Context?Ar.None:Ar.InvSize)),t.attributes.add(P.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Xne),i.code.add(T`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Pp(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${_c(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${_c(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${_c(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new Z$("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(P.NORMALA,"vec3"),t.attributes.add(P.NORMALB,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(P.NORMAL,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(y9,e),i.include(y9,e),i.uniforms.add([new Vy("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Z$("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new gd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new gd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new fi("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Ps("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function q5t(t){return t.mode===wo.SKETCH||t.mode===wo.MIXED}var wo,WT;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(wo||(wo={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(WT||(WT={}));function Qne(t,e){const i=t.vertex;switch(t.attributes.add(P.SIDENESS,"vec2"),e.mode===wo.MIXED?i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case wo.MIXED:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case wo.SKETCH:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case wo.SOLID:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case wo.COUNT:break;default:e.mode}}function W5t(t,e){const i=t.vertex;switch(t.include(Qne,e),e.mode){case wo.SOLID:i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case wo.SKETCH:i.uniforms.add(new T2("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case wo.MIXED:i.uniforms.add(new T2("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Y5t(t,e){t.include(Qne,e);const{vertex:i,fragment:r}=t;switch(q5t(e)&&(i.uniforms.add($b("strokesTexture",s=>s.strokesTexture.texture,e.hasWebGL2Context?Ar.None:Ar.InvSize)),i.uniforms.add([new T2("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new T2("strokeVariants",s=>s.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add([new TD("strokesTexture",s=>s.strokesTexture.texture),new T2("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),i.code.add(T`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Pp(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(_h),r.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case wo.SOLID:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case wo.SKETCH:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case wo.MIXED:t.varyings.add("vType","float"),i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function X5t(t){const e=new ar,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add([new r_e("model"),new r_e("localView")]),e.include(B5t,t),e.include(H5t,t),e.include(W5t,t),e.include(Qne,t),e.include(Y5t,t),e.include(Un,t),e.include(j5t,t),e.include(G5t,t),e.include(Ed,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add([new hr("pixelToNDC",(s,n)=>Vt(Z5t,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ni("viewport",(s,n)=>n.camera.fullViewport),new Be("pixelRatio",(s,n)=>n.camera.pixelRatio)]),e.attributes.add(P.POSITION0,"vec3"),e.attributes.add(P.POSITION1,"vec3"),e.attributes.add(P.VARIANTOFFSET,"float"),e.attributes.add(P.VARIANTSTROKE,"float"),e.attributes.add(P.VARIANTEXTENSION,"float"),i.code.add(T`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?T`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:T`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===wo.SKETCH?T`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===wo.MIXED?T`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Z5t=je();let r_e=class extends dn{constructor(e){super(e,"mat4")}};const J5t=Object.freeze(Object.defineProperty({__proto__:null,build:X5t},Symbol.toStringTag,{value:"Module"}));let L4e=class D4e extends dr{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Ft.WEBGL2}initializeProgram(e){return new cr(e.rctx,D4e.shader.get().build(this.configuration),YFe)}initializePipeline(e){return e.blendMinMax?si({blending:qo(Ne.ONE,Ne.ONE,Ne.ZERO,Ne.ONE,Ay.ADD,e.blendMinMax.MAX),depthTest:{func:hs.LEQUAL},colorWrite:wi}):si({depthTest:{func:hs.LEQUAL},depthWrite:gu,colorWrite:wi})}};L4e.shader=new lr(J5t,()=>se(()=>import("./EdgeShader.glsl-dddbba44.js"),[]));let Ng=class extends ca{constructor(){super(...arguments),this.mode=wo.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([X({count:wo.COUNT})],Ng.prototype,"mode",void 0),u([X()],Ng.prototype,"hasSlicePlane",void 0),u([X()],Ng.prototype,"silhouette",void 0),u([X()],Ng.prototype,"legacy",void 0),u([X()],Ng.prototype,"antialiasing",void 0),u([X()],Ng.prototype,"doublePrecisionRequiresObfuscation",void 0),u([X()],Ng.prototype,"hasMultipassTerrain",void 0),u([X()],Ng.prototype,"cullAboveGround",void 0),u([X()],Ng.prototype,"spherical",void 0);const K5t=8,DH=128,Q5t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},e6t={solid:wo.SOLID,sketch:wo.SKETCH,uber:wo.MIXED};let NH=class N4e{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new Ng,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Si.TRANSPARENT]:{[Si.TRANSPARENT]:new vi,[Si.OPAQUE]:new vi},[Si.OPAQUE]:{[Si.TRANSPARENT]:new vi,[Si.OPAQUE]:new vi}},this._renderablesDirty=!1,this._drawParameters=new k5t,this._settings={...Q5t,...r},this.key=N4e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:_r.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=e6t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=Os(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[i][Si.TRANSPARENT].forAll(e),this._sortedRenderables[i][Si.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(L4e,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,s,n){this._render(e,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(e,i,r,s,n){this._render(e,i,i.silhouette.vao,r,s,n)}_render(e,i,r,s,n,o){o>0&&(this._bindDraw(e,i,s,n),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(Xt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,s){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const n=new Qz(i.transform.position),o=Hp(s_e,AS(s_e,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;fe(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Si.TRANSPARENT][Si.TRANSPARENT].clear(),this._sortedRenderables[Si.TRANSPARENT][Si.OPAQUE].clear(),this._sortedRenderables[Si.OPAQUE][Si.TRANSPARENT].clear(),this._sortedRenderables[Si.OPAQUE][Si.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==Si.INVISIBLE&&i.edgeTransparency!==Si.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Si.TRANSPARENT][Si.TRANSPARENT].sort(e),this._sortedRenderables[Si.TRANSPARENT][Si.OPAQUE].sort(e),this._sortedRenderables[Si.OPAQUE][Si.TRANSPARENT].sort(e),this._sortedRenderables[Si.OPAQUE][Si.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const s_e=cu();function Goi(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:t6t(t.layout)}}function r5(t){return i6t(t.layout).createView(t.buffer)}function t6t(t){const e=new Array;return t.fields.forEach((i,r)=>{const s={...i,constructor:F4e(i.constructor)};e.push([r,s])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function i6t(t){const e=qs();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(i=>e.fields.set(i[0],{...i[1],constructor:s6t(i[1].constructor)})),e}const r6t=[sse,dv,cs,ph,aw,ose,ase,lse,Bl,oz,nse,K$,t3,az,Q$,Gl,lz,cse,cz,CD,uz,use,WRe,YRe,hse,hz,XRe,ZRe,JRe,dz,KRe,QRe,ePe,tPe,iPe,rPe];function F4e(t){return`${t.ElementType}_${t.ElementCount}`}function s6t(t){return U4e.get(t)}const U4e=new Map;r6t.forEach(t=>U4e.set(F4e(t),t));let n6t=class extends zNe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return YFt(e);const s=await this.invoke(new FH(e),i);return this._unpackOutput(s)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new FH(e),i);return r5(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new FH(e),i);return r5(r)}_unpackOutput(e){return{regular:{instancesData:r5(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:r5(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},FH=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":nee(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function o6t(t){const i=AR.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=AR.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=AR.strokes.length;let d=(c-1)*h*l;for(const{distance:m,pressure:g}of AR.strokes){let y=m,v=g,x=d;for(let S=0;S<c;S++){S!==0&&(y=n_e(y,CL.DISTANCE),v=n_e(v,CL.PRESSURE));for(let E=0;E<AR.resolution;E++){const C=.5+(y?y[E%y.length]/a:0),R=v?v[E%v.length]:1;oL(C,s,x),oL(R,s,x+n),x+=4}x-=l*(h+1)}d+=l}const f=new At(t,{pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:mt.LINEAR,width:i,height:i,wrapMode:qt.REPEAT},s);return new l6t(i,a,o,h,f)}function n_e(t,e){if(!t)return null;const i=t.length/2,r=a6t*i,s=new Array(i);let n=0;const o=e===CL.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*o_e):Math.min(r,l*o_e)}return s}var CL;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(CL||(CL={}));const a6t=.1,o_e=.5;let l6t=class{constructor(e,i,r,s,n){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=dt(this.texture)}};const AR={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function a_e(t){let e=null;for(const i of t){const r=i.type;if(c6t(i)){if(A(e))e=r;else if(e!==r)return"uber"}}return b(e)?e:"uber"}function l_e(t){let e=Si.INVISIBLE;for(const{material:i}of t)if(k4e(i)){if(i.color[3]*i.opacity<1)return Si.TRANSPARENT;e=Si.OPAQUE}return e}function c_e(t){let e=Si.INVISIBLE;for(const{material:i}of t)if(k4e(i)){switch(i.objectTransparency){case Si.TRANSPARENT:case Si.INVISIBLE:return Si.TRANSPARENT;case Si.OPAQUE:if(i.opacity<1)return Si.TRANSPARENT}e=Si.OPAQUE}return e}function k4e(t){return t.size*t.color[3]*t.opacity>0}function c6t(t){return t.size*t.color[3]>0}function u_e(t,e,i,r){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}let Nf=class extends Ee{constructor(t){super(t),this._updatingHandles=new dy,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=$(),this._localOrigins=new N5t(new fne(t.renderSR))}initialize(){this._worker=new n6t(this.schedule),this._componentColorManager=new JFe(this.rctx,3);const t=qFe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=yr.createVertex(this.rctx,or.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=dt(this._strokesTexture),this._componentColorManager=He(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=dt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new d_e(new Promise(d=>l=d),i.center,i.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void le.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new d_e(new Promise(c=>n=c),o,T_(o));this._perObjectData.set(t,a);const l=new Array;if(i.mergeGeometries&&t.geometries.length>1&&u6t(t))l.push(this._addObjectMergedGeometries(t,a,e,i,r));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(A(i))return;const r=e instanceof Array?s=>e[s]:()=>e;i.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=r(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return b(e)?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const s=t instanceof mv,n=!!i.hasSlicePlane,o=a_e(e),a=NH.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));A(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,d.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));A(i)||(i.renderables.forEach(r=>{const s=r.components.meta;for(let n=0;n<s.length;n++)r.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));b(i)&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(A(this._componentColorManager))return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=$(),s=new Qz;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(d=>{d.visible&&(n+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),h&&d.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new U5t(40*n/o,e);fe(r,i[3],i[7],i[11]),s.set(r),ge(a.transformWorldFromViewTH,s.high),ge(a.transformWorldFromViewTL,s.low),jp(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Hp(g_e,a.transformViewFromCameraRelativeRS),AS(a.transformNormalViewFromGlobal,g_e),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=l_e(t.components.meta),i=c_e(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedStaticTransformation(e,i);const r=b(e.localOrigin)?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(fe(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,L5t(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=Se(Math.round(n.size*K5t),0,255),l=Se(n.extensionLength,-DH,255-DH)+DH,c=n.type==="solid"?hk.SOLID:hk.SKETCH,h=255*n.opacity,d=n.color,f=255*d[0],m=255*d[1],g=255*d[2],y=255*d[3];i.textureBuffer.setData(o,0,f,m,g,y),i.textureBuffer.setData(o,1,a,l,c,h),BFe(e[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(A(this._componentColorManager))return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=i.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const r=new h6t(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,s){const n=c=>b(this._verticesBufferObject)?new d6t(new km(this.rctx,YFe,{vertices:FFt,instances:c===WT.REGULAR?ck.glLayout:uk.glLayout},{vertices:this._verticesBufferObject,instances:yr.createVertex(this.rctx,or.STATIC_DRAW,c===WT.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===WT.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(WT.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(WT.SILHOUETTE):null,l=(b(o)?o.vao.size:0)+(b(a)?a.vao.size:0);return new f6t(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},i,l_e(e.meta),c_e(e.meta),e,r)}async _addGeometry(t,e,i,r,s,n){const o=i.vertexAttributes.get(P.POSITION),a=i.indices.get(P.POSITION),l=Ge(),c=this._computeModelTransformWithLocalOrigin(t,i,l),h=new m_e(o,a,l,c);return this._addPositionData(e,h,i.edgeIndicesLength,r,s,n)}async _addPositionData(t,e,i,r,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([r]);if(A(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,d=e.position,f=d.data.length/d.size,m=ak.createBuffer(f);for(let v=0;v<f;v++)m.position.set(v,0,d.data[v*d.size+0]),m.position.set(v,1,d.data[v*d.size+1]),m.position.set(v,2,d.data[v*d.size+2]);u_e(o.meta,[0,m.componentIndex.count],m.componentIndex);const g=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(t.loaded==null)return;const y=this._createRenderable(g,o,new p6t(l,c),a.key,!1);t.renderables.push(y),a.addRenderable(y),this._gpuMemoryUsage+=y.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(A(a))return 0;const l=a_e(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=ak.createBuffer(i.count);jz(h.position,i),u_e(a.meta,s,h.componentIndex,r);const d=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,d,!1,r));if(e.loaded==null)return 0;const g=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(g),c.addRenderable(g),g.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let x=0;x<t.geometries.length;x++){const S=t.geometries[x];if(!S.material.supportsEdges)continue;!a&&S.localOrigin&&(a=S);const E=S.vertexAttributes.get(P.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,d=[];let f=0;for(let x=0;x<t.geometries.length;x++){const S=t.geometries[x];if(!S.material.supportsEdges)continue;const E=S.vertexAttributes.get(P.POSITION),C=S.indices.get(P.POSITION);let R=n.get(E.data);if(R==null){R=d.length/3;for(let O=0;O<E.data.length;O+=E.size)d.push(E.data[O+0]),d.push(E.data[O+1]),d.push(E.data[O+2]);n.set(E.data,R)}if(C)for(let O=0;O<S.edgeIndicesLength;O++)h[f++]=R+C[O]}const m=a||t.geometries[0],g=Ge(),y=this._computeModelTransformWithLocalOrigin(t,m,g);for(let x=0;x<t.geometries.length;x++)t.geometries[x].localOrigin=y.origin;const v=new m_e({data:d,size:3},h,g,y);await this._updatingHandles.addPromise(this._addPositionData(e,v,h.length,i[0],r,s))}_acquireRenderer(t,e,i){const r=NH.getKey(t,e,i);let s=this._renderers.get(r);return A(this._strokesTexture)&&(this._strokesTexture=o6t(this.rctx)),s||(s=new NH(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===it.Global}),this._renderers.set(r,s)),++s.refCount,s}_removeRenderable(t){h_e(t.regular),h_e(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=$(),s=n=>{as(r,n.center,e);const o=xe(r,i),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),s=i.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!p_e(o)||!o.visible)return;const a=s5(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(r,o,i,e,a)},s)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),s=i.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!f_e(o)||!o.visible)return;const a=s5(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(r,o,i,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(p_e(o)&&(e=s5(o.regular.lod.lengths,o.distanceToCamera,i)>0),!e&&f_e(o)&&(e=s5(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},n);return this._renderers.forEach(s=>{e||(r(s,Si.OPAQUE),r(s,Si.TRANSPARENT))}),e}}}};function h_e(t){b(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function u6t(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const s=t.geometries[r];if(s.material.supportsEdges){if(e){if(!L_(e,s.transformation))return!1}else e=s.transformation;if(!i&&b(s.localOrigin))i=s;else if(i&&b(i.localOrigin)&&b(s.localOrigin)&&i.localOrigin.id!==s.localOrigin.id)return!1}}return!0}u([p({constructOnly:!0})],Nf.prototype,"rctx",void 0),u([p({constructOnly:!0})],Nf.prototype,"renderSR",void 0),u([p({constructOnly:!0})],Nf.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],Nf.prototype,"techniqueRepository",void 0),u([p({constructOnly:!0})],Nf.prototype,"setNeedsRender",void 0),u([p({constructOnly:!0})],Nf.prototype,"schedule",void 0),u([p({readOnly:!0})],Nf.prototype,"_updatingHandles",void 0),u([p({readOnly:!0})],Nf.prototype,"updating",null),Nf=u([N("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Nf);class d_e{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class h6t{constructor(e,i){this.buffer=e,this.meta=i}}let d6t=class{constructor(e,i){this.vao=e,this.lod=i}};class p6t{constructor(e,i){this.modelMatrix=e,this.origin=i}}class f6t{constructor(e,i,r,s,n,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function p_e(t){return b(t.regular)}function f_e(t){return b(t.silhouette)}function s5(t,e,i){const r=e*i,s=PGe(t,r,!0);return s===-1?r<t[0]?t.length:0:t.length-s}let m_e=class{constructor(e,i,r,s){this.position=e,this.indices=i,this.modelTransform=r,this.origin=s}};const g_e=Hs();function Gy(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let y_e=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},j0=!1;function m6t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Gy(t)?new y_e(()=>t.createQuery(),r=>{t.deleteQuery(r),j0=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{j0||(j0=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),j0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new y_e(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),j0=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{j0||(j0=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),j0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function g6t(t,e){const i=t.capabilities.disjointTimerQuery;return A(i)?null:new y6t(i,e)}let y6t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){j0||(this._currentQuery=this._queryPool.pop(),A(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||A(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(A(i))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){b(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){b(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{A(e)||this._timer.deleteQuery(e)})}};var os;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(os||(os={}));const __e="Total";let _6t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new p_(__e),this._cpuTimeSamplers=new Map(Object.values(os).map(i=>[i,new p_(i)])),this._enableGPUTimer=0,this._totalGPUTime=new p_("GPU"),this._gpuTimeSamplers=new Map(Object.values(os).map(i=>[i,new p_(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return b(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(A(this._gpuTimerPool)){const e=[...Object.values(os),__e];this._gpuTimerPool=g6t(this._rctx,e)}return A(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:cee(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=dt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),b(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,b(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(b(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(os.FINISH);this._gpuTimeSamplers.get(os.FINISH).record(i)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),b(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},Uh=class extends Ee{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(t,e=this._state){return vt(this._renderStateFeatures.get(e,t),!1)}setFeatureEnabled(t,e,i){this._renderStateFeatures.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(In.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(In.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(In.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,i,r,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new vi,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new E5t,this._state=Ki.IDLE,this._renderStateFeatures=cfe(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Lo.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new D4t,this._handles=new ir,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new cI(this._rctx,r),a(),this._offscreen=new t5t(this._rctx,this._compositingHelper),this.performanceInfo=new _6t(this._rctx),this._shadowMap=new mne(this._rctx,t.viewingMode),this._ssaoHelper=new oDe(t.view,r,this._rctx,a),this._highlight=new J4t(r,this._rctx),this._shadowHighlight=new S5t(this._rctx,t.viewingMode),this._shadowAccumulator=new Wc(this._rctx,r,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades(H.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new ZCt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new s5t({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new L4t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ae(()=>this._stage.view.state.camera,()=>a(),Tr),ae(()=>_r.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Si.TRANSPARENT):()=>{},a()},ii),ae(()=>this._ssaoEnabled||this.isFeatureEnabled(In.SSAO),l=>this._ssaoHelper.enabled=l,Tr)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=is(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=dt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),lPe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||b(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return A(this._edgeView)&&(this._edgeView=new Nf({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:t=>this._stage.view.resourceController.immediate.schedule(t)}),this._handles.add(ae(()=>fa(this._edgeView,t=>t.updating),()=>this._requestRender(),Mi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Nte(this._bindParameters.ssr.reprojectionMatrix,xd)}set _reprojectionMatrix(t){iee(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){const{_shadowMap:e,_bindParameters:i}=this;if(t.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==t.screenSpaceReflectionsEnabled&&(i.ssr.enabled=t.screenSpaceReflectionsEnabled,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),b(t.environment)){b(t.environment.weather)&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible),t.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==t.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=t.environment.lighting.ambientOcclusionEnabled,this._requestRender()),t.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==t.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=t.environment.lighting.waterReflectionEnabled,this._requestRender());const r=t.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:s}=t;if(i.length===0&&r.length===0&&s.length===0)return;const n=zLe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);A(c)&&a.adds.length>0&&(c=new QLe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(Ie.LINE_CALLOUTS_HUD_DEPTH,H.Color)||a.requiresSlot(Ie.HUD_MATERIAL,H.Color)||a.requiresSlot(Ie.LABEL_MATERIAL,H.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?is(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,i,r,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a}=i;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(os.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=zt.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=sv(this._sliceHelper.plane);r===eS.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(os.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(os.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(os.LINEAR_DEPTH),this._accumulateShadows(h,n,o),this.performanceInfo.advance(os.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(os.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(os.SSAO),this._renderContext.output=H.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(os.OPAQUE);const d=this._terrainRenderingEnabled&&(this._terrainTransparency===Lo.Semitransparent||this._terrainTransparency===Lo.TransparentWithDraped),f=this._highQualityTransparency&&d;this._renderTerrainLinearDepth(f),this._setMultipassEnabled(f),this._setTerrainCulling(f),this._renderEdges(Si.OPAQUE),this.performanceInfo.advance(os.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Ie.VOXEL),this.performanceInfo.advance(os.VOXEL),this._renderHiddenTransparentEdges();const m=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(os.TRANSPARENT),this._renderGeometryLinearDepth(f);const g=this._renderHUDVisibility(f);f||this._renderInternalSlot(Ie.LINE_CALLOUTS),this.performanceInfo.advance(os.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(os.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Si.TRANSPARENT,f),this.performanceInfo.advance(os.TRANSPARENT_EDGES),this._renderTransparentTerrain(),d&&g&&(f?this._renderLineCallouts(qh.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(qh.Occluded,l.framebuffer),this.performanceInfo.advance(os.HUD_OCCLUDED)),this.performanceInfo.advance(os.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),d&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),f&&(this._renderEdges(Si.OPAQUE),this.performanceInfo.advance(os.OPAQUE_EDGES),m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(os.TRANSPARENT),this._renderEdges(Si.TRANSPARENT),this.performanceInfo.advance(os.TRANSPARENT_EDGES))),f&&this._renderLineCallouts(qh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ie.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ie.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(os.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(Ie.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Nl.PremultipliedAlpha),this.performanceInfo.advance(os.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(os.OCCLUDED);const y=r===eS.ON&&this._magnifierHelper.enabled,v=y&&A(t)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(v);const x=this._offscreen.colorTexture;!this._renderAntiAliasing(x)&&b(x)&&this._compositingHelper.composite(this._bindParameters,x,Nl.None),this.performanceInfo.advance(os.ANTIALIASING),this._renderHUD(qh.NotOccluded,v),this.performanceInfo.advance(os.HUD),this._renderHighlights(v,this._bindParameters),this.performanceInfo.advance(os.HIGHLIGHTS),y&&this._magnifierHelper.render(this._rctx,this._bindParameters),v!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Nl.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(t){if(b(t)&&me("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(H.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=qh.NotOccluded,this._renderInternalSlot(Ie.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===vn.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(r,s);this._animationTimestep.frame(n,i)}}readDepthPixels(t,e,i){const r=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=_s.COLOR_BUFFER_BIT|_s.DEPTH_BUFFER_BIT|_s.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(H.Depth)}r.readPixels(e[0],e[1],e[2],e[3],Qe.RGBA,Zt.UNSIGNED_BYTE,i)}readHUDVisibility(t,e,i,r,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,i,r,Qe.RGBA,Zt.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const i=this._edgeView;b(i)&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,t),this._bindParameters,Nl.Alpha,e)}_renderShadowMap(t,e,i,r){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(In.ShadowMapUpdate)&&(s.start(e,i,r),this._shadowHighlight.updateParameters(e,i),this._needsShadowHighlight?(this._renderShadowCascades(H.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,c3.Highlight)),s.clear(),this._renderShadowCascades(H.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,c3.Default),this._renderGeometryAndTransparentTerrainPass(H.ShadowHighlight)})):this._renderShadowCascades(H.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,i=r=>{}){for(const r of e.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(t),i(r)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(H.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=H.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(H.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(H.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return fQ;const e=y4t(t,this._materialRenderers,this._stage.layers);return p3(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Ie.INTEGRATED_MESH),this._renderSlot(Ie.OPAQUE_TERRAIN),this._renderInternalSlot(Ie.OPAQUE_MATERIAL),this._renderSlot(Ie.OPAQUE_MATERIAL),this._renderSlot(Ie.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ie.TRANSPARENT_MATERIAL),this._renderSlot(Ie.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ie.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Ie.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===qh.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Ie.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ie.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(t),!0),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Nl.PremultipliedAlpha)):t===qh.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(qh.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._renderInternalSlot(Ie.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ie.HUD_MATERIAL),this._renderInternalSlot(Ie.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,r=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(H.Highlight),this._rctx.clearSafe(_s.DEPTH_BUFFER_BIT),this._renderHUDElements(qh.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),i.render(this._bindParameters,r,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,i){this._needsShadowCast&&b(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,i)}_renderOrderIndependentTransparency(t,e){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>t(),s,e)},r=this._renderContext.output;this._renderContext.output=H.Alpha,i(zt.Alpha),this._renderContext.output=H.Color,i(zt.Color),i(zt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,e),this._bindParameters.transparencyPassType=zt.NONE,this._renderContext.output=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let t=0;mf.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===Ks.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,mf.push(n))});const e=this._offscreen,i=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};mf.length!==0&&(this._renderInternalSlot(Ie.OCCLUDER_MATERIAL,mf),i(.5,Ks.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ie.TRANSPARENT_OCCLUDER_MATERIAL,mf),!1,!1)),mf.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===Ks.OccludeAndTransparent||n.material.renderOccluded===Ks.Transparent||n.material.renderOccluded===Ks.Opaque)&&(t|=n.material.renderOccluded,mf.push(n))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>Ks.Occlude&&this._renderSlot(Ie.OCCLUDED_TERRAIN),this._renderInternalSlot(Ie.OPAQUE_MATERIAL,mf),this._renderInternalSlot(Ie.TRANSPARENT_MATERIAL,mf),this._renderInternalSlot(Ie.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,mf),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=H.Color,i(.5,Ks.OccludeAndTransparent,()=>s(Ks.OccludeAndTransparent),!0,uu.OutlineVisualElementMask),i(.5,Ks.Transparent,()=>s(Ks.Transparent),!0,uu.OutlineVisualElementMask),i(1,Ks.Opaque,()=>s(Ks.Opaque),!0,uu.OutlineVisualElementMask),mf.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&b(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(Ie.TRANSPARENT_MATERIAL,H.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){A(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=xd:(Va(b_e,this._bindParameters.camera.viewMatrix),Va(v_e,this._bindParameters.camera.projectionMatrix),ln(eC,b_e,v_e),ln(eC,this._renderContext.lastFrameCamera.viewMatrix,eC),ln(eC,this._renderContext.lastFrameCamera.projectionMatrix,eC),this._reprojectionMatrix=eC),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._waterReflectionEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(t,e=this._materialRenderers){let i=!1;return this._bindParameters.slot=t,e.forAll(r=>{r.material.shouldRender(this._renderContext)&&r.render(this._renderContext.output,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=lRe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,i,r,s;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((r=this._shadowMap)==null?void 0:r.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=cfe()},getFramebufferTexture:e=>{switch(e){case Q1.Color:return t._offscreen.colorTexture;case Q1.LinearDepth:return t._offscreen.linearDepthTexture;case Q1.Normals:return t._offscreen.normalTexture;case Q1.ShadowMap:return t._shadowMap.depthTexture;case Q1.HudVisibility:return t._offscreen.hudVisibilityTexture;case Q1.Highlight:return t._offscreen.highlightTexture}}}}};var Q1;u([p()],Uh.prototype,"_shadowAccumulator",void 0),u([p()],Uh.prototype,"_state",void 0),u([p()],Uh.prototype,"_renderStateFeatures",void 0),u([p()],Uh.prototype,"_antialiasingEnabled",void 0),u([p({readOnly:!0})],Uh.prototype,"_antialiasing",null),u([p()],Uh.prototype,"_ssaoEnabled",void 0),u([p()],Uh.prototype,"_smaaPass",void 0),u([p({autoDestroy:!0})],Uh.prototype,"_edgeView",void 0),u([p()],Uh.prototype,"updating",null),u([p()],Uh.prototype,"isCameraFinal",null),Uh=u([N("esri.views.3d.webgl-engine.lib.Renderer")],Uh),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(Q1||(Q1={}));const mf=new vi,v_e=Ge(),b_e=Ge(),eC=Ge();let w_e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ne.ONE,dstRGB:Ne.ZERO,srcAlpha:Ne.ONE,dstAlpha:Ne.ZERO},this.blendEquation={mode:Ay.ADD,modeAlpha:Ay.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=am.BACK,this.frontFace=QA.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=hs.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:am.FRONT_AND_BACK,func:hs.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:am.FRONT_AND_BACK,fail:Tn.KEEP,zFail:Tn.KEEP,zPass:Tn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},v6t=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${r}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const b6t={RECORD_ALLOCATIONS:!1};let w6t=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new v6t(b6t.RECORD_ALLOCATIONS);this._current.length<zo.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,i){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e]),this._allocations.add(i)}decrement(e,i){--this._current[e],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,i)=>e+i,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<zo.COUNT;++i){const r=this._current[i];r>0&&(e+=`${zo[i]}: ${r}
`)}}return e+=this._allocations.information,e}};const x6t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var x_e,TQ={},T6t={get exports(){return TQ},set exports(t){TQ=t}};(x_e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(T6t.exports=x_e);const S6t=TQ;var T_e,SQ={},E6t={get exports(){return SQ},set exports(t){SQ=t}};T_e=E6t,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(T_e.exports=e)}();const S_e=SQ;var EQ={},C6t={get exports(){return EQ},set exports(t){EQ=t}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(C6t);const M6t=EQ;var gf=999,E_e=9999,UH=0,kH=1,C_e=2,M_e=3,A_e=4,n5=5,A6t=6,O6t=7,R6t=8,O_e=9,P6t=10,R_e=11,I6t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function $6t(){var t,e,i,r=0,s=0,n=gf,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(q){return a=[],q!==null?y(q.replace?q.replace(/\r\n/g,`
`):q):v()};function g(q){q.length&&a.push({type:I6t[n],data:q,position:h,line:l,column:c})}function y(q){var ie;for(r=0,i=(m+=q).length;t=m[r],r<i;){switch(ie=r,n){case UH:r=R();break;case kH:r=C();break;case C_e:r=E();break;case M_e:r=O();break;case A_e:r=B();break;case R_e:r=L();break;case n5:r=G();break;case E_e:r=j();break;case O_e:r=S();break;case gf:r=x()}ie!==r&&(m[ie]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function v(q){return o.length&&g(o.join("")),n=P6t,g("(eof)"),a}function x(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+r-1,n=UH,e=t,r+1):e==="/"&&t==="/"?(h=s+r-1,n=kH,e=t,r+1):t==="#"?(n=C_e,h=s+r,r):/\s/.test(t)?(n=O_e,h=s+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=s+r,n=d?A_e:f?M_e:E_e,r)}function S(){return/[^\s]/g.test(t)?(g(o.join("")),n=gf,r):(o.push(t),e=t,r+1)}function E(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=gf,r)}function C(){return E()}function R(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=gf,r+1):(o.push(t),e=t,r+1)}function O(){if(e==="."&&/\d/.test(t))return n=n5,r;if(e==="/"&&t==="*")return n=UH,r;if(e==="/"&&t==="/")return n=kH,r;if(t==="."&&o.length){for(;U(o););return n=n5,r}if(t===";"||t===")"||t==="("){if(o.length)for(;U(o););return g(t),n=gf,r+1}var q=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||q){for(;U(o););return n=gf,r}return o.push(t),e=t,r+1}function U(q){for(var ie,ee,K=0;;){if(ie=S_e.indexOf(q.slice(0,q.length+K).join("")),ee=S_e[ie],ie===-1){if(K--+q.length>0)continue;ee=q.slice(0,1).join("")}return g(ee),h+=ee.length,(o=o.slice(ee.length)).length}}function L(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=gf,r):(o.push(t),e=t,r+1)}function B(){return t==="."||/[eE]/.test(t)?(o.push(t),n=n5,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=R_e,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=gf,r):(o.push(t),e=t,r+1)}function G(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=gf,r):(o.push(t),e=t,r+1)}function j(){if(/[^\d\w_]/.test(t)){var q=o.join("");return n=S6t.indexOf(q)>-1?R6t:M6t.indexOf(q)>-1?O6t:A6t,g(o.join("")),n=gf,r}return o.push(t),e=t,r+1}}function L6t(t){var e=$6t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function D6t(t){return L6t(t)}function N6t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const VH=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function F6t(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function U6t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function uI(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,uI(t,e,r+"_"+e[r],r);return i}function V4e(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function s(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function k6t(t,e,i,r="lowp"){V4e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function V6t(t,e,i,r,s="lowp"){V4e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function z6t(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function P_e(t,e){const i=B6t();if(b(i))return i;const r=D6t(t);if(F6t(r,"100","300 es")==="300 es")return t;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":e===rd.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===rd.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===rd.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=uI(r,o,"fragColor"),k6t(r,s,"vec4")),c.data=s),e===rd.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=z6t(r,l+1),d=uI(r,o,"fragData");V6t(r,d,"vec4",h,"mediump"),c.data=d}else e===rd.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=uI(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(x6t.includes(c.data)){if(e===rd.VERTEX_SHADER&&U6t(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=uI(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&VH.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const d=c.data.match(/\#ifdef\s+(.*)/);d&&d[1]&&VH.includes(d[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&VH.includes(f[1].trim())&&(c.data="#if 0")}}return G6t(t,N6t(r))}function B6t(t){return null}function G6t(t,e){return e}const j6t=4294967295;let H6t=class{constructor(e,i,r,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Ft.WEBGL2&&(i=P_e(i,rd.VERTEX_SHADER),r=P_e(r,rd.FRAGMENT_SHADER)),this._vShader=I_e(this._context,rd.VERTEX_SHADER,i),this._fShader=I_e(this._context,rd.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(zo.Shader,this),pJ()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),pJ()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Ft.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<j6t&&l.uniformBlockBinding(a,d,h)}}this._glName=a,this._context.instanceCounter.increment(zo.Program,this)}get glName(){return this._glName}get hasGLName(){return b(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||A(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(zo.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(zo.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&b(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1iv(e,i){dg(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){dg(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){dg(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){dg(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1fv(e,i){dg(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){dg(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3[e]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){dg(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){dg(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){dg(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){dg(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function I_e(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),pJ()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===rd.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(q6t(i))),s}function q6t(t){let e=2;return t.replace(/\n/g,()=>`
`+W6t(e++)+":")}function W6t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function dg(t,e,i){const r=t.get(e);return r?iee(r,i):(t.set(e,Array.from(i)),!0)}let Y6t=class{constructor(e){this._rctx=e,this._store=new Z3}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(b(n))return n.ref(),n;const o=new H6t(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLObjects:e}}},BD=class{constructor(){this._result=!1}dispose(){this._program=dt(this._program)}get result(){return b(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},X6t=class extends BD{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===Ft.WEBGL2&&me("mac")&&me("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const i=this._rctx;i.resetState();const r=new Sn(i,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),s=yr.createIndex(this._rctx,or.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.useProgram(this._dummyProgram),i.bindBuffer(s,Wt.ELEMENT_ARRAY_BUFFER),i.drawElements(Xt.POINTS,1,Mt.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Xt.TRIANGLES,0,258);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,Qe.RGBA,Zt.UNSIGNED_BYTE,n),r.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const i=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}},Z6t=class extends BD{constructor(e){super(),this._rctx=e,this._program=$_e(this._rctx,!1),this._obfuscated=$_e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=dt(this._obfuscated)}_test(e){if(me("force-double-precision-obfuscation"))return!0;if(A(this._obfuscated))return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Sn(i,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),s=yr.createVertex(i,or.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new qp(i,new Map([["position",0]]),{geometry:[new Ba("position",2,Mt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ve(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ve(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);iK(o,l,3);const c=new Float32Array(6);iK(a,c,3),i.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(Xt.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,Qe.RGBA,Zt.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),r.dispose();const d=(o[2]-a[2])/25,f=Yse(h);return Math.abs(d-f)}};function $_e(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}var L_e,D_e,CQ={},J6t={get exports(){return CQ},set exports(t){CQ=t}};L_e=J6t,(D_e=function(){var t=function(y){window.console&&window.console.log&&window.console.log(y)},e=function(y){window.console&&window.console.error?window.console.error(y):t(y)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(y){if(r==null)for(var v in r={},s={},y)typeof y[v]=="number"&&(r[y[v]]=v,s[v]=y[v])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(y){return o(),r[y]!==void 0}function l(y){o();var v=r[y];return v!==void 0?"gl."+v:"/*UNKNOWN WebGL ENUM*/ 0x"+y.toString(16)}function c(y,v,x,S){var E;if((E=i[y])!==void 0&&(E=E[v])!==void 0&&E[x]){if(typeof E[x]=="object"&&E[x].enumBitwiseOr!==void 0){for(var C=E[x].enumBitwiseOr,R=0,O=[],U=0;U<C.length;++U){var L=s[C[U]];S&L&&(R|=L,O.push(l(L)))}return R===S?O.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(y,v){for(var x="",S=v.length,E=0;E<S;++E)x+=(E==0?"":", ")+c(y,S,E,v[E]);return x}function d(y,v,x){y.__defineGetter__(x,function(){return v[x]}),y.__defineSetter__(x,function(S){v[x]=S})}function f(y,v,x,S){S=S||y,n(y),v=v||function(L,B,G){for(var j="",q=G.length,ie=0;ie<q;++ie)j+=(ie==0?"":", ")+c(B,q,ie,G[ie]);e("WebGL error "+l(L)+" in "+B+"("+j+")")};var E={};function C(L,B){return function(){x&&x(B,arguments);var G=L[B].apply(L,arguments),j=S.getError();return j!=0&&(E[j]=!0,v(j,B,arguments)),G}}var R={};for(var O in y)if(typeof y[O]=="function")if(O!="getExtension")R[O]=C(y,O);else{var U=C(y,O);R[O]=function(){return f(U.apply(y,arguments),v,x,S)}}else d(R,y,O);return R.getError=function(){for(var L in E)if(E.hasOwnProperty(L)&&E[L])return E[L]=!1,L;return y.NO_ERROR},R}function m(y){var v=y.getParameter(y.MAX_VERTEX_ATTRIBS),x=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,x);for(var S=0;S<v;++S)y.disableVertexAttribArray(S),y.vertexAttribPointer(S,4,y.FLOAT,!1,0,0),y.vertexAttrib1f(S,0);y.deleteBuffer(x);var E=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<E;++S)y.activeTexture(y.TEXTURE0+S),y.bindTexture(y.TEXTURE_CUBE_MAP,null),y.bindTexture(y.TEXTURE_2D,null);for(y.activeTexture(y.TEXTURE0),y.useProgram(null),y.bindBuffer(y.ARRAY_BUFFER,null),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindFramebuffer(y.FRAMEBUFFER,null),y.bindRenderbuffer(y.RENDERBUFFER,null),y.disable(y.BLEND),y.disable(y.CULL_FACE),y.disable(y.DEPTH_TEST),y.disable(y.DITHER),y.disable(y.SCISSOR_TEST),y.blendColor(0,0,0,0),y.blendEquation(y.FUNC_ADD),y.blendFunc(y.ONE,y.ZERO),y.clearColor(0,0,0,0),y.clearDepth(1),y.clearStencil(-1),y.colorMask(!0,!0,!0,!0),y.cullFace(y.BACK),y.depthFunc(y.LESS),y.depthMask(!0),y.depthRange(0,1),y.frontFace(y.CCW),y.hint(y.GENERATE_MIPMAP_HINT,y.DONT_CARE),y.lineWidth(1),y.pixelStorei(y.PACK_ALIGNMENT,4),y.pixelStorei(y.UNPACK_ALIGNMENT,4),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),y.UNPACK_COLORSPACE_CONVERSION_WEBGL&&y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.BROWSER_DEFAULT_WEBGL),y.polygonOffset(0,0),y.sampleCoverage(1,!1),y.scissor(0,0,y.canvas.width,y.canvas.height),y.stencilFunc(y.ALWAYS,0,4294967295),y.stencilMask(4294967295),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),y.viewport(0,0,y.canvas.width,y.canvas.height),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);y.getError(););}function g(y){var v,x,S=[],E=[],C={},R=1,O=!1,U=[],L=0,B=0,G=!1,j=0,q={};function ie(te){return typeof te=="function"?te:function(de){te.handleEvent(de)}}y.getContext=(x=y.getContext,function(){var te=x.apply(y,arguments);if(te instanceof WebGLRenderingContext){if(te!=v){if(v)throw"got different context";C=ne(v=te)}return C}return te});var ee=function(te){S.push(ie(te))},K=function(te){E.push(ie(te))};function Y(te){var de=te.addEventListener;te.addEventListener=function(_e,Ce,Pe){switch(_e){case"webglcontextlost":ee(Ce);break;case"webglcontextrestored":K(Ce);break;default:de.apply(te,arguments)}}}function D(){for(var te=Object.keys(q),de=0;de<te.length;++de)delete q[te]}function V(){++B,O||L==B&&y.loseContext()}function k(te,de){var _e=te[de];return function(){if(V(),!O)return _e.apply(te,arguments)}}function Z(){for(var te=0;te<U.length;++te){var de=U[te];de instanceof WebGLBuffer?v.deleteBuffer(de):de instanceof WebGLFramebuffer?v.deleteFramebuffer(de):de instanceof WebGLProgram?v.deleteProgram(de):de instanceof WebGLRenderbuffer?v.deleteRenderbuffer(de):de instanceof WebGLShader?v.deleteShader(de):de instanceof WebGLTexture&&v.deleteTexture(de)}}function Q(te){return{statusMessage:te,preventDefault:function(){G=!0}}}return Y(y),y.loseContext=function(){if(!O){for(O=!0,L=0,++R;v.getError(););D(),q[v.CONTEXT_LOST_WEBGL]=!0;var te=Q("context lost"),de=S.slice();setTimeout(function(){for(var _e=0;_e<de.length;++_e)de[_e](te);j>=0&&setTimeout(function(){y.restoreContext()},j)},0)}},y.restoreContext=function(){O&&E.length&&setTimeout(function(){if(!G)throw"can not restore. webglcontestlost listener did not call event.preventDefault";Z(),m(v),O=!1,B=0,G=!1;for(var te=E.slice(),de=Q("context restored"),_e=0;_e<te.length;++_e)te[_e](de)},0)},y.loseContextInNCalls=function(te){if(O)throw"You can not ask a lost contet to be lost";L=B+te},y.getNumCalls=function(){return B},y.setRestoreTimeout=function(te){j=te},y;function ne(te){for(var de in te)typeof te[de]=="function"?C[de]=k(te,de):d(C,te,de);C.getError=function(){if(V(),!O)for(;Me=v.getError();)q[Me]=!0;for(var Me in q)if(q[Me])return delete q[Me],Me;return C.NO_ERROR};for(var _e=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Ce=0;Ce<_e.length;++Ce){var Pe=_e[Ce];C[Pe]=function(Me){return function(){if(V(),O)return null;var qe=Me.apply(te,arguments);return qe.__webglDebugContextLostId__=R,U.push(qe),qe}}(te[Pe])}var Ze=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Ce=0;Ce<Ze.length;++Ce)Pe=Ze[Ce],C[Pe]=function(Me){return function(){return V(),O?null:Me.apply(te,arguments)}}(C[Pe]);var Le=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Ce=0;Ce<Le.length;++Ce)Pe=Le[Ce],C[Pe]=function(Me){return function(){return V(),!O&&Me.apply(te,arguments)}}(C[Pe]);return C.checkFramebufferStatus=function(Me){return function(){return V(),O?C.FRAMEBUFFER_UNSUPPORTED:Me.apply(te,arguments)}}(C.checkFramebufferStatus),C.getAttribLocation=function(Me){return function(){return V(),O?-1:Me.apply(te,arguments)}}(C.getAttribLocation),C.getVertexAttribOffset=function(Me){return function(){return V(),O?0:Me.apply(te,arguments)}}(C.getVertexAttribOffset),C.isContextLost=function(){return O},C}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}}())!==void 0&&(L_e.exports=D_e);let K6t=class extends BD{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Ft.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Sn(i,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.FLOAT,internalFormat:Bt.RGBA32F,samplingMode:mt.NEAREST,width:1,height:1}),s=yr.createVertex(i,or.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new qp(i,new Map([["a_pos",0]]),{geometry:[new Ba("a_pos",2,Mt.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const o=i.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(Xt.TRIANGLE_STRIP,0,4);const d=si({blending:E$e});i.setPipelineState(d),i.drawArrays(Xt.TRIANGLE_STRIP,0,4),CQ.init(i);const f=i.gl.getError();return i.setViewport(a,l,c,h),i.bindFramebuffer(o),n.dispose(!1),s.dispose(),r.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},Q6t=class extends BD{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Sn(i,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=yr.createVertex(i,or.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new qp(i,new Map([["a_position",0]]),{geometry:[new Ba("a_position",2,Mt.SHORT,0,4)]},{geometry:n});i.useProgram(e);const a=new At(i,{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(a,0);const l=i.getBoundFramebufferObject();i.bindFramebuffer(r),i.useProgram(e);const{x:c,y:h,width:d,height:f}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Xt.TRIANGLE_STRIP,0,4),i.setViewport(c,h,d,f),r.readPixels(0,0,1,1,Qe.RGBA,Zt.UNSIGNED_BYTE,s),o.dispose(!1),n.dispose(),r.dispose();const m=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return m&&le.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(l),m}};const lai={geometry:[new Ba("a_pos",2,Mt.BYTE,0,2)]},cai={geometry:[new Ba("a_pos",2,Mt.BYTE,0,4),new Ba("a_tex",2,Mt.BYTE,2,4)]},e8t={geometry:[new Ba("a_pos",2,Mt.UNSIGNED_SHORT,0,4)]};let t8t=class extends BD{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Sn(i,{colorTarget:en.TEXTURE,depthStencilTarget:sr.NONE},{target:Ut.TEXTURE_2D,wrapMode:qt.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),s=yr.createVertex(i,or.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new qp(i,new Map([["a_pos",0]]),e8t,{geometry:s}),o=new At(i,{dataType:Zt.UNSIGNED_BYTE,pixelFormat:Qe.RGBA,preMultiplyAlpha:!1,wrapMode:qt.CLAMP_TO_EDGE,samplingMode:mt.LINEAR},this._image);i.useProgram(e),i.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(_s.COLOR_BUFFER_BIT),i.bindVAO(n),i.drawArrays(Xt.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return r.readPixels(0,0,1,1,Qe.RGBA,Zt.UNSIGNED_BYTE,f),n.dispose(!1),s.dispose(),r.dispose(),o.dispose(),i.setViewport(l,c,h,d),i.bindFramebuffer(a),f[0]!==255}},i8t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new K6t(e),this.svgPremultipliesAlpha=new t8t(e),this.doublePrecisionRequiresObfuscation=new Z6t(e),this.ignoresSamplerPrecision=new Q6t(e),this.drawArraysRequiresIndicesTypeReset=new X6t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function r8t(t,e){if(e.disjointTimerQuery)return null;if(Gy(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function s8t(t){if(Gy(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function n8t(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function o8t(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function a8t(t,e){if(Gy(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function l8t(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function c8t(t,e){if(Gy(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function u8t(t,e){if(Gy(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function OR(t,e,i,r,s){if(r&&Gy(t))return!0;if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function h8t(t,e){if(!Gy(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function d8t(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function p8t(t,e){if(Gy(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let f8t=class{constructor(e,i){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=r8t(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=s8t(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=p8t(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=n8t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=o8t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=l8t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=m6t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=c8t(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=u8t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=a8t(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=OR(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=OR(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=OR(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=OR(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=d8t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=h8t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=OR(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},m8t=class{constructor(e,i){this.gl=e,this.instanceCounter=new w6t,this.programCache=new Y6t(this),this._state=new w_e,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Gy(e)?Ft.WEBGL2:Ft.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===Ft.WEBGL1?null:this.gl}configure(e){this._capabilities=new f8t(this.gl,e),this._parameters=this._loadParameters(e);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new w_e,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new D0t({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),dt(this._driverTest),this._driverTest=new i8t(this)}dispose(){dt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Wt.ARRAY_BUFFER),this.unbindBuffer(Wt.ELEMENT_ARRAY_BUFFER),this.type===Ft.WEBGL2&&(this.unbindBuffer(Wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Wt.PIXEL_PACK_BUFFER),this.unbindBuffer(Wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Wt.COPY_READ_BUFFER),this.unbindBuffer(Wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Xh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=am.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===am.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=am.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(AG+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&_s.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&_s.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&_s.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){if(Xh()&&(this._numOfDrawCalls++,this._numOfTriangles+=N_e(e,r)),this.gl.drawArrays(e,i,r),Xh()){const s=xpe(this);s&&console.error("drawArrays:",s)}}drawElements(e,i,r,s){if(Xh()&&(this._numOfDrawCalls++,this._numOfTriangles+=N_e(e,i)),this.gl.drawElements(e,i,r,s),Xh()){const n=xpe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:s},d=fa(a,g=>g.size)??0,f=s+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){Xh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Xh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return A(e)||e.glName==null?(b(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(!A(e))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(A(e))return this.gl.bindFramebuffer(na.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(na.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===na.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(A(e)?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=vt(e,null):this._state.drawFramebuffer=vt(e,null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,d=_s.COLOR_BUFFER_BIT,f=mt.NEAREST){this.bindFramebufferSeparate(e,na.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,na.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,d,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Wt.ARRAY_BUFFER:this._state.vertexBuffer=Su(this.gl,e,i,this._state.vertexBuffer);break;case Wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Su(this.gl,e,i,this._state.indexBuffer);break;case Wt.UNIFORM_BUFFER:this._state.uniformBuffer=Su(this.gl,e,i,this._state.uniformBuffer);break;case Wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Su(this.gl,e,i,this._state.pixelPackBuffer);break;case Wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Su(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Su(this.gl,e,i,this._state.copyReadBuffer);break;case Wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Su(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return A(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);A(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);if(!A(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(e,i,r,s){A(i)?this.bindBufferBase(Wt.UNIFORM_BUFFER,e,null):(Xh()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Wt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Wt.UNIFORM_BUFFER,e,i.buffer))}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];b(s)&&s.buffer===e.buffer&&this.bindBufferBase(Wt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Wt.ARRAY_BUFFER:this._state.vertexBuffer=Su(this.gl,null,e,this._state.vertexBuffer);break;case Wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Su(this.gl,null,e,this._state.indexBuffer);break;case Wt.UNIFORM_BUFFER:this._state.uniformBuffer=Su(this.gl,null,e,this._state.uniformBuffer);break;case Wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Su(this.gl,null,e,this._state.pixelPackBuffer);break;case Wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Su(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Su(this.gl,null,e,this._state.copyReadBuffer);break;case Wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Su(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){A(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(dJ.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(zo.Sync,r),i.flush();do await R2(e),s=i.clientWaitSync(r,0,0);while(s===p9.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(zo.Sync,r),i.deleteSync(r),s===p9.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=na.FRAMEBUFFER){return e===na.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Wt.ARRAY_BUFFER),this.unbindBuffer(Wt.ELEMENT_ARRAY_BUFFER),this.type===Ft.WEBGL2&&(this.unbindBuffer(Wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Wt.PIXEL_PACK_BUFFER),this.unbindBuffer(Wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Wt.COPY_READ_BUFFER),this.unbindBuffer(Wt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ne.ONE,Ne.ZERO),this.setBlendEquation(Ay.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(am.BACK),this.setFrontFace(QA.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(hs.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(hs.ALWAYS,0,0),this.setStencilOp(Tn.KEEP,Tn.KEEP,Tn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)i.disableVertexAttribArray(l);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(Wt.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(Wt.ELEMENT_ARRAY_BUFFER,null),b(r)){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Wt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(b(c)){const{buffer:h,offset:d,size:f}=c;h!==null?d===0&&f===0?r.bindBufferBase(Wt.UNIFORM_BUFFER,l,h.glName):r.bindBufferRange(Wt.UNIFORM_BUFFER,l,h.glName,d,f):r.bindBufferBase(Wt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Wt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(na.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(na.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Hh.COLOR_ATTACHMENT0)),r.bindFramebuffer(na.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(na.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}i.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){i.activeTexture(AG+l),i.bindTexture(Ut.TEXTURE_2D,null),i.bindTexture(Ut.TEXTURE_CUBE_MAP,null),this.type===Ft.WEBGL2&&(i.bindTexture(Ut.TEXTURE_3D,null),i.bindTexture(Ut.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];b(c)&&i.bindTexture(c.descriptor.target,c.glName)}i.activeTexture(AG+this._state.activeTexture);const s=this._state.viewport;i.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===Ft.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const i=this.capabilities.textureFilterAnisotropic,r=e.maxAnisotropy??1/0,s=this.type===Ft.WEBGL2,n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return At.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function Su(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function N_e(t,e){switch(t){case Xt.POINTS:return 2*e;case Xt.TRIANGLES:return e/3;case Xt.TRIANGLE_STRIP:case Xt.TRIANGLE_FAN:return e-2;default:return 0}}let g8t=class extends m8t{constructor(e,i,r){super(e,i),this.newCache=r,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,i,r,s){return this.useProgram(e.program),e.bindPipelineState(this,r==null?void 0:r.slot,!!s),e.program.bindPass(i,r),e.program}get test(){return this.programCache.test}},oM=class extends Ee{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ws,this._frameTask=e.view.resourceController.scheduler.registerTask(Nt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(xn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return A(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(bne,new wne)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),vt(i.loadingPromise,i)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(this._rctx,this.textureTechnique,i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",vn.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(A(i))return Rt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new y8t(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),b(i.glTexture)?(this._updateGLTexture(s,i.glTexture),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,kn(l)||le.getLogger(this.declaredClass).error(l),null);return gh(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",vn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],oM.prototype,"_loadingCount",void 0),u([p()],oM.prototype,"_frameTask",void 0),u([p()],oM.prototype,"updating",null),oM=u([N("esri.views.3d.webgl-engine.lib.TextureRepository")],oM);let y8t=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(le.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},hI=class extends Ee{constructor(){super(...arguments),this._passParameters=new _8t,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=dt(this._passParameters.waveNormal),this._passParameters.wavePertubation=dt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return S_.LOADING;if(b(this._passParameters.waveNormal)&&b(this._passParameters.wavePertubation))return S_.LOADED;const i={target:Ut.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:qt.REPEAT,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,Y_(Cr("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new At(e,{...i,width:r.width,height:r.height},r)).catch(r=>le.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,Y_(Cr("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new At(e,{...i,width:r.width,height:r.height},r)).catch(r=>le.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),S_.LOADING}};u([p()],hI.prototype,"_loading",void 0),u([p({type:Boolean,readOnly:!0})],hI.prototype,"updating",null),hI=u([N("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],hI);let _8t=class extends Br{},v8t=class{constructor(e,i){this.viewCamera=e,this.frameHasDecorations=i}},b8t=class{constructor(e,i,r,s){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(vn.BACKGROUND);const i=zb();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.viewCamera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=dG(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Qe.RGBA,Mt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=dG(n.width,n.height,a);return Amt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=dG(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Qe.RGBA,Mt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){let s=null,n=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=i;let c=!1;const h=i.disableDecorations&&e.frameHasDecorations,d=a!==o.fullWidth||l!==o.fullHeight,f=i.ignorePadding&&o.pixelRatio!==i.pixelRatio,m=d||h||f||i.objectAndLayerIdColor;if(i.objectAndLayerIdColor&&(n=new Sn(this._rctx,{width:a,height:l,colorTarget:en.TEXTURE,depthStencilTarget:sr.DEPTH_STENCIL_RENDER_BUFFER})),m){const x=o.clone();if(i.ignorePadding){const C=uD(x.padding);for(let R=0;R<4;R++)C[R]=Math.round(C[R]/x.pixelRatio*i.pixelRatio);x.padding=C}x.fullWidth=a,x.fullHeight=l,x.pixelRatio=i.pixelRatio;const S=o.fovX-x.fovX,E=o.fovY-x.fovY;S<0&&S<E?x.fovX=o.fovX:E<0&&E<S&&(x.fovY=o.fovY),this._forceCameraHook(x),c=!0,s=new Sn(this._rctx,{width:x.fullWidth,height:x.fullHeight,colorTarget:en.TEXTURE,depthStencilTarget:sr.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,x,i.disableDecorations?eS.OFF:eS.ON,r),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),dt(s)},y=this._readbackScreenshot(i,g);g();let v=null;if(i.objectAndLayerIdColor){const x=()=>{this._rctx.bindFramebuffer(null),dt(n)};this._rctx.bindFramebuffer(n),v=this._readbackScreenshot(i,x),this._rctx.bindFramebuffer(null),x()}if(m&&!this._rctx.contextAttributes.alpha)for(let x=3;x<y.data.length;x+=4)y.data[x]=255;if(v&&!this._rctx.contextAttributes.alpha)for(let x=3;x<v.data.length;x+=4)v.data[x]=255;return c&&this._forceCameraHook(o),[y,v]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},La=class extends Ee{constructor(e){super({}),this.events=new ws,this.waterTextureRepository=new hI,this._magnifierHelper=new nM,this.objectAndLayerIdRenderHelper=me("enable-feature:objectAndLayerId-rendering")?new $4t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ae(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),ii),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new SLe(this._rctx),this._shaderTechniqueRepository=new _Le({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new oM(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new vLe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new h4t(this._rctx,this._shaderTechniqueRepository),this.renderer=new Uh(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const i={renderScene:(r,s,n,o,a)=>this.renderer.render(r,s,{camera:n,contentCamera:n,mode:Ki.IDLE},o,a),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,s)=>e.options.screenshot.renderOverlay(r,s)};this._screenshotManager=new b8t(this._rctx,i,r=>this.events.emit("force-camera-for-screenshot",r),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=is(this._frameTask),this._shaderTechniqueRepository=He(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=vn.UPDATE){this._needsRender=!0,e===vn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const d=g4t(4*h,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(b(e)){const h=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);b(h)&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(A(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){HNe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=vn.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?vn.UPDATE:vn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||b(i.forcedAnimationTime)||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new r$e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(vn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,eS.ON,a),n=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(vn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new v8t(i.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(i.mode===Ki.IDLE?s:vn.UPDATE),n=!1)}};this._frameTask=F_(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil==null||i.stencil,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=kmt("3d",this._canvas,r);if(A(s)){const n=me("esri-force-webgl");le.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&le.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&me("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>i.view.resourceController.memoryController.newCache(n,o);return new g8t(e,r,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return b(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return A(this._componentObjectCollection)&&(this._componentObjectCollection=new t4t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([p({type:Boolean,readOnly:!0})],La.prototype,"updating",null),u([p({autoDestroy:!0})],La.prototype,"_rctx",void 0),u([p({autoDestroy:!0})],La.prototype,"_container",void 0),u([p({autoDestroy:!0})],La.prototype,"_canvas",void 0),u([p({autoDestroy:!0})],La.prototype,"_stippleTextureRepository",void 0),u([p({autoDestroy:!0})],La.prototype,"waterTextureRepository",void 0),u([p({autoDestroy:!0})],La.prototype,"_magnifierHelper",void 0),u([p({readOnly:!0})],La.prototype,"objectAndLayerIdRenderHelper",void 0),u([p({autoDestroy:!0})],La.prototype,"_textureRepository",void 0),u([p({autoDestroy:!0})],La.prototype,"_compositingHelper",void 0),u([p({autoDestroy:!0,readOnly:!0})],La.prototype,"renderer",void 0),u([p({autoDestroy:!0})],La.prototype,"_screenshotManager",void 0),u([p()],La.prototype,"componentObjectCollection",null),u([p({autoDestroy:!0})],La.prototype,"_componentObjectCollection",void 0),u([p()],La.prototype,"_needsUpdate",void 0),u([p()],La.prototype,"_needsWaterReflectionUpdate",void 0),La=u([N("esri.views.3d.webgl-engine.parts.RenderView")],La);let Nu=class extends Ee{constructor(e){super(e),this._handles=new ir,this._model=new v8,this._layers=new vi,this._asyncChangeSet=new FK,this._syncChangeSet=new FK,this._layerSyncSet=new Set}initialize(){this._set("renderView",new La(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Nt.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),j9(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){A(e)||(this.renderView.requestRender(),this._model.remove(e),j9(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){b(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){b(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,i){A(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>A(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),i)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===Db.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?gc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,gc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Db.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{(this._layerSyncSet.has(i.id)||i.updatePolicy===Db.SYNC)&&(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id))});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,gc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,gc),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,gc))}addRenderPlugin(e,i,r){const s=this.renderer.renderPlugins.add(e,i,r),n=()=>{Eye(i)&&this.view.sceneIntersectionHelper.addIntersectionHandler(i)};if(gh(s))return s.then(n);n()}removeRenderPlugin(e){Eye(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};Nu.DebugSettings={endFrameContentValidation:!1},u([p({constructOnly:!0})],Nu.prototype,"view",void 0),u([p({constructOnly:!0})],Nu.prototype,"options",void 0),u([p({readOnly:!0})],Nu.prototype,"viewingMode",null),u([p({constructOnly:!0})],Nu.prototype,"container",void 0),u([p({constructOnly:!0})],Nu.prototype,"_handles",void 0),u([p({readOnly:!0})],Nu.prototype,"updating",null),u([p({constructOnly:!0})],Nu.prototype,"_model",void 0),u([p({autoDestroy:!0})],Nu.prototype,"renderView",void 0),u([p({readOnly:!0})],Nu.prototype,"renderer",null),u([p({readOnly:!0})],Nu.prototype,"running",null),Nu=u([N("esri.views.3d.webgl-engine.Stage")],Nu);let Tai=class extends pz{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function z4e(t){return Vm(t)&&t.intersector===Vs.PCL&&!!t.target}let Eai=class extends OPe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},Mai=class extends pz{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function tB(t){return Vm(t)&&t.intersector===Vs.I3S&&!!t.target}function B4e(t){return Vm(t)&&t.intersector===Vs.VOXEL&&!!t.target}function F_e(t,e){var i,r;return fz(t)||mz(t)?ML((i=t.target)==null?void 0:i.object.metadata,e):iMt(t)?(r=e.map)==null?void 0:r.ground:z4e(t)||tB(t)||VLe(t)||B4e(t)?ML(t.target,e):null}function Oai(t,e){const i=MQ(t,e);return b(i)&&i.type==="graphic"?i.graphic:null}function MQ(t,e){var i;if(A(t))return null;if(fz(t)||mz(t))return U_e((i=t.target)==null?void 0:i.object.metadata,e);if(z4e(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(B4e(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return VLe(t)||Ane(t)?U_e(t.target,e):tB(t)?w8t(t.target,e):null}function U_e(t,e){if(A(t)||A(t.graphicUid))return null;const i=ML(t,e);if(A(i))return null;if(i===e.graphics)return A(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||A(t.graphicUid)?null:"getHit"in r?r.getHit(t.graphicUid):null}function w8t(t,e){const i=ML(t,e);if(A(i))return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?T8t(r.getGraphicFromIntersectorTarget(t)):null}function x8t(t,e){const i=ML(t,e);if(A(i))return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function T8t(t){return b(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function ML(t,e){return!t||A(t.layerUid)?null:b(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function Rai(t,e){if(fz(t)||mz(t))return T_(t.target.object.boundingVolumeWorldSpace.bounds);if(Ane(t)){NTe(o5,t.transformation);const i=Math.max(o5[0],o5[1],o5[2]);return t.target.baseBoundingSphere.radius*i}return tB(t)?fa(x8t(t.target,e),i=>.5*Yxe(i)):null}function Pai(t){return!fz(t)&&!mz(t)&&(Ane(t)?t.target.numLodLevels>1:!!tB(t))}const o5=$();async function S8t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+E8t),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const E8t=.05;function C8t(t){return b(t)&&t.type==="graphic"}function M8t(t){return t.find(C8t)??null}let S8=class extends W3e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],S8.prototype,"components",void 0),S8=u([N("esri.views.ui.3d.DefaultUI3D")],S8);const G4e=S8;let Ct=class extends l2e(EAe(CAe(VAe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new G_({slicePlane:vOe},this),this._resourceController=m$t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new MK({view:this}),this.labeler=new mT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new qA,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new zT,this.environmentManager=new Pf,this.floors=new xt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new zyt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new DIt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new G4e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new KK,this.voxelWasm=null,this.voxelWasmPromise=null,PTe(),t&&t.environment||(this._defaults.environment=new WC,this.environment=this._defaults.environment);const e=(i=null)=>{b(i)&&i.type===Hr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([Gs(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ae(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new GTt({view:this}),this.stateManager=new co({view:this})}initialize(){this.groundView=new kyt({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(Gs(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},ii),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},ii),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>vje(e>0?1e3/Math.ceil(e):0),ii),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Tr),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Tr),this.handles.add(ae(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Mi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=He(this.sharedSymbolResources),this._set("labeler",He(this.labeler)),this._set("deconflictor",He(this.deconflictor)),this._resourceController=He(this._resourceController),this._set("stateManager",He(this.stateManager)),this._set("inputManager",He(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",He(this.environmentManager)),this.groundView=He(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||A(t)?(this._clippingArea=null,null):t instanceof ti?this.spatialReference&&(t=a5(t,this.spatialReference),A(t))?(le.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),A(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(le.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&b(t)?le.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===it.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return A(e)||A(t)||e.spatialReference.equals(t)?e:a5(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ye.WGS84,i=a5(this.clippingArea,e);b(i)&&(t=b(t)?t.intersection(i):i);const r=this._get("dataExtent");return b(t)&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ye.WGS84;let e;const i=n=>{const o=a5(n,t);A(o)||(b(e)?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new ti({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!b(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(A(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof WC?t:t instanceof GOe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):WC.fromWebsceneEnvironment(t):Vn(WC,t):new WC}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||b(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(A(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){h8.isValidProfile(t)&&(h8.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||h8.getDefaultProfile()}set slicePlane(t){if(b(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),A(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");RS(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Syt(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?U3.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||wL(a))return;++i,t+=a.updatingProgress}}else++i});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])b(a)&&a.updating&&(i+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])b(a)&&a.updating&&(++i,t+=a.updatingProgress);const r=this.stateManager.test.updatingIgnoreRenderState?Ki.IDLE:this.state.mode;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r!==Ki.IDLE||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.hasPendingInputs||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(b(t))return tG(t);const e=this.spatialReference;return e?b((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?tG(this.defaultsFromMap.viewingMode):I9(e,it.Global)?"global":"local":"global"}set viewingMode(t){this.ready?le.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new z$t(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return le.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=b(i.graphics)&&(b(i.graphics.include)||b(i.graphics.exclude)),s=r9(t)?i9(this,t):t,n=Yg(s);i.enableDraped=i.include&&!i.include.has(rb)||i.exclude&&i.exclude.has(rb);const o=this.sceneIntersectionHelper,a=Wp(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Ga.ALL:Ga.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=MQ(l,this);if(A(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return le.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=vt(t.z==null?iy(this.elevationProvider,t):null,0);return ll(t,tC,this.renderSpatialReference,e),this.state.camera.projectToScreen(tC,zH),xo(zH[0],zH[1])}pixelSizeAt(t){return this.ready?t?(ll(t,tC,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(tC)):0:(le.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return le.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=r9(t)?i9(this,t):t,r=zs(i.x,i.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Wp(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Ga.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=F_e(a,this),c=b(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Vm(a)?a.distanceInRenderSpace:0,layer:c}};return _r.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:i}=await S8t(this,t);let r=null;return!(e.length===0||Math.abs(vt(e[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(A(t.parent))throw new J("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return U6(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return k6(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[k6(i[0],this._pixelFormat()),k6(i[1],this._pixelFormat())]}_completeSettings(t){const e=Tmt(t,this);return e.pixelRatio/=this.state.pixelRatio,Omt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!me("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=U6(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,U6(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(A(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return upe.importLayerView(t)}hasLayerViewModule(t){return upe.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i,r;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=z3e(this.type);const e=me("safari");if(e&&e<9&&(t=new J("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),b(t))throw le.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return b(t)?Tde(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(b(i))return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,it.Local),s=this._validateSpatialReferenceForViewingMode(t,e,it.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,it.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,it.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!I9(t,i)&&(!!A(e)||!!wle(e)||(!xI(e)||!A(Wz(e,t,i)))&&(!ble(e)||i!==it.Global))}_makeSpatialReferenceConstraints(t,e,i){if(A(e))return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,s=t.isWGS84;return wle(e)&&(r||s)?!s||i===it.Local||Une(e.tileInfo,e.fullExtent,t,it.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Ye.WebMercator,viewingMode:i}]:[{spatialReference:r?Ye.WGS84:Ye.WebMercator,viewingMode:i}]:xI(e)||ble(e)||!r&&!s?xI(e)&&r&&i!==it.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Ye.WGS84,viewingMode:it.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Ye.WGS84:Ye.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=b(this.getSpatialReferenceSupport({spatialReference:t})),i=this._predeterminedViewingMode;return e||(b(i)?le.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${tG(i)} viewing mode.`):t.isGeographic&&le.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||Ye.WGS84;return _a(t,this.renderSpatialReference,t,i)||(i=Ye.WGS84,_a(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new st(t,i),e}trackGraphicState(t){if(!t.graphic)return le.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{var o;!r&&b(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return b(e)?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,b(i)&&(i.remove(),i=null)}}}highlight(t){if(Array.isArray(t))return bA(t.map(i=>this.highlight(i)));if(xt.isCollection(t))return bA(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Dp()}maskOccludee(t){if(!t)return le.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&b(n)&&Mdt(n)&&(i=n.maskOccludee(t))};return b(e)?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,b(i)&&(i.remove(),i=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){b(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Wb(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new J("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,c$.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,c$.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(tC)?(e=this.computeMapPointFromVec3d(tC,e),t.intersector===Vs.TERRAIN&&this.basemapTerrain&&(e.z=vt(iy(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let s=0;s<t.length;s++){const n=t[s],o=F_e(n,this);if(b(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=MQ(n,this);if(A(a))continue;if(a.type==="graphic"){if(A(r)&&s!==t.length-1&&(r=new Set),b(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??dAe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return A(t)||(A(t.include)||t.include.has(i))&&(A(t.exclude)||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof Ho)A8t(i,this._getGraphicFilterUid(t)),e===c$.INCLUDE&&(b(this.graphicsView)&&t.layer===this?RR(i,this.graphicsView.processor.layer.id):t.layer&&RR(i,t.layer.uid));else if(m$(t))for(const r of t)r===this.graphics&&b(this.graphicsView)?RR(i,this.graphicsView.processor.layer.id):r===this.map.ground?RR(i,rb):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&RR(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new INt({view:this})),this._set("elevationProvider",new rI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Yc({view:this})),this._set("featureTiles",new Da({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=b(this.basemapTerrain.extent)&&b(this.basemapTerrain.spatialReference)?bd(Xk(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;b(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>_r.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(se(()=>import("./FeatureTileTree3DDebugger-dbeb2d4f.js"),["assets/FeatureTileTree3DDebugger-dbeb2d4f.js","assets/TileTreeDebugger-6f984adc.js"])).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&_r.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||_r.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Tr),this.updatingHandles.add(()=>this.clippingArea,t,Tr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Tr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new JIt(this.map,t));const e=this.state.isGlobal,i=$Oe(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",t$t.create(this.state.viewingMode,i)),e||this.handles.add(ae(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;b(r)&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&dV(r,this.basemapTerrain.spatialReference,k_e,s)&&(this.renderCoordsHelper.extent=k_e)},Mi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(r3/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){b(t)&&t.type===Hr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(ae(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Mi),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const i=t.getContext("2d");return i.putImageData(e,0,0),this.overlay.renderCanvas(t),i.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new NIt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const i=pV(this.surface);this._stage=new Nu({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=zL(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new J("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),ii),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),ii),ae(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Tr),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:KK.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(r3/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=He(this._stage),this._lostWebGLContextHandle=is(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new j$t({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await se(()=>import("./GraphicsView3D-8635f9f2.js"),["assets/GraphicsView3D-8635f9f2.js","assets/GraphicsProcessor-4e60627d.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/GraphicsView-a2abd211.js"])).default;_i(t),await Wb(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),b(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Tde(this.viewingMode);if(t===it.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(Gs(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(rb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(rb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return A(this.voxelWasm)?(A(this.voxelWasmPromise)&&(this.voxelWasmPromise=se(()=>import("./VoxelWasmPerSceneView-8912b936.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){b(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function RR(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function A8t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function a5(t,e){return b(t)&&Bp(t.spatialReference,e)?bd(t,e):null}var c$;Ct.type="3d",u([p()],Ct.prototype,"_userClippingArea",void 0),u([p()],Ct.prototype,"_resourceController",void 0),u([p()],Ct.prototype,"_stage",void 0),u([p({readOnly:!0})],Ct.prototype,"deconflictor",void 0),u([p({readOnly:!0})],Ct.prototype,"labeler",void 0),u([p(e9(qA,"analyses"))],Ct.prototype,"analyses",void 0),u([p({type:j_,readOnly:!0})],Ct.prototype,"animation",null),u([p({readOnly:!0})],Ct.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],Ct.prototype,"elevationProvider",void 0),u([p()],Ct.prototype,"camera",null),u([p({type:Vp})],Ct.prototype,"contentCamera",null),u([p({readOnly:!0})],Ct.prototype,"canvas",void 0),u([p({type:st})],Ct.prototype,"center",null),u([p({type:ti})],Ct.prototype,"clippingArea",null),u([p({type:zT})],Ct.prototype,"constraints",void 0),u([p({type:ti,readOnly:!0})],Ct.prototype,"renderDataExtent",null),u([p({type:ti,readOnly:!0})],Ct.prototype,"dataExtent",null),u([p({type:ti,readOnly:!0})],Ct.prototype,"_groundAndLayersExtent",null),u([p({value:null,type:WC})],Ct.prototype,"environment",null),u([pi("environment")],Ct.prototype,"castEnvironment",null),u([p({readOnly:!0})],Ct.prototype,"environmentManager",void 0),u([p({type:ti})],Ct.prototype,"extent",null),u([p()],Ct.prototype,"floors",void 0),u([p()],Ct.prototype,"screenCenter",null),u([p()],Ct.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],Ct.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Ct.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Ct.prototype,"analysisViewManager",void 0),u([p()],Ct.prototype,"groundView",void 0),u([p({type:Boolean})],Ct.prototype,"initialExtentRequired",null),u([p()],Ct.prototype,"_defaultsFromMapSettings",null),u([p()],Ct.prototype,"interacting",null),u([p()],Ct.prototype,"stationary",null),u([p()],Ct.prototype,"navigating",null),u([p()],Ct.prototype,"map",void 0),u([p({readOnly:!0})],Ct.prototype,"mapCoordsHelper",void 0),u([p()],Ct.prototype,"padding",null),u([p({type:Yc,readOnly:!0})],Ct.prototype,"pointsOfInterest",void 0),u([p({type:Da,readOnly:!0})],Ct.prototype,"featureTiles",void 0),u([p()],Ct.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],Ct.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],Ct.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Ct.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],Ct.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],Ct.prototype,"state",void 0),u([p({readOnly:!0})],Ct.prototype,"inputManager",void 0),u([p({readOnly:!0})],Ct.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],Ct.prototype,"qualityProfile",null),u([p({type:$ye,get(){let t=this._get("qualitySettings");return t||(t=new $ye,h8.apply(this.qualityProfile,t)),t}})],Ct.prototype,"qualitySettings",void 0),u([p()],Ct.prototype,"slicePlane",null),u([p({readOnly:!0})],Ct.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],Ct.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],Ct.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ct.prototype,"resolution",null),u([p({type:Number})],Ct.prototype,"scale",null),u([p()],Ct.prototype,"heightModelInfo",null),u([p()],Ct.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],Ct.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],Ct.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],Ct.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Ct.prototype,"type",void 0),u([p({type:G4e})],Ct.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],Ct.prototype,"updating",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Ct.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],Ct.prototype,"viewingMode",null),u([p({type:ya})],Ct.prototype,"viewpoint",null),u([p({type:Number})],Ct.prototype,"zoom",null),u([p({type:KK})],Ct.prototype,"highlightOptions",void 0),Ct=u([N("esri.views.SceneView")],Ct),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(c$||(c$={}));const tC=$(),zH=zs(),k_e=bi();let H0=class extends nre(ws.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){var i;if(!this.get("view.ready"))throw new J("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await((i=this.view)==null?void 0:i.when()),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([p()],H0.prototype,"_goingHomeController",void 0),u([p({readOnly:!0})],H0.prototype,"state",null),u([p()],H0.prototype,"view",null),u([p({type:ya})],H0.prototype,"viewpoint",null),u([p()],H0.prototype,"go",null),u([p()],H0.prototype,"cancelGo",null),H0=u([N("esri.widgets.Home.HomeViewModel")],H0);const j4e=H0,iC={base:"esri-home esri-widget--button esri-widget",esriIcon:"esri-icon",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let kh=class extends hl{constructor(e,i){super(e,i),this.iconClass=iC.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new j4e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get viewpoint(){return this.viewModel.viewpoint}set viewpoint(e){this.viewModel.viewpoint=e}cancelGo(){this.viewModel.cancelGo()}go(){return this.viewModel.go()}render(){var n;const e=(n=this.viewModel)==null?void 0:n.state,{messagesCommon:i,messages:r}=this,s={[iC.disabled]:e==="disabled"};return ce("div",{bind:this,class:this.classes(iC.base,s),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":r.widgetLabel,title:e==="going-home"?i.cancel:r.title},this.renderIcon())}renderIcon(){var r;const e=(r=this.viewModel)==null?void 0:r.state,i={[iC.esriIcon]:!0,[this.iconClass]:e!=="going-home",[iC.loadingIcon]:e==="going-home",[iC.rotatingIcon]:e==="going-home"};return ce("span",{"aria-hidden":"true",class:this.classes(i)})}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([p()],kh.prototype,"goToOverride",null),u([p()],kh.prototype,"iconClass",void 0),u([p()],kh.prototype,"label",null),u([p(),za("esri/widgets/Home/t9n/Home")],kh.prototype,"messages",void 0),u([p(),za("esri/t9n/common")],kh.prototype,"messagesCommon",void 0),u([p()],kh.prototype,"uiStrings",void 0),u([p()],kh.prototype,"view",null),u([p({type:j4e}),LSe("go")],kh.prototype,"viewModel",void 0),u([p()],kh.prototype,"viewpoint",null),u([Yh()],kh.prototype,"_go",null),kh=u([N("esri.widgets.Home")],kh);const O8t=kh,Nc="esri-scale-bar",Yn={base:`${Nc} esri-widget`,labelContainer:`${Nc}__label-container`,rulerLabelContainer:`${Nc}__label-container--ruler`,lineLabelContainer:`${Nc}__label-container--line`,topLabelContainer:`${Nc}__label-container--top`,bottomLabelContainer:`${Nc}__label-container--bottom`,label:`${Nc}__label`,line:`${Nc}__line`,topLine:`${Nc}__line--top`,bottomLine:`${Nc}__line--bottom`,ruler:`${Nc}__ruler`,rulerBlock:`${Nc}__ruler-block`,barContainer:`${Nc}__bar-container`,rulerBarContainer:`${Nc}__bar-container--ruler`,lineBarContainer:`${Nc}__bar-container--line`,disabled:"esri-disabled"};function H4e(t){if(!t)return null;if(Dk(t)&&t.wkid){const e=vKe[t.wkid];if(e)return e}if(t.wkt){const e=R8t(t.wkt);if(e)return e}return null}function R8t(t){const e=yKe.exec(t);if(!e||e.length!==2)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:s===0?0:1/s}}function iB(t){const e=H4e(t??Ye.WGS84);if(P8t(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function P8t(t){return t!=null&&"b"in t&&"eSq"in t&&"radius"in t}function l5(t,e,i){const{a:r,eSq:s}=iB(i),n=Math.sqrt(s),o=Math.sin(e[1]*qu),a=r*e[0]*qu;let l;return s>0?l=r*((1-s)*(o/(1-s*(o*o))-1/(2*n)*Math.log((1-n*o)/(1+n*o))))*.5:l=r*o,t[0]=a,t[1]=l,t}function rB(t){return H4e(t)!==null}function Dai(t,e="square-meters"){if(t.some(o=>!rB(o.spatialReference)))throw new J("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let o=0;o<t.length;o++){const a=t[o],l=a.spatialReference,{radius:c,densificationRatio:h}=iB(l),d=c*h;i.push($8t(a,d))}const r=[],s=[0,0],n=[0,0];for(let o=0;o<i.length;o++){const{rings:a,spatialReference:l}=i[o];let c=0;for(let h=0;h<a.length;h++){const d=a[h];l5(s,d[0],l),l5(n,d[d.length-1],l);let f=n[0]*s[1]-s[0]*n[1];for(let m=0;m<d.length-1;m++)l5(s,d[m+1],l),l5(n,d[m],l),f+=n[0]*s[1]-s[0]*n[1];c+=f}c=Zr(c,"square-meters",e),r.push(c/-2)}return r}function I8t(t,e="meters"){if(!t)throw new J("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some(r=>!rB(r.spatialReference)))throw new J("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<t.length;r++){const s=t[r],{spatialReference:n}=s,o=s.type==="polyline"?s.paths:s.rings;let a=0;for(let l=0;l<o.length;l++){const c=o[l];let h=0;for(let d=1;d<c.length;d++){const f=c[d-1][0],m=c[d][0],g=c[d-1][1],y=c[d][1];if(g!==y||f!==m){const v=new q4e;W4e(v,[f,g],[m,y],n),h+=v.distance}}a+=h}a=Zr(a,"meters",e),i.push(a)}return i}function $8t(t,e){if(t.type!=="polyline"&&t.type!=="polygon")throw new J("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!rB(i))throw new J("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r=t.type==="polyline"?t.paths:t.rings,s=[],n=[0,0],o=new q4e;for(const a of r){const l=[];s.push(l),l.push([a[0][0],a[0][1]]);let c,h,d=a[0][0],f=a[0][1];for(let m=0;m<a.length-1;m++){if(c=a[m+1][0],h=a[m+1][1],d===c&&f===h)continue;const g=[d,f];W4e(o,[d,f],[c,h],i);const{azimuth:y,distance:v}=o,x=v/e;if(x>1){for(let S=1;S<=x-1;S++)E8(n,g,y,S*e,i),l.push(n.slice(0));E8(n,g,y,(v+Math.floor(x-1)*e)/2,i),l.push(n.slice(0))}E8(n,g,y,v,i),l.push(n.slice(0)),d=n[0],f=n[1]}}return t.type==="polyline"?new cd({paths:s,spatialReference:i}):new kl({rings:s,spatialReference:i})}let q4e=class{constructor(e=0,i,r){this.distance=e,this.azimuth=i,this.reverseAzimuth=r}};function E8(t,e,i,r,s){const n=e[0],o=e[1],a=n*qu,l=o*qu,c=(i??0)*qu,{a:h,b:d,f}=iB(s),m=Math.sin(c),g=Math.cos(c),y=(1-f)*Math.tan(l),v=1/Math.sqrt(1+y*y),x=y*v,S=Math.atan2(y,g),E=v*m,C=E*E,R=1-C,O=R*(h*h-d*d)/(d*d),U=1+O/16384*(4096+O*(O*(320-175*O)-768)),L=O/1024*(256+O*(O*(74-47*O)-128));let B,G,j,q,ie=r/(d*U),ee=2*Math.PI;for(;Math.abs(ie-ee)>1e-12;)j=Math.cos(2*S+ie),B=Math.sin(ie),G=Math.cos(ie),q=L*B*(j+L/4*(G*(2*j*j-1)-L/6*j*(4*B*B-3)*(4*j*j-3))),ee=ie,ie=r/(d*U)+q;const K=x*B-v*G*g,Y=Math.atan2(x*G+v*B*g,(1-f)*Math.sqrt(C+K*K)),D=Math.atan2(B*m,v*G-x*B*g),V=f/16*R*(4+f*(4-3*R)),k=Y/qu,Z=(a+(D-(1-V)*f*E*(ie+V*B*(j+V*G*(2*j*j-1)))))/qu;return t[0]=Z,t[1]=k,t}function W4e(t,e,i,r){const s=e[0]*qu,n=e[1]*qu,o=i[0]*qu,a=i[1]*qu,{a:l,b:c,f:h,radius:d}=iB(r),f=o-s,m=Math.atan((1-h)*Math.tan(n)),g=Math.atan((1-h)*Math.tan(a)),y=Math.sin(m),v=Math.cos(m),x=Math.sin(g),S=Math.cos(g);let E,C,R,O,U,L,B,G,j,q,ie=1e3,ee=f;do{if(B=Math.sin(ee),G=Math.cos(ee),R=Math.sqrt(S*B*(S*B)+(v*x-y*S*G)*(v*x-y*S*G)),R===0)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;U=y*x+v*S*G,L=Math.atan2(R,U),j=v*S*B/R,C=1-j*j,O=U-2*y*x/C,isNaN(O)&&(O=0),q=h/16*C*(4+h*(4-3*C)),E=ee,ee=f+(1-q)*h*j*(L+q*R*(O+q*U*(2*O*O-1)))}while(Math.abs(ee-E)>1e-12&&--ie>0);if(ie===0){const Z=d,Q=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(o-s))*Z,ne=o-s,te=Math.sin(ne)*Math.cos(a),de=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(ne),_e=Math.atan2(te,de);return t.azimuth=_e/qu,t.distance=Q,t.reverseAzimuth=void 0,t}const K=C*(l*l-c*c)/(c*c),Y=K/1024*(256+K*(K*(74-47*K)-128)),D=c*(1+K/16384*(4096+K*(K*(320-175*K)-768)))*(L-Y*R*(O+Y/4*(U*(2*O*O-1)-Y/6*O*(4*R*R-3)*(4*O*O-3)))),V=Math.atan2(S*Math.sin(ee),v*x-y*S*Math.cos(ee)),k=Math.atan2(v*Math.sin(ee),v*x*Math.cos(ee)-y*S);return t.azimuth=V/qu,t.distance=D,t.reverseAzimuth=k/qu,t}function L8t(t){const{wkid:e}=t;if(z[e]!=null)return z.values[z[e]];const{wkt:i}=t,r=i.lastIndexOf(",")+1,s=i.lastIndexOf("]]");return parseFloat(i.substring(r,s))}function V_e(t,e){return t&&t.includes(e)}function z_e(t,e){const{x:i,y:r}=t==="decimal-degrees"?ub(e,!0):e;return[i,r]}function B_e({state:{paddedViewState:t},spatialReference:e,width:i}){return e.isWrappable&&t.worldScreenWidth<i}let aM=class extends Ee{constructor(e){super(e),this.scaleComputedFrom=xo(),this.view=null}get state(){return this.get("view.ready")&&this.get("view.type")==="2d"?"ready":"disabled"}getScaleBarProperties(e,i){if(this.state==="disabled"||isNaN(e)||!i)return null;const r=this._getDistanceInKm(this.view,this.scaleComputedFrom);if(A(r))return null;if(i==="metric")return this._getScaleBarProps(e,r,"metric");const s=r/1.609;return this._getScaleBarProps(e,s,"non-metric")}_getLocationUnit(){const e=this.get("view.spatialReference"),{isWebMercator:i,wkid:r,wkt:s}=e;return i||V_e(s,"WGS_1984_Web_Mercator")?"decimal-degrees":z[r]!=null||V_e(s,"PROJCS")?"linear-unit":"unknown"}_getDistanceInKm(e,i){const{state:r,spatialReference:s}=e,n=this._getLocationUnit();if(n==="linear-unit")return r.extent.width*L8t(s)/1e3;const[o,a]=this._getScaleMeasuringPoints(e,i),l=n==="decimal-degrees"||s.isGeographic&&!rB(s)?Ye.WGS84:s,c=new cd({paths:[[z_e(n,o),z_e(n,a)]],spatialReference:l}),h=lEe(c,10);let d;try{[d]=I8t([h],"kilometers")}catch{return null}return d}_getScaleMeasuringPoints(e,i){const{width:r,height:s,position:n,spatialReference:o}=e;if(B_e(e)){const{valid:h}=dd(o);return[new st(h[0],0,o),new st(h[1],0,o)]}let a=i.y-n[1];a>s?a=s:a<0&&(a=0);const l=xo(0,a),c=xo(r,a);return[e.toMap(l),e.toMap(c)]}_getScaleBarProps(e,i,r){const{view:s}=this;let n=e*i/(B_e(s)?s.state.paddedViewState.worldScreenWidth:s.width),o=r==="metric"?"km":"mi";n<.1&&(o==="mi"?(n*=5280,o="ft"):o==="km"&&(n*=1e3,o="m"));let a=0;for(;n>=1;)n/=10,a++;const l=this._getConstraints(n);if(!l)return null;const{min:c,max:h}=l,d=h/n>=n/c?c:h;return{length:e*(d/n),value:10**a*d,unit:o}}_getConstraints(e){return e>.5?{min:.5,max:1}:e>.3?{min:.3,max:.5}:e>.2?{min:.2,max:.3}:e>.15?{min:.15,max:.2}:e>=.1?{min:.15,max:.1}:void 0}};u([p()],aM.prototype,"scaleComputedFrom",void 0),u([p({readOnly:!0})],aM.prototype,"state",null),u([p()],aM.prototype,"view",void 0),aM=u([N("esri.widgets.Scalebar.ScaleBarViewModel")],aM);const D8t=aM;function c5(t){return 2*t}let Ff=class extends hl{constructor(e,i){super(e,i),this.messages=null,this.unit="non-metric",this.viewModel=new D8t}initialize(){this.addHandles([ae(()=>{const{view:e}=this;return[e==null?void 0:e.stationary,e==null?void 0:e.center,e==null?void 0:e.scale,e==null?void 0:e.zoom]},([e])=>{e&&this.scheduleRender()})])}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set style(e){const i=this.unit==="dual"?"line":e;this._set("style",i)}castStyle(e){return e==="line"?e:"ruler"}castUnit(e){return e==="metric"||e==="dual"?e:"non-metric"}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.get("viewModel.state")==="disabled",i={[Yn.disabled]:e};let r,s;if(!e){const{unit:n,style:o}=this,a=n==="metric"||n==="dual",l=50;if(n==="non-metric"||n==="dual"){const c=this.viewModel.getScaleBarProperties(l,"non-metric");c&&(s=o==="ruler"?this._renderRuler(c):this._renderLine(c,"bottom"))}if(a){const c=this.viewModel.getScaleBarProperties(l,"metric");c&&(r=o==="ruler"?this._renderRuler(c):this._renderLine(c,"top"))}}return ce("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(Yn.base,i)},r,s)}_renderRuler(e){const i=c5(Math.round(e.length)),{messages:r}=this,s=r[e.unit]||r.unknownUnit,n=`${c5(e.value)} ${s}`;return ce("div",{class:this.classes(Yn.barContainer,Yn.rulerBarContainer),key:"esri-scale-bar__ruler"},ce("div",{class:Yn.ruler,styles:{width:`${i}px`}},ce("div",{class:Yn.rulerBlock}),ce("div",{class:Yn.rulerBlock}),ce("div",{class:Yn.rulerBlock}),ce("div",{class:Yn.rulerBlock})),ce("div",{class:this.classes(Yn.labelContainer,Yn.rulerLabelContainer)},ce("div",{class:Yn.label},"0"),ce("div",{class:Yn.label},n)))}_renderLine(e,i){const{messages:r}=this,s=r[e.unit]||r.unknownUnit,n=`${c5(e.value)} ${s}`,o={[Yn.topLabelContainer]:i==="top",[Yn.bottomLabelContainer]:i==="bottom"},a=ce("div",{class:this.classes(Yn.labelContainer,Yn.lineLabelContainer,o),key:"esri-scale-bar__label"},ce("div",{class:Yn.label},n)),l={[Yn.topLine]:i==="top",[Yn.bottomLine]:i==="bottom"},c=c5(Math.round(e.length)),h=ce("div",{class:this.classes(Yn.line,l),key:"esri-scale-bar__line",styles:{width:`${c}px`}});return ce("div",{class:this.classes(Yn.barContainer,Yn.lineBarContainer),key:"esri-scale-bar__line-container"},[h,a])}_handleRootCreateOrUpdate(e){const i=this.viewModel;if(!i)return;const r=e.getBoundingClientRect(),s=r.left+window.pageXOffset,n=r.top+window.pageYOffset,o=xo(s,n);(o.x!==i.scaleComputedFrom.x||o.y!==i.scaleComputedFrom.y)&&(i.scaleComputedFrom=o)}};u([p()],Ff.prototype,"label",null),u([p(),za("esri/widgets/ScaleBar/t9n/ScaleBar")],Ff.prototype,"messages",void 0),u([p()],Ff.prototype,"style",null),u([pi("style")],Ff.prototype,"castStyle",null),u([p()],Ff.prototype,"unit",void 0),u([pi("unit")],Ff.prototype,"castUnit",null),u([p()],Ff.prototype,"view",null),u([p()],Ff.prototype,"viewModel",void 0),Ff=u([N("esri.widgets.ScaleBar")],Ff);const N8t=Ff,F8t=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0,this._allLayersAndTablesPromise=null,this._allLayersAndTablesMap=null}readCapabilities(i,r){const s=r.capabilities&&r.capabilities.split(",").map(S=>S.toLowerCase().trim());if(!s)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const n=this.type,o=n!=="tile"&&!!r.supportsDynamicLayers,a=s.includes("query"),l=s.includes("map"),c=!!r.exportTilesAllowed,h=s.includes("tilemap"),d=s.includes("data"),f=n!=="tile"&&(!r.tileInfo||o),m=n!=="tile"&&(!r.tileInfo||o),g=n!=="tile",y=r.cimVersion&&hS.parse(r.cimVersion),v=(y==null?void 0:y.since(1,4))??!1,x=(y==null?void 0:y.since(2,0))??!1;return{operations:{supportsExportMap:l,supportsExportTiles:c,supportsIdentify:a,supportsQuery:d,supportsTileMap:h},exportMap:l?{supportsArcadeExpressionForLabeling:v,supportsSublayersChanges:g,supportsDynamicLayers:o,supportsSublayerVisibility:f,supportsSublayerDefinitionExpression:m,supportsCIMSymbols:x}:null,exportTiles:c?{maxExportTilesCount:+r.maxExportTilesCount}:null}}readVersion(i,r){let s=r.currentVersion;return s||(s=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),s}async fetchSublayerInfo(i,r){var s;try{return await this.fetchAllLayersAndTables(r),(s=this._allLayersAndTablesMap)==null?void 0:s.get(i)}catch{return}}async fetchAllLayersAndTables(i){await this.load(i),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=tr(jo(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(s=>{this._allLayersAndTablesMap=new Map;for(const n of s.data.layers)this._allLayersAndTablesMap.set(n.id,n);return{result:s.data}},s=>({error:s})));const r=await this._allLayersAndTablesPromise;if(_i(i),"result"in r)return r.result;throw r.error}};return u([p({readOnly:!0})],e.prototype,"capabilities",void 0),u([De("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],e.prototype,"readCapabilities",null),u([p({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([p({type:ti})],e.prototype,"fullExtent",void 0),u([p(Fie)],e.prototype,"id",void 0),u([p({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0),u([p(dD)],e.prototype,"popupEnabled",void 0),u([p({type:Ye})],e.prototype,"spatialReference",void 0),u([p({readOnly:!0})],e.prototype,"version",void 0),u([De("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],e.prototype,"readVersion",null),e=u([N("esri.layers.mixins.ArcGISMapService")],e),e};async function U8t(t,e,i){const r=tv(t);return kst(r,_o.from(e),{...i}).then(s=>s.data.count)}async function k8t(t,e,i){const r=tv(t);return Vst(r,_o.from(e),{...i}).then(s=>({count:s.data.count,extent:ti.fromJSON(s.data.extent)}))}async function V8t(t,e,i){const r=tv(t);return Ust(r,_o.from(e),{...i}).then(s=>s.data.objectIds)}function z8t(t,e){return e}function eoe(t,e,i,r){switch(i){case 0:return AL(t,e+r,0);case 1:return t.originPosition==="lowerLeft"?AL(t,e+r,1):j8t(t,e+r,1)}}function Y4e(t,e,i,r){return i===2?AL(t,e,2):eoe(t,e,i,r)}function B8t(t,e,i,r){return i===2?AL(t,e,3):eoe(t,e,i,r)}function G8t(t,e,i,r){return i===3?AL(t,e,3):Y4e(t,e,i,r)}function AL({translate:t,scale:e},i,r){return t[r]+i*e[r]}function j8t({translate:t,scale:e},i,r){return t[r]-i*e[r]}let H8t=class{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=z8t,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const i=Ute(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(!A(i))for(const r of e.features)i(r.geometry)}createSpatialReference(){return{}}addField(e,i){const r=e.fields;DL(r),r.push(i);const s=r.map(n=>n.name);this._attributesConstructor=function(){for(const n of s)this[n]=null}}addFeature(e,i){e.features.push(i)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(i,r,s)=>this.addCoordinatePoint(i,r,s),this.createGeometry=i=>this.createPointGeometry(i);break;case"esriGeometryPolygon":this.addCoordinate=(i,r,s)=>this._addCoordinatePolygon(i,r,s),this.createGeometry=i=>this._createPolygonGeometry(i);break;case"esriGeometryPolyline":this.addCoordinate=(i,r,s)=>this._addCoordinatePolyline(i,r,s),this.createGeometry=i=>this._createPolylineGeometry(i);break;case"esriGeometryMultipoint":this.addCoordinate=(i,r,s)=>this._addCoordinateMultipoint(i,r,s),this.createGeometry=i=>this._createMultipointGeometry(i)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,i,r){this._lengths.length===0&&(this._toAddInCurrentPath=i),this._lengths.push(i)}addQueryGeometry(e,i){const{queryGeometry:r,queryGeometryType:s}=i,n=pX(r.clone(),r,!1,!1,this._transform),o=MEe(n,s,!1,!1);e.queryGeometryType=s,e.queryGeometry={...o}}createPointGeometry(e){const i={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(i.z=0),e.hasM&&(i.m=0),i}addCoordinatePoint(e,i,r){const s=Ol(this._transform,"transform");switch(i=this._applyTransform(s,i,r,0),r){case 0:e.x=i;break;case 1:e.y=i;break;case 2:"z"in e?e.z=i:e.m=i;break;case 3:e.m=i}}_transformPathLikeValue(e,i){let r=0;i<=1&&(r=this._previousCoordinate[i],this._previousCoordinate[i]+=e);const s=Ol(this._transform,"transform");return this._applyTransform(s,e,i,r)}_addCoordinatePolyline(e,i,r){this._dehydratedAddPointsCoordinate(e.paths,i,r)}_addCoordinatePolygon(e,i,r){this._dehydratedAddPointsCoordinate(e.rings,i,r)}_addCoordinateMultipoint(e,i,r){r===0&&e.points.push([]);const s=this._transformPathLikeValue(i,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,i,r){r===0&&this._toAddInCurrentPath--==0&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const s=this._transformPathLikeValue(i,r),n=e[e.length-1];r===0&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),n.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:i,hasM:r}=e;return i&&r?G8t:i?Y4e:r?B8t:eoe}};async function q8t(t,e,i){const r=tv(t),s={...i},n=_o.from(e),o=!n.quantizationParameters,{data:a}=await Nst(r,n,new H8t({sourceSpatialReference:n.sourceSpatialReference,applyTransform:o}),s);return a}let ip=class extends Ee{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return jo(this.url)}async execute(e,i){const r=await this.executeJSON(e,i);return this.featureSetFromJSON(e,r,i)}async executeJSON(e,i){var l;const r=this._normalizeQuery(e),s=((l=e.outStatistics)==null?void 0:l[0])!=null,n=me("featurelayer-pbf-statistics"),o=!s||n;let a;if(this.pbfSupported&&o)try{a=await q8t(this.url,r,i)}catch(c){if(c.name!=="query:parsing-pbf")throw c;this.pbfSupported=!1}return this.pbfSupported&&o||(a=await gEe(this.url,r,i)),this._normalizeFields(a.fields),a}async featureSetFromJSON(e,i,r){if(!this._queryIs3DObjectFormat(e)||A(this.infoFor3D)||!i.assetMaps||!i.features||!i.features.length)return lD.fromJSON(i);const{meshFeatureSetFromJSON:s}=await lp(se(()=>import("./meshFeatureSet-1d032ed5.js"),["assets/meshFeatureSet-1d032ed5.js","assets/georeference-e4a7e853.js"]),r);return s(e,this.infoFor3D,i)}executeForCount(e,i){return U8t(this.url,this._normalizeQuery(e),i)}executeForExtent(e,i){return k8t(this.url,this._normalizeQuery(e),i)}executeForIds(e,i){return V8t(this.url,this._normalizeQuery(e),i)}async executeRelationshipQuery(e,i){const[{default:r},{executeRelationshipQuery:s}]=await lp(Promise.all([se(()=>Promise.resolve().then(()=>due),void 0),se(()=>import("./executeRelationshipQuery-47c2d7f2.js"),[])]),i);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,i)}async executeRelationshipQueryForCount(e,i){const[{default:r},{executeRelationshipQueryForCount:s}]=await lp(Promise.all([se(()=>Promise.resolve().then(()=>due),void 0),se(()=>import("./executeRelationshipQuery-47c2d7f2.js"),[])]),i);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,i)}async executeAttachmentQuery(e,i){const{executeAttachmentQuery:r,fetchAttachments:s,processAttachmentQueryResult:n}=await lp(se(()=>import("./queryAttachments-ee5793d1.js"),[]),i),o=tv(this.url);return n(o,await(this.queryAttachmentsSupported?r(o,e,i):s(o,e,i)))}async executeTopFeaturesQuery(e,i){const{executeTopFeaturesQuery:r}=await lp(se(()=>import("./executeTopFeaturesQuery-d781e16a.js"),["assets/executeTopFeaturesQuery-d781e16a.js","assets/queryTopFeatures-c8574d9a.js"]),i);return r(this.parsedUrl,e,this.sourceSpatialReference,i)}async executeForTopIds(e,i){const{executeForTopIds:r}=await lp(se(()=>import("./executeForTopIds-88bc4d00.js"),["assets/executeForTopIds-88bc4d00.js","assets/queryTopFeatures-c8574d9a.js"]),i);return r(this.parsedUrl,e,i)}async executeForTopExtents(e,i){const{executeForTopExtents:r}=await lp(se(()=>import("./executeForTopExtents-4f0d837a.js"),["assets/executeForTopExtents-4f0d837a.js","assets/queryTopFeatures-c8574d9a.js"]),i);return r(this.parsedUrl,e,i)}async executeForTopCount(e,i){const{executeForTopCount:r}=await lp(se(()=>import("./executeForTopCount-b1a17d40.js"),["assets/executeForTopCount-b1a17d40.js","assets/queryTopFeatures-c8574d9a.js"]),i);return r(this.parsedUrl,e,i)}_normalizeQuery(e){let i=_o.from(e);if(i.sourceSpatialReference=i.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(i=i===e?i.clone():i,i.gdbVersion=e.gdbVersion||this.gdbVersion,i.dynamicDataSource=e.dynamicDataSource?eu.from(e.dynamicDataSource):this.dynamicDataSource),b(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){i=i===e?i.clone():i,i.formatOf3DObjects=null;for(const r of this.infoFor3D.queryFormats){if(r==="3D_glb"){i.formatOf3DObjects=r;break}r!=="3D_gltf"||i.formatOf3DObjects||(i.formatOf3DObjects=r)}if(!i.formatOf3DObjects)throw new J("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(A(i.outFields)||!i.outFields.includes("*")){i=i===e?i.clone():i,A(i.outFields)&&(i.outFields=[]);const{originX:r,originY:s,originZ:n,translationX:o,translationY:a,translationZ:l,scaleX:c,scaleY:h,scaleZ:d,rotationX:f,rotationY:m,rotationZ:g,rotationDeg:y}=this.infoFor3D.transformFieldRoles;i.outFields.push(r,s,n,o,a,l,c,h,d,f,m,g,y)}}return i}_normalizeFields(e){if(b(this.fieldsIndex)&&b(e))for(const i of e){const r=this.fieldsIndex.get(i.name);r&&Object.assign(i,r.toJSON())}}_queryIs3DObjectFormat(e){return b(this.infoFor3D)&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};u([p({type:eu})],ip.prototype,"dynamicDataSource",void 0),u([p()],ip.prototype,"fieldsIndex",void 0),u([p()],ip.prototype,"gdbVersion",void 0),u([p()],ip.prototype,"infoFor3D",void 0),u([p({readOnly:!0})],ip.prototype,"parsedUrl",null),u([p()],ip.prototype,"pbfSupported",void 0),u([p()],ip.prototype,"queryAttachmentsSupported",void 0),u([p()],ip.prototype,"sourceSpatialReference",void 0),u([p({type:String})],ip.prototype,"url",void 0),ip=u([N("esri.tasks.QueryTask")],ip);const W8t=ip;var C8;function BH(t){return t!=null&&t.type==="esriSMS"}function GH(t,e,i){var s;const r=this.originIdOf(e)>=Qu(i.origin);return{ignoreOrigin:!0,allowNull:r,enabled:!!i&&((s=i.layer)==null?void 0:s.type)==="map-image"&&(i.writeSublayerStructure||r)}}function G_e(t,e,i){var r;return{enabled:!!i&&((r=i.layer)==null?void 0:r.type)==="tile"&&this._isOverridden(e)}}function Gd(t,e,i){return{ignoreOrigin:!0,enabled:i&&i.writeSublayerStructure||!1}}function u5(t,e,i){return{ignoreOrigin:!0,enabled:!!i&&(i.writeSublayerStructure||this.originIdOf(e)>=Qu(i.origin))}}let Y8t=0;const wT=new Set;wT.add("layer"),wT.add("parent"),wT.add("loaded"),wT.add("loadStatus"),wT.add("loadError"),wT.add("loadWarnings");let Ti=C8=class extends Dm(CS(bS(Tm))){constructor(t){super(t),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.geometryType=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null,this._lastParsedUrl=null}async load(t){return this.addResolvingPromise((async()=>{const{layer:e,source:i,url:r}=this;if(!e&&!r)throw new J("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let s=null;if(!e||this.originIdOf("url")>ht.SERVICE||(i==null?void 0:i.type)==="data-layer")s=(await tr(r,{responseType:"json",query:{f:"json"},...t})).data;else{let n=this.id;(i==null?void 0:i.type)==="map-layer"&&(n=i.mapLayerId),s=await e.fetchSublayerInfo(n,t)}s&&(this.sourceJSON=s,this.read({layerDefinition:s},{origin:"service"}))})()),this}readCapabilities(t,e){e=e.layerDefinition||e;const{operations:{supportsQuery:i,supportsQueryAttachments:r},query:{supportsFormatPBF:s},data:{supportsAttachment:n}}=qie(e,this.url);return{exportMap:{supportsModification:!!e.canModifyLayer},operations:{supportsQuery:i,supportsQueryAttachments:r},data:{supportsAttachment:n},query:{supportsFormatPBF:s}}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(t){this._setAndNotifyLayer("definitionExpression",t)}get fieldsIndex(){return new QMe(this.fields||[])}set floorInfo(t){this._setAndNotifyLayer("floorInfo",t)}readGlobalIdFieldFromService(t,e){if((e=e.layerDefinition||e).globalIdField)return e.globalIdField;if(e.fields){for(const i of e.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}get id(){return this._get("id")??Y8t++}set id(t){var e,i,r;this._get("id")!==t&&(((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.exportMap)==null?void 0:r.supportsDynamicLayers)!==!1?this._set("id",t):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(t){this._setAndNotifyLayer("labelingInfo",t)}writeLabelingInfo(t,e,i,r){t&&t.length&&(e.layerDefinition={drawingInfo:{labelingInfo:t.map(s=>s.write({},r))}})}set labelsVisible(t){this._setAndNotifyLayer("labelsVisible",t)}set layer(t){this._set("layer",t),this.sublayers&&this.sublayers.forEach(e=>e.layer=t)}set listMode(t){this._set("listMode",t)}set minScale(t){this._setAndNotifyLayer("minScale",t)}readMinScale(t,e){return e.minScale||e.layerDefinition&&e.layerDefinition.minScale||0}set maxScale(t){this._setAndNotifyLayer("maxScale",t)}readMaxScale(t,e){return e.maxScale||e.layerDefinition&&e.layerDefinition.maxScale||0}get effectiveScaleRange(){const{minScale:t,maxScale:e}=this;return{minScale:t,maxScale:e}}readObjectIdFieldFromService(t,e){if((e=e.layerDefinition||e).objectIdField)return e.objectIdField;if(e.fields){for(const i of e.fields)if(i.type==="esriFieldTypeOID")return i.name}}set opacity(t){this._setAndNotifyLayer("opacity",t)}readOpacity(t,e){var r;const i=e.layerDefinition;return 1-.01*(((i==null?void 0:i.transparency)!=null?i.transparency:(r=i==null?void 0:i.drawingInfo)==null?void 0:r.transparency)??0)}writeOpacity(t,e,i,r){e.layerDefinition={drawingInfo:{transparency:100-100*t}}}writeParent(t,e){this.parent&&this.parent!==this.layer?e.parentLayerId=Rk(this.parent.id):e.parentLayerId=-1}get queryTask(){var o;if(!this.layer)return null;const{spatialReference:t}=this.layer,e="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:i,fieldsIndex:r}=this,s=me("featurelayer-pbf")&&(i==null?void 0:i.query.supportsFormatPBF),n=((o=i==null?void 0:i.operations)==null?void 0:o.supportsQueryAttachments)??!1;return new W8t({url:this.url,pbfSupported:s,fieldsIndex:r,gdbVersion:e,sourceSpatialReference:t,queryAttachmentsSupported:n})}set renderer(t){if(t){for(const e of t.getSymbols())if(B2(e)){le.getLogger(this.declaredClass).warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",t)}get source(){return this._get("source")||new l_({mapLayerId:this.id})}set source(t){this._setAndNotifyLayer("source",t)}set sublayers(t){this._handleSublayersChange(t,this._get("sublayers")),this._set("sublayers",t)}castSublayers(t){return Vn(xt.ofType(C8),t)}writeSublayers(t,e,i){var r;(r=this.sublayers)!=null&&r.length&&(e[i]=this.sublayers.map(s=>s.id).toArray().reverse())}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}get url(){var r;const t=((r=this.layer)==null?void 0:r.parsedUrl)??this._lastParsedUrl,e=this.source;if(!t)return null;if(this._lastParsedUrl=t,(e==null?void 0:e.type)==="map-layer")return`${t.path}/${e.mapLayerId}`;const i={layer:JSON.stringify({source:this.source})};return`${t.path}/dynamicLayer?${xA(i)}`}set url(t){this._overrideIfSome("url",t)}set visible(t){this._setAndNotifyLayer("visible",t)}writeVisible(t,e,i,r){e[i]=this.getAtOrigin("defaultVisibility","service")||t}clone(){const{store:t}=ga(this),e=new C8;return ga(e).store=t.clone(wT),this.commitProperty("url"),e._lastParsedUrl=this._lastParsedUrl,e}createPopupTemplate(t){return Jie(this,t)}createQuery(){return new _o({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var r;if(this.hasOwnProperty("sublayers"))return null;const{layer:t}=this,e=t==null?void 0:t.parsedUrl,i=new(await se(()=>Promise.resolve().then(()=>Sht),void 0)).default({url:e==null?void 0:e.path});return e&&this.source&&(this.source.type==="map-layer"?i.layerId=this.source.mapLayerId:i.dynamicDataSource=this.source),(t==null?void 0:t.refreshInterval)!=null&&(i.refreshInterval=t.refreshInterval),this.definitionExpression&&(i.definitionExpression=this.definitionExpression),this.floorInfo&&(i.floorInfo=ue(this.floorInfo)),this.originIdOf("labelingInfo")>ht.SERVICE&&(i.labelingInfo=ue(this.labelingInfo)),this.originIdOf("labelsVisible")>ht.DEFAULTS&&(i.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>ht.DEFAULTS&&(i.legendEnabled=this.legendEnabled),this.originIdOf("visible")>ht.DEFAULTS&&(i.visible=this.visible),this.originIdOf("minScale")>ht.DEFAULTS&&(i.minScale=this.minScale),this.originIdOf("maxScale")>ht.DEFAULTS&&(i.maxScale=this.maxScale),this.originIdOf("opacity")>ht.DEFAULTS&&(i.opacity=this.opacity),this.originIdOf("popupTemplate")>ht.DEFAULTS&&(i.popupTemplate=ue(this.popupTemplate)),this.originIdOf("renderer")>ht.SERVICE&&(i.renderer=ue(this.renderer)),((r=this.source)==null?void 0:r.type)==="data-layer"&&(i.dynamicDataSource=this.source.clone()),this.originIdOf("title")>ht.DEFAULTS&&(i.title=this.title),(t==null?void 0:t.type)==="map-image"&&t.originIdOf("customParameters")>ht.DEFAULTS&&(i.customParameters=t.customParameters),(t==null?void 0:t.type)==="tile"&&t.originIdOf("customParameters")>ht.DEFAULTS&&(i.customParameters=t.customParameters),i}getField(t){return this.fieldsIndex.get(t)}getFeatureType(t){const{typeIdField:e,types:i}=this;if(!e||!t)return null;const r=t.attributes?t.attributes[e]:void 0;if(r==null)return null;let s=null;return i==null||i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(t,e){const i=e&&e.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[t];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(t)}async queryAttachments(t,e){var h,d;await this.load(),t=UU.from(t);const i=this.capabilities;if(!((h=i==null?void 0:i.data)!=null&&h.supportsAttachment))throw new J("queryAttachments:not-supported","this layer doesn't support attachments");const{attachmentTypes:r,objectIds:s,globalIds:n,num:o,size:a,start:l,where:c}=t;if(!((d=i==null?void 0:i.operations)!=null&&d.supportsQueryAttachments)&&((r==null?void 0:r.length)>0||(n==null?void 0:n.length)>0||(a==null?void 0:a.length)>0||o||l||c))throw new J("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(s!=null&&s.length||n!=null&&n.length||c))throw new J("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);return this.queryTask.executeAttachmentQuery(t,e)}async queryFeatures(t=this.createQuery(),e){var r,s;if(await this.load(),!this.capabilities.operations.supportsQuery)throw new J("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new J("queryFeatures:not-supported","this layer has no url.");const i=await this.queryTask.execute(t,{...e,query:{...(r=this.layer)==null?void 0:r.customParameters,token:(s=this.layer)==null?void 0:s.apiKey}});if(i!=null&&i.features)for(const n of i.features)n.sourceLayer=this;return i}toExportImageJSON(t){var n;const e={id:this.id,source:((n=this.source)==null?void 0:n.toJSON())||{mapLayerId:this.id,type:"mapLayer"}},i=MV(t,this.definitionExpression);b(i)&&(e.definitionExpression=i);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((o,a)=>(o[a]=this.originIdOf(a),o),{});if(Object.keys(r).some(o=>r[o]>ht.SERVICE)){const o=e.drawingInfo={};if(r.renderer>ht.SERVICE&&(o.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>ht.SERVICE&&(o.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>ht.SERVICE){!this.loaded&&this.labelingInfo.some(l=>!l.labelPlacement)&&le.getLogger(this.declaredClass).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.`,{sublayer:this});let a=this.labelingInfo;b(this.geometryType)&&(a=lht(this.labelingInfo,k2.toJSON(this.geometryType))),o.labelingInfo=a.filter(l=>l.labelPlacement).map(l=>l.toJSON({origin:"service",layer:this.layer})),o.showLabels=!0}r.opacity>ht.SERVICE&&(o.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(o.renderer)}return e}_assignDefaultSymbolColors(t){this._forEachSimpleMarkerSymbols(t,e=>{e.color||e.style!=="esriSMSX"&&e.style!=="esriSMSCross"||(e.outline&&e.outline.color?e.color=e.outline.color:e.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(t,e){if(t){const i=("uniqueValueInfos"in t?t.uniqueValueInfos:"classBreakInfos"in t?t.classBreakInfos:null)??[];for(const r of i)BH(r.symbol)&&e(r.symbol);"symbol"in t&&BH(t.symbol)&&e(t.symbol),"defaultSymbol"in t&&BH(t.defaultSymbol)&&e(t.defaultSymbol)}}_setAndNotifyLayer(t,e){var a,l,c,h;const i=this.layer,r=this._get(t);let s,n;switch(t){case"definitionExpression":case"floorInfo":s="supportsSublayerDefinitionExpression";break;case"minScale":case"maxScale":case"visible":s="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":s="supportsDynamicLayers",n="supportsModification"}const o=ga(this).getDefaultOrigin();if(o!=="service"){if(s&&((c=(l=(a=this.layer)==null?void 0:a.capabilities)==null?void 0:l.exportMap)==null?void 0:c[s])===!1)return void this._logLockedError(t,`capability not available 'layer.capabilities.exportMap.${s}'`);if(n&&((h=this.capabilities)==null?void 0:h.exportMap[n])===!1)return void this._logLockedError(t,`capability not available 'capabilities.exportMap.${n}'`)}t!=="source"||this.loadStatus==="not-loaded"?(this._set(t,e),o!=="service"&&r!==e&&i&&i.emit&&i.emit("sublayer-update",{propertyName:t,target:this})):this._logLockedError(t,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(t,e){e&&(e.forEach(i=>{i.parent=null,i.layer=null}),this.handles.removeAll()),t&&(t.forEach(i=>{i.parent=this,i.layer=this.layer}),this.handles.add([t.on("after-add",({item:i})=>{i.parent=this,i.layer=this.layer}),t.on("after-remove",({item:i})=>{i.parent=null,i.layer=null}),t.on("before-changes",i=>{var s,n,o;const r=(o=(n=(s=this.layer)==null?void 0:s.capabilities)==null?void 0:n.exportMap)==null?void 0:o.supportsSublayersChanges;r==null||r||(le.getLogger(this.declaredClass).error(new J("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),i.preventDefault())})]))}_logLockedError(t,e){const{layer:i,declaredClass:r}=this;le.getLogger(r).error(new J("sublayer:locked",`Property '${String(t)}' can't be changed on Sublayer from the layer '${i==null?void 0:i.id}'`,{reason:e,sublayer:this,layer:i}))}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}};Ti.test={isMapImageLayerOverridePolicy:t=>t===Gd||t===GH,isTileImageLayerOverridePolicy:t=>t===G_e},u([p({readOnly:!0})],Ti.prototype,"capabilities",void 0),u([De("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],Ti.prototype,"readCapabilities",null),u([p()],Ti.prototype,"defaultPopupTemplate",null),u([p({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:GH}}})],Ti.prototype,"definitionExpression",null),u([p({type:[R3],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],Ti.prototype,"fields",void 0),u([p({readOnly:!0})],Ti.prototype,"fieldsIndex",null),u([p({type:PMe,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:GH},origins:{"web-scene":{read:!1,write:!1}}}})],Ti.prototype,"floorInfo",null),u([p({type:ti,json:{read:{source:"layerDefinition.extent"}}})],Ti.prototype,"fullExtent",void 0),u([p({type:k2.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:k2.read}}}}})],Ti.prototype,"geometryType",void 0),u([p({type:String})],Ti.prototype,"globalIdField",void 0),u([De("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Ti.prototype,"readGlobalIdFieldFromService",null),u([p({type:Fr,json:{write:{ignoreOrigin:!0}}})],Ti.prototype,"id",null),u([p({value:null,type:[G3],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:Gd}}})],Ti.prototype,"labelingInfo",null),u([Xe("labelingInfo")],Ti.prototype,"writeLabelingInfo",null),u([p({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:Gd}}})],Ti.prototype,"labelsVisible",null),u([p({value:null})],Ti.prototype,"layer",null),u([p({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:u5}}})],Ti.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Ti.prototype,"listMode",null),u([p({type:Number,value:0,json:{write:{overridePolicy:Gd}}})],Ti.prototype,"minScale",null),u([De("minScale",["minScale","layerDefinition.minScale"])],Ti.prototype,"readMinScale",null),u([p({type:Number,value:0,json:{write:{overridePolicy:Gd}}})],Ti.prototype,"maxScale",null),u([De("maxScale",["maxScale","layerDefinition.maxScale"])],Ti.prototype,"readMaxScale",null),u([p({readOnly:!0})],Ti.prototype,"effectiveScaleRange",null),u([p({type:String})],Ti.prototype,"objectIdField",void 0),u([De("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Ti.prototype,"readObjectIdFieldFromService",null),u([p({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:Gd}}})],Ti.prototype,"opacity",null),u([De("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],Ti.prototype,"readOpacity",null),u([Xe("opacity")],Ti.prototype,"writeOpacity",null),u([p({json:{type:Fr,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:Gd}}})],Ti.prototype,"parent",void 0),u([Xe("parent")],Ti.prototype,"writeParent",null),u([p({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(t,e)=>!e.disablePopup},write:{target:"disablePopup",overridePolicy:u5,writer(t,e,i){e[i]=!t}}}})],Ti.prototype,"popupEnabled",void 0),u([p({type:vw,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:u5}}})],Ti.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],Ti.prototype,"queryTask",null),u([p({types:L3,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Gd},origins:{"web-scene":{types:Iie,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Gd}}}}})],Ti.prototype,"renderer",null),u([p({types:{key:"type",base:null,typeMap:{"data-layer":eu,"map-layer":l_}},cast(t){if(t){if("mapLayerId"in t)return U_(l_,t);if("dataSource"in t)return U_(eu,t)}return t},json:{name:"layerDefinition.source",write:{overridePolicy:Gd}}})],Ti.prototype,"source",null),u([p()],Ti.prototype,"sourceJSON",void 0),u([p({value:null,json:{type:[Fr],write:{target:"subLayerIds",allowNull:!0,overridePolicy:Gd}}})],Ti.prototype,"sublayers",null),u([pi("sublayers")],Ti.prototype,"castSublayers",null),u([Xe("sublayers")],Ti.prototype,"writeSublayers",null),u([p({type:String,json:{name:"name",write:{overridePolicy:u5}}})],Ti.prototype,"title",void 0),u([p({type:String})],Ti.prototype,"typeIdField",void 0),u([De("typeIdField",["layerDefinition.typeIdField"])],Ti.prototype,"readTypeIdField",null),u([p({type:[UV],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],Ti.prototype,"types",void 0),u([p({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:G_e}}})],Ti.prototype,"url",null),u([p({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:Gd}}})],Ti.prototype,"visible",null),u([Xe("visible")],Ti.prototype,"writeVisible",null),Ti=C8=u([N("esri.layers.support.Sublayer")],Ti);const sB=Ti;function j_e(t,e,i){return e.flatten(({sublayers:s})=>s).length!==t.length?!0:!!t.some(s=>s.originIdOf("minScale")>i||s.originIdOf("maxScale")>i||s.originIdOf("renderer")>i||s.originIdOf("labelingInfo")>i||s.originIdOf("opacity")>i||s.originIdOf("labelsVisible")>i||s.originIdOf("source")>i)||!Z4e(t,e)}function X4e(t,e,i){return!!t.some(r=>{const s=r.source;return!(!s||s.type==="map-layer"&&s.mapLayerId===r.id&&(A(s.gdbVersion)||s.gdbVersion===i))||r.originIdOf("renderer")>ht.SERVICE||r.originIdOf("labelingInfo")>ht.SERVICE||r.originIdOf("opacity")>ht.SERVICE||r.originIdOf("labelsVisible")>ht.SERVICE})||!Z4e(t,e)}function Z4e(t,e){if(!t||!t.length||A(e))return!0;const i=e.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).map(n=>n.id).toArray();if(t.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of t){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function X8t(t){return!!t&&t.some(e=>e.minScale!=null||e.layerDefinition&&e.layerDefinition.minScale!=null)}const Z8t=le.getLogger("esri.layers.TileLayer");function J8t(t,e){const i=[],r={};return t&&t.forEach(s=>{const n=new sB;if(n.read(s,e),r[n.id]=n,s.parentLayerId!=null&&s.parentLayerId!==-1){const o=r[s.parentLayerId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(n)}else i.unshift(n)}),i}const jH=xt.ofType(sB);function J4e(t,e){t&&t.forEach(i=>{e(i),i.sublayers&&i.sublayers.length&&J4e(i.sublayers,e)})}const K8t=t=>{let e=class extends t{constructor(...i){super(...i),this.allSublayers=new Gb({getCollections:()=>[this.sublayers],getChildrenFunction:r=>r.sublayers}),this.sublayersSourceJSON={[ht.SERVICE]:{},[ht.PORTAL_ITEM]:{},[ht.WEB_SCENE]:{},[ht.WEB_MAP]:{}},this.addHandles(ae(()=>this.sublayers,(r,s)=>this._handleSublayersChange(r,s),Mi))}readSublayers(i,r){if(!r||!i)return;const{sublayersSourceJSON:s}=this,n=Qu(r.origin);if(n<ht.SERVICE||(s[n]={context:r,visibleLayers:i.visibleLayers||s[n].visibleLayers,layers:i.layers||s[n].layers},n>ht.SERVICE))return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin("web-document"),l=ga(this);l.setDefaultOrigin(a),this._set("sublayers",new jH(o)),l.setDefaultOrigin("user")}findSublayerById(i){return this.allSublayers.find(r=>r.id===i)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(i){const r=Qu(i==="web-document"?"web-map":i);let s=ht.SERVICE,n=this.sublayersSourceJSON[ht.SERVICE].layers,o=this.sublayersSourceJSON[ht.SERVICE].context,a=null;const l=[ht.PORTAL_ITEM,ht.WEB_SCENE,ht.WEB_MAP].filter(g=>g<=r);for(const g of l){const y=this.sublayersSourceJSON[g];X8t(y.layers)&&(s=g,n=y.layers,o=y.context,y.visibleLayers&&(a={visibleLayers:y.visibleLayers,context:y.context}))}const c=[ht.PORTAL_ITEM,ht.WEB_SCENE,ht.WEB_MAP].filter(g=>g>s&&g<=r);let h=null;for(const g of c){const{layers:y,visibleLayers:v,context:x}=this.sublayersSourceJSON[g];y&&(h={layers:y,context:x}),v&&(a={visibleLayers:v,context:x})}const d=J8t(n,o),f=new Map,m=new Set;if(h)for(const g of h.layers)f.set(g.id,g);if(a!=null&&a.visibleLayers)for(const g of a.visibleLayers)m.add(g);return J4e(d,g=>{h&&g.read(f.get(g.id),h.context),a&&g.read({defaultVisibility:m.has(g.id)},a.context)}),{origin:y$(s),sublayers:new jH({items:d})}}read(i,r){super.read(i,r),this.readSublayers(i,r)}_handleSublayersChange(i,r){r&&(r.forEach(s=>{s.parent=null,s.layer=null}),this.handles.remove("sublayers-owner")),i&&(i.forEach(s=>{s.parent=this,s.layer=this}),this.handles.add([i.on("after-add",({item:s})=>{s.parent=this,s.layer=this}),i.on("after-remove",({item:s})=>{s.parent=null,s.layer=null})],"sublayers-owner"),this.type==="tile"&&this.handles.add(i.on("before-changes",s=>{Z8t.error(new J("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),s.preventDefault()}),"sublayers-owner"))}};return u([p({readOnly:!0})],e.prototype,"allSublayers",void 0),u([p({readOnly:!0,type:xt.ofType(sB)})],e.prototype,"serviceSublayers",void 0),u([p({value:null,type:jH,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],e.prototype,"sublayers",void 0),u([p({readOnly:!0})],e.prototype,"sublayersSourceJSON",void 0),e=u([N("esri.layers.mixins.SublayersOwner")],e),e};function zai(t){var i;const e=t.layer;return"floorInfo"in e&&((i=e.floorInfo)!=null&&i.floorField)&&"floors"in t.view?K4e(t.view.floors,e.floorInfo.floorField):null}function pk(t,e){var i;return"floorInfo"in e&&((i=e.floorInfo)!=null&&i.floorField)?K4e(t,e.floorInfo.floorField):null}function K4e(t,e){if(!(t!=null&&t.length))return null;const i=t.filter(r=>r!=="").map(r=>`'${r}'`);return i.push("''"),`${e} IN (${i.join(",")}) OR ${e} IS NULL`}const Q8t={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let Vh=class extends Dm(Ee){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(i=>{const r=pk(this.floors,i);return i.toExportImageJSON(r)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&X4e(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",i=>this.notifyChange(Q8t[i.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(i=>i.id).join(","):"show:-1":null}get layerDefs(){var r;const e=!!((r=this.floors)!=null&&r.length),i=this.visibleSublayers.filter(s=>s.definitionExpression!=null||e&&s.floorInfo!=null);return i.length?JSON.stringify(i.reduce((s,n)=>{const o=pk(this.floors,n),a=MV(o,n.definitionExpression);return b(a)&&(s[n.id]=a),s},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const i=this.layer.sublayers,r=n=>{const o=this.scale,a=o===0,l=n.minScale===0||o<=n.minScale,c=n.maxScale===0||o>=n.maxScale;n.visible&&(a||l&&c)&&(n.sublayers?n.sublayers.forEach(r):e.unshift(n))};i&&i.forEach(r);const s=this._get("visibleSublayers");return!s||s.length!==e.length||s.some((n,o)=>e[o]!==n)?e:s}toJSON(){const e=this.layer;let i={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?i.dynamicLayers=this.dynamicLayers:i={...i,layers:this.layers,layerDefs:this.layerDefs},i}};u([p({readOnly:!0})],Vh.prototype,"dynamicLayers",null),u([p()],Vh.prototype,"floors",void 0),u([p({readOnly:!0})],Vh.prototype,"hasDynamicLayers",null),u([p()],Vh.prototype,"layer",null),u([p({readOnly:!0})],Vh.prototype,"layers",null),u([p({readOnly:!0})],Vh.prototype,"layerDefs",null),u([p({type:Number})],Vh.prototype,"scale",void 0),u([p(Sat)],Vh.prototype,"timeExtent",void 0),u([p({readOnly:!0})],Vh.prototype,"version",null),u([p({readOnly:!0})],Vh.prototype,"visibleSublayers",null),Vh=u([N("esri.layers.mixins.ExportImageParameters")],Vh);async function toe(t,e){try{return await createImageBitmap(t)}catch(i){throw new J("request:server",`Unable to load ${e}`,{url:e,error:i})}}let Zn=class extends F3(NV(j3(K8t(F8t(vCe(_D(vD(CS(bD(fCe(Die(Dm(V_))))))))))))){constructor(...e){super(...e),this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.preferredTimeReference=null,this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){const i=b(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(Pl).then(()=>this._fetchService(i))),Promise.resolve(this)}readImageFormat(e,i){const r=i.supportedImageFormatTypes;return r&&r.includes("PNG32")?"png32":"png24"}writeSublayers(e,i,r,s){var h;if(!this.loaded||!e)return;const n=e.slice().reverse().flatten(({sublayers:d})=>d&&d.toArray().reverse()).toArray();let o=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&((h=this.capabilities.exportMap)!=null&&h.supportsDynamicLayers)){const d=Qu(s.origin);if(d===ht.PORTAL_ITEM){const f=this.createSublayersForOrigin("service").sublayers;o=j_e(n,f,ht.SERVICE)}else if(d>ht.PORTAL_ITEM){const f=this.createSublayersForOrigin("portal-item");o=j_e(n,f.sublayers,Qu(f.origin))}}const a=[],l={writeSublayerStructure:o,...s};let c=o;n.forEach(d=>{const f=d.write({},l);a.push(f),c=c||d.originOf("visible")==="user"}),a.some(d=>Object.keys(d).length>1)&&(i.layers=a),c&&(i.visibleLayers=n.filter(d=>d.visible).map(d=>d.id))}createExportImageParameters(e,i,r,s){const n=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const o=new Vh({layer:this,floors:s==null?void 0:s.floors,scale:h9({extent:e,width:i})*n}),a=o.toJSON();o.destroy();const l=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},c=e&&e.spatialReference,h=c.wkid||JSON.stringify(c.toJSON());a.dpi*=n;const d={};if(s!=null&&s.timeExtent){const{start:f,end:m}=s.timeExtent.toJSON();d.time=f&&m&&f===m?""+f:`${f??"null"},${m??"null"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:h,imageSR:h,size:i+","+r,...a,...l,...d}}async fetchImage(e,i,r,s){const{data:n}=await this._fetchImage("image",e,i,r,s);return n}async fetchImageBitmap(e,i,r,s){const{data:n,url:o}=await this._fetchImage("blob",e,i,r,s);return toe(n,o)}async fetchRecomputedExtents(e={}){const i={...e,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}},{data:r}=await tr(this.url,i),{extent:s,fullExtent:n,timeExtent:o}=r,a=s||n;return{fullExtent:a&&ti.fromJSON(a),timeExtent:o&&Jp.fromJSON({start:o[0],end:o[1]})}}loadAll(){return xee(this,e=>{e(this.allSublayers)})}serviceSupportsSpatialReference(e){return tAe(this,e)}async _fetchImage(e,i,r,s,n){var l,c,h;const o={responseType:e,signal:(n==null?void 0:n.signal)??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(i,r,s,n),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}},a=this.parsedUrl.path+"/export";if(((l=o.query)==null?void 0:l.dynamicLayers)!=null&&!((h=(c=this.capabilities)==null?void 0:c.exportMap)!=null&&h.supportsDynamicLayers))throw new J("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:o.query});try{const{data:d}=await tr(a,o);return{data:d,url:a}}catch(d){throw kn(d)?d:new J("mapimagelayer:image-fetch-error",`Unable to load image: ${a}`,{error:d})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:i,ssl:r}=await tr(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});r&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i,this.read(i,{origin:"service",url:this.parsedUrl})}};u([p({type:ew})],Zn.prototype,"dateFieldsTimeReference",void 0),u([p({type:Boolean})],Zn.prototype,"datesInUnknownTimezone",void 0),u([p()],Zn.prototype,"dpi",void 0),u([p()],Zn.prototype,"gdbVersion",void 0),u([p()],Zn.prototype,"imageFormat",void 0),u([De("imageFormat",["supportedImageFormatTypes"])],Zn.prototype,"readImageFormat",null),u([p({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],Zn.prototype,"imageMaxHeight",void 0),u([p({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],Zn.prototype,"imageMaxWidth",void 0),u([p()],Zn.prototype,"imageTransparency",void 0),u([p({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Zn.prototype,"isReference",void 0),u([p({json:{read:!1,write:!1}})],Zn.prototype,"labelsVisible",void 0),u([p({type:["ArcGISMapServiceLayer"]})],Zn.prototype,"operationalLayerType",void 0),u([p({json:{read:!1,write:!1}})],Zn.prototype,"popupEnabled",void 0),u([p({type:ew})],Zn.prototype,"preferredTimeReference",void 0),u([p()],Zn.prototype,"sourceJSON",void 0),u([p({json:{write:{ignoreOrigin:!0}}})],Zn.prototype,"sublayers",void 0),u([Xe("sublayers",{layers:{type:[sB]},visibleLayers:{type:[Fr]}})],Zn.prototype,"writeSublayers",null),u([p({type:["show","hide","hide-children"]})],Zn.prototype,"listMode",void 0),u([p({json:{read:!1},readOnly:!0,value:"map-image"})],Zn.prototype,"type",void 0),u([p(OV)],Zn.prototype,"url",void 0),Zn=u([N("esri.layers.MapImageLayer")],Zn);const Q4e=Zn,jai=Object.freeze(Object.defineProperty({__proto__:null,default:Q4e},Symbol.toStringTag,{value:"Module"}));var AQ;let V1=AQ=class extends Ae{constructor(t){super(t)}clone(){return new AQ({customLayerParameters:ue(this.customLayerParameters),customParameters:ue(this.customParameters),layerIdentifier:this.layerIdentifier,tileMatrixSet:this.tileMatrixSet,url:this.url})}};u([p({json:{type:Object,write:!0}})],V1.prototype,"customLayerParameters",void 0),u([p({json:{type:Object,write:!0}})],V1.prototype,"customParameters",void 0),u([p({type:String,json:{write:!0}})],V1.prototype,"layerIdentifier",void 0),u([p({type:String,json:{write:!0}})],V1.prototype,"tileMatrixSet",void 0),u([p({type:String,json:{write:!0}})],V1.prototype,"url",void 0),V1=AQ=u([N("esri.layer.support.WMTSLayerInfo")],V1);var OQ;let Jn=OQ=class extends F3(bD(j3(_D(vD(CS(V_)))))){constructor(...t){super(...t),this.copyright="",this.fullExtent=new ti(-20037508342787e-6,-2003750834278e-5,2003750834278e-5,20037508342787e-6,Ye.WebMercator),this.legendEnabled=!1,this.isReference=null,this.popupEnabled=!1,this.spatialReference=Ye.WebMercator,this.subDomains=null,this.tileInfo=new m2({size:[256,256],dpi:96,format:"png8",compressionQuality:0,origin:new st({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ye.WebMercator}),spatialReference:Ye.WebMercator,lods:[new Or({level:0,scale:591657527591555e-6,resolution:156543.033928}),new Or({level:1,scale:295828763795777e-6,resolution:78271.5169639999}),new Or({level:2,scale:147914381897889e-6,resolution:39135.7584820001}),new Or({level:3,scale:73957190948944e-6,resolution:19567.8792409999}),new Or({level:4,scale:36978595474472e-6,resolution:9783.93962049996}),new Or({level:5,scale:18489297737236e-6,resolution:4891.96981024998}),new Or({level:6,scale:9244648868618e-6,resolution:2445.98490512499}),new Or({level:7,scale:4622324434309e-6,resolution:1222.99245256249}),new Or({level:8,scale:2311162217155e-6,resolution:611.49622628138}),new Or({level:9,scale:1155581108577e-6,resolution:305.748113140558}),new Or({level:10,scale:577790.554289,resolution:152.874056570411}),new Or({level:11,scale:288895.277144,resolution:76.4370282850732}),new Or({level:12,scale:144447.638572,resolution:38.2185141425366}),new Or({level:13,scale:72223.819286,resolution:19.1092570712683}),new Or({level:14,scale:36111.909643,resolution:9.55462853563415}),new Or({level:15,scale:18055.954822,resolution:4.77731426794937}),new Or({level:16,scale:9027.977411,resolution:2.38865713397468}),new Or({level:17,scale:4513.988705,resolution:1.19432856685505}),new Or({level:18,scale:2256.994353,resolution:.597164283559817}),new Or({level:19,scale:1128.497176,resolution:.298582141647617}),new Or({level:20,scale:564.248588,resolution:.14929107082380833}),new Or({level:21,scale:282.124294,resolution:.07464553541190416}),new Or({level:22,scale:141.062147,resolution:.03732276770595208}),new Or({level:23,scale:70.5310735,resolution:.01866138385297604})]}),this.type="web-tile",this.urlTemplate=null,this.wmtsInfo=null}normalizeCtorArgs(t,e){return typeof t=="string"?{urlTemplate:t,...e}:t}load(t){const e=this.loadFromPortal({supportedTypes:["WMTS"]},t).then(()=>{var r;let i="";if(this.urlTemplate)if(this.spatialReference.equals(this.tileInfo.spatialReference)){const s=new ly(this.urlTemplate);!(this.subDomains&&this.subDomains.length>0)&&((r=s.authority)!=null&&r.includes("{subDomain}"))&&(i="is missing 'subDomains' property")}else i="spatialReference must match tileInfo.spatialReference";else i="is missing the required 'urlTemplate' property value";if(i)throw new J("web-tile-layer:load",`WebTileLayer (title: '${this.title}', id: '${this.id}') ${i}`)});return this.addResolvingPromise(e),Promise.resolve(this)}get levelValues(){const t=[];if(!this.tileInfo)return null;for(const e of this.tileInfo.lods)t[e.level]=e.levelValue||e.level;return t}readSpatialReference(t,e){return t||e.fullExtent&&e.fullExtent.spatialReference&&Ye.fromJSON(e.fullExtent.spatialReference)}get tileServers(){if(!this.urlTemplate)return null;const t=[],{urlTemplate:e,subDomains:i}=this,r=new ly(e),s=r.scheme?r.scheme+"://":"//",n=s+r.authority+"/",o=r.authority;if(o!=null&&o.includes("{subDomain}")){if(i&&i.length>0&&o.split(".").length>1)for(const a of i)t.push(s+o.replace(/\{subDomain\}/gi,a)+"/")}else t.push(n);return t.map(a=>(a.charAt(a.length-1)!=="/"&&(a+="/"),a))}get urlPath(){if(!this.urlTemplate)return null;const t=this.urlTemplate,e=new ly(t),i=(e.scheme?e.scheme+"://":"//")+e.authority+"/";return t.substring(i.length)}readUrlTemplate(t,e){return t||e.templateUrl}writeUrlTemplate(t,e){t&&Em(t)&&(t="https:"+t),t&&(t=t.replace(/\{z\}/gi,"{level}").replace(/\{x\}/gi,"{col}").replace(/\{y\}/gi,"{row}"),t=Op(t)),e.templateUrl=t}fetchTile(t,e,i,r={}){const{signal:s}=r,n=this.getTileUrl(t,e,i),o={responseType:"image",signal:s,query:{...this.refreshParameters}};return tr(n,o).then(a=>a.data)}async fetchImageBitmapTile(t,e,i,r={}){const{signal:s}=r;if(this.fetchTile!==OQ.prototype.fetchTile){const l=await this.fetchTile(t,e,i,r);try{return createImageBitmap(l)}catch(c){throw new J("request:server",`Unable to load tile ${t}/${e}/${i}`,{error:c,level:t,row:e,col:i})}}const n=this.getTileUrl(t,e,i),o={responseType:"blob",signal:s,query:{...this.refreshParameters}},{data:a}=await tr(n,o);return toe(a,n)}getTileUrl(t,e,i){const{levelValues:r,tileServers:s,urlPath:n}=this;if(!r||!s||!n)return"";const o=r[t];return s[e%s.length]+wm(n,{level:o,z:o,col:i,x:i,row:e,y:e})}};u([p({type:String,value:"",json:{write:!0}})],Jn.prototype,"copyright",void 0),u([p({type:ti,json:{write:!0},nonNullable:!0})],Jn.prototype,"fullExtent",void 0),u([p({readOnly:!0,json:{read:!1,write:!1}})],Jn.prototype,"legendEnabled",void 0),u([p({type:["show","hide"]})],Jn.prototype,"listMode",void 0),u([p({json:{read:!0,write:!0}})],Jn.prototype,"blendMode",void 0),u([p()],Jn.prototype,"levelValues",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Jn.prototype,"isReference",void 0),u([p({type:["WebTiledLayer"],value:"WebTiledLayer"})],Jn.prototype,"operationalLayerType",void 0),u([p({readOnly:!0,json:{read:!1,write:!1}})],Jn.prototype,"popupEnabled",void 0),u([p({type:Ye})],Jn.prototype,"spatialReference",void 0),u([De("spatialReference",["spatialReference","fullExtent.spatialReference"])],Jn.prototype,"readSpatialReference",null),u([p({type:[String],json:{write:!0}})],Jn.prototype,"subDomains",void 0),u([p({type:m2,json:{write:!0}})],Jn.prototype,"tileInfo",void 0),u([p({readOnly:!0})],Jn.prototype,"tileServers",null),u([p({json:{read:!1}})],Jn.prototype,"type",void 0),u([p()],Jn.prototype,"urlPath",null),u([p({type:String,json:{origins:{"portal-item":{read:{source:"url"}}}}})],Jn.prototype,"urlTemplate",void 0),u([De("urlTemplate",["urlTemplate","templateUrl"])],Jn.prototype,"readUrlTemplate",null),u([Xe("urlTemplate",{templateUrl:{type:String}})],Jn.prototype,"writeUrlTemplate",null),u([p({type:V1,json:{write:!0}})],Jn.prototype,"wmtsInfo",void 0),Jn=OQ=u([N("esri.layers.WebTileLayer")],Jn);const e5e=Jn,Hai=Object.freeze(Object.defineProperty({__proto__:null,default:e5e},Symbol.toStringTag,{value:"Module"})),eUt=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function RQ(t){return t!=null&&eUt.some(([e,i])=>t>=e&&t<=i)}const tUt={visible:"visibleSublayers"};let K0=class extends Dm(Ee){constructor(e){super(e),this.scale=0}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.sublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("wms-sublayer-update",i=>this.notifyChange(tUt[i.propertyName]))],"layer"))}get layers(){return this.visibleSublayers.filter(({name:e})=>e).map(({name:e})=>e).join()}get version(){this.commitProperty("layers");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:i}=this,r=e==null?void 0:e.sublayers,s=[],n=o=>{const{minScale:a,maxScale:l,sublayers:c,visible:h}=o;h&&(i===0||(a===0||i<=a)&&(l===0||i>=l))&&(c?c.forEach(n):s.push(o))};return r==null||r.forEach(n),s}toJSON(){const{layer:e,layers:i}=this,{imageFormat:r,imageTransparency:s,version:n}=e;return{format:r,request:"GetMap",service:"WMS",styles:"",transparent:s?"TRUE":"FALSE",version:n,layers:i}}};u([p()],K0.prototype,"layer",null),u([p({readOnly:!0})],K0.prototype,"layers",null),u([p({type:Number})],K0.prototype,"scale",void 0),u([p({readOnly:!0})],K0.prototype,"version",null),u([p({readOnly:!0})],K0.prototype,"visibleSublayers",null),K0=u([N("esri.layers.support.ExportWMSImageParameters")],K0);var M8;let iUt=0,Rn=M8=class extends bS(jX){constructor(t){super(t),this.dimensions=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.sublayers=null,this.spatialReferences=null,this.addHandles([Gs(()=>this.sublayers,"after-add",({item:e})=>{e.parent=this,e.layer=this.layer},Mi),Gs(()=>this.sublayers,"after-remove",({item:e})=>{e.layer=e.parent=null},Mi),ae(()=>this.sublayers,(e,i)=>{if(i)for(const r of i)r.layer=r.parent=null;if(e)for(const r of e)r.parent=this,r.layer=this.layer},Mi)])}get description(){return this._get("description")}set description(t){this._set("description",t)}get fullExtent(){return this._get("fullExtent")}set fullExtent(t){this._set("fullExtent",t)}readExtent(t,e){return(t=e.extent)?ti.fromJSON(t):null}get id(){return this._get("id")??iUt++}set id(t){this._set("id",t)}readLegendUrl(t,e){return(e==null?void 0:e.legendUrl)??(e==null?void 0:e.legendURL)??null}get effectiveScaleRange(){const{minScale:t,maxScale:e}=this;return{minScale:t,maxScale:e}}get name(){return this._get("name")}set name(t){this._set("name",t)}castSublayers(t){return Vn(xt.ofType(M8),t)}get title(){return this._get("title")}set title(t){this._set("title",t)}get visible(){return this._get("visible")}set visible(t){this._setAndNotifyLayer("visible",t)}clone(){var e,i;const t=new M8;return this.hasOwnProperty("description")&&(t.description=this.description),this.hasOwnProperty("fullExtent")&&(t.fullExtent=this.fullExtent.clone()),this.hasOwnProperty("fullExtents")&&(t.fullExtents=((e=this.fullExtents)==null?void 0:e.map(r=>r.clone()))??null),this.hasOwnProperty("legendUrl")&&(t.legendUrl=this.legendUrl),this.hasOwnProperty("legendEnabled")&&(t.legendEnabled=this.legendEnabled),this.hasOwnProperty("layer")&&(t.layer=this.layer),this.hasOwnProperty("name")&&(t.name=this.name),this.hasOwnProperty("parent")&&(t.parent=this.parent),this.hasOwnProperty("queryable")&&(t.queryable=this.queryable),this.hasOwnProperty("sublayers")&&(t.sublayers=this.sublayers&&this.sublayers.map(r=>r.clone())),this.hasOwnProperty("spatialReferences")&&(t.spatialReferences=(i=this.spatialReferences)==null?void 0:i.map(r=>r)),this.hasOwnProperty("visible")&&(t.visible=this.visible),this.hasOwnProperty("title")&&(t.title=this.title),t}_setAndNotifyLayer(t,e){const i=this.layer;this._get(t)!==e&&(this._set(t,e),i&&i.emit("wms-sublayer-update",{propertyName:t,id:this.id}))}};u([p()],Rn.prototype,"description",null),u([p({readOnly:!0})],Rn.prototype,"dimensions",void 0),u([p({value:null})],Rn.prototype,"fullExtent",null),u([De("fullExtent",["extent"])],Rn.prototype,"readExtent",null),u([p()],Rn.prototype,"fullExtents",void 0),u([p({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],Rn.prototype,"id",null),u([p({type:String,json:{origins:{"web-document":{read:{source:["legendUrl","legendURL"]},write:{target:"legendUrl",ignoreOrigin:!0}}},read:{source:"legendURL"},write:{ignoreOrigin:!0}}})],Rn.prototype,"legendUrl",void 0),u([De(["web-document"],"legendUrl")],Rn.prototype,"readLegendUrl",null),u([p({value:!0,type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"},origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],Rn.prototype,"legendEnabled",void 0),u([p()],Rn.prototype,"layer",void 0),u([p()],Rn.prototype,"maxScale",void 0),u([p()],Rn.prototype,"minScale",void 0),u([p({readOnly:!0})],Rn.prototype,"effectiveScaleRange",null),u([p({type:String,value:null,json:{read:{source:"name"},write:{ignoreOrigin:!0}}})],Rn.prototype,"name",null),u([p()],Rn.prototype,"parent",void 0),u([p({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],Rn.prototype,"popupEnabled",void 0),u([p({type:Boolean,json:{write:{ignoreOrigin:!0}}})],Rn.prototype,"queryable",void 0),u([p()],Rn.prototype,"sublayers",void 0),u([pi("sublayers")],Rn.prototype,"castSublayers",null),u([p({type:[Number],json:{read:{source:"spatialReferences"}}})],Rn.prototype,"spatialReferences",void 0),u([p({type:String,value:null,json:{write:{ignoreOrigin:!0}}})],Rn.prototype,"title",null),u([p({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],Rn.prototype,"visible",null),Rn=M8=u([N("esri.layers.support.WMSSublayer")],Rn);const PQ=Rn,h5={84:4326,83:4269,27:4267};function rUt(t){if(!t)return null;const e={idCounter:-1};typeof t=="string"&&(t=new DOMParser().parseFromString(t,"text/xml"));const i=t.documentElement;if(i.nodeName==="ServiceExceptionReport"){const k=Array.prototype.slice.call(i.childNodes).map(Z=>Z.textContent).join(`\r
`);throw new J("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",k)}const r=vc("Capability",i),s=vc("Service",i),n=r&&vc("Request",r);if(!r||!s||!n)return null;const o=vc("Layer",r);if(!o)return null;const a=i.nodeName==="WMS_Capabilities"||i.nodeName==="WMT_MS_Capabilities"?i.getAttribute("version"):"1.3.0",l=Wg("Title",s,"")||Wg("Name",s,""),c=Wg("AccessConstraints",s,""),h=/^none$/i.test(c)?"":c,d=Wg("Abstract",s,""),f=parseInt(Wg("MaxWidth",s,"5000"),10),m=parseInt(Wg("MaxHeight",s,"5000"),10),g=q_e(n,"GetMap"),y=H_e(n,"GetMap"),v=dI(o,a,e);if(!v)return null;let x,S=0;const E=Array.prototype.slice.call(r.childNodes),C=v.sublayers??[],R=k=>{k!=null&&C.push(k)};E.forEach(k=>{k.nodeName==="Layer"&&(S===0?x=k:(S===1&&v.name&&(v.name="",R(dI(x,a,e))),R(dI(k,a,e))),S++)});let O=v.sublayers,U=v.extent;const L=v.fullExtents??[];if(O||(O=[]),O.length===0&&O.push(v),!U){const k=new ti(O[0].extent);v.extent=k.toJSON(),U=v.extent}const B=v.spatialReferences.length>0?v.spatialReferences:t5e(v),G=H_e(n,"GetFeatureInfo"),j=G?q_e(n,"GetFeatureInfo"):null,q=i5e(O),ie=v.minScale||0,ee=v.maxScale||0,K=v.dimensions??[],Y=q.reduce((k,Z)=>k.concat(Z.dimensions??[]),[]),D=K.concat(Y).filter(s5e);let V=null;if(D.length){const k=D.map(Z=>{const{extent:Q}=Z;return oUt(Q)?Q.map(ne=>ne.getTime()):Q==null?void 0:Q.map(ne=>[ne.min.getTime(),ne.max.getTime()])}).flat(2).filter(b);V={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[Math.min(...k),Math.max(...k)]}}return{copyright:h,description:d,dimensions:K,extent:U,fullExtents:L,featureInfoFormats:j,featureInfoUrl:G,mapUrl:y,maxWidth:f,maxHeight:m,maxScale:ee,minScale:ie,layers:q,spatialReferences:B,supportedImageFormatTypes:g,timeInfo:V,title:l,version:a}}function sUt(t){const e=t.filter(i=>i.popupEnabled&&i.name&&i.queryable);return e.length?e.map(({name:i})=>i).join():null}function t5e(t){if(t.spatialReferences.length>0)return t.spatialReferences;if(t.sublayers)for(const e of t.sublayers){const i=t5e(e);if(i.length>0)return i}return[]}function i5e(t){var i;let e=[];for(const r of t)e.push(r),(i=r.sublayers)!=null&&i.length&&(e=e.concat(i5e(r.sublayers)),delete r.sublayers);return e}function A8(t,e,i){return e.getAttribute(t)??i}function nUt(t,e,i,r){const s=vc(t,i);return s?A8(e,s,r):r}function vc(t,e){for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(r5e(r)&&r.nodeName===t)return r}return null}function O8(t,e){if(e==null)return[];const i=[];for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];r5e(s)&&s.nodeName===t&&i.push(s)}return i}function Wg(t,e,i){var r;return((r=vc(t,e))==null?void 0:r.textContent)??i}function PR(t,e,i){if(!t)return null;const r=parseFloat(t.getAttribute("minx")),s=parseFloat(t.getAttribute("miny")),n=parseFloat(t.getAttribute("maxx")),o=parseFloat(t.getAttribute("maxy"));let a,l,c,h;i?(a=isNaN(s)?-Number.MAX_VALUE:s,l=isNaN(r)?-Number.MAX_VALUE:r,c=isNaN(o)?Number.MAX_VALUE:o,h=isNaN(n)?Number.MAX_VALUE:n):(a=isNaN(r)?-Number.MAX_VALUE:r,l=isNaN(s)?-Number.MAX_VALUE:s,c=isNaN(n)?Number.MAX_VALUE:n,h=isNaN(o)?Number.MAX_VALUE:o);const d=new Ye({wkid:e});return new ti({xmin:a,ymin:l,xmax:c,ymax:h,spatialReference:d})}function H_e(t,e){const i=vc(e,t);if(i){const r=vc("DCPType",i);if(r){const s=vc("HTTP",r);if(s){const n=vc("Get",s);if(n){let o=nUt("OnlineResource","xlink:href",n,null);if(o)return o.indexOf("&")===o.length-1&&(o=o.substring(0,o.length-1)),lUt(o,["service","request"])}}}}return null}function q_e(t,e){const i=O8("Operation",t);if(!i.length)return O8("Format",vc(e,t)).map(({textContent:s})=>s).filter(b);const r=[];for(const s of i)if(s.getAttribute("name")===e){const n=O8("Format",s);for(const{textContent:o}of n)o!=null&&r.push(o)}return r}function W_e(t,e,i){const r=vc(e,t);if(!r)return i;const{textContent:s}=r;if(s==null||s==="")return i;const n=Number(s);return isNaN(n)?i:n}function dI(t,e,i){if(!t)return null;const r={id:i.idCounter++,fullExtents:[],parentLayerId:null,queryable:t.getAttribute("queryable")==="1",spatialReferences:[],sublayers:null},s=vc("LatLonBoundingBox",t),n=vc("EX_GeographicBoundingBox",t);let o=null;s&&(o=PR(s,4326)),n&&(o=new ti(0,0,0,0,new Ye({wkid:4326})),o.xmin=parseFloat(Wg("westBoundLongitude",n,"0")),o.ymin=parseFloat(Wg("southBoundLatitude",n,"0")),o.xmax=parseFloat(Wg("eastBoundLongitude",n,"0")),o.ymax=parseFloat(Wg("northBoundLatitude",n,"0"))),s||n||(o=new ti(-180,-90,180,90,new Ye({wkid:4326}))),r.minScale=W_e(t,"MaxScaleDenominator",0),r.maxScale=W_e(t,"MinScaleDenominator",0);const a=["1.0.0","1.1.0","1.1.1"].includes(e)?"SRS":"CRS";return Array.prototype.slice.call(t.childNodes).forEach(l=>{var c;if(l.nodeName==="Name")r.name=l.textContent||"";else if(l.nodeName==="Title")r.title=l.textContent||"";else if(l.nodeName==="Abstract")r.description=l.textContent||"";else if(l.nodeName==="BoundingBox"){const h=l.getAttribute(a);if(h&&h.indexOf("EPSG:")===0){const f=parseInt(h.substring(5),10);f===0||isNaN(f)||o||(o=e==="1.3.0"?PR(l,f,RQ(f)):PR(l,f))}const d=h&&h.indexOf(":");if(d&&d>-1){let f=parseInt(h.substring(d+1,h.length),10);f===0||isNaN(f)||(f=h5[f]?h5[f]:f);const m=e==="1.3.0"?PR(l,f,RQ(f)):PR(l,f);m&&r.fullExtents&&r.fullExtents.push(m)}}else if(l.nodeName===a)(((c=l.textContent)==null?void 0:c.split(" "))??[]).forEach(h=>{const d=h.includes(":")?parseInt(h.split(":")[1],10):parseInt(h,10);if(d!==0&&!isNaN(d)){const f=h5[d]?h5[d]:d;r.spatialReferences.includes(f)||r.spatialReferences.push(f)}});else if(l.nodeName!=="Style"||r.legendURL){if(l.nodeName==="Layer"){const h=dI(l,e,i);h&&(h.parentLayerId=r.id,r.sublayers||(r.sublayers=[]),r.sublayers.push(h))}}else{const h=vc("LegendURL",l);if(h){const d=vc("OnlineResource",h);d&&(r.legendURL=d.getAttribute("xlink:href"))}}}),r.extent=o==null?void 0:o.toJSON(),r.dimensions=O8("Dimension",t).filter(l=>l.getAttribute("name")&&l.getAttribute("units")&&l.textContent).map(l=>{const c=l.getAttribute("name"),h=l.getAttribute("units"),d=l.textContent,f=l.getAttribute("unitSymbol")??void 0,m=l.getAttribute("default")??void 0,g=A8("default",l,"0")!=="0",y=A8("nearestValue",l,"0")!=="0",v=A8("current",l,"0")!=="0";return s5e({name:c,units:h})?{name:"time",units:"ISO8601",extent:Z_e(d),default:Z_e(m),multipleValues:g,nearestValue:y,current:v}:aUt({name:c,units:h})?{name:"elevation",units:h,extent:Y_e(d),unitSymbol:f,default:Y_e(m),multipleValues:g,nearestValue:y}:{name:c,units:h,extent:X_e(d),unitSymbol:f,default:X_e(m),multipleValues:g,nearestValue:y}}),r}function oUt(t){return Array.isArray(t)&&t.length>0&&t[0]instanceof Date}function r5e(t){return t.nodeType===Node.ELEMENT_NODE}function aUt(t){return/^elevation$/i.test(t.name)&&/^(epsg|crs):\d+$/i.test(t.units)}function s5e(t){return/^time$/i.test(t.name)&&/^iso8601$/i.test(t.units)}function lUt(t,e){const i=[],r=jo(t);for(const s in r.query)r.query.hasOwnProperty(s)&&(e.includes(s.toLowerCase())||i.push(s+"="+r.query[s]));return r.path+(i.length?"?"+i.join("&"):"")}function Y_e(t){if(!t)return;const e=t.includes("/"),i=t.split(",");return e?i.map(r=>{const s=r.split("/");return s.length<2?null:{min:parseFloat(s[0]),max:parseFloat(s[1]),resolution:s.length>=3&&s[2]!=="0"?parseFloat(s[2]):void 0}}).filter(b):i.map(r=>parseFloat(r))}function X_e(t){if(!t)return;const e=t.includes("/"),i=t.split(",");return e?i.map(r=>{const s=r.split("/");return s.length<2?null:{min:s[0],max:s[1],resolution:s.length>=3&&s[2]!=="0"?s[2]:void 0}}).filter(b):i}function Z_e(t){if(!t)return;const e=t.includes("/"),i=t.split(",");return e?i.map(r=>{const s=r.split("/");return s.length<2?null:{min:new Date(s[0]),max:new Date(s[1]),resolution:s.length>=3&&s[2]!=="0"?cUt(s[2]):void 0}}).filter(b):i.map(r=>new Date(r))}function cUt(t){const e=/(?:p(\d+y|\d+(?:.|,)\d+y)?(\d+m|\d+(?:.|,)\d+m)?(\d+d|\d+(?:.|,)\d+d)?)?(?:t(\d+h|\d+(?:.|,)\d+h)?(\d+m|\d+(?:.|,)\d+m)?(\d+s|\d+(?:.|,)\d+s)?)?/i,i=t.match(e);return i?{years:rC(i[1]),months:rC(i[2]),days:rC(i[3]),hours:rC(i[4]),minutes:rC(i[5]),seconds:rC(i[6])}:null}function rC(t){if(!t)return 0;const e=/(?:\d+(?:.|,)\d+|\d+)/,i=t.match(e);if(!i)return 0;const r=i[0].replace(",",".");return Number(r)}function sC(t){return t.toISOString().replace(/\.[0-9]{3}/,"")}const J_e=new Set([102100,3857,102113,900913]),uUt=new Set([3395,54004]);function hUt(t,e){let i=t.wkid;return A(e)?i:(i!=null&&e.includes(i)||!t.latestWkid||(i=t.latestWkid),i!=null&&J_e.has(i)?e.find(r=>J_e.has(r))||e.find(r=>uUt.has(r))||102100:i)}const HH=new Hi({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});function K_e(t){return t==="text/html"}function Q_e(t){return t==="text/plain"}let mr=class extends F3(NV(bD(j3(_D(vD(CS(V_))))))){constructor(...e){super(...e),this.allSublayers=new Gb({getCollections:()=>[this.sublayers],getChildrenFunction:i=>i.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.url=null,this.version=null,this.addHandles([Gs(()=>this.sublayers,"after-add",({item:i})=>{i.parent=i.layer=this},Mi),Gs(()=>this.sublayers,"after-remove",({item:i})=>{i.layer=i.parent=null},Mi),ae(()=>this.sublayers,(i,r)=>{if(r)for(const s of r)s.layer=s.parent=null;if(i)for(const s of i)s.parent=s.layer=this},Mi)])}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){const i=b(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(Pl).then(()=>this._fetchService(i))),Promise.resolve(this)}readFullExtentFromItemOrMap(e,i){const r=i.extent;return r?new ti({xmin:r[0][0],ymin:r[0][1],xmax:r[1][0],ymax:r[1][1]}):null}writeFullExtent(e,i){i.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return A(this.featureInfoFormats)?null:this.featureInfoFormats.find(K_e)??this.featureInfoFormats.find(Q_e)??null}set featureInfoFormat(e){b(e)?(K_e(e)||Q_e(e))&&this._override("featureInfoFormat",e):(this.revert("featureInfoFormat","service"),this._clearOverride("featureInfoFormat"))}readImageFormat(e,i){const r=i.supportedImageFormatTypes;return r&&r.includes("image/png")?"image/png":r&&r[0]}readSpatialReferenceFromItemOrDocument(e,i){return new Ye(i.spatialReferences[0])}writeSpatialReferences(e,i){var s;const r=(s=this.spatialReference)==null?void 0:s.wkid;e&&r?(i.spatialReferences=e.filter(n=>n!==r),i.spatialReferences.unshift(r)):i.spatialReferences=e}readSublayersFromItemOrMap(e,i,r){return eve(i.layers,r,i.visibleLayers)}readSublayers(e,i,r){return eve(i.layers,r)}writeSublayers(e,i,r,s){var a,l;i.layers=[];const n=new Map,o=e.flatten(({sublayers:c})=>c??[]);for(const c of o)if(typeof((a=c.parent)==null?void 0:a.id)=="number"){const h=n.get(c.parent.id);h!=null?h.push(c.id):n.set(c.parent.id,[c.id])}for(const c of o){const h={sublayer:c,...s},d=c.write({parentLayerId:typeof((l=c.parent)==null?void 0:l.id)=="number"?c.parent.id:-1},h);if(n.has(c.id)&&(d.sublayerIds=n.get(c.id)),!c.sublayers&&c.name){const f=c.write({},h);delete f.id,i.layers.push(f)}}i.visibleLayers=o.filter(({visible:c,sublayers:h})=>c&&!h).map(({name:c})=>c).toArray()}createExportImageParameters(e,i,r,s){const n=(s==null?void 0:s.pixelRatio)??1,o=h9({extent:e,width:i})*n,a=new K0({layer:this,scale:o}),{xmin:l,ymin:c,xmax:h,ymax:d,spatialReference:f}=e,m=hUt(f,this.spatialReferences),g=this.version==="1.3.0"&&RQ(m)?`${c},${l},${d},${h}`:`${l},${c},${h},${d}`,y=a.toJSON();return{bbox:g,[this.version==="1.3.0"?"crs":"srs"]:m==null||isNaN(m)?void 0:"EPSG:"+m,...y}}async fetchImage(e,i,r,s){var d,f;const n=this.mapUrl,o=this.createExportImageParameters(e,i,r,s);if(!o.layers){const m=document.createElement("canvas");return m.width=i,m.height=r,m}const a=(d=s==null?void 0:s.timeExtent)==null?void 0:d.start,l=(f=s==null?void 0:s.timeExtent)==null?void 0:f.end,c=b(a)&&b(l)?a.getTime()===l.getTime()?sC(a):`${sC(a)}/${sC(l)}`:void 0,h={responseType:"image",query:this._mixCustomParameters({width:i,height:r,...o,time:c,...this.refreshParameters}),signal:s==null?void 0:s.signal};return tr(n??"",h).then(m=>m.data)}async fetchImageBitmap(e,i,r,s){var f,m;const n=this.mapUrl??"",o=this.createExportImageParameters(e,i,r,s);if(!o.layers){const g=document.createElement("canvas");return g.width=i,g.height=r,g}const a=(f=s==null?void 0:s.timeExtent)==null?void 0:f.start,l=(m=s==null?void 0:s.timeExtent)==null?void 0:m.end,c=b(a)&&b(l)?a.getTime()===l.getTime()?sC(a):`${sC(a)}/${sC(l)}`:void 0,h={responseType:"blob",query:this._mixCustomParameters({width:i,height:r,...o,time:c,...this.refreshParameters}),signal:s==null?void 0:s.signal},{data:d}=await tr(n,h);return toe(d,n)}fetchFeatureInfo(e,i,r,s,n){const o=h9({extent:e,width:i}),a=new K0({layer:this,scale:o}),l=sUt(a.visibleSublayers);if(A(this.featureInfoUrl)||A(l))return Promise.resolve([]);if(A(this.fetchFeatureInfoFunction)&&A(this.featureInfoFormat))return Promise.resolve([]);const c=this.version==="1.3.0"?{I:s,J:n}:{x:s,y:n},h={query_layers:l,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:i,height:r,...c},d={...this.createExportImageParameters(e,i,r),...h},f=this._mixCustomParameters(d);return b(this.fetchFeatureInfoFunction)?this.fetchFeatureInfoFunction(f):this._defaultFetchFeatureInfoFunction(P5(this.featureInfoUrl,f))}findSublayerById(e){return this.allSublayers.find(i=>i.id===e)}findSublayerByName(e){return this.allSublayers.find(i=>i.name===e)}serviceSupportsSpatialReference(e){return dat(this.url)||this.spatialReferences!=null&&this.spatialReferences.some(i=>{const r=i===900913?Ye.WebMercator:new Ye({wkid:i});return us(r,e)})}_defaultFetchFeatureInfoFunction(e){const i=document.createElement("iframe");i.src=ZHe(e),i.style.border="none",i.style.margin="0",i.style.width="100%",i.setAttribute("sandbox","");const r=new vw({title:this.title,content:i}),s=new Ho({sourceLayer:this,popupTemplate:r});return Promise.resolve([s])}async _fetchService(e){if(!this.resourceInfo){const{path:i,query:r}=this.parsedUrl??{};r!=null&&r.service&&(r.SERVICE=r.service,delete r.service),r!=null&&r.request&&(r.REQUEST=r.request,delete r.request);const{data:s}=await tr(i??"",{query:{SERVICE:"WMS",REQUEST:"GetCapabilities",...r,...this.customParameters},responseType:"xml",signal:e});this.resourceInfo=rUt(s)}if(this.parsedUrl){const i=new ly(this.parsedUrl.path),{httpsDomains:r}=Mr.request;i.scheme!=="https"||i.port&&i.port!=="443"||!i.host||r.includes(i.host)||r.push(i.host)}this.read(this.resourceInfo,{origin:"service"})}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;const i={...this.customParameters,...this.customLayerParameters};for(const r in i)e[r.toLowerCase()]=i[r];return e}};function dUt(t,e){return t.some(i=>{for(const r in i)if(Nbe(i,r,null,e))return!0;return!1})}function eve(t,e,i){t=t??[];const r=new Map;t.every(n=>n.id==null)&&(t=ue(t)).forEach((n,o)=>n.id=o);for(const n of t){const o=new PQ;o.read(n,e),i&&!i.includes(o.name)&&(o.visible=!1),r.set(o.id,o)}const s=[];for(const n of t){const o=n.id!=null?r.get(n.id):null;if(o)if(n.parentLayerId!=null&&n.parentLayerId>=0){const a=r.get(n.parentLayerId);if(!a)continue;a.sublayers||(a.sublayers=new xt),a.sublayers.push(o)}else s.push(o)}return s}u([p({readOnly:!0})],mr.prototype,"allSublayers",void 0),u([p({json:{type:Object,write:!0}})],mr.prototype,"customParameters",void 0),u([p({json:{type:Object,write:!0}})],mr.prototype,"customLayerParameters",void 0),u([p({type:String,json:{write:!0}})],mr.prototype,"copyright",void 0),u([p()],mr.prototype,"description",void 0),u([p({readOnly:!0})],mr.prototype,"dimensions",void 0),u([p({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],mr.prototype,"fullExtent",void 0),u([De(["web-document","portal-item"],"fullExtent",["extent"])],mr.prototype,"readFullExtentFromItemOrMap",null),u([Xe(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],mr.prototype,"writeFullExtent",null),u([p()],mr.prototype,"fullExtents",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0}}})],mr.prototype,"featureInfoFormat",null),u([p({type:[String],readOnly:!0})],mr.prototype,"featureInfoFormats",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0}}})],mr.prototype,"featureInfoUrl",void 0),u([p()],mr.prototype,"fetchFeatureInfoFunction",void 0),u([p({type:String,json:{origins:{"web-document":{default:"image/png",type:HH.jsonValues,read:{reader:HH.read,source:"format"},write:{writer:HH.write,target:"format"}}}}})],mr.prototype,"imageFormat",void 0),u([De("imageFormat",["supportedImageFormatTypes"])],mr.prototype,"readImageFormat",null),u([p({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],mr.prototype,"imageMaxHeight",void 0),u([p({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],mr.prototype,"imageMaxWidth",void 0),u([p()],mr.prototype,"imageTransparency",void 0),u([p(Nie)],mr.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],mr.prototype,"listMode",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0}}})],mr.prototype,"mapUrl",void 0),u([p({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],mr.prototype,"isReference",void 0),u([p({type:["WMS"]})],mr.prototype,"operationalLayerType",void 0),u([p()],mr.prototype,"resourceInfo",void 0),u([p({type:Ye,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],mr.prototype,"spatialReference",void 0),u([De(["web-document","portal-item"],"spatialReference",["spatialReferences"])],mr.prototype,"readSpatialReferenceFromItemOrDocument",null),u([p({type:[Fr],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],mr.prototype,"spatialReferences",void 0),u([Xe(["web-document","portal-item"],"spatialReferences")],mr.prototype,"writeSpatialReferences",null),u([p({type:xt.ofType(PQ),json:{write:{target:"layers",overridePolicy(t,e,i){if(dUt(this.allSublayers,i))return{ignoreOrigin:!0}}}}})],mr.prototype,"sublayers",void 0),u([De(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],mr.prototype,"readSublayersFromItemOrMap",null),u([De("service","sublayers",["layers"])],mr.prototype,"readSublayers",null),u([Xe("sublayers",{layers:{type:[PQ]},visibleLayers:{type:[String]}})],mr.prototype,"writeSublayers",null),u([p({json:{read:!1},readOnly:!0,value:"wms"})],mr.prototype,"type",void 0),u([p(OV)],mr.prototype,"url",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0}}})],mr.prototype,"version",void 0),mr=u([N("esri.layers.WMSLayer")],mr);const n5e=mr,Yai=Object.freeze(Object.defineProperty({__proto__:null,default:n5e},Symbol.toStringTag,{value:"Module"})),pUt={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function Xai(t){return{renderer:{type:"simple",symbol:t==="esriGeometryPoint"||t==="esriGeometryMultipoint"?LMe:t==="esriGeometryPolyline"?DMe:NMe}}}const fUt=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let mUt=1;function Zai(t,e){if(me("esri-csp-restrictions"))return()=>({[e]:null,...t});try{let i=`this.${e} = null;`;for(const s in t)i+=`this${fUt.test(s)?`.${s}`:`["${s}"]`} = ${JSON.stringify(t[s])};`;const r=new Function(`
      return class AttributesClass$${mUt++} {
        constructor() {
          ${i};
        }
      }
    `)();return()=>new r}catch{return()=>({[e]:null,...t})}}function Jai(t={}){return[{name:"New Feature",description:"",prototype:{attributes:ue(t)}}]}function gUt(t,e){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:t},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:e,supportsDelete:e,supportsEditing:e,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:e,supportsExceedsLimitStatistics:!0},query:pUt,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:e,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}const o5e="esri.layers.graphics.sources.GeoJSONSource",tve=le.getLogger(o5e);let xT=class extends Tm{constructor(){super(...arguments),this.type="geojson",this.refresh=dee(async e=>{await this.load();const{extent:i,timeExtent:r}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=i,r&&(this.sourceJSON.timeInfo.timeExtent=[r.start,r.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const i=b(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,i)).then(r=>lD.fromJSON(r))}queryFeaturesJSON(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,i))}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:ti.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}_applyEdits(e){if(!this._connection)throw new J("geojson-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField,r=[],s=[],n=[];if(e.addFeatures)for(const o of e.addFeatures)r.push(this._serializeFeature(o));if(e.deleteFeatures)for(const o of e.deleteFeatures)"objectId"in o&&o.objectId!=null?s.push(o.objectId):"attributes"in o&&o.attributes[i]!=null&&s.push(o.attributes[i]);if(e.updateFeatures)for(const o of e.updateFeatures)n.push(this._serializeFeature(o));return this._connection.invoke("applyEdits",{adds:r,updates:n,deletes:s}).then(({extent:o,timeExtent:a,featureEditResults:l})=>(this.sourceJSON.extent=o,a&&(this.sourceJSON.timeInfo.timeExtent=[a.start,a.end]),this._createEditsResult(l)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new J("geojson-layer-source:edit-failure",i.description,{code:i.code}):null}}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e);return r?{geometry:r.toJSON(),attributes:i}:{attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return A(i)?null:i.type==="mesh"||i.type==="extent"?kl.fromExtent(i.extent):i}async _startWorker(e){this._connection=await Dte("GeoJSONSourceWorker",{strategy:me("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:i,spatialReference:r,hasZ:s,geometryType:n,objectIdField:o,url:a,timeInfo:l,customParameters:c}=this.layer,h=this.layer.originOf("spatialReference")==="defaults",d={url:a,customParameters:c,fields:i&&i.map(m=>m.toJSON()),geometryType:k2.toJSON(n),hasZ:s,objectIdField:o,timeInfo:l?l.toJSON():null,spatialReference:h?null:r&&r.toJSON()},f=await this._connection.invoke("load",d,{signal:e});for(const m of f.warnings)tve.warn(m.message,{layer:this.layer,warning:m});f.featureErrors.length&&tve.warn(`Encountered ${f.featureErrors.length} validation errors while loading features`,f.featureErrors),this.sourceJSON=f.layerDefinition,this.capabilities=gUt(this.sourceJSON.hasZ,!0)}};u([p()],xT.prototype,"capabilities",void 0),u([p()],xT.prototype,"type",void 0),u([p({constructOnly:!0})],xT.prototype,"layer",void 0),u([p()],xT.prototype,"sourceJSON",void 0),xT=u([N(o5e)],xT);const yUt=eAe();let br=class extends WMe(Die(HMe(xCe(F3(NV(j3(bD(_D(vD(CS(V_))))))))))){constructor(e){super(e),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new xT({layer:this}),this.spatialReference=Ye.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){var e;(e=this.source)==null||e.destroy()}load(e){const i=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},e).catch(Pl).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),gU(this.renderer,this.fieldsIndex),hte(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(i),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?jo(this.url):null}set renderer(e){gU(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);const i=jo(e);this._set("url",i.path),i.query&&(this.customParameters={...this.customParameters,...i.query})}async applyEdits(e,i){const r=await se(()=>import("./editingSupport-9205c61e.js"),["assets/editingSupport-9205c61e.js","assets/assetEditingSupport-2cebf928.js"]);await this.load();const s=await r.applyEdits(this,this.source,e,i);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),s}on(e,i){return super.on(e,i)}createPopupTemplate(e){return Jie(this,e)}createQuery(){const e=new _o,i=this.get("capabilities.data");e.returnGeometry=!0,i&&i.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:s}=this;return e.timeExtent=r!=null&&s!=null?s.offset(-r.value,r.unit):s||null,e}getFieldDomain(e,i){let r,s=!1;const n=i&&i.feature,o=n&&n.attributes,a=this.typeIdField&&o&&o[this.typeIdField];return a!=null&&this.types&&(s=this.types.some(l=>l.id==a&&(r=l.domains&&l.domains[e],r&&r.type==="inherited"&&(r=this._getLayerDomain(e)),!0))),s||r||(r=this._getLayerDomain(e)),r}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,i){return this.load().then(()=>this.source.queryFeatures(_o.from(e)||this.createQuery(),i)).then(r=>{if(r!=null&&r.features)for(const s of r.features)s.layer=s.sourceLayer=this;return r})}queryObjectIds(e,i){return this.load().then(()=>this.source.queryObjectIds(_o.from(e)||this.createQuery(),i))}queryFeatureCount(e,i){return this.load().then(()=>this.source.queryFeatureCount(_o.from(e)||this.createQuery(),i))}queryExtent(e,i){return this.load().then(()=>this.source.queryExtent(_o.from(e)||this.createQuery(),i))}async hasDataChanged(){try{const{dataChanged:e,updates:i}=await this.source.refresh(this.customParameters);return b(i)&&this.read(i,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_getLayerDomain(e){if(!this.fields)return null;let i=null;return this.fields.some(r=>(r.name===e&&(i=r.domain),!!i)),i}};u([p({readOnly:!0,json:{read:!1,write:!1}})],br.prototype,"capabilities",null),u([p({type:String})],br.prototype,"copyright",void 0),u([p({readOnly:!0})],br.prototype,"createQueryVersion",null),u([p({readOnly:!0})],br.prototype,"defaultPopupTemplate",null),u([p({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],br.prototype,"definitionExpression",void 0),u([p({type:String})],br.prototype,"displayField",void 0),u([p({type:Boolean})],br.prototype,"editingEnabled",void 0),u([p(MCe)],br.prototype,"elevationInfo",void 0),u([p({type:[R3],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],br.prototype,"fields",void 0),u([p(yUt.fieldsIndex)],br.prototype,"fieldsIndex",void 0),u([p({type:ti,json:{name:"extent"}})],br.prototype,"fullExtent",void 0),u([p({type:["point","polygon","polyline","multipoint"],json:{read:{reader:k2.read}}})],br.prototype,"geometryType",void 0),u([p({type:Boolean})],br.prototype,"hasZ",void 0),u([p(Fie)],br.prototype,"id",void 0),u([p({type:Boolean,readOnly:!0})],br.prototype,"isTable",null),u([p(AV)],br.prototype,"labelsVisible",void 0),u([p({type:[G3],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:CZ},write:!0}})],br.prototype,"labelingInfo",void 0),u([p(Nie)],br.prototype,"legendEnabled",void 0),u([p({type:["show","hide"]})],br.prototype,"listMode",void 0),u([p({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],br.prototype,"objectIdField",void 0),u([p(HU)],br.prototype,"opacity",void 0),u([p({type:["GeoJSON"]})],br.prototype,"operationalLayerType",void 0),u([p({readOnly:!0})],br.prototype,"parsedUrl",null),u([p(dD)],br.prototype,"popupEnabled",void 0),u([p({type:vw,json:{name:"popupInfo",write:!0}})],br.prototype,"popupTemplate",void 0),u([p({types:L3,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:Iie}}}})],br.prototype,"renderer",null),u([p(CCe)],br.prototype,"screenSizePerspectiveEnabled",void 0),u([p({readOnly:!0})],br.prototype,"source",void 0),u([p({type:Ye})],br.prototype,"spatialReference",void 0),u([p({type:[FV]})],br.prototype,"templates",void 0),u([p()],br.prototype,"title",void 0),u([p({json:{read:!1},readOnly:!0})],br.prototype,"type",void 0),u([p({type:String,readOnly:!0})],br.prototype,"typeIdField",void 0),u([p({type:[UV]})],br.prototype,"types",void 0),u([p(OV)],br.prototype,"url",null),br=u([N("esri.layers.GeoJSONLayer")],br);const a5e=br,eli=Object.freeze(Object.defineProperty({__proto__:null,default:a5e},Symbol.toStringTag,{value:"Module"}));let q0=class extends F3(j3(V_)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new _2,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,i){return super.on(e,i)}graphicChanged(e){this.emit("graphic-update",e)}};u([p({type:ECe})],q0.prototype,"elevationInfo",void 0),u([p(e9(_2,"graphics"))],q0.prototype,"graphics",void 0),u([p({type:["show","hide"]})],q0.prototype,"listMode",void 0),u([p()],q0.prototype,"screenSizePerspectiveEnabled",void 0),u([p({readOnly:!0})],q0.prototype,"type",void 0),u([p({constructOnly:!0})],q0.prototype,"internal",void 0),q0=u([N("esri.layers.GraphicsLayer")],q0);const nB=q0;function qH(t){switch(t){case bs.SUPPORTED:break;case bs.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case bs.GEOMETRY_MISSING:return"no geometry";case bs.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case bs.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case bs.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var bs;(function(t){t[t.SUPPORTED=0]="SUPPORTED",t[t.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",t[t.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",t[t.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",t[t.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",t[t.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(bs||(bs={}));function l5e(t){return t?Go:TUt}function _Ut(t,e){return A(e)||!e.mode?l5e(t).mode:e.mode}function vUt(t,e){return b(e)?e:l5e(t)}function c5e(t,e){return _Ut(!!b(t)&&t.hasZ,e)}function ili(t,e){return vUt(!!b(t)&&!!t.hasZ,e)}function oB(t){const e=roe(t);return c5e(t.geometry,e)}function rli(t){const e=roe(t),i=c5e(t.geometry,e);return{mode:i,offset:b(e)&&i!=="on-the-ground"?vt(e.offset,0)*SCe(vt(e.unit,"meters")):0}}function ioe(t){if(oB(t)==="on-the-ground")return!1;const e=roe(t),i=b(e)&&e.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!i||i==="0")}function roe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function sli(t,e,i){if(A(i)||!i.mode)return;const r=t.hasZ?t.z:0,s=b(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-(vt(e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground"),0)+s);case"relative-to-scene":return r-(vt(e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene"),0)+s)}}function bUt(t,e,i,r=null){return h5e(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function u5e(t,e,i,r,s=null){return h5e(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function h5e(t,e,i,r,s,n,o=null){if(A(n))return;const a=b(o)?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=wUt(e,i,r,s,t,n);return xUt(l,e,i,r,s,t,o,a)}function wUt(t,e,i,r,s,n){const o=b(n.offset)?n.offset:0;switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=vt(s.elevationProvider.getElevation(t,e,0,r,"ground"),0);return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=vt(s.elevationProvider.getElevation(t,e,i,r,"ground"),0);return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=vt(s.elevationProvider.getElevation(t,e,i,r,"scene"),0);return{absoluteZ:i+a+o,elevation:a}}}}function xUt(t,e,i,r,s,n,o,a){const l=b(o)&&b(o.offset)?o.offset:0;switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-(vt(n.elevationProvider.getElevation(e,i,r,s,"ground"),0)+l);case"relative-to-scene":return t-(vt(n.elevationProvider.getElevation(e,i,r,s,"scene"),0)+l)}}function nli(t,e){if(A(e))return!1;const{mode:i}=e;return b(i)&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}const Go={mode:"absolute-height",offset:0},TUt={mode:"on-the-ground",offset:null};function SUt(t){var e;if(((e=t.layer)==null?void 0:e.type)!=="graphics")return bs.GRAPHICS_LAYER_MISSING;if(A(t.geometry))return bs.GEOMETRY_MISSING;switch(t.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return bs.GEOMETRY_TYPE_UNSUPPORTED}return oB(t)!=="on-the-ground"&&ioe(t)?bs.ELEVATION_MODE_UNSUPPORTED:bs.SUPPORTED}var IQ;let z1=IQ=class extends kl{constructor(...t){super(...t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(t,e){let i;if(t&&t.center)i=t;else{if(t&&t.rings)return super.normalizeCtorArgs(t,e);i={center:t}}return{...super.normalizeCtorArgs(),...i,...e}}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=(t==null?void 0:t.hasZ)??!1,this.rings.length!==0||!t)return;const i=Zr(this.radius,this.radiusUnit,"meters"),r=t.spatialReference;let s,n="geographic";if(r.isWebMercator?n="webMercator":((r.wkid&&z[r.wkid])!=null||r.wkt&&r.wkt.indexOf("PROJCS")===0)&&(n="projected"),this.geodesic){let o;switch(n){case"webMercator":o=ub(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=t}s=this._createGeodesicCircle(o,i,e),n==="webMercator"&&(s=hy(s))}else{let o;n==="webMercator"||n==="projected"?o=i/this._convert2Meters(1,t.spatialReference):n==="geographic"&&(o=swe(i,"meters",ur(t.spatialReference).radius)),s=this._createPlanarCircle(t,o,e)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:r,geodesic:s}=this;return new IQ({center:t==null?void 0:t.clone(),numberOfPoints:e,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(t,e,i){let r=0;const s=[];for(;r<360;){const n=[0,0],o=[t.x,t.y];E8(n,o,r,e),this.hasZ&&n.push(t.z),s.push(n),r+=360/i}return s.push(s[0]),new kl(s)}_createPlanarCircle(t,e,i){const r=[],s=2*Math.PI/i;for(let n=0;n<i;++n){const o=s*n,a=[t.x+Math.cos(-o)*e,t.y+Math.sin(-o)*e];this.hasZ&&a.push(t.z),r.push(a)}return r.push(r[0]),new kl({spatialReference:t.spatialReference,rings:[r]})}_convert2Meters(t,e){let i;if(e.wkid&&z[e.wkid]!=null)i=z.values[z[e.wkid]];else{const r=e.wkt,s=r.lastIndexOf(",")+1,n=r.lastIndexOf("]]");i=parseFloat(r.substring(s,n))}return t*i}};u([p({type:st})],z1.prototype,"center",void 0),u([p()],z1.prototype,"geodesic",void 0),u([p()],z1.prototype,"numberOfPoints",void 0),u([p()],z1.prototype,"radius",void 0),u([p()],z1.prototype,"radiusUnit",void 0),z1=IQ=u([N("esri.geometry.Circle")],z1);const EUt=z1;function d5(t){return d5e(t).result}function oli(t){return d5e(t).geometry}function d5e(t){var e;return((e=t.layer)==null?void 0:e.type)!=="graphics"?{result:bs.GRAPHICS_LAYER_MISSING,geometry:null}:A(t.geometry)?{result:bs.GEOMETRY_MISSING,geometry:null}:oB(t)!=="on-the-ground"&&ioe(t)?{result:bs.ELEVATION_MODE_UNSUPPORTED,geometry:null}:t.geometry.type!=="point"&&t.geometry.type!=="polyline"&&(t.geometry.type!=="polygon"||t.geometry instanceof EUt)?{result:bs.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:bs.SUPPORTED,geometry:t.geometry}}function CUt(t){var i;if(((i=t.layer)==null?void 0:i.type)!=="graphics")return bs.GRAPHICS_LAYER_MISSING;if(A(t.geometry))return bs.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return bs.SUPPORTED;default:return bs.GEOMETRY_TYPE_UNSUPPORTED}const e=b(t.symbol)&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.length>0&&e.some(r=>r.type==="object")?oB(t)!=="on-the-ground"&&ioe(t)?bs.ELEVATION_MODE_UNSUPPORTED:bs.SUPPORTED:bs.SYMBOL_TYPE_UNSUPPORTED}function ive(t,e,i){if(!e||!t||!t.map)return;const{map:r}=t,s=r.layers.find(n=>n===e);s||r.add(e,i),s&&i!=null&&r.layers.reorder(s,i)}function ali(t,e){return t.allLayerViews.find(i=>{const r=i.layer;return r===e||"sublayers"in r&&b(r.sublayers)&&r.sublayers.includes(e)})}const Xo={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},rve={toggle:"Control"};let R8=class extends Ee{constructor(e){super(e),this.enabled=!1}};u([p({type:Boolean,nonNullable:!0})],R8.prototype,"enabled",void 0),R8=u([N("esri.views.interactive.sketch.SketchLabelOptions")],R8);const p5e=R8;let u$=class extends Ee{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};u([p({type:String,nonNullable:!0})],u$.prototype,"mode",void 0),u$=u([N("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],u$);let Vu=class extends Ee{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0,this.helpMessage=!1}toJSON(){return{distance:this.distance,size:this.size,scale:this.scale,rotation:this.rotation,orientation:this.orientation,totalLength:this.totalLength,area:this.area,radius:this.radius}}};u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"distance",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"elevation",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"size",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"scale",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"rotation",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"orientation",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"totalLength",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"area",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"radius",void 0),u([p({type:Boolean,nonNullable:!0})],Vu.prototype,"helpMessage",void 0),Vu=u([N("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],Vu);let TT=class extends Ee{constructor(e){super(e),this.enabled=!1,this.elevation=new u$,this.visibleElements=new Vu,this.visualVariables=null}toJSON(){return{enabled:this.enabled,elevation:this.elevation,visibleElements:this.visibleElements}}};u([p({type:Boolean,nonNullable:!0})],TT.prototype,"enabled",void 0),u([p({type:u$,nonNullable:!0})],TT.prototype,"elevation",void 0),u([p({type:Vu,nonNullable:!0})],TT.prototype,"visibleElements",void 0),u([p()],TT.prototype,"visualVariables",void 0),TT=u([N("esri.widgets.Sketch.SketchTooltipOptions")],TT);const f5e=TT;let hm=class extends Ae{constructor(){super(...arguments),this.enabled=!0}};u([p({type:Boolean})],hm.prototype,"enabled",void 0),hm=u([N("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],hm);let yn=class extends Ae{constructor(e){super(e),this.lineSnapper=new hm,this.parallelLineSnapper=new hm,this.rightAngleSnapper=new hm,this.rightAngleTriangleSnapper=new hm,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new et([255,127,0]),this.orangeTransparent=new et([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};u([p({type:hm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],yn.prototype,"lineSnapper",void 0),u([p({type:hm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],yn.prototype,"parallelLineSnapper",void 0),u([p({type:hm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],yn.prototype,"rightAngleSnapper",void 0),u([p({type:hm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],yn.prototype,"rightAngleTriangleSnapper",void 0),u([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],yn.prototype,"shortLineThreshold",void 0),u([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],yn.prototype,"distance",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],yn.prototype,"pointThreshold",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],yn.prototype,"intersectionParallelLineThreshold",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],yn.prototype,"parallelLineThreshold",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yn.prototype,"verticalLineThreshold",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],yn.prototype,"touchSensitivityMultiplier",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],yn.prototype,"pointOnLineThreshold",void 0),u([p({type:et,nonNullable:!0})],yn.prototype,"orange",void 0),u([p({type:et,nonNullable:!0})],yn.prototype,"orangeTransparent",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],yn.prototype,"lineHintWidthReference",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],yn.prototype,"lineHintWidthTarget",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yn.prototype,"lineHintFadedExtensions",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],yn.prototype,"parallelLineHintWidth",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],yn.prototype,"parallelLineHintLength",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],yn.prototype,"parallelLineHintOffset",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],yn.prototype,"rightAngleHintSize",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],yn.prototype,"rightAngleHintOutlineSize",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],yn.prototype,"satisfiesConstraintScreenThreshold",void 0),yn=u([N("esri.views.interactive.snapping.Settings.Defaults")],yn);const I_=new yn;var nl;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(nl||(nl={}));function MUt(t,e){const i=m5e[t.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(e.length<i.minParams||e.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${t.toUpperCase()}`);return i.evaluate(e)}function AUt(t,e){const i=m5e[t.toLowerCase()];return i!=null&&e>=i.minParams&&e<=i.maxParams}const m5e={min:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.min.apply(Math,t[0])},max:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.max.apply(Math,t[0])},avg:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:g5e(t[0])},sum:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:OUt(t[0])},stddev:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.sqrt(sve(t[0]))},count:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:t[0].length},var:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:sve(t[0])}};function g5e(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}function OUt(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];return e}function sve(t){const e=g5e(t),i=t.length;let r=0;for(const s of t)r+=(s-e)**2;return i>1?r/(i-1):0}var Zi;(function(t){t.AsyncNotEnabled="AsyncNotEnabled",t.ModulesNotSupported="ModulesNotSupported",t.CircularModules="CircularModules",t.NeverReach="NeverReach",t.UnsupportedHashType="UnsupportedHashType",t.InvalidParameter="InvalidParameter",t.UnexpectedToken="UnexpectedToken",t.Unrecognised="Unrecognised",t.UnrecognisedType="UnrecognisedType",t.MaximumCallDepth="MaximumCallDepth",t.BooleanConditionRequired="BooleanConditionRequired",t.TypeNotAllowedInFeature="TypeNotAllowedInFeature",t.KeyMustBeString="KeyMustBeString",t.WrongNumberOfParameters="WrongNumberOfParameters",t.CallNonFunction="CallNonFunction",t.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",t.NoFunctionInDictionary="NoFunctionInDictionary",t.NoFunctionInArray="NoFunctionInArray",t.AssignModuleFunction="AssignModuleFunction",t.LogicExpressionOrAnd="LogicExpressionOrAnd",t.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",t.FuncionNotFound="FunctionNotFound",t.InvalidMemberAccessKey="InvalidMemberAccessKey",t.UnsupportedUnaryOperator="UnsupportUnaryOperator",t.InvalidIdentifier="InvalidIdentifier",t.MemberOfNull="MemberOfNull",t.UnsupportedOperator="UnsupportedOperator",t.Cancelled="Cancelled",t.ModuleAccessorMustBeString="ModuleAccessorMustBeString",t.ModuleExportNotFound="ModuleExportNotFound",t.Immutable="Immutable",t.OutOfBounds="OutOfBounds",t.IllegalResult="IllegalResult",t.FieldNotFound="FieldNotFound",t.PortalRequired="PortalRequired",t.LogicError="LogicError",t.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",t.KeyAccessorMustBeString="KeyAccessorMustBeString",t.WrongSpatialReference="WrongSpatialReference"})(Zi||(Zi={}));const y5e={[Zi.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[Zi.LogicError]:"Logic error - {reason}",[Zi.NeverReach]:"Encountered unreachable logic",[Zi.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[Zi.ModuleAccessorMustBeString]:"Module accessor must be a string",[Zi.ModuleExportNotFound]:"Module has no export with provided identifier",[Zi.ModulesNotSupported]:"Current profile does not support modules",[Zi.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[Zi.FuncionNotFound]:"Function not found",[Zi.FieldNotFound]:"Key not found - {key}",[Zi.CircularModules]:"Circular module dependencies are not allowed",[Zi.Cancelled]:"Execution cancelled",[Zi.UnsupportedHashType]:"Type not supported in hash function",[Zi.IllegalResult]:"Value is not a supported return type",[Zi.PortalRequired]:"Portal is required",[Zi.InvalidParameter]:"Invalid parameter",[Zi.WrongNumberOfParameters]:"Call with wrong number of parameters",[Zi.Unrecognised]:"Unrecognised code structure",[Zi.UnrecognisedType]:"Unrecognised type",[Zi.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[Zi.BooleanConditionRequired]:"Conditions must use booleans",[Zi.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[Zi.NoFunctionInArray]:"Arrays cannot contain functions.",[Zi.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[Zi.KeyAccessorMustBeString]:"Accessor must be a string",[Zi.KeyMustBeString]:"Object keys must be a string",[Zi.Immutable]:"Object is immutable",[Zi.InvalidParameter]:"Invalid parameter",[Zi.UnexpectedToken]:"Unexpected token",[Zi.MemberOfNull]:"Cannot access property of null object",[Zi.MaximumCallDepth]:"Exceeded maximum function depth",[Zi.OutOfBounds]:"Out of bounds",[Zi.InvalidIdentifier]:"Identifier not recognised",[Zi.FuncionNotFound]:"Function not found",[Zi.CallNonFunction]:"Expression is not a function",[Zi.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[Zi.AssignModuleFunction]:"Cannot assign function to module variable",[Zi.UnsupportedUnaryOperator]:"Unsupported unary operator",[Zi.UnsupportedOperator]:"Unsupported operator",[Zi.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[Zi.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&"};let RUt=class extends Error{constructor(...e){super(...e)}},nve=class _5e extends RUt{constructor(e,i){super(soe(i)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,_5e),i&&i.loc&&(this.loc=i.loc)}},mli=class v5e extends Error{constructor(e,i,r,s){super("Execution error - "+soe(r)+GD(y5e[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,v5e),r&&r.loc&&(this.loc=r.loc)}};function soe(t){var e,i;return t&&t.loc?`Line : ${(e=t.loc.start)==null?void 0:e.line}, ${(i=t.loc.start)==null?void 0:i.column}: `:""}let gli=class b5e extends Error{constructor(e,i,r,s){super("Compilation error - "+soe(r)+GD(y5e[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,b5e),r&&r.loc&&(this.loc=r.loc)}},yli=class w5e extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,w5e)}};function GD(t,e){try{if(!e)return t;for(const i in e){let r=e[i];r||(r=""),t=t.replace("{"+i+"}",e[i])}}catch{}return t}function _li(t,e,i){return i.declaredRootClass==="esri.arcade.arcadeexecutionerror"||i.declaredRootClass==="esri.arcade.arcadecompilationerror"?i.loc===null&&e&&e.loc?new nve(i,{cause:i}):i:(i.declaredRootClass==="esri.arcade.featureset.support.featureseterror"||i.declaredRootClass==="esri.arcade.featureset.support.sqlerror"||i.declaredRootClass,e&&e.loc?new nve(i,{cause:i}):i)}var fk;(function(t){t.UnrecognisedUri="UnrecognisedUri",t.UnsupportedUriProtocol="UnsupportedUriProtocol"})(fk||(fk={}));const PUt={[fk.UnrecognisedUri]:"Unrecognised uri - {uri}",[fk.UnsupportedUriProtocol]:"Unrecognised uri protocol"};let vli=class x5e extends Error{constructor(e,i){super(GD(PUt[e],i)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,x5e)}};var Qa;(function(t){t.InvalidFunctionParameters="InvalidFunctionParameters",t.UnsupportedSqlFunction="UnsupportedSqlFunction",t.UnsupportedOperator="UnsupportedOperator",t.UnsupportedSyntax="UnsupportedSyntax",t.UnsupportedIsRhs="UnsupportedIsRhs",t.UnsupportedIsLhs="UnsupportedIsLhs",t.InvalidDataType="InvalidDataType",t.CannotCastValue="CannotCastValue",t.MissingStatisticParameters="MissingStatisticParameters"})(Qa||(Qa={}));const IUt={[Qa.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[Qa.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[Qa.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[Qa.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[Qa.UnsupportedOperator]:"Unsupported operator - {operator}",[Qa.UnsupportedSyntax]:"Unsupported syntax - {node}",[Qa.UnsupportedSqlFunction]:"Sql function not found = {function}",[Qa.InvalidDataType]:"Invalid sql data type",[Qa.CannotCastValue]:"Cannot cast value to the required data type"};let ST=class T5e extends Error{constructor(e,i){super(GD(IUt[e],i)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,T5e)}};var jf;(function(t){t.NeverReach="NeverReach",t.NotImplemented="NotImplemented",t.Cancelled="Cancelled",t.InvalidStatResponse="InvalidStatResponse",t.InvalidRequest="InvalidRequest",t.RequestFailed="RequestFailed",t.MissingFeatures="MissingFeatures",t.AggregationFieldNotFound="AggregationFieldNotFound",t.DataElementsNotFound="DataElementsNotFound"})(jf||(jf={}));const $Ut={[jf.Cancelled]:"Cancelled",[jf.InvalidStatResponse]:"Invalid statistics response from service",[jf.InvalidRequest]:"Invalid request",[jf.RequestFailed]:"Request failed - {reason}",[jf.MissingFeatures]:"Missing features",[jf.AggregationFieldNotFound]:"Aggregation field not found",[jf.DataElementsNotFound]:"Data elements not found on service",[jf.NeverReach]:"Encountered unreachable logic",[jf.NotImplemented]:"Not implemented"};let bli=class S5e extends Error{constructor(e,i){super(GD($Ut[e],i)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,S5e)}},d_=class Fg{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(e){if(e.precision!==null||e.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(e,i){if(i.includes(".")){const r=i.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(i)}static createFromMilliseconds(e){const i=new Fg;return i.second=e/1e3,i}static createFromValueAndQualifer(e,i,r){let s=null;const n=new Fg;if(n.op=r==="-"?"-":"+",i.type==="interval-period"){Fg._fixDefaults(i);const o=new RegExp("^[0-9]{1,}$");if(i.period==="year"||i.period==="month")throw new Error("Year-Month Intervals not supported");if(i.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new Error("Illegal Interval");Fg._parseSecondsComponent(n,e)}else{if(!o.test(e))throw new Error("Illegal Interval");n[i.period]=parseFloat(e)}}else{if(Fg._fixDefaults(i.start),Fg._fixDefaults(i.end),i.start.period==="year"||i.start.period==="month")throw new Error("Year-Month Intervals not supported");if(i.end.period==="year"||i.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(i.start.period){case"day":switch(i.end.period){case"hour":if(s=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!s.test(e))throw new Error("Illegal Interval");n[i.start.period]=parseFloat(e.split(" ")[0]),n[i.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!s.test(e))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(e.split(" ")[0]);const o=e.split(" ")[1].split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1])}break;case"second":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(e))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(e.split(" ")[0]);const o=e.split(" ")[1].split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1]),Fg._parseSecondsComponent(n,o[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(i.end.period){case"minute":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!s.test(e))throw new Error("Illegal Interval");n.hour=parseFloat(e.split(":")[0]),n.minute=parseFloat(e.split(":")[1]);break;case"second":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(e))throw new Error("Illegal Interval");{const o=e.split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1]),Fg._parseSecondsComponent(n,o[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(i.end.period!=="second")throw new Error("Invalid Interval.");if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(e))throw new Error("Illegal Interval");{const o=e.split(":");n.minute=parseFloat(o[0]),Fg._parseSecondsComponent(n,o[1])}break;default:throw new Error("Invalid Interval.")}}return n}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}};function noe(t,e){const i=E5e[t.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(e.length<i.minParams||e.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${t.toUpperCase()}`);return i.evaluate(e)}function LUt(t,e){const i=E5e[t.toLowerCase()];return i!=null&&e>=i.minParams&&e<=i.maxParams}function DUt(t){return typeof t=="string"||t instanceof String}function NUt(t){return t instanceof Date}function ove(t){const e=new Date(t.getTime());return e.setHours(0,0,0,0),e}function ave(t,e){if(NUt(t))return e?ove(t):t;if(DUt(t)){const i=Ji.fromSQL(t);if(i.isValid)return e?ove(i.toJSDate()):i.toJSDate()}throw new ST(Qa.CannotCastValue)}const E5e={extract:{minParams:2,maxParams:2,evaluate:([t,e])=>{if(e==null)return null;if(e instanceof Date)switch(t.toUpperCase()){case"SECOND":return e.getSeconds();case"MINUTE":return e.getMinutes();case"HOUR":return e.getHours();case"DAY":return e.getDate();case"MONTH":return e.getMonth()+1;case"YEAR":return e.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:t=>{if(t.length===2){const[e,i]=t;return e==null||i==null?null:e.toString().substring(i-1)}if(t.length===3){const[e,i,r]=t;return e==null||i==null||r==null?null:r<=0?"":e.toString().substring(i-1,i+r-1)}}},position:{minParams:2,maxParams:2,evaluate:([t,e])=>t==null||e==null?null:e.indexOf(t)+1},trim:{minParams:2,maxParams:3,evaluate:t=>{const e=t.length===3,i=e?t[1]:" ",r=e?t[2]:t[1];if(i==null||r==null)return null;const s=`(${XGe(i)})`;switch(t[0]){case"BOTH":return r.replace(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return r.replace(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return r.replace(new RegExp(`${s}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.abs(t[0])},ceiling:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.ceil(t[0])},floor:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.floor(t[0])},log:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.log(t[0])},log10:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.log(t[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.sin(t[0])},cos:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.cos(t[0])},tan:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.tan(t[0])},asin:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.asin(t[0])},acos:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.acos(t[0])},atan:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.atan(t[0])},sign:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:t[0]>0?1:t[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:t=>t[0]==null||t[1]==null?null:t[0]**t[1]},mod:{minParams:2,maxParams:2,evaluate:t=>t[0]==null||t[1]==null?null:t[0]%t[1]},round:{minParams:1,maxParams:2,evaluate:t=>{const e=t[0],i=t.length===2?10**t[1]:1;return e==null?null:Math.round(e*i)/i}},truncate:{minParams:1,maxParams:2,evaluate:t=>t[0]==null?null:t.length===1?parseInt(t[0].toFixed(0),10):parseFloat(t[0].toFixed(t[1]))},char_length:{minParams:1,maxParams:1,evaluate:t=>typeof t[0]=="string"||t[0]instanceof String?t[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:t=>{let e="";for(let i=0;i<t.length;i++){if(t[i]==null)return null;e+=t[i].toString()}return e}},lower:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:t[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:t[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:t=>{for(const e of t)if(e!==null)return e;return null}},cosh:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.cosh(t[0])},sinh:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.sinh(t[0])},tanh:{minParams:1,maxParams:1,evaluate:t=>t[0]==null?null:Math.tanh(t[0])},nullif:{minParams:2,maxParams:2,evaluate:t=>{const e=t[0],i=t[1];return(e instanceof Date?e.valueOf():e)===(i instanceof Date?i.valueOf():i)?null:e}},cast:{minParams:2,maxParams:2,evaluate:t=>{const e=t[0],i=t[1];if(e===null)return null;switch(i.type){case"integer":{const r=parseInt(e,10);if(isNaN(r))throw new ST(Qa.CannotCastValue);return r}case"smallint":{const r=parseInt(e,10);if(isNaN(r))throw new ST(Qa.CannotCastValue);if(r>32767||r<-32767)throw new ST(Qa.CannotCastValue);return r}case"float":case"real":{const r=parseFloat(e);if(isNaN(r))throw new ST(Qa.CannotCastValue);return r}case"date":return ave(e,!0);case"timestamp":return ave(e,!1);case"varchar":{const r=e.toString();if(r.length>i.size)throw new ST(Qa.CannotCastValue);return r}default:throw new ST(Qa.InvalidDataType)}}}};var lve,cve,$Q={};cve=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:$oe},h=$oe,d="!",f="=",m=">=",g=">",y="<=",v="<>",x="<",S="!=",E="+",C="-",R="||",O="*",U="/",L="@",B="'",G="N'",j="''",q=".",ie="null",ee="true",K="false",Y="in",D="is",V="like",k="escape",Z="not",Q="and",ne="or",te="between",de="from",_e="for",Ce="substring",Pe="extract",Ze="trim",Le="position",Me="timestamp",qe="date",We="leading",$t="trailing",ut="both",Qt="cast",ai="as",ui="integer",li="smallint",Ri="float",pr="real",Gi="varchar",Fi="to",pt="interval",lt="year",wt="month",Tt="day",Lt="hour",oi="minute",qi="second",Wi="case",Yi="end",Xi="when",Gr="then",mi="else",Li=",",Pi="(",Ws=")",vr="`",ds=/^[A-Za-z_\x80-\uFFFF]/,jr=/^[A-Za-z0-9_]/,rs=/^[A-Za-z0-9_.\x80-\uFFFF]/,xs=/^[^']/,rn=/^[0-9]/,Oo=/^[eE]/,ro=/^[+\-]/,Ys=/^[ \t\n\r]/,ss=/^[^`]/,ps=kt("!",!1),$s=kt("=",!1),Sr=kt(">=",!1),Wo=kt(">",!1),dl=kt("<=",!1),ve=kt("<>",!1),Ir=kt("<",!1),bh=kt("!=",!1),Ro=kt("+",!1),pl=kt("-",!1),St=kt("||",!1),Wl=kt("*",!1),Ts=kt("/",!1),jy=Wy([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),dO=Wy([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),fl=Wy([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),Bm=kt("@",!1),Cd=kt("'",!1),hi=kt("N'",!1),Mw=kt("''",!1),Md=Wy(["'"],!0,!1),Gm=kt(".",!1),jm=Wy([["0","9"]],!1,!1),Yo=Wy(["e","E"],!1,!1),yu=Wy(["+","-"],!1,!1),_u=kt("NULL",!0),Er=kt("TRUE",!0),Ad=kt("FALSE",!0),rf=kt("IN",!0),yv=kt("IS",!0),Hy=kt("LIKE",!0),_v=kt("ESCAPE",!0),qy=kt("NOT",!0),Hm=kt("AND",!0),ml=kt("OR",!0),US=kt("BETWEEN",!0),Aw=kt("FROM",!0),re=kt("FOR",!0),Oe=kt("SUBSTRING",!0),Fe=kt("EXTRACT",!0),Ei=kt("TRIM",!0),so=kt("POSITION",!0),Xs=kt("TIMESTAMP",!0),gl=kt("DATE",!0),qm=kt("LEADING",!0),WD=kt("TRAILING",!0),YD=kt("BOTH",!0),XD=kt("CAST",!0),pO=kt("AS",!0),K6e=kt("INTEGER",!0),Q6e=kt("SMALLINT",!0),e8e=kt("FLOAT",!0),t8e=kt("REAL",!0),i8e=kt("VARCHAR",!0),r8e=kt("TO",!0),s8e=kt("INTERVAL",!0),n8e=kt("YEAR",!0),o8e=kt("MONTH",!0),a8e=kt("DAY",!0),l8e=kt("HOUR",!0),c8e=kt("MINUTE",!0),u8e=kt("SECOND",!0),h8e=kt("CASE",!0),d8e=kt("END",!0),p8e=kt("WHEN",!0),f8e=kt("THEN",!0),m8e=kt("ELSE",!0),g8e=kt(",",!1),y8e=kt("(",!1),_8e=kt(")",!1),v8e=Wy([" ","	",`
`,"\r"],!1,!1),Aoe=kt("`",!1),Ooe=Wy(["`"],!0,!1),b8e=function(w){return w},w8e=function(w,I){var F={type:"expression-list"},W=zke(w,I);return F.value=W,F},x8e=function(w,I){return gO(w,I)},T8e=function(w,I){return gO(w,I)},S8e=function(w){return kke("NOT",w)},E8e=function(w,I){return I==""||I==null||I==null?w:I.type=="arithmetic"?gO(w,I.tail):cae(I.op,w,I.right,I.escape)},C8e=function(w){return{type:"arithmetic",tail:w}},M8e=function(w,I){return{op:w+"NOT",right:I}},A8e=function(w,I){return{op:w,right:I}},O8e=function(w,I,F){return{op:"NOT"+w,right:{type:"expression-list",value:[I,F]}}},R8e=function(w,I,F){return{op:w,right:{type:"expression-list",value:[I,F]}}},P8e=function(w){return w[0]+" "+w[2]},I8e=function(w){return w[0]+" "+w[2]},$8e=function(w,I,F){return{op:w,right:I,escape:F.value}},L8e=function(w,I){return{op:w,right:I,escape:""}},D8e=function(w,I){return{op:w,right:I}},N8e=function(w){return{op:w,right:{type:"expression-list",value:[]}}},F8e=function(w,I){return{op:w,right:I}},U8e=function(w,I){return gO(w,I)},k8e=function(w,I){return gO(w,I)},V8e=function(w){return w.paren=!0,w},z8e=function(w){return/^CURRENT_DATE$/i.test(w)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(w)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:w}},B8e=function(w){return w},G8e=function(w,I){return w+I.join("")},j8e=function(w,I){return w+I.join("")},H8e=function(w){return{type:"parameter",value:w[1]}},q8e=function(w,I){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:w},I]}}},W8e=function(w,I,F){return{type:"function",name:"substring",args:{type:"expression-list",value:F?[w,I,F[2]]:[w,I]}}},Y8e=function(w,I){return{type:"function",name:"cast",args:{type:"expression-list",value:[w,I]}}},X8e=function(){return{type:"data-type",value:{type:"integer"}}},Z8e=function(){return{type:"data-type",value:{type:"smallint"}}},J8e=function(){return{type:"data-type",value:{type:"float"}}},K8e=function(){return{type:"data-type",value:{type:"real"}}},Q8e=function(){return{type:"data-type",value:{type:"date"}}},eUe=function(){return{type:"data-type",value:{type:"timestamp"}}},tUe=function(w){return{type:"data-type",value:{type:"varchar",size:parseInt(w)}}},iUe=function(w,I,F){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:w??"BOTH"},I,F]}}},rUe=function(w,I){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:w??"BOTH"},I]}}},sUe=function(w,I){return{type:"function",name:"position",args:{type:"expression-list",value:[w,I]}}},nUe=function(w,I){return{type:"function",name:w,args:I||{type:"expression-list",value:[]}}},oUe=function(w){return{type:"timestamp",value:w.value}},aUe=function(w,I,F){return{type:"interval",value:I,qualifier:F,op:w}},lUe=function(w,I){return{type:"interval",value:w,qualifier:I,op:""}},cUe=function(w,I){return{type:"interval-qualifier",start:w,end:I}},uUe=function(w,I){return{type:"interval-period",period:w.value,precision:I,secondary:null}},hUe=function(w){return{type:"interval-period",period:w.value,precision:null,secondary:null}},dUe=function(w){return{type:"interval-period",period:w.value,precision:null,secondary:null}},pUe=function(w,I){return{type:"interval-period",period:"second",precision:w,secondary:I}},fUe=function(w){return{type:"interval-period",period:"second",precision:w,secondary:null}},mUe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},gUe=function(w,I){return{type:"interval-period",period:w.value,precision:I,secondary:null}},yUe=function(w){return{type:"interval-period",period:w.value,precision:null,secondary:null}},_Ue=function(w,I){return{type:"interval-period",period:"second",precision:w,secondary:I}},vUe=function(w){return{type:"interval-period",period:"second",precision:w,secondary:null}},bUe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},wUe=function(){return{type:"string",value:"day"}},xUe=function(){return{type:"string",value:"hour"}},TUe=function(){return{type:"string",value:"minute"}},SUe=function(){return{type:"string",value:"month"}},EUe=function(){return{type:"string",value:"year"}},CUe=function(w){return parseFloat(w)},MUe=function(w){return parseFloat(w)},AUe=function(w){return{type:"date",value:w.value}},OUe=function(){return{type:"null",value:null}},RUe=function(){return{type:"boolean",value:!0}},PUe=function(){return{type:"boolean",value:!1}},Roe=function(){return"'"},IUe=function(w){return{type:"string",value:w.join("")}},$Ue=function(w,I){return{type:"case-expression",format:"simple",operand:w,clauses:I,else:null}},LUe=function(w,I,F){return{type:"case-expression",format:"simple",operand:w,clauses:I,else:F.value}},DUe=function(w){return{type:"case-expression",format:"searched",clauses:w,else:null}},NUe=function(w,I){return{type:"case-expression",format:"searched",clauses:w,else:I.value}},FUe=function(w,I){return{type:"when-clause",operand:w,value:I}},UUe=function(w,I){return{type:"when-clause",operand:w,value:I}},kUe=function(w){return{type:"else-clause",value:w}},VUe=function(w){return{type:"number",value:w}},zUe=function(w,I,F){return parseFloat(w+I+F)},BUe=function(w,I){return parseFloat(w+I)},GUe=function(w,I){return parseFloat(w+I)},jUe=function(w){return parseFloat(w)},HUe=function(w,I){return w[0]+I},qUe=function(w){return"."+(w??"")},WUe=function(w,I){return w+I},YUe=function(w){return w.join("")},XUe=function(w,I){return"e"+(I===null?"":I)},ZUe=function(){return"IN"},JUe=function(){return"IS"},KUe=function(){return"LIKE"},QUe=function(){return"ESCAPE"},e9e=function(){return"NOT"},t9e=function(){return"AND"},i9e=function(){return"OR"},r9e=function(){return"BETWEEN"},s9e=function(){return"FROM"},n9e=function(){return"FOR"},o9e=function(){return"SUBSTRING"},a9e=function(){return"EXTRACT"},l9e=function(){return"TRIM"},c9e=function(){return"POSITION"},u9e=function(){return"TIMESTAMP"},h9e=function(){return"DATE"},d9e=function(){return"LEADING"},p9e=function(){return"TRAILING"},f9e=function(){return"BOTH"},m9e=function(){return"CAST"},g9e=function(){return"AS"},y9e=function(){return"INTEGER"},_9e=function(){return"SMALLINT"},v9e=function(){return"FLOAT"},b9e=function(){return"REAL"},w9e=function(){return"VARCHAR"},x9e=function(){return"TO"},T9e=function(){return"INTERVAL"},S9e=function(){return"YEAR"},E9e=function(){return"MONTH"},C9e=function(){return"DAY"},M9e=function(){return"HOUR"},A9e=function(){return"MINUTE"},O9e=function(){return"SECOND"},R9e=function(){return"CASE"},P9e=function(){return"END"},I9e=function(){return"WHEN"},$9e=function(){return"THEN"},L9e=function(){return"ELSE"},D9e=function(w){return w},N9e=function(w){return w.join("")},M=0,ZD=[{line:1,column:1}],Wm=0,gB=[],ye=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function kt(w,I){return{type:"literal",text:w,ignoreCase:I}}function Wy(w,I,F){return{type:"class",parts:w,inverted:I,ignoreCase:F}}function F9e(){return{type:"end"}}function Poe(w){var I,F=ZD[w];if(F)return F;for(I=w-1;!ZD[I];)I--;for(F={line:(F=ZD[I]).line,column:F.column};I<w;)s.charCodeAt(I)===10?(F.line++,F.column=1):F.column++,I++;return ZD[w]=F,F}function Ioe(w,I){var F=Poe(w),W=Poe(I);return{source:l,start:{offset:w,line:F.line,column:F.column},end:{offset:I,line:W.line,column:W.column}}}function nt(w){M<Wm||(M>Wm&&(Wm=M,gB=[]),gB.push(w))}function U9e(w,I,F){return new e(e.buildMessage(w,I),w,I,F)}function $oe(){var w,I;return w=M,Te(),(I=no())!==a?(Te(),w=b8e(I)):(M=w,w=a),w}function Loe(){var w,I,F,W,ft,$r,sn,zn;if(w=M,(I=no())!==a){for(F=[],W=M,ft=Te(),($r=oN())!==a?(sn=Te(),(zn=no())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);W!==a;)F.push(W),W=M,ft=Te(),($r=oN())!==a?(sn=Te(),(zn=no())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);w=w8e(I,F)}else M=w,w=a;return w}function no(){var w,I,F,W,ft,$r,sn,zn;if(w=M,(I=yB())!==a){for(F=[],W=M,ft=Te(),($r=Xoe())!==a?(sn=Te(),(zn=yB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);W!==a;)F.push(W),W=M,ft=Te(),($r=Xoe())!==a?(sn=Te(),(zn=yB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);w=x8e(I,F)}else M=w,w=a;return w}function yB(){var w,I,F,W,ft,$r,sn,zn;if(w=M,(I=JD())!==a){for(F=[],W=M,ft=Te(),($r=rN())!==a?(sn=Te(),(zn=JD())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);W!==a;)F.push(W),W=M,ft=Te(),($r=rN())!==a?(sn=Te(),(zn=JD())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);w=T8e(I,F)}else M=w,w=a;return w}function JD(){var w,I,F,W,ft;return w=M,(I=mO())===a&&(I=M,s.charCodeAt(M)===33?(F=d,M++):(F=a,ye===0&&nt(ps)),F!==a?(W=M,ye++,s.charCodeAt(M)===61?(ft=f,M++):(ft=a,ye===0&&nt($s)),ye--,ft===a?W=void 0:(M=W,W=a),W!==a?I=F=[F,W]:(M=I,I=a)):(M=I,I=a)),I!==a?(F=Te(),(W=JD())!==a?w=S8e(W):(M=w,w=a)):(M=w,w=a),w===a&&(w=k9e()),w}function k9e(){var w,I,F;return w=M,(I=Yy())!==a?(Te(),(F=V9e())===a&&(F=null),w=E8e(I,F)):(M=w,w=a),w}function V9e(){var w;return(w=z9e())===a&&(w=H9e())===a&&(w=G9e())===a&&(w=B9e())===a&&(w=j9e()),w}function z9e(){var w,I,F,W,ft,$r;if(w=[],I=M,F=Te(),(W=Doe())!==a?(ft=Te(),($r=Yy())!==a?I=F=[F,W,ft,$r]:(M=I,I=a)):(M=I,I=a),I!==a)for(;I!==a;)w.push(I),I=M,F=Te(),(W=Doe())!==a?(ft=Te(),($r=Yy())!==a?I=F=[F,W,ft,$r]:(M=I,I=a)):(M=I,I=a);else w=a;return w!==a&&(w=C8e(w)),w}function Doe(){var w;return s.substr(M,2)===m?(w=m,M+=2):(w=a,ye===0&&nt(Sr)),w===a&&(s.charCodeAt(M)===62?(w=g,M++):(w=a,ye===0&&nt(Wo)),w===a&&(s.substr(M,2)===y?(w=y,M+=2):(w=a,ye===0&&nt(dl)),w===a&&(s.substr(M,2)===v?(w=v,M+=2):(w=a,ye===0&&nt(ve)),w===a&&(s.charCodeAt(M)===60?(w=x,M++):(w=a,ye===0&&nt(Ir)),w===a&&(s.charCodeAt(M)===61?(w=f,M++):(w=a,ye===0&&nt($s)),w===a&&(s.substr(M,2)===S?(w=S,M+=2):(w=a,ye===0&&nt(bh)))))))),w}function B9e(){var w,I,F,W;return w=M,(I=Woe())!==a?(Te(),(F=mO())!==a?(Te(),(W=Yy())!==a?w=M8e(I,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Woe())!==a?(Te(),(F=Yy())!==a?w=A8e(I,F):(M=w,w=a)):(M=w,w=a)),w}function G9e(){var w,I,F,W,ft,$r;return w=M,(I=mO())!==a?(Te(),(F=Zoe())!==a?(Te(),(W=Yy())!==a?(Te(),(ft=rN())!==a?(Te(),($r=Yy())!==a?w=O8e(F,W,$r):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Zoe())!==a?(Te(),(F=Yy())!==a?(Te(),(W=rN())!==a?(Te(),(ft=Yy())!==a?w=R8e(I,F,ft):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)),w}function Noe(){var w,I,F,W,ft;return w=M,I=M,(F=mO())!==a?(W=Te(),(ft=Yoe())!==a?I=F=[F,W,ft]:(M=I,I=a)):(M=I,I=a),I!==a&&(I=P8e(I)),(w=I)===a&&(w=Yoe()),w}function _B(){var w,I,F,W,ft;return w=M,I=M,(F=mO())!==a?(W=Te(),(ft=SB())!==a?I=F=[F,W,ft]:(M=I,I=a)):(M=I,I=a),I!==a&&(I=I8e(I)),(w=I)===a&&(w=SB()),w}function j9e(){var w,I,F,W;return w=M,(I=Noe())!==a?(Te(),(F=kS())!==a?(Te(),wke()!==a?(Te(),(W=TB())!==a?w=$8e(I,F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Noe())!==a?(Te(),(F=kS())!==a?w=L8e(I,F):(M=w,w=a)):(M=w,w=a)),w}function H9e(){var w,I,F,W;return w=M,(I=_B())!==a?(Te(),(F=yl())!==a?(Te(),(W=Loe())!==a?(Te(),_l()!==a?w=D8e(I,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=_B())!==a?(Te(),(F=yl())!==a?(Te(),(W=_l())!==a?w=N8e(I):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=_B())!==a?(Te(),(F=xB())!==a?w=F8e(I,F):(M=w,w=a)):(M=w,w=a))),w}function Yy(){var w,I,F,W,ft,$r,sn,zn;if(w=M,(I=vB())!==a){for(F=[],W=M,ft=Te(),($r=Foe())!==a?(sn=Te(),(zn=vB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);W!==a;)F.push(W),W=M,ft=Te(),($r=Foe())!==a?(sn=Te(),(zn=vB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);w=U8e(I,F)}else M=w,w=a;return w}function Foe(){var w;return s.charCodeAt(M)===43?(w=E,M++):(w=a,ye===0&&nt(Ro)),w===a&&(s.charCodeAt(M)===45?(w=C,M++):(w=a,ye===0&&nt(pl)),w===a&&(s.substr(M,2)===R?(w=R,M+=2):(w=a,ye===0&&nt(St)))),w}function vB(){var w,I,F,W,ft,$r,sn,zn;if(w=M,(I=bB())!==a){for(F=[],W=M,ft=Te(),($r=Uoe())!==a?(sn=Te(),(zn=bB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);W!==a;)F.push(W),W=M,ft=Te(),($r=Uoe())!==a?(sn=Te(),(zn=bB())!==a?W=ft=[ft,$r,sn,zn]:(M=W,W=a)):(M=W,W=a);w=k8e(I,F)}else M=w,w=a;return w}function Uoe(){var w;return s.charCodeAt(M)===42?(w=O,M++):(w=a,ye===0&&nt(Wl)),w===a&&(s.charCodeAt(M)===47?(w=U,M++):(w=a,ye===0&&nt(Ts))),w}function bB(){var w,I;return(w=rke())===a&&(w=X9e())===a&&(w=Z9e())===a&&(w=Q9e())===a&&(w=eke())===a&&(w=J9e())===a&&(w=tke())===a&&(w=dke())===a&&(w=q9e())===a&&(w=xB())===a&&(w=M,yl()!==a?(Te(),(I=no())!==a?(Te(),_l()!==a?w=V8e(I):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)),w}function q9e(){var w;return(w=W9e())!==a&&(w=z8e(w)),w}function W9e(){var w;return(w=Y9e())!==a&&(w=B8e(w)),w}function Y9e(){var w,I,F,W;if(w=M,(I=wB())!==a){for(F=[],W=Voe();W!==a;)F.push(W),W=Voe();w=G8e(I,F)}else M=w,w=a;return w}function koe(){var w,I,F,W;if(w=M,(I=wB())!==a){for(F=[],W=ji();W!==a;)F.push(W),W=ji();w=j8e(I,F)}else M=w,w=a;return w}function wB(){var w;return ds.test(s.charAt(M))?(w=s.charAt(M),M++):(w=a,ye===0&&nt(jy)),w}function ji(){var w;return jr.test(s.charAt(M))?(w=s.charAt(M),M++):(w=a,ye===0&&nt(dO)),w}function Voe(){var w;return rs.test(s.charAt(M))?(w=s.charAt(M),M++):(w=a,ye===0&&nt(fl)),w}function xB(){var w,I,F;return w=M,s.charCodeAt(M)===64?(I=L,M++):(I=a,ye===0&&nt(Bm)),I!==a&&(F=koe())!==a?w=I=[I,F]:(M=w,w=a),w!==a&&(w=H8e(w)),w}function X9e(){var w,I,F;return w=M,Ske()!==a?(Te(),yl()!==a?(Te(),(I=ike())!==a?(Te(),EB()!==a?(Te(),(F=no())!==a?(Te(),_l()!==a?w=q8e(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function Z9e(){var w,I,F,W,ft,$r,sn;return w=M,Tke()!==a?(Te(),yl()!==a?(Te(),(I=no())!==a?(Te(),EB()!==a?(Te(),(F=no())!==a?(Te(),W=M,(ft=xke())!==a?($r=Te(),(sn=no())!==a?W=ft=[ft,$r,sn,Te()]:(M=W,W=a)):(M=W,W=a),W===a&&(W=null),(ft=_l())!==a?w=W8e(I,F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function J9e(){var w,I,F;return w=M,Oke()!==a?(Te(),yl()!==a?(Te(),(I=no())!==a?(Te(),Rke()!==a?(Te(),(F=K9e())!==a?(Te(),_l()!==a?w=Y8e(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function K9e(){var w,I,F;return w=M,(I=Pke())!==a&&(I=X8e()),(w=I)===a&&(w=M,(I=Ike())!==a&&(I=Z8e()),(w=I)===a&&(w=M,(I=$ke())!==a&&(I=J8e()),(w=I)===a&&(w=M,(I=Lke())!==a&&(I=K8e()),(w=I)===a&&(w=M,(I=Qoe())!==a&&(I=Q8e()),(w=I)===a&&(w=M,(I=Koe())!==a&&(I=eUe()),(w=I)===a&&(w=M,(I=Dke())!==a?(Te(),yl()!==a?(Te(),(F=Ow())!==a?(Te(),_l()!==a?w=tUe(F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a))))))),w}function Q9e(){var w,I,F,W;return w=M,Joe()!==a?(Te(),yl()!==a?(Te(),(I=zoe())===a&&(I=null),Te(),(F=no())!==a?(Te(),EB()!==a?(Te(),(W=no())!==a?(Te(),_l()!==a?w=iUe(I,F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,Joe()!==a?(Te(),yl()!==a?(Te(),(I=zoe())===a&&(I=null),Te(),(F=no())!==a?(Te(),_l()!==a?w=rUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)),w}function zoe(){var w;return(w=Cke())===a&&(w=Mke())===a&&(w=Ake()),w}function eke(){var w,I,F;return w=M,Eke()!==a?(Te(),yl()!==a?(Te(),(I=no())!==a?(Te(),SB()!==a?(Te(),(F=no())!==a?(Te(),_l()!==a?w=sUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function tke(){var w,I,F;return w=M,(I=Uke())!==a?(Te(),yl()!==a?(Te(),(F=Loe())===a&&(F=null),Te(),_l()!==a?w=nUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function ike(){var w;return(w=tae())===a&&(w=iae())===a&&(w=rae())===a&&(w=sae())===a&&(w=nae())===a&&(w=Rw()),w}function rke(){var w;return(w=TB())===a&&(w=mke())===a&&(w=hke())===a&&(w=uke())===a&&(w=cke())===a&&(w=ske())===a&&(w=nke()),w}function ske(){var w,I;return w=M,Koe()!==a?(Te(),(I=kS())!==a?w=oUe(I):(M=w,w=a)):(M=w,w=a),w}function nke(){var w,I,F,W;return w=M,eae()!==a?(Te(),s.charCodeAt(M)===45?(I=C,M++):(I=a,ye===0&&nt(pl)),I===a&&(s.charCodeAt(M)===43?(I=E,M++):(I=a,ye===0&&nt(Ro))),I!==a?(Te(),(F=kS())!==a?(Te(),(W=Boe())!==a?w=aUe(I,F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,eae()!==a?(Te(),(I=kS())!==a?(Te(),(F=Boe())!==a?w=lUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)),w}function Boe(){var w,I,F;return w=M,(I=oke())!==a?(Te(),Nke()!==a?(Te(),(F=ake())!==a?w=cUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=lke()),w}function oke(){var w,I,F;return w=M,(I=fO())!==a?(Te(),yl()!==a?(Te(),(F=QD())!==a?(Te(),_l()!==a?w=uUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=fO())!==a&&(I=hUe(I)),w=I),w}function ake(){var w,I,F,W;return w=M,(I=fO())!==a&&(I=dUe(I)),(w=I)===a&&(w=M,(I=Rw())!==a?(Te(),yl()!==a?(Te(),(F=QD())!==a?(Te(),oN()!==a?(Te(),(W=KD())!==a?(Te(),_l()!==a?w=pUe(F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Rw())!==a?(Te(),yl()!==a?(Te(),(F=QD())!==a?(Te(),_l()!==a?w=fUe(F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Rw())!==a&&(I=mUe()),w=I))),w}function lke(){var w,I,F,W;return w=M,(I=fO())!==a?(Te(),yl()!==a?(Te(),(F=KD())!==a?(Te(),_l()!==a?w=gUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=fO())!==a&&(I=yUe(I)),(w=I)===a&&(w=M,(I=Rw())!==a?(Te(),yl()!==a?(Te(),(F=QD())!==a?(Te(),oN()!==a?(Te(),(W=KD())!==a?(Te(),_l()!==a?w=_Ue(F,W):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Rw())!==a?(Te(),yl()!==a?(Te(),(F=KD())!==a?(Te(),_l()!==a?w=vUe(F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w===a&&(w=M,(I=Rw())!==a&&(I=bUe()),w=I)))),w}function fO(){var w,I;return w=M,(I=rae())!==a&&(I=wUe()),(w=I)===a&&(w=M,(I=sae())!==a&&(I=xUe()),(w=I)===a&&(w=M,(I=nae())!==a&&(I=TUe()),(w=I)===a&&(w=M,(I=iae())!==a&&(I=SUe()),(w=I)===a&&(w=M,(I=tae())!==a&&(I=EUe()),w=I)))),w}function KD(){var w;return(w=Ow())!==a&&(w=CUe(w)),w}function QD(){var w;return(w=Ow())!==a&&(w=MUe(w)),w}function cke(){var w,I;return w=M,Qoe()!==a?(Te(),(I=kS())!==a?w=AUe(I):(M=w,w=a)):(M=w,w=a),w}function uke(){var w;return(w=_ke())!==a&&(w=OUe()),w}function hke(){var w,I;return w=M,(I=vke())!==a&&(I=RUe()),(w=I)===a&&(w=M,(I=bke())!==a&&(I=PUe()),w=I),w}function kS(){var w;return(w=TB())===a&&(w=xB()),w}function TB(){var w,I,F,W,ft;if(w=M,s.charCodeAt(M)===39?(I=B,M++):(I=a,ye===0&&nt(Cd)),I===a&&(s.substr(M,2)===G?(I=G,M+=2):(I=a,ye===0&&nt(hi))),I!==a){for(F=[],W=M,s.substr(M,2)===j?(ft=j,M+=2):(ft=a,ye===0&&nt(Mw)),ft!==a&&(ft=Roe()),(W=ft)===a&&(xs.test(s.charAt(M))?(W=s.charAt(M),M++):(W=a,ye===0&&nt(Md)));W!==a;)F.push(W),W=M,s.substr(M,2)===j?(ft=j,M+=2):(ft=a,ye===0&&nt(Mw)),ft!==a&&(ft=Roe()),(W=ft)===a&&(xs.test(s.charAt(M))?(W=s.charAt(M),M++):(W=a,ye===0&&nt(Md)));s.charCodeAt(M)===39?(W=B,M++):(W=a,ye===0&&nt(Cd)),W!==a?w=IUe(F):(M=w,w=a)}else M=w,w=a;return w}function dke(){var w;return(w=pke())===a&&(w=fke()),w}function pke(){var w,I,F,W,ft;if(w=M,sN()!==a)if(Te(),(I=no())!==a){for(Te(),F=[],W=tN();W!==a;)F.push(W),W=tN();W=Te(),(ft=nN())!==a?w=$Ue(I,F):(M=w,w=a)}else M=w,w=a;else M=w,w=a;if(w===a)if(w=M,sN()!==a)if(Te(),(I=no())!==a){for(Te(),F=[],W=tN();W!==a;)F.push(W),W=tN();W=Te(),(ft=Goe())!==a?(Te(),nN()!==a?w=LUe(I,F,ft):(M=w,w=a)):(M=w,w=a)}else M=w,w=a;else M=w,w=a;return w}function fke(){var w,I,F,W;if(w=M,sN()!==a){for(Te(),I=[],F=eN();F!==a;)I.push(F),F=eN();F=Te(),(W=nN())!==a?w=DUe(I):(M=w,w=a)}else M=w,w=a;if(w===a)if(w=M,sN()!==a){for(Te(),I=[],F=eN();F!==a;)I.push(F),F=eN();F=Te(),(W=Goe())!==a?(Te(),nN()!==a?w=NUe(I,W):(M=w,w=a)):(M=w,w=a)}else M=w,w=a;return w}function eN(){var w,I,F;return w=M,oae()!==a?(Te(),(I=no())!==a?(Te(),aae()!==a?(Te(),(F=no())!==a?w=FUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function tN(){var w,I,F;return w=M,oae()!==a?(Te(),(I=no())!==a?(Te(),aae()!==a?(Te(),(F=no())!==a?w=UUe(I,F):(M=w,w=a)):(M=w,w=a)):(M=w,w=a)):(M=w,w=a),w}function Goe(){var w,I;return w=M,Fke()!==a?(Te(),(I=no())!==a?w=kUe(I):(M=w,w=a)):(M=w,w=a),w}function mke(){var w,I,F,W;return w=M,(I=gke())!==a?(F=M,ye++,W=wB(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=VUe(I):(M=w,w=a)):(M=w,w=a),w}function gke(){var w,I,F,W;return w=M,(I=iN())!==a&&(F=joe())!==a&&(W=Hoe())!==a?w=zUe(I,F,W):(M=w,w=a),w===a&&(w=M,(I=iN())!==a&&(F=joe())!==a?w=BUe(I,F):(M=w,w=a),w===a&&(w=M,(I=iN())!==a&&(F=Hoe())!==a?w=GUe(I,F):(M=w,w=a),w===a&&(w=M,(I=iN())!==a&&(I=jUe(I)),w=I))),w}function iN(){var w,I,F;return(w=Ow())===a&&(w=M,s.charCodeAt(M)===45?(I=C,M++):(I=a,ye===0&&nt(pl)),I===a&&(s.charCodeAt(M)===43?(I=E,M++):(I=a,ye===0&&nt(Ro))),I!==a&&(F=Ow())!==a?w=HUe(I,F):(M=w,w=a)),w}function joe(){var w,I,F;return w=M,s.charCodeAt(M)===46?(I=q,M++):(I=a,ye===0&&nt(Gm)),I!==a?((F=Ow())===a&&(F=null),w=qUe(F)):(M=w,w=a),w}function Hoe(){var w,I,F;return w=M,(I=yke())!==a&&(F=Ow())!==a?w=WUe(I,F):(M=w,w=a),w}function Ow(){var w,I;if(w=[],(I=qoe())!==a)for(;I!==a;)w.push(I),I=qoe();else w=a;return w!==a&&(w=YUe(w)),w}function qoe(){var w;return rn.test(s.charAt(M))?(w=s.charAt(M),M++):(w=a,ye===0&&nt(jm)),w}function yke(){var w,I,F;return w=M,Oo.test(s.charAt(M))?(I=s.charAt(M),M++):(I=a,ye===0&&nt(Yo)),I!==a?(ro.test(s.charAt(M))?(F=s.charAt(M),M++):(F=a,ye===0&&nt(yu)),F===a&&(F=null),w=XUe(I,F)):(M=w,w=a),w}function _ke(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===ie?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(_u)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=I=[I,F]:(M=w,w=a)):(M=w,w=a),w}function vke(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===ee?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(Er)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=I=[I,F]:(M=w,w=a)):(M=w,w=a),w}function bke(){var w,I,F,W;return w=M,s.substr(M,5).toLowerCase()===K?(I=s.substr(M,5),M+=5):(I=a,ye===0&&nt(Ad)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=I=[I,F]:(M=w,w=a)):(M=w,w=a),w}function SB(){var w,I,F,W;return w=M,s.substr(M,2).toLowerCase()===Y?(I=s.substr(M,2),M+=2):(I=a,ye===0&&nt(rf)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=ZUe():(M=w,w=a)):(M=w,w=a),w}function Woe(){var w,I,F,W;return w=M,s.substr(M,2).toLowerCase()===D?(I=s.substr(M,2),M+=2):(I=a,ye===0&&nt(yv)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=JUe():(M=w,w=a)):(M=w,w=a),w}function Yoe(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===V?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(Hy)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=KUe():(M=w,w=a)):(M=w,w=a),w}function wke(){var w,I,F,W;return w=M,s.substr(M,6).toLowerCase()===k?(I=s.substr(M,6),M+=6):(I=a,ye===0&&nt(_v)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=QUe():(M=w,w=a)):(M=w,w=a),w}function mO(){var w,I,F,W;return w=M,s.substr(M,3).toLowerCase()===Z?(I=s.substr(M,3),M+=3):(I=a,ye===0&&nt(qy)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=e9e():(M=w,w=a)):(M=w,w=a),w}function rN(){var w,I,F,W;return w=M,s.substr(M,3).toLowerCase()===Q?(I=s.substr(M,3),M+=3):(I=a,ye===0&&nt(Hm)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=t9e():(M=w,w=a)):(M=w,w=a),w}function Xoe(){var w,I,F,W;return w=M,s.substr(M,2).toLowerCase()===ne?(I=s.substr(M,2),M+=2):(I=a,ye===0&&nt(ml)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=i9e():(M=w,w=a)):(M=w,w=a),w}function Zoe(){var w,I,F,W;return w=M,s.substr(M,7).toLowerCase()===te?(I=s.substr(M,7),M+=7):(I=a,ye===0&&nt(US)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=r9e():(M=w,w=a)):(M=w,w=a),w}function EB(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===de?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(Aw)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=s9e():(M=w,w=a)):(M=w,w=a),w}function xke(){var w,I,F,W;return w=M,s.substr(M,3).toLowerCase()===_e?(I=s.substr(M,3),M+=3):(I=a,ye===0&&nt(re)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=n9e():(M=w,w=a)):(M=w,w=a),w}function Tke(){var w,I,F,W;return w=M,s.substr(M,9).toLowerCase()===Ce?(I=s.substr(M,9),M+=9):(I=a,ye===0&&nt(Oe)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=o9e():(M=w,w=a)):(M=w,w=a),w}function Ske(){var w,I,F,W;return w=M,s.substr(M,7).toLowerCase()===Pe?(I=s.substr(M,7),M+=7):(I=a,ye===0&&nt(Fe)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=a9e():(M=w,w=a)):(M=w,w=a),w}function Joe(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Ze?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(Ei)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=l9e():(M=w,w=a)):(M=w,w=a),w}function Eke(){var w,I,F,W;return w=M,s.substr(M,8).toLowerCase()===Le?(I=s.substr(M,8),M+=8):(I=a,ye===0&&nt(so)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=c9e():(M=w,w=a)):(M=w,w=a),w}function Koe(){var w,I,F,W;return w=M,s.substr(M,9).toLowerCase()===Me?(I=s.substr(M,9),M+=9):(I=a,ye===0&&nt(Xs)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=u9e():(M=w,w=a)):(M=w,w=a),w}function Qoe(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===qe?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(gl)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=h9e():(M=w,w=a)):(M=w,w=a),w}function Cke(){var w,I,F,W;return w=M,s.substr(M,7).toLowerCase()===We?(I=s.substr(M,7),M+=7):(I=a,ye===0&&nt(qm)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=d9e():(M=w,w=a)):(M=w,w=a),w}function Mke(){var w,I,F,W;return w=M,s.substr(M,8).toLowerCase()===$t?(I=s.substr(M,8),M+=8):(I=a,ye===0&&nt(WD)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=p9e():(M=w,w=a)):(M=w,w=a),w}function Ake(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===ut?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(YD)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=f9e():(M=w,w=a)):(M=w,w=a),w}function Oke(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Qt?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(XD)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=m9e():(M=w,w=a)):(M=w,w=a),w}function Rke(){var w,I,F,W;return w=M,s.substr(M,2).toLowerCase()===ai?(I=s.substr(M,2),M+=2):(I=a,ye===0&&nt(pO)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=g9e():(M=w,w=a)):(M=w,w=a),w}function Pke(){var w,I,F,W;return w=M,s.substr(M,7).toLowerCase()===ui?(I=s.substr(M,7),M+=7):(I=a,ye===0&&nt(K6e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=y9e():(M=w,w=a)):(M=w,w=a),w}function Ike(){var w,I,F,W;return w=M,s.substr(M,8).toLowerCase()===li?(I=s.substr(M,8),M+=8):(I=a,ye===0&&nt(Q6e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=_9e():(M=w,w=a)):(M=w,w=a),w}function $ke(){var w,I,F,W;return w=M,s.substr(M,5).toLowerCase()===Ri?(I=s.substr(M,5),M+=5):(I=a,ye===0&&nt(e8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=v9e():(M=w,w=a)):(M=w,w=a),w}function Lke(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===pr?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(t8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=b9e():(M=w,w=a)):(M=w,w=a),w}function Dke(){var w,I,F,W;return w=M,s.substr(M,7).toLowerCase()===Gi?(I=s.substr(M,7),M+=7):(I=a,ye===0&&nt(i8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=w9e():(M=w,w=a)):(M=w,w=a),w}function Nke(){var w,I,F,W;return w=M,s.substr(M,2).toLowerCase()===Fi?(I=s.substr(M,2),M+=2):(I=a,ye===0&&nt(r8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=x9e():(M=w,w=a)):(M=w,w=a),w}function eae(){var w,I,F,W;return w=M,s.substr(M,8).toLowerCase()===pt?(I=s.substr(M,8),M+=8):(I=a,ye===0&&nt(s8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=T9e():(M=w,w=a)):(M=w,w=a),w}function tae(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===lt?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(n8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=S9e():(M=w,w=a)):(M=w,w=a),w}function iae(){var w,I,F,W;return w=M,s.substr(M,5).toLowerCase()===wt?(I=s.substr(M,5),M+=5):(I=a,ye===0&&nt(o8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=E9e():(M=w,w=a)):(M=w,w=a),w}function rae(){var w,I,F,W;return w=M,s.substr(M,3).toLowerCase()===Tt?(I=s.substr(M,3),M+=3):(I=a,ye===0&&nt(a8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=C9e():(M=w,w=a)):(M=w,w=a),w}function sae(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Lt?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(l8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=M9e():(M=w,w=a)):(M=w,w=a),w}function nae(){var w,I,F,W;return w=M,s.substr(M,6).toLowerCase()===oi?(I=s.substr(M,6),M+=6):(I=a,ye===0&&nt(c8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=A9e():(M=w,w=a)):(M=w,w=a),w}function Rw(){var w,I,F,W;return w=M,s.substr(M,6).toLowerCase()===qi?(I=s.substr(M,6),M+=6):(I=a,ye===0&&nt(u8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=O9e():(M=w,w=a)):(M=w,w=a),w}function sN(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Wi?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(h8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=R9e():(M=w,w=a)):(M=w,w=a),w}function nN(){var w,I,F,W;return w=M,s.substr(M,3).toLowerCase()===Yi?(I=s.substr(M,3),M+=3):(I=a,ye===0&&nt(d8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=P9e():(M=w,w=a)):(M=w,w=a),w}function oae(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Xi?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(p8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=I9e():(M=w,w=a)):(M=w,w=a),w}function aae(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===Gr?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(f8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=$9e():(M=w,w=a)):(M=w,w=a),w}function Fke(){var w,I,F,W;return w=M,s.substr(M,4).toLowerCase()===mi?(I=s.substr(M,4),M+=4):(I=a,ye===0&&nt(m8e)),I!==a?(F=M,ye++,W=ji(),ye--,W===a?F=void 0:(M=F,F=a),F!==a?w=L9e():(M=w,w=a)):(M=w,w=a),w}function oN(){var w;return s.charCodeAt(M)===44?(w=Li,M++):(w=a,ye===0&&nt(g8e)),w}function yl(){var w;return s.charCodeAt(M)===40?(w=Pi,M++):(w=a,ye===0&&nt(y8e)),w}function _l(){var w;return s.charCodeAt(M)===41?(w=Ws,M++):(w=a,ye===0&&nt(_8e)),w}function Te(){var w,I;for(w=[],I=lae();I!==a;)w.push(I),I=lae();return w}function lae(){var w;return Ys.test(s.charAt(M))?(w=s.charAt(M),M++):(w=a,ye===0&&nt(v8e)),w}function Uke(){var w,I,F,W;if(w=M,(I=koe())!==a&&(I=D9e(I)),(w=I)===a)if(w=M,s.charCodeAt(M)===96?(I=vr,M++):(I=a,ye===0&&nt(Aoe)),I!==a){if(F=[],ss.test(s.charAt(M))?(W=s.charAt(M),M++):(W=a,ye===0&&nt(Ooe)),W!==a)for(;W!==a;)F.push(W),ss.test(s.charAt(M))?(W=s.charAt(M),M++):(W=a,ye===0&&nt(Ooe));else F=a;F!==a?(s.charCodeAt(M)===96?(W=vr,M++):(W=a,ye===0&&nt(Aoe)),W!==a?w=N9e(F):(M=w,w=a)):(M=w,w=a)}else M=w,w=a;return w}function kke(w,I){return{type:"unary-expression",operator:w,expr:I}}function cae(w,I,F,W){var ft={type:"binary-expression",operator:w,left:I,right:F};return W!==void 0&&(ft.escape=W),ft}function Vke(w,I){for(var F=[w],W=0;W<I.length;W++)F.push(I[W][3]);return F}function zke(w,I,F){return Vke(w,I)}function gO(w,I){for(var F=w,W=0;W<I.length;W++)F=cae(I[W][1],F,I[W][3]);return F}if((o=h())!==a&&M===s.length)return o;throw o!==a&&M<s.length&&nt(F9e()),U9e(gB,Wm<s.length?s.charAt(Wm):null,Wm<s.length?Ioe(Wm,Wm+1):Ioe(Wm,Wm))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,d=i("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+d+` |
`+l.line+" | "+f+`
`+d+" | "+i("",l.column-1," ")+i("",m,"^")}else n+=`
 at `+c}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function d(m){var g,y,v=m.map(h);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:r}},(lve={get exports(){return $Q},set exports(t){$Q=t}}).exports&&(lve.exports=cve());let FUt=class{static parse(e){return $Q.parse(e)}};const C5e=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,UUt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,kUt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,VUt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,zUt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,BUt=new Set(["current_timestamp","current_date","current_time"]);function yx(t,e){return(t+="").length>=e?t:new Array(e-t.length+1).join("0")+t}function IR(t,e,i="0",r="0",s="0",n="0",o="",a="0",l="0"){if(o==="+"||o==="-"){const c=`${yx(parseInt(t,10),4)}-${yx(parseInt(e,10),2)}-${yx(parseInt(i,10),2)}`;let h="";parseFloat(n)<10&&(h="0");const d=`${yx(parseInt(r,10),2)}:${yx(parseInt(s,10),2)}:${h+parseFloat(n).toString()}`,f=`${o}${yx(parseInt(a,10),2)}:${yx(parseInt(l,10),2)}`;return new Date(c+"T"+d+f)}return new Date(parseInt(t,10),parseInt(e,10)-1,parseInt(i,10),parseInt(r,10),parseInt(s,10),parseFloat(n))}let GUt=class{static makeBool(e){return O5e(e)}static featureValue(e,i,r,s){return L5e(e,i,r,s)}static equalsNull(e){return e===null}static applyLike(e,i,r){return FQ(e,i,r)}static ensureArray(e){return DQ(e)}static applyIn(e,i){return NQ(e,i)}static currentDate(){const e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,i,r){return d_.createFromValueAndQualifer(e,i,r)}static convertInterval(e){return e instanceof d_?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,i,r){return I5e(e,i,r)}static calculate(e,i,r){return $5e(e,i,r)}static makeComparable(e){return s_(e)}static evaluateFunction(e,i){return noe(e,i)}static lookup(e,i){const r=i[e];return r===void 0?null:r}static between(e,i){return e==null||i[0]==null||i[1]==null?null:e>=i[0]&&e<=i[1]}static notbetween(e,i){return e==null||i[0]==null||i[1]==null?null:e<i[0]||e>i[1]}static ternaryNot(e){return P8(e)}static ternaryAnd(e,i){return R5e(e,i)}static ternaryOr(e,i){return P5e(e,i)}},M5e=class A5e{constructor(e,i){this.fieldsIndex=i,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=FUt.parse(e);const{isStandardized:r,isAggregate:s,referencedFieldNames:n}=this._extractExpressionInfo(i);this._referencedFieldNames=n,this.isStandardized=r,this.isAggregate=s}static create(e,i){return new A5e(e,i)}get fieldNames(){return this._referencedFieldNames}testSet(e,i=ET){const r={};for(const s of this.fieldNames)r[s]=e.map(n=>i.getAttribute(n,s));return!!this._evaluateNode(this.parseTree,{attributes:r},ET)}calculateValue(e,i=ET){const r=this._evaluateNode(this.parseTree,e,i);return r instanceof d_?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(e,i=ET){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(e,this.parameters,i,this._datefields):me("esri-csp-restrictions")?this.calculateValue(e,i):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,i,this._datefields))}testFeature(e,i=ET){return!!this._evaluateNode(this.parseTree,e,i)}testFeatureCompiled(e,i=ET){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(e,this.parameters,i,this._datefields):me("esri-csp-restrictions")?this.testFeature(e,i):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,i,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,e=>{e.type==="current-time"?this._hasDateFunctions=!0:e.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||BUt.has(e.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const e=new Set;return this._visitAll(this.parseTree,i=>{i.type==="function"&&e.add(i.name.toLowerCase())}),Array.from(e)}getExpressions(){const e=new Map;return this._visitAll(this.parseTree,i=>{if(i.type==="function"){const r=i.name.toLowerCase(),s=i.args.value[0];if(s.type==="column-reference"){const n=s.column,o=`${r}-${n}`;e.has(o)||e.set(o,{aggregateType:r,field:n})}}}),[...e.values()]}getVariables(){const e=new Set;return this._visitAll(this.parseTree,i=>{i.type==="parameter"&&e.add(i.value.toLowerCase())}),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(GUt)}_extractExpressionInfo(e){const i=[],r=new Set;let s=!0,n=!0;return this._visitAll(this.parseTree,o=>{switch(o.type){case"column-reference":{const a=e==null?void 0:e.get(o.column);let l,c;a?l=c=a.name??"":(c=o.column,l=c.toLowerCase()),a&&a.name&&(a.type==="date"||a.type==="esriFieldTypeDate")&&(this._datefields[a.name]=1),r.has(l)||(r.add(l),i.push(c)),o.column=c;break}case"function":{const{name:a,args:l}=o,c=l.value.length;s&&(s=LUt(a,c)),n&&(n=AUt(a,c));break}}}),{referencedFieldNames:Array.from(i),isStandardized:s,isAggregate:n}}_visitAll(e,i){if(e!=null)switch(i(e),e.type){case"when-clause":this._visitAll(e.operand,i),this._visitAll(e.value,i);break;case"case-expression":for(const r of e.clauses)this._visitAll(r,i);e.format==="simple"&&this._visitAll(e.operand,i),e.else!==null&&this._visitAll(e.else,i);break;case"expression-list":for(const r of e.value)this._visitAll(r,i);break;case"unary-expression":this._visitAll(e.expr,i);break;case"binary-expression":this._visitAll(e.left,i),this._visitAll(e.right,i);break;case"function":this._visitAll(e.args,i)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case-expression":{let i="";if(e.format==="simple"){const r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";i="( ";for(let s=0;s<e.clauses.length;s++)i+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[s].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[s].value)+") : ";e.else!==null?i+=this.evaluateNodeToJavaScript(e.else):i+="null",i+=" )"}else{i="( ";for(let r=0;r<e.clauses.length;r++)i+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";e.else!==null?i+=this.evaluateNodeToJavaScript(e.else):i+="null",i+=" )"}return i}case"parameter":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expression-list":{let i="[";for(const r of e.value)i!=="["&&(i+=","),i+=this.evaluateNodeToJavaScript(r);return i+="]",i}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary-expression":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if(e.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if(e.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+uve(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+LQ(e.value).getTime().toString()+"))";case"current-time":return e.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}_evaluateNode(e,i,r){switch(e.type){case"interval":{const s=this._evaluateNode(e.value,i,r);return d_.createFromValueAndQualifer(s,e.qualifier,e.op)}case"case-expression":if(e.format==="simple"){const s=s_(this._evaluateNode(e.operand,i,r));for(let n=0;n<e.clauses.length;n++)if(s===s_(this._evaluateNode(e.clauses[n].operand,i,r)))return this._evaluateNode(e.clauses[n].value,i,r);if(e.else!==null)return this._evaluateNode(e.else,i,r)}else{for(let s=0;s<e.clauses.length;s++)if(O5e(this._evaluateNode(e.clauses[s].operand,i,r)))return this._evaluateNode(e.clauses[s].value,i,r);if(e.else!==null)return this._evaluateNode(e.else,i,r)}return null;case"parameter":return this.parameters[e.value.toLowerCase()];case"expression-list":{const s=[];for(const n of e.value)s.push(this._evaluateNode(n,i,r));return s}case"unary-expression":return P8(this._evaluateNode(e.expr,i,r));case"binary-expression":switch(e.operator){case"AND":return R5e(this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r));case"OR":return P5e(this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r));case"IS":if(e.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(e.left,i,r)===null;case"ISNOT":if(e.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(e.left,i,r)!==null;case"IN":{const s=DQ(this._evaluateNode(e.right,i,r));return NQ(this._evaluateNode(e.left,i,r),s)}case"NOT IN":{const s=DQ(this._evaluateNode(e.right,i,r));return P8(NQ(this._evaluateNode(e.left,i,r),s))}case"BETWEEN":{const s=this._evaluateNode(e.left,i,r),n=this._evaluateNode(e.right,i,r);return s==null||n[0]==null||n[1]==null?null:s>=s_(n[0])&&s<=s_(n[1])}case"NOTBETWEEN":{const s=this._evaluateNode(e.left,i,r),n=this._evaluateNode(e.right,i,r);return s==null||n[0]==null||n[1]==null?null:s<s_(n[0])||s>s_(n[1])}case"LIKE":return FQ(this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r),e.escape);case"NOT LIKE":return P8(FQ(this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return I5e(e.operator,this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r));case"-":case"+":case"*":case"/":case"||":return $5e(e.operator,this._evaluateNode(e.left,i,r),this._evaluateNode(e.right,i,r))}case"null":case"boolean":case"string":case"number":return e.value;case"date":return uve(e.value);case"timestamp":return LQ(e.value);case"current-time":{const s=new Date;return e.mode==="date"&&s.setHours(0,0,0,0),s}case"column-reference":return L5e(i,e.column,this._datefields,r);case"data-type":return e.value;case"function":{const s=this._evaluateNode(e.args,i,r);return this.isAggregate?MUt(e.name,s):noe(e.name,s)}}throw new Error("Unsupported sql syntax "+e.type)}};function LQ(t){let e=UUt.exec(t);if(e!==null){const[,i,r,s,n,o,a]=e;return IR(i,r,s,n,o,a)}if(e=kUt.exec(t),e!==null){const[,i,r,s,n,o,a,l,c,h]=e;return IR(i,r,s,n,o,a,l,c,h)}if(e=VUt.exec(t),e!==null){const[,i,r,s,n,o,a,l,c]=e;return IR(i,r,s,n,o,"0",a,l,c)}if(e=zUt.exec(t),e!==null){const[,i,r,s,n,o]=e;return IR(i,r,s,n,o)}if(e=C5e.exec(t),e!==null){const[,i,r,s]=e;return IR(i,r,s)}throw new Error("SQL Invalid Timestamp")}function uve(t){const e=C5e.exec(t);if(e===null)try{return LQ(t)}catch{throw new Error("SQL Invalid Date")}const[,i,r,s]=e;return new Date(parseInt(i,10),parseInt(r,10)-1,parseInt(s,10))}function O5e(t){return t===!0}function DQ(t){return Array.isArray(t)?t:[t]}function P8(t){return t!==null?t!==!0:null}function R5e(t,e){return t!=null&&e!=null?t===!0&&e===!0:t!==!1&&e!==!1&&null}function P5e(t,e){return t!=null&&e!=null?t===!0||e===!0:t===!0||e===!0||null}function NQ(t,e){if(t==null)return null;let i=!1;for(const r of e)if(r==null)i=null;else if(t===r){i=!0;break}return i}const hve="-[]/{}()*+?.\\^$|";var YT;function jUt(t,e){const i=e;let r="",s=YT.Normal;for(let n=0;n<t.length;n++){const o=t.charAt(n);switch(s){case YT.Normal:o===i?s=YT.Escaped:hve.includes(o)?r+="\\"+o:r+=o==="%"?".*":o==="_"?".":o;break;case YT.Escaped:hve.includes(o)?r+="\\"+o:r+=o,s=YT.Normal}}return new RegExp("^"+r+"$","m")}function FQ(t,e,i){return t==null?null:jUt(e,i).test(t)}function s_(t){return t instanceof Date?t.valueOf():t}function I5e(t,e,i){if(e==null||i==null)return null;const r=s_(e),s=s_(i);switch(t){case"<>":return r!==s;case"=":return r===s;case">":return r>s;case"<":return r<s;case">=":return r>=s;case"<=":return r<=s}}function $5e(t,e,i){if(t==="||")return noe("concat",[e,i]);if(e instanceof d_)if(i instanceof Date)switch(t){case"+":return new Date(e.valueInMilliseconds()+i.getTime());case"-":return e.valueInMilliseconds()-i.getTime();case"*":return e.valueInMilliseconds()*i.getTime();case"/":return e.valueInMilliseconds()/i.getTime()}else if(i instanceof d_)switch(t){case"+":return d_.createFromMilliseconds(e.valueInMilliseconds()+i.valueInMilliseconds());case"-":return d_.createFromMilliseconds(e.valueInMilliseconds()-i.valueInMilliseconds());case"*":return e.valueInMilliseconds()*i.valueInMilliseconds();case"/":return e.valueInMilliseconds()/i.valueInMilliseconds()}else e=e.valueInMilliseconds();else if(i instanceof d_)if(e instanceof Date)switch(t){case"+":return new Date(i.valueInMilliseconds()+e.getTime());case"-":return new Date(e.getTime()-i.valueInMilliseconds());case"*":return e.getTime()*i.valueInMilliseconds();case"/":return e.getTime()/i.valueInMilliseconds()}else i=i.valueInMilliseconds();else if(e instanceof Date&&typeof i=="number")switch(i=24*i*60*60*1e3,e=e.getTime(),t){case"+":return new Date(e+i);case"-":return new Date(e-i);case"*":return new Date(e*i);case"/":return new Date(e/i)}else if(i instanceof Date&&typeof e=="number")switch(e=24*e*60*60*1e3,i=i.getTime(),t){case"+":return new Date(e+i);case"-":return new Date(e-i);case"*":return new Date(e*i);case"/":return new Date(e/i)}switch(t){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i}}function HUt(t){return t&&typeof t.attributes=="object"}function L5e(t,e,i,r){const s=r.getAttribute(t,e);return s!=null&&i[e]===1?new Date(s):s}(function(t){t[t.Normal=0]="Normal",t[t.Escaped=1]="Escaped"})(YT||(YT={}));const ET={getAttribute:(t,e)=>(HUt(t)?t.attributes:t)[e]},ooe=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:M5e,defaultAttributeAdapter:ET},Symbol.toStringTag,{value:"Module"}));let qUt=class{constructor(e,i){this._cache=new HY(e),this._invalidCache=new HY(i)}get(e,i){const r=`${i.uid}:${e}`,s=this._cache.get(r);if(s)return s;if(this._invalidCache.get(r)!==void 0)return null;try{const n=M5e.create(e,i);return this._cache.put(r,n),n}catch{return this._invalidCache.put(r,null),null}}};const aoe=new qUt(50,500),Ub="feature-store:unsupported-query",D5e=" as ",WUt=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function Sli(t,e){if(!e)return!0;const i=aoe.get(e,t);if(!i)throw new J(Ub,"invalid SQL expression",{where:e});if(!i.isStandardized)throw new J(Ub,"where clause is not standard",{where:e});return loe(t,i.fieldNames,"where clause contains missing fields"),!0}function Eli(t,e,i){if(!e)return!0;const r=aoe.get(e,t);if(!r)throw new J(Ub,"invalid SQL expression",{having:e});if(!r.isAggregate)throw new J(Ub,"having does not contain a valid aggregate function",{having:e});const s=r.fieldNames;if(loe(t,s,"having contains missing fields"),!r.getExpressions().every(n=>{var c;const{aggregateType:o,field:a}=n,l=(c=t.get(a))==null?void 0:c.name;return i.some(h=>{var g;const{onStatisticField:d,statisticType:f}=h;return((g=t.get(d))==null?void 0:g.name)===l&&f.toLowerCase().trim()===o})}))throw new J(Ub,"expressions in having should also exist in outStatistics",{having:e});return!0}function pI(t,e){return t?aoe.get(t,e):null}function loe(t,e,i,r=!0){const s=[];for(const n of e)if(n!=="*"&&!t.has(n))if(r){const o=N5e(n);try{const a=pI(o,t);if(!a)throw new J(Ub,"invalid SQL expression",{where:o});if(!a.isStandardized)throw new J(Ub,"expression is not standard",{clause:a});loe(t,a.fieldNames,"expression contains missing fields")}catch(a){const l=a&&a.details;if(l&&(l.clause||l.where))throw a;l&&l.missingFields?s.push(...l.missingFields):s.push(n)}}else s.push(n);if(s.length)throw new J(Ub,i,{missingFields:s})}function N5e(t){return t.split(D5e)[0]}function YUt(t){return t.split(D5e)[1]}function Cli(t,e){const i=e.get(t);return!!i&&!WUt.has(i.type)}const dve=new Hi({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),pve=new Hi({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let Uf=class extends Ae{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",e)}set definedInterval(e){this.classificationMethod==="defined-interval"&&this._set("definedInterval",e)}};u([It({classBreaksDef:"class-breaks-definition"})],Uf.prototype,"type",void 0),u([p({json:{write:!0}})],Uf.prototype,"breakCount",void 0),u([p({json:{write:!0}})],Uf.prototype,"classificationField",void 0),u([p({type:String,json:{read:dve.read,write:dve.write}})],Uf.prototype,"classificationMethod",void 0),u([p({json:{write:!0}})],Uf.prototype,"normalizationField",void 0),u([p({json:{read:pve.read,write:pve.write}})],Uf.prototype,"normalizationType",void 0),u([p({value:null,json:{write:!0}})],Uf.prototype,"standardDeviationInterval",null),u([p({value:null,json:{write:!0}})],Uf.prototype,"definedInterval",null),Uf=u([N("esri.rest.support.ClassBreaksDefinition")],Uf);const XUt=Uf,ZUt=le.getLogger("esri.rest.support.generateRendererUtils");function nC(t,e){return Number(t.toFixed(e))}function JUt(t){const{normalizationTotal:e}=t;return{classBreaks:KUt(t),normalizationTotal:e}}function KUt(t){const e=t.definition,{classificationMethod:i,normalizationType:r,definedInterval:s}=e,n=e.breakCount??1,o=[];let a=t.values;if(a.length===0)return[];a=a.sort((h,d)=>h-d);const l=a[0],c=a[a.length-1];if(i==="equal-interval")if(a.length>=n){const h=(c-l)/n;let d=l;for(let f=1;f<n;f++){const m=nC(l+f*h,6);o.push({minValue:d,maxValue:m,label:Eu(d,m,r)}),d=m}o.push({minValue:d,maxValue:c,label:Eu(d,c,r)})}else a.forEach(h=>{o.push({minValue:h,maxValue:h,label:Eu(h,h,r)})});else if(i==="natural-breaks"){const h=QUt(a),d=t.valueFrequency||h.valueFrequency,f=e9t(h.uniqueValues,d,n);let m=l;for(let g=1;g<n;g++)if(h.uniqueValues.length>g){const y=nC(h.uniqueValues[f[g]],6);o.push({minValue:m,maxValue:y,label:Eu(m,y,r)}),m=y}o.push({minValue:m,maxValue:c,label:Eu(m,c,r)})}else if(i==="quantile")if(a.length>=n&&l!==c){let h=l,d=Math.ceil(a.length/n),f=0;for(let m=1;m<n;m++){let g=d+f-1;g>a.length&&(g=a.length-1),g<0&&(g=0),o.push({minValue:h,maxValue:a[g],label:Eu(h,a[g],r)}),h=a[g],f+=d,d=Math.ceil((a.length-f)/(n-m))}o.push({minValue:h,maxValue:c,label:Eu(h,c,r)})}else{let h=-1;for(let d=0;d<a.length;d++){const f=a[d];f!==h&&(h=f,o.push({minValue:h,maxValue:f,label:Eu(h,f,r)}),h=f)}}else if(i==="standard-deviation"){const h=r9t(a),d=s9t(a,h);if(d===0)o.push({minValue:a[0],maxValue:a[0],label:Eu(a[0],a[0],r)});else{const f=i9t(l,c,n,h,d)*d;let m=0,g=l;for(let v=n;v>=1;v--){const x=nC(h-(v-.5)*f,6);o.push({minValue:g,maxValue:x,label:Eu(g,x,r)}),g=x,m++}let y=nC(h+.5*f,6);o.push({minValue:g,maxValue:y,label:Eu(g,y,r)}),g=y,m++;for(let v=1;v<=n;v++)y=m===2*n?c:nC(h+(v+.5)*f,6),o.push({minValue:g,maxValue:y,label:Eu(g,y,r)}),g=y,m++}}else if(i==="defined-interval"){if(!s)return o;const h=a[0],d=a[a.length-1],f=Math.ceil((d-h)/s);let m=h;for(let g=1;g<f;g++){const y=nC(h+g*s,6);o.push({minValue:m,maxValue:y,label:Eu(m,y,r)}),m=y}o.push({minValue:m,maxValue:d,label:Eu(m,d,r)})}return o}function Eu(t,e,i){let r=null;return r=t===e?i&&i==="percent-of-total"?t+"%":t.toString():i&&i==="percent-of-total"?t+"% - "+e+"%":t+" - "+e,r}function QUt(t){const e=[],i=[];let r=Number.MIN_VALUE,s=1,n=-1;for(let o=0;o<t.length;o++){const a=t[o];a===r?(s++,i[n]=s):a!==null&&(e.push(a),r=a,s=1,i.push(s),n++)}return{uniqueValues:e,valueFrequency:i}}function e9t(t,e,i){const r=t.length,s=[];i>r&&(i=r);for(let o=0;o<i;o++)s.push(Math.round(o*r/i-1));s.push(r-1);let n=fve(s,t,e,i);return t9t(n.mean,n.sdcm,s,t,e,i)&&(n=fve(s,t,e,i)),s}function fve(t,e,i,r){let s=[],n=[],o=[],a=0;const l=[],c=[];for(let m=0;m<r;m++){const g=DM(m,t,e,i);l.push(g.sbMean),c.push(g.sbSdcm),a+=c[m]}let h,d=a,f=!0;for(;f||a<d;){f=!1,s=[];for(let m=0;m<r;m++)s.push(t[m]);for(let m=0;m<r;m++)for(let g=t[m]+1;g<=t[m+1];g++)if(h=e[g],m>0&&g!==t[m+1]&&Math.abs(h-l[m])>Math.abs(h-l[m-1]))t[m]=g;else if(m<r-1&&t[m]!==g-1&&Math.abs(h-l[m])>Math.abs(h-l[m+1])){t[m+1]=g-1;break}d=a,a=0,n=[],o=[];for(let m=0;m<r;m++){n.push(l[m]),o.push(c[m]);const g=DM(m,t,e,i);l[m]=g.sbMean,c[m]=g.sbSdcm,a+=c[m]}}if(a>d){for(let m=0;m<r;m++)t[m]=s[m],l[m]=n[m],c[m]=o[m];a=d}return{mean:l,sdcm:c}}function t9t(t,e,i,r,s,n){let o=0,a=0,l=0,c=0,h=!0;for(let d=0;d<2&&h;d++){d===0&&(h=!1);for(let f=0;f<n-1;f++)for(;i[f+1]+1!==i[f+2];){i[f+1]=i[f+1]+1;const m=DM(f,i,r,s);l=m.sbMean,o=m.sbSdcm;const g=DM(f+1,i,r,s);if(c=g.sbMean,a=g.sbSdcm,!(o+a<e[f]+e[f+1])){i[f+1]=i[f+1]-1;break}e[f]=o,e[f+1]=a,t[f]=l,t[f+1]=c,h=!0}for(let f=n-1;f>0;f--)for(;i[f]!==i[f-1]+1;){i[f]=i[f]-1;const m=DM(f-1,i,r,s);l=m.sbMean,o=m.sbSdcm;const g=DM(f,i,r,s);if(c=g.sbMean,a=g.sbSdcm,!(o+a<e[f-1]+e[f])){i[f]=i[f]+1;break}e[f-1]=o,e[f]=a,t[f-1]=l,t[f]=c,h=!0}}return h}function i9t(t,e,i,r,s){let n=Math.max(r-t,e-r)/s/i;return n=n>=1?1:n>=.5?.5:.25,n}function r9t(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];return e/=t.length,e}function s9t(t,e){let i=0;for(let r=0;r<t.length;r++){const s=t[r];i+=(s-e)*(s-e)}return i/=t.length,Math.sqrt(i)}function DM(t,e,i,r){let s=0,n=0;for(let l=e[t]+1;l<=e[t+1];l++){const c=r[l];s+=i[l]*c,n+=c}n<=0&&ZUt.warn("Exception in Natural Breaks calculation");const o=s/n;let a=0;for(let l=e[t]+1;l<=e[t+1];l++)a+=r[l]*(i[l]-o)**2;return{sbMean:o,sbSdcm:a}}const n9t="<Null>",o9t="equal-interval",a9t=1,l9t=5,c9t=10,u9t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,mve=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),h9t=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function lb(t){return t==null||typeof t=="string"&&!t?n9t:t}function F5e(t){const e=t.normalizationField!=null||t.normalizationType!=null,i=t.minValue!=null||t.maxValue!=null,r=!!t.sqlExpression&&t.supportsSQLExpression;return!e&&!i&&!r}function gve(t){const e=t.returnDistinct?[...new Set(t.values)]:t.values,i=e.filter(s=>s!=null).length,r={count:i};return t.supportsNullCount&&(r.nullcount=e.length-i),t.percentileParams&&(r.median=coe(e,t.percentileParams)),r}function UQ(t){const{values:e,useSampleStdDev:i,supportsNullCount:r}=t;let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=null,a=null,l=null,c=null,h=0;const d=t.minValue==null?-1/0:t.minValue,f=t.maxValue==null?1/0:t.maxValue;for(const g of e)Number.isFinite(g)?g>=d&&g<=f&&(o=o===null?g:o+g,s=Math.min(s,g),n=Math.max(n,g),h++):typeof g=="string"&&h++;if(h&&o!=null){a=o/h;let g=0;for(const y of e)Number.isFinite(y)&&y>=d&&y<=f&&(g+=(y-a)**2);c=i?h>1?g/(h-1):0:h>0?g/h:0,l=Math.sqrt(c)}else s=null,n=null;const m={avg:a,count:h,max:n,min:s,stddev:l,sum:o,variance:c};return r&&(m.nullcount=e.length-h),t.percentileParams&&(m.median=coe(e,t.percentileParams)),m}function coe(t,e){const{fieldType:i,value:r,orderBy:s,isDiscrete:n}=e,o=U5e(i,s==="desc");if((t=[...t].filter(m=>m!=null).sort((m,g)=>o(m,g))).length===0)return null;if(r<=0)return t[0];if(r>=1)return t[t.length-1];const a=(t.length-1)*r,l=Math.floor(a),c=l+1,h=a%1,d=t[l],f=t[c];return c>=t.length||n||typeof d=="string"||typeof f=="string"?d:d*(1-h)+f*h}function U5e(t,e){const i=e?1:-1,r=d9t(e),s=yve(e);if(!(t&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...mve].includes(t)))return(n,o)=>typeof n=="number"&&typeof o=="number"?r(n,o):typeof n=="string"&&typeof o=="string"?s(n,o):i;if(t==="esriFieldTypeDate")return(n,o)=>{const a=new Date(n).getTime(),l=new Date(o).getTime();return isNaN(a)||isNaN(l)?i:r(a,l)};if(mve.has(t))return(n,o)=>r(n,o);if(t==="esriFieldTypeString")return(n,o)=>s(n,o);if(t==="esriFieldTypeGUID"||t==="esriFieldTypeGlobalID"){const n=yve(e);return(o,a)=>n(_ve(o),_ve(a))}return e?(n,o)=>1:(n,o)=>-1}function mk(t,e,i){if(i){if(t==null)return e==null?0:1;if(e==null)return-1}else{if(t==null)return e==null?0:-1;if(e==null)return 1}return null}function yve(t){return t?(e,i)=>{const r=mk(e,i,!0);return r??((e=e.toUpperCase())>(i=i.toUpperCase())?-1:e<i?1:0)}:(e,i)=>{const r=mk(e,i,!1);return r??((e=e.toUpperCase())<(i=i.toUpperCase())?-1:e>i?1:0)}}function d9t(t){return t?(e,i)=>{const r=mk(e,i,!0);return r??i-e}:(e,i)=>{const r=mk(e,i,!1);return r??e-i}}function _ve(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function p9t(t,e){let i;for(i in t)h9t.includes(i)&&(Number.isFinite(t[i])||(t[i]=null));return e&&["avg","stddev","variance"].forEach(r=>{t[r]!=null&&(t[r]=Math.ceil(t[r]))}),t}function f9t(t){const e={};for(let i of t)(i==null||typeof i=="string"&&i.trim()==="")&&(i=null),e[i]==null?e[i]={count:1,data:i}:e[i].count++;return{count:e}}function WH(t){return(t==null?void 0:t.type)!=="coded-value"?[]:t.codedValues.map(e=>e.code)}function m9t(t,e,i,r){const s=t.count,n=[];if(i&&e){const o=[],a=WH(e[0]);for(const l of a)if(e[1]){const c=WH(e[1]);for(const h of c)if(e[2]){const d=WH(e[2]);for(const f of d)o.push(`${lb(l)}${r}${lb(h)}${r}${lb(f)}`)}else o.push(`${lb(l)}${r}${lb(h)}`)}else o.push(l);for(const l of o)s.hasOwnProperty(l)||(s[l]={data:l,count:0})}for(const o in s){const a=s[o];n.push({value:a.data,count:a.count,label:a.label})}return{uniqueValueInfos:n}}function g9t(t,e,i,r){let s=null;switch(e){case"log":t!==0&&(s=Math.log(t)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(r)&&r!==0&&(s=t/r*100);break;case"field":Number.isFinite(i)&&i!==0&&(s=t/i);break;case"natural-log":t>0&&(s=Math.log(t));break;case"square-root":t>0&&(s=t**.5)}return s}function k5e(t,e){const i=_9t({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||l9t});return t=y9t(t,e.minValue,e.maxValue),JUt({definition:i,values:t,normalizationTotal:e.normalizationTotal})}function y9t(t,e,i){const r=e??-1/0,s=i??1/0;return t.filter(n=>Number.isFinite(n)&&n>=r&&n<=s)}function _9t(t){const{breakCount:e,field:i,normalizationField:r,normalizationType:s}=t,n=t.classificationMethod||o9t,o=n==="standard-deviation"?t.standardDeviationInterval||a9t:void 0;return new XUt({breakCount:e,classificationField:i,classificationMethod:n,normalizationField:s==="field"?r:void 0,normalizationType:s,standardDeviationInterval:o})}function v9t(t,e){let i=t.classBreaks;const r=i.length,s=i[0].minValue,n=i[r-1].maxValue,o=e==="standard-deviation",a=u9t;return i=i.map(l=>{var d;const c=l.label,h={minValue:l.minValue,maxValue:l.maxValue,label:c};if(o&&c){const f=((d=c.match(a))==null?void 0:d.map(m=>+m.trim()))??[];f.length===2?(h.minStdDev=f[0],h.maxStdDev=f[1],f[0]<0&&f[1]>0&&(h.hasAvg=!0)):f.length===1&&(c.includes("<")?(h.minStdDev=null,h.maxStdDev=f[0]):c.includes(">")&&(h.minStdDev=f[0],h.maxStdDev=null))}return h}),{minValue:s,maxValue:n,classBreakInfos:i,normalizationTotal:t.normalizationTotal}}function b9t(t,e){const i=w9t(t,e),r=i.intervals,s=i.min??0,n=i.max??0,o=r.map((a,l)=>({minValue:r[l][0],maxValue:r[l][1],count:0}));for(const a of t)if(a!=null&&a>=s&&a<=n){const l=x9t(r,a);l>-1&&o[l].count++}return{bins:o,minValue:s,maxValue:n,normalizationTotal:e.normalizationTotal}}function w9t(t,e){const{field:i,classificationMethod:r,standardDeviationInterval:s,normalizationType:n,normalizationField:o,normalizationTotal:a,minValue:l,maxValue:c}=e,h=e.numBins||c9t;let d=null,f=null,m=null;if((!r||r==="equal-interval")&&!n){if(l!=null&&c!=null)d=l,f=c;else{const g=UQ({values:t,minValue:l,maxValue:c,useSampleStdDev:!n,supportsNullCount:F5e({normalizationType:n,normalizationField:o,minValue:l,maxValue:c})});d=g.min??null,f=g.max??null}m=T9t(d??0,f??0,h)}else{const{classBreaks:g}=k5e(t,{field:i,normalizationType:n,normalizationField:o,normalizationTotal:a,classificationMethod:r,standardDeviationInterval:s,minValue:l,maxValue:c,numClasses:h});d=g[0].minValue,f=g[g.length-1].maxValue,m=g.map(y=>[y.minValue,y.maxValue])}return{min:d,max:f,intervals:m}}function x9t(t,e){let i=-1;for(let r=t.length-1;r>=0;r--)if(e>=t[r][0]){i=r;break}return i}function T9t(t,e,i){const r=(e-t)/i,s=[];let n,o=t;for(let a=1;a<=i;a++)n=o+r,n=Number(n.toFixed(16)),s.push([o,a===i?e:n]),o=n;return s}let p5=class{constructor(e,i,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=i;const s=e.outFields;if(s&&!s.includes("*")){this.outFields=s;let n=0;for(const o of s){const a=N5e(o),l=this.fieldsIndex.get(a),c=l?null:pI(a,r),h=l?l.name:YUt(o)||"FIELD_EXP_"+n++;this._fieldDataCache.set(o,{alias:h,clause:c})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):e.length}getAttributes(e){const i=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(i)}getFieldValue(e,i,r){var o;const s=r?r.name:i;let n=null;return this._fieldDataCache.has(s)?n=(o=this._fieldDataCache.get(s))==null?void 0:o.clause:r||(n=pI(i,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:n})),r?this.featureAdapter.getAttribute(e,s):n==null?void 0:n.calculateValue(e,this.featureAdapter)}getDataValue(e,i){const r=i.normalizationType,s=i.normalizationTotal;let n=i.field&&this.getFieldValue(e,i.field,this.fieldsIndex.get(i.field));if(i.field2&&(n=`${lb(n)}${i.fieldDelimiter}${lb(this.getFieldValue(e,i.field2,this.fieldsIndex.get(i.field2)))}`,i.field3&&(n=`${n}${i.fieldDelimiter}${lb(this.getFieldValue(e,i.field3,this.fieldsIndex.get(i.field3)))}`)),r&&Number.isFinite(n)){const o=r==="field"&&i.normalizationField?this.getFieldValue(e,i.normalizationField,this.fieldsIndex.get(i.normalizationField)):null;n=g9t(n,r,o,s)}return n}getExpressionValue(e,i,r,s){const n={attributes:this.featureAdapter.getAttributes(e),layer:{fields:this.fieldsIndex.fields}},o=s.createExecContext(n,r);return s.executeFunction(i,o)}getExpressionValues(e,i,r,s){const n={fields:this.fieldsIndex.fields};return e.map(o=>{const a={attributes:this.featureAdapter.getAttributes(o),layer:n},l=s.createExecContext(a,r);return s.executeFunction(i,l)})}validateItem(e,i){var r,s;return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:pI(i,this.fieldsIndex)}),((s=(r=this._fieldDataCache.get(i))==null?void 0:r.clause)==null?void 0:s.testFeature(e,this.featureAdapter))??!1}validateItems(e,i){var r,s;return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:pI(i,this.fieldsIndex)}),((s=(r=this._fieldDataCache.get(i))==null?void 0:r.clause)==null?void 0:s.testSet(e,this.featureAdapter))??!1}_processAttributesForOutFields(e){const i=this.outFields;if(!i||!i.length)return this.featureAdapter.getAttributes(e);const r={};for(const s of i){const{alias:n,clause:o}=this._fieldDataCache.get(s);r[n]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,n)}return r}_processAttributesForDistinctValues(e){if(A(e)||!this.returnDistinctValues)return e;const i=this.outFields,r=[];if(i)for(const o of i){const{alias:a}=this._fieldDataCache.get(o);r.push(e[a])}else for(const o in e)r.push(e[o]);const s=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++n),n>1?null:e}};const V5e={convertToGEGeometry:S9t,exportPoint:C9t,exportPolygon:A9t,exportPolyline:R9t,exportMultipoint:I9t,exportExtent:L9t};function S9t(t,e){return e==null?null:t.convertJSONToGeometry(e)}let E9t=class{constructor(e,i,r){this.x=e,this.y=i,this.spatialReference=r,this.z=void 0,this.m=void 0}};function C9t(t,e,i){const r=new E9t(t.getPointX(e),t.getPointY(e),i),s=t.hasZ(e),n=t.hasM(e);return s&&(r.z=t.getPointZ(e)),n&&(r.m=t.getPointM(e)),r}class M9t{constructor(e,i,r,s){this.rings=e,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function A9t(t,e,i){return new M9t(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))}let O9t=class{constructor(e,i,r,s){this.paths=e,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}};function R9t(t,e,i){return new O9t(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))}let P9t=class{constructor(e,i,r,s){this.points=e,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}};function I9t(t,e,i){return new P9t(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))}let $9t=class{constructor(e,i,r,s,n){this.xmin=e,this.ymin=i,this.xmax=r,this.ymax=s,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}};function L9t(t,e,i){const r=t.hasZ(e),s=t.hasM(e),n=new $9t(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(r){const o=t.getZExtent(e);n.zmin=o.vmin,n.zmax=o.vmax}if(s){const o=t.getMExtent(e);n.mmin=o.vmin,n.mmax=o.vmax}return n}const YH=[0,0];function z5e(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,YH),e.z!=null&&(i.z=e.z),e.m!=null&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,YH),[i.xmax,i.ymax]=t(e.xmax,e.ymax,YH),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:vve(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:vve(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:B5e(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:null}function vve(t,e){const i=[];for(const r of t)i.push(B5e(r,e));return i}function B5e(t,e){const i=[];for(const r of t){const s=e(r[0],r[1],[0,0]);i.push(s),r.length>2&&s.push(r[2]),r.length>3&&s.push(r[3])}return i}async function G5e(t,e){if(!t||!e)return;const i=Array.isArray(t)?t.map(r=>b(r.geometry)?r.geometry.spatialReference:null).filter(b):[t];await Vte(i.map(r=>({source:r,dest:e})))}const j5e=z5e.bind(null,QT),H5e=z5e.bind(null,GM);function gk(t,e,i,r){if(!t||(i||(i=e,e=t.spatialReference),!Vo(e)||!Vo(i)||us(e,i)))return t;if(uy(e,i)){const s=xy(i)?j5e(t):H5e(t);return s.spatialReference=i,s}return CU(V5e,[t],e,i,null,r)[0]}let D9t=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,i,r){if(!e||!e.length||!i||!r||us(i,r))return e;const s={geometries:e,inSpatialReference:i,outSpatialReference:r,resolve:null};return this._jobs.push(s),new Promise(n=>{s.resolve=n,this._timer===null&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:i,inSpatialReference:r,outSpatialReference:s,resolve:n}=e;uy(r,s)?xy(s)?n(i.map(j5e)):n(i.map(H5e)):n(CU(V5e,i,r,s,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};const N9t=new D9t;function Lli(t,e,i){return N9t.push(t,e,i)}const F9t=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),bve=Object.freeze({}),wve=new dh,U9t=new dh,kQ=new dh,y0={esriGeometryPoint:hX,esriGeometryPolyline:bie,esriGeometryPolygon:wie,esriGeometryMultipoint:vie};function xve(t,e,i,r=t.hasZ,s=t.hasM){if(A(e))return null;const n=t.hasZ&&r,o=t.hasM&&s;if(i){const a=k$(kQ,e,t.hasZ,t.hasM,"esriGeometryPoint",i,r,s);return hX(a,n,o)}return hX(e,n,o)}function XH(t,e,i,r,s,n,o=e,a=i){var d,f,m;const l=e&&o,c=i&&a,h=b(r)?"coords"in r?r:r.geometry:null;if(A(h))return null;if(s){let g=ant(U9t,h,e,i,t,s,o,a);return n&&(g=k$(kQ,g,l,c,t,n)),((d=y0[t])==null?void 0:d.call(y0,g,l,c))??null}if(n){const g=k$(kQ,h,e,i,t,n,o,a);return((f=y0[t])==null?void 0:f.call(y0,g,l,c))??null}return cnt(wve,h,e,i,o,a),((m=y0[t])==null?void 0:m.call(y0,wve,l,c))??null}async function Dli(t,e,i){const{outFields:r,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:o}=t;if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),k9t(t,e,i)}async function k9t(t,e,i){var n;if(!t)return null;let{where:r}=t;if(t.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||e&&e===r)&&(t.where=null),!t.geometry)return t;let s=await z9t(t);if(t.distance=0,t.units=null,t.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:o}=t.geometry;s=Zq(s),s.spatialReference=o}if(s){await G5e(s.spatialReference,i),s=V9t(s,i);const o=(await TV(Mm(s)))[0];if(A(o))throw bve;const a="quantizationParameters"in t&&((n=t.quantizationParameters)==null?void 0:n.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,l=a&&q5e(s,i)?{densificationStep:8*a}:void 0,c=o.toJSON(),h=await gk(c,c.spatialReference,i,l);if(!h)throw bve;h.spatialReference=i,t.geometry=h}return t}function q5e(t,e){if(!t)return!1;const i=t.spatialReference;return(XL(t)||v_(t)||ZL(t))&&!us(i,e)&&!Bp(i,e)}function V9t(t,e){const i=t.spatialReference;return q5e(t,e)&&XL(t)?{spatialReference:i,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}async function z9t(t){const{distance:e,units:i}=t,r=t.geometry;if(e==null||"vertexAttributes"in r)return r;const s=r.spatialReference,n=i?F9t.fromJSON(i):v3(s),o=s&&(Dk(s)||xy(s))?r:await G5e(s,Dq).then(()=>gk(r,Dq));return(await B9t())(o.spatialReference,o,e,n)}async function B9t(){return(await se(()=>import("./geometryEngineJSON-e7570b2b.js"),["assets/geometryEngineJSON-e7570b2b.js","assets/geometryEngineBase-e1a33b0a.js","assets/geometryEngineJSON-0cf11512.js"])).geodesicBuffer}function ZH(t){return t&&W5e in t?JSON.parse(JSON.stringify(t,G9t)):t}const W5e="_geVersion",G9t=(t,e)=>t!==W5e?e:void 0;let Nli=class{constructor(e,i,r){this.items=e,this.query=i,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new p5(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:r,outStatistics:s}=this.query;if(!(i==null?void 0:i.length))return 1;const o=new Map,a=new Map,l=new Set;for(const c of s){const{statisticType:h}=c,d=h!=="exceedslimit"?c.onStatisticField:void 0;if(!a.has(d)){const m=[];for(const g of i){const y=this._getAttributeValues(e,g,o);m.push(y)}a.set(d,this._calculateUniqueValues(m,e.returnDistinctValues))}const f=a.get(d);for(const m in f){const{data:g,items:y}=f[m],v=g.join(",");r&&!e.validateItems(y,r)||l.add(v)}}return l.size}async createQueryResponse(){let e;if(this.query.outStatistics?e=this.query.outStatistics.some(i=>i.statisticType==="exceedslimit")?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):e=this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const i=this.query.geometry;Vo(this.query.outSR)&&!us(i.spatialReference,this.query.outSR)?e.queryGeometry=ZH({spatialReference:this.query.outSR,...gk(i,i.spatialReference,this.query.outSR)}):e.queryGeometry=ZH({spatialReference:this.query.outSR,...i})}return e}createSnappingResponse(e,i){const r=this.featureAdapter,s=Tve(this.hasZ,this.hasM),{point:n,mode:o}=e,a=typeof e.distance=="number"?e.distance:e.distance.x,l=typeof e.distance=="number"?e.distance:e.distance.y,c={candidates:[]},h=this.geometryType==="esriGeometryPolygon",d=this._getPointCreator(o,this.spatialReference,i),f=new Sve(null,0),m=new Sve(null,0),g={x:0,y:0,z:0};for(const y of this.items){const v=r.getGeometry(y);if(A(v))continue;const{coords:x,lengths:S}=v;if(f.coords=x,m.coords=x,e.types&f3.EDGE){let E=0;for(let C=0;C<S.length;C++){const R=S[C];for(let O=0;O<R;O++,E+=s){const U=f;if(U.coordsIndex=E,O!==R-1){const L=m;L.coordsIndex=E+s;const B=g;j9t(g,n,U,L);const G=(n.x-B.x)/a,j=(n.y-B.y)/l,q=G*G+j*j;q<=1&&c.candidates.push(PK(r.getObjectId(y),d(B),Math.sqrt(q),d(U),d(L)))}}}}if(e.types&f3.VERTEX){const E=h?x.length-s:x.length;for(let C=0;C<E;C+=s){const R=f;R.coordsIndex=C;const O=(n.x-R.x)/a,U=(n.y-R.y)/l,L=O*O+U*U;L<=1&&c.candidates.push(gLe(r.getObjectId(y),d(R),Math.sqrt(L)))}}}return c.candidates.sort((y,v)=>y.distance-v.distance),c}_getPointCreator(e,i,r){const s=b(r)&&!us(i,r)?a=>gk(a,i,r):a=>a,{hasZ:n}=this,o=0;return e==="3d"?n?({x:a,y:l,z:c})=>s({x:a,y:l,z:c}):({x:a,y:l})=>s({x:a,y:l,z:o}):({x:a,y:l})=>s({x:a,y:l})}async createSummaryStatisticsResponse(e){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,minValue:a,maxValue:l,scale:c}=e,h=this.fieldsIndex.isDateField(i),d=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:c}),f=F5e({normalizationType:n,normalizationField:s,minValue:a,maxValue:l}),m=this.fieldsIndex.get(i),g={value:.5,fieldType:m==null?void 0:m.type},y=Dle(m)?gve({values:d,supportsNullCount:f,percentileParams:g}):UQ({values:d,minValue:a,maxValue:l,useSampleStdDev:!n,supportsNullCount:f,percentileParams:g});return p9t(y,h)}async createUniqueValuesResponse(e){const{field:i,valueExpression:r,domains:s,returnAllCodedValues:n,scale:o}=e,a=await this._getDataValues({field:i,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:o}),l=f9t(a);return m9t(l,s,n,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numClasses:d,scale:f}=e,m=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:f}),g=k5e(m,{field:i,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numClasses:d});return v9t(g,a)}async createHistogramResponse(e){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numBins:d,scale:f}=e,m=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:f});return b9t(m,{field:i,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numBins:d})}_sortFeatures(e,i,r){if(e.length>1&&i&&i.length)for(const s of i.reverse()){const n=s.split(" "),o=n[0],a=this.fieldsIndex.get(o),l=!!n[1]&&n[1].toLowerCase()==="desc",c=U5e(a==null?void 0:a.type,l);e.sort((h,d)=>{const f=r(h,o,a),m=r(d,o,a);return c(f,m)})}}_createFeatureQueryResponse(e){const i=this.items,{geometryType:r,hasM:s,hasZ:n,objectIdField:o,spatialReference:a}=this,{outFields:l,outSR:c,quantizationParameters:h,resultRecordCount:d,resultOffset:f,returnZ:m,returnM:g}=e,y=d!=null&&i.length>(f||0)+d,v=l&&(l.includes("*")?[...this.fieldsIndex.fields]:l.map(x=>this.fieldsIndex.get(x)));return{exceededTransferLimit:y,features:this._createFeatures(e,i),fields:v,geometryType:r,hasM:s&&g,hasZ:n&&m,objectIdFieldName:o,spatialReference:ZH(c||a),transform:h&&mme(h)||null}}_createFeatures(e,i){const r=new p5(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:n}=this,{orderByFields:o,quantizationParameters:a,returnGeometry:l,returnCentroid:c,maxAllowableOffset:h,resultOffset:d,resultRecordCount:f,returnZ:m=!1,returnM:g=!1}=e,y=n&&m,v=s&&g;let x=[],S=0;const E=[...i];if(this._sortFeatures(E,o,(R,O,U)=>r.getFieldValue(R,O,U)),l||c){const R=mme(a)??void 0;if(l&&!c)for(const O of E)x[S++]={attributes:r.getAttributes(O),geometry:XH(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),h,R,y,v)};else if(!l&&c)for(const O of E)x[S++]={attributes:r.getAttributes(O),centroid:xve(this,this.featureAdapter.getCentroid(O,this),R)};else for(const O of E)x[S++]={attributes:r.getAttributes(O),centroid:xve(this,this.featureAdapter.getCentroid(O,this),R),geometry:XH(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),h,R,y,v)}}else for(const R of E){const O=r.getAttributes(R);O&&(x[S++]={attributes:O})}const C=d||0;if(f!=null){const R=C+f;x=x.slice(C,Math.min(x.length,R))}return x}_createExceedsLimitQueryResponse(e){let i=!1,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const o of e.outStatistics??[])if(o.statisticType==="exceedslimit"){r=o.maxPointCount!=null?o.maxPointCount:Number.POSITIVE_INFINITY,s=o.maxRecordCount!=null?o.maxRecordCount:Number.POSITIVE_INFINITY,n=o.maxVertexCount!=null?o.maxVertexCount:Number.POSITIVE_INFINITY;break}if(this.geometryType==="esriGeometryPoint")i=this.items.length>r;else if(this.items.length>s)i=!0;else{const o=Tve(this.hasZ,this.hasM),a=this.featureAdapter;i=this.items.reduce((l,c)=>{const h=a.getGeometry(c);return l+(b(h)&&h.coords.length||0)},0)/o>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}async _createStatisticsQueryResponse(e){const i={attributes:{}},r=[],s=new Map,n=new Map,o=new Map,a=new Map,l=new p5(e,this.featureAdapter,this.fieldsIndex),c=e.outStatistics,{groupByFieldsForStatistics:h,having:d,orderByFields:f}=e,m=h&&h.length,g=!!m,y=g?h[0]:null,v=g&&!this.fieldsIndex.get(y);for(const S of c??[]){const{outStatisticFieldName:E,statisticType:C}=S,R=S,O=C!=="exceedslimit"?S.onStatisticField:void 0,U=C==="percentile_disc"||C==="percentile_cont",L=C==="EnvelopeAggregate"||C==="CentroidAggregate"||C==="ConvexHullAggregate",B=g&&m===1&&(O===y||v)&&C==="count";if(g){if(!o.has(O)){const j=[];for(const q of h){const ie=this._getAttributeValues(l,q,s);j.push(ie)}o.set(O,this._calculateUniqueValues(j,!L&&l.returnDistinctValues))}const G=o.get(O);for(const j in G){const{count:q,data:ie,items:ee,itemPositions:K}=G[j],Y=ie.join(",");if(!d||l.validateItems(ee,d)){const D=a.get(Y)||{attributes:{}};if(L){D.aggregateGeometries||(D.aggregateGeometries={});const{aggregateGeometries:k,outStatisticFieldName:Z}=await this._getAggregateGeometry(R,ee);D.aggregateGeometries[Z]=k}else{let k=null;if(B)k=q;else{const Z=this._getAttributeValues(l,O,s),Q=K.map(ne=>Z[ne]);k=U&&"statisticParameters"in R?this._getPercentileValue(R,Q):this._getStatisticValue(R,Q,null,l.returnDistinctValues)}D.attributes[E]=k}let V=0;h.forEach((k,Z)=>D.attributes[this.fieldsIndex.get(k)?k:"EXPR_"+ ++V]=ie[Z]),a.set(Y,D)}}}else if(L){i.aggregateGeometries||(i.aggregateGeometries={});const{aggregateGeometries:G,outStatisticFieldName:j}=await this._getAggregateGeometry(R,this.items);i.aggregateGeometries[j]=G}else{const G=this._getAttributeValues(l,O,s);i.attributes[E]=U&&"statisticParameters"in R?this._getPercentileValue(R,G):this._getStatisticValue(R,G,n,l.returnDistinctValues)}r.push({name:E,alias:E,type:"esriFieldTypeDouble"})}const x=g?Array.from(a.values()):[i];return this._sortFeatures(x,f,(S,E)=>S.attributes[E]),{fields:r,features:x}}async _getAggregateGeometry(e,i){const r=await se(()=>import("./geometryEngineJSON-e7570b2b.js"),["assets/geometryEngineJSON-e7570b2b.js","assets/geometryEngineBase-e1a33b0a.js","assets/geometryEngineJSON-0cf11512.js"]),{statisticType:s,outStatisticFieldName:n}=e,{featureAdapter:o,spatialReference:a,geometryType:l,hasZ:c,hasM:h}=this,d=i.map(g=>XH(l,c,h,o.getGeometry(g))),f=r.convexHull(a,d,!0)[0],m={aggregateGeometries:null,outStatisticFieldName:null};if(s==="EnvelopeAggregate"){const g=f?lte(f):Zq(r.union(a,d));m.aggregateGeometries={...g,spatialReference:a},m.outStatisticFieldName=n||"extent"}else if(s==="CentroidAggregate"){const g=f?exe(f):rXe(Zq(r.union(a,d)));m.aggregateGeometries={x:g[0],y:g[1],spatialReference:a},m.outStatisticFieldName=n||"centroid"}else s==="ConvexHullAggregate"&&(m.aggregateGeometries=f,m.outStatisticFieldName=n||"convexHull");return m}_getStatisticValue(e,i,r,s){const{onStatisticField:n,statisticType:o}=e;let a=null;return a=r!=null&&r.has(n)?r.get(n):Dle(this.fieldsIndex.get(n))?gve({values:i,returnDistinct:s}):UQ({values:s?[...new Set(i)]:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,a),a[o==="var"?"variance":o]}_getPercentileValue(e,i){const{onStatisticField:r,statisticParameters:s,statisticType:n}=e,{value:o,orderBy:a}=s,l=this.fieldsIndex.get(r);return coe(i,{value:o,orderBy:a,fieldType:l==null?void 0:l.type,isDiscrete:n==="percentile_disc"})}_getAttributeValues(e,i,r){if(r.has(i))return r.get(i);const s=this.fieldsIndex.get(i),n=this.items.map(o=>e.getFieldValue(o,i,s));return r.set(i,n),n}_getAttributeDataValues(e,i){return this.items.map(r=>e.getDataValue(r,{field:i.field,field2:i.field2,field3:i.field3,fieldDelimiter:i.fieldDelimiter,normalizationField:i.normalizationField,normalizationType:i.normalizationType,normalizationTotal:i.normalizationTotal}))}async _getAttributeExpressionValues(e,i,r){const{arcadeUtils:s}=await Am(),n=s.createFunction(i),o=r&&s.getViewInfo(r);return e.getExpressionValues(this.items,n,o,s)}_calculateUniqueValues(e,i){const r={},s=this.items,n=s.length;for(let o=0;o<n;o++){const a=s[o],l=[];for(const h of e)l.push(h[o]);const c=l.join(",");r[c]==null?r[c]={count:1,data:l,items:[a],itemPositions:[o]}:(i||r[c].count++,r[c].items.push(a),r[c].itemPositions.push(o))}return r}async _getDataValues(e){const i=new p5(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:r,field:s,normalizationField:n,normalizationType:o,normalizationTotal:a,scale:l}=e,c=r?{viewingMode:"map",scale:l,spatialReference:this.query.outSR||this.spatialReference}:null;return r?this._getAttributeExpressionValues(i,r,c):this._getAttributeDataValues(i,{field:s,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,normalizationField:n,normalizationType:o,normalizationTotal:a})}};function j9t(t,e,i,r){const s=r.x-i.x,n=r.y-i.y,o=s*s+n*n,a=(e.x-i.x)*s+(e.y-i.y)*n,l=Math.min(1,Math.max(0,a/o));t.x=i.x+s*l,t.y=i.y+n*l}function Tve(t,e){return t?e?4:3:e?3:2}var f3;(function(t){t[t.NONE=0]="NONE",t[t.EDGE=1]="EDGE",t[t.VERTEX=2]="VERTEX"})(f3||(f3={}));let Sve=class{constructor(e,i){this.coords=e,this.coordsIndex=i}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}};function kli(t){return t}function Y5e(t){return zr(t)}function Vli(t,e,i){return Ve(t,e,i)}function bn(t,e,i){return A(t)?null:fI(i.coordinateHelper.vectorToDehydratedPoint(t,H9t),e,i)}function fI(t,e,i){if(A(t))return null;if(A(e))return Ve(t.x,t.y,t.z??0);if(e.type==="2d")return Ve(t.x,t.y,0);const{elevationInfo:r}=i,s=bUt(e,t,r,Go)??0;return Ve(t.x,t.y,s)}function Eve(t,e,{z:i,m:r,spatialReference:s,elevationInfo:n}){if(i==null&&r==null){const l=bc(t[0],t[1],void 0,s);return r!=null&&(l.m=r,l.hasM=!0),l}if(A(e)||e.type==="2d"){const l=bc(t[0],t[1],i,s);return r!=null&&(l.m=r,l.hasM=!0),l}const o=u5e(e,t,s,Go,n)??0,a=bc(t[0],t[1],o,s);return r!=null&&(a.m=r,a.hasM=!0),a}function zli(t,e){return bc(t[0],t[1],t[2],e)}const H9t=bc(0,0,0,null);function JH(t,e){return t[0]*e[1]-t[1]*e[0]}function q9t(t,e,i){const r=Us(i,e)/tw(i);return tl(t,i,r)}function KH(t,e,i,r,s=i){return Bs(yA,r,i),Bs(VQ,e,s),q9t(yk,VQ,yA),ed(t,s,yk)}function W9t(t,e,i,r){Bs(yA,e,i);const s=r/J2(yA);return x_(t,i,yA,s)}function Bli(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,o=Bs(yA,r,i),a=Bs(X9t,n,s),l=JH(o,a);if(Math.abs(l)<=Y9t)return[];const c=Bs(VQ,i,s),h=JH(a,c)/l,d=JH(o,c)/l;if(h>=0){if(d>=0||e.type===ba.LINE)return[x_(yk,i,o,h)]}else if(t.type===ba.LINE&&(d>=0||e.type===ba.LINE))return[x_(yk,i,o,h)];return[]}var ba;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(ba||(ba={}));const Y9t=1e-6,yA=je(),X9t=je(),VQ=je(),yk=je();function zQ({start:t,end:e,type:i},r,s){const n=[],o=Bs(DS,e,t),a=Bs(aO,t,r),l=tw(o),c=2*Us(o,a),h=c*c-4*l*(tw(a)-s*s);if(h===0){const d=-c/(2*l);(i===bm.PLANE||d>=0)&&n.push(x_(je(),t,o,d))}else if(h>0){const d=Math.sqrt(h),f=(-c+d)/(2*l);(i===bm.PLANE||f>=0)&&n.push(x_(je(),t,o,f));const m=(-c-d)/(2*l);(i===bm.PLANE||m>=0)&&n.push(x_(je(),t,o,m))}return n}function BQ(t,e){const i=t.start,r=t.end,s=Bs(DS,r,i),n=fe(aO,-s[1],s[0],0),o=e.start,a=e.end,l=as(hoe,a,o),c=xe(l,n),h=fe(K5e,i[0],i[1],0),d=as(Q5e,h,o),f=xe(d,n);if(Math.abs(c)<dm)return[];const m=eh(e6e,o,l,f/c);if(e.type===ba.RAY){const g=as(vk,m,o);if(xe(g,l)<-dm)return[]}if(t.type===bm.HALF_PLANE){const g=GV(vk,m,i);if(Us(g,s)<-dm)return[]}return[zr(m)]}function GQ(t,e){return jQ(_k(doe,e[2],t),e)}function X5e(t,e){const r=J5e(_k(doe,0,t),_k(K9t,0,e)),s=[];for(const n of r)s.push(bM(n));return s}function Z5e(t,e){return uoe(t,_k(doe,t[2],e))}function Z9t(t,e,i){const r=Bs(DS,t,e),s=i/J2(r),n=x_($(),e,r,s);return n[2]=t[2],n}function uoe(t,{start:e,end:i,type:r}){const s=as(DS,t,e),n=as(aO,i,e),o=xe(s,n)/xe(n,n);return eh($(),e,n,r===ba.RAY?Math.max(o,0):o)}function Cve({start:t,end:e,type:i},r,s){const n=[],o=be(DS,e,t),a=Bs(aO,t,r),l=tw(o),c=2*Us(o,a),h=c*c-4*l*(tw(a)-s*s);if(h===0){const d=-c/(2*l);(i===ba.LINE||d>=0)&&n.push(eh($(),t,o,d))}else if(h>0){const d=Math.sqrt(h),f=(-c+d)/(2*l);(i===ba.LINE||f>=0)&&n.push(eh($(),t,o,f));const m=(-c-d)/(2*l);(i===ba.LINE||m>=0)&&n.push(eh($(),t,o,m))}return n}function J5e(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,o=as(DS,r,i),a=as(aO,n,s),l=as(hoe,s,i),c=Et(K5e,o,a),h=xe(l,c);if(!__(h,0,dm))return[];const d=MA(c);if(__(d,0,dm))return[];const f=Et(Q5e,l,a),m=xe(f,c)/d,g=eh(e6e,i,o,m);if(t.type===ba.RAY){const y=as(vk,g,i);if(xe(o,y)<-dm)return[]}if(e.type===ba.RAY){const y=as(vk,g,s);if(xe(a,y)<-dm)return[]}return[zr(g)]}function jQ({start:t,end:e,type:i},r){const s=as(DS,r,t),n=as(aO,e,t),o=Et(hoe,n,s);if(MA(o)/MA(n)<dm)switch(i){case ba.LINE:return[zr(r)];case ba.RAY:return xe(n,s)<-dm?[]:[zr(r)]}return[]}function Mve(t,e,i){return __(wd(i,t),e*e,dm)?[zr(i)]:[]}function _k(t,e,{start:i,end:r,type:s}){return fe(t.start,i[0],i[1],e),fe(t.end,r[0],r[1],e),t.type=J9t[s],t}var bm;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(bm||(bm={}));const J9t={[bm.PLANE]:ba.LINE,[bm.HALF_PLANE]:ba.RAY},dm=1e-6,DS=$(),aO=$(),hoe=$(),K5e=$(),Q5e=$(),e6e=$(),vk=$(),doe={start:$(),end:$(),type:ba.LINE},K9t={start:$(),end:$(),type:ba.LINE};let NS=class{intersect(e){return ikt(this,e)}};class Q9t extends NS{constructor(e){super(),this.point=e}equals(e){return NM(e)&&Ur(this.point,e.point)}closestTo(){return Y5e(this.point)}}let t6e=class extends NS{constructor(e,i,r){super(),this.start=e,this.end=i,this.type=r,this.lineLike={start:this.start,end:this.end,type:this.type}}equals(e){return XT(e)&&this.type===e.type&&Ur(this.start,e.start)&&Ur(this.end,e.end)}closestTo(e){const i=uoe(e,this.lineLike);return i}},ekt=class extends t6e{constructor(e,i){super(e,i,ba.LINE)}};class aB extends NS{constructor(e,i,r){super(),this.intersection=e,this.first=i,this.second=r}equals(e){return e instanceof aB&&this.first.equals(e.first)&&this.second.equals(e.second)}closestTo(){return Y5e(this.intersection)}}let QH=class i6e extends NS{constructor(e,i,r){super(),this.basePoint=e,this.first=i,this.second=r}equals(e){return e instanceof i6e&&this.first.equals(e.first)&&this.second.equals(e.second)}closestTo(e){const i=this.basePoint;return Ve(i[0],i[1],e[2])}},r6e=class extends NS{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return FM(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=Z9t(e,this.center,this.radius);return i}},poe=class extends NS{constructor(e,i,r){super(),this.start=e,this.end=i,this.type=r,this.planeLike={start:e,end:i,type:r}}equals(e){return ZT(e)&&this.type===e.type&&Ur(this.start,e.start)&&Ur(this.end,e.end)}closestTo(e){return Z5e(e,this.planeLike)}closestEndTo(e){const{start:i,end:r}=this;return Math.sign(Us(Bs(skt,r,i),Bs(nkt,e,i)))>0?r:i}};class s6e extends poe{constructor(e,i){super(e,i,bm.HALF_PLANE)}}let n6e=class extends poe{constructor(e,i){super(e,i,bm.PLANE)}},o6e=class extends NS{constructor(e,i,r){super(),this.start=e,this.end=i,this.getZ=r,this.planeLike={start:e,end:i,type:bm.HALF_PLANE}}equals(e){return JT(e)&&Ur(this.start,e.start)&&Ur(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return tkt(this,e)}addIfOnTheGround(e,i){for(const r of i){const s=vt(this.getZ(r[0],r[1],r[2]),0);Math.abs(r[2]-s)<dm&&(r[2]=s,e.push(r))}}};function tkt(t,e){const i=Z5e(e,t.planeLike);return i[2]=t.getZ(e[0],e[1],e[2])??a6e,i}function ikt(t,e){let i=[];if(NM(t)){const{point:r}=t;XT(e)?i=jQ(e.lineLike,r):FM(e)?i=Mve(e.center,e.radius,r):ZT(e)?i=GQ(e.planeLike,r):JT(e)&&(i=$R(e,t))}else if(XT(t)){const{lineLike:r}=t;NM(e)?i=jQ(r,e.point):XT(e)?i=J5e(r,e.lineLike):FM(e)?i=Cve(r,e.center,e.radius):ZT(e)?i=BQ(e.planeLike,r):JT(e)&&(i=$R(e,t))}else if(FM(t)){const{center:r,radius:s}=t;if(XT(e))i=Cve(e.lineLike,r,s);else if(NM(e))i=Mve(r,s,e.point);else{if(ZT(e))return zQ(e.planeLike,r,s).map(n=>new QH(n,t,e));JT(e)&&(i=$R(e,t))}}else if(ZT(t)){const{planeLike:r}=t;if(ZT(e))return X5e(r,e.planeLike).map(s=>new QH(s,t,e));if(NM(e))i=GQ(r,e.point);else if(XT(e))i=BQ(r,e.lineLike);else{if(FM(e))return zQ(r,e.center,e.radius).map(s=>new QH(s,t,e));JT(e)&&(i=$R(e,t))}}else JT(t)&&(i=$R(t,e));return rkt(i,t,e)}function $R(t,e){const{planeLike:i,getZ:r}=t,s=[];if(NM(e))t.addIfOnTheGround(s,GQ(i,e.point));else if(XT(e))t.addIfOnTheGround(s,BQ(i,e.lineLike));else if(FM(e))for(const[n,o]of zQ(i,e.center,e.radius)){const a=r(n,o,0);b(a)&&s.push(Ve(n,o,a))}else if(ZT(e)||JT(e))for(const[n,o]of X5e(i,e.planeLike)){const a=r(n,o,0)??a6e;s.push(Ve(n,o,a))}return s}function rkt(t,e,i){return t.map(r=>new aB(r,e,i))}function NM(t){return t instanceof Q9t}function XT(t){return t instanceof t6e}function FM(t){return t instanceof r6e}function ZT(t){return t instanceof poe}function JT(t){return t instanceof o6e}const skt=je(),nkt=je(),a6e=0;function FS(t,e){const i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function okt(t,e){return Math.sqrt(FS(t,e))}function foe(t,e){e.sort((i,r)=>Eo(i.targetPoint,t)-Eo(r.targetPoint,t))}var Zp;function Zli({point:t,distance:e,types:i,coordinateHelper:{spatialReference:r}},s,n){return{point:bc(t[0],t[1],t[2],r.toJSON()),mode:s,distance:e,types:i,query:b(n)?n.toJSON():{where:"1=1"}}}function bk(t,e,i){return{left:bn(t.leftVertex.pos,e,i),right:bn(t.rightVertex.pos,e,i)}}function Jli(t){return t.createQuery()}function akt(t,e=()=>{}){const i=ae(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:r,snappingOptions:s})=>{const n="snapping-toggle",o=Es.TOOL;if(t.removeHandles(n),r&&b(s)){const a=[r.on("key-down",l=>{l.key!==rve.toggle||l.repeat||(s.enabledToggled=!0,e())},o),r.on("key-up",l=>{l.key===rve.toggle&&(s.enabledToggled=!1,e())},o),r.on("pointer-move",l=>{const c=l.native.ctrlKey;s.enabledToggled!==c&&(s.enabledToggled=c,e())},o)];t.addHandles(a,n)}},Tr);t.addHandles(i)}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Zp||(Zp={}));class lO{constructor(e,i,r,s){this.targetPoint=e,this.constraint=i,this.isDraped=r,this.domain=s}}let moe=class extends lO{constructor({targetPoint:e,objectId:i,constraint:r,isDraped:s}){super(e,r,s,nl.FEATURE),this.objectId=i}},lB=class{constructor(e,i){this.isDraped=e,this.domain=i}},Iy=class l6e extends lB{constructor(e,i,r,s,n=nl.ALL,o=!0,a=!0){super(s,n),this.type=e,this.lineStart=i,this.lineEnd=r,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof l6e&&this.type===e.type&&Ur(this.lineStart,e.lineStart)&&Ur(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Wr(this.lineStart,this.lineEnd)}},lkt=class extends moe{constructor(e){super({...e,isDraped:!0,constraint:new o6e(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new Iy(Zp.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ckt=class extends moe{constructor(e){super({...e,constraint:new ekt(e.edgeStart,e.edgeEnd)})}get hints(){return[new Iy(Zp.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},c6e=class u6e extends lB{constructor(e,i,r,s,n=nl.ALL){super(s,n),this.previousVertex=e,this.centerVertex=i,this.nextVertex=r}equals(e){return e instanceof u6e&&Ur(this.previousVertex,e.previousVertex)&&Ur(this.centerVertex,e.centerVertex)&&Ur(this.nextVertex,e.nextVertex)}},h6e=class extends lO{constructor({targetPoint:e,constraint:i,previousVertex:r,otherVertex:s,otherVertexType:n,objectId:o,isDraped:a}){super(e,i,a,nl.SELF),this.previousVertex=r,this.otherVertex=s,this.otherVertexType=n,this.objectId=o}get hints(){const e=this.previousVertex,i=this.otherVertexType===m3.CENTER?this.otherVertex:this.targetPoint,r=this.otherVertexType===m3.CENTER?this.targetPoint:this.otherVertex;return[new Iy(Zp.TARGET,i,r,this.isDraped,this.domain),new Iy(Zp.REFERENCE,e,i,this.isDraped,this.domain),new c6e(this.previousVertex,i,r,this.isDraped,this.domain)]}};var m3;(function(t){t[t.NEXT=0]="NEXT",t[t.CENTER=1]="CENTER"})(m3||(m3={}));function rci(t,e,i,r){i.projectToRenderScreen(t,Ave),i.projectToRenderScreen(e,Ove),Bs(r,Ove,Ave),iw(r,r)}function ukt(t,e,i,r,s=$()){const n=ge(HQ,t);return n[2]=u5e(r,n,e,i)||0,r.renderCoordsHelper.toRenderCoords(n,e,s),s}function xc(t,e,i,r){return r.type==="2d"?(f5.x=t[0],f5.y=t[1],f5.spatialReference=e,r.toScreen(f5)):(ukt(t,e,i,r,HQ),r.state.camera.projectToScreen(HQ,eq),xo(eq[0],eq[1]))}const f5=bc(0,0,0,null),HQ=$(),Ave=ma(),Ove=ma(),eq=zs();let B1=class extends Y2{get updating(){return ua(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,i=new Map;if(b(this.options)&&b(this.options.featureSources))for(const r of this.options.featureSources.items){const s=r.layer.uid,n=e.get(s);if(n){e.delete(s),i.set(s,n);continue}if(!r.layer.loaded){this.updatingHandles.addPromise(r.layer.load());continue}const o=this._createSourceInfo(r);b(o)&&i.set(s,o)}for(const[,r]of e)r.destroy();return i}constructor(e){super(e),this.options=null,this._domain=nl.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),Mi),b(this.view)&&this.handles.add([this.view.on("layerview-create",e=>this._updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this._updateLayerView(e.layer,null))])}_updateLayerView(e,i){for(const[,r]of this.snappingSources)r.snappingSource.layerSource.layer===e&&(r.layerView=i)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,i,r,s){var c;if(!(i&this._domain)||A(this.options)||!this.options.effectiveFeatureEnabled)return[];const n=[],o=this._computeScreenSizeDistanceParameters(e,r),a={distance:o,mode:((c=this.view)==null?void 0:c.type)??"2d",point:e,coordinateHelper:r.coordinateHelper,types:this._types};for(const[,{snappingSource:h,layerView:d}]of this.snappingSources)!h.layerSource.enabled||b(d)&&d.suspended||n.push(h.fetchCandidates(a,s).then(f=>f.filter(m=>!this._candidateIsExcluded(h,m,r.excludeFeature))));const l=(await W8(n)).flat();return this._addRightAngleCandidates(l,e,o,r),_i(s),foe(e,l),l}_addRightAngleCandidates(e,i,r,s){var d,f,m,g,y,v,x,S;const n=b(s.vertexHandle)?(f=(d=s.vertexHandle.rightEdge)==null?void 0:d.rightVertex)==null?void 0:f.pos:b(s.editGeometryOperations)&&s.editGeometryOperations.data.type==="polygon"?(g=(m=s.editGeometryOperations.data.components[0])==null?void 0:m.getFirstVertex())==null?void 0:g.pos:null,o=b(s.vertexHandle)?(v=(y=s.vertexHandle.leftEdge)==null?void 0:y.leftVertex)==null?void 0:v.pos:b(s.editGeometryOperations)?(S=(x=s.editGeometryOperations.data.components[0])==null?void 0:x.getLastVertex())==null?void 0:S.pos:null,{view:a}=this,l=bn(n,a,s),c=bn(o,a,s),h=e.length;for(let E=0;E<h;E++)this._addRightAngleCandidate(e[E],c,i,r,e),this._addRightAngleCandidate(e[E],l,i,r,e)}_addRightAngleCandidate(e,i,r,s,n){if(A(i)||!dkt(e))return;const o=e.constraint.closestTo(i),a=(o[0]-r[0])/s.x,l=(o[1]-r[1])/s.y,{start:c,end:h}=e.constraint;if(a*a+l*l<=1){const d=new h6e({targetPoint:o,otherVertex:i,otherVertexType:m3.NEXT,previousVertex:wd(o,c)>wd(o,h)?c:h,constraint:new s6e(i,o),objectId:e.objectId,isDraped:e.isDraped});n.push(d)}}_computeScreenSizeDistanceParameters(e,i){let r=b(this.options)?this.options.distance*(i.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return A(this.view)?{x:r,y:r,z:r,distance:r}:this.view.type==="2d"?(r*=this.view.resolution,{x:r,y:r,z:r,distance:r}):this._computeScreenSizeDistanceParameters3D(e,r,this.view,i)}_computeScreenSizeDistanceParameters3D(e,i,r,s){const{spatialReference:n}=s;r.renderCoordsHelper.toRenderCoords(e,n,Rve);const o=r.state.camera.computeScreenPixelSizeAt(Rve),a=o*r.renderCoordsHelper.unitInMeters/r.mapCoordsHelper.unitInMeters,l=i*a,c=xc(e,n,Go,r),h=c?tq(c,e,a,0,0,r,s):0,d=c?tq(c,e,0,a,0,r,s):0,f=c?tq(c,e,0,0,a,r,s):0;return{x:h===0?0:l/h,y:d===0?0:l/d,z:f===0?0:l/f,distance:o*i}}get _types(){return f3.EDGE|f3.VERTEX}_candidateIsExcluded(e,i,r){if(A(r))return!1;const s=this._getCandidateObjectId(i);if(A(s))return!1;const n=e.layerSource.layer;return n.type==="graphics"?r.uid===s:r.sourceLayer===n&&!(!r.attributes||!("objectIdField"in n))&&r.attributes[n.objectIdField]===s}_getCandidateObjectId(e){return e instanceof moe?e.objectId:null}_createSourceInfo(e){const i=this._createFeatureSnappingSourceType(e);if(A(i))return null;if("loading"in i)return this.updatingHandles.addPromise(i.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const r=b(this.view)?this.view.allLayerViews.find(s=>s.layer===e.layer):null;return new hkt(i.source,r)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:i}=this;if(A(i)||i.type!=="3d")return null;const r=this._getSourceModule("scene");return b(r.module)?{source:new r.module.SceneLayerSnappingSource({layerSource:e,view:i})}:{loading:r.loader}}_createFeatureSnappingSourceFeatureLayer(e){var i;switch((i=e.layer.source)==null?void 0:i.type){case"feature-layer":case"oriented-imagery":{const r=this._getSourceModule("featureService");return b(r.module)?{source:new r.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:r.loader}}case"memory":case"csv":case"geojson":case"wfs":{if(e.layer.geometryType==="mesh")return null;const r=this._getSourceModule("featureCollection");return b(r.module)?{source:new r.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:r.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const i=this._getSourceModule("graphics");return b(i.module)?{source:new i.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:i.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const i=this._getSourceModule("notes");return b(i.module)?{source:new i.module.GraphicsSnappingSource({getGraphicsLayers:()=>b(e.layer.sublayers)?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:i.loader}}_getSourceModule(e){const i=this._sourceModules[e];if(A(i.loader)){const r=this._loadSourceModule(e).then(s=>{i.module=s});return i.loader=r,{module:i.module,loader:r}}return{module:i.module,loader:i.loader}}_loadSourceModule(e){const i=this.updatingHandles;switch(e){case"featureService":return i.addPromise(se(()=>import("./FeatureServiceSnappingSource-00528245.js"),["assets/FeatureServiceSnappingSource-00528245.js","assets/queryEngineUtils-54fef296.js","assets/VertexSnappingCandidate-dc56a481.js","assets/PointSnappingHint-b85cbba9.js","assets/TileTreeDebugger-6f984adc.js"]));case"featureCollection":return i.addPromise(se(()=>import("./FeatureCollectionSnappingSource-bd14c818.js"),["assets/FeatureCollectionSnappingSource-bd14c818.js","assets/queryEngineUtils-54fef296.js","assets/VertexSnappingCandidate-dc56a481.js","assets/PointSnappingHint-b85cbba9.js","assets/symbologySnappingCandidates-3220e467.js"]));case"graphics":case"notes":return i.addPromise(se(()=>import("./GraphicsSnappingSource-1e4908c0.js"),["assets/GraphicsSnappingSource-1e4908c0.js","assets/normalizeUtilsSync-360fb6bc.js","assets/FeatureStore-d9578d0d.js","assets/BoundsStore-ac96c241.js","assets/PooledRBush-66deaec2.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/QueryEngine-11c9095b.js","assets/timeSupport-5710ecff.js","assets/queryEngineUtils-54fef296.js","assets/VertexSnappingCandidate-dc56a481.js","assets/PointSnappingHint-b85cbba9.js","assets/symbologySnappingCandidates-3220e467.js"]));case"scene":return i.addPromise(se(()=>import("./SceneLayerSnappingSource-86c48481.js"),["assets/SceneLayerSnappingSource-86c48481.js","assets/VertexSnappingCandidate-dc56a481.js","assets/PointSnappingHint-b85cbba9.js"]))}}};u([p({constructOnly:!0})],B1.prototype,"spatialReference",void 0),u([p({constructOnly:!0})],B1.prototype,"view",void 0),u([p()],B1.prototype,"options",void 0),u([p({readOnly:!0})],B1.prototype,"updating",null),u([p({readOnly:!0})],B1.prototype,"snappingSources",null),B1=u([N("esri.views.interactive.snapping.FeatureSnappingEngine")],B1);let hkt=class{constructor(e,i){this.snappingSource=e,this.layerView=i,this.handles=new ir;const r=this.snappingSource.layerSource.layer;if("refresh"in r){const s=r;this.handles.add(s.on("refresh",()=>e.refresh()))}this.handles.add([ae(()=>e.updating,s=>e.layerSource.updating=s,Tr),ae(()=>e.availability,s=>e.layerSource.availability=s,Tr)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}};function dkt(t){return(t instanceof ckt||t instanceof lkt)&&!pkt(t)}function pkt({constraint:{start:t,end:e}}){const i=Eo(t,e),r=wd(t,e);return i<ul()||r/i<mkt}function tq(t,e,i,r,s,n,{spatialReference:o}){const a=ge(fkt,e);a[0]+=i,a[1]+=r,a[2]+=s;const l=xc(a,o,Go,n);return l?okt(l,t):1/0}const Rve=$(),fkt=$(),mkt=1e-4;let cB=class{constructor(e,i){this.view=e,this.options=i,this.squaredShortLineThreshold=I_.shortLineThreshold*I_.shortLineThreshold}snap(e,i){return b(i.vertexHandle)?i.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,i):this.snapNewVertex(e,i)}edgeExceedsShortLineThreshold(e,i){return this.exceedsShortLineThreshold(bn(e.leftVertex.pos,this.view,i),bn(e.rightVertex.pos,this.view,i),i)}exceedsShortLineThreshold(e,i,{spatialReference:r}){return this.squaredShortLineThreshold===0||FS(xc(i,r,Go,this.view),xc(e,r,Go,this.view))>this.squaredShortLineThreshold}isVertical(e,i){return wd(e,i)<I_.verticalLineThreshold}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:i}=this.options,r=e*i;return r*r}},gkt=class extends lO{constructor({lineStart:e,lineEnd:i,targetPoint:r,isDraped:s}){super(r,new n6e(e,i),s,nl.SELF),this._referenceLineHint=new Iy(Zp.REFERENCE_EXTENSION,e,i,s,this.domain)}get hints(){return[this._referenceLineHint,new Iy(Zp.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},ykt=class extends cB{snapNewVertex(e,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=[];if(s<1)return n;const{spatialReference:o}=i,a=xc(e,o,Go,this.view),{view:l}=this,c=r.edges[s-1];let h=c;do{if(this.edgeExceedsShortLineThreshold(h,i)){const d=bk(h,l,i);this._processCandidateProposal(d.left,d.right,e,a,i,n)}h=h.leftVertex.leftEdge}while(h&&h!==c);return n}snapExistingVertex(e,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<2)return r;const{view:o}=this,{spatialReference:a}=i,l=xc(e,a,Go,o),c=s.leftEdge,h=s.rightEdge;c&&h&&this.edgeExceedsShortLineThreshold(c,i)&&this.edgeExceedsShortLineThreshold(h,i)&&this._processCandidateProposal(bn(c.leftVertex.pos,o,i),bn(h.rightVertex.pos,o,i),e,l,i,r);const d=n.edges[0];let f=d;do{if(f!==s.leftEdge&&f!==s.rightEdge&&this.edgeExceedsShortLineThreshold(f,i)){const m=bk(f,o,i);this._processCandidateProposal(m.left,m.right,e,l,i,r)}f=f.rightVertex.rightEdge}while(f&&f!==d);return r}_processCandidateProposal(e,i,r,s,n,o){var h;const{spatialReference:a,pointer:l}=n,c=uoe(r,{start:e,end:i,type:ba.LINE});FS(s,xc(c,a,Go,this.view))<this.squaredProximityThreshold(l)&&o.push(new gkt({lineStart:e,lineEnd:i,targetPoint:c,isDraped:((h=n.elevationInfo)==null?void 0:h.mode)==="on-the-ground"}))}},_kt=class d6e extends lB{constructor(e,i,r,s=nl.ALL){super(r,s),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof d6e&&Ur(this.lineStart,e.lineStart)&&Ur(this.lineEnd,e.lineEnd)}},vkt=class extends lO{constructor({referenceLine:e,lineStart:i,targetPoint:r,isDraped:s}){const n=zr(i),{left:o,right:a}=e;be(n,we(n,n,a),o),super(r,new n6e(i,n),s,nl.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Iy(Zp.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new _kt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new Iy(Zp.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{Ur(e.right,r.edge.left)&&(r.fadeLeft=!1,i.fadeRight=!1),Ur(e.right,r.edge.right)&&(r.fadeRight=!1,i.fadeRight=!1),Ur(e.left,r.edge.right)&&(r.fadeRight=!1,i.fadeLeft=!1),Ur(e.left,r.edge.left)&&(r.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}};class bkt extends cB{snapNewVertex(e,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=r.vertices.length,o=[];if(s<2)return o;const{view:a}=this,l=xc(e,i.spatialReference,Go,a),c=bn(r.vertices[n-1].pos,a,i),h=bn(r.vertices[0].pos,a,i),d=r.edges[s-1];let f=d;do{if(this.edgeExceedsShortLineThreshold(f,i)){const m=bk(f,a,i);this._checkEdgeForParallelLines(m,c,e,l,i,o),this._checkEdgeForParallelLines(m,h,e,l,i,o)}f=f.leftVertex.leftEdge}while(f&&f!==d);return o}snapExistingVertex(e,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<3)return r;const{view:o}=this,a=xc(e,i.spatialReference,Go,o),l=s.leftEdge,c=s.rightEdge,h=n.vertices[0],d=bn(h.pos,o,i),f=n.vertices.length,m=n.vertices[f-1],g=bn(m.pos,o,i),y=n.edges[0];let v=y;do{if(v!==l&&v!==c&&this.edgeExceedsShortLineThreshold(v,i)){const x=bk(v,o,i);l&&this._checkEdgeForParallelLines(x,bn(l.leftVertex.pos,o,i),e,a,i,r),c&&this._checkEdgeForParallelLines(x,bn(c.rightVertex.pos,o,i),e,a,i,r),s===h?this._checkEdgeForParallelLines(x,g,e,a,i,r):s===m&&this._checkEdgeForParallelLines(x,d,e,a,i,r)}v=v.rightVertex.rightEdge}while(v&&v!==y);return r}_checkEdgeForParallelLines(e,i,r,s,n,o){var f;const a=e.left,l=e.right;if(KH(_x,i,a,l),wd(_x,i)<I_.parallelLineThreshold)return;KH(_x,r,a,l,i);const{spatialReference:c,pointer:h}=n,d=Ve(_x[0],_x[1],r[2]);if(FS(s,xc(d,c,Go,this.view))<this.squaredProximityThreshold(h)){if(this.isVertical(d,i)||this.isVertical(a,l)||this._parallelToPreviousCandidate(e,o))return;o.push(new vkt({referenceLine:e,lineStart:i,targetPoint:d,isDraped:((f=n.elevationInfo)==null?void 0:f.mode)==="on-the-ground"}))}}_parallelToPreviousCandidate(e,i){const r=e.left,s=e.right;for(const n of i)if(KH(_x,s,n.constraint.start,n.constraint.end,r),wd(_x,s)<I_.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const _x=je();class wkt extends cB{snapNewVertex(e,i){const r=i.editGeometryOperations.data.components[0],s=r.vertices.length,n=[];if(s<2)return n;const{view:o}=this,a=xc(e,i.spatialReference,Go,o),l=r.vertices[s-1];if(this.edgeExceedsShortLineThreshold(l.leftEdge,i)){const h=bn(l.pos,o,i),d=bn(l.leftEdge.leftVertex.pos,o,i);this._checkForSnappingCandidate(n,d,h,e,a,i)}const c=r.vertices[0];if(this.edgeExceedsShortLineThreshold(c.rightEdge,i)){const h=bn(c.pos,o,i),d=bn(c.rightEdge.rightVertex.pos,o,i);this._checkForSnappingCandidate(n,d,h,e,a,i)}return n}snapExistingVertex(e,i){const r=[],s=i.vertexHandle;if(s.component.vertices.length<3)return r;const{view:n}=this,o=xc(e,i.spatialReference,Go,n),a=s.leftEdge,l=s.rightEdge;if(a&&a.leftVertex.leftEdge){const c=a.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(c,i)){const h=bn(c.rightVertex.pos,n,i),d=bn(c.leftVertex.pos,n,i);this._checkForSnappingCandidate(r,d,h,e,o,i)}}if(l&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(c,i)){const h=bn(c.leftVertex.pos,n,i),d=bn(c.rightVertex.pos,n,i);this._checkForSnappingCandidate(r,d,h,e,o,i)}}return r}_checkForSnappingCandidate(e,i,r,s,n,o){var f;const{spatialReference:a,pointer:l}=o;Bs(m5,r,i);const c=fe(xkt,m5[1],-m5[0],0),h=Us(c,Bs(m5,s,r))/tw(c),d=x_(zr(s),r,c,h);if(FS(n,xc(d,a,Go,this.view))<this.squaredProximityThreshold(l)){if(this.isVertical(d,r)||this.isVertical(r,i))return;const m=eh($(),r,c,Math.sign(h));e.push(new h6e({targetPoint:d,constraint:new s6e(r,m),previousVertex:i,otherVertex:r,otherVertexType:m3.CENTER,isDraped:((f=o.elevationInfo)==null?void 0:f.mode)==="on-the-ground"}))}}}const m5=je(),xkt=$();let Tkt=class extends lO{constructor({targetPoint:e,point1:i,point2:r,isDraped:s}){super(e,new r6e(En($(),i,r,.5),.5*Gp(i,r)),s,nl.SELF),this._p1=i,this._p2=r}get hints(){return[new Iy(Zp.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new Iy(Zp.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new c6e(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};class Skt extends cB{snapNewVertex(e,i){const r=i.editGeometryOperations.data.components[0],s=[],n=r.vertices.length;if(i.editGeometryOperations.data.type!=="polygon"||n<2)return s;const{view:o}=this,a=r.vertices[0],l=r.vertices[n-1],c=bn(a.pos,o,i),h=bn(l.pos,o,i);return this._processCandidateProposal(c,h,e,i,s),s}snapExistingVertex(e,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<2||i.editGeometryOperations.data.type==="polyline"&&(s.index===0||s.index===n.vertices.length-1))return r;const{view:o}=this,a=bn(s.leftEdge.leftVertex.pos,o,i),l=bn(s.rightEdge.rightVertex.pos,o,i);return this._processCandidateProposal(a,l,e,i,r),r}_processCandidateProposal(e,i,r,s,n){var m;if(!this.exceedsShortLineThreshold(e,i,s))return;const o=NT(Ekt,e,i,.5),a=.5*Gp(e,i),l=$();W9t(l,r,o,a),l[2]=r[2];const c=l,{spatialReference:h,pointer:d}=s,f=xc(r,h,Go,this.view);if(FS(f,xc(c,h,Go,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c)||this.isVertical(c,i))return;n.push(new Tkt({targetPoint:c,point1:e,point2:i,isDraped:((m=s.elevationInfo)==null?void 0:m.mode)==="on-the-ground"}))}}}const Ekt=je();let lM=class extends Ee{constructor(e){super(e),this.updating=!1,this._snappers=new xt,this._domain=nl.SELF}initialize(){this._snappers.push(new bkt(this.view,this.options),new ykt(this.view,this.options),new wkt(this.view,this.options),new Skt(this.view,this.options))}set options(e){this._set("options",e);for(const i of this._snappers)i.options=e}async fetchCandidates(e,i,r){if(!(i&this._domain&&this.options.effectiveSelfEnabled))return[];const s=[];for(const n of this._snappers.items)for(const o of n.snap(e,r))s.push(o);return foe(e,s),s}};u([p({readOnly:!0})],lM.prototype,"updating",void 0),u([p({constructOnly:!0})],lM.prototype,"view",void 0),u([p()],lM.prototype,"options",null),lM=u([N("esri.views.interactive.snapping.SelfSnappingEngine")],lM);function Ckt(t,e){return[new lM({view:t,options:e}),new B1({view:t,options:e,spatialReference:t.spatialReference})]}let CT=class extends Ee{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};u([p({constructOnly:!0})],CT.prototype,"layer",void 0),u([p()],CT.prototype,"enabled",void 0),u([p()],CT.prototype,"updating",void 0),u([p()],CT.prototype,"availability",void 0),CT=u([N("esri.views.interactive.snapping.FeatureSnappingLayerSource")],CT);const Mkt=CT;let zh=class extends Ee{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new xt,this.distance=I_.distance,this.touchSensitivityMultiplier=I_.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};u([p()],zh.prototype,"enabled",void 0),u([p()],zh.prototype,"enabledToggled",void 0),u([p()],zh.prototype,"selfEnabled",void 0),u([p()],zh.prototype,"featureEnabled",void 0),u([p({type:xt.ofType(Mkt)})],zh.prototype,"featureSources",void 0),u([p()],zh.prototype,"distance",void 0),u([p()],zh.prototype,"touchSensitivityMultiplier",void 0),u([p({readOnly:!0})],zh.prototype,"effectiveEnabled",null),u([p({readOnly:!0})],zh.prototype,"effectiveSelfEnabled",null),u([p({readOnly:!0})],zh.prototype,"effectiveFeatureEnabled",null),zh=u([N("esri.views.interactive.snapping.SnappingOptions")],zh);const goe=zh;class yoe extends lB{constructor(e,i,r=nl.ALL){super(i,r),this.intersectionPoint=e}equals(e){return e instanceof yoe&&Ur(this.intersectionPoint,e.intersectionPoint)}}class g5 extends lO{constructor(e,i,r,s){super(e,new aB(e,i.constraint,r.constraint),s,nl.ALL),this.first=i,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new yoe(this.targetPoint,this.isDraped,this.domain)]}}let kf=class extends ws.EventedMixin(Y2){constructor(t){super(t),this.options=new goe,this.snappingEnginesFactory=Ckt,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Q0.MAIN}initialize(){this.handles.add([ae(()=>{const{effectiveFeatureEnabled:t,effectiveSelfEnabled:e,touchSensitivityMultiplier:i,distance:r}=this.options;return{effectiveFeatureEnabled:t,effectiveSelfEnabled:e,touchSensitivityMultiplier:i,distance:r}},()=>{this.doneSnapping(),this.emit("changed")},Mi),ae(()=>this.options,t=>{for(const e of this._engines)e.options=t},Mi),ae(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:t,snappingEnginesFactory:e})=>this._recreateEngines(t,e),Tr)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(t=>t.updating)}_recreateEngines(t,e){if(this._destroyEngines(),!t)return;const{view:i,options:r}=this;this._engines=e(i,r)}_destroyEngines(){for(const t of this._engines)t.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:e}=this.options,i=t*e;return i*i}get _squaredSatisfiesConstraintThreshold(){return I_.satisfiesConstraintScreenThreshold*I_.satisfiesConstraintScreenThreshold}async snap(t){return Akt(t)?this._snapMultiPoint(t):this._snapSinglePoint(t)}update(t){const{point:e,context:i}=t;this._removeVisualization();const r=this._currentMainCandidate;if(A(r))return e;const s=this._selectUpdateInput(t);if(A(s))return e;const{spatialReference:n}=i,o=bd(s,n);if(A(o))return e;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,h=[],d=fI(o,a,i),f=r.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,f,i))return this._resetSnappingState(),e;r.targetPoint=f,h.push(...r.hints);for(const m of this._currentOtherActiveCandidates)m.targetPoint=f,h.push(...m.hints);return b(c)&&this.handles.add(c.draw(h,{spatialReference:n,elevationInfo:Okt(i),view:a,selfSnappingZ:i.selfSnappingZ}),y5),Eve(f,a,{z:e.z,m:e.m,spatialReference:e.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:t,scenePoint:e}){switch(this._currentSnappedType){case Q0.MAIN:return t;case Q0.SCENE:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Q0.MAIN}_removeVisualization(){this.handles.remove(y5)}async _snapSinglePoint({point:t,context:e,signal:i}){const{view:r}=this,s=fI(t,r,e),n=await this._fetchCandidates(s,nl.ALL,e,i);return this._createSnapResult(s,Q0.MAIN,n,r,e,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:e.elevationInfo},i)}async _snapMultiPoint({point:t,scenePoint:e,context:i,signal:r}){const{view:s}=this,{coordinateHelper:n,spatialReference:o}=i;await Vte(e.spatialReference,o);const a=bd(e,o),l=fI(a,s,i),c=await this._fetchCandidates(l,nl.FEATURE,i,r);if(c.length>0){const f=await this._fetchCandidates(l,nl.SELF,i,r);return this._createSnapResult(l,Q0.SCENE,[...c,...f],s,i,{z:a.z,m:a.m,spatialReference:a.spatialReference,elevationInfo:i.elevationInfo},r)}const h=fI(t,s,i),d=await this._fetchCandidates(h,nl.SELF,i,r);return this._createSnapResult(h,Q0.MAIN,d,s,i,{z:n.hasZ()&&t.hasZ?t.z??0:void 0,m:n.hasM()&&t.hasM?t.m??0:void 0,spatialReference:t.spatialReference,elevationInfo:i.elevationInfo},r)}async _fetchCandidates(t,e,i,r){return(await Promise.all(this._engines.map(s=>s.fetchCandidates(t,e,i,r)))).flat()}_createSnapResult(t,e,i,r,s,n,o){return{get valid(){return!yo(o)},apply:()=>{const{spatialReference:a}=s,{snappedPoint:l,hints:c}=this._processCandidates(t,e,i,s);return this._removeVisualization(),b(s.visualizer)&&this.handles.add(s.visualizer.draw(c,{spatialReference:a,elevationInfo:Go,view:r,selfSnappingZ:s.selfSnappingZ}),y5),Eve(l,r,n)}}}_processCandidates(t,e,i,r){if(i.length<1)return this.doneSnapping(),{snappedPoint:t,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),foe(t,i);const s=this._currentMainCandidate;if(b(s)){const n=this._findOldConstraintInNewCandidates(s,i);if(n>=0){if(!(i[n]instanceof g5))return this._intersectWithOtherCandidates(n,i,t,e,r);if(this._arePointsWithinScreenThreshold(t,s.targetPoint,r))return this._updateSnappingCandidate(s,e,i,r)}}return this._intersectWithOtherCandidates(0,i,t,e,r)}_findOldConstraintInNewCandidates(t,e){return t instanceof g5?this._findOldCandidateIndex(e,t.first)>=0&&this._findOldCandidateIndex(e,t.second)>=0?0:-1:this._findOldCandidateIndex(e,t)}_intersectWithOtherCandidates(t,e,i,r,s){const{coordinateHelper:n}=s,o=e[t],a=[];for(let l=0;l<e.length;++l){if(l===t)continue;const c=e[l];for(const h of o.constraint.intersect(c.constraint)){const d=h.closestTo(o.targetPoint);a.push([new g5(d,o,c,c.isDraped),this._squaredScreenDistance(i,d,n)])}}return a.length>0&&(a.sort((l,c)=>l[1]-c[1]),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],r,e,s):this._updateSnappingCandidate(o,r,e,s)}_updateSnappingCandidate(t,e,i,r){this.doneSnapping(),this._currentMainCandidate=t,this._currentSnappedType=e;const s=this._currentMainCandidate.targetPoint,n=[];n.push(...t.hints);for(const o of i){if(t instanceof g5){if(o.constraint.equals(t.first.constraint)||o.constraint.equals(t.second.constraint))continue}else if(o.constraint.equals(t.constraint))continue;const a=o.constraint.closestTo(s);this._squaredScreenDistance(a,s,r.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=s,this._currentOtherActiveCandidates.push(o),n.push(...o.hints))}return{snappedPoint:s,hints:n}}_squaredPointProximityThreshold(t){return t==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(t,e,i){return this._squaredScreenDistance(t,e,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(t,e,i){return FS(this._toScreen(t,i),this._toScreen(e,i))}_toScreen(t,e){return xc(t,e.spatialReference,Go,this.view)}_findOldCandidateIndex(t,e){let i=-1;for(let r=0;r<t.length;++r)if(e.constraint.equals(t[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.handles.has(y5),engines:this._engines}}};var Q0;u([p({constructOnly:!0})],kf.prototype,"view",void 0),u([p()],kf.prototype,"options",void 0),u([p({readOnly:!0})],kf.prototype,"updating",null),u([p()],kf.prototype,"snappingEnginesFactory",void 0),u([p()],kf.prototype,"_engines",void 0),u([p()],kf.prototype,"_squaredMouseProximityTreshold",null),u([p()],kf.prototype,"_squaredTouchProximityThreshold",null),u([p()],kf.prototype,"_squaredSatisfiesConstraintThreshold",null),kf=u([N("esri.views.interactive.snapping.SnappingManager")],kf),function(t){t[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE"}(Q0||(Q0={}));const y5="visualization-handle";function Akt(t){return b(t.scenePoint)}function Okt({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Go:e}let Cl=class extends ws.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;(e=this.activeComponent)==null||e.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};u([p()],Cl.prototype,"activeComponent",void 0),u([p()],Cl.prototype,"cancelled",void 0),u([p()],Cl.prototype,"history",void 0),u([p()],Cl.prototype,"tool",null),u([p()],Cl.prototype,"type",void 0),u([p()],Cl.prototype,"canUndo",null),u([p()],Cl.prototype,"canRedo",null),u([p()],Cl.prototype,"onEnd",void 0),u([p()],Cl.prototype,"undo",null),u([p()],Cl.prototype,"redo",null),u([p()],Cl.prototype,"toggleTool",void 0),u([p()],Cl.prototype,"addToSelection",void 0),u([p()],Cl.prototype,"removeFromSelection",void 0),Cl=u([N("esri.widgets.Sketch.support.OperationHandle")],Cl);let I8=class extends Cl{};u([p()],I8.prototype,"activeComponent",void 0),I8=u([N("esri.widgets.Sketch.support.CreateOperationHandle")],I8);let n_=class extends Cl{};u([p()],n_.prototype,"activeComponent",void 0),n_=u([N("esri.widgets.Sketch.support.UpdateOperationHandle")],n_);const Pve={defaultZ:0},_5={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let Fs=class extends ws.EventedAccessor{constructor(t){super(t),this._numUpdating=0,this._handles=new ir,this._internalGraphicsLayer=new nB({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new ir,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new p5e,this.layer=null,this.pointSymbol=new gm({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Cy({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new uh({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new f5e,this.updateGraphics=new xt,this.updateOnGraphicClick=!0,this.updatePointSymbol=new gm({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new Cy({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new uh({color:[12,207,255],width:2}),this.vertexSymbol=new gm({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Pve,this.defaultUpdateOptions=_5,this.snappingOptions=new goe}initialize(){this._handles.add([Gs(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.layers},"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),Gs(()=>{var t;return(t=this.layer)==null?void 0:t.graphics},"change",t=>{if(b(this._operationHandle))for(const e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),ae(()=>{var t;return((t=this.layer)==null?void 0:t.elevationInfo)??null},t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},Tr),ae(()=>this.view,t=>{He(this._snappingManager),t&&(this._snappingManager=new kf({view:t,options:this.snappingOptions}),t.type==="2d"?se(()=>import("./editingTools-cfec92f5.js"),["assets/editingTools-cfec92f5.js","assets/SnappingVisualizer2D-324ab209.js","assets/enums-4b2a86a0.js","assets/settings-8b934391.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/editPlaneUtils-060ad5f0.js","assets/quantityFormatUtils-018bdc61.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/analysisThemeUtils-2730aa3c.js","assets/cimSymbolUtils-d0609087.js","assets/utils-35d9b505.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js"]):t.type==="3d"&&(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]),se(()=>import("./GraphicsLayerView3D-88ac4a5b.js"),["assets/GraphicsLayerView3D-88ac4a5b.js","assets/LayerView3D-2f960f05.js","assets/queryForSymbologySnapping-28f1961f.js","assets/GraphicsProcessor-4e60627d.js","assets/Graphics3DObjectStates-66f7f08e.js","assets/optimizedFeatureQueryEngineAdapter-c88d667e.js","assets/centroid-d352bf1e.js","assets/PooledRBush-66deaec2.js","assets/projectExtentUtils-f23a1505.js","assets/LayerView-fee1e4f7.js"])))},Tr),ae(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),akt(this)}destroy(){this.cancel(),this._handles=He(this._handles),this._viewHandles=He(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=He(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){var t;return((t=this.view)==null?void 0:t.type)==="3d"?"move":"transform"}get updating(){return this._numUpdating>0||b(this._snappingManager)&&this._snappingManager.updating}get activeTool(){var t;return((t=this._operationHandle)==null?void 0:t.tool)??null}get activeComponent(){var t;return((t=this._operationHandle)==null?void 0:t.activeComponent)??null}get createGraphic(){return!b(this.activeComponent)||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...Pve,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{..._5,...t,reshapeOptions:{..._5.reshapeOptions,...t==null?void 0:t.reshapeOptions}})}set snappingOptions(t){b(this._snappingManager)&&(this._snappingManager.options=t),this._set("snappingOptions",t)}get state(){var i;const t=!(!((i=this.view)!=null&&i.ready)||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:r,map:s}=e;r&&(e.cursor=null),s&&s.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),t&&this._handles.add(wa(()=>t.ready,r=>{this._viewHandles.removeAll(),r&&this._viewHandles.add(this._generateViewHandles(t))},Tr),i),this._set("view",t)}cancel(){this._moduleLoaderAbortController=lu(this._moduleLoaderAbortController),this._viewReadyAbortController=lu(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i,layer:r}=this,s=e.toArray();r.removeMany(s),this.cancel(),this._emitDeleteEvent({graphics:s,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:r}=this;if(!i||this.state==="disabled")throw r||this._logMissingLayer(),er();if(b(i.activeTool)&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");ive(i,this._internalGraphicsLayer);const s=await this._setupCreateOperation(t,e);if(A(s)||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const n=()=>{if(s===this._operationHandle){const o=this.createGraphic,a=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),s.cancelled||o==null||r.add(o),this.emit("create",{graphic:o,state:a?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"})}};s.on("complete",n),this._operationHandle=s,i.ready&&i.focus()}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:s}=this;if(!r||s==="disabled")throw i||this._logMissingLayer(),er();b(r.activeTool)&&(r.activeTool=null);const n=Array.isArray(t)?t:[t];if(t==null||!n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(a=>a.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!A(a.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const o=await this._setupUpdateOperation(n,e);this.destroyed||A(o)||Zo(o)||(ive(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,e),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){this._beginAsyncOperation(),t=Array.isArray(t)?t:[t];for(const i of t)b(i.geometry)&&i.geometry.type!=="mesh"&&!us(i.geometry.spatialReference,e.spatialReference)&&(Bp(i.geometry.spatialReference,e.spatialReference)||Xb()||await Zb(),i.geometry=bd(i.geometry,e.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){var t;this.canUndo()&&((t=this._operationHandle)==null||t.undo())}redo(){var t;this.canRedo()&&((t=this._operationHandle)==null||t.redo())}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const s=[];e.map.allLayers.forEach(o=>{o.type!=="vector-tile"&&o.type!=="imagery"||s.push(o)});const n=await e.hitTest(t,{exclude:s});return M8t(n.results)}const i=[e.map.ground];e.map.allLayers.forEach(s=>{s.type==="integrated-mesh"&&i.push(s)});const r=await e.hitTest(t,{exclude:i});if(r.results.length>0){const s=r.results[0];if(b(s)&&s.type==="graphic"&&s.graphic&&(!r.ground.mapPoint||e.map.ground.opacity<1||r.ground.distance-vt(s.distance,0)>-Math.min(3*r.ground.distance,e.viewingMode==="global"?ur(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return s}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{var n;const i=this.state==="active"&&((n=this._operationHandle)==null?void 0:n.type)==="create";if(this.state==="disabled"||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const r=await e.async(()=>this._getFirstHit(np(e)));let s=null;if(b(r)){const o=r.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),s=o):t.type!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();b(s)&&!this.updateGraphics.includes(s)&&await this.update([s],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()},Es.WIDGET)]}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const r={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},s=await this._setupDrawGraphicTool(t,i,r);return A(s)?null:(i.tools.add(s),i.activeTool=s,this._setupCreateOperationHandle(s))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const r=t!=="rectangle",s=t!=="rectangle",n={view:e,mode:t==="rectangle"||t==="circle"?"hybrid":"click",...i,snapToScene:!1,geometryType:t,graphicSymbol:this._getGraphicSymbolFromTool(t),snappingManager:this._snappingManager,forceUniformSize:s,centered:r};return e.type==="2d"?this._makeDrawGraphicTool2D(n):this._makeDrawGraphicTool3D(n)}async _makeDrawGraphicTool2D(t){const e=await this._requireModule(se(()=>import("./editingTools-cfec92f5.js"),["assets/editingTools-cfec92f5.js","assets/SnappingVisualizer2D-324ab209.js","assets/enums-4b2a86a0.js","assets/settings-8b934391.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/editPlaneUtils-060ad5f0.js","assets/quantityFormatUtils-018bdc61.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/analysisThemeUtils-2730aa3c.js","assets/cimSymbolUtils-d0609087.js","assets/utils-35d9b505.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js"]));return Zo(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Pkt(t.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})}async _makeDrawGraphicTool3D(t){const e=await this._requireModule(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]));if(Zo(e)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new e.module.DrawGraphicTool3D({...t,elevationInfo:i,snapToScene:!b(i)||i.mode==="absolute-height",labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(t){const e=this.view;if(!e)return this._logMissingView(),null;let i=null;const r=t.forceUniformSize,s=t.centered,n=[e.on("key-down",a=>{if(a.key===Xo.pan)a.stopPropagation(),a.repeat||(t.enabled=!1);else if(a.key===Xo.complete)a.stopPropagation(),t.completeCreateOperation();else if(a.key!==Xo.vertexAdd||a.repeat)a.key===Xo.undo?(a.stopPropagation(),o.undo()):a.key===Xo.redo?(a.stopPropagation(),o.redo()):a.key!==Xo.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||a.repeat?a.key===Xo.center&&(a.repeat||(t.centered=!s,a.stopPropagation())):(t.forceUniformSize=!r,a.stopPropagation());else{const l=t.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(a.stopPropagation(),t.drawOperation.commitStagedVertex())}},Es.WIDGET),e.on("key-up",a=>{a.key===Xo.pan?t.enabled=!0:a.key!==Xo.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?a.key===Xo.center&&(t.centered=s,a.stopPropagation()):(t.forceUniformSize=r,a.stopPropagation())},Es.WIDGET),t.on("vertex-add",a=>{switch(i=A(i)?"start":"active",a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:i,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",a=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",a=>{this._set("createGraphic",a.graphic),i="complete",a.aborted?o&&o.cancel():o&&o.complete()}),ae(()=>this._getGraphicSymbolFromTool(t.geometryType),a=>{t.graphicSymbol=a})],o=new I8({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{var a;n.forEach(l=>l.remove()),n.length=0,(a=e.tools)==null||a.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return o}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol}}async _setupUpdateOperation(t,e){const{layer:i,view:r}=this;if(!r)return this._logMissingView(),null;const s={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e==null?void 0:e.reshapeOptions}};let n=s.tool;for(const o of t)i.remove(o),i.add(o);if(r.type==="3d"){if(t.length===0)return null;switch(n){case"move":return this._setupMove3DOperation(t,s,r,n);case"reshape":{if(t.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const o=d5(t[0]);return o===bs.SUPPORTED?this._setupReshape3DOperation(t[0],s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${qH(o)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(t,s,r)}}switch(n){case"move":return this._setupMove2DOperation(t,s,r);case"reshape":{if(t.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const o=d5(t[0]);return o===bs.SUPPORTED?this._setupTransformOrReshape2DOperation(t,n,s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${qH(o)}).`),null)}case"transform":if(t.length===1){const o=Hn(t[0].geometry,"type");o!=="point"&&o!=="multipoint"||(n="reshape")}return this._setupTransformOrReshape2DOperation(t,n,s,r)}}async _setupMove3DOperation(t,e,i,r,s=!1){for(const c of t){const h=SUt(c);if(h!==bs.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${qH(h)}).`),null}const n=await this._requireModule(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]));if(Zo(n))return n;const o=new n.module.GraphicMoveTool({view:i,enableZ:e.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});i.tools.add(o),o.graphics.addMany(t),s||this.updateGraphics.addMany(t);const a=[],l=new n_({activeComponent:o,tool:r,type:"update",onEnd:()=>{var c;a.forEach(h=>h.remove()),a.length=0,(c=i.tools)==null||c.remove(o),o.destroyed||o.destroy()},undo:()=>{v5(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{b5(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:c=>{this.updateGraphics.push(c),o.graphics.push(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const h=this.updateGraphics.indexOf(c);l.history.undo.forEach(d=>d.updates.splice(h,1)),l.history.redo.forEach(d=>d.updates.splice(h,1)),this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics.remove(c):l.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||r!=="transform")return;const c=this.updateGraphics.getItemAt(0);if(d5(c)!==bs.SUPPORTED)return;const h=await this._setupReshape3DOperation(c,e,i,!0);Zo(h)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(h,e))}});return a.push(...this._getHandlesForComponent(l,e),i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(l,c,e),Es.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(l,c)},Es.WIDGET)),l}_setupGraphicTransform3DOperation(t,e,i,r=!1){if(t.length===1&&CUt(t[0])===bs.SUPPORTED){const s=t[0],n=s.geometry;if(b(n)&&(n.type==="point"||n.type==="mesh"))return this._setupPointTransform3DOperation(s,e,i);if(b(n)&&(n.type==="polygon"||n.type==="polyline"))return this._setupPolyTransform3DOperation(s,e,i,r)}return this._setupMove3DOperation(t,e,i,"transform",r)}async _setupPointTransform3DOperation(t,e,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:o}=e,a=await this._requireModule(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]));if(Zo(a))return a;const l=new a.module.GraphicTransformTool({graphic:t,view:i,enableRotation:s,enableScaling:n,enableZ:o,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});i.tools.add(l),this.updateGraphics.add(t);const c=[],h=new n_({activeComponent:l,tool:r,type:"update",onEnd:()=>{var d;c.forEach(f=>f.remove()),c.length=0,(d=i.tools)==null||d.remove(l),l.destroyed||l.destroy()},undo:()=>{v5(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{b5(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async d=>{this.updateGraphics.add(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[d],removed:[],type:"selection-change"},type:"update"});const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Zo(f)||(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(f,e))},removeFromSelection:d=>{this.updateGraphics.remove(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[d],type:"selection-change"},type:"update"}),h.complete()},toggleTool:()=>{}});return c.push(...this._getHandlesForComponent(h,e),i.on("immediate-click",d=>this._getCommonUpdateOperationClickHandlers(h,d,e),Es.WIDGET),i.on("key-down",d=>{this._getCommonUpdateOperationKeyDownHandlers(h,d)},Es.WIDGET)),h}async _setupPolyTransform3DOperation(t,e,i,r=!1){const s="transform",{enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l}=e,c=await this._requireModule(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]));if(Zo(c))return c;const h=new c.module.ExtentTransformTool({graphic:t,view:i,enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l,tooltipOptions:this.tooltipOptions});i.tools.add(h),r||this.updateGraphics.add(t);const d=[],f=new n_({activeComponent:h,tool:s,type:"update",onEnd:()=>{var m;d.forEach(g=>g.remove()),d.length=0,(m=i.tools)==null||m.remove(h),h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>h.canRedo,redo:()=>{h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async m=>{this.updateGraphics.add(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"});const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Zo(g)||(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,e))},removeFromSelection:m=>{this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const m=this.updateGraphics.getItemAt(0);if(d5(m)!==bs.SUPPORTED)return;const g=await this._setupReshape3DOperation(m,e,i,!0);Zo(g)||(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,e))}});return d.push(...this._getHandlesForComponent(f,e),i.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(f,m,e),Es.WIDGET),i.on("key-down",m=>this._getCommonUpdateOperationKeyDownHandlers(f,m),Es.WIDGET),i.on("key-down",m=>{m.key!==Xo.constraint||m.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,m.stopPropagation())},Es.WIDGET),i.on("key-up",m=>{m.key===Xo.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,m.stopPropagation())},Es.WIDGET)),f}async _setupMove2DOperation(t,e,i){const r="move";this.updateGraphics.addMany(t),await this._updateSpatialReference(t);const s=await this._getGraphicMover(t,e,i);if(Zo(s))return s;const n=new n_({activeComponent:s,tool:r,type:"update",onEnd:()=>{var c;this._displayDefaultCursor(),l.forEach(h=>h.remove()),a.forEach(h=>h.remove()),l=[],a=[],s.destroy(),(c=this._internalGraphicsLayer)==null||c.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const c=this.updateGraphics.toArray();v5(n,c),n.refreshComponent(),this._emitUndoEvent({graphics:c,tool:r})},redo:()=>{const c=this.updateGraphics.toArray();b5(n,c),n.refreshComponent(),this._emitRedoEvent({graphics:c,tool:r})},addToSelection:async c=>{await this._updateSpatialReference(c),this.updateGraphics.push(c),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const h=this.updateGraphics.indexOf(c);n.history.undo.forEach(f=>f.updates.splice(h,1)),n.history.redo.forEach(f=>f.updates.splice(h,1)),this.updateGraphics.remove(c);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?s.graphics=d:n.complete()}});let o=!1,a=[i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(n,c,e),Es.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(n,c),c.key!==Xo.constraint||c.repeat||(o=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Es.WIDGET),i.on("key-up",c=>{c.key===Xo.constraint&&o&&(o=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Es.WIDGET)],l=this._getHandlesForComponent(n,e);return n}async _setupReshape3DOperation(t,e,i,r=!1){const s="reshape",n=await this._requireModule(se(()=>import("./editingTools-9fcd4b7c.js"),["assets/editingTools-9fcd4b7c.js","assets/quantityFormatUtils-018bdc61.js","assets/TextOverlayItem-5acee2ee.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/VerticesVisualElement-77218424.js","assets/RightAngleQuadVisualElement-97d8d566.js","assets/LineVisualElement-78cd90ab.js","assets/VisualElementResources-0bf527a0.js","assets/PointVisualElement-436a9da2.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/colorUtils-7641d345.js","assets/manipulatorUtils-628928f4.js","assets/ImageMaterial-16df11df.js","assets/editPlaneUtils-060ad5f0.js","assets/InteractiveToolBase-2426985e.js","assets/drawUtils-c430a3a5.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js","assets/dehydratedFeatureComparison-3c65c83d.js","assets/EditGeometryOperations-db5a0065.js","assets/SnappingOperation-505d6431.js","assets/manipulatorUtils-a50340e3.js","assets/Factory-e452a86d.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/sliceToolUtils-5a6e2ce9.js","assets/persistable-f9157ed8.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-51a6629e.js","assets/ExtentTooltipInfos-4ee8c523.js"]));if(Zo(n))return n;const o=e.reshapeOptions,a=new n.module.GraphicReshapeTool({view:i,graphic:t,enableZVertex:e.enableZ&&(o==null?void 0:o.vertexOperation)==="move",enableZShape:e.enableZ&&(o==null?void 0:o.shapeOperation)==="move",enableMoveGraphic:(o==null?void 0:o.shapeOperation)==="move"||(o==null?void 0:o.shapeOperation)==="move-xy",enableMidpoints:(o==null?void 0:o.edgeOperation)==="split",enableEdgeOffset:(o==null?void 0:o.edgeOperation)==="offset",snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});i.tools.add(a),r||this.updateGraphics.add(t);const l=[],c=new n_({activeComponent:a,tool:s,type:"update",onEnd:()=>{var h;l.forEach(d=>d.remove()),l.length=0,(h=i.tools)==null||h.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async h=>{this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"});const d=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Zo(d)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(d,e))},removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),c.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;const h=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);Zo(h)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(h,e))}});return l.push(...this._getHandlesForComponent(c,e),i.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(c,h,e),Es.WIDGET),i.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(c,h)},Es.WIDGET)),c}async _setupTransformOrReshape2DOperation(t,e,i,r){this.updateGraphics.addMany(t),await this._updateSpatialReference(t);const s=e==="transform"?await this._getBox(t,i,r):await this._getReshape(t,i,r);if(Zo(s))return s;const n=new n_({activeComponent:s,type:"update",onEnd:()=>{a.forEach(l=>l.remove()),o.forEach(l=>l.remove()),a=[],o=[],n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{v5(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{b5(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async l=>{let c=n.activeComponent;if((c==null?void 0:c.type)==="reshape"){const h=[...this.updateGraphics,l];this.updateGraphics.removeAll();const d=await this._setupMove2DOperation(h,i,r);if(Zo(d))return;n.onEnd(),n.destroy(),this._setUpdateOperationHandle(d,i)}else this.updateGraphics.add(l),c.graphics=this.updateGraphics.toArray(),c.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const c=this.updateGraphics.indexOf(l);n.history.undo.forEach(d=>d.updates.splice(c,1)),n.history.redo.forEach(d=>d.updates.splice(c,1)),this.updateGraphics.remove(l);const h=this.updateGraphics.toArray();if(h.length===0)n.complete();else{const d=h[0].geometry;h.length!==1||!b(d)||d.type!=="point"&&d.type!=="multipoint"?n.activeComponent.graphics=h:n.toggleTool()}this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{var d;if(this.updateGraphics.length>1)return;const l=this.updateGraphics.getItemAt(0),c=l.geometry;if(b(c)&&(n.tool==="reshape"&&(c.type==="point"||c.type==="multipoint")||n.tool==="transform"&&c.type==="extent"))return;let h=null;n.tool==="transform"?h=await this._getReshape([l],i,r):n.tool==="reshape"&&(h=await this._getBox([l],i,r)),Zo(h)||((d=n.activeComponent)==null||d.destroy(),n.activeComponent=h,n.activeComponent&&(a.forEach(f=>f.remove()),a=this._getHandlesForComponent(n,i)))}});let o=[r.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(n,l,i),Es.WIDGET),r.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,l),l.key===Xo.constraint&&!l.repeat&&n){const c=n.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Es.WIDGET),r.on("key-up",l=>{if(l.key===Xo.constraint&&n){const c=n.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Es.WIDGET)],a=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:r}=e,s=await this._requireModule(se(()=>import("./GraphicMover-43329e3b.js").then(n=>n.G),["assets/GraphicMover-43329e3b.js","assets/drawUtils-c430a3a5.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js"]));return Zo(s)?s:new s.module.default({enableMoveAllGraphics:r,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:n,dy:o,graphic:a})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move-start"},type:"update"})},onGraphicMove:({dx:n,dy:o,graphic:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move"},type:"update"}),onGraphicMoveStop:({dx:n,dy:o,graphic:a})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(t,e,i){const{enableRotation:r,enableScaling:s,preserveAspectRatio:n}=e,o=await this._requireModule(se(()=>import("./Box-b15b8a2b.js"),["assets/Box-b15b8a2b.js","assets/quantityFormatUtils-018bdc61.js","assets/drawUtils-c430a3a5.js","assets/GraphicMover-43329e3b.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/settings-8b934391.js","assets/ExtentTooltipInfos-4ee8c523.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/TranslateTooltipInfos-8502ec9d.js"]));return Zo(o)?o:new o.module.default({graphics:t,enableRotation:r,enableScaling:s,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:i,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onMove:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onMoveStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onScaleStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onScale:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onScaleStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onRotateStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onRotate:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"}),onRotateStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a},type:"update"})}})}async _getReshape(t,e,i){var o,a;const r=((o=e.reshapeOptions)==null?void 0:o.edgeOperation)==="split",s=((a=e.reshapeOptions)==null?void 0:a.shapeOperation)==="move",n=await this._requireModule(se(()=>import("./Reshape-2524de8d.js"),["assets/Reshape-2524de8d.js","assets/quantityFormatUtils-018bdc61.js","assets/SnappingVisualizer2D-324ab209.js","assets/enums-4b2a86a0.js","assets/settings-8b934391.js","assets/SnappingContext-4110407b.js","assets/PointSnappingHint-b85cbba9.js","assets/drawUtils-c430a3a5.js","assets/GraphicMover-43329e3b.js","assets/GraphicManipulator-12f704e5.js","assets/drapedUtils-8847b824.js","assets/EditGeometryOperations-db5a0065.js","assets/automaticLengthMeasurementUtils-6aad9b81.js","assets/euclideanLengthMeasurementUtils-7df7c9ce.js","assets/measurementUtils-999dc2c1.js","assets/geometryEngine-c1728e6c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-0210143f.js","assets/TranslateTooltipInfos-8502ec9d.js","assets/automaticAreaMeasurementUtils-414fa387.js","assets/euclideanAreaMeasurementUtils-a26000cc.js"]));return Zo(n)?n:new n.module.default({enableMidpoints:r,enableMovement:s,graphic:t[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:i,callbacks:{onReshapeStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshape:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshapeStop:({mover:l,type:c})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:l,type:c},type:"update"}),onMoveStart:({dx:l,dy:c,mover:h,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:d},type:"update"}),onMove:({dx:l,dy:c,mover:h,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:d},type:"update"}),onMoveStop:({dx:l,dy:c,mover:h,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:d},type:"update"}),onVertexAdd:({added:l,type:c,vertices:h})=>{const d=l.map(f=>Rle(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:h,type:c},type:"update"})},onVertexRemove:({removed:l,type:c,vertices:h})=>{const d=l.map(f=>Rle(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:h,type:c},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:r,viewEvent:s})=>{var n;(n=s.native)!=null&&n.shiftKey&&(s.stopPropagation(),t.removeFromSelection(r))}),i.on("graphic-move-start",r=>t.addToHistory(_0(r.allGraphics)))];case"box":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(_0(r.graphics))),i.on("rotate-start",r=>t.addToHistory(_0(r.graphics))),i.on("scale-start",r=>t.addToHistory(_0(r.graphics)))];case"reshape":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(_0([r.mover]))),i.on("reshape-start",r=>t.addToHistory(_0([r.graphic]))),i.on("vertex-add",r=>t.addToHistory(_0([r.oldGraphic]))),i.on("vertex-remove",r=>t.addToHistory(_0([r.oldGraphic])))];case"move-3d":return[i.on("graphic-move-start",r=>{t.addToHistory(_0(r.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-start"},type:"update"})}),i.on("graphic-move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r.dx,dy:r.dy,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move"},type:"update"})}),i.on("graphic-move-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-stop"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.on("record-undo",({record:r})=>{t.addToHistory({updates:[r]})}),i.on("graphic-translate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-start"},type:"update"})}),i.on("graphic-translate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-stop"},type:"update"})}),i.on("graphic-rotate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-start"},type:"update"})}),i.on("graphic-rotate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-stop"},type:"update"})}),i.on("graphic-scale-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-start"},type:"update"})}),i.on("graphic-scale-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-stop"},type:"update"})}),i.on("graphic-translate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move"},type:"update"})}),i.on("graphic-rotate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate"},type:"update"})}),i.on("graphic-scale",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.on("reshape",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-add",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-remove",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){var n;const{graphic:r,viewEvent:s}=i;return(n=s.native)!=null&&n.shiftKey&&r.layer===this.layer?(s.stopPropagation(),t.removeFromSelection(r)):e.toggleToolOnClick?(s.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){var s;this._operationHandle=t;const i=(s=this.view)==null?void 0:s.map;this._disablePopup(e);const r=()=>{if(t===this._operationHandle){const n=this.updateGraphics.toArray(),o=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:n,state:"complete",aborted:t.cancelled,tool:o,toolEventInfo:null,type:"update"})}};t.on("complete",r)}async _getCommonUpdateOperationClickHandlers(t,e,i){const r=np(e),s=await e.async(()=>this._getFirstHit(r));if(A(s))return void t.complete();if(e.native.shiftKey&&this._toggleSelection([s.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(s.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const r=!!i.multipleSelectionEnabled;return t.some(s=>s!=null&&!(!r||s.layer!==this.layer)&&(this.updateGraphics.includes(s)?e.removeFromSelection(s):e.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===Xo.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===Xo.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===Xo.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&Xo.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();A(e)||e.type==="reshape-3d"||(e.type!=="reshape"||i.length===1&&Hn(i[0].geometry,"type")==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){var t,e;this._internalGraphicsLayer&&((e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=He(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||A(e))&&(t.attributes&&t.attributes.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){this.view&&this.view.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,i){le.getLogger(this.declaredClass).error(new J(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:_5}}wait(){return Wb(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(t){var e,i;return((e=this.view)==null?void 0:e.type)!=="3d"||this.updateOnGraphicClick||(((i=t)==null?void 0:i.toggleToolOnClick)??!1)}_disablePopup(t){var i;if(!this._disablePopupEnabled(t))return;const e=(i=this.view)==null?void 0:i.popup;e&&A(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=e.autoOpenEnabled,e.autoOpenEnabled=!1)}_restorePopup(t){var i;if(!this._disablePopupEnabled(t))return;const e=(i=this.view)==null?void 0:i.popup;e&&b(this._originalAutoOpenEnabled)&&(e.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const t=this.view;t?(lu(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await lp(Wb(()=>t==null?void 0:t.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ive("view"))}_logMissingLayer(){this._logError(Rkt,Ive("layer"))}};u([p()],Fs.prototype,"updating",null),u([p()],Fs.prototype,"_operationHandle",void 0),u([p({readOnly:!0})],Fs.prototype,"activeTool",null),u([p()],Fs.prototype,"activeFillSymbol",void 0),u([p()],Fs.prototype,"activeLineSymbol",void 0),u([p()],Fs.prototype,"activeVertexSymbol",void 0),u([p()],Fs.prototype,"allowDeleteKey",void 0),u([p({readOnly:!0})],Fs.prototype,"createGraphic",null),u([p()],Fs.prototype,"defaultCreateOptions",null),u([p()],Fs.prototype,"defaultUpdateOptions",null),u([p({type:p5e,nonNullable:!0})],Fs.prototype,"labelOptions",void 0),u([p()],Fs.prototype,"layer",void 0),u([p({types:Hu})],Fs.prototype,"pointSymbol",void 0),u([p({types:Hu})],Fs.prototype,"polygonSymbol",void 0),u([p({types:Hu})],Fs.prototype,"polylineSymbol",void 0),u([p({type:goe,nonNullable:!0})],Fs.prototype,"snappingOptions",null),u([p()],Fs.prototype,"_snappingManager",void 0),u([p({readOnly:!0})],Fs.prototype,"state",null),u([p({type:f5e,nonNullable:!0})],Fs.prototype,"tooltipOptions",void 0),u([p({readOnly:!0})],Fs.prototype,"updateGraphics",void 0),u([p()],Fs.prototype,"updateOnGraphicClick",void 0),u([p({types:Hu})],Fs.prototype,"updatePointSymbol",void 0),u([p({types:Hu})],Fs.prototype,"updatePolygonSymbol",void 0),u([p({types:Hu})],Fs.prototype,"updatePolylineSymbol",void 0),u([p({types:Hu})],Fs.prototype,"vertexSymbol",void 0),u([p({value:null})],Fs.prototype,"view",null),Fs=u([N("esri.widgets.Sketch.SketchViewModel")],Fs);const Rkt="sketch:missing-property",Ive=t=>`Property '${t}' is missing on SketchViewModel.`;function Pkt(t){return t==="polygon"||t==="rectangle"||t==="circle"}function v5(t,e){p6e("undo",t.history.undo,t.history.redo,e)}function b5(t,e){p6e("redo",t.history.redo,t.history.undo,e)}function p6e(t,e,i,r){const s=e.pop();if(!s)return;const n=s.updates,o=[];r.forEach((a,l)=>{const c=n[l];c!=null&&("geometry"in c&&b(c.geometry)&&(o.push({geometry:a.geometry}),a.geometry=c.geometry),"symbol"in c&&b(c.symbol)&&(o.push({symbol:a.symbol}),a.symbol=c.symbol),"undo"in c&&(o.push(c),c[t](a)))}),i.push({updates:o})}function _0(t){return{updates:t.map(e=>({geometry:e.geometry}))}}function Zo(t){return"requireError"in t&&t.requireError==="aborted"}const Ikt=Fs,$ve=t=>t.spatialReference.wkid||JSON.stringify(t.spatialReference);function $kt(t,e){const{dpi:i,gdbVersion:r,geometry:s,geometryPrecision:n,height:o,layerOption:a,mapExtent:l,maxAllowableOffset:c,returnFieldName:h,returnGeometry:d,returnUnformattedValues:f,returnZ:m,spatialReference:g,timeExtent:y,tolerance:v,width:x}=t.toJSON(),{dynamicLayers:S,layerDefs:E,layerIds:C}=Lkt(t),R=e&&b(e.geometry)?e.geometry:null,O={geometryPrecision:n,maxAllowableOffset:c,returnFieldName:h,returnGeometry:d,returnUnformattedValues:f,returnZ:m,tolerance:v},U=R&&R.toJSON()||s;if(O.imageDisplay=`${x},${o},${i}`,r&&(O.gdbVersion=r),U&&(delete U.spatialReference,O.geometry=JSON.stringify(U),O.geometryType=vS(U)),g?O.sr=g.wkid||JSON.stringify(g):U&&U.spatialReference?O.sr=$ve(U):l&&l.spatialReference&&(O.sr=$ve(l)),O.time=y?[y.start,y.end].join(","):null,l){const{xmin:L,ymin:B,xmax:G,ymax:j}=l;O.mapExtent=`${L},${B},${G},${j}`}return E&&(O.layerDefs=E),S&&!E&&(O.dynamicLayers=S),O.layers=a==="popup"?"visible":a,C&&!S&&(O.layers+=`:${C.join(",")}`),O}function Lkt(t){var g,y;const{mapExtent:e,floors:i,width:r,sublayers:s,layerIds:n,layerOption:o,gdbVersion:a}=t,l=(y=(g=s==null?void 0:s.find(v=>v.layer!=null))==null?void 0:g.layer)==null?void 0:y.serviceSublayers,c=o==="popup",h={},d=h9({extent:e,width:r,spatialReference:e==null?void 0:e.spatialReference}),f=[],m=v=>{const x=d===0,S=v.minScale===0||d<=v.minScale,E=v.maxScale===0||d>=v.maxScale;if(v.visible&&(x||S&&E))if(v.sublayers)v.sublayers.forEach(m);else{if((n==null?void 0:n.includes(v.id))===!1||c&&(!v.popupTemplate||!v.popupEnabled))return;f.unshift(v)}};if(s==null||s.forEach(m),s&&!f.length)h.layerIds=[];else{const v=X4e(f,l,a),x=f.map(S=>{const E=pk(i,S);return S.toExportImageJSON(E)});if(v)h.dynamicLayers=JSON.stringify(x);else{if(s){let E=f.map(({id:C})=>C);n&&(E=E.filter(C=>n.includes(C))),h.layerIds=E}else n!=null&&n.length&&(h.layerIds=n);const S=Dkt(i,f);if(b(S)&&S.length){const E={};for(const C of S)C.definitionExpression&&(E[C.id]=C.definitionExpression);Object.keys(E).length&&(h.layerDefs=JSON.stringify(E))}}}return h}function Dkt(t,e){const i=!!(t!=null&&t.length),r=e.filter(s=>s.definitionExpression!=null||i&&s.floorInfo!=null);return r.length?r.map(s=>{const n=pk(t,s),o=MV(n,s.definitionExpression);return{id:s.id,definitionExpression:vt(o,void 0)}}):null}var qQ;let Kn=qQ=class extends Ae{static from(t){return U_(qQ,t)}constructor(t){super(t),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};u([p({type:Number,json:{write:!0}})],Kn.prototype,"dpi",void 0),u([p()],Kn.prototype,"floors",void 0),u([p({type:String,json:{write:!0}})],Kn.prototype,"gdbVersion",void 0),u([p({types:yw,json:{read:Mm,write:!0}})],Kn.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],Kn.prototype,"geometryPrecision",void 0),u([p({type:Number,json:{write:!0}})],Kn.prototype,"height",void 0),u([p({type:[Number],json:{write:!0}})],Kn.prototype,"layerIds",void 0),u([p({type:["top","visible","all","popup"],json:{write:!0}})],Kn.prototype,"layerOption",void 0),u([p({type:ti,json:{write:!0}})],Kn.prototype,"mapExtent",void 0),u([p({type:Number,json:{write:!0}})],Kn.prototype,"maxAllowableOffset",void 0),u([p({type:Boolean,json:{write:!0}})],Kn.prototype,"returnFieldName",void 0),u([p({type:Boolean,json:{write:!0}})],Kn.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:!0}})],Kn.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:!0}})],Kn.prototype,"returnUnformattedValues",void 0),u([p({type:Boolean,json:{write:!0}})],Kn.prototype,"returnZ",void 0),u([p({type:Ye,json:{write:!0}})],Kn.prototype,"spatialReference",void 0),u([p()],Kn.prototype,"sublayers",void 0),u([p({type:Jp,json:{write:!0}})],Kn.prototype,"timeExtent",void 0),u([p({type:Number,json:{write:!0}})],Kn.prototype,"tolerance",void 0),u([p({type:Number,json:{write:!0}})],Kn.prototype,"width",void 0),Kn=qQ=u([N("esri.rest.support.IdentifyParameters")],Kn);const f6e=Kn;let W0=class extends Ae{constructor(e){super(e),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(e,i){return Ho.fromJSON({attributes:{...i.attributes},geometry:{...i.geometry}})}writeFeature(e,i){if(!e)return;const{attributes:r,geometry:s}=e;r&&(i.attributes={...r}),b(s)&&(i.geometry=s.toJSON(),i.geometryType=Kq.toJSON(s.type))}};u([p({type:String,json:{write:!0}})],W0.prototype,"displayFieldName",void 0),u([p({type:Ho})],W0.prototype,"feature",void 0),u([De("feature",["attributes","geometry"])],W0.prototype,"readFeature",null),u([Xe("feature")],W0.prototype,"writeFeature",null),u([p({type:Number,json:{write:!0}})],W0.prototype,"layerId",void 0),u([p({type:String,json:{write:!0}})],W0.prototype,"layerName",void 0),W0=u([N("esri.rest.support.IdentifyResult")],W0);const Nkt=W0;async function Fkt(t,e,i){const r=(e=kkt(e)).geometry?[e.geometry]:[],s=tv(t);return s.path+="/identify",TV(r).then(n=>{const o=$kt(e,{geometry:n&&n[0]}),a=sEe({...s.query,f:"json",...o}),l=rEe(a,i);return tr(s.path,l).then(Ukt).then(c=>Vkt(c,e.sublayers))})}function Ukt(t){const e=t.data;return e.results=e.results||[],e.exceededTransferLimit=!!e.exceededTransferLimit,e.results=e.results.map(i=>Nkt.fromJSON(i)),e}function kkt(t){return t=f6e.from(t)}function Vkt(t,e){if(!(e!=null&&e.length))return t;const i=new Map;function r(s){i.set(s.id,s),s.sublayers&&s.sublayers.forEach(r)}e.forEach(r);for(const s of t.results)s.feature.sourceLayer=i.get(s.layerId);return t}var m6e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wk={},zkt={get exports(){return wk},set exports(t){wk=t}};(function(t,e){(function(i,r){t.exports=r()})(m6e,function(){var i=1e3,r=6e4,s=36e5,n="millisecond",o="second",a="minute",l="hour",c="day",h="week",d="month",f="quarter",m="year",g="date",y="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,x=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(ie){var ee=["th","st","nd","rd"],K=ie%100;return"["+ie+(ee[(K-20)%10]||ee[K]||ee[0])+"]"}},E=function(ie,ee,K){var Y=String(ie);return!Y||Y.length>=ee?ie:""+Array(ee+1-Y.length).join(K)+ie},C={s:E,z:function(ie){var ee=-ie.utcOffset(),K=Math.abs(ee),Y=Math.floor(K/60),D=K%60;return(ee<=0?"+":"-")+E(Y,2,"0")+":"+E(D,2,"0")},m:function ie(ee,K){if(ee.date()<K.date())return-ie(K,ee);var Y=12*(K.year()-ee.year())+(K.month()-ee.month()),D=ee.clone().add(Y,d),V=K-D<0,k=ee.clone().add(Y+(V?-1:1),d);return+(-(Y+(K-D)/(V?D-k:k-D))||0)},a:function(ie){return ie<0?Math.ceil(ie)||0:Math.floor(ie)},p:function(ie){return{M:d,y:m,w:h,d:c,D:g,h:l,m:a,s:o,ms:n,Q:f}[ie]||String(ie||"").toLowerCase().replace(/s$/,"")},u:function(ie){return ie===void 0}},R="en",O={};O[R]=S;var U=function(ie){return ie instanceof j},L=function ie(ee,K,Y){var D;if(!ee)return R;if(typeof ee=="string"){var V=ee.toLowerCase();O[V]&&(D=V),K&&(O[V]=K,D=V);var k=ee.split("-");if(!D&&k.length>1)return ie(k[0])}else{var Z=ee.name;O[Z]=ee,D=Z}return!Y&&D&&(R=D),D||!Y&&R},B=function(ie,ee){if(U(ie))return ie.clone();var K=typeof ee=="object"?ee:{};return K.date=ie,K.args=arguments,new j(K)},G=C;G.l=L,G.i=U,G.w=function(ie,ee){return B(ie,{locale:ee.$L,utc:ee.$u,x:ee.$x,$offset:ee.$offset})};var j=function(){function ie(K){this.$L=L(K.locale,null,!0),this.parse(K)}var ee=ie.prototype;return ee.parse=function(K){this.$d=function(Y){var D=Y.date,V=Y.utc;if(D===null)return new Date(NaN);if(G.u(D))return new Date;if(D instanceof Date)return new Date(D);if(typeof D=="string"&&!/Z$/i.test(D)){var k=D.match(v);if(k){var Z=k[2]-1||0,Q=(k[7]||"0").substring(0,3);return V?new Date(Date.UTC(k[1],Z,k[3]||1,k[4]||0,k[5]||0,k[6]||0,Q)):new Date(k[1],Z,k[3]||1,k[4]||0,k[5]||0,k[6]||0,Q)}}return new Date(D)}(K),this.$x=K.x||{},this.init()},ee.init=function(){var K=this.$d;this.$y=K.getFullYear(),this.$M=K.getMonth(),this.$D=K.getDate(),this.$W=K.getDay(),this.$H=K.getHours(),this.$m=K.getMinutes(),this.$s=K.getSeconds(),this.$ms=K.getMilliseconds()},ee.$utils=function(){return G},ee.isValid=function(){return this.$d.toString()!==y},ee.isSame=function(K,Y){var D=B(K);return this.startOf(Y)<=D&&D<=this.endOf(Y)},ee.isAfter=function(K,Y){return B(K)<this.startOf(Y)},ee.isBefore=function(K,Y){return this.endOf(Y)<B(K)},ee.$g=function(K,Y,D){return G.u(K)?this[Y]:this.set(D,K)},ee.unix=function(){return Math.floor(this.valueOf()/1e3)},ee.valueOf=function(){return this.$d.getTime()},ee.startOf=function(K,Y){var D=this,V=!!G.u(Y)||Y,k=G.p(K),Z=function(Ze,Le){var Me=G.w(D.$u?Date.UTC(D.$y,Le,Ze):new Date(D.$y,Le,Ze),D);return V?Me:Me.endOf(c)},Q=function(Ze,Le){return G.w(D.toDate()[Ze].apply(D.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(Le)),D)},ne=this.$W,te=this.$M,de=this.$D,_e="set"+(this.$u?"UTC":"");switch(k){case m:return V?Z(1,0):Z(31,11);case d:return V?Z(1,te):Z(0,te+1);case h:var Ce=this.$locale().weekStart||0,Pe=(ne<Ce?ne+7:ne)-Ce;return Z(V?de-Pe:de+(6-Pe),te);case c:case g:return Q(_e+"Hours",0);case l:return Q(_e+"Minutes",1);case a:return Q(_e+"Seconds",2);case o:return Q(_e+"Milliseconds",3);default:return this.clone()}},ee.endOf=function(K){return this.startOf(K,!1)},ee.$set=function(K,Y){var D,V=G.p(K),k="set"+(this.$u?"UTC":""),Z=(D={},D[c]=k+"Date",D[g]=k+"Date",D[d]=k+"Month",D[m]=k+"FullYear",D[l]=k+"Hours",D[a]=k+"Minutes",D[o]=k+"Seconds",D[n]=k+"Milliseconds",D)[V],Q=V===c?this.$D+(Y-this.$W):Y;if(V===d||V===m){var ne=this.clone().set(g,1);ne.$d[Z](Q),ne.init(),this.$d=ne.set(g,Math.min(this.$D,ne.daysInMonth())).$d}else Z&&this.$d[Z](Q);return this.init(),this},ee.set=function(K,Y){return this.clone().$set(K,Y)},ee.get=function(K){return this[G.p(K)]()},ee.add=function(K,Y){var D,V=this;K=Number(K);var k=G.p(Y),Z=function(te){var de=B(V);return G.w(de.date(de.date()+Math.round(te*K)),V)};if(k===d)return this.set(d,this.$M+K);if(k===m)return this.set(m,this.$y+K);if(k===c)return Z(1);if(k===h)return Z(7);var Q=(D={},D[a]=r,D[l]=s,D[o]=i,D)[k]||1,ne=this.$d.getTime()+K*Q;return G.w(ne,this)},ee.subtract=function(K,Y){return this.add(-1*K,Y)},ee.format=function(K){var Y=this,D=this.$locale();if(!this.isValid())return D.invalidDate||y;var V=K||"YYYY-MM-DDTHH:mm:ssZ",k=G.z(this),Z=this.$H,Q=this.$m,ne=this.$M,te=D.weekdays,de=D.months,_e=function(Le,Me,qe,We){return Le&&(Le[Me]||Le(Y,V))||qe[Me].slice(0,We)},Ce=function(Le){return G.s(Z%12||12,Le,"0")},Pe=D.meridiem||function(Le,Me,qe){var We=Le<12?"AM":"PM";return qe?We.toLowerCase():We},Ze={YY:String(this.$y).slice(-2),YYYY:this.$y,M:ne+1,MM:G.s(ne+1,2,"0"),MMM:_e(D.monthsShort,ne,de,3),MMMM:_e(de,ne),D:this.$D,DD:G.s(this.$D,2,"0"),d:String(this.$W),dd:_e(D.weekdaysMin,this.$W,te,2),ddd:_e(D.weekdaysShort,this.$W,te,3),dddd:te[this.$W],H:String(Z),HH:G.s(Z,2,"0"),h:Ce(1),hh:Ce(2),a:Pe(Z,Q,!0),A:Pe(Z,Q,!1),m:String(Q),mm:G.s(Q,2,"0"),s:String(this.$s),ss:G.s(this.$s,2,"0"),SSS:G.s(this.$ms,3,"0"),Z:k};return V.replace(x,function(Le,Me){return Me||Ze[Le]||k.replace(":","")})},ee.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},ee.diff=function(K,Y,D){var V,k=G.p(Y),Z=B(K),Q=(Z.utcOffset()-this.utcOffset())*r,ne=this-Z,te=G.m(this,Z);return te=(V={},V[m]=te/12,V[d]=te,V[f]=te/3,V[h]=(ne-Q)/6048e5,V[c]=(ne-Q)/864e5,V[l]=ne/s,V[a]=ne/r,V[o]=ne/i,V)[k]||ne,D?te:G.a(te)},ee.daysInMonth=function(){return this.endOf(d).$D},ee.$locale=function(){return O[this.$L]},ee.locale=function(K,Y){if(!K)return this.$L;var D=this.clone(),V=L(K,Y,!0);return V&&(D.$L=V),D},ee.clone=function(){return G.w(this.$d,this)},ee.toDate=function(){return new Date(this.valueOf())},ee.toJSON=function(){return this.isValid()?this.toISOString():null},ee.toISOString=function(){return this.$d.toISOString()},ee.toString=function(){return this.$d.toUTCString()},ie}(),q=j.prototype;return B.prototype=q,[["$ms",n],["$s",o],["$m",a],["$H",l],["$W",c],["$M",d],["$y",m],["$D",g]].forEach(function(ie){q[ie[1]]=function(ee){return this.$g(ee,ie[0],ie[1])}}),B.extend=function(ie,ee){return ie.$i||(ie(ee,j,B),ie.$i=!0),B},B.locale=L,B.isDayjs=U,B.unix=function(ie){return B(1e3*ie)},B.en=O[R],B.Ls=O,B.p={},B})})(zkt);const Bkt=wk;function g6e(t,e){return function(){return t.apply(e,arguments)}}const{toString:y6e}=Object.prototype,{getPrototypeOf:_oe}=Object,voe=(t=>e=>{const i=y6e.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),gv=t=>(t=t.toLowerCase(),e=>voe(e)===t),uB=t=>e=>typeof e===t,{isArray:cO}=Array,OL=uB("undefined");function Gkt(t){return t!==null&&!OL(t)&&t.constructor!==null&&!OL(t.constructor)&&mw(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const _6e=gv("ArrayBuffer");function jkt(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&_6e(t.buffer),e}const Hkt=uB("string"),mw=uB("function"),v6e=uB("number"),boe=t=>t!==null&&typeof t=="object",qkt=t=>t===!0||t===!1,$8=t=>{if(voe(t)!=="object")return!1;const e=_oe(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Wkt=gv("Date"),Ykt=gv("File"),Xkt=gv("Blob"),Zkt=gv("FileList"),Jkt=t=>boe(t)&&mw(t.pipe),Kkt=t=>{const e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||y6e.call(t)===e||mw(t.toString)&&t.toString()===e)},Qkt=gv("URLSearchParams"),eVt=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function jD(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),cO(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const n=i?Object.getOwnPropertyNames(t):Object.keys(t),o=n.length;let a;for(r=0;r<o;r++)a=n[r],e.call(null,t[a],a,t)}}function b6e(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,s;for(;r-- >0;)if(s=i[r],e===s.toLowerCase())return s;return null}const w6e=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),x6e=t=>!OL(t)&&t!==w6e;function WQ(){const{caseless:t}=x6e(this)&&this||{},e={},i=(r,s)=>{const n=t&&b6e(e,s)||s;$8(e[n])&&$8(r)?e[n]=WQ(e[n],r):$8(r)?e[n]=WQ({},r):cO(r)?e[n]=r.slice():e[n]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&jD(arguments[r],i);return e}const tVt=(t,e,i,{allOwnKeys:r}={})=>(jD(e,(s,n)=>{i&&mw(s)?t[n]=g6e(s,i):t[n]=s},{allOwnKeys:r}),t),iVt=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),rVt=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},sVt=(t,e,i,r)=>{let s,n,o;const a={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),n=s.length;n-- >0;)o=s[n],(!r||r(o,t,e))&&!a[o]&&(e[o]=t[o],a[o]=!0);t=i!==!1&&_oe(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},nVt=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},oVt=t=>{if(!t)return null;if(cO(t))return t;let e=t.length;if(!v6e(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},aVt=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&_oe(Uint8Array)),lVt=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const n=s.value;e.call(t,n[0],n[1])}},cVt=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},uVt=gv("HTMLFormElement"),hVt=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,s){return r.toUpperCase()+s}),Lve=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),dVt=gv("RegExp"),T6e=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};jD(i,(s,n)=>{e(s,n,t)!==!1&&(r[n]=s)}),Object.defineProperties(t,r)},pVt=t=>{T6e(t,(e,i)=>{if(mw(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(mw(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},fVt=(t,e)=>{const i={},r=s=>{s.forEach(n=>{i[n]=!0})};return cO(t)?r(t):r(String(t).split(e)),i},mVt=()=>{},gVt=(t,e)=>(t=+t,Number.isFinite(t)?t:e),iq="abcdefghijklmnopqrstuvwxyz",Dve="0123456789",S6e={DIGIT:Dve,ALPHA:iq,ALPHA_DIGIT:iq+iq.toUpperCase()+Dve},yVt=(t=16,e=S6e.ALPHA_DIGIT)=>{let i="";const{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function _Vt(t){return!!(t&&mw(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const vVt=t=>{const e=new Array(10),i=(r,s)=>{if(boe(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const n=cO(r)?[]:{};return jD(r,(o,a)=>{const l=i(o,s+1);!OL(l)&&(n[a]=l)}),e[s]=void 0,n}}return r};return i(t,0)},$e={isArray:cO,isArrayBuffer:_6e,isBuffer:Gkt,isFormData:Kkt,isArrayBufferView:jkt,isString:Hkt,isNumber:v6e,isBoolean:qkt,isObject:boe,isPlainObject:$8,isUndefined:OL,isDate:Wkt,isFile:Ykt,isBlob:Xkt,isRegExp:dVt,isFunction:mw,isStream:Jkt,isURLSearchParams:Qkt,isTypedArray:aVt,isFileList:Zkt,forEach:jD,merge:WQ,extend:tVt,trim:eVt,stripBOM:iVt,inherits:rVt,toFlatObject:sVt,kindOf:voe,kindOfTest:gv,endsWith:nVt,toArray:oVt,forEachEntry:lVt,matchAll:cVt,isHTMLForm:uVt,hasOwnProperty:Lve,hasOwnProp:Lve,reduceDescriptors:T6e,freezeMethods:pVt,toObjectSet:fVt,toCamelCase:hVt,noop:mVt,toFiniteNumber:gVt,findKey:b6e,global:w6e,isContextDefined:x6e,ALPHABET:S6e,generateString:yVt,isSpecCompliantForm:_Vt,toJSONObject:vVt};function Qr(t,e,i,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),s&&(this.response=s)}$e.inherits(Qr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$e.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const E6e=Qr.prototype,C6e={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{C6e[t]={value:t}});Object.defineProperties(Qr,C6e);Object.defineProperty(E6e,"isAxiosError",{value:!0});Qr.from=(t,e,i,r,s,n)=>{const o=Object.create(E6e);return $e.toFlatObject(t,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),Qr.call(o,t.message,e,i,r,s),o.cause=t,o.name=t.name,n&&Object.assign(o,n),o};const bVt=null;function YQ(t){return $e.isPlainObject(t)||$e.isArray(t)}function M6e(t){return $e.endsWith(t,"[]")?t.slice(0,-2):t}function Nve(t,e,i){return t?t.concat(e).map(function(s,n){return s=M6e(s),!i&&n?"["+s+"]":s}).join(i?".":""):e}function wVt(t){return $e.isArray(t)&&!t.some(YQ)}const xVt=$e.toFlatObject($e,{},null,function(e){return/^is[A-Z]/.test(e)});function hB(t,e,i){if(!$e.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=$e.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,v){return!$e.isUndefined(v[y])});const r=i.metaTokens,s=i.visitor||h,n=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&$e.isSpecCompliantForm(e);if(!$e.isFunction(s))throw new TypeError("visitor must be a function");function c(g){if(g===null)return"";if($e.isDate(g))return g.toISOString();if(!l&&$e.isBlob(g))throw new Qr("Blob is not supported. Use a Buffer instead.");return $e.isArrayBuffer(g)||$e.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function h(g,y,v){let x=g;if(g&&!v&&typeof g=="object"){if($e.endsWith(y,"{}"))y=r?y:y.slice(0,-2),g=JSON.stringify(g);else if($e.isArray(g)&&wVt(g)||($e.isFileList(g)||$e.endsWith(y,"[]"))&&(x=$e.toArray(g)))return y=M6e(y),x.forEach(function(E,C){!($e.isUndefined(E)||E===null)&&e.append(o===!0?Nve([y],C,n):o===null?y:y+"[]",c(E))}),!1}return YQ(g)?!0:(e.append(Nve(v,y,n),c(g)),!1)}const d=[],f=Object.assign(xVt,{defaultVisitor:h,convertValue:c,isVisitable:YQ});function m(g,y){if(!$e.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(g),$e.forEach(g,function(x,S){(!($e.isUndefined(x)||x===null)&&s.call(e,x,$e.isString(S)?S.trim():S,y,f))===!0&&m(x,y?y.concat(S):[S])}),d.pop()}}if(!$e.isObject(t))throw new TypeError("data must be an object");return m(t),e}function Fve(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function woe(t,e){this._pairs=[],t&&hB(t,this,e)}const A6e=woe.prototype;A6e.append=function(e,i){this._pairs.push([e,i])};A6e.toString=function(e){const i=e?function(r){return e.call(this,r,Fve)}:Fve;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};function TVt(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function O6e(t,e,i){if(!e)return t;const r=i&&i.encode||TVt,s=i&&i.serialize;let n;if(s?n=s(e,i):n=$e.isURLSearchParams(e)?e.toString():new woe(e,i).toString(r),n){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+n}return t}class SVt{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$e.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Uve=SVt,R6e={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},EVt=typeof URLSearchParams<"u"?URLSearchParams:woe,CVt=typeof FormData<"u"?FormData:null,MVt=typeof Blob<"u"?Blob:null,AVt=(()=>{let t;return typeof navigator<"u"&&((t=navigator.product)==="ReactNative"||t==="NativeScript"||t==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),OVt=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),oy={isBrowser:!0,classes:{URLSearchParams:EVt,FormData:CVt,Blob:MVt},isStandardBrowserEnv:AVt,isStandardBrowserWebWorkerEnv:OVt,protocols:["http","https","file","blob","url","data"]};function RVt(t,e){return hB(t,new oy.classes.URLSearchParams,Object.assign({visitor:function(i,r,s,n){return oy.isNode&&$e.isBuffer(i)?(this.append(r,i.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},e))}function PVt(t){return $e.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function IVt(t){const e={},i=Object.keys(t);let r;const s=i.length;let n;for(r=0;r<s;r++)n=i[r],e[n]=t[n];return e}function P6e(t){function e(i,r,s,n){let o=i[n++];const a=Number.isFinite(+o),l=n>=i.length;return o=!o&&$e.isArray(s)?s.length:o,l?($e.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!a):((!s[o]||!$e.isObject(s[o]))&&(s[o]=[]),e(i,r,s[o],n)&&$e.isArray(s[o])&&(s[o]=IVt(s[o])),!a)}if($e.isFormData(t)&&$e.isFunction(t.entries)){const i={};return $e.forEachEntry(t,(r,s)=>{e(PVt(r),s,i,0)}),i}return null}const $Vt={"Content-Type":void 0};function LVt(t,e,i){if($e.isString(t))try{return(e||JSON.parse)(t),$e.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const dB={transitional:R6e,adapter:["xhr","http"],transformRequest:[function(e,i){const r=i.getContentType()||"",s=r.indexOf("application/json")>-1,n=$e.isObject(e);if(n&&$e.isHTMLForm(e)&&(e=new FormData(e)),$e.isFormData(e))return s&&s?JSON.stringify(P6e(e)):e;if($e.isArrayBuffer(e)||$e.isBuffer(e)||$e.isStream(e)||$e.isFile(e)||$e.isBlob(e))return e;if($e.isArrayBufferView(e))return e.buffer;if($e.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return RVt(e,this.formSerializer).toString();if((a=$e.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return hB(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return n||s?(i.setContentType("application/json",!1),LVt(e)):e}],transformResponse:[function(e){const i=this.transitional||dB.transitional,r=i&&i.forcedJSONParsing,s=this.responseType==="json";if(e&&$e.isString(e)&&(r&&!this.responseType||s)){const o=!(i&&i.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?Qr.from(a,Qr.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:oy.classes.FormData,Blob:oy.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};$e.forEach(["delete","get","head"],function(e){dB.headers[e]={}});$e.forEach(["post","put","patch"],function(e){dB.headers[e]=$e.merge($Vt)});const xoe=dB,DVt=$e.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),NVt=t=>{const e={};let i,r,s;return t&&t.split(`
`).forEach(function(o){s=o.indexOf(":"),i=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!i||e[i]&&DVt[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},kve=Symbol("internals");function LR(t){return t&&String(t).trim().toLowerCase()}function L8(t){return t===!1||t==null?t:$e.isArray(t)?t.map(L8):String(t)}function FVt(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}function UVt(t){return/^[-_a-zA-Z]+$/.test(t.trim())}function rq(t,e,i,r,s){if($e.isFunction(r))return r.call(this,e,i);if(s&&(e=i),!!$e.isString(e)){if($e.isString(r))return e.indexOf(r)!==-1;if($e.isRegExp(r))return r.test(e)}}function kVt(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function VVt(t,e){const i=$e.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(s,n,o){return this[r].call(this,e,s,n,o)},configurable:!0})})}class pB{constructor(e){e&&this.set(e)}set(e,i,r){const s=this;function n(a,l,c){const h=LR(l);if(!h)throw new Error("header name must be a non-empty string");const d=$e.findKey(s,h);(!d||s[d]===void 0||c===!0||c===void 0&&s[d]!==!1)&&(s[d||l]=L8(a))}const o=(a,l)=>$e.forEach(a,(c,h)=>n(c,h,l));return $e.isPlainObject(e)||e instanceof this.constructor?o(e,i):$e.isString(e)&&(e=e.trim())&&!UVt(e)?o(NVt(e),i):e!=null&&n(i,e,r),this}get(e,i){if(e=LR(e),e){const r=$e.findKey(this,e);if(r){const s=this[r];if(!i)return s;if(i===!0)return FVt(s);if($e.isFunction(i))return i.call(this,s,r);if($e.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=LR(e),e){const r=$e.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||rq(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let s=!1;function n(o){if(o=LR(o),o){const a=$e.findKey(r,o);a&&(!i||rq(r,r[a],a,i))&&(delete r[a],s=!0)}}return $e.isArray(e)?e.forEach(n):n(e),s}clear(e){const i=Object.keys(this);let r=i.length,s=!1;for(;r--;){const n=i[r];(!e||rq(this,this[n],n,e,!0))&&(delete this[n],s=!0)}return s}normalize(e){const i=this,r={};return $e.forEach(this,(s,n)=>{const o=$e.findKey(r,n);if(o){i[o]=L8(s),delete i[n];return}const a=e?kVt(n):String(n).trim();a!==n&&delete i[n],i[a]=L8(s),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return $e.forEach(this,(r,s)=>{r!=null&&r!==!1&&(i[s]=e&&$e.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[kve]=this[kve]={accessors:{}}).accessors,s=this.prototype;function n(o){const a=LR(o);r[a]||(VVt(s,o),r[a]=!0)}return $e.isArray(e)?e.forEach(n):n(e),this}}pB.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);$e.freezeMethods(pB.prototype);$e.freezeMethods(pB);const $_=pB;function sq(t,e){const i=this||xoe,r=e||i,s=$_.from(r.headers);let n=r.data;return $e.forEach(t,function(a){n=a.call(i,n,s.normalize(),e?e.status:void 0)}),s.normalize(),n}function I6e(t){return!!(t&&t.__CANCEL__)}function HD(t,e,i){Qr.call(this,t??"canceled",Qr.ERR_CANCELED,e,i),this.name="CanceledError"}$e.inherits(HD,Qr,{__CANCEL__:!0});function zVt(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Qr("Request failed with status code "+i.status,[Qr.ERR_BAD_REQUEST,Qr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const BVt=oy.isStandardBrowserEnv?function(){return{write:function(i,r,s,n,o,a){const l=[];l.push(i+"="+encodeURIComponent(r)),$e.isNumber(s)&&l.push("expires="+new Date(s).toGMTString()),$e.isString(n)&&l.push("path="+n),$e.isString(o)&&l.push("domain="+o),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(i){const r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function GVt(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function jVt(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}function $6e(t,e){return t&&!GVt(e)?jVt(t,e):e}const HVt=oy.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let r;function s(n){let o=n;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=s(window.location.href),function(o){const a=$e.isString(o)?s(o):o;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}();function qVt(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function WVt(t,e){t=t||10;const i=new Array(t),r=new Array(t);let s=0,n=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),h=r[n];o||(o=c),i[s]=l,r[s]=c;let d=n,f=0;for(;d!==s;)f+=i[d++],d=d%t;if(s=(s+1)%t,s===n&&(n=(n+1)%t),c-o<e)return;const m=h&&c-h;return m?Math.round(f*1e3/m):void 0}}function Vve(t,e){let i=0;const r=WVt(50,250);return s=>{const n=s.loaded,o=s.lengthComputable?s.total:void 0,a=n-i,l=r(a),c=n<=o;i=n;const h={loaded:n,total:o,progress:o?n/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&c?(o-n)/l:void 0,event:s};h[e?"download":"upload"]=!0,t(h)}}const YVt=typeof XMLHttpRequest<"u",XVt=YVt&&function(t){return new Promise(function(i,r){let s=t.data;const n=$_.from(t.headers).normalize(),o=t.responseType;let a;function l(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}$e.isFormData(s)&&(oy.isStandardBrowserEnv||oy.isStandardBrowserWebWorkerEnv)&&n.setContentType(!1);let c=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";n.set("Authorization","Basic "+btoa(m+":"+g))}const h=$6e(t.baseURL,t.url);c.open(t.method.toUpperCase(),O6e(h,t.params,t.paramsSerializer),!0),c.timeout=t.timeout;function d(){if(!c)return;const m=$_.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),y={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:m,config:t,request:c};zVt(function(x){i(x),l()},function(x){r(x),l()},y),c=null}if("onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(d)},c.onabort=function(){c&&(r(new Qr("Request aborted",Qr.ECONNABORTED,t,c)),c=null)},c.onerror=function(){r(new Qr("Network Error",Qr.ERR_NETWORK,t,c)),c=null},c.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const y=t.transitional||R6e;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),r(new Qr(g,y.clarifyTimeoutError?Qr.ETIMEDOUT:Qr.ECONNABORTED,t,c)),c=null},oy.isStandardBrowserEnv){const m=(t.withCredentials||HVt(h))&&t.xsrfCookieName&&BVt.read(t.xsrfCookieName);m&&n.set(t.xsrfHeaderName,m)}s===void 0&&n.setContentType(null),"setRequestHeader"in c&&$e.forEach(n.toJSON(),function(g,y){c.setRequestHeader(y,g)}),$e.isUndefined(t.withCredentials)||(c.withCredentials=!!t.withCredentials),o&&o!=="json"&&(c.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&c.addEventListener("progress",Vve(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Vve(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=m=>{c&&(r(!m||m.type?new HD(null,t,c):m),c.abort(),c=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const f=qVt(h);if(f&&oy.protocols.indexOf(f)===-1){r(new Qr("Unsupported protocol "+f+":",Qr.ERR_BAD_REQUEST,t));return}c.send(s||null)})},D8={http:bVt,xhr:XVt};$e.forEach(D8,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ZVt={getAdapter:t=>{t=$e.isArray(t)?t:[t];const{length:e}=t;let i,r;for(let s=0;s<e&&(i=t[s],!(r=$e.isString(i)?D8[i.toLowerCase()]:i));s++);if(!r)throw r===!1?new Qr(`Adapter ${i} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error($e.hasOwnProp(D8,i)?`Adapter '${i}' is not available in the build`:`Unknown adapter '${i}'`);if(!$e.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:D8};function nq(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new HD(null,t)}function zve(t){return nq(t),t.headers=$_.from(t.headers),t.data=sq.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),ZVt.getAdapter(t.adapter||xoe.adapter)(t).then(function(r){return nq(t),r.data=sq.call(t,t.transformResponse,r),r.headers=$_.from(r.headers),r},function(r){return I6e(r)||(nq(t),r&&r.response&&(r.response.data=sq.call(t,t.transformResponse,r.response),r.response.headers=$_.from(r.response.headers))),Promise.reject(r)})}const Bve=t=>t instanceof $_?t.toJSON():t;function g3(t,e){e=e||{};const i={};function r(c,h,d){return $e.isPlainObject(c)&&$e.isPlainObject(h)?$e.merge.call({caseless:d},c,h):$e.isPlainObject(h)?$e.merge({},h):$e.isArray(h)?h.slice():h}function s(c,h,d){if($e.isUndefined(h)){if(!$e.isUndefined(c))return r(void 0,c,d)}else return r(c,h,d)}function n(c,h){if(!$e.isUndefined(h))return r(void 0,h)}function o(c,h){if($e.isUndefined(h)){if(!$e.isUndefined(c))return r(void 0,c)}else return r(void 0,h)}function a(c,h,d){if(d in e)return r(c,h);if(d in t)return r(void 0,c)}const l={url:n,method:n,data:n,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,h)=>s(Bve(c),Bve(h),!0)};return $e.forEach(Object.keys(t).concat(Object.keys(e)),function(h){const d=l[h]||s,f=d(t[h],e[h],h);$e.isUndefined(f)&&d!==a||(i[h]=f)}),i}const L6e="1.3.4",Toe={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Toe[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Gve={};Toe.transitional=function(e,i,r){function s(n,o){return"[Axios v"+L6e+"] Transitional option '"+n+"'"+o+(r?". "+r:"")}return(n,o,a)=>{if(e===!1)throw new Qr(s(o," has been removed"+(i?" in "+i:"")),Qr.ERR_DEPRECATED);return i&&!Gve[o]&&(Gve[o]=!0,console.warn(s(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(n,o,a):!0}};function JVt(t,e,i){if(typeof t!="object")throw new Qr("options must be an object",Qr.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const n=r[s],o=e[n];if(o){const a=t[n],l=a===void 0||o(a,n,t);if(l!==!0)throw new Qr("option "+n+" must be "+l,Qr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Qr("Unknown option "+n,Qr.ERR_BAD_OPTION)}}const XQ={assertOptions:JVt,validators:Toe},a1=XQ.validators;class xk{constructor(e){this.defaults=e,this.interceptors={request:new Uve,response:new Uve}}request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=g3(this.defaults,i);const{transitional:r,paramsSerializer:s,headers:n}=i;r!==void 0&&XQ.assertOptions(r,{silentJSONParsing:a1.transitional(a1.boolean),forcedJSONParsing:a1.transitional(a1.boolean),clarifyTimeoutError:a1.transitional(a1.boolean)},!1),s!==void 0&&XQ.assertOptions(s,{encode:a1.function,serialize:a1.function},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o;o=n&&$e.merge(n.common,n[i.method]),o&&$e.forEach(["delete","get","head","post","put","patch","common"],g=>{delete n[g]}),i.headers=$_.concat(o,n);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(i)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let h,d=0,f;if(!l){const g=[zve.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,c),f=g.length,h=Promise.resolve(i);d<f;)h=h.then(g[d++],g[d++]);return h}f=a.length;let m=i;for(d=0;d<f;){const g=a[d++],y=a[d++];try{m=g(m)}catch(v){y.call(this,v);break}}try{h=zve.call(this,m)}catch(g){return Promise.reject(g)}for(d=0,f=c.length;d<f;)h=h.then(c[d++],c[d++]);return h}getUri(e){e=g3(this.defaults,e);const i=$6e(e.baseURL,e.url);return O6e(i,e.params,e.paramsSerializer)}}$e.forEach(["delete","get","head","options"],function(e){xk.prototype[e]=function(i,r){return this.request(g3(r||{},{method:e,url:i,data:(r||{}).data}))}});$e.forEach(["post","put","patch"],function(e){function i(r){return function(n,o,a){return this.request(g3(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}xk.prototype[e]=i(),xk.prototype[e+"Form"]=i(!0)});const N8=xk;class Soe{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(n){i=n});const r=this;this.promise.then(s=>{if(!r._listeners)return;let n=r._listeners.length;for(;n-- >0;)r._listeners[n](s);r._listeners=null}),this.promise.then=s=>{let n;const o=new Promise(a=>{r.subscribe(a),n=a}).then(s);return o.cancel=function(){r.unsubscribe(n)},o},e(function(n,o,a){r.reason||(r.reason=new HD(n,o,a),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new Soe(function(s){e=s}),cancel:e}}}const KVt=Soe;function QVt(t){return function(i){return t.apply(null,i)}}function ezt(t){return $e.isObject(t)&&t.isAxiosError===!0}const ZQ={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ZQ).forEach(([t,e])=>{ZQ[e]=t});const tzt=ZQ;function D6e(t){const e=new N8(t),i=g6e(N8.prototype.request,e);return $e.extend(i,N8.prototype,e,{allOwnKeys:!0}),$e.extend(i,e,null,{allOwnKeys:!0}),i.create=function(s){return D6e(g3(t,s))},i}const ja=D6e(xoe);ja.Axios=N8;ja.CanceledError=HD;ja.CancelToken=KVt;ja.isCancel=I6e;ja.VERSION=L6e;ja.toFormData=hB;ja.AxiosError=Qr;ja.Cancel=ja.CanceledError;ja.all=function(e){return Promise.all(e)};ja.spread=QVt;ja.isAxiosError=ezt;ja.mergeConfig=g3;ja.AxiosHeaders=$_;ja.formToJSON=t=>P6e($e.isHTMLForm(t)?new FormData(t):t);ja.HttpStatusCode=tzt;ja.default=ja;const izt=ja,rzt=t=>fB(t.value.children[0]),fB=t=>{if(!t)return null;const e={};switch(t.type){case"ELEMENT":{let i={};const r=ozt(t.value.attributes),s=fB(t.value.children);if(r&&(i=Object.assign(i,r)),s){const n=szt(t.value.children);i=Object.assign(i,n)}e[t.value.type]=i;break}case"ATTRIBUTE":{const i=t.value;e[i.name]=i.value;break}}return e},szt=t=>!t||!Array.isArray(t)||t.length===0?null:nzt(t)?{content:t[0].value}:{children:t.map(fB)},nzt=t=>t&&Array.isArray(t)&&t.length===1&&t[0].type==="CONTENT",ozt=t=>t&&Array.isArray(t)?t.map(fB).reduce((i,r)=>Object.assign(i,r),{}):null;var azt={convert:rzt};const lzt={OPEN_BRACKET:"OPEN_BRACKET",ELEMENT_TYPE:"ELEMENT_TYPE",CLOSE_ELEMENT:"CLOSE_ELEMENT",ATTRIB_NAME:"ATTRIB_NAME",ATTRIB_VALUE:"ATTRIB_VALUE",ASSIGN:"ASSIGN",CLOSE_BRACKET:"CLOSE_BRACKET",CONTENT:"CONTENT",EOF:"EOF"},czt=(t,e)=>({type:t,value:e});var N6e={Token:czt,TOKEN_TYPE:lzt};const{Token:Vf,TOKEN_TYPE:ec}=N6e,jve=Vf("EOF"),F6e=t=>t===" "||t===`
`||t==="\r"||t==="	",uzt=(t,e)=>{if(t.startsWith("<?xml",e)){const i=t.length;for(;e<i;)if(t[e]!=="?")e++;else{if(t[e+1]===">")return e+2;e++}}return e},Hve=t=>t.replace(/'/g,'"'),hzt=t=>{let e=0;for(;e<t.length&&F6e(t[e]);)e++;return uzt(t,e)};function dzt(t){let e=null,i=hzt(t);const r=()=>t[i],s=()=>e!==jve&&i<t.length,n=()=>F6e(t[i]),o=()=>{s()&&a(r())&&i++},a=g=>g==='"'||g==="'",l=()=>{for(;s()&&n();)i++},c=g=>{if(s()){if(t[i]==="<"){let y="<";return i++,s()&&t[i]==="/"?(i++,y="</"):s()&&t[i]==="!"&&t[i+1]==="-"&&t[i+2]==="-"&&(i++,i++,i++,y="<!--"),y}else if(t[i]==="="||t[i]===">"){const y=t[i];return i++,y}}return h(!!g)},h=g=>{const x=g?/[^>=<]/u:/[a-zA-Z0-9_:\-]/;let S=i;for(;s()&&t[i].match(x);)i++;return Hve(t.substring(S,i))},d=()=>e&&e.type===ec.OPEN_BRACKET,f=()=>e&&e.type===ec.ASSIGN,m=()=>{const g=i;l();const y=i-g;if(!s())e=jve;else if(d()){l();const v=c(!1);e=Vf(ec.ELEMENT_TYPE,v)}else if(f()){o();let v=i;for(;s()&&!a(r());)i++;const x=Hve(t.substring(v,i));i++,e=Vf(ec.ATTRIB_VALUE,x)}else{l();let v=c(!0);switch(v){case"=":{e.type===ec.ATTRIB_NAME?e=Vf(ec.ASSIGN):e=Vf(ec.CONTENT,v);break}case"</":{const x=i;for(;t[i]!==">";)i++;e=Vf(ec.CLOSE_ELEMENT,t.substring(x,i)),i++;break}case"<!--":{const x=["!","-","-"];for(;s()&&(x[2]!==">"||x[1]!=="-"||x[0]!=="-");)x.shift(),x.push(t[i]),i++;return m()}case">":{e=Vf(ec.CLOSE_BRACKET);break}case"<":{e=Vf(ec.OPEN_BRACKET);break}default:if(v&&v.length>0){if(e.type===ec.CLOSE_BRACKET){let x="";r()!=="<"&&(x=h(!0)),e=Vf(ec.CONTENT,v+x)}else if(e.type!==ec.ATTRIB_NAME&&e.type!==ec.CONTENT)e=Vf(ec.ATTRIB_NAME,v);else{const x=" ".repeat(y)+v;e=Vf(ec.CONTENT,x)}break}else{const x='Unknown Syntax : "'+t[i]+'"';throw new Error(x)}}}return e};return{peek:r,next:m,hasNext:s}}var pzt={createLexer:dzt};const{createLexer:fzt}=pzt,{Token:mzt,TOKEN_TYPE:KT}=N6e,[qve,gzt,yzt,_zt]=["ROOT","ELEMENT","ATTRIBUTE","CONTENT"],qD=(t,e)=>({type:t,value:e}),Wve=t=>qD(_zt,t),U6e=(t,e,i)=>qD(gzt,{type:t,attributes:e,children:i}),k6e=(t,e)=>qD(yzt,{name:t,value:e}),vzt=t=>qD(qve,{children:V6e(t,mzt(qve,"ROOT"))}),V6e=(t,e)=>{const i=[];for(;t.hasNext();){const r=t.next();switch(r.type){case KT.OPEN_BRACKET:{const s=t.next(),n=bzt(t);let o=V6e(t,s);o&&o.length>0&&o[0].type===KT.CONTENT&&(o=[Wve(o.map(a=>a.value).join(""))]),i.push(U6e(s.value,n,o));break}case KT.CLOSE_ELEMENT:{if(r.value===e.value)return i;break}case KT.CONTENT:{i.push(Wve(r.value));break}case KT.EOF:return i;default:throw new Error("Unknown Lexem type: "+r.type)}}return i},bzt=t=>{const e=[];let i=t.peek();if(!t.hasNext()||i&&i.type===KT.CLOSE_BRACKET)return e;for(i=t.next();t.hasNext()&&i&&i.type!==KT.CLOSE_BRACKET;){const r=i;t.next();const s=t.next(),n=k6e(r.value,s.value);e.push(n),i=t.next()}return e};function wzt(t,e){const i=fzt(t),r=vzt(i);return e?e.convert(r):r}var xzt={transpile:wzt,Node:qD,ElementNode:U6e,AttribNode:k6e};const Tzt=azt,{transpile:z6e}=xzt;function Szt(t,e){return z6e(t,e||Tzt)}function Ezt(t){return z6e(t)}var Czt={convertXML:Szt,createAST:Ezt},Yve={},Mzt={get exports(){return Yve},set exports(t){Yve=t}};(function(t,e){(function(i,r){t.exports=r(wk)})(m6e,function(i){function r(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var s=r(i),n={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(o,a){return a==="W"?o+"周":o+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(o,a){var l=100*o+a;return l<600?"凌晨":l<900?"早上":l<1100?"上午":l<1300?"中午":l<1800?"下午":"晚上"}};return s.default.locale(n,null,!0),n})})(Mzt);Bkt.locale("zh-cn");const Azt=document.querySelector("#layerToggle"),B6e=document.querySelector("#countySelect"),G6e=Array.from(document.querySelectorAll(".geometry-button")),Ozt="https://richimap1.richitech.com.tw/arcgis/rest/services/CBB_Practice/CBB_Practice_Town_84/MapServer",Rzt="https://richimap1.richitech.com.tw/arcgis/rest/services/CBB_Practice/CBB_Practice_POI/MapServer/1",Pzt="https://richimap1.richitech.com.tw/arcgis/rest/services/CBB_Practice/CBB_Practice_POI/MapServer/0",Izt="https://richimap1.richitech.com.tw/arcgis/services/CBB_Practice/CBB_Practice_Industry_84/MapServer/WMSServer?request=GetCapabilities&service=WMS",$zt="https://wmts.nlsc.gov.tw/wmts/EMAP2/default/GoogleMapsCompatible/{level}/{row}/{col}",Lzt="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson",Dzt="https://api.nlsc.gov.tw/other/ListCounty",Nzt="https://richimap1.richitech.com.tw/arcgis/rest/services/CBB_Practice/CBB_Practice_County_84/MapServer/0",Fzt="https://richimap1.richitech.com.tw/arcgis/rest/services/CBB_Practice/CBB_Practice_Town_84/MapServer";let j6e;const H6e=new Gk({basemap:"satellite"}),js=new fgt({container:"viewDiv",map:H6e,zoom:7,center:[121,23.5]}),Uzt=new O8t({view:js});new N8t({view:js,container:document.querySelector("#scaliDiv"),unit:"dual"});const kzt=new e5e({urlTemplate:$zt}),q6e=new Q4e({url:Ozt,sublayers:[{id:0}],title:"鄉鎮市區界",opacity:.7,visible:!1,id:1}),W6e=new kV({url:Rzt,title:"加油站",visible:!1,id:2}),Y6e=new kV({url:Pzt,title:"飯店旅館",visible:!1,id:3}),X6e=new n5e({url:Izt,title:"工業區範圍",visible:!1,id:4}),Vzt={type:"simple",field:"*",symbol:{type:"simple-marker",outline:{color:"white"}},visualVariables:[{type:"size",field:"mag",stops:[{value:3,size:"4px"},{value:7,size:"40px"}]},{type:"color",field:"mag",stops:[{value:3,color:"#FFF143"},{value:7,color:"#E10800"}]}]},zzt={title:"地震資訊",content:"地震規模：{mag}</br>地震時間：{expression/formatDate}",expressionInfos:[{name:"formatDate",title:"Format Date",expression:`var date = Date($feature.time)
             return Text(date, "YYYY/MM/DD a hh:mm")`}]},Z6e=new a5e({url:Lzt,popupTemplate:zzt,definitionExpression:"mag >= 3",copyright:"lilys map",renderer:Vzt,title:"近一個月地震",visible:!1,id:6}),Eoe=new nB,gS=new Ikt({layer:Eoe,view:js,updateOnGraphicClick:!1,pointSymbol:{type:"simple-marker",style:"circle",size:10,color:[211,132,80,.7],outline:{color:[255,255,255,.8],size:10}},polylineSymbol:{type:"simple-line",color:[211,132,80,.7],width:6},polygonSymbol:{type:"simple-fill",color:[211,132,80,.7],outline:{color:[255,255,255,.8],size:"10px"}}}),Coe=new nB,mB=new nB;let Xve=new _o({returnGeometry:!0,outFields:["*"]}),Hg,J6e;const uO=new Gk;uO.set("countyLayer",q6e);uO.set("gasStationLayer",W6e);uO.set("hotelLayer",Y6e);uO.set("industryLayer",X6e);uO.set("earthquakeLayer",Z6e);H6e.addMany([q6e,Coe,kzt,X6e,W6e,Y6e,Z6e,mB,Eoe]);js.on("pointer-move",Bzt);js.watch("extent",Gzt);js.when(()=>{Hzt(),tBt(),iBt(),Qzt()});js.ui.add("sketchDiv","top-right");js.ui.add(Uzt,"top-right");js.ui.add("layerToggle","top-left");js.ui.add("mapInfoDiv","bottom-right");js.ui.add("transform","bottom-right");js.ui.add("optionsDiv","bottom-left");js.ui.add("toggleIdentifyDiv","bottom-left");js.ui.move("zoom","top-right");function Bzt(t){let e=js.toMap({x:t.x,y:t.y});document.querySelector("#xyDiv").innerText=Moe(e.longitude,e.latitude)}function Gzt(){let t=js.extent;document.querySelector("#extentDiv").innerHTML=`xmin : ${t.xmin.toFixed(2)}</br>ymin : ${t.ymin.toFixed(2)}</br>xmax : ${t.xmax.toFixed(2)}</br>ymax : ${t.ymax.toFixed(2)}`}function jzt(t){if(t.target.tagName==="INPUT"){let e=t.target.id;uO.get(e).visible=t.target.checked}}function Hzt(){izt.get(Dzt).then(t=>{j6e=Czt.convertXML(t.data).countyItems.children.map(i=>({countyname:i.countyItem.children[1].countyname.content,countycode01:i.countyItem.children[2].countycode01.content})),qzt()})}function qzt(){j6e.forEach(t=>{B6e.innerHTML+=`<option value="${t.countycode01}">${t.countyname}</option>`})}function Wzt(){Coe.removeAll(),Xve.where=`COUNTYCODE =  '${B6e.value}'`,u6(Nzt,Xve).then(Yzt).catch(Kzt)}function Yzt(t){console.log(t);const e=t.features.map(i=>(i.symbol={type:"simple-fill",color:[227,188,0,.7]},i));Coe.addMany(e),js.goTo(e)}function Xzt(t){mB.removeAll(),J6e=t.mapPoint,Hg.geometry=t.mapPoint,Hg.mapExtent=js.extent,document.querySelector("#viewDiv").style.cursor="wait",Fkt(Fzt,Hg).then(Zzt).then(Jzt)}function Zzt(t){const e=t.results.map(i=>{let r=i.feature;return r.popupTemplate={title:r.attributes.COUNTYNAME,content:r.attributes.TOWNNAME},r.symbol={type:"simple-fill",color:[0,188,255,.7]},mB.add(r),r});return js.goTo(e),e}function Jzt(t){console.log("identify",t),t.length>0&&(console.log(t),js.popup.open({features:t,location:J6e})),document.getElementById("viewDiv").style.cursor="auto"}function Kzt(t){console.error("Promise rejected: ",t.message)}function Qzt(){Hg=new f6e,Hg.tolerance=3,Hg.layerIds=[0],Hg.layerOption="all",Hg.width=js.width,Hg.height=js.height,Hg.returnGeometry=!0}let Zve;function eBt(t){t.target.checked?Zve=js.on("click",Xzt):(mB.removeAll(),Zve.remove(),js.popup.close())}function tBt(){Azt.addEventListener("click",jzt,!1),document.querySelector("#doBtn").addEventListener("click",Wzt),document.querySelector("#toggleIdentify").addEventListener("click",eBt),G6e.forEach(t=>{t.addEventListener("click",rBt)}),document.querySelector("#transformBtn").addEventListener("click",oBt)}function iBt(){document.querySelector("#xyDiv").innerText=Moe(js.center.longitude,js.center.latitude)}let F8,h$;function rBt(t){let e=t.target.classList;G6e.forEach(i=>i.classList.remove("active")),gS.cancel(),e.contains("draw-btn")?(h$="",sBt(t)):e.contains("update-btn")&&(F8="",nBt(t))}function sBt(t){let e=t.target;F8===e.value?F8="":(gS.create(e.value),e.classList.add("active"),F8=e.value)}function nBt(t){let e=t.target;h$===e.value?(h$="",gS.updateOnGraphicClick=!1):(e.classList.add("active"),gS.updateOnGraphicClick="update",h$=t.target.value)}let Jve=0;gS.on("create",t=>{t.state==="complete"&&(Jve++,t.graphic.popupTemplate={title:Jve,content:`Name：怎麼取名?型態：${t.graphic.geometry.type}`},console.log(t.graphic),gS.create(t.tool))});gS.on("update",t=>{h$==="delete"&&Eoe.remove(t.graphics[0])});js.on("click",function(t){js.hitTest(t).then(function(e){var i=e.results[0].graphic;i&&(console.log("popup",i),js.popup.open({features:i,location:t.mapPoint}))})});const hO=new Gk;hO.set("3828","+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");hO.set("3829","+proj=lcc +lat_1=25 +lat_2=25 +lat_0=25 +lon_0=121 +k_0=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");hO.set("3826","+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");hO.set("3825","+proj=tmerc +lat_0=0 +lon_0=121 +k_0=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");hO.set("3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0 +x_0=0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");function oBt(){let t=hO.get(document.querySelector("#fromEPSG").value),e=new ch.Proj("EPSG:4326"),i=[];i.push(parseFloat(document.querySelector("#coordinateX").value)),i.push(parseFloat(document.querySelector("#coordinateY").value));let r=ch(t,e,i);document.querySelector("#resultCoordinate").value=Moe(r[0],r[1])}function Moe(t,e){return`${t.toFixed(6)}, ${e.toFixed(6)}`}export{yLt as $,qt as A,ka as B,Mt as C,zb as D,yr as E,or as F,Zt as G,AGe as H,hs as I,pc as J,m8t as K,mt as L,s9 as M,cBt as N,Tn as O,Qe as P,me as Q,Ne as R,I3e as S,F_ as T,zL as U,sr as V,J as W,is as X,en as Y,Amt as Z,dG as _,XC as a,_qt as a$,ir as a0,He as a1,lu as a2,ae as a3,ii as a4,Se as a5,jL as a6,I4t as a7,tr as a8,e8t as a9,Ho as aA,Mai as aB,Hi as aC,Tm as aD,dee as aE,W8t as aF,tat as aG,ti as aH,Jp as aI,_Ce as aJ,$2 as aK,Xai as aL,Tc as aM,Ye as aN,Mm as aO,HL as aP,es as aQ,qee as aR,mqt as aS,MGe as aT,kV as aU,hu as aV,wI as aW,du as aX,N3 as aY,yqt as aZ,gqt as a_,Wbe as aa,dy as ab,u as ac,p as ad,kl as ae,N as af,Ile as ag,Ee as ah,se as ai,Cr as aj,le as ak,H as al,Ie as am,Vs as an,am as ao,kn as ap,_t as aq,Jr as ar,t$t as as,it as at,$Oe as au,nb as av,In as aw,Wr as ax,Ga as ay,bse as az,At as b,im as b$,R7t as b0,ue as b1,QHt as b2,pat as b3,zWe as b4,Owe as b5,xt as b6,TV as b7,oet as b8,x3 as b9,Ec as bA,pe as bB,Re as bC,we as bD,En as bE,Cy as bF,np as bG,M8t as bH,Opt as bI,Swe as bJ,Gs as bK,Bb as bL,rte as bM,wd as bN,c5e as bO,tl as bP,NT as bQ,ed as bR,fa as bS,zs as bT,ukt as bU,Mo as bV,bc as bW,ws as bX,Lm as bY,Ks as bZ,HM as b_,gm as ba,vt as bb,st as bc,Dp as bd,YL as be,et as bf,nB as bg,Vo as bh,bd as bi,Vte as bj,gdt as bk,Sc as bl,ci as bm,ge as bn,sv as bo,je as bp,RS as bq,dd as br,eh as bs,be as bt,Vt as bu,iw as bv,ze as bw,xe as bx,Bs as by,us as bz,dt as c,Y2 as c$,VIt as c0,uBt as c1,RM as c2,_3t as c3,u3 as c4,GK as c5,ls as c6,ud as c7,Rr as c8,P as c9,JJe as cA,sye as cB,ts as cC,Ge as cD,sli as cE,Mvt as cF,FZt as cG,Bpe as cH,WL as cI,Et as cJ,fu as cK,NA as cL,aV as cM,wa as cN,Dm as cO,f5e as cP,SUt as cQ,bs as cR,bUt as cS,Tr as cT,VYt as cU,xD as cV,gr as cW,Q_ as cX,Tre as cY,ma as cZ,Ll as c_,fh as ca,un as cb,y3t as cc,zm as cd,ECe as ce,vUt as cf,bA as cg,_Ut as ch,nEt as ci,rli as cj,_Bt as ck,yBt as cl,_a as cm,MGt as cn,ll as co,Zk as cp,kZt as cq,VZt as cr,cV as cs,tt as ct,Ere as cu,yde as cv,LTe as cw,ln as cx,vd as cy,Ve as cz,Xt as d,ive as d$,z7t as d0,Kjt as d1,xd as d2,DZt as d3,g$ as d4,gde as d5,Ygt as d6,_de as d7,cd as d8,p5e as d9,rh as dA,T1t as dB,u1t as dC,mm as dD,fBt as dE,V7t as dF,L_ as dG,tXe as dH,EUt as dI,L2 as dJ,akt as dK,xo as dL,VM as dM,CGe as dN,QSt as dO,fYe as dP,Fl as dQ,Tpt as dR,Us as dS,ppt as dT,fpt as dU,ZV as dV,Db as dW,uh as dX,bi as dY,Rle as dZ,PA as d_,oli as da,d5 as db,Mi as dc,ih as dd,Rie as de,zr as df,qb as dg,Avt as dh,Eo as di,Td as dj,Egt as dk,vx as dl,eJt as dm,tJt as dn,m7t as dp,MYt as dq,OS as dr,ha as ds,Yg as dt,zPe as du,FA as dv,Rb as dw,lpt as dx,ire as dy,Kp as dz,_i as e,Mr as e$,VGt as e0,k7t as e1,Hn as e2,KYe as e3,Xo as e4,Es as e5,Up as e6,I_ as e7,GAe as e8,Dai as e9,hjt as eA,djt as eB,pjt as eC,njt as eD,xjt as eE,ojt as eF,vjt as eG,gjt as eH,_et as eI,Sjt as eJ,ljt as eK,fjt as eL,vtt as eM,Ug as eN,AU as eO,NSe as eP,Ae as eQ,I1e as eR,jo as eS,ol as eT,yo as eU,TA as eV,ly as eW,zbe as eX,n7t as eY,xA as eZ,UHe as e_,ZGt as ea,za as eb,hl as ec,_d as ed,ce as ee,C2e as ef,ty as eg,Dk as eh,rB as ei,xy as ej,W4e as ek,$Ke as el,I8t as em,XGt as en,q4e as eo,ali as ep,ede as eq,oB as er,uqt as es,Bp as et,ajt as eu,cjt as ev,F2e as ew,_jt as ex,_tt as ey,gtt as ez,qp as f,Jk as f$,Op as f0,Lk as f1,kL as f2,nd as f3,P5 as f4,b7t as f5,uht as f6,wLt as f7,HYt as f8,Hxe as f9,qM as fA,RIe as fB,ya as fC,jV as fD,IIe as fE,$Ie as fF,s3e as fG,n3e as fH,Lpt as fI,xWt as fJ,Hpt as fK,Ao as fL,TWt as fM,vS as fN,cHt as fO,v_ as fP,exe as fQ,zSt as fR,$Ze as fS,qKt as fT,TEe as fU,ant as fV,k$ as fW,bie as fX,dh as fY,n9 as fZ,tHt as f_,DL as fa,lp as fb,Pl as fc,jKe as fd,Sm as fe,FW as ff,_2 as fg,Lft as fh,DWt as fi,FWt as fj,rw as fk,lD as fl,vw as fm,HHt as fn,GA as fo,gq as fp,nX as fq,oL as fr,er as fs,NBt as ft,b3e as fu,P7t as fv,_re as fw,m6t as fx,Na as fy,BA as fz,Ft as g,MV as g$,bGt as g0,G7t as g1,Gmt as g2,od as g3,Om as g4,ZL as g5,XL as g6,G5e as g7,gk as g8,Bk as g9,pa as gA,bte as gB,CXe as gC,PAt as gD,uee as gE,ute as gF,LN as gG,nEe as gH,eXe as gI,r2 as gJ,yHt as gK,nnt as gL,kr as gM,sre as gN,Lot as gO,jHt as gP,Dot as gQ,BHt as gR,T3 as gS,GHt as gT,Lqt as gU,pdt as gV,wut as gW,xut as gX,Tut as gY,lot as gZ,Oot as g_,zk as ga,dqt as gb,pqt as gc,hqt as gd,XSe as ge,srt as gf,nrt as gg,Ol as gh,gI as gi,Qwe as gj,nte as gk,sXe as gl,ZYe as gm,kq as gn,ste as go,U7t as gp,B7t as gq,yp as gr,pAe as gs,gAe as gt,mAe as gu,Qht as gv,qg as gw,G$ as gx,zV as gy,vte as gz,H6t as h,iQt as h$,lht as h0,fqt as h1,zut as h2,MEe as h3,CEe as h4,dHt as h5,uHt as h6,mst as h7,gHt as h8,pX as h9,Cct as hA,Bt as hB,fb as hC,TS as hD,E3 as hE,ei as hF,JI as hG,PQt as hH,IQt as hI,V_ as hJ,ZSt as hK,q_ as hL,_o as hM,oQt as hN,sti as hO,oot as hP,$O as hQ,Sut as hR,tV as hS,Eut as hT,eD as hU,Cut as hV,iV as hW,KL as hX,$Me as hY,TZe as hZ,cqt as h_,dBt as ha,pBt as hb,QMe as hc,bS as hd,pre as he,YA as hf,wr as hg,_s as hh,lai as hi,snt as hj,EEe as hk,dw as hl,Hye as hm,_Lt as hn,dre as ho,idt as hp,id as hq,OHt as hr,wU as hs,$y as ht,Wye as hu,B_ as hv,Ji as hw,pD as hx,yc as hy,GD as hz,Ak as i,j$ as i$,AKe as i0,Kb as i1,eIt as i2,XEt as i3,WEt as i4,ree as i5,AGt as i6,Wp as i7,SCe as i8,Tte as i9,tQt as iA,ece as iB,XKt as iC,xEt as iD,eV as iE,SS as iF,tIt as iG,ene as iH,Am as iI,hD as iJ,To as iK,yS as iL,RNe as iM,OGt as iN,dV as iO,qqt as iP,z_ as iQ,qxe as iR,Mb as iS,Wxe as iT,wIt as iU,ur as iV,mBt as iW,hq as iX,umt as iY,R1e as iZ,rQt as i_,Ey as ia,kp as ib,vQt as ic,_Qt as id,G_ as ie,WA as ig,vi as ih,Ju as ii,Fa as ij,qii as ik,fne as il,hQt as im,uQt as io,gc as ip,Nt as iq,xLe as ir,ua as is,al as it,jBt as iu,N_ as iv,rm as iw,Wb as ix,td as iy,BN as iz,cu as j,TUt as j$,Gp as j0,WAe as j1,HAe as j2,Qc as j3,Ai as j4,di as j5,kk as j6,tte as j7,Mre as j8,Ul as j9,$jt as jA,Ljt as jB,Njt as jC,lB as jD,Ur as jE,y7t as jF,Il as jG,Bgt as jH,kYt as jI,Vpe as jJ,g7t as jK,KV as jL,dyt as jM,BYt as jN,rz as jO,Fm as jP,Sgt as jQ,UZt as jR,b2 as jS,m_t as jT,rZt as jU,tZt as jV,iZt as jW,xne as jX,PYt as jY,fGt as jZ,zli as j_,Kr as ja,Bli as jb,ba as jc,Pb as jd,YV as je,_Oe as jf,UYt as jg,bpt as jh,yoe as ji,Iy as jj,_kt as jk,c6e as jl,_7t as jm,Nq as jn,Zr as jo,Fjt as jp,Ujt as jq,A3 as jr,_V as js,Mjt as jt,Ajt as ju,Ojt as jv,Rjt as jw,Djt as jx,Pjt as jy,Ijt as jz,fe as k,Va as k$,Go as k0,G9 as k1,Zp as k2,Vli as k3,nl as k4,mti as k5,W$e as k6,jt as k7,cee as k8,Bo as k9,fi as kA,sl as kB,zt as kC,X as kD,lr as kE,ca as kF,dr as kG,cr as kH,si as kI,yd as kJ,fv as kK,iz as kL,gu as kM,Az as kN,wi as kO,Rz as kP,Sw as kQ,ZIe as kR,Tw as kS,tO as kT,qs as kU,a$e as kV,Rt as kW,cs as kX,Ez as kY,CGt as kZ,$ge as k_,D7t as ka,jp as kb,th as kc,at as kd,Cre as ke,dGt as kf,IYt as kg,xGt as kh,iy as ki,mv as kj,Fy as kk,Gte as kl,KTe as km,zp as kn,Hs as ko,$m as kp,Be as kq,T as kr,ar as ks,au as kt,Un as ku,ky as kv,ah as kw,Ni as kx,o3 as ky,Ed as kz,oft as l,xn as l$,V$e as l0,qn as l1,ct as l2,hn as l3,pi as l4,oV as l5,mp as l6,rr as l7,qo as l8,Br as l9,vh as lA,Qp as lB,ld as lC,to as lD,t$e as lE,OYt as lF,a2t as lG,ql as lH,Os as lI,xgt as lJ,p$e as lK,l3 as lL,AA as lM,nK as lN,Jse as lO,Js as lP,uD as lQ,uti as lR,QAe as lS,V9 as lT,Ew as lU,Py as lV,fw as lW,Cw as lX,Pz as lY,Oz as lZ,Wre as l_,gne as la,Hl as lb,nO as lc,cMt as ld,NZt as le,aOe as lf,nKe as lg,AYt as lh,H$ as li,Ore as lj,pGt as lk,ext as ll,Rre as lm,MKe as ln,oyt as lo,H_ as lp,LYt as lq,rb as lr,$S as ls,Sd as lt,Uz as lu,Yt as lv,hr as lw,Ps as lx,Um as ly,km as lz,mre as m,gY as m$,gbe as m0,Ek as m1,Cte as m2,z2 as m3,R$ as m4,Qu as m5,hd as m6,eJe as m7,SA as m8,tJe as m9,De as mA,rU as mB,Dte as mC,ZA as mD,GMe as mE,jMe as mF,Gut as mG,mat as mH,gat as mI,Sat as mJ,X7t as mK,zai as mL,tGt as mM,Z7t as mN,K7t as mO,J7t as mP,Q7t as mQ,E$ as mR,pd as mS,eZe as mT,Xk as mU,m2 as mV,Rbe as mW,Xb as mX,Zb as mY,yY as mZ,Pn as m_,c7t as ma,PGt as mb,rpt as mc,vWt as md,ili as me,sO as mf,LD as mg,_S as mh,XIt as mi,Ik as mj,yjt as mk,sjt as ml,Xut as mm,O7t as mn,KHt as mo,K_ as mp,I2 as mq,P3e as mr,fee as ms,Fkt as mt,Syt as mu,f6e as mv,pk as mw,eGt as mx,mxe as my,nft as mz,$ as n,Np as n$,vY as n0,EU as n1,CKe as n2,aDt as n3,oDt as n4,e0e as n5,Csi as n6,Esi as n7,cDt as n8,hDt as n9,Vri as nA,Yri as nB,qye as nC,Aot as nD,gH as nE,Uri as nF,Wri as nG,p3e as nH,Fri as nI,DT as nJ,K0 as nK,bLt as nL,Jri as nM,Une as nN,Fn as nO,p2 as nP,$k as nQ,_r as nR,ks as nS,Wqt as nT,UW as nU,REt as nV,vo as nW,M5e as nX,tZe as nY,TBt as nZ,W8 as n_,uDt as na,mu as nb,lDt as nc,Ssi as nd,Tsi as ne,Gpt as nf,qBt as ng,Hh as nh,dwe as ni,tv as nj,kle as nk,j7t as nl,DA as nm,Vh as nn,Cm as no,_we as np,fWe as nq,WGt as nr,Hp as ns,rft as nt,Gb as nu,jl as nv,Hu as nw,Xe as nx,It as ny,Dri as nz,kmt as o,cQt as o$,LHe as o0,Rm as o1,PEt as o2,FNt as o3,UFe as o4,FGe as o5,UGe as o6,PGe as o7,vBt as o8,Iee as o9,vgt as oA,YGt as oB,E0e as oC,gA as oD,JA as oE,tKe as oF,ejt as oG,Nn as oH,QGt as oI,S3 as oJ,Si as oK,FEe as oL,UEe as oM,aQt as oN,_O as oO,K_t as oP,v3 as oQ,WB as oR,x$ as oS,zi as oT,c_ as oU,FXt as oV,Nr as oW,Uni as oX,t7t as oY,DBt as oZ,J$ as o_,mse as oa,gre as ob,wni as oc,Mni as od,fse as oe,sS as of,as as og,KMt as oh,Fr as oi,eqt as oj,jX as ok,Jie as ol,Iie as om,dD as on,eAe as oo,Kk as op,Kxe as oq,zNe as or,Fbt as os,Cni as ot,Eai as ou,VA as ov,P4 as ow,l$e as ox,SFt as oy,dAe as oz,fre as p,R3 as p$,ARe as p0,eFt as p1,Eni as p2,Tb as p3,Agt as p4,Kg as p5,kdt as p6,Tde as p7,Ule as p8,Yqt as p9,mSe as pA,Cjt as pB,jk as pC,aHt as pD,hBt as pE,Fo as pF,Qjt as pG,die as pH,pUt as pI,Art as pJ,bve as pK,Nli as pL,f3 as pM,ZH as pN,Dli as pO,pI as pP,Lli as pQ,XH as pR,loe as pS,Sli as pT,Eli as pU,Cli as pV,gh as pW,hWe as pX,_We as pY,Nk as pZ,T7t as p_,r$t as pa,VHt as pb,zHt as pc,e7t as pd,pSe as pe,fSe as pf,JGt as pg,uOe as ph,WSt as pi,QKt as pj,TGt as pk,xBt as pl,psi as pm,fEe as pn,eQt as po,Zu as pp,mEe as pq,k2 as pr,LBt as ps,knt as pt,uy as pu,tAt as pv,Bh as pw,il as px,Ay as py,IKt as pz,nr as q,are as q$,wy as q0,aD as q1,Dst as q2,KKt as q3,Hr as q4,A5 as q5,mHt as q6,$K as q7,Ib as q8,bni as q9,cN as qA,ZM as qB,Hit as qC,Ok as qD,D_ as qE,Ute as qF,aWe as qG,R2 as qH,pDt as qI,o6 as qJ,D6 as qK,D$t as qL,N$t as qM,UWe as qN,FYt as qO,IKe as qP,j2 as qQ,KGt as qR,DYt as qS,kgt as qT,iA as qU,xwe as qV,I7t as qW,Mqe as qX,Cqe as qY,zee as qZ,kee as q_,xni as qa,EGt as qb,kZe as qc,vT as qd,_ni as qe,v9 as qf,RGt as qg,LKt as qh,HIe as qi,X$ as qj,gd as qk,qq as ql,rS as qm,nz as qn,_h as qo,pv as qp,Xxe as qq,Tni as qr,Sni as qs,xte as qt,Tai as qu,Vii as qv,QSe as qw,uP as qx,gOe as qy,f9 as qz,b as r,BXe as r$,rci as r0,J2 as r1,Nxe as r2,NYt as r3,Vgt as r4,f7t as r5,p7t as r6,Jee as r7,LCt as r8,goe as r9,bjt as rA,vCe as rB,_D as rC,vD as rD,CS as rE,lLt as rF,aLt as rG,U3 as rH,OV as rI,bBt as rJ,VBt as rK,gqe as rL,lb as rM,g9t as rN,IHt as rO,xot as rP,F5e as rQ,gve as rR,UQ as rS,p9t as rT,f9t as rU,m9t as rV,k5e as rW,v9t as rX,b9t as rY,V5e as rZ,$Xe as r_,Mkt as ra,kf as rb,B1 as rc,wA as rd,lee as re,hWt as rf,VL as rg,w3t as rh,NCt as ri,lS as rj,fy as rk,GL as rl,$le as rm,$7t as rn,$Yt as ro,tB as rp,c9 as rq,iMt as rr,Oai as rs,Pai as rt,Rai as ru,wUt as rv,wGt as rw,aat as rx,l7t as ry,wjt as rz,Y6t as s,hEe as s$,Zai as s0,QT as s1,CU as s2,Dq as s3,Rp as s4,XGe as s5,YFt as s6,XFt as s7,zFt as s8,Goi as s9,pHt as sA,kst as sB,ist as sC,Jai as sD,lHt as sE,rGt as sF,sGt as sG,Dle as sH,iGt as sI,VYe as sJ,ZKt as sK,WKt as sL,nh as sM,Ist as sN,Cst as sO,iue as sP,Fst as sQ,mme as sR,fHt as sS,RJe as sT,NHt as sU,y7 as sV,_7 as sW,iHt as sX,mmt as sY,VZe as sZ,hHt as s_,ak as sa,Jni as sb,JFt as sc,AD as sd,w9 as se,nfe as sf,rKe as sg,Bl as sh,DD as si,Nte as sj,jz as sk,zTe as sl,XA as sm,_ti as sn,pw as so,gti as sp,vti as sq,yti as sr,N3t as ss,V3t as st,F3t as su,U3t as sv,k3t as sw,Vst as sx,Nst as sy,sHt as sz,cai as t,HY as t$,ys as t0,SY as t1,Lnt as t2,Dnt as t3,Ogt as t4,lm as t5,RYt as t6,Ngt as t7,lBt as t8,rqe as t9,_li as tA,wb as tB,SHt as tC,B2 as tD,CI as tE,rY as tF,mjt as tG,ujt as tH,Tjt as tI,sFe as tJ,IDt as tK,wOe as tL,iyt as tM,Al as tN,Or as tO,nli as tP,Vdt as tQ,QU as tR,lkt as tS,ckt as tT,kli as tU,moe as tV,Q9t as tW,Jli as tX,Zli as tY,foe as tZ,n6t as t_,Ree as ta,EGe as tb,qri as tc,Xu as td,ru as te,lqe as tf,Mee as tg,D3t as th,Dd as ti,QZt as tj,KZt as tk,LQt as tl,cEe as tm,zA as tn,ZHe as to,w7t as tp,qtt as tq,DN as tr,oX as ts,mli as tt,Zi as tu,Gbe as tv,gli as tw,yli as tx,vli as ty,fk as tz,Fk as u,v3t as u$,bN as u0,XB as u1,qZe as u2,GI as u3,d0t as u4,K0t as u5,bRe as u6,vRe as u7,n_t as u8,Kre as u9,lAt as uA,pAt as uB,DMt as uC,kMt as uD,vne as uE,eDt as uF,QLt as uG,Xz as uH,tDt as uI,H9 as uJ,FCt as uK,G4t as uL,p4e as uM,q4t as uN,g4e as uO,Y4t as uP,v4e as uQ,eB as uR,l5t as uS,y5t as uT,A5t as uU,R5t as uV,I5t as uW,vMt as uX,b4e as uY,h5t as uZ,X5t as u_,k_t as ua,GRe as ub,tse as uc,j_t as ud,Ivt as ue,Jvt as uf,eSt as ug,z9 as uh,kEt as ui,Xse as uj,g2t as uk,fS as ul,oNt as um,IFt as un,Zne as uo,KFe as up,r4t as uq,t4e as ur,n4t as us,s4e as ut,a4t as uu,a4e as uv,c4t as uw,TRe as ux,l_t as uy,fM as uz,A as v,ygt as v$,j3t as v0,sPt as v1,EPt as v2,vPt as v3,k9t as v4,F3 as v5,j3 as v6,bD as v7,toe as v8,Fxe as v9,yw as vA,HU as vB,U_ as vC,u6 as vD,V8t as vE,U8t as vF,Wje as vG,NV as vH,Die as vI,tAe as vJ,I3 as vK,Eie as vL,LEe as vM,Brt as vN,Qnt as vO,Grt as vP,kEe as vQ,HEe as vR,GU as vS,REe as vT,LI as vU,cat as vV,Vn as vW,SBt as vX,V2 as vY,SGt as vZ,VW as v_,fCe as va,xee as vb,tqt as vc,MCe as vd,Fie as ve,lat as vf,Lie as vg,uat as vh,hat as vi,jb as vj,gUt as vk,EKe as vl,Nie as vm,yh as vn,rV as vo,xXe as vp,wXe as vq,WYe as vr,xle as vs,ga as vt,CV as vu,Dqe as vv,Lqe as vw,v7t as vx,sEe as vy,rEe as vz,Ba as w,Tat as w$,AS as w0,cte as w1,o7t as w2,Kq as w3,HMe as w4,xCe as w5,WMe as w6,gU as w7,hte as w8,G3 as w9,Hct as wA,qct as wB,Rct as wC,Pct as wD,Ict as wE,$ct as wF,Lct as wG,Dct as wH,Nct as wI,Fct as wJ,Uct as wK,kct as wL,Vct as wM,zct as wN,KMe as wO,K8t as wP,F8t as wQ,sB as wR,NGe as wS,fm as wT,Em as wU,s7t as wV,ele as wW,sTe as wX,rYe as wY,dU as wZ,Uk as w_,CZ as wa,AV as wb,L3 as wc,CCe as wd,UV as we,e5e as wf,$xe as wg,qbe as wh,Oae as wi,z$ as wj,fat as wk,ht as wl,Ob as wm,$he as wn,PMe as wo,S$ as wp,Cat as wq,Eat as wr,gw as ws,nV as wt,pie as wu,Bct as wv,eat as ww,FV as wx,iv as wy,out as wz,Sn as x,Gae as x0,RQ as x1,z as x2,d7t as x3,V1 as x4,PHt as x5,RHt as x6,w1t as x7,bgt as x8,_gt as x9,tCt as xA,DOt as xB,LOt as xC,$Ot as xD,dv as xE,$Zt as xF,IE as xG,bli as xH,jf as xI,ST as xJ,Qa as xK,BMe as xL,jS as xM,Kqe as xN,Aie as xO,MHt as xP,Sht as xQ,sQt as xR,$ti as xS,jai as xT,Hai as xU,Yai as xV,eli as xW,ooe as xX,ey as xa,FDe as xb,E2 as xc,h1t as xd,a7t as xe,XDe as xf,JDe as xg,jT as xh,i$ as xi,L7t as xj,cne as xk,hOt as xl,jDe as xm,nOt as xn,YDe as xo,qDe as xp,uOt as xq,ph as xr,qK as xs,Gl as xt,WDe as xu,CD as xv,oOt as xw,Q$ as xx,RK as xy,cz as xz,O2 as y,Ut as z};
