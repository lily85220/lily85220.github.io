<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- reset -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">

    <!-- fontawsome -->
    <script src="https://kit.fontawesome.com/9dc7e45d14.js" crossorigin="anonymous"></script>

    <!-- googlefont -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Edu+SA+Beginner:wght@400;500;600;700&family=Noto+Sans+TC:wght@100;300;400;500;700&display=swap" rel="stylesheet">

    <title>志在籤里</title>
    <style>
        body{
            background-image: url(./海底刷淡.png);
        }
        .container-box{
            max-width: 1194px;
            height: 100px;
            margin: 10px auto;
            padding: 20px;
        }
        .box{
            width: 100px;
            height: 100px;
            overflow: hidden;
            margin: 5px;
        }
        .stick{
            box-shadow: 0px 0px 6px #000;
            border-radius: 10px;
            background-color: rgb(232, 241, 241);
            padding: 10px;
        }
        .stick.active{
            box-shadow: 0px 0px 8px 3px rgb(229, 172, 15);
            transition: 0s;
        }
        h2{
            text-align: center;
            font-weight: 700;
        }
        .stick-content{
            align-self: flex-start;
            width: 100%;
            height: 200px;
            border: none;
        }
        .stick-content:focus-visible{
            outline: none;
            box-shadow: 0px 0px 3px 3px rgb(51, 121, 225);
        }
        .button{
            border: none;
            height: 40px;
            width: 90px;
            border-radius: 10px;
        }
        .start-draw{
            background-color: #3EB0D5;
            color: #fff;
        }
        .reset-input{
            background-color: #EC971F;
            color: #fff;
        }
        .button:hover{
            box-shadow: 0px 0px 6px #000;
        }
        .button:focus{
            box-shadow: 0px 0px 6px #0006;
        }
    </style>
</head>
<body>
    <div class="container-box">
        <div class="d-flex flex-sm-wrap flex-wrap justify-content-between">
            <div class="input-stick-area col-md-4 col-12 mt-2 ">
                <h2 mb-2>線上抽籤程式</h2>
                <textarea type="text" placeholder="輸入籤的內容：一行輸入一支籤" class="stick-content my-3"></textarea>
                <div class="btn-area d-flex justify-content-around my-3">
                    <button class="button start-draw">開始抽籤</button>
                    <button class="button reset-input">重新輸入</button>
                </div>
            </div>

            <!-- <div class="stick-box col-md-8 col-12">
                <div class="stick-box-row d-flex justify-content-around">
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                    <div class="col-md-2 col-1 m-1 d-flex align-items-center justify-content-center box">
                        <p class="m-0 stick-text"></p>
                    </div>
                </div>
                
            </div> -->


            <div class="stick-box-row d-flex justify-content-around col-md-8 col-12 flex-wrap">

                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
                <div class="d-flex align-items-center justify-content-center box">
                    <p class="m-0 stick-text"></p>
                </div>
            </div>

        </div>

        <div class="modal fade result-modal" tabindex="-1">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">抽籤結果</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p class="result"></p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
    <script>
        let stickArray
        let steps = 0 //剩餘要走的步數
        let allsteps = 0 //全部的步數
        let current = 0 //目前走到哪
        let speed //速率(越大代表走越慢)

        let textarea = document.querySelector('textarea')
        const stickBoxs = document.querySelectorAll('.box')
        let filledStick
        const startDraw = document.querySelector('.start-draw')
        const resetInput = document.querySelector('.reset-input')
        const resultModal = document.querySelector('.result-modal')
        let result = document.querySelector('.result')

        //textarea每輸入一行，會出現一個籤，並且輸入的字寫在上面
        window.onload = function(){
            textarea.addEventListener('input', function(){
                filledStick = document.querySelectorAll('.stick')
                stickArray = textarea.value.split('\n')
                if(stickArray.length > 30) {
                    alert('超出籤數上限')
                    return
                }

                if(filledStick.length >= stickArray.length){
                    filledStick.forEach(item => {
                        item.classList.remove('stick')
                        item.querySelector('p').innerText = ''
                    })
                }
                stickArray.forEach((text, index) => {
                    if(text !== ''){
                        let p = stickBoxs[index].querySelector('p')
                        p.innerText = text
                        stickBoxs[index].classList.add('stick')
                    }
                })
            })
            startDraw.addEventListener('click', function(){
                filledStick = document.querySelectorAll('.stick')
                if(filledStick.length !== stickArray.length) {
                    alert('請勿有空行')
                    return
                }
                let random = Math.floor(Math.random() * stickArray.length)

                if(stickArray.length < 10)steps = random + 3 * stickArray.length
                else steps = random + 2 * stickArray.length
                allsteps = steps
                speed = 50

                draw()
            })
            resetInput.addEventListener('click', function(){
                reset()
            })
        }
        //開始抽籤 > 隨機亮黃燈 > 隨機停下來
        function draw(){
            filledStick = document.querySelectorAll('.stick')
            filledStick[current].classList.remove('active')

            let random = Math.floor(Math.random() * stickArray.length)
            filledStick[random].classList.add('active')
            current = random
            steps--

            if(steps > 0){
                setTimeout(draw, speed)

                if(steps < Math.floor(allsteps / 3)) speed += 7
            }else{
                setTimeout(showResult,1000)
            }
            
        }
        
        function showResult(){
            let active = document.querySelector('.active')
            result.innerText = active.innerText
            bootstrap.Modal.getOrCreateInstance(resultModal).show()
            // setTimeout(()=>{},1000)
            
        }
        //重新輸入 > 清空textarea、清空籤筒
        function reset(){
            textarea.value = ''
            stickArray = []
            if(document.querySelector('.active'))document.querySelector('.active').classList.remove('active')
            filledStick = document.querySelectorAll('.stick')
            filledStick.forEach(item => {
                item.classList.remove('stick')
                item.querySelector('p').innerText = ''
            })
        }
        //防呆: 超過格子數量不可以再增加籤支
    </script>
</body>
</html>